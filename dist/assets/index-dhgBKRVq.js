var qne=Object.defineProperty;var Gne=(t,s,r)=>s in t?qne(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var SS=(t,s,r)=>Gne(t,typeof s!="symbol"?s+"":s,r);function f$(t,s){for(var r=0;r<s.length;r++){const a=s[r];if(typeof a!="string"&&!Array.isArray(a)){for(const i in a)if(i!=="default"&&!(i in t)){const l=Object.getOwnPropertyDescriptor(a,i);l&&Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:()=>a[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();var n0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ro(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var g$={exports:{}},Mw={},b$={exports:{}},Bs={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kb=Symbol.for("react.element"),Kne=Symbol.for("react.portal"),Yne=Symbol.for("react.fragment"),Xne=Symbol.for("react.strict_mode"),Qne=Symbol.for("react.profiler"),Zne=Symbol.for("react.provider"),Jne=Symbol.for("react.context"),ere=Symbol.for("react.forward_ref"),tre=Symbol.for("react.suspense"),sre=Symbol.for("react.memo"),nre=Symbol.for("react.lazy"),gI=Symbol.iterator;function rre(t){return t===null||typeof t!="object"?null:(t=gI&&t[gI]||t["@@iterator"],typeof t=="function"?t:null)}var y$={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v$=Object.assign,j$={};function gf(t,s,r){this.props=t,this.context=s,this.refs=j$,this.updater=r||y$}gf.prototype.isReactComponent={};gf.prototype.setState=function(t,s){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,s,"setState")};gf.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function N$(){}N$.prototype=gf.prototype;function XA(t,s,r){this.props=t,this.context=s,this.refs=j$,this.updater=r||y$}var QA=XA.prototype=new N$;QA.constructor=XA;v$(QA,gf.prototype);QA.isPureReactComponent=!0;var bI=Array.isArray,w$=Object.prototype.hasOwnProperty,ZA={current:null},_$={key:!0,ref:!0,__self:!0,__source:!0};function S$(t,s,r){var a,i={},l=null,o=null;if(s!=null)for(a in s.ref!==void 0&&(o=s.ref),s.key!==void 0&&(l=""+s.key),s)w$.call(s,a)&&!_$.hasOwnProperty(a)&&(i[a]=s[a]);var c=arguments.length-2;if(c===1)i.children=r;else if(1<c){for(var d=Array(c),u=0;u<c;u++)d[u]=arguments[u+2];i.children=d}if(t&&t.defaultProps)for(a in c=t.defaultProps,c)i[a]===void 0&&(i[a]=c[a]);return{$$typeof:Kb,type:t,key:l,ref:o,props:i,_owner:ZA.current}}function are(t,s){return{$$typeof:Kb,type:t.type,key:s,ref:t.ref,props:t.props,_owner:t._owner}}function JA(t){return typeof t=="object"&&t!==null&&t.$$typeof===Kb}function ire(t){var s={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return s[r]})}var yI=/\/+/g;function CS(t,s){return typeof t=="object"&&t!==null&&t.key!=null?ire(""+t.key):s.toString(36)}function Uv(t,s,r,a,i){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Kb:case Kne:o=!0}}if(o)return o=t,i=i(o),t=a===""?"."+CS(o,0):a,bI(i)?(r="",t!=null&&(r=t.replace(yI,"$&/")+"/"),Uv(i,s,r,"",function(u){return u})):i!=null&&(JA(i)&&(i=are(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(yI,"$&/")+"/")+t)),s.push(i)),1;if(o=0,a=a===""?".":a+":",bI(t))for(var c=0;c<t.length;c++){l=t[c];var d=a+CS(l,c);o+=Uv(l,s,r,d,i)}else if(d=rre(t),typeof d=="function")for(t=d.call(t),c=0;!(l=t.next()).done;)l=l.value,d=a+CS(l,c++),o+=Uv(l,s,r,d,i);else if(l==="object")throw s=String(t),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return o}function Vy(t,s,r){if(t==null)return t;var a=[],i=0;return Uv(t,a,"","",function(l){return s.call(r,l,i++)}),a}function lre(t){if(t._status===-1){var s=t._result;s=s(),s.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=s)}if(t._status===1)return t._result.default;throw t._result}var Ii={current:null},Vv={transition:null},ore={ReactCurrentDispatcher:Ii,ReactCurrentBatchConfig:Vv,ReactCurrentOwner:ZA};function C$(){throw Error("act(...) is not supported in production builds of React.")}Bs.Children={map:Vy,forEach:function(t,s,r){Vy(t,function(){s.apply(this,arguments)},r)},count:function(t){var s=0;return Vy(t,function(){s++}),s},toArray:function(t){return Vy(t,function(s){return s})||[]},only:function(t){if(!JA(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Bs.Component=gf;Bs.Fragment=Yne;Bs.Profiler=Qne;Bs.PureComponent=XA;Bs.StrictMode=Xne;Bs.Suspense=tre;Bs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ore;Bs.act=C$;Bs.cloneElement=function(t,s,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var a=v$({},t.props),i=t.key,l=t.ref,o=t._owner;if(s!=null){if(s.ref!==void 0&&(l=s.ref,o=ZA.current),s.key!==void 0&&(i=""+s.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(d in s)w$.call(s,d)&&!_$.hasOwnProperty(d)&&(a[d]=s[d]===void 0&&c!==void 0?c[d]:s[d])}var d=arguments.length-2;if(d===1)a.children=r;else if(1<d){c=Array(d);for(var u=0;u<d;u++)c[u]=arguments[u+2];a.children=c}return{$$typeof:Kb,type:t.type,key:i,ref:l,props:a,_owner:o}};Bs.createContext=function(t){return t={$$typeof:Jne,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Zne,_context:t},t.Consumer=t};Bs.createElement=S$;Bs.createFactory=function(t){var s=S$.bind(null,t);return s.type=t,s};Bs.createRef=function(){return{current:null}};Bs.forwardRef=function(t){return{$$typeof:ere,render:t}};Bs.isValidElement=JA;Bs.lazy=function(t){return{$$typeof:nre,_payload:{_status:-1,_result:t},_init:lre}};Bs.memo=function(t,s){return{$$typeof:sre,type:t,compare:s===void 0?null:s}};Bs.startTransition=function(t){var s=Vv.transition;Vv.transition={};try{t()}finally{Vv.transition=s}};Bs.unstable_act=C$;Bs.useCallback=function(t,s){return Ii.current.useCallback(t,s)};Bs.useContext=function(t){return Ii.current.useContext(t)};Bs.useDebugValue=function(){};Bs.useDeferredValue=function(t){return Ii.current.useDeferredValue(t)};Bs.useEffect=function(t,s){return Ii.current.useEffect(t,s)};Bs.useId=function(){return Ii.current.useId()};Bs.useImperativeHandle=function(t,s,r){return Ii.current.useImperativeHandle(t,s,r)};Bs.useInsertionEffect=function(t,s){return Ii.current.useInsertionEffect(t,s)};Bs.useLayoutEffect=function(t,s){return Ii.current.useLayoutEffect(t,s)};Bs.useMemo=function(t,s){return Ii.current.useMemo(t,s)};Bs.useReducer=function(t,s,r){return Ii.current.useReducer(t,s,r)};Bs.useRef=function(t){return Ii.current.useRef(t)};Bs.useState=function(t){return Ii.current.useState(t)};Bs.useSyncExternalStore=function(t,s,r){return Ii.current.useSyncExternalStore(t,s,r)};Bs.useTransition=function(){return Ii.current.useTransition()};Bs.version="18.3.1";b$.exports=Bs;var p=b$.exports;const _t=Ro(p),Iw=f$({__proto__:null,default:_t},[p]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cre=p,dre=Symbol.for("react.element"),ure=Symbol.for("react.fragment"),mre=Object.prototype.hasOwnProperty,hre=cre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xre={key:!0,ref:!0,__self:!0,__source:!0};function k$(t,s,r){var a,i={},l=null,o=null;r!==void 0&&(l=""+r),s.key!==void 0&&(l=""+s.key),s.ref!==void 0&&(o=s.ref);for(a in s)mre.call(s,a)&&!xre.hasOwnProperty(a)&&(i[a]=s[a]);if(t&&t.defaultProps)for(a in s=t.defaultProps,s)i[a]===void 0&&(i[a]=s[a]);return{$$typeof:dre,type:t,key:l,ref:o,props:i,_owner:hre.current}}Mw.Fragment=ure;Mw.jsx=k$;Mw.jsxs=k$;g$.exports=Mw;var n=g$.exports,T5={},A$={exports:{}},Kl={},E$={exports:{}},T$={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function s($,K){var le=$.length;$.push(K);e:for(;0<le;){var se=le-1>>>1,J=$[se];if(0<i(J,K))$[se]=K,$[le]=J,le=se;else break e}}function r($){return $.length===0?null:$[0]}function a($){if($.length===0)return null;var K=$[0],le=$.pop();if(le!==K){$[0]=le;e:for(var se=0,J=$.length,ie=J>>>1;se<ie;){var te=2*(se+1)-1,ne=$[te],q=te+1,ee=$[q];if(0>i(ne,le))q<J&&0>i(ee,ne)?($[se]=ee,$[q]=le,se=q):($[se]=ne,$[te]=le,se=te);else if(q<J&&0>i(ee,le))$[se]=ee,$[q]=le,se=q;else break e}}return K}function i($,K){var le=$.sortIndex-K.sortIndex;return le!==0?le:$.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var o=Date,c=o.now();t.unstable_now=function(){return o.now()-c}}var d=[],u=[],m=1,x=null,g=3,y=!1,v=!1,j=!1,w=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k($){for(var K=r(u);K!==null;){if(K.callback===null)a(u);else if(K.startTime<=$)a(u),K.sortIndex=K.expirationTime,s(d,K);else break;K=r(u)}}function A($){if(j=!1,k($),!v)if(r(d)!==null)v=!0,G(I);else{var K=r(u);K!==null&&H(A,K.startTime-$)}}function I($,K){v=!1,j&&(j=!1,S(D),D=-1),y=!0;var le=g;try{for(k(K),x=r(d);x!==null&&(!(x.expirationTime>K)||$&&!U());){var se=x.callback;if(typeof se=="function"){x.callback=null,g=x.priorityLevel;var J=se(x.expirationTime<=K);K=t.unstable_now(),typeof J=="function"?x.callback=J:x===r(d)&&a(d),k(K)}else a(d);x=r(d)}if(x!==null)var ie=!0;else{var te=r(u);te!==null&&H(A,te.startTime-K),ie=!1}return ie}finally{x=null,g=le,y=!1}}var P=!1,O=null,D=-1,T=5,B=-1;function U(){return!(t.unstable_now()-B<T)}function W(){if(O!==null){var $=t.unstable_now();B=$;var K=!0;try{K=O(!0,$)}finally{K?V():(P=!1,O=null)}}else P=!1}var V;if(typeof E=="function")V=function(){E(W)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,F=R.port2;R.port1.onmessage=W,V=function(){F.postMessage(null)}}else V=function(){w(W,0)};function G($){O=$,P||(P=!0,V())}function H($,K){D=w(function(){$(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_continueExecution=function(){v||y||(v=!0,G(I))},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return r(d)},t.unstable_next=function($){switch(g){case 1:case 2:case 3:var K=3;break;default:K=g}var le=g;g=K;try{return $()}finally{g=le}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($,K){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var le=g;g=$;try{return K()}finally{g=le}},t.unstable_scheduleCallback=function($,K,le){var se=t.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?se+le:se):le=se,$){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=le+J,$={id:m++,callback:K,priorityLevel:$,startTime:le,expirationTime:J,sortIndex:-1},le>se?($.sortIndex=le,s(u,$),r(d)===null&&$===r(u)&&(j?(S(D),D=-1):j=!0,H(A,le-se))):($.sortIndex=J,s(d,$),v||y||(v=!0,G(I))),$},t.unstable_shouldYield=U,t.unstable_wrapCallback=function($){var K=g;return function(){var le=g;g=K;try{return $.apply(this,arguments)}finally{g=le}}}})(T$);E$.exports=T$;var pre=E$.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fre=p,Vl=pre;function St(t){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)s+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var P$=new Set,Rg={};function dx(t,s){zp(t,s),zp(t+"Capture",s)}function zp(t,s){for(Rg[t]=s,t=0;t<s.length;t++)P$.add(s[t])}var Vd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),P5=Object.prototype.hasOwnProperty,gre=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vI={},jI={};function bre(t){return P5.call(jI,t)?!0:P5.call(vI,t)?!1:gre.test(t)?jI[t]=!0:(vI[t]=!0,!1)}function yre(t,s,r,a){if(r!==null&&r.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return a?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function vre(t,s,r,a){if(s===null||typeof s>"u"||yre(t,s,r,a))return!0;if(a)return!1;if(r!==null)switch(r.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Oi(t,s,r,a,i,l,o){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=a,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=s,this.sanitizeURL=l,this.removeEmptyString=o}var Ya={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ya[t]=new Oi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var s=t[0];Ya[s]=new Oi(s,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ya[t]=new Oi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ya[t]=new Oi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ya[t]=new Oi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ya[t]=new Oi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ya[t]=new Oi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ya[t]=new Oi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ya[t]=new Oi(t,5,!1,t.toLowerCase(),null,!1,!1)});var eE=/[\-:]([a-z])/g;function tE(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var s=t.replace(eE,tE);Ya[s]=new Oi(s,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var s=t.replace(eE,tE);Ya[s]=new Oi(s,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var s=t.replace(eE,tE);Ya[s]=new Oi(s,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ya[t]=new Oi(t,1,!1,t.toLowerCase(),null,!1,!1)});Ya.xlinkHref=new Oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ya[t]=new Oi(t,1,!1,t.toLowerCase(),null,!0,!0)});function sE(t,s,r,a){var i=Ya.hasOwnProperty(s)?Ya[s]:null;(i!==null?i.type!==0:a||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(vre(s,r,i,a)&&(r=null),a||i===null?bre(s)&&(r===null?t.removeAttribute(s):t.setAttribute(s,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(s=i.attributeName,a=i.attributeNamespace,r===null?t.removeAttribute(s):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,a?t.setAttributeNS(a,s,r):t.setAttribute(s,r))))}var ru=fre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hy=Symbol.for("react.element"),sp=Symbol.for("react.portal"),np=Symbol.for("react.fragment"),nE=Symbol.for("react.strict_mode"),D5=Symbol.for("react.profiler"),D$=Symbol.for("react.provider"),M$=Symbol.for("react.context"),rE=Symbol.for("react.forward_ref"),M5=Symbol.for("react.suspense"),I5=Symbol.for("react.suspense_list"),aE=Symbol.for("react.memo"),Ou=Symbol.for("react.lazy"),I$=Symbol.for("react.offscreen"),NI=Symbol.iterator;function r0(t){return t===null||typeof t!="object"?null:(t=NI&&t[NI]||t["@@iterator"],typeof t=="function"?t:null)}var cr=Object.assign,kS;function X0(t){if(kS===void 0)try{throw Error()}catch(r){var s=r.stack.trim().match(/\n( *(at )?)/);kS=s&&s[1]||""}return`
`+kS+t}var AS=!1;function ES(t,s){if(!t||AS)return"";AS=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(u){var a=u}Reflect.construct(t,[],s)}else{try{s.call()}catch(u){a=u}t.call(s.prototype)}else{try{throw Error()}catch(u){a=u}t()}}catch(u){if(u&&a&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),l=a.stack.split(`
`),o=i.length-1,c=l.length-1;1<=o&&0<=c&&i[o]!==l[c];)c--;for(;1<=o&&0<=c;o--,c--)if(i[o]!==l[c]){if(o!==1||c!==1)do if(o--,c--,0>c||i[o]!==l[c]){var d=`
`+i[o].replace(" at new "," at ");return t.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",t.displayName)),d}while(1<=o&&0<=c);break}}}finally{AS=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?X0(t):""}function jre(t){switch(t.tag){case 5:return X0(t.type);case 16:return X0("Lazy");case 13:return X0("Suspense");case 19:return X0("SuspenseList");case 0:case 2:case 15:return t=ES(t.type,!1),t;case 11:return t=ES(t.type.render,!1),t;case 1:return t=ES(t.type,!0),t;default:return""}}function O5(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case np:return"Fragment";case sp:return"Portal";case D5:return"Profiler";case nE:return"StrictMode";case M5:return"Suspense";case I5:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case M$:return(t.displayName||"Context")+".Consumer";case D$:return(t._context.displayName||"Context")+".Provider";case rE:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case aE:return s=t.displayName||null,s!==null?s:O5(t.type)||"Memo";case Ou:s=t._payload,t=t._init;try{return O5(t(s))}catch{}}return null}function Nre(t){var s=t.type;switch(t.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=s.render,t=t.displayName||t.name||"",s.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return O5(s);case 8:return s===nE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function um(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function O$(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function wre(t){var s=O$(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,s),a=""+t[s];if(!t.hasOwnProperty(s)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,l=r.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return i.call(this)},set:function(o){a=""+o,l.call(this,o)}}),Object.defineProperty(t,s,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(o){a=""+o},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function Wy(t){t._valueTracker||(t._valueTracker=wre(t))}function R$(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var r=s.getValue(),a="";return t&&(a=O$(t)?t.checked?"true":"false":t.value),t=a,t!==r?(s.setValue(t),!0):!1}function kj(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function R5(t,s){var r=s.checked;return cr({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function wI(t,s){var r=s.defaultValue==null?"":s.defaultValue,a=s.checked!=null?s.checked:s.defaultChecked;r=um(s.value!=null?s.value:r),t._wrapperState={initialChecked:a,initialValue:r,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function L$(t,s){s=s.checked,s!=null&&sE(t,"checked",s,!1)}function L5(t,s){L$(t,s);var r=um(s.value),a=s.type;if(r!=null)a==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(a==="submit"||a==="reset"){t.removeAttribute("value");return}s.hasOwnProperty("value")?F5(t,s.type,r):s.hasOwnProperty("defaultValue")&&F5(t,s.type,um(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(t.defaultChecked=!!s.defaultChecked)}function _I(t,s,r){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var a=s.type;if(!(a!=="submit"&&a!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+t._wrapperState.initialValue,r||s===t.value||(t.value=s),t.defaultValue=s}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function F5(t,s,r){(s!=="number"||kj(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Q0=Array.isArray;function kp(t,s,r,a){if(t=t.options,s){s={};for(var i=0;i<r.length;i++)s["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=s.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&a&&(t[r].defaultSelected=!0)}else{for(r=""+um(r),s=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,a&&(t[i].defaultSelected=!0);return}s!==null||t[i].disabled||(s=t[i])}s!==null&&(s.selected=!0)}}function B5(t,s){if(s.dangerouslySetInnerHTML!=null)throw Error(St(91));return cr({},s,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function SI(t,s){var r=s.value;if(r==null){if(r=s.children,s=s.defaultValue,r!=null){if(s!=null)throw Error(St(92));if(Q0(r)){if(1<r.length)throw Error(St(93));r=r[0]}s=r}s==null&&(s=""),r=s}t._wrapperState={initialValue:um(r)}}function F$(t,s){var r=um(s.value),a=um(s.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),s.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),a!=null&&(t.defaultValue=""+a)}function CI(t){var s=t.textContent;s===t._wrapperState.initialValue&&s!==""&&s!==null&&(t.value=s)}function B$(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $5(t,s){return t==null||t==="http://www.w3.org/1999/xhtml"?B$(s):t==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qy,$$=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,r,a,i){MSApp.execUnsafeLocalFunction(function(){return t(s,r,a,i)})}:t}(function(t,s){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=s;else{for(qy=qy||document.createElement("div"),qy.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=qy.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;s.firstChild;)t.appendChild(s.firstChild)}});function Lg(t,s){if(s){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=s;return}}t.textContent=s}var dg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_re=["Webkit","ms","Moz","O"];Object.keys(dg).forEach(function(t){_re.forEach(function(s){s=s+t.charAt(0).toUpperCase()+t.substring(1),dg[s]=dg[t]})});function z$(t,s,r){return s==null||typeof s=="boolean"||s===""?"":r||typeof s!="number"||s===0||dg.hasOwnProperty(t)&&dg[t]?(""+s).trim():s+"px"}function U$(t,s){t=t.style;for(var r in s)if(s.hasOwnProperty(r)){var a=r.indexOf("--")===0,i=z$(r,s[r],a);r==="float"&&(r="cssFloat"),a?t.setProperty(r,i):t[r]=i}}var Sre=cr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function z5(t,s){if(s){if(Sre[t]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(St(137,t));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(St(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(St(61))}if(s.style!=null&&typeof s.style!="object")throw Error(St(62))}}function U5(t,s){if(t.indexOf("-")===-1)return typeof s.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var V5=null;function iE(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var H5=null,Ap=null,Ep=null;function kI(t){if(t=Qb(t)){if(typeof H5!="function")throw Error(St(280));var s=t.stateNode;s&&(s=Bw(s),H5(t.stateNode,t.type,s))}}function V$(t){Ap?Ep?Ep.push(t):Ep=[t]:Ap=t}function H$(){if(Ap){var t=Ap,s=Ep;if(Ep=Ap=null,kI(t),s)for(t=0;t<s.length;t++)kI(s[t])}}function W$(t,s){return t(s)}function q$(){}var TS=!1;function G$(t,s,r){if(TS)return t(s,r);TS=!0;try{return W$(t,s,r)}finally{TS=!1,(Ap!==null||Ep!==null)&&(q$(),H$())}}function Fg(t,s){var r=t.stateNode;if(r===null)return null;var a=Bw(r);if(a===null)return null;r=a[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(t=t.type,a=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!a;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(St(231,s,typeof r));return r}var W5=!1;if(Vd)try{var a0={};Object.defineProperty(a0,"passive",{get:function(){W5=!0}}),window.addEventListener("test",a0,a0),window.removeEventListener("test",a0,a0)}catch{W5=!1}function Cre(t,s,r,a,i,l,o,c,d){var u=Array.prototype.slice.call(arguments,3);try{s.apply(r,u)}catch(m){this.onError(m)}}var ug=!1,Aj=null,Ej=!1,q5=null,kre={onError:function(t){ug=!0,Aj=t}};function Are(t,s,r,a,i,l,o,c,d){ug=!1,Aj=null,Cre.apply(kre,arguments)}function Ere(t,s,r,a,i,l,o,c,d){if(Are.apply(this,arguments),ug){if(ug){var u=Aj;ug=!1,Aj=null}else throw Error(St(198));Ej||(Ej=!0,q5=u)}}function ux(t){var s=t,r=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,s.flags&4098&&(r=s.return),t=s.return;while(t)}return s.tag===3?r:null}function K$(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function AI(t){if(ux(t)!==t)throw Error(St(188))}function Tre(t){var s=t.alternate;if(!s){if(s=ux(t),s===null)throw Error(St(188));return s!==t?null:t}for(var r=t,a=s;;){var i=r.return;if(i===null)break;var l=i.alternate;if(l===null){if(a=i.return,a!==null){r=a;continue}break}if(i.child===l.child){for(l=i.child;l;){if(l===r)return AI(i),t;if(l===a)return AI(i),s;l=l.sibling}throw Error(St(188))}if(r.return!==a.return)r=i,a=l;else{for(var o=!1,c=i.child;c;){if(c===r){o=!0,r=i,a=l;break}if(c===a){o=!0,a=i,r=l;break}c=c.sibling}if(!o){for(c=l.child;c;){if(c===r){o=!0,r=l,a=i;break}if(c===a){o=!0,a=l,r=i;break}c=c.sibling}if(!o)throw Error(St(189))}}if(r.alternate!==a)throw Error(St(190))}if(r.tag!==3)throw Error(St(188));return r.stateNode.current===r?t:s}function Y$(t){return t=Tre(t),t!==null?X$(t):null}function X$(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var s=X$(t);if(s!==null)return s;t=t.sibling}return null}var Q$=Vl.unstable_scheduleCallback,EI=Vl.unstable_cancelCallback,Pre=Vl.unstable_shouldYield,Dre=Vl.unstable_requestPaint,Tr=Vl.unstable_now,Mre=Vl.unstable_getCurrentPriorityLevel,lE=Vl.unstable_ImmediatePriority,Z$=Vl.unstable_UserBlockingPriority,Tj=Vl.unstable_NormalPriority,Ire=Vl.unstable_LowPriority,J$=Vl.unstable_IdlePriority,Ow=null,Qc=null;function Ore(t){if(Qc&&typeof Qc.onCommitFiberRoot=="function")try{Qc.onCommitFiberRoot(Ow,t,void 0,(t.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:Fre,Rre=Math.log,Lre=Math.LN2;function Fre(t){return t>>>=0,t===0?32:31-(Rre(t)/Lre|0)|0}var Gy=64,Ky=4194304;function Z0(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Pj(t,s){var r=t.pendingLanes;if(r===0)return 0;var a=0,i=t.suspendedLanes,l=t.pingedLanes,o=r&268435455;if(o!==0){var c=o&~i;c!==0?a=Z0(c):(l&=o,l!==0&&(a=Z0(l)))}else o=r&~i,o!==0?a=Z0(o):l!==0&&(a=Z0(l));if(a===0)return 0;if(s!==0&&s!==a&&!(s&i)&&(i=a&-a,l=s&-s,i>=l||i===16&&(l&4194240)!==0))return s;if(a&4&&(a|=r&16),s=t.entangledLanes,s!==0)for(t=t.entanglements,s&=a;0<s;)r=31-oc(s),i=1<<r,a|=t[r],s&=~i;return a}function Bre(t,s){switch(t){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $re(t,s){for(var r=t.suspendedLanes,a=t.pingedLanes,i=t.expirationTimes,l=t.pendingLanes;0<l;){var o=31-oc(l),c=1<<o,d=i[o];d===-1?(!(c&r)||c&a)&&(i[o]=Bre(c,s)):d<=s&&(t.expiredLanes|=c),l&=~c}}function G5(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ez(){var t=Gy;return Gy<<=1,!(Gy&4194240)&&(Gy=64),t}function PS(t){for(var s=[],r=0;31>r;r++)s.push(t);return s}function Yb(t,s,r){t.pendingLanes|=s,s!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,s=31-oc(s),t[s]=r}function zre(t,s){var r=t.pendingLanes&~s;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=s,t.mutableReadLanes&=s,t.entangledLanes&=s,s=t.entanglements;var a=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-oc(r),l=1<<i;s[i]=0,a[i]=-1,t[i]=-1,r&=~l}}function oE(t,s){var r=t.entangledLanes|=s;for(t=t.entanglements;r;){var a=31-oc(r),i=1<<a;i&s|t[a]&s&&(t[a]|=s),r&=~i}}var fn=0;function tz(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var sz,cE,nz,rz,az,K5=!1,Yy=[],Zu=null,Ju=null,em=null,Bg=new Map,$g=new Map,zu=[],Ure="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function TI(t,s){switch(t){case"focusin":case"focusout":Zu=null;break;case"dragenter":case"dragleave":Ju=null;break;case"mouseover":case"mouseout":em=null;break;case"pointerover":case"pointerout":Bg.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":$g.delete(s.pointerId)}}function i0(t,s,r,a,i,l){return t===null||t.nativeEvent!==l?(t={blockedOn:s,domEventName:r,eventSystemFlags:a,nativeEvent:l,targetContainers:[i]},s!==null&&(s=Qb(s),s!==null&&cE(s)),t):(t.eventSystemFlags|=a,s=t.targetContainers,i!==null&&s.indexOf(i)===-1&&s.push(i),t)}function Vre(t,s,r,a,i){switch(s){case"focusin":return Zu=i0(Zu,t,s,r,a,i),!0;case"dragenter":return Ju=i0(Ju,t,s,r,a,i),!0;case"mouseover":return em=i0(em,t,s,r,a,i),!0;case"pointerover":var l=i.pointerId;return Bg.set(l,i0(Bg.get(l)||null,t,s,r,a,i)),!0;case"gotpointercapture":return l=i.pointerId,$g.set(l,i0($g.get(l)||null,t,s,r,a,i)),!0}return!1}function iz(t){var s=sh(t.target);if(s!==null){var r=ux(s);if(r!==null){if(s=r.tag,s===13){if(s=K$(r),s!==null){t.blockedOn=s,az(t.priority,function(){nz(r)});return}}else if(s===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Hv(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var r=Y5(t.domEventName,t.eventSystemFlags,s[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var a=new r.constructor(r.type,r);V5=a,r.target.dispatchEvent(a),V5=null}else return s=Qb(r),s!==null&&cE(s),t.blockedOn=r,!1;s.shift()}return!0}function PI(t,s,r){Hv(t)&&r.delete(s)}function Hre(){K5=!1,Zu!==null&&Hv(Zu)&&(Zu=null),Ju!==null&&Hv(Ju)&&(Ju=null),em!==null&&Hv(em)&&(em=null),Bg.forEach(PI),$g.forEach(PI)}function l0(t,s){t.blockedOn===s&&(t.blockedOn=null,K5||(K5=!0,Vl.unstable_scheduleCallback(Vl.unstable_NormalPriority,Hre)))}function zg(t){function s(i){return l0(i,t)}if(0<Yy.length){l0(Yy[0],t);for(var r=1;r<Yy.length;r++){var a=Yy[r];a.blockedOn===t&&(a.blockedOn=null)}}for(Zu!==null&&l0(Zu,t),Ju!==null&&l0(Ju,t),em!==null&&l0(em,t),Bg.forEach(s),$g.forEach(s),r=0;r<zu.length;r++)a=zu[r],a.blockedOn===t&&(a.blockedOn=null);for(;0<zu.length&&(r=zu[0],r.blockedOn===null);)iz(r),r.blockedOn===null&&zu.shift()}var Tp=ru.ReactCurrentBatchConfig,Dj=!0;function Wre(t,s,r,a){var i=fn,l=Tp.transition;Tp.transition=null;try{fn=1,dE(t,s,r,a)}finally{fn=i,Tp.transition=l}}function qre(t,s,r,a){var i=fn,l=Tp.transition;Tp.transition=null;try{fn=4,dE(t,s,r,a)}finally{fn=i,Tp.transition=l}}function dE(t,s,r,a){if(Dj){var i=Y5(t,s,r,a);if(i===null)zS(t,s,a,Mj,r),TI(t,a);else if(Vre(i,t,s,r,a))a.stopPropagation();else if(TI(t,a),s&4&&-1<Ure.indexOf(t)){for(;i!==null;){var l=Qb(i);if(l!==null&&sz(l),l=Y5(t,s,r,a),l===null&&zS(t,s,a,Mj,r),l===i)break;i=l}i!==null&&a.stopPropagation()}else zS(t,s,a,null,r)}}var Mj=null;function Y5(t,s,r,a){if(Mj=null,t=iE(a),t=sh(t),t!==null)if(s=ux(t),s===null)t=null;else if(r=s.tag,r===13){if(t=K$(s),t!==null)return t;t=null}else if(r===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null);return Mj=t,null}function lz(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mre()){case lE:return 1;case Z$:return 4;case Tj:case Ire:return 16;case J$:return 536870912;default:return 16}default:return 16}}var Wu=null,uE=null,Wv=null;function oz(){if(Wv)return Wv;var t,s=uE,r=s.length,a,i="value"in Wu?Wu.value:Wu.textContent,l=i.length;for(t=0;t<r&&s[t]===i[t];t++);var o=r-t;for(a=1;a<=o&&s[r-a]===i[l-a];a++);return Wv=i.slice(t,1<a?1-a:void 0)}function qv(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Xy(){return!0}function DI(){return!1}function Yl(t){function s(r,a,i,l,o){this._reactName=r,this._targetInst=i,this.type=a,this.nativeEvent=l,this.target=o,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(r=t[c],this[c]=r?r(l):l[c]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Xy:DI,this.isPropagationStopped=DI,this}return cr(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Xy)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Xy)},persist:function(){},isPersistent:Xy}),s}var bf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mE=Yl(bf),Xb=cr({},bf,{view:0,detail:0}),Gre=Yl(Xb),DS,MS,o0,Rw=cr({},Xb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hE,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==o0&&(o0&&t.type==="mousemove"?(DS=t.screenX-o0.screenX,MS=t.screenY-o0.screenY):MS=DS=0,o0=t),DS)},movementY:function(t){return"movementY"in t?t.movementY:MS}}),MI=Yl(Rw),Kre=cr({},Rw,{dataTransfer:0}),Yre=Yl(Kre),Xre=cr({},Xb,{relatedTarget:0}),IS=Yl(Xre),Qre=cr({},bf,{animationName:0,elapsedTime:0,pseudoElement:0}),Zre=Yl(Qre),Jre=cr({},bf,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),eae=Yl(Jre),tae=cr({},bf,{data:0}),II=Yl(tae),sae={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nae={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aae(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=rae[t])?!!s[t]:!1}function hE(){return aae}var iae=cr({},Xb,{key:function(t){if(t.key){var s=sae[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=qv(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?nae[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hE,charCode:function(t){return t.type==="keypress"?qv(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?qv(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),lae=Yl(iae),oae=cr({},Rw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),OI=Yl(oae),cae=cr({},Xb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hE}),dae=Yl(cae),uae=cr({},bf,{propertyName:0,elapsedTime:0,pseudoElement:0}),mae=Yl(uae),hae=cr({},Rw,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),xae=Yl(hae),pae=[9,13,27,32],xE=Vd&&"CompositionEvent"in window,mg=null;Vd&&"documentMode"in document&&(mg=document.documentMode);var fae=Vd&&"TextEvent"in window&&!mg,cz=Vd&&(!xE||mg&&8<mg&&11>=mg),RI=" ",LI=!1;function dz(t,s){switch(t){case"keyup":return pae.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uz(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var rp=!1;function gae(t,s){switch(t){case"compositionend":return uz(s);case"keypress":return s.which!==32?null:(LI=!0,RI);case"textInput":return t=s.data,t===RI&&LI?null:t;default:return null}}function bae(t,s){if(rp)return t==="compositionend"||!xE&&dz(t,s)?(t=oz(),Wv=uE=Wu=null,rp=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return cz&&s.locale!=="ko"?null:s.data;default:return null}}var yae={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function FI(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!yae[t.type]:s==="textarea"}function mz(t,s,r,a){V$(a),s=Ij(s,"onChange"),0<s.length&&(r=new mE("onChange","change",null,r,a),t.push({event:r,listeners:s}))}var hg=null,Ug=null;function vae(t){wz(t,0)}function Lw(t){var s=lp(t);if(R$(s))return t}function jae(t,s){if(t==="change")return s}var hz=!1;if(Vd){var OS;if(Vd){var RS="oninput"in document;if(!RS){var BI=document.createElement("div");BI.setAttribute("oninput","return;"),RS=typeof BI.oninput=="function"}OS=RS}else OS=!1;hz=OS&&(!document.documentMode||9<document.documentMode)}function $I(){hg&&(hg.detachEvent("onpropertychange",xz),Ug=hg=null)}function xz(t){if(t.propertyName==="value"&&Lw(Ug)){var s=[];mz(s,Ug,t,iE(t)),G$(vae,s)}}function Nae(t,s,r){t==="focusin"?($I(),hg=s,Ug=r,hg.attachEvent("onpropertychange",xz)):t==="focusout"&&$I()}function wae(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Lw(Ug)}function _ae(t,s){if(t==="click")return Lw(s)}function Sae(t,s){if(t==="input"||t==="change")return Lw(s)}function Cae(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var dc=typeof Object.is=="function"?Object.is:Cae;function Vg(t,s){if(dc(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var r=Object.keys(t),a=Object.keys(s);if(r.length!==a.length)return!1;for(a=0;a<r.length;a++){var i=r[a];if(!P5.call(s,i)||!dc(t[i],s[i]))return!1}return!0}function zI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function UI(t,s){var r=zI(t);t=0;for(var a;r;){if(r.nodeType===3){if(a=t+r.textContent.length,t<=s&&a>=s)return{node:r,offset:s-t};t=a}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=zI(r)}}function pz(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?pz(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function fz(){for(var t=window,s=kj();s instanceof t.HTMLIFrameElement;){try{var r=typeof s.contentWindow.location.href=="string"}catch{r=!1}if(r)t=s.contentWindow;else break;s=kj(t.document)}return s}function pE(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}function kae(t){var s=fz(),r=t.focusedElem,a=t.selectionRange;if(s!==r&&r&&r.ownerDocument&&pz(r.ownerDocument.documentElement,r)){if(a!==null&&pE(r)){if(s=a.start,t=a.end,t===void 0&&(t=s),"selectionStart"in r)r.selectionStart=s,r.selectionEnd=Math.min(t,r.value.length);else if(t=(s=r.ownerDocument||document)&&s.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,l=Math.min(a.start,i);a=a.end===void 0?l:Math.min(a.end,i),!t.extend&&l>a&&(i=a,a=l,l=i),i=UI(r,l);var o=UI(r,a);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(s=s.createRange(),s.setStart(i.node,i.offset),t.removeAllRanges(),l>a?(t.addRange(s),t.extend(o.node,o.offset)):(s.setEnd(o.node,o.offset),t.addRange(s)))}}for(s=[],t=r;t=t.parentNode;)t.nodeType===1&&s.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<s.length;r++)t=s[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Aae=Vd&&"documentMode"in document&&11>=document.documentMode,ap=null,X5=null,xg=null,Q5=!1;function VI(t,s,r){var a=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Q5||ap==null||ap!==kj(a)||(a=ap,"selectionStart"in a&&pE(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),xg&&Vg(xg,a)||(xg=a,a=Ij(X5,"onSelect"),0<a.length&&(s=new mE("onSelect","select",null,s,r),t.push({event:s,listeners:a}),s.target=ap)))}function Qy(t,s){var r={};return r[t.toLowerCase()]=s.toLowerCase(),r["Webkit"+t]="webkit"+s,r["Moz"+t]="moz"+s,r}var ip={animationend:Qy("Animation","AnimationEnd"),animationiteration:Qy("Animation","AnimationIteration"),animationstart:Qy("Animation","AnimationStart"),transitionend:Qy("Transition","TransitionEnd")},LS={},gz={};Vd&&(gz=document.createElement("div").style,"AnimationEvent"in window||(delete ip.animationend.animation,delete ip.animationiteration.animation,delete ip.animationstart.animation),"TransitionEvent"in window||delete ip.transitionend.transition);function Fw(t){if(LS[t])return LS[t];if(!ip[t])return t;var s=ip[t],r;for(r in s)if(s.hasOwnProperty(r)&&r in gz)return LS[t]=s[r];return t}var bz=Fw("animationend"),yz=Fw("animationiteration"),vz=Fw("animationstart"),jz=Fw("transitionend"),Nz=new Map,HI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nm(t,s){Nz.set(t,s),dx(s,[t])}for(var FS=0;FS<HI.length;FS++){var BS=HI[FS],Eae=BS.toLowerCase(),Tae=BS[0].toUpperCase()+BS.slice(1);Nm(Eae,"on"+Tae)}Nm(bz,"onAnimationEnd");Nm(yz,"onAnimationIteration");Nm(vz,"onAnimationStart");Nm("dblclick","onDoubleClick");Nm("focusin","onFocus");Nm("focusout","onBlur");Nm(jz,"onTransitionEnd");zp("onMouseEnter",["mouseout","mouseover"]);zp("onMouseLeave",["mouseout","mouseover"]);zp("onPointerEnter",["pointerout","pointerover"]);zp("onPointerLeave",["pointerout","pointerover"]);dx("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));dx("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));dx("onBeforeInput",["compositionend","keypress","textInput","paste"]);dx("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));dx("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));dx("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var J0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pae=new Set("cancel close invalid load scroll toggle".split(" ").concat(J0));function WI(t,s,r){var a=t.type||"unknown-event";t.currentTarget=r,Ere(a,s,void 0,t),t.currentTarget=null}function wz(t,s){s=(s&4)!==0;for(var r=0;r<t.length;r++){var a=t[r],i=a.event;a=a.listeners;e:{var l=void 0;if(s)for(var o=a.length-1;0<=o;o--){var c=a[o],d=c.instance,u=c.currentTarget;if(c=c.listener,d!==l&&i.isPropagationStopped())break e;WI(i,c,u),l=d}else for(o=0;o<a.length;o++){if(c=a[o],d=c.instance,u=c.currentTarget,c=c.listener,d!==l&&i.isPropagationStopped())break e;WI(i,c,u),l=d}}}if(Ej)throw t=q5,Ej=!1,q5=null,t}function On(t,s){var r=s[s3];r===void 0&&(r=s[s3]=new Set);var a=t+"__bubble";r.has(a)||(_z(s,t,2,!1),r.add(a))}function $S(t,s,r){var a=0;s&&(a|=4),_z(r,t,a,s)}var Zy="_reactListening"+Math.random().toString(36).slice(2);function Hg(t){if(!t[Zy]){t[Zy]=!0,P$.forEach(function(r){r!=="selectionchange"&&(Pae.has(r)||$S(r,!1,t),$S(r,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[Zy]||(s[Zy]=!0,$S("selectionchange",!1,s))}}function _z(t,s,r,a){switch(lz(s)){case 1:var i=Wre;break;case 4:i=qre;break;default:i=dE}r=i.bind(null,s,r,t),i=void 0,!W5||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(i=!0),a?i!==void 0?t.addEventListener(s,r,{capture:!0,passive:i}):t.addEventListener(s,r,!0):i!==void 0?t.addEventListener(s,r,{passive:i}):t.addEventListener(s,r,!1)}function zS(t,s,r,a,i){var l=a;if(!(s&1)&&!(s&2)&&a!==null)e:for(;;){if(a===null)return;var o=a.tag;if(o===3||o===4){var c=a.stateNode.containerInfo;if(c===i||c.nodeType===8&&c.parentNode===i)break;if(o===4)for(o=a.return;o!==null;){var d=o.tag;if((d===3||d===4)&&(d=o.stateNode.containerInfo,d===i||d.nodeType===8&&d.parentNode===i))return;o=o.return}for(;c!==null;){if(o=sh(c),o===null)return;if(d=o.tag,d===5||d===6){a=l=o;continue e}c=c.parentNode}}a=a.return}G$(function(){var u=l,m=iE(r),x=[];e:{var g=Nz.get(t);if(g!==void 0){var y=mE,v=t;switch(t){case"keypress":if(qv(r)===0)break e;case"keydown":case"keyup":y=lae;break;case"focusin":v="focus",y=IS;break;case"focusout":v="blur",y=IS;break;case"beforeblur":case"afterblur":y=IS;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=MI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=Yre;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=dae;break;case bz:case yz:case vz:y=Zre;break;case jz:y=mae;break;case"scroll":y=Gre;break;case"wheel":y=xae;break;case"copy":case"cut":case"paste":y=eae;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=OI}var j=(s&4)!==0,w=!j&&t==="scroll",S=j?g!==null?g+"Capture":null:g;j=[];for(var E=u,k;E!==null;){k=E;var A=k.stateNode;if(k.tag===5&&A!==null&&(k=A,S!==null&&(A=Fg(E,S),A!=null&&j.push(Wg(E,A,k)))),w)break;E=E.return}0<j.length&&(g=new y(g,v,null,r,m),x.push({event:g,listeners:j}))}}if(!(s&7)){e:{if(g=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",g&&r!==V5&&(v=r.relatedTarget||r.fromElement)&&(sh(v)||v[Hd]))break e;if((y||g)&&(g=m.window===m?m:(g=m.ownerDocument)?g.defaultView||g.parentWindow:window,y?(v=r.relatedTarget||r.toElement,y=u,v=v?sh(v):null,v!==null&&(w=ux(v),v!==w||v.tag!==5&&v.tag!==6)&&(v=null)):(y=null,v=u),y!==v)){if(j=MI,A="onMouseLeave",S="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(j=OI,A="onPointerLeave",S="onPointerEnter",E="pointer"),w=y==null?g:lp(y),k=v==null?g:lp(v),g=new j(A,E+"leave",y,r,m),g.target=w,g.relatedTarget=k,A=null,sh(m)===u&&(j=new j(S,E+"enter",v,r,m),j.target=k,j.relatedTarget=w,A=j),w=A,y&&v)t:{for(j=y,S=v,E=0,k=j;k;k=Ex(k))E++;for(k=0,A=S;A;A=Ex(A))k++;for(;0<E-k;)j=Ex(j),E--;for(;0<k-E;)S=Ex(S),k--;for(;E--;){if(j===S||S!==null&&j===S.alternate)break t;j=Ex(j),S=Ex(S)}j=null}else j=null;y!==null&&qI(x,g,y,j,!1),v!==null&&w!==null&&qI(x,w,v,j,!0)}}e:{if(g=u?lp(u):window,y=g.nodeName&&g.nodeName.toLowerCase(),y==="select"||y==="input"&&g.type==="file")var I=jae;else if(FI(g))if(hz)I=Sae;else{I=wae;var P=Nae}else(y=g.nodeName)&&y.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(I=_ae);if(I&&(I=I(t,u))){mz(x,I,r,m);break e}P&&P(t,g,u),t==="focusout"&&(P=g._wrapperState)&&P.controlled&&g.type==="number"&&F5(g,"number",g.value)}switch(P=u?lp(u):window,t){case"focusin":(FI(P)||P.contentEditable==="true")&&(ap=P,X5=u,xg=null);break;case"focusout":xg=X5=ap=null;break;case"mousedown":Q5=!0;break;case"contextmenu":case"mouseup":case"dragend":Q5=!1,VI(x,r,m);break;case"selectionchange":if(Aae)break;case"keydown":case"keyup":VI(x,r,m)}var O;if(xE)e:{switch(t){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else rp?dz(t,r)&&(D="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(D="onCompositionStart");D&&(cz&&r.locale!=="ko"&&(rp||D!=="onCompositionStart"?D==="onCompositionEnd"&&rp&&(O=oz()):(Wu=m,uE="value"in Wu?Wu.value:Wu.textContent,rp=!0)),P=Ij(u,D),0<P.length&&(D=new II(D,t,null,r,m),x.push({event:D,listeners:P}),O?D.data=O:(O=uz(r),O!==null&&(D.data=O)))),(O=fae?gae(t,r):bae(t,r))&&(u=Ij(u,"onBeforeInput"),0<u.length&&(m=new II("onBeforeInput","beforeinput",null,r,m),x.push({event:m,listeners:u}),m.data=O))}wz(x,s)})}function Wg(t,s,r){return{instance:t,listener:s,currentTarget:r}}function Ij(t,s){for(var r=s+"Capture",a=[];t!==null;){var i=t,l=i.stateNode;i.tag===5&&l!==null&&(i=l,l=Fg(t,r),l!=null&&a.unshift(Wg(t,l,i)),l=Fg(t,s),l!=null&&a.push(Wg(t,l,i))),t=t.return}return a}function Ex(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function qI(t,s,r,a,i){for(var l=s._reactName,o=[];r!==null&&r!==a;){var c=r,d=c.alternate,u=c.stateNode;if(d!==null&&d===a)break;c.tag===5&&u!==null&&(c=u,i?(d=Fg(r,l),d!=null&&o.unshift(Wg(r,d,c))):i||(d=Fg(r,l),d!=null&&o.push(Wg(r,d,c)))),r=r.return}o.length!==0&&t.push({event:s,listeners:o})}var Dae=/\r\n?/g,Mae=/\u0000|\uFFFD/g;function GI(t){return(typeof t=="string"?t:""+t).replace(Dae,`
`).replace(Mae,"")}function Jy(t,s,r){if(s=GI(s),GI(t)!==s&&r)throw Error(St(425))}function Oj(){}var Z5=null,J5=null;function e3(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var t3=typeof setTimeout=="function"?setTimeout:void 0,Iae=typeof clearTimeout=="function"?clearTimeout:void 0,KI=typeof Promise=="function"?Promise:void 0,Oae=typeof queueMicrotask=="function"?queueMicrotask:typeof KI<"u"?function(t){return KI.resolve(null).then(t).catch(Rae)}:t3;function Rae(t){setTimeout(function(){throw t})}function US(t,s){var r=s,a=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(a===0){t.removeChild(i),zg(s);return}a--}else r!=="$"&&r!=="$?"&&r!=="$!"||a++;r=i}while(r);zg(s)}function tm(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return t}function YI(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(s===0)return t;s--}else r==="/$"&&s++}t=t.previousSibling}return null}var yf=Math.random().toString(36).slice(2),zc="__reactFiber$"+yf,qg="__reactProps$"+yf,Hd="__reactContainer$"+yf,s3="__reactEvents$"+yf,Lae="__reactListeners$"+yf,Fae="__reactHandles$"+yf;function sh(t){var s=t[zc];if(s)return s;for(var r=t.parentNode;r;){if(s=r[Hd]||r[zc]){if(r=s.alternate,s.child!==null||r!==null&&r.child!==null)for(t=YI(t);t!==null;){if(r=t[zc])return r;t=YI(t)}return s}t=r,r=t.parentNode}return null}function Qb(t){return t=t[zc]||t[Hd],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function lp(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(St(33))}function Bw(t){return t[qg]||null}var n3=[],op=-1;function wm(t){return{current:t}}function Bn(t){0>op||(t.current=n3[op],n3[op]=null,op--)}function En(t,s){op++,n3[op]=t.current,t.current=s}var mm={},ui=wm(mm),rl=wm(!1),Fh=mm;function Up(t,s){var r=t.type.contextTypes;if(!r)return mm;var a=t.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===s)return a.__reactInternalMemoizedMaskedChildContext;var i={},l;for(l in r)i[l]=s[l];return a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),i}function al(t){return t=t.childContextTypes,t!=null}function Rj(){Bn(rl),Bn(ui)}function XI(t,s,r){if(ui.current!==mm)throw Error(St(168));En(ui,s),En(rl,r)}function Sz(t,s,r){var a=t.stateNode;if(s=s.childContextTypes,typeof a.getChildContext!="function")return r;a=a.getChildContext();for(var i in a)if(!(i in s))throw Error(St(108,Nre(t)||"Unknown",i));return cr({},r,a)}function Lj(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||mm,Fh=ui.current,En(ui,t),En(rl,rl.current),!0}function QI(t,s,r){var a=t.stateNode;if(!a)throw Error(St(169));r?(t=Sz(t,s,Fh),a.__reactInternalMemoizedMergedChildContext=t,Bn(rl),Bn(ui),En(ui,t)):Bn(rl),En(rl,r)}var Td=null,$w=!1,VS=!1;function Cz(t){Td===null?Td=[t]:Td.push(t)}function Bae(t){$w=!0,Cz(t)}function _m(){if(!VS&&Td!==null){VS=!0;var t=0,s=fn;try{var r=Td;for(fn=1;t<r.length;t++){var a=r[t];do a=a(!0);while(a!==null)}Td=null,$w=!1}catch(i){throw Td!==null&&(Td=Td.slice(t+1)),Q$(lE,_m),i}finally{fn=s,VS=!1}}return null}var cp=[],dp=0,Fj=null,Bj=0,fo=[],go=0,Bh=null,Od=1,Rd="";function Km(t,s){cp[dp++]=Bj,cp[dp++]=Fj,Fj=t,Bj=s}function kz(t,s,r){fo[go++]=Od,fo[go++]=Rd,fo[go++]=Bh,Bh=t;var a=Od;t=Rd;var i=32-oc(a)-1;a&=~(1<<i),r+=1;var l=32-oc(s)+i;if(30<l){var o=i-i%5;l=(a&(1<<o)-1).toString(32),a>>=o,i-=o,Od=1<<32-oc(s)+i|r<<i|a,Rd=l+t}else Od=1<<l|r<<i|a,Rd=t}function fE(t){t.return!==null&&(Km(t,1),kz(t,1,0))}function gE(t){for(;t===Fj;)Fj=cp[--dp],cp[dp]=null,Bj=cp[--dp],cp[dp]=null;for(;t===Bh;)Bh=fo[--go],fo[go]=null,Rd=fo[--go],fo[go]=null,Od=fo[--go],fo[go]=null}var Bl=null,Rl=null,Hn=!1,Jo=null;function Az(t,s){var r=vo(5,null,null,0);r.elementType="DELETED",r.stateNode=s,r.return=t,s=t.deletions,s===null?(t.deletions=[r],t.flags|=16):s.push(r)}function ZI(t,s){switch(t.tag){case 5:var r=t.type;return s=s.nodeType!==1||r.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(t.stateNode=s,Bl=t,Rl=tm(s.firstChild),!0):!1;case 6:return s=t.pendingProps===""||s.nodeType!==3?null:s,s!==null?(t.stateNode=s,Bl=t,Rl=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(r=Bh!==null?{id:Od,overflow:Rd}:null,t.memoizedState={dehydrated:s,treeContext:r,retryLane:1073741824},r=vo(18,null,null,0),r.stateNode=s,r.return=t,t.child=r,Bl=t,Rl=null,!0):!1;default:return!1}}function r3(t){return(t.mode&1)!==0&&(t.flags&128)===0}function a3(t){if(Hn){var s=Rl;if(s){var r=s;if(!ZI(t,s)){if(r3(t))throw Error(St(418));s=tm(r.nextSibling);var a=Bl;s&&ZI(t,s)?Az(a,r):(t.flags=t.flags&-4097|2,Hn=!1,Bl=t)}}else{if(r3(t))throw Error(St(418));t.flags=t.flags&-4097|2,Hn=!1,Bl=t}}}function JI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Bl=t}function e1(t){if(t!==Bl)return!1;if(!Hn)return JI(t),Hn=!0,!1;var s;if((s=t.tag!==3)&&!(s=t.tag!==5)&&(s=t.type,s=s!=="head"&&s!=="body"&&!e3(t.type,t.memoizedProps)),s&&(s=Rl)){if(r3(t))throw Ez(),Error(St(418));for(;s;)Az(t,s),s=tm(s.nextSibling)}if(JI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(St(317));e:{for(t=t.nextSibling,s=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(s===0){Rl=tm(t.nextSibling);break e}s--}else r!=="$"&&r!=="$!"&&r!=="$?"||s++}t=t.nextSibling}Rl=null}}else Rl=Bl?tm(t.stateNode.nextSibling):null;return!0}function Ez(){for(var t=Rl;t;)t=tm(t.nextSibling)}function Vp(){Rl=Bl=null,Hn=!1}function bE(t){Jo===null?Jo=[t]:Jo.push(t)}var $ae=ru.ReactCurrentBatchConfig;function c0(t,s,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(St(309));var a=r.stateNode}if(!a)throw Error(St(147,t));var i=a,l=""+t;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===l?s.ref:(s=function(o){var c=i.refs;o===null?delete c[l]:c[l]=o},s._stringRef=l,s)}if(typeof t!="string")throw Error(St(284));if(!r._owner)throw Error(St(290,t))}return t}function t1(t,s){throw t=Object.prototype.toString.call(s),Error(St(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t))}function eO(t){var s=t._init;return s(t._payload)}function Tz(t){function s(S,E){if(t){var k=S.deletions;k===null?(S.deletions=[E],S.flags|=16):k.push(E)}}function r(S,E){if(!t)return null;for(;E!==null;)s(S,E),E=E.sibling;return null}function a(S,E){for(S=new Map;E!==null;)E.key!==null?S.set(E.key,E):S.set(E.index,E),E=E.sibling;return S}function i(S,E){return S=am(S,E),S.index=0,S.sibling=null,S}function l(S,E,k){return S.index=k,t?(k=S.alternate,k!==null?(k=k.index,k<E?(S.flags|=2,E):k):(S.flags|=2,E)):(S.flags|=1048576,E)}function o(S){return t&&S.alternate===null&&(S.flags|=2),S}function c(S,E,k,A){return E===null||E.tag!==6?(E=XS(k,S.mode,A),E.return=S,E):(E=i(E,k),E.return=S,E)}function d(S,E,k,A){var I=k.type;return I===np?m(S,E,k.props.children,A,k.key):E!==null&&(E.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Ou&&eO(I)===E.type)?(A=i(E,k.props),A.ref=c0(S,E,k),A.return=S,A):(A=Jv(k.type,k.key,k.props,null,S.mode,A),A.ref=c0(S,E,k),A.return=S,A)}function u(S,E,k,A){return E===null||E.tag!==4||E.stateNode.containerInfo!==k.containerInfo||E.stateNode.implementation!==k.implementation?(E=QS(k,S.mode,A),E.return=S,E):(E=i(E,k.children||[]),E.return=S,E)}function m(S,E,k,A,I){return E===null||E.tag!==7?(E=gh(k,S.mode,A,I),E.return=S,E):(E=i(E,k),E.return=S,E)}function x(S,E,k){if(typeof E=="string"&&E!==""||typeof E=="number")return E=XS(""+E,S.mode,k),E.return=S,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Hy:return k=Jv(E.type,E.key,E.props,null,S.mode,k),k.ref=c0(S,null,E),k.return=S,k;case sp:return E=QS(E,S.mode,k),E.return=S,E;case Ou:var A=E._init;return x(S,A(E._payload),k)}if(Q0(E)||r0(E))return E=gh(E,S.mode,k,null),E.return=S,E;t1(S,E)}return null}function g(S,E,k,A){var I=E!==null?E.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return I!==null?null:c(S,E,""+k,A);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Hy:return k.key===I?d(S,E,k,A):null;case sp:return k.key===I?u(S,E,k,A):null;case Ou:return I=k._init,g(S,E,I(k._payload),A)}if(Q0(k)||r0(k))return I!==null?null:m(S,E,k,A,null);t1(S,k)}return null}function y(S,E,k,A,I){if(typeof A=="string"&&A!==""||typeof A=="number")return S=S.get(k)||null,c(E,S,""+A,I);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Hy:return S=S.get(A.key===null?k:A.key)||null,d(E,S,A,I);case sp:return S=S.get(A.key===null?k:A.key)||null,u(E,S,A,I);case Ou:var P=A._init;return y(S,E,k,P(A._payload),I)}if(Q0(A)||r0(A))return S=S.get(k)||null,m(E,S,A,I,null);t1(E,A)}return null}function v(S,E,k,A){for(var I=null,P=null,O=E,D=E=0,T=null;O!==null&&D<k.length;D++){O.index>D?(T=O,O=null):T=O.sibling;var B=g(S,O,k[D],A);if(B===null){O===null&&(O=T);break}t&&O&&B.alternate===null&&s(S,O),E=l(B,E,D),P===null?I=B:P.sibling=B,P=B,O=T}if(D===k.length)return r(S,O),Hn&&Km(S,D),I;if(O===null){for(;D<k.length;D++)O=x(S,k[D],A),O!==null&&(E=l(O,E,D),P===null?I=O:P.sibling=O,P=O);return Hn&&Km(S,D),I}for(O=a(S,O);D<k.length;D++)T=y(O,S,D,k[D],A),T!==null&&(t&&T.alternate!==null&&O.delete(T.key===null?D:T.key),E=l(T,E,D),P===null?I=T:P.sibling=T,P=T);return t&&O.forEach(function(U){return s(S,U)}),Hn&&Km(S,D),I}function j(S,E,k,A){var I=r0(k);if(typeof I!="function")throw Error(St(150));if(k=I.call(k),k==null)throw Error(St(151));for(var P=I=null,O=E,D=E=0,T=null,B=k.next();O!==null&&!B.done;D++,B=k.next()){O.index>D?(T=O,O=null):T=O.sibling;var U=g(S,O,B.value,A);if(U===null){O===null&&(O=T);break}t&&O&&U.alternate===null&&s(S,O),E=l(U,E,D),P===null?I=U:P.sibling=U,P=U,O=T}if(B.done)return r(S,O),Hn&&Km(S,D),I;if(O===null){for(;!B.done;D++,B=k.next())B=x(S,B.value,A),B!==null&&(E=l(B,E,D),P===null?I=B:P.sibling=B,P=B);return Hn&&Km(S,D),I}for(O=a(S,O);!B.done;D++,B=k.next())B=y(O,S,D,B.value,A),B!==null&&(t&&B.alternate!==null&&O.delete(B.key===null?D:B.key),E=l(B,E,D),P===null?I=B:P.sibling=B,P=B);return t&&O.forEach(function(W){return s(S,W)}),Hn&&Km(S,D),I}function w(S,E,k,A){if(typeof k=="object"&&k!==null&&k.type===np&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case Hy:e:{for(var I=k.key,P=E;P!==null;){if(P.key===I){if(I=k.type,I===np){if(P.tag===7){r(S,P.sibling),E=i(P,k.props.children),E.return=S,S=E;break e}}else if(P.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Ou&&eO(I)===P.type){r(S,P.sibling),E=i(P,k.props),E.ref=c0(S,P,k),E.return=S,S=E;break e}r(S,P);break}else s(S,P);P=P.sibling}k.type===np?(E=gh(k.props.children,S.mode,A,k.key),E.return=S,S=E):(A=Jv(k.type,k.key,k.props,null,S.mode,A),A.ref=c0(S,E,k),A.return=S,S=A)}return o(S);case sp:e:{for(P=k.key;E!==null;){if(E.key===P)if(E.tag===4&&E.stateNode.containerInfo===k.containerInfo&&E.stateNode.implementation===k.implementation){r(S,E.sibling),E=i(E,k.children||[]),E.return=S,S=E;break e}else{r(S,E);break}else s(S,E);E=E.sibling}E=QS(k,S.mode,A),E.return=S,S=E}return o(S);case Ou:return P=k._init,w(S,E,P(k._payload),A)}if(Q0(k))return v(S,E,k,A);if(r0(k))return j(S,E,k,A);t1(S,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,E!==null&&E.tag===6?(r(S,E.sibling),E=i(E,k),E.return=S,S=E):(r(S,E),E=XS(k,S.mode,A),E.return=S,S=E),o(S)):r(S,E)}return w}var Hp=Tz(!0),Pz=Tz(!1),$j=wm(null),zj=null,up=null,yE=null;function vE(){yE=up=zj=null}function jE(t){var s=$j.current;Bn($j),t._currentValue=s}function i3(t,s,r){for(;t!==null;){var a=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,a!==null&&(a.childLanes|=s)):a!==null&&(a.childLanes&s)!==s&&(a.childLanes|=s),t===r)break;t=t.return}}function Pp(t,s){zj=t,yE=up=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&s&&(Ji=!0),t.firstContext=null)}function To(t){var s=t._currentValue;if(yE!==t)if(t={context:t,memoizedValue:s,next:null},up===null){if(zj===null)throw Error(St(308));up=t,zj.dependencies={lanes:0,firstContext:t}}else up=up.next=t;return s}var nh=null;function NE(t){nh===null?nh=[t]:nh.push(t)}function Dz(t,s,r,a){var i=s.interleaved;return i===null?(r.next=r,NE(s)):(r.next=i.next,i.next=r),s.interleaved=r,Wd(t,a)}function Wd(t,s){t.lanes|=s;var r=t.alternate;for(r!==null&&(r.lanes|=s),r=t,t=t.return;t!==null;)t.childLanes|=s,r=t.alternate,r!==null&&(r.childLanes|=s),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Ru=!1;function wE(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mz(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $d(t,s){return{eventTime:t,lane:s,tag:0,payload:null,callback:null,next:null}}function sm(t,s,r){var a=t.updateQueue;if(a===null)return null;if(a=a.shared,Xs&2){var i=a.pending;return i===null?s.next=s:(s.next=i.next,i.next=s),a.pending=s,Wd(t,r)}return i=a.interleaved,i===null?(s.next=s,NE(a)):(s.next=i.next,i.next=s),a.interleaved=s,Wd(t,r)}function Gv(t,s,r){if(s=s.updateQueue,s!==null&&(s=s.shared,(r&4194240)!==0)){var a=s.lanes;a&=t.pendingLanes,r|=a,s.lanes=r,oE(t,r)}}function tO(t,s){var r=t.updateQueue,a=t.alternate;if(a!==null&&(a=a.updateQueue,r===a)){var i=null,l=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};l===null?i=l=o:l=l.next=o,r=r.next}while(r!==null);l===null?i=l=s:l=l.next=s}else i=l=s;r={baseState:a.baseState,firstBaseUpdate:i,lastBaseUpdate:l,shared:a.shared,effects:a.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=s:t.next=s,r.lastBaseUpdate=s}function Uj(t,s,r,a){var i=t.updateQueue;Ru=!1;var l=i.firstBaseUpdate,o=i.lastBaseUpdate,c=i.shared.pending;if(c!==null){i.shared.pending=null;var d=c,u=d.next;d.next=null,o===null?l=u:o.next=u,o=d;var m=t.alternate;m!==null&&(m=m.updateQueue,c=m.lastBaseUpdate,c!==o&&(c===null?m.firstBaseUpdate=u:c.next=u,m.lastBaseUpdate=d))}if(l!==null){var x=i.baseState;o=0,m=u=d=null,c=l;do{var g=c.lane,y=c.eventTime;if((a&g)===g){m!==null&&(m=m.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var v=t,j=c;switch(g=s,y=r,j.tag){case 1:if(v=j.payload,typeof v=="function"){x=v.call(y,x,g);break e}x=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=j.payload,g=typeof v=="function"?v.call(y,x,g):v,g==null)break e;x=cr({},x,g);break e;case 2:Ru=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,g=i.effects,g===null?i.effects=[c]:g.push(c))}else y={eventTime:y,lane:g,tag:c.tag,payload:c.payload,callback:c.callback,next:null},m===null?(u=m=y,d=x):m=m.next=y,o|=g;if(c=c.next,c===null){if(c=i.shared.pending,c===null)break;g=c,c=g.next,g.next=null,i.lastBaseUpdate=g,i.shared.pending=null}}while(!0);if(m===null&&(d=x),i.baseState=d,i.firstBaseUpdate=u,i.lastBaseUpdate=m,s=i.shared.interleaved,s!==null){i=s;do o|=i.lane,i=i.next;while(i!==s)}else l===null&&(i.shared.lanes=0);zh|=o,t.lanes=o,t.memoizedState=x}}function sO(t,s,r){if(t=s.effects,s.effects=null,t!==null)for(s=0;s<t.length;s++){var a=t[s],i=a.callback;if(i!==null){if(a.callback=null,a=r,typeof i!="function")throw Error(St(191,i));i.call(a)}}}var Zb={},Zc=wm(Zb),Gg=wm(Zb),Kg=wm(Zb);function rh(t){if(t===Zb)throw Error(St(174));return t}function _E(t,s){switch(En(Kg,s),En(Gg,t),En(Zc,Zb),t=s.nodeType,t){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:$5(null,"");break;default:t=t===8?s.parentNode:s,s=t.namespaceURI||null,t=t.tagName,s=$5(s,t)}Bn(Zc),En(Zc,s)}function Wp(){Bn(Zc),Bn(Gg),Bn(Kg)}function Iz(t){rh(Kg.current);var s=rh(Zc.current),r=$5(s,t.type);s!==r&&(En(Gg,t),En(Zc,r))}function SE(t){Gg.current===t&&(Bn(Zc),Bn(Gg))}var sr=wm(0);function Vj(t){for(var s=t;s!==null;){if(s.tag===13){var r=s.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var HS=[];function CE(){for(var t=0;t<HS.length;t++)HS[t]._workInProgressVersionPrimary=null;HS.length=0}var Kv=ru.ReactCurrentDispatcher,WS=ru.ReactCurrentBatchConfig,$h=0,ir=null,ra=null,ya=null,Hj=!1,pg=!1,Yg=0,zae=0;function Ja(){throw Error(St(321))}function kE(t,s){if(s===null)return!1;for(var r=0;r<s.length&&r<t.length;r++)if(!dc(t[r],s[r]))return!1;return!0}function AE(t,s,r,a,i,l){if($h=l,ir=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Kv.current=t===null||t.memoizedState===null?Wae:qae,t=r(a,i),pg){l=0;do{if(pg=!1,Yg=0,25<=l)throw Error(St(301));l+=1,ya=ra=null,s.updateQueue=null,Kv.current=Gae,t=r(a,i)}while(pg)}if(Kv.current=Wj,s=ra!==null&&ra.next!==null,$h=0,ya=ra=ir=null,Hj=!1,s)throw Error(St(300));return t}function EE(){var t=Yg!==0;return Yg=0,t}function Fc(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ya===null?ir.memoizedState=ya=t:ya=ya.next=t,ya}function Po(){if(ra===null){var t=ir.alternate;t=t!==null?t.memoizedState:null}else t=ra.next;var s=ya===null?ir.memoizedState:ya.next;if(s!==null)ya=s,ra=t;else{if(t===null)throw Error(St(310));ra=t,t={memoizedState:ra.memoizedState,baseState:ra.baseState,baseQueue:ra.baseQueue,queue:ra.queue,next:null},ya===null?ir.memoizedState=ya=t:ya=ya.next=t}return ya}function Xg(t,s){return typeof s=="function"?s(t):s}function qS(t){var s=Po(),r=s.queue;if(r===null)throw Error(St(311));r.lastRenderedReducer=t;var a=ra,i=a.baseQueue,l=r.pending;if(l!==null){if(i!==null){var o=i.next;i.next=l.next,l.next=o}a.baseQueue=i=l,r.pending=null}if(i!==null){l=i.next,a=a.baseState;var c=o=null,d=null,u=l;do{var m=u.lane;if(($h&m)===m)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),a=u.hasEagerState?u.eagerState:t(a,u.action);else{var x={lane:m,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(c=d=x,o=a):d=d.next=x,ir.lanes|=m,zh|=m}u=u.next}while(u!==null&&u!==l);d===null?o=a:d.next=c,dc(a,s.memoizedState)||(Ji=!0),s.memoizedState=a,s.baseState=o,s.baseQueue=d,r.lastRenderedState=a}if(t=r.interleaved,t!==null){i=t;do l=i.lane,ir.lanes|=l,zh|=l,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[s.memoizedState,r.dispatch]}function GS(t){var s=Po(),r=s.queue;if(r===null)throw Error(St(311));r.lastRenderedReducer=t;var a=r.dispatch,i=r.pending,l=s.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do l=t(l,o.action),o=o.next;while(o!==i);dc(l,s.memoizedState)||(Ji=!0),s.memoizedState=l,s.baseQueue===null&&(s.baseState=l),r.lastRenderedState=l}return[l,a]}function Oz(){}function Rz(t,s){var r=ir,a=Po(),i=s(),l=!dc(a.memoizedState,i);if(l&&(a.memoizedState=i,Ji=!0),a=a.queue,TE(Bz.bind(null,r,a,t),[t]),a.getSnapshot!==s||l||ya!==null&&ya.memoizedState.tag&1){if(r.flags|=2048,Qg(9,Fz.bind(null,r,a,i,s),void 0,null),ja===null)throw Error(St(349));$h&30||Lz(r,s,i)}return i}function Lz(t,s,r){t.flags|=16384,t={getSnapshot:s,value:r},s=ir.updateQueue,s===null?(s={lastEffect:null,stores:null},ir.updateQueue=s,s.stores=[t]):(r=s.stores,r===null?s.stores=[t]:r.push(t))}function Fz(t,s,r,a){s.value=r,s.getSnapshot=a,$z(s)&&zz(t)}function Bz(t,s,r){return r(function(){$z(s)&&zz(t)})}function $z(t){var s=t.getSnapshot;t=t.value;try{var r=s();return!dc(t,r)}catch{return!0}}function zz(t){var s=Wd(t,1);s!==null&&cc(s,t,1,-1)}function nO(t){var s=Fc();return typeof t=="function"&&(t=t()),s.memoizedState=s.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xg,lastRenderedState:t},s.queue=t,t=t.dispatch=Hae.bind(null,ir,t),[s.memoizedState,t]}function Qg(t,s,r,a){return t={tag:t,create:s,destroy:r,deps:a,next:null},s=ir.updateQueue,s===null?(s={lastEffect:null,stores:null},ir.updateQueue=s,s.lastEffect=t.next=t):(r=s.lastEffect,r===null?s.lastEffect=t.next=t:(a=r.next,r.next=t,t.next=a,s.lastEffect=t)),t}function Uz(){return Po().memoizedState}function Yv(t,s,r,a){var i=Fc();ir.flags|=t,i.memoizedState=Qg(1|s,r,void 0,a===void 0?null:a)}function zw(t,s,r,a){var i=Po();a=a===void 0?null:a;var l=void 0;if(ra!==null){var o=ra.memoizedState;if(l=o.destroy,a!==null&&kE(a,o.deps)){i.memoizedState=Qg(s,r,l,a);return}}ir.flags|=t,i.memoizedState=Qg(1|s,r,l,a)}function rO(t,s){return Yv(8390656,8,t,s)}function TE(t,s){return zw(2048,8,t,s)}function Vz(t,s){return zw(4,2,t,s)}function Hz(t,s){return zw(4,4,t,s)}function Wz(t,s){if(typeof s=="function")return t=t(),s(t),function(){s(null)};if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function qz(t,s,r){return r=r!=null?r.concat([t]):null,zw(4,4,Wz.bind(null,s,t),r)}function PE(){}function Gz(t,s){var r=Po();s=s===void 0?null:s;var a=r.memoizedState;return a!==null&&s!==null&&kE(s,a[1])?a[0]:(r.memoizedState=[t,s],t)}function Kz(t,s){var r=Po();s=s===void 0?null:s;var a=r.memoizedState;return a!==null&&s!==null&&kE(s,a[1])?a[0]:(t=t(),r.memoizedState=[t,s],t)}function Yz(t,s,r){return $h&21?(dc(r,s)||(r=ez(),ir.lanes|=r,zh|=r,t.baseState=!0),s):(t.baseState&&(t.baseState=!1,Ji=!0),t.memoizedState=r)}function Uae(t,s){var r=fn;fn=r!==0&&4>r?r:4,t(!0);var a=WS.transition;WS.transition={};try{t(!1),s()}finally{fn=r,WS.transition=a}}function Xz(){return Po().memoizedState}function Vae(t,s,r){var a=rm(t);if(r={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null},Qz(t))Zz(s,r);else if(r=Dz(t,s,r,a),r!==null){var i=Ei();cc(r,t,a,i),Jz(r,s,a)}}function Hae(t,s,r){var a=rm(t),i={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null};if(Qz(t))Zz(s,i);else{var l=t.alternate;if(t.lanes===0&&(l===null||l.lanes===0)&&(l=s.lastRenderedReducer,l!==null))try{var o=s.lastRenderedState,c=l(o,r);if(i.hasEagerState=!0,i.eagerState=c,dc(c,o)){var d=s.interleaved;d===null?(i.next=i,NE(s)):(i.next=d.next,d.next=i),s.interleaved=i;return}}catch{}finally{}r=Dz(t,s,i,a),r!==null&&(i=Ei(),cc(r,t,a,i),Jz(r,s,a))}}function Qz(t){var s=t.alternate;return t===ir||s!==null&&s===ir}function Zz(t,s){pg=Hj=!0;var r=t.pending;r===null?s.next=s:(s.next=r.next,r.next=s),t.pending=s}function Jz(t,s,r){if(r&4194240){var a=s.lanes;a&=t.pendingLanes,r|=a,s.lanes=r,oE(t,r)}}var Wj={readContext:To,useCallback:Ja,useContext:Ja,useEffect:Ja,useImperativeHandle:Ja,useInsertionEffect:Ja,useLayoutEffect:Ja,useMemo:Ja,useReducer:Ja,useRef:Ja,useState:Ja,useDebugValue:Ja,useDeferredValue:Ja,useTransition:Ja,useMutableSource:Ja,useSyncExternalStore:Ja,useId:Ja,unstable_isNewReconciler:!1},Wae={readContext:To,useCallback:function(t,s){return Fc().memoizedState=[t,s===void 0?null:s],t},useContext:To,useEffect:rO,useImperativeHandle:function(t,s,r){return r=r!=null?r.concat([t]):null,Yv(4194308,4,Wz.bind(null,s,t),r)},useLayoutEffect:function(t,s){return Yv(4194308,4,t,s)},useInsertionEffect:function(t,s){return Yv(4,2,t,s)},useMemo:function(t,s){var r=Fc();return s=s===void 0?null:s,t=t(),r.memoizedState=[t,s],t},useReducer:function(t,s,r){var a=Fc();return s=r!==void 0?r(s):s,a.memoizedState=a.baseState=s,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:s},a.queue=t,t=t.dispatch=Vae.bind(null,ir,t),[a.memoizedState,t]},useRef:function(t){var s=Fc();return t={current:t},s.memoizedState=t},useState:nO,useDebugValue:PE,useDeferredValue:function(t){return Fc().memoizedState=t},useTransition:function(){var t=nO(!1),s=t[0];return t=Uae.bind(null,t[1]),Fc().memoizedState=t,[s,t]},useMutableSource:function(){},useSyncExternalStore:function(t,s,r){var a=ir,i=Fc();if(Hn){if(r===void 0)throw Error(St(407));r=r()}else{if(r=s(),ja===null)throw Error(St(349));$h&30||Lz(a,s,r)}i.memoizedState=r;var l={value:r,getSnapshot:s};return i.queue=l,rO(Bz.bind(null,a,l,t),[t]),a.flags|=2048,Qg(9,Fz.bind(null,a,l,r,s),void 0,null),r},useId:function(){var t=Fc(),s=ja.identifierPrefix;if(Hn){var r=Rd,a=Od;r=(a&~(1<<32-oc(a)-1)).toString(32)+r,s=":"+s+"R"+r,r=Yg++,0<r&&(s+="H"+r.toString(32)),s+=":"}else r=zae++,s=":"+s+"r"+r.toString(32)+":";return t.memoizedState=s},unstable_isNewReconciler:!1},qae={readContext:To,useCallback:Gz,useContext:To,useEffect:TE,useImperativeHandle:qz,useInsertionEffect:Vz,useLayoutEffect:Hz,useMemo:Kz,useReducer:qS,useRef:Uz,useState:function(){return qS(Xg)},useDebugValue:PE,useDeferredValue:function(t){var s=Po();return Yz(s,ra.memoizedState,t)},useTransition:function(){var t=qS(Xg)[0],s=Po().memoizedState;return[t,s]},useMutableSource:Oz,useSyncExternalStore:Rz,useId:Xz,unstable_isNewReconciler:!1},Gae={readContext:To,useCallback:Gz,useContext:To,useEffect:TE,useImperativeHandle:qz,useInsertionEffect:Vz,useLayoutEffect:Hz,useMemo:Kz,useReducer:GS,useRef:Uz,useState:function(){return GS(Xg)},useDebugValue:PE,useDeferredValue:function(t){var s=Po();return ra===null?s.memoizedState=t:Yz(s,ra.memoizedState,t)},useTransition:function(){var t=GS(Xg)[0],s=Po().memoizedState;return[t,s]},useMutableSource:Oz,useSyncExternalStore:Rz,useId:Xz,unstable_isNewReconciler:!1};function Yo(t,s){if(t&&t.defaultProps){s=cr({},s),t=t.defaultProps;for(var r in t)s[r]===void 0&&(s[r]=t[r]);return s}return s}function l3(t,s,r,a){s=t.memoizedState,r=r(a,s),r=r==null?s:cr({},s,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var Uw={isMounted:function(t){return(t=t._reactInternals)?ux(t)===t:!1},enqueueSetState:function(t,s,r){t=t._reactInternals;var a=Ei(),i=rm(t),l=$d(a,i);l.payload=s,r!=null&&(l.callback=r),s=sm(t,l,i),s!==null&&(cc(s,t,i,a),Gv(s,t,i))},enqueueReplaceState:function(t,s,r){t=t._reactInternals;var a=Ei(),i=rm(t),l=$d(a,i);l.tag=1,l.payload=s,r!=null&&(l.callback=r),s=sm(t,l,i),s!==null&&(cc(s,t,i,a),Gv(s,t,i))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var r=Ei(),a=rm(t),i=$d(r,a);i.tag=2,s!=null&&(i.callback=s),s=sm(t,i,a),s!==null&&(cc(s,t,a,r),Gv(s,t,a))}};function aO(t,s,r,a,i,l,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(a,l,o):s.prototype&&s.prototype.isPureReactComponent?!Vg(r,a)||!Vg(i,l):!0}function eU(t,s,r){var a=!1,i=mm,l=s.contextType;return typeof l=="object"&&l!==null?l=To(l):(i=al(s)?Fh:ui.current,a=s.contextTypes,l=(a=a!=null)?Up(t,i):mm),s=new s(r,l),t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Uw,t.stateNode=s,s._reactInternals=t,a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=l),s}function iO(t,s,r,a){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(r,a),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(r,a),s.state!==t&&Uw.enqueueReplaceState(s,s.state,null)}function o3(t,s,r,a){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},wE(t);var l=s.contextType;typeof l=="object"&&l!==null?i.context=To(l):(l=al(s)?Fh:ui.current,i.context=Up(t,l)),i.state=t.memoizedState,l=s.getDerivedStateFromProps,typeof l=="function"&&(l3(t,s,l,r),i.state=t.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(s=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),s!==i.state&&Uw.enqueueReplaceState(i,i.state,null),Uj(t,r,i,a),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function qp(t,s){try{var r="",a=s;do r+=jre(a),a=a.return;while(a);var i=r}catch(l){i=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:s,stack:i,digest:null}}function KS(t,s,r){return{value:t,source:null,stack:r??null,digest:s??null}}function c3(t,s){try{console.error(s.value)}catch(r){setTimeout(function(){throw r})}}var Kae=typeof WeakMap=="function"?WeakMap:Map;function tU(t,s,r){r=$d(-1,r),r.tag=3,r.payload={element:null};var a=s.value;return r.callback=function(){Gj||(Gj=!0,y3=a),c3(t,s)},r}function sU(t,s,r){r=$d(-1,r),r.tag=3;var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var i=s.value;r.payload=function(){return a(i)},r.callback=function(){c3(t,s)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(r.callback=function(){c3(t,s),typeof a!="function"&&(nm===null?nm=new Set([this]):nm.add(this));var o=s.stack;this.componentDidCatch(s.value,{componentStack:o!==null?o:""})}),r}function lO(t,s,r){var a=t.pingCache;if(a===null){a=t.pingCache=new Kae;var i=new Set;a.set(s,i)}else i=a.get(s),i===void 0&&(i=new Set,a.set(s,i));i.has(r)||(i.add(r),t=oie.bind(null,t,s,r),s.then(t,t))}function oO(t){do{var s;if((s=t.tag===13)&&(s=t.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return t;t=t.return}while(t!==null);return null}function cO(t,s,r,a,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===s?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(s=$d(-1,1),s.tag=2,sm(r,s,1))),r.lanes|=1),t)}var Yae=ru.ReactCurrentOwner,Ji=!1;function Si(t,s,r,a){s.child=t===null?Pz(s,null,r,a):Hp(s,t.child,r,a)}function dO(t,s,r,a,i){r=r.render;var l=s.ref;return Pp(s,i),a=AE(t,s,r,a,l,i),r=EE(),t!==null&&!Ji?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~i,qd(t,s,i)):(Hn&&r&&fE(s),s.flags|=1,Si(t,s,a,i),s.child)}function uO(t,s,r,a,i){if(t===null){var l=r.type;return typeof l=="function"&&!BE(l)&&l.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(s.tag=15,s.type=l,nU(t,s,l,a,i)):(t=Jv(r.type,null,a,s,s.mode,i),t.ref=s.ref,t.return=s,s.child=t)}if(l=t.child,!(t.lanes&i)){var o=l.memoizedProps;if(r=r.compare,r=r!==null?r:Vg,r(o,a)&&t.ref===s.ref)return qd(t,s,i)}return s.flags|=1,t=am(l,a),t.ref=s.ref,t.return=s,s.child=t}function nU(t,s,r,a,i){if(t!==null){var l=t.memoizedProps;if(Vg(l,a)&&t.ref===s.ref)if(Ji=!1,s.pendingProps=a=l,(t.lanes&i)!==0)t.flags&131072&&(Ji=!0);else return s.lanes=t.lanes,qd(t,s,i)}return d3(t,s,r,a,i)}function rU(t,s,r){var a=s.pendingProps,i=a.children,l=t!==null?t.memoizedState:null;if(a.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},En(hp,El),El|=r;else{if(!(r&1073741824))return t=l!==null?l.baseLanes|r:r,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:t,cachePool:null,transitions:null},s.updateQueue=null,En(hp,El),El|=t,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=l!==null?l.baseLanes:r,En(hp,El),El|=a}else l!==null?(a=l.baseLanes|r,s.memoizedState=null):a=r,En(hp,El),El|=a;return Si(t,s,i,r),s.child}function aU(t,s){var r=s.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(s.flags|=512,s.flags|=2097152)}function d3(t,s,r,a,i){var l=al(r)?Fh:ui.current;return l=Up(s,l),Pp(s,i),r=AE(t,s,r,a,l,i),a=EE(),t!==null&&!Ji?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~i,qd(t,s,i)):(Hn&&a&&fE(s),s.flags|=1,Si(t,s,r,i),s.child)}function mO(t,s,r,a,i){if(al(r)){var l=!0;Lj(s)}else l=!1;if(Pp(s,i),s.stateNode===null)Xv(t,s),eU(s,r,a),o3(s,r,a,i),a=!0;else if(t===null){var o=s.stateNode,c=s.memoizedProps;o.props=c;var d=o.context,u=r.contextType;typeof u=="object"&&u!==null?u=To(u):(u=al(r)?Fh:ui.current,u=Up(s,u));var m=r.getDerivedStateFromProps,x=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function";x||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(c!==a||d!==u)&&iO(s,o,a,u),Ru=!1;var g=s.memoizedState;o.state=g,Uj(s,a,o,i),d=s.memoizedState,c!==a||g!==d||rl.current||Ru?(typeof m=="function"&&(l3(s,r,m,a),d=s.memoizedState),(c=Ru||aO(s,r,c,a,g,d,u))?(x||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(s.flags|=4194308)):(typeof o.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=a,s.memoizedState=d),o.props=a,o.state=d,o.context=u,a=c):(typeof o.componentDidMount=="function"&&(s.flags|=4194308),a=!1)}else{o=s.stateNode,Mz(t,s),c=s.memoizedProps,u=s.type===s.elementType?c:Yo(s.type,c),o.props=u,x=s.pendingProps,g=o.context,d=r.contextType,typeof d=="object"&&d!==null?d=To(d):(d=al(r)?Fh:ui.current,d=Up(s,d));var y=r.getDerivedStateFromProps;(m=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(c!==x||g!==d)&&iO(s,o,a,d),Ru=!1,g=s.memoizedState,o.state=g,Uj(s,a,o,i);var v=s.memoizedState;c!==x||g!==v||rl.current||Ru?(typeof y=="function"&&(l3(s,r,y,a),v=s.memoizedState),(u=Ru||aO(s,r,u,a,g,v,d)||!1)?(m||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(a,v,d),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(a,v,d)),typeof o.componentDidUpdate=="function"&&(s.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof o.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(s.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(s.flags|=1024),s.memoizedProps=a,s.memoizedState=v),o.props=a,o.state=v,o.context=d,a=u):(typeof o.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(s.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(s.flags|=1024),a=!1)}return u3(t,s,r,a,l,i)}function u3(t,s,r,a,i,l){aU(t,s);var o=(s.flags&128)!==0;if(!a&&!o)return i&&QI(s,r,!1),qd(t,s,l);a=s.stateNode,Yae.current=s;var c=o&&typeof r.getDerivedStateFromError!="function"?null:a.render();return s.flags|=1,t!==null&&o?(s.child=Hp(s,t.child,null,l),s.child=Hp(s,null,c,l)):Si(t,s,c,l),s.memoizedState=a.state,i&&QI(s,r,!0),s.child}function iU(t){var s=t.stateNode;s.pendingContext?XI(t,s.pendingContext,s.pendingContext!==s.context):s.context&&XI(t,s.context,!1),_E(t,s.containerInfo)}function hO(t,s,r,a,i){return Vp(),bE(i),s.flags|=256,Si(t,s,r,a),s.child}var m3={dehydrated:null,treeContext:null,retryLane:0};function h3(t){return{baseLanes:t,cachePool:null,transitions:null}}function lU(t,s,r){var a=s.pendingProps,i=sr.current,l=!1,o=(s.flags&128)!==0,c;if((c=o)||(c=t!==null&&t.memoizedState===null?!1:(i&2)!==0),c?(l=!0,s.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),En(sr,i&1),t===null)return a3(s),t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(s.mode&1?t.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(o=a.children,t=a.fallback,l?(a=s.mode,l=s.child,o={mode:"hidden",children:o},!(a&1)&&l!==null?(l.childLanes=0,l.pendingProps=o):l=Ww(o,a,0,null),t=gh(t,a,r,null),l.return=s,t.return=s,l.sibling=t,s.child=l,s.child.memoizedState=h3(r),s.memoizedState=m3,t):DE(s,o));if(i=t.memoizedState,i!==null&&(c=i.dehydrated,c!==null))return Xae(t,s,o,a,c,i,r);if(l){l=a.fallback,o=s.mode,i=t.child,c=i.sibling;var d={mode:"hidden",children:a.children};return!(o&1)&&s.child!==i?(a=s.child,a.childLanes=0,a.pendingProps=d,s.deletions=null):(a=am(i,d),a.subtreeFlags=i.subtreeFlags&14680064),c!==null?l=am(c,l):(l=gh(l,o,r,null),l.flags|=2),l.return=s,a.return=s,a.sibling=l,s.child=a,a=l,l=s.child,o=t.child.memoizedState,o=o===null?h3(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},l.memoizedState=o,l.childLanes=t.childLanes&~r,s.memoizedState=m3,a}return l=t.child,t=l.sibling,a=am(l,{mode:"visible",children:a.children}),!(s.mode&1)&&(a.lanes=r),a.return=s,a.sibling=null,t!==null&&(r=s.deletions,r===null?(s.deletions=[t],s.flags|=16):r.push(t)),s.child=a,s.memoizedState=null,a}function DE(t,s){return s=Ww({mode:"visible",children:s},t.mode,0,null),s.return=t,t.child=s}function s1(t,s,r,a){return a!==null&&bE(a),Hp(s,t.child,null,r),t=DE(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function Xae(t,s,r,a,i,l,o){if(r)return s.flags&256?(s.flags&=-257,a=KS(Error(St(422))),s1(t,s,o,a)):s.memoizedState!==null?(s.child=t.child,s.flags|=128,null):(l=a.fallback,i=s.mode,a=Ww({mode:"visible",children:a.children},i,0,null),l=gh(l,i,o,null),l.flags|=2,a.return=s,l.return=s,a.sibling=l,s.child=a,s.mode&1&&Hp(s,t.child,null,o),s.child.memoizedState=h3(o),s.memoizedState=m3,l);if(!(s.mode&1))return s1(t,s,o,null);if(i.data==="$!"){if(a=i.nextSibling&&i.nextSibling.dataset,a)var c=a.dgst;return a=c,l=Error(St(419)),a=KS(l,a,void 0),s1(t,s,o,a)}if(c=(o&t.childLanes)!==0,Ji||c){if(a=ja,a!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(a.suspendedLanes|o)?0:i,i!==0&&i!==l.retryLane&&(l.retryLane=i,Wd(t,i),cc(a,t,i,-1))}return FE(),a=KS(Error(St(421))),s1(t,s,o,a)}return i.data==="$?"?(s.flags|=128,s.child=t.child,s=cie.bind(null,t),i._reactRetry=s,null):(t=l.treeContext,Rl=tm(i.nextSibling),Bl=s,Hn=!0,Jo=null,t!==null&&(fo[go++]=Od,fo[go++]=Rd,fo[go++]=Bh,Od=t.id,Rd=t.overflow,Bh=s),s=DE(s,a.children),s.flags|=4096,s)}function xO(t,s,r){t.lanes|=s;var a=t.alternate;a!==null&&(a.lanes|=s),i3(t.return,s,r)}function YS(t,s,r,a,i){var l=t.memoizedState;l===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:a,tail:r,tailMode:i}:(l.isBackwards=s,l.rendering=null,l.renderingStartTime=0,l.last=a,l.tail=r,l.tailMode=i)}function oU(t,s,r){var a=s.pendingProps,i=a.revealOrder,l=a.tail;if(Si(t,s,a.children,r),a=sr.current,a&2)a=a&1|2,s.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&xO(t,r,s);else if(t.tag===19)xO(t,r,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}a&=1}if(En(sr,a),!(s.mode&1))s.memoizedState=null;else switch(i){case"forwards":for(r=s.child,i=null;r!==null;)t=r.alternate,t!==null&&Vj(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=s.child,s.child=null):(i=r.sibling,r.sibling=null),YS(s,!1,i,r,l);break;case"backwards":for(r=null,i=s.child,s.child=null;i!==null;){if(t=i.alternate,t!==null&&Vj(t)===null){s.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}YS(s,!0,r,null,l);break;case"together":YS(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Xv(t,s){!(s.mode&1)&&t!==null&&(t.alternate=null,s.alternate=null,s.flags|=2)}function qd(t,s,r){if(t!==null&&(s.dependencies=t.dependencies),zh|=s.lanes,!(r&s.childLanes))return null;if(t!==null&&s.child!==t.child)throw Error(St(153));if(s.child!==null){for(t=s.child,r=am(t,t.pendingProps),s.child=r,r.return=s;t.sibling!==null;)t=t.sibling,r=r.sibling=am(t,t.pendingProps),r.return=s;r.sibling=null}return s.child}function Qae(t,s,r){switch(s.tag){case 3:iU(s),Vp();break;case 5:Iz(s);break;case 1:al(s.type)&&Lj(s);break;case 4:_E(s,s.stateNode.containerInfo);break;case 10:var a=s.type._context,i=s.memoizedProps.value;En($j,a._currentValue),a._currentValue=i;break;case 13:if(a=s.memoizedState,a!==null)return a.dehydrated!==null?(En(sr,sr.current&1),s.flags|=128,null):r&s.child.childLanes?lU(t,s,r):(En(sr,sr.current&1),t=qd(t,s,r),t!==null?t.sibling:null);En(sr,sr.current&1);break;case 19:if(a=(r&s.childLanes)!==0,t.flags&128){if(a)return oU(t,s,r);s.flags|=128}if(i=s.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),En(sr,sr.current),a)break;return null;case 22:case 23:return s.lanes=0,rU(t,s,r)}return qd(t,s,r)}var cU,x3,dU,uU;cU=function(t,s){for(var r=s.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};x3=function(){};dU=function(t,s,r,a){var i=t.memoizedProps;if(i!==a){t=s.stateNode,rh(Zc.current);var l=null;switch(r){case"input":i=R5(t,i),a=R5(t,a),l=[];break;case"select":i=cr({},i,{value:void 0}),a=cr({},a,{value:void 0}),l=[];break;case"textarea":i=B5(t,i),a=B5(t,a),l=[];break;default:typeof i.onClick!="function"&&typeof a.onClick=="function"&&(t.onclick=Oj)}z5(r,a);var o;r=null;for(u in i)if(!a.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var c=i[u];for(o in c)c.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Rg.hasOwnProperty(u)?l||(l=[]):(l=l||[]).push(u,null));for(u in a){var d=a[u];if(c=i!=null?i[u]:void 0,a.hasOwnProperty(u)&&d!==c&&(d!=null||c!=null))if(u==="style")if(c){for(o in c)!c.hasOwnProperty(o)||d&&d.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in d)d.hasOwnProperty(o)&&c[o]!==d[o]&&(r||(r={}),r[o]=d[o])}else r||(l||(l=[]),l.push(u,r)),r=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,c=c?c.__html:void 0,d!=null&&c!==d&&(l=l||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(l=l||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Rg.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&On("scroll",t),l||c===d||(l=[])):(l=l||[]).push(u,d))}r&&(l=l||[]).push("style",r);var u=l;(s.updateQueue=u)&&(s.flags|=4)}};uU=function(t,s,r,a){r!==a&&(s.flags|=4)};function d0(t,s){if(!Hn)switch(t.tailMode){case"hidden":s=t.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:a.sibling=null}}function ei(t){var s=t.alternate!==null&&t.alternate.child===t.child,r=0,a=0;if(s)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,a|=i.subtreeFlags&14680064,a|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,a|=i.subtreeFlags,a|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=a,t.childLanes=r,s}function Zae(t,s,r){var a=s.pendingProps;switch(gE(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ei(s),null;case 1:return al(s.type)&&Rj(),ei(s),null;case 3:return a=s.stateNode,Wp(),Bn(rl),Bn(ui),CE(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(e1(s)?s.flags|=4:t===null||t.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Jo!==null&&(N3(Jo),Jo=null))),x3(t,s),ei(s),null;case 5:SE(s);var i=rh(Kg.current);if(r=s.type,t!==null&&s.stateNode!=null)dU(t,s,r,a,i),t.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!a){if(s.stateNode===null)throw Error(St(166));return ei(s),null}if(t=rh(Zc.current),e1(s)){a=s.stateNode,r=s.type;var l=s.memoizedProps;switch(a[zc]=s,a[qg]=l,t=(s.mode&1)!==0,r){case"dialog":On("cancel",a),On("close",a);break;case"iframe":case"object":case"embed":On("load",a);break;case"video":case"audio":for(i=0;i<J0.length;i++)On(J0[i],a);break;case"source":On("error",a);break;case"img":case"image":case"link":On("error",a),On("load",a);break;case"details":On("toggle",a);break;case"input":wI(a,l),On("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!l.multiple},On("invalid",a);break;case"textarea":SI(a,l),On("invalid",a)}z5(r,l),i=null;for(var o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="children"?typeof c=="string"?a.textContent!==c&&(l.suppressHydrationWarning!==!0&&Jy(a.textContent,c,t),i=["children",c]):typeof c=="number"&&a.textContent!==""+c&&(l.suppressHydrationWarning!==!0&&Jy(a.textContent,c,t),i=["children",""+c]):Rg.hasOwnProperty(o)&&c!=null&&o==="onScroll"&&On("scroll",a)}switch(r){case"input":Wy(a),_I(a,l,!0);break;case"textarea":Wy(a),CI(a);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(a.onclick=Oj)}a=i,s.updateQueue=a,a!==null&&(s.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=B$(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof a.is=="string"?t=o.createElement(r,{is:a.is}):(t=o.createElement(r),r==="select"&&(o=t,a.multiple?o.multiple=!0:a.size&&(o.size=a.size))):t=o.createElementNS(t,r),t[zc]=s,t[qg]=a,cU(t,s,!1,!1),s.stateNode=t;e:{switch(o=U5(r,a),r){case"dialog":On("cancel",t),On("close",t),i=a;break;case"iframe":case"object":case"embed":On("load",t),i=a;break;case"video":case"audio":for(i=0;i<J0.length;i++)On(J0[i],t);i=a;break;case"source":On("error",t),i=a;break;case"img":case"image":case"link":On("error",t),On("load",t),i=a;break;case"details":On("toggle",t),i=a;break;case"input":wI(t,a),i=R5(t,a),On("invalid",t);break;case"option":i=a;break;case"select":t._wrapperState={wasMultiple:!!a.multiple},i=cr({},a,{value:void 0}),On("invalid",t);break;case"textarea":SI(t,a),i=B5(t,a),On("invalid",t);break;default:i=a}z5(r,i),c=i;for(l in c)if(c.hasOwnProperty(l)){var d=c[l];l==="style"?U$(t,d):l==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&$$(t,d)):l==="children"?typeof d=="string"?(r!=="textarea"||d!=="")&&Lg(t,d):typeof d=="number"&&Lg(t,""+d):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Rg.hasOwnProperty(l)?d!=null&&l==="onScroll"&&On("scroll",t):d!=null&&sE(t,l,d,o))}switch(r){case"input":Wy(t),_I(t,a,!1);break;case"textarea":Wy(t),CI(t);break;case"option":a.value!=null&&t.setAttribute("value",""+um(a.value));break;case"select":t.multiple=!!a.multiple,l=a.value,l!=null?kp(t,!!a.multiple,l,!1):a.defaultValue!=null&&kp(t,!!a.multiple,a.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Oj)}switch(r){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return ei(s),null;case 6:if(t&&s.stateNode!=null)uU(t,s,t.memoizedProps,a);else{if(typeof a!="string"&&s.stateNode===null)throw Error(St(166));if(r=rh(Kg.current),rh(Zc.current),e1(s)){if(a=s.stateNode,r=s.memoizedProps,a[zc]=s,(l=a.nodeValue!==r)&&(t=Bl,t!==null))switch(t.tag){case 3:Jy(a.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Jy(a.nodeValue,r,(t.mode&1)!==0)}l&&(s.flags|=4)}else a=(r.nodeType===9?r:r.ownerDocument).createTextNode(a),a[zc]=s,s.stateNode=a}return ei(s),null;case 13:if(Bn(sr),a=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Hn&&Rl!==null&&s.mode&1&&!(s.flags&128))Ez(),Vp(),s.flags|=98560,l=!1;else if(l=e1(s),a!==null&&a.dehydrated!==null){if(t===null){if(!l)throw Error(St(318));if(l=s.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(St(317));l[zc]=s}else Vp(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;ei(s),l=!1}else Jo!==null&&(N3(Jo),Jo=null),l=!0;if(!l)return s.flags&65536?s:null}return s.flags&128?(s.lanes=r,s):(a=a!==null,a!==(t!==null&&t.memoizedState!==null)&&a&&(s.child.flags|=8192,s.mode&1&&(t===null||sr.current&1?da===0&&(da=3):FE())),s.updateQueue!==null&&(s.flags|=4),ei(s),null);case 4:return Wp(),x3(t,s),t===null&&Hg(s.stateNode.containerInfo),ei(s),null;case 10:return jE(s.type._context),ei(s),null;case 17:return al(s.type)&&Rj(),ei(s),null;case 19:if(Bn(sr),l=s.memoizedState,l===null)return ei(s),null;if(a=(s.flags&128)!==0,o=l.rendering,o===null)if(a)d0(l,!1);else{if(da!==0||t!==null&&t.flags&128)for(t=s.child;t!==null;){if(o=Vj(t),o!==null){for(s.flags|=128,d0(l,!1),a=o.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),s.subtreeFlags=0,a=r,r=s.child;r!==null;)l=r,t=a,l.flags&=14680066,o=l.alternate,o===null?(l.childLanes=0,l.lanes=t,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=o.childLanes,l.lanes=o.lanes,l.child=o.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=o.memoizedProps,l.memoizedState=o.memoizedState,l.updateQueue=o.updateQueue,l.type=o.type,t=o.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return En(sr,sr.current&1|2),s.child}t=t.sibling}l.tail!==null&&Tr()>Gp&&(s.flags|=128,a=!0,d0(l,!1),s.lanes=4194304)}else{if(!a)if(t=Vj(o),t!==null){if(s.flags|=128,a=!0,r=t.updateQueue,r!==null&&(s.updateQueue=r,s.flags|=4),d0(l,!0),l.tail===null&&l.tailMode==="hidden"&&!o.alternate&&!Hn)return ei(s),null}else 2*Tr()-l.renderingStartTime>Gp&&r!==1073741824&&(s.flags|=128,a=!0,d0(l,!1),s.lanes=4194304);l.isBackwards?(o.sibling=s.child,s.child=o):(r=l.last,r!==null?r.sibling=o:s.child=o,l.last=o)}return l.tail!==null?(s=l.tail,l.rendering=s,l.tail=s.sibling,l.renderingStartTime=Tr(),s.sibling=null,r=sr.current,En(sr,a?r&1|2:r&1),s):(ei(s),null);case 22:case 23:return LE(),a=s.memoizedState!==null,t!==null&&t.memoizedState!==null!==a&&(s.flags|=8192),a&&s.mode&1?El&1073741824&&(ei(s),s.subtreeFlags&6&&(s.flags|=8192)):ei(s),null;case 24:return null;case 25:return null}throw Error(St(156,s.tag))}function Jae(t,s){switch(gE(s),s.tag){case 1:return al(s.type)&&Rj(),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return Wp(),Bn(rl),Bn(ui),CE(),t=s.flags,t&65536&&!(t&128)?(s.flags=t&-65537|128,s):null;case 5:return SE(s),null;case 13:if(Bn(sr),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(St(340));Vp()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return Bn(sr),null;case 4:return Wp(),null;case 10:return jE(s.type._context),null;case 22:case 23:return LE(),null;case 24:return null;default:return null}}var n1=!1,si=!1,eie=typeof WeakSet=="function"?WeakSet:Set,Wt=null;function mp(t,s){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(a){fr(t,s,a)}else r.current=null}function p3(t,s,r){try{r()}catch(a){fr(t,s,a)}}var pO=!1;function tie(t,s){if(Z5=Dj,t=fz(),pE(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var a=r.getSelection&&r.getSelection();if(a&&a.rangeCount!==0){r=a.anchorNode;var i=a.anchorOffset,l=a.focusNode;a=a.focusOffset;try{r.nodeType,l.nodeType}catch{r=null;break e}var o=0,c=-1,d=-1,u=0,m=0,x=t,g=null;t:for(;;){for(var y;x!==r||i!==0&&x.nodeType!==3||(c=o+i),x!==l||a!==0&&x.nodeType!==3||(d=o+a),x.nodeType===3&&(o+=x.nodeValue.length),(y=x.firstChild)!==null;)g=x,x=y;for(;;){if(x===t)break t;if(g===r&&++u===i&&(c=o),g===l&&++m===a&&(d=o),(y=x.nextSibling)!==null)break;x=g,g=x.parentNode}x=y}r=c===-1||d===-1?null:{start:c,end:d}}else r=null}r=r||{start:0,end:0}}else r=null;for(J5={focusedElem:t,selectionRange:r},Dj=!1,Wt=s;Wt!==null;)if(s=Wt,t=s.child,(s.subtreeFlags&1028)!==0&&t!==null)t.return=s,Wt=t;else for(;Wt!==null;){s=Wt;try{var v=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var j=v.memoizedProps,w=v.memoizedState,S=s.stateNode,E=S.getSnapshotBeforeUpdate(s.elementType===s.type?j:Yo(s.type,j),w);S.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var k=s.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(St(163))}}catch(A){fr(s,s.return,A)}if(t=s.sibling,t!==null){t.return=s.return,Wt=t;break}Wt=s.return}return v=pO,pO=!1,v}function fg(t,s,r){var a=s.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var i=a=a.next;do{if((i.tag&t)===t){var l=i.destroy;i.destroy=void 0,l!==void 0&&p3(s,r,l)}i=i.next}while(i!==a)}}function Vw(t,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var a=r.create;r.destroy=a()}r=r.next}while(r!==s)}}function f3(t){var s=t.ref;if(s!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof s=="function"?s(t):s.current=t}}function mU(t){var s=t.alternate;s!==null&&(t.alternate=null,mU(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&(delete s[zc],delete s[qg],delete s[s3],delete s[Lae],delete s[Fae])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hU(t){return t.tag===5||t.tag===3||t.tag===4}function fO(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hU(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function g3(t,s,r){var a=t.tag;if(a===5||a===6)t=t.stateNode,s?r.nodeType===8?r.parentNode.insertBefore(t,s):r.insertBefore(t,s):(r.nodeType===8?(s=r.parentNode,s.insertBefore(t,r)):(s=r,s.appendChild(t)),r=r._reactRootContainer,r!=null||s.onclick!==null||(s.onclick=Oj));else if(a!==4&&(t=t.child,t!==null))for(g3(t,s,r),t=t.sibling;t!==null;)g3(t,s,r),t=t.sibling}function b3(t,s,r){var a=t.tag;if(a===5||a===6)t=t.stateNode,s?r.insertBefore(t,s):r.appendChild(t);else if(a!==4&&(t=t.child,t!==null))for(b3(t,s,r),t=t.sibling;t!==null;)b3(t,s,r),t=t.sibling}var La=null,Qo=!1;function _u(t,s,r){for(r=r.child;r!==null;)xU(t,s,r),r=r.sibling}function xU(t,s,r){if(Qc&&typeof Qc.onCommitFiberUnmount=="function")try{Qc.onCommitFiberUnmount(Ow,r)}catch{}switch(r.tag){case 5:si||mp(r,s);case 6:var a=La,i=Qo;La=null,_u(t,s,r),La=a,Qo=i,La!==null&&(Qo?(t=La,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):La.removeChild(r.stateNode));break;case 18:La!==null&&(Qo?(t=La,r=r.stateNode,t.nodeType===8?US(t.parentNode,r):t.nodeType===1&&US(t,r),zg(t)):US(La,r.stateNode));break;case 4:a=La,i=Qo,La=r.stateNode.containerInfo,Qo=!0,_u(t,s,r),La=a,Qo=i;break;case 0:case 11:case 14:case 15:if(!si&&(a=r.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){i=a=a.next;do{var l=i,o=l.destroy;l=l.tag,o!==void 0&&(l&2||l&4)&&p3(r,s,o),i=i.next}while(i!==a)}_u(t,s,r);break;case 1:if(!si&&(mp(r,s),a=r.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=r.memoizedProps,a.state=r.memoizedState,a.componentWillUnmount()}catch(c){fr(r,s,c)}_u(t,s,r);break;case 21:_u(t,s,r);break;case 22:r.mode&1?(si=(a=si)||r.memoizedState!==null,_u(t,s,r),si=a):_u(t,s,r);break;default:_u(t,s,r)}}function gO(t){var s=t.updateQueue;if(s!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new eie),s.forEach(function(a){var i=die.bind(null,t,a);r.has(a)||(r.add(a),a.then(i,i))})}}function Uo(t,s){var r=s.deletions;if(r!==null)for(var a=0;a<r.length;a++){var i=r[a];try{var l=t,o=s,c=o;e:for(;c!==null;){switch(c.tag){case 5:La=c.stateNode,Qo=!1;break e;case 3:La=c.stateNode.containerInfo,Qo=!0;break e;case 4:La=c.stateNode.containerInfo,Qo=!0;break e}c=c.return}if(La===null)throw Error(St(160));xU(l,o,i),La=null,Qo=!1;var d=i.alternate;d!==null&&(d.return=null),i.return=null}catch(u){fr(i,s,u)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)pU(s,t),s=s.sibling}function pU(t,s){var r=t.alternate,a=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Uo(s,t),Ec(t),a&4){try{fg(3,t,t.return),Vw(3,t)}catch(j){fr(t,t.return,j)}try{fg(5,t,t.return)}catch(j){fr(t,t.return,j)}}break;case 1:Uo(s,t),Ec(t),a&512&&r!==null&&mp(r,r.return);break;case 5:if(Uo(s,t),Ec(t),a&512&&r!==null&&mp(r,r.return),t.flags&32){var i=t.stateNode;try{Lg(i,"")}catch(j){fr(t,t.return,j)}}if(a&4&&(i=t.stateNode,i!=null)){var l=t.memoizedProps,o=r!==null?r.memoizedProps:l,c=t.type,d=t.updateQueue;if(t.updateQueue=null,d!==null)try{c==="input"&&l.type==="radio"&&l.name!=null&&L$(i,l),U5(c,o);var u=U5(c,l);for(o=0;o<d.length;o+=2){var m=d[o],x=d[o+1];m==="style"?U$(i,x):m==="dangerouslySetInnerHTML"?$$(i,x):m==="children"?Lg(i,x):sE(i,m,x,u)}switch(c){case"input":L5(i,l);break;case"textarea":F$(i,l);break;case"select":var g=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!l.multiple;var y=l.value;y!=null?kp(i,!!l.multiple,y,!1):g!==!!l.multiple&&(l.defaultValue!=null?kp(i,!!l.multiple,l.defaultValue,!0):kp(i,!!l.multiple,l.multiple?[]:"",!1))}i[qg]=l}catch(j){fr(t,t.return,j)}}break;case 6:if(Uo(s,t),Ec(t),a&4){if(t.stateNode===null)throw Error(St(162));i=t.stateNode,l=t.memoizedProps;try{i.nodeValue=l}catch(j){fr(t,t.return,j)}}break;case 3:if(Uo(s,t),Ec(t),a&4&&r!==null&&r.memoizedState.isDehydrated)try{zg(s.containerInfo)}catch(j){fr(t,t.return,j)}break;case 4:Uo(s,t),Ec(t);break;case 13:Uo(s,t),Ec(t),i=t.child,i.flags&8192&&(l=i.memoizedState!==null,i.stateNode.isHidden=l,!l||i.alternate!==null&&i.alternate.memoizedState!==null||(OE=Tr())),a&4&&gO(t);break;case 22:if(m=r!==null&&r.memoizedState!==null,t.mode&1?(si=(u=si)||m,Uo(s,t),si=u):Uo(s,t),Ec(t),a&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!m&&t.mode&1)for(Wt=t,m=t.child;m!==null;){for(x=Wt=m;Wt!==null;){switch(g=Wt,y=g.child,g.tag){case 0:case 11:case 14:case 15:fg(4,g,g.return);break;case 1:mp(g,g.return);var v=g.stateNode;if(typeof v.componentWillUnmount=="function"){a=g,r=g.return;try{s=a,v.props=s.memoizedProps,v.state=s.memoizedState,v.componentWillUnmount()}catch(j){fr(a,r,j)}}break;case 5:mp(g,g.return);break;case 22:if(g.memoizedState!==null){yO(x);continue}}y!==null?(y.return=g,Wt=y):yO(x)}m=m.sibling}e:for(m=null,x=t;;){if(x.tag===5){if(m===null){m=x;try{i=x.stateNode,u?(l=i.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(c=x.stateNode,d=x.memoizedProps.style,o=d!=null&&d.hasOwnProperty("display")?d.display:null,c.style.display=z$("display",o))}catch(j){fr(t,t.return,j)}}}else if(x.tag===6){if(m===null)try{x.stateNode.nodeValue=u?"":x.memoizedProps}catch(j){fr(t,t.return,j)}}else if((x.tag!==22&&x.tag!==23||x.memoizedState===null||x===t)&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===t)break e;for(;x.sibling===null;){if(x.return===null||x.return===t)break e;m===x&&(m=null),x=x.return}m===x&&(m=null),x.sibling.return=x.return,x=x.sibling}}break;case 19:Uo(s,t),Ec(t),a&4&&gO(t);break;case 21:break;default:Uo(s,t),Ec(t)}}function Ec(t){var s=t.flags;if(s&2){try{e:{for(var r=t.return;r!==null;){if(hU(r)){var a=r;break e}r=r.return}throw Error(St(160))}switch(a.tag){case 5:var i=a.stateNode;a.flags&32&&(Lg(i,""),a.flags&=-33);var l=fO(t);b3(t,l,i);break;case 3:case 4:var o=a.stateNode.containerInfo,c=fO(t);g3(t,c,o);break;default:throw Error(St(161))}}catch(d){fr(t,t.return,d)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function sie(t,s,r){Wt=t,fU(t)}function fU(t,s,r){for(var a=(t.mode&1)!==0;Wt!==null;){var i=Wt,l=i.child;if(i.tag===22&&a){var o=i.memoizedState!==null||n1;if(!o){var c=i.alternate,d=c!==null&&c.memoizedState!==null||si;c=n1;var u=si;if(n1=o,(si=d)&&!u)for(Wt=i;Wt!==null;)o=Wt,d=o.child,o.tag===22&&o.memoizedState!==null?vO(i):d!==null?(d.return=o,Wt=d):vO(i);for(;l!==null;)Wt=l,fU(l),l=l.sibling;Wt=i,n1=c,si=u}bO(t)}else i.subtreeFlags&8772&&l!==null?(l.return=i,Wt=l):bO(t)}}function bO(t){for(;Wt!==null;){var s=Wt;if(s.flags&8772){var r=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:si||Vw(5,s);break;case 1:var a=s.stateNode;if(s.flags&4&&!si)if(r===null)a.componentDidMount();else{var i=s.elementType===s.type?r.memoizedProps:Yo(s.type,r.memoizedProps);a.componentDidUpdate(i,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var l=s.updateQueue;l!==null&&sO(s,l,a);break;case 3:var o=s.updateQueue;if(o!==null){if(r=null,s.child!==null)switch(s.child.tag){case 5:r=s.child.stateNode;break;case 1:r=s.child.stateNode}sO(s,o,r)}break;case 5:var c=s.stateNode;if(r===null&&s.flags&4){r=c;var d=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&r.focus();break;case"img":d.src&&(r.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var u=s.alternate;if(u!==null){var m=u.memoizedState;if(m!==null){var x=m.dehydrated;x!==null&&zg(x)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(St(163))}si||s.flags&512&&f3(s)}catch(g){fr(s,s.return,g)}}if(s===t){Wt=null;break}if(r=s.sibling,r!==null){r.return=s.return,Wt=r;break}Wt=s.return}}function yO(t){for(;Wt!==null;){var s=Wt;if(s===t){Wt=null;break}var r=s.sibling;if(r!==null){r.return=s.return,Wt=r;break}Wt=s.return}}function vO(t){for(;Wt!==null;){var s=Wt;try{switch(s.tag){case 0:case 11:case 15:var r=s.return;try{Vw(4,s)}catch(d){fr(s,r,d)}break;case 1:var a=s.stateNode;if(typeof a.componentDidMount=="function"){var i=s.return;try{a.componentDidMount()}catch(d){fr(s,i,d)}}var l=s.return;try{f3(s)}catch(d){fr(s,l,d)}break;case 5:var o=s.return;try{f3(s)}catch(d){fr(s,o,d)}}}catch(d){fr(s,s.return,d)}if(s===t){Wt=null;break}var c=s.sibling;if(c!==null){c.return=s.return,Wt=c;break}Wt=s.return}}var nie=Math.ceil,qj=ru.ReactCurrentDispatcher,ME=ru.ReactCurrentOwner,_o=ru.ReactCurrentBatchConfig,Xs=0,ja=null,qr=null,Ga=0,El=0,hp=wm(0),da=0,Zg=null,zh=0,Hw=0,IE=0,gg=null,Xi=null,OE=0,Gp=1/0,kd=null,Gj=!1,y3=null,nm=null,r1=!1,qu=null,Kj=0,bg=0,v3=null,Qv=-1,Zv=0;function Ei(){return Xs&6?Tr():Qv!==-1?Qv:Qv=Tr()}function rm(t){return t.mode&1?Xs&2&&Ga!==0?Ga&-Ga:$ae.transition!==null?(Zv===0&&(Zv=ez()),Zv):(t=fn,t!==0||(t=window.event,t=t===void 0?16:lz(t.type)),t):1}function cc(t,s,r,a){if(50<bg)throw bg=0,v3=null,Error(St(185));Yb(t,r,a),(!(Xs&2)||t!==ja)&&(t===ja&&(!(Xs&2)&&(Hw|=r),da===4&&Uu(t,Ga)),il(t,a),r===1&&Xs===0&&!(s.mode&1)&&(Gp=Tr()+500,$w&&_m()))}function il(t,s){var r=t.callbackNode;$re(t,s);var a=Pj(t,t===ja?Ga:0);if(a===0)r!==null&&EI(r),t.callbackNode=null,t.callbackPriority=0;else if(s=a&-a,t.callbackPriority!==s){if(r!=null&&EI(r),s===1)t.tag===0?Bae(jO.bind(null,t)):Cz(jO.bind(null,t)),Oae(function(){!(Xs&6)&&_m()}),r=null;else{switch(tz(a)){case 1:r=lE;break;case 4:r=Z$;break;case 16:r=Tj;break;case 536870912:r=J$;break;default:r=Tj}r=_U(r,gU.bind(null,t))}t.callbackPriority=s,t.callbackNode=r}}function gU(t,s){if(Qv=-1,Zv=0,Xs&6)throw Error(St(327));var r=t.callbackNode;if(Dp()&&t.callbackNode!==r)return null;var a=Pj(t,t===ja?Ga:0);if(a===0)return null;if(a&30||a&t.expiredLanes||s)s=Yj(t,a);else{s=a;var i=Xs;Xs|=2;var l=yU();(ja!==t||Ga!==s)&&(kd=null,Gp=Tr()+500,fh(t,s));do try{iie();break}catch(c){bU(t,c)}while(!0);vE(),qj.current=l,Xs=i,qr!==null?s=0:(ja=null,Ga=0,s=da)}if(s!==0){if(s===2&&(i=G5(t),i!==0&&(a=i,s=j3(t,i))),s===1)throw r=Zg,fh(t,0),Uu(t,a),il(t,Tr()),r;if(s===6)Uu(t,a);else{if(i=t.current.alternate,!(a&30)&&!rie(i)&&(s=Yj(t,a),s===2&&(l=G5(t),l!==0&&(a=l,s=j3(t,l))),s===1))throw r=Zg,fh(t,0),Uu(t,a),il(t,Tr()),r;switch(t.finishedWork=i,t.finishedLanes=a,s){case 0:case 1:throw Error(St(345));case 2:Ym(t,Xi,kd);break;case 3:if(Uu(t,a),(a&130023424)===a&&(s=OE+500-Tr(),10<s)){if(Pj(t,0)!==0)break;if(i=t.suspendedLanes,(i&a)!==a){Ei(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=t3(Ym.bind(null,t,Xi,kd),s);break}Ym(t,Xi,kd);break;case 4:if(Uu(t,a),(a&4194240)===a)break;for(s=t.eventTimes,i=-1;0<a;){var o=31-oc(a);l=1<<o,o=s[o],o>i&&(i=o),a&=~l}if(a=i,a=Tr()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*nie(a/1960))-a,10<a){t.timeoutHandle=t3(Ym.bind(null,t,Xi,kd),a);break}Ym(t,Xi,kd);break;case 5:Ym(t,Xi,kd);break;default:throw Error(St(329))}}}return il(t,Tr()),t.callbackNode===r?gU.bind(null,t):null}function j3(t,s){var r=gg;return t.current.memoizedState.isDehydrated&&(fh(t,s).flags|=256),t=Yj(t,s),t!==2&&(s=Xi,Xi=r,s!==null&&N3(s)),t}function N3(t){Xi===null?Xi=t:Xi.push.apply(Xi,t)}function rie(t){for(var s=t;;){if(s.flags&16384){var r=s.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var a=0;a<r.length;a++){var i=r[a],l=i.getSnapshot;i=i.value;try{if(!dc(l(),i))return!1}catch{return!1}}}if(r=s.child,s.subtreeFlags&16384&&r!==null)r.return=s,s=r;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Uu(t,s){for(s&=~IE,s&=~Hw,t.suspendedLanes|=s,t.pingedLanes&=~s,t=t.expirationTimes;0<s;){var r=31-oc(s),a=1<<r;t[r]=-1,s&=~a}}function jO(t){if(Xs&6)throw Error(St(327));Dp();var s=Pj(t,0);if(!(s&1))return il(t,Tr()),null;var r=Yj(t,s);if(t.tag!==0&&r===2){var a=G5(t);a!==0&&(s=a,r=j3(t,a))}if(r===1)throw r=Zg,fh(t,0),Uu(t,s),il(t,Tr()),r;if(r===6)throw Error(St(345));return t.finishedWork=t.current.alternate,t.finishedLanes=s,Ym(t,Xi,kd),il(t,Tr()),null}function RE(t,s){var r=Xs;Xs|=1;try{return t(s)}finally{Xs=r,Xs===0&&(Gp=Tr()+500,$w&&_m())}}function Uh(t){qu!==null&&qu.tag===0&&!(Xs&6)&&Dp();var s=Xs;Xs|=1;var r=_o.transition,a=fn;try{if(_o.transition=null,fn=1,t)return t()}finally{fn=a,_o.transition=r,Xs=s,!(Xs&6)&&_m()}}function LE(){El=hp.current,Bn(hp)}function fh(t,s){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Iae(r)),qr!==null)for(r=qr.return;r!==null;){var a=r;switch(gE(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&Rj();break;case 3:Wp(),Bn(rl),Bn(ui),CE();break;case 5:SE(a);break;case 4:Wp();break;case 13:Bn(sr);break;case 19:Bn(sr);break;case 10:jE(a.type._context);break;case 22:case 23:LE()}r=r.return}if(ja=t,qr=t=am(t.current,null),Ga=El=s,da=0,Zg=null,IE=Hw=zh=0,Xi=gg=null,nh!==null){for(s=0;s<nh.length;s++)if(r=nh[s],a=r.interleaved,a!==null){r.interleaved=null;var i=a.next,l=r.pending;if(l!==null){var o=l.next;l.next=i,a.next=o}r.pending=a}nh=null}return t}function bU(t,s){do{var r=qr;try{if(vE(),Kv.current=Wj,Hj){for(var a=ir.memoizedState;a!==null;){var i=a.queue;i!==null&&(i.pending=null),a=a.next}Hj=!1}if($h=0,ya=ra=ir=null,pg=!1,Yg=0,ME.current=null,r===null||r.return===null){da=1,Zg=s,qr=null;break}e:{var l=t,o=r.return,c=r,d=s;if(s=Ga,c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,m=c,x=m.tag;if(!(m.mode&1)&&(x===0||x===11||x===15)){var g=m.alternate;g?(m.updateQueue=g.updateQueue,m.memoizedState=g.memoizedState,m.lanes=g.lanes):(m.updateQueue=null,m.memoizedState=null)}var y=oO(o);if(y!==null){y.flags&=-257,cO(y,o,c,l,s),y.mode&1&&lO(l,u,s),s=y,d=u;var v=s.updateQueue;if(v===null){var j=new Set;j.add(d),s.updateQueue=j}else v.add(d);break e}else{if(!(s&1)){lO(l,u,s),FE();break e}d=Error(St(426))}}else if(Hn&&c.mode&1){var w=oO(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),cO(w,o,c,l,s),bE(qp(d,c));break e}}l=d=qp(d,c),da!==4&&(da=2),gg===null?gg=[l]:gg.push(l),l=o;do{switch(l.tag){case 3:l.flags|=65536,s&=-s,l.lanes|=s;var S=tU(l,d,s);tO(l,S);break e;case 1:c=d;var E=l.type,k=l.stateNode;if(!(l.flags&128)&&(typeof E.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(nm===null||!nm.has(k)))){l.flags|=65536,s&=-s,l.lanes|=s;var A=sU(l,c,s);tO(l,A);break e}}l=l.return}while(l!==null)}jU(r)}catch(I){s=I,qr===r&&r!==null&&(qr=r=r.return);continue}break}while(!0)}function yU(){var t=qj.current;return qj.current=Wj,t===null?Wj:t}function FE(){(da===0||da===3||da===2)&&(da=4),ja===null||!(zh&268435455)&&!(Hw&268435455)||Uu(ja,Ga)}function Yj(t,s){var r=Xs;Xs|=2;var a=yU();(ja!==t||Ga!==s)&&(kd=null,fh(t,s));do try{aie();break}catch(i){bU(t,i)}while(!0);if(vE(),Xs=r,qj.current=a,qr!==null)throw Error(St(261));return ja=null,Ga=0,da}function aie(){for(;qr!==null;)vU(qr)}function iie(){for(;qr!==null&&!Pre();)vU(qr)}function vU(t){var s=wU(t.alternate,t,El);t.memoizedProps=t.pendingProps,s===null?jU(t):qr=s,ME.current=null}function jU(t){var s=t;do{var r=s.alternate;if(t=s.return,s.flags&32768){if(r=Jae(r,s),r!==null){r.flags&=32767,qr=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{da=6,qr=null;return}}else if(r=Zae(r,s,El),r!==null){qr=r;return}if(s=s.sibling,s!==null){qr=s;return}qr=s=t}while(s!==null);da===0&&(da=5)}function Ym(t,s,r){var a=fn,i=_o.transition;try{_o.transition=null,fn=1,lie(t,s,r,a)}finally{_o.transition=i,fn=a}return null}function lie(t,s,r,a){do Dp();while(qu!==null);if(Xs&6)throw Error(St(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(St(177));t.callbackNode=null,t.callbackPriority=0;var l=r.lanes|r.childLanes;if(zre(t,l),t===ja&&(qr=ja=null,Ga=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||r1||(r1=!0,_U(Tj,function(){return Dp(),null})),l=(r.flags&15990)!==0,r.subtreeFlags&15990||l){l=_o.transition,_o.transition=null;var o=fn;fn=1;var c=Xs;Xs|=4,ME.current=null,tie(t,r),pU(r,t),kae(J5),Dj=!!Z5,J5=Z5=null,t.current=r,sie(r),Dre(),Xs=c,fn=o,_o.transition=l}else t.current=r;if(r1&&(r1=!1,qu=t,Kj=i),l=t.pendingLanes,l===0&&(nm=null),Ore(r.stateNode),il(t,Tr()),s!==null)for(a=t.onRecoverableError,r=0;r<s.length;r++)i=s[r],a(i.value,{componentStack:i.stack,digest:i.digest});if(Gj)throw Gj=!1,t=y3,y3=null,t;return Kj&1&&t.tag!==0&&Dp(),l=t.pendingLanes,l&1?t===v3?bg++:(bg=0,v3=t):bg=0,_m(),null}function Dp(){if(qu!==null){var t=tz(Kj),s=_o.transition,r=fn;try{if(_o.transition=null,fn=16>t?16:t,qu===null)var a=!1;else{if(t=qu,qu=null,Kj=0,Xs&6)throw Error(St(331));var i=Xs;for(Xs|=4,Wt=t.current;Wt!==null;){var l=Wt,o=l.child;if(Wt.flags&16){var c=l.deletions;if(c!==null){for(var d=0;d<c.length;d++){var u=c[d];for(Wt=u;Wt!==null;){var m=Wt;switch(m.tag){case 0:case 11:case 15:fg(8,m,l)}var x=m.child;if(x!==null)x.return=m,Wt=x;else for(;Wt!==null;){m=Wt;var g=m.sibling,y=m.return;if(mU(m),m===u){Wt=null;break}if(g!==null){g.return=y,Wt=g;break}Wt=y}}}var v=l.alternate;if(v!==null){var j=v.child;if(j!==null){v.child=null;do{var w=j.sibling;j.sibling=null,j=w}while(j!==null)}}Wt=l}}if(l.subtreeFlags&2064&&o!==null)o.return=l,Wt=o;else e:for(;Wt!==null;){if(l=Wt,l.flags&2048)switch(l.tag){case 0:case 11:case 15:fg(9,l,l.return)}var S=l.sibling;if(S!==null){S.return=l.return,Wt=S;break e}Wt=l.return}}var E=t.current;for(Wt=E;Wt!==null;){o=Wt;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,Wt=k;else e:for(o=E;Wt!==null;){if(c=Wt,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Vw(9,c)}}catch(I){fr(c,c.return,I)}if(c===o){Wt=null;break e}var A=c.sibling;if(A!==null){A.return=c.return,Wt=A;break e}Wt=c.return}}if(Xs=i,_m(),Qc&&typeof Qc.onPostCommitFiberRoot=="function")try{Qc.onPostCommitFiberRoot(Ow,t)}catch{}a=!0}return a}finally{fn=r,_o.transition=s}}return!1}function NO(t,s,r){s=qp(r,s),s=tU(t,s,1),t=sm(t,s,1),s=Ei(),t!==null&&(Yb(t,1,s),il(t,s))}function fr(t,s,r){if(t.tag===3)NO(t,t,r);else for(;s!==null;){if(s.tag===3){NO(s,t,r);break}else if(s.tag===1){var a=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(nm===null||!nm.has(a))){t=qp(r,t),t=sU(s,t,1),s=sm(s,t,1),t=Ei(),s!==null&&(Yb(s,1,t),il(s,t));break}}s=s.return}}function oie(t,s,r){var a=t.pingCache;a!==null&&a.delete(s),s=Ei(),t.pingedLanes|=t.suspendedLanes&r,ja===t&&(Ga&r)===r&&(da===4||da===3&&(Ga&130023424)===Ga&&500>Tr()-OE?fh(t,0):IE|=r),il(t,s)}function NU(t,s){s===0&&(t.mode&1?(s=Ky,Ky<<=1,!(Ky&130023424)&&(Ky=4194304)):s=1);var r=Ei();t=Wd(t,s),t!==null&&(Yb(t,s,r),il(t,r))}function cie(t){var s=t.memoizedState,r=0;s!==null&&(r=s.retryLane),NU(t,r)}function die(t,s){var r=0;switch(t.tag){case 13:var a=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:a=t.stateNode;break;default:throw Error(St(314))}a!==null&&a.delete(s),NU(t,r)}var wU;wU=function(t,s,r){if(t!==null)if(t.memoizedProps!==s.pendingProps||rl.current)Ji=!0;else{if(!(t.lanes&r)&&!(s.flags&128))return Ji=!1,Qae(t,s,r);Ji=!!(t.flags&131072)}else Ji=!1,Hn&&s.flags&1048576&&kz(s,Bj,s.index);switch(s.lanes=0,s.tag){case 2:var a=s.type;Xv(t,s),t=s.pendingProps;var i=Up(s,ui.current);Pp(s,r),i=AE(null,s,a,t,i,r);var l=EE();return s.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,al(a)?(l=!0,Lj(s)):l=!1,s.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,wE(s),i.updater=Uw,s.stateNode=i,i._reactInternals=s,o3(s,a,t,r),s=u3(null,s,a,!0,l,r)):(s.tag=0,Hn&&l&&fE(s),Si(null,s,i,r),s=s.child),s;case 16:a=s.elementType;e:{switch(Xv(t,s),t=s.pendingProps,i=a._init,a=i(a._payload),s.type=a,i=s.tag=mie(a),t=Yo(a,t),i){case 0:s=d3(null,s,a,t,r);break e;case 1:s=mO(null,s,a,t,r);break e;case 11:s=dO(null,s,a,t,r);break e;case 14:s=uO(null,s,a,Yo(a.type,t),r);break e}throw Error(St(306,a,""))}return s;case 0:return a=s.type,i=s.pendingProps,i=s.elementType===a?i:Yo(a,i),d3(t,s,a,i,r);case 1:return a=s.type,i=s.pendingProps,i=s.elementType===a?i:Yo(a,i),mO(t,s,a,i,r);case 3:e:{if(iU(s),t===null)throw Error(St(387));a=s.pendingProps,l=s.memoizedState,i=l.element,Mz(t,s),Uj(s,a,null,r);var o=s.memoizedState;if(a=o.element,l.isDehydrated)if(l={element:a,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},s.updateQueue.baseState=l,s.memoizedState=l,s.flags&256){i=qp(Error(St(423)),s),s=hO(t,s,a,r,i);break e}else if(a!==i){i=qp(Error(St(424)),s),s=hO(t,s,a,r,i);break e}else for(Rl=tm(s.stateNode.containerInfo.firstChild),Bl=s,Hn=!0,Jo=null,r=Pz(s,null,a,r),s.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Vp(),a===i){s=qd(t,s,r);break e}Si(t,s,a,r)}s=s.child}return s;case 5:return Iz(s),t===null&&a3(s),a=s.type,i=s.pendingProps,l=t!==null?t.memoizedProps:null,o=i.children,e3(a,i)?o=null:l!==null&&e3(a,l)&&(s.flags|=32),aU(t,s),Si(t,s,o,r),s.child;case 6:return t===null&&a3(s),null;case 13:return lU(t,s,r);case 4:return _E(s,s.stateNode.containerInfo),a=s.pendingProps,t===null?s.child=Hp(s,null,a,r):Si(t,s,a,r),s.child;case 11:return a=s.type,i=s.pendingProps,i=s.elementType===a?i:Yo(a,i),dO(t,s,a,i,r);case 7:return Si(t,s,s.pendingProps,r),s.child;case 8:return Si(t,s,s.pendingProps.children,r),s.child;case 12:return Si(t,s,s.pendingProps.children,r),s.child;case 10:e:{if(a=s.type._context,i=s.pendingProps,l=s.memoizedProps,o=i.value,En($j,a._currentValue),a._currentValue=o,l!==null)if(dc(l.value,o)){if(l.children===i.children&&!rl.current){s=qd(t,s,r);break e}}else for(l=s.child,l!==null&&(l.return=s);l!==null;){var c=l.dependencies;if(c!==null){o=l.child;for(var d=c.firstContext;d!==null;){if(d.context===a){if(l.tag===1){d=$d(-1,r&-r),d.tag=2;var u=l.updateQueue;if(u!==null){u=u.shared;var m=u.pending;m===null?d.next=d:(d.next=m.next,m.next=d),u.pending=d}}l.lanes|=r,d=l.alternate,d!==null&&(d.lanes|=r),i3(l.return,r,s),c.lanes|=r;break}d=d.next}}else if(l.tag===10)o=l.type===s.type?null:l.child;else if(l.tag===18){if(o=l.return,o===null)throw Error(St(341));o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),i3(o,r,s),o=l.sibling}else o=l.child;if(o!==null)o.return=l;else for(o=l;o!==null;){if(o===s){o=null;break}if(l=o.sibling,l!==null){l.return=o.return,o=l;break}o=o.return}l=o}Si(t,s,i.children,r),s=s.child}return s;case 9:return i=s.type,a=s.pendingProps.children,Pp(s,r),i=To(i),a=a(i),s.flags|=1,Si(t,s,a,r),s.child;case 14:return a=s.type,i=Yo(a,s.pendingProps),i=Yo(a.type,i),uO(t,s,a,i,r);case 15:return nU(t,s,s.type,s.pendingProps,r);case 17:return a=s.type,i=s.pendingProps,i=s.elementType===a?i:Yo(a,i),Xv(t,s),s.tag=1,al(a)?(t=!0,Lj(s)):t=!1,Pp(s,r),eU(s,a,i),o3(s,a,i,r),u3(null,s,a,!0,t,r);case 19:return oU(t,s,r);case 22:return rU(t,s,r)}throw Error(St(156,s.tag))};function _U(t,s){return Q$(t,s)}function uie(t,s,r,a){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vo(t,s,r,a){return new uie(t,s,r,a)}function BE(t){return t=t.prototype,!(!t||!t.isReactComponent)}function mie(t){if(typeof t=="function")return BE(t)?1:0;if(t!=null){if(t=t.$$typeof,t===rE)return 11;if(t===aE)return 14}return 2}function am(t,s){var r=t.alternate;return r===null?(r=vo(t.tag,s,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=s,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,s=t.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Jv(t,s,r,a,i,l){var o=2;if(a=t,typeof t=="function")BE(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case np:return gh(r.children,i,l,s);case nE:o=8,i|=8;break;case D5:return t=vo(12,r,s,i|2),t.elementType=D5,t.lanes=l,t;case M5:return t=vo(13,r,s,i),t.elementType=M5,t.lanes=l,t;case I5:return t=vo(19,r,s,i),t.elementType=I5,t.lanes=l,t;case I$:return Ww(r,i,l,s);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case D$:o=10;break e;case M$:o=9;break e;case rE:o=11;break e;case aE:o=14;break e;case Ou:o=16,a=null;break e}throw Error(St(130,t==null?t:typeof t,""))}return s=vo(o,r,s,i),s.elementType=t,s.type=a,s.lanes=l,s}function gh(t,s,r,a){return t=vo(7,t,a,s),t.lanes=r,t}function Ww(t,s,r,a){return t=vo(22,t,a,s),t.elementType=I$,t.lanes=r,t.stateNode={isHidden:!1},t}function XS(t,s,r){return t=vo(6,t,null,s),t.lanes=r,t}function QS(t,s,r){return s=vo(4,t.children!==null?t.children:[],t.key,s),s.lanes=r,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}function hie(t,s,r,a,i){this.tag=s,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=PS(0),this.expirationTimes=PS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=PS(0),this.identifierPrefix=a,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function $E(t,s,r,a,i,l,o,c,d){return t=new hie(t,s,r,c,d),s===1?(s=1,l===!0&&(s|=8)):s=0,l=vo(3,null,null,s),t.current=l,l.stateNode=t,l.memoizedState={element:a,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},wE(l),t}function xie(t,s,r){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sp,key:a==null?null:""+a,children:t,containerInfo:s,implementation:r}}function SU(t){if(!t)return mm;t=t._reactInternals;e:{if(ux(t)!==t||t.tag!==1)throw Error(St(170));var s=t;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(al(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(St(171))}if(t.tag===1){var r=t.type;if(al(r))return Sz(t,r,s)}return s}function CU(t,s,r,a,i,l,o,c,d){return t=$E(r,a,!0,t,i,l,o,c,d),t.context=SU(null),r=t.current,a=Ei(),i=rm(r),l=$d(a,i),l.callback=s??null,sm(r,l,i),t.current.lanes=i,Yb(t,i,a),il(t,a),t}function qw(t,s,r,a){var i=s.current,l=Ei(),o=rm(i);return r=SU(r),s.context===null?s.context=r:s.pendingContext=r,s=$d(l,o),s.payload={element:t},a=a===void 0?null:a,a!==null&&(s.callback=a),t=sm(i,s,o),t!==null&&(cc(t,i,o,l),Gv(t,i,o)),o}function Xj(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function wO(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<s?r:s}}function zE(t,s){wO(t,s),(t=t.alternate)&&wO(t,s)}function pie(){return null}var kU=typeof reportError=="function"?reportError:function(t){console.error(t)};function UE(t){this._internalRoot=t}Gw.prototype.render=UE.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(St(409));qw(t,s,null,null)};Gw.prototype.unmount=UE.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;Uh(function(){qw(null,t,null,null)}),s[Hd]=null}};function Gw(t){this._internalRoot=t}Gw.prototype.unstable_scheduleHydration=function(t){if(t){var s=rz();t={blockedOn:null,target:t,priority:s};for(var r=0;r<zu.length&&s!==0&&s<zu[r].priority;r++);zu.splice(r,0,t),r===0&&iz(t)}};function VE(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Kw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _O(){}function fie(t,s,r,a,i){if(i){if(typeof a=="function"){var l=a;a=function(){var u=Xj(o);l.call(u)}}var o=CU(s,a,t,0,null,!1,!1,"",_O);return t._reactRootContainer=o,t[Hd]=o.current,Hg(t.nodeType===8?t.parentNode:t),Uh(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof a=="function"){var c=a;a=function(){var u=Xj(d);c.call(u)}}var d=$E(t,0,!1,null,null,!1,!1,"",_O);return t._reactRootContainer=d,t[Hd]=d.current,Hg(t.nodeType===8?t.parentNode:t),Uh(function(){qw(s,d,r,a)}),d}function Yw(t,s,r,a,i){var l=r._reactRootContainer;if(l){var o=l;if(typeof i=="function"){var c=i;i=function(){var d=Xj(o);c.call(d)}}qw(s,o,t,i)}else o=fie(r,s,t,i,a);return Xj(o)}sz=function(t){switch(t.tag){case 3:var s=t.stateNode;if(s.current.memoizedState.isDehydrated){var r=Z0(s.pendingLanes);r!==0&&(oE(s,r|1),il(s,Tr()),!(Xs&6)&&(Gp=Tr()+500,_m()))}break;case 13:Uh(function(){var a=Wd(t,1);if(a!==null){var i=Ei();cc(a,t,1,i)}}),zE(t,1)}};cE=function(t){if(t.tag===13){var s=Wd(t,134217728);if(s!==null){var r=Ei();cc(s,t,134217728,r)}zE(t,134217728)}};nz=function(t){if(t.tag===13){var s=rm(t),r=Wd(t,s);if(r!==null){var a=Ei();cc(r,t,s,a)}zE(t,s)}};rz=function(){return fn};az=function(t,s){var r=fn;try{return fn=t,s()}finally{fn=r}};H5=function(t,s,r){switch(s){case"input":if(L5(t,r),s=r.name,r.type==="radio"&&s!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<r.length;s++){var a=r[s];if(a!==t&&a.form===t.form){var i=Bw(a);if(!i)throw Error(St(90));R$(a),L5(a,i)}}}break;case"textarea":F$(t,r);break;case"select":s=r.value,s!=null&&kp(t,!!r.multiple,s,!1)}};W$=RE;q$=Uh;var gie={usingClientEntryPoint:!1,Events:[Qb,lp,Bw,V$,H$,RE]},u0={findFiberByHostInstance:sh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bie={bundleType:u0.bundleType,version:u0.version,rendererPackageName:u0.rendererPackageName,rendererConfig:u0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ru.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Y$(t),t===null?null:t.stateNode},findFiberByHostInstance:u0.findFiberByHostInstance||pie,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var a1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!a1.isDisabled&&a1.supportsFiber)try{Ow=a1.inject(bie),Qc=a1}catch{}}Kl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gie;Kl.createPortal=function(t,s){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!VE(s))throw Error(St(200));return xie(t,s,null,r)};Kl.createRoot=function(t,s){if(!VE(t))throw Error(St(299));var r=!1,a="",i=kU;return s!=null&&(s.unstable_strictMode===!0&&(r=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(i=s.onRecoverableError)),s=$E(t,1,!1,null,null,r,!1,a,i),t[Hd]=s.current,Hg(t.nodeType===8?t.parentNode:t),new UE(s)};Kl.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(St(188)):(t=Object.keys(t).join(","),Error(St(268,t)));return t=Y$(s),t=t===null?null:t.stateNode,t};Kl.flushSync=function(t){return Uh(t)};Kl.hydrate=function(t,s,r){if(!Kw(s))throw Error(St(200));return Yw(null,t,s,!0,r)};Kl.hydrateRoot=function(t,s,r){if(!VE(t))throw Error(St(405));var a=r!=null&&r.hydratedSources||null,i=!1,l="",o=kU;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(l=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),s=CU(s,null,t,1,r??null,i,!1,l,o),t[Hd]=s.current,Hg(t),a)for(t=0;t<a.length;t++)r=a[t],i=r._getVersion,i=i(r._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[r,i]:s.mutableSourceEagerHydrationData.push(r,i);return new Gw(s)};Kl.render=function(t,s,r){if(!Kw(s))throw Error(St(200));return Yw(null,t,s,!1,r)};Kl.unmountComponentAtNode=function(t){if(!Kw(t))throw Error(St(40));return t._reactRootContainer?(Uh(function(){Yw(null,null,t,!1,function(){t._reactRootContainer=null,t[Hd]=null})}),!0):!1};Kl.unstable_batchedUpdates=RE;Kl.unstable_renderSubtreeIntoContainer=function(t,s,r,a){if(!Kw(r))throw Error(St(200));if(t==null||t._reactInternals===void 0)throw Error(St(38));return Yw(t,s,r,!1,a)};Kl.version="18.3.1-next-f1338f8080-20240426";function AU(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(AU)}catch(t){console.error(t)}}AU(),A$.exports=Kl;var Sm=A$.exports;const EU=Ro(Sm);var SO=Sm;T5.createRoot=SO.createRoot,T5.hydrateRoot=SO.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jg(){return Jg=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Jg.apply(this,arguments)}var Gu;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Gu||(Gu={}));const CO="popstate";function yie(t){t===void 0&&(t={});function s(a,i){let{pathname:l,search:o,hash:c}=a.location;return w3("",{pathname:l,search:o,hash:c},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(a,i){return typeof i=="string"?i:Qj(i)}return jie(s,r,null,t)}function lr(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function TU(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function vie(){return Math.random().toString(36).substr(2,8)}function kO(t,s){return{usr:t.state,key:t.key,idx:s}}function w3(t,s,r,a){return r===void 0&&(r=null),Jg({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof s=="string"?vf(s):s,{state:r,key:s&&s.key||a||vie()})}function Qj(t){let{pathname:s="/",search:r="",hash:a=""}=t;return r&&r!=="?"&&(s+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(s+=a.charAt(0)==="#"?a:"#"+a),s}function vf(t){let s={};if(t){let r=t.indexOf("#");r>=0&&(s.hash=t.substr(r),t=t.substr(0,r));let a=t.indexOf("?");a>=0&&(s.search=t.substr(a),t=t.substr(0,a)),t&&(s.pathname=t)}return s}function jie(t,s,r,a){a===void 0&&(a={});let{window:i=document.defaultView,v5Compat:l=!1}=a,o=i.history,c=Gu.Pop,d=null,u=m();u==null&&(u=0,o.replaceState(Jg({},o.state,{idx:u}),""));function m(){return(o.state||{idx:null}).idx}function x(){c=Gu.Pop;let w=m(),S=w==null?null:w-u;u=w,d&&d({action:c,location:j.location,delta:S})}function g(w,S){c=Gu.Push;let E=w3(j.location,w,S);u=m()+1;let k=kO(E,u),A=j.createHref(E);try{o.pushState(k,"",A)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;i.location.assign(A)}l&&d&&d({action:c,location:j.location,delta:1})}function y(w,S){c=Gu.Replace;let E=w3(j.location,w,S);u=m();let k=kO(E,u),A=j.createHref(E);o.replaceState(k,"",A),l&&d&&d({action:c,location:j.location,delta:0})}function v(w){let S=i.location.origin!=="null"?i.location.origin:i.location.href,E=typeof w=="string"?w:Qj(w);return E=E.replace(/ $/,"%20"),lr(S,"No window.location.(origin|href) available to create URL for href: "+E),new URL(E,S)}let j={get action(){return c},get location(){return t(i,o)},listen(w){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(CO,x),d=w,()=>{i.removeEventListener(CO,x),d=null}},createHref(w){return s(i,w)},createURL:v,encodeLocation(w){let S=v(w);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:g,replace:y,go(w){return o.go(w)}};return j}var AO;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(AO||(AO={}));function Nie(t,s,r){return r===void 0&&(r="/"),wie(t,s,r)}function wie(t,s,r,a){let i=typeof s=="string"?vf(s):s,l=Kp(i.pathname||"/",r);if(l==null)return null;let o=PU(t);_ie(o);let c=null;for(let d=0;c==null&&d<o.length;++d){let u=Oie(l);c=Mie(o[d],u)}return c}function PU(t,s,r,a){s===void 0&&(s=[]),r===void 0&&(r=[]),a===void 0&&(a="");let i=(l,o,c)=>{let d={relativePath:c===void 0?l.path||"":c,caseSensitive:l.caseSensitive===!0,childrenIndex:o,route:l};d.relativePath.startsWith("/")&&(lr(d.relativePath.startsWith(a),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(a.length));let u=im([a,d.relativePath]),m=r.concat(d);l.children&&l.children.length>0&&(lr(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),PU(l.children,s,m,u)),!(l.path==null&&!l.index)&&s.push({path:u,score:Pie(u,l.index),routesMeta:m})};return t.forEach((l,o)=>{var c;if(l.path===""||!((c=l.path)!=null&&c.includes("?")))i(l,o);else for(let d of DU(l.path))i(l,o,d)}),s}function DU(t){let s=t.split("/");if(s.length===0)return[];let[r,...a]=s,i=r.endsWith("?"),l=r.replace(/\?$/,"");if(a.length===0)return i?[l,""]:[l];let o=DU(a.join("/")),c=[];return c.push(...o.map(d=>d===""?l:[l,d].join("/"))),i&&c.push(...o),c.map(d=>t.startsWith("/")&&d===""?"/":d)}function _ie(t){t.sort((s,r)=>s.score!==r.score?r.score-s.score:Die(s.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}const Sie=/^:[\w-]+$/,Cie=3,kie=2,Aie=1,Eie=10,Tie=-2,EO=t=>t==="*";function Pie(t,s){let r=t.split("/"),a=r.length;return r.some(EO)&&(a+=Tie),s&&(a+=kie),r.filter(i=>!EO(i)).reduce((i,l)=>i+(Sie.test(l)?Cie:l===""?Aie:Eie),a)}function Die(t,s){return t.length===s.length&&t.slice(0,-1).every((a,i)=>a===s[i])?t[t.length-1]-s[s.length-1]:0}function Mie(t,s,r){let{routesMeta:a}=t,i={},l="/",o=[];for(let c=0;c<a.length;++c){let d=a[c],u=c===a.length-1,m=l==="/"?s:s.slice(l.length)||"/",x=_3({path:d.relativePath,caseSensitive:d.caseSensitive,end:u},m),g=d.route;if(!x)return null;Object.assign(i,x.params),o.push({params:i,pathname:im([l,x.pathname]),pathnameBase:Bie(im([l,x.pathnameBase])),route:g}),x.pathnameBase!=="/"&&(l=im([l,x.pathnameBase]))}return o}function _3(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,a]=Iie(t.path,t.caseSensitive,t.end),i=s.match(r);if(!i)return null;let l=i[0],o=l.replace(/(.)\/+$/,"$1"),c=i.slice(1);return{params:a.reduce((u,m,x)=>{let{paramName:g,isOptional:y}=m;if(g==="*"){let j=c[x]||"";o=l.slice(0,l.length-j.length).replace(/(.)\/+$/,"$1")}const v=c[x];return y&&!v?u[g]=void 0:u[g]=(v||"").replace(/%2F/g,"/"),u},{}),pathname:l,pathnameBase:o,pattern:t}}function Iie(t,s,r){s===void 0&&(s=!1),r===void 0&&(r=!0),TU(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let a=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,d)=>(a.push({paramName:c,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(a.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,s?void 0:"i"),a]}function Oie(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return TU(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),t}}function Kp(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let r=s.endsWith("/")?s.length-1:s.length,a=t.charAt(r);return a&&a!=="/"?null:t.slice(r)||"/"}function Rie(t,s){s===void 0&&(s="/");let{pathname:r,search:a="",hash:i=""}=typeof t=="string"?vf(t):t;return{pathname:r?r.startsWith("/")?r:Lie(r,s):s,search:$ie(a),hash:zie(i)}}function Lie(t,s){let r=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?r.length>1&&r.pop():i!=="."&&r.push(i)}),r.length>1?r.join("/"):"/"}function ZS(t,s,r,a){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Fie(t){return t.filter((s,r)=>r===0||s.route.path&&s.route.path.length>0)}function HE(t,s){let r=Fie(t);return s?r.map((a,i)=>i===r.length-1?a.pathname:a.pathnameBase):r.map(a=>a.pathnameBase)}function WE(t,s,r,a){a===void 0&&(a=!1);let i;typeof t=="string"?i=vf(t):(i=Jg({},t),lr(!i.pathname||!i.pathname.includes("?"),ZS("?","pathname","search",i)),lr(!i.pathname||!i.pathname.includes("#"),ZS("#","pathname","hash",i)),lr(!i.search||!i.search.includes("#"),ZS("#","search","hash",i)));let l=t===""||i.pathname==="",o=l?"/":i.pathname,c;if(o==null)c=r;else{let x=s.length-1;if(!a&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),x-=1;i.pathname=g.join("/")}c=x>=0?s[x]:"/"}let d=Rie(i,c),u=o&&o!=="/"&&o.endsWith("/"),m=(l||o===".")&&r.endsWith("/");return!d.pathname.endsWith("/")&&(u||m)&&(d.pathname+="/"),d}const im=t=>t.join("/").replace(/\/\/+/g,"/"),Bie=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),$ie=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,zie=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Uie(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const MU=["post","put","patch","delete"];new Set(MU);const Vie=["get",...MU];new Set(Vie);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function eb(){return eb=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},eb.apply(this,arguments)}const Xw=p.createContext(null),IU=p.createContext(null),au=p.createContext(null),Qw=p.createContext(null),md=p.createContext({outlet:null,matches:[],isDataRoute:!1}),OU=p.createContext(null);function Hie(t,s){let{relative:r}=s===void 0?{}:s;jf()||lr(!1);let{basename:a,navigator:i}=p.useContext(au),{hash:l,pathname:o,search:c}=Zw(t,{relative:r}),d=o;return a!=="/"&&(d=o==="/"?a:im([a,o])),i.createHref({pathname:d,search:c,hash:l})}function jf(){return p.useContext(Qw)!=null}function pi(){return jf()||lr(!1),p.useContext(Qw).location}function RU(t){p.useContext(au).static||p.useLayoutEffect(t)}function Qr(){let{isDataRoute:t}=p.useContext(md);return t?ale():Wie()}function Wie(){jf()||lr(!1);let t=p.useContext(Xw),{basename:s,future:r,navigator:a}=p.useContext(au),{matches:i}=p.useContext(md),{pathname:l}=pi(),o=JSON.stringify(HE(i,r.v7_relativeSplatPath)),c=p.useRef(!1);return RU(()=>{c.current=!0}),p.useCallback(function(u,m){if(m===void 0&&(m={}),!c.current)return;if(typeof u=="number"){a.go(u);return}let x=WE(u,JSON.parse(o),l,m.relative==="path");t==null&&s!=="/"&&(x.pathname=x.pathname==="/"?s:im([s,x.pathname])),(m.replace?a.replace:a.push)(x,m.state,m)},[s,a,o,l,t])}const qie=p.createContext(null);function Gie(t){let s=p.useContext(md).outlet;return s&&p.createElement(qie.Provider,{value:t},s)}function Cm(){let{matches:t}=p.useContext(md),s=t[t.length-1];return s?s.params:{}}function Zw(t,s){let{relative:r}=s===void 0?{}:s,{future:a}=p.useContext(au),{matches:i}=p.useContext(md),{pathname:l}=pi(),o=JSON.stringify(HE(i,a.v7_relativeSplatPath));return p.useMemo(()=>WE(t,JSON.parse(o),l,r==="path"),[t,o,l,r])}function Kie(t,s){return Yie(t,s)}function Yie(t,s,r,a){jf()||lr(!1);let{navigator:i}=p.useContext(au),{matches:l}=p.useContext(md),o=l[l.length-1],c=o?o.params:{};o&&o.pathname;let d=o?o.pathnameBase:"/";o&&o.route;let u=pi(),m;if(s){var x;let w=typeof s=="string"?vf(s):s;d==="/"||(x=w.pathname)!=null&&x.startsWith(d)||lr(!1),m=w}else m=u;let g=m.pathname||"/",y=g;if(d!=="/"){let w=d.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(w.length).join("/")}let v=Nie(t,{pathname:y}),j=ele(v&&v.map(w=>Object.assign({},w,{params:Object.assign({},c,w.params),pathname:im([d,i.encodeLocation?i.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:im([d,i.encodeLocation?i.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),l,r,a);return s&&j?p.createElement(Qw.Provider,{value:{location:eb({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:Gu.Pop}},j):j}function Xie(){let t=rle(),s=Uie(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return p.createElement(p.Fragment,null,p.createElement("h2",null,"Unexpected Application Error!"),p.createElement("h3",{style:{fontStyle:"italic"}},s),r?p.createElement("pre",{style:i},r):null,null)}const Qie=p.createElement(Xie,null);class Zie extends p.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,r){return r.location!==s.location||r.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:r.error,location:r.location,revalidation:s.revalidation||r.revalidation}}componentDidCatch(s,r){console.error("React Router caught the following error during render",s,r)}render(){return this.state.error!==void 0?p.createElement(md.Provider,{value:this.props.routeContext},p.createElement(OU.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Jie(t){let{routeContext:s,match:r,children:a}=t,i=p.useContext(Xw);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),p.createElement(md.Provider,{value:s},a)}function ele(t,s,r,a){var i;if(s===void 0&&(s=[]),r===void 0&&(r=null),a===void 0&&(a=null),t==null){var l;if(!r)return null;if(r.errors)t=r.matches;else if((l=a)!=null&&l.v7_partialHydration&&s.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let o=t,c=(i=r)==null?void 0:i.errors;if(c!=null){let m=o.findIndex(x=>x.route.id&&(c==null?void 0:c[x.route.id])!==void 0);m>=0||lr(!1),o=o.slice(0,Math.min(o.length,m+1))}let d=!1,u=-1;if(r&&a&&a.v7_partialHydration)for(let m=0;m<o.length;m++){let x=o[m];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(u=m),x.route.id){let{loaderData:g,errors:y}=r,v=x.route.loader&&g[x.route.id]===void 0&&(!y||y[x.route.id]===void 0);if(x.route.lazy||v){d=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((m,x,g)=>{let y,v=!1,j=null,w=null;r&&(y=c&&x.route.id?c[x.route.id]:void 0,j=x.route.errorElement||Qie,d&&(u<0&&g===0?(ile("route-fallback"),v=!0,w=null):u===g&&(v=!0,w=x.route.hydrateFallbackElement||null)));let S=s.concat(o.slice(0,g+1)),E=()=>{let k;return y?k=j:v?k=w:x.route.Component?k=p.createElement(x.route.Component,null):x.route.element?k=x.route.element:k=m,p.createElement(Jie,{match:x,routeContext:{outlet:m,matches:S,isDataRoute:r!=null},children:k})};return r&&(x.route.ErrorBoundary||x.route.errorElement||g===0)?p.createElement(Zie,{location:r.location,revalidation:r.revalidation,component:j,error:y,children:E(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):E()},null)}var LU=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(LU||{}),FU=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(FU||{});function tle(t){let s=p.useContext(Xw);return s||lr(!1),s}function sle(t){let s=p.useContext(IU);return s||lr(!1),s}function nle(t){let s=p.useContext(md);return s||lr(!1),s}function BU(t){let s=nle(),r=s.matches[s.matches.length-1];return r.route.id||lr(!1),r.route.id}function rle(){var t;let s=p.useContext(OU),r=sle(),a=BU();return s!==void 0?s:(t=r.errors)==null?void 0:t[a]}function ale(){let{router:t}=tle(LU.UseNavigateStable),s=BU(FU.UseNavigateStable),r=p.useRef(!1);return RU(()=>{r.current=!0}),p.useCallback(function(i,l){l===void 0&&(l={}),r.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,eb({fromRouteId:s},l)))},[t,s])}const TO={};function ile(t,s,r){TO[t]||(TO[t]=!0)}function lle(t,s){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Zj(t){let{to:s,replace:r,state:a,relative:i}=t;jf()||lr(!1);let{future:l,static:o}=p.useContext(au),{matches:c}=p.useContext(md),{pathname:d}=pi(),u=Qr(),m=WE(s,HE(c,l.v7_relativeSplatPath),d,i==="path"),x=JSON.stringify(m);return p.useEffect(()=>u(JSON.parse(x),{replace:r,state:a,relative:i}),[u,x,i,r,a]),null}function qE(t){return Gie(t.context)}function Lt(t){lr(!1)}function ole(t){let{basename:s="/",children:r=null,location:a,navigationType:i=Gu.Pop,navigator:l,static:o=!1,future:c}=t;jf()&&lr(!1);let d=s.replace(/^\/*/,"/"),u=p.useMemo(()=>({basename:d,navigator:l,static:o,future:eb({v7_relativeSplatPath:!1},c)}),[d,c,l,o]);typeof a=="string"&&(a=vf(a));let{pathname:m="/",search:x="",hash:g="",state:y=null,key:v="default"}=a,j=p.useMemo(()=>{let w=Kp(m,d);return w==null?null:{location:{pathname:w,search:x,hash:g,state:y,key:v},navigationType:i}},[d,m,x,g,y,v,i]);return j==null?null:p.createElement(au.Provider,{value:u},p.createElement(Qw.Provider,{children:r,value:j}))}function cle(t){let{children:s,location:r}=t;return Kie(S3(s),r)}new Promise(()=>{});function S3(t,s){s===void 0&&(s=[]);let r=[];return p.Children.forEach(t,(a,i)=>{if(!p.isValidElement(a))return;let l=[...s,i];if(a.type===p.Fragment){r.push.apply(r,S3(a.props.children,l));return}a.type!==Lt&&lr(!1),!a.props.index||!a.props.children||lr(!1);let o={id:a.props.id||l.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(o.children=S3(a.props.children,l)),r.push(o)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jj(){return Jj=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Jj.apply(this,arguments)}function $U(t,s){if(t==null)return{};var r={},a=Object.keys(t),i,l;for(l=0;l<a.length;l++)i=a[l],!(s.indexOf(i)>=0)&&(r[i]=t[i]);return r}function dle(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function ule(t,s){return t.button===0&&(!s||s==="_self")&&!dle(t)}function C3(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((s,r)=>{let a=t[r];return s.concat(Array.isArray(a)?a.map(i=>[r,i]):[[r,a]])},[]))}function mle(t,s){let r=C3(t);return s&&s.forEach((a,i)=>{r.has(i)||s.getAll(i).forEach(l=>{r.append(i,l)})}),r}const hle=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],xle=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],ple="6";try{window.__reactRouterVersion=ple}catch{}const fle=p.createContext({isTransitioning:!1}),gle="startTransition",PO=Iw[gle];function ble(t){let{basename:s,children:r,future:a,window:i}=t,l=p.useRef();l.current==null&&(l.current=yie({window:i,v5Compat:!0}));let o=l.current,[c,d]=p.useState({action:o.action,location:o.location}),{v7_startTransition:u}=a||{},m=p.useCallback(x=>{u&&PO?PO(()=>d(x)):d(x)},[d,u]);return p.useLayoutEffect(()=>o.listen(m),[o,m]),p.useEffect(()=>lle(a),[a]),p.createElement(ole,{basename:s,children:r,location:c.location,navigationType:c.action,navigator:o,future:a})}const yle=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",vle=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ul=p.forwardRef(function(s,r){let{onClick:a,relative:i,reloadDocument:l,replace:o,state:c,target:d,to:u,preventScrollReset:m,viewTransition:x}=s,g=$U(s,hle),{basename:y}=p.useContext(au),v,j=!1;if(typeof u=="string"&&vle.test(u)&&(v=u,yle))try{let k=new URL(window.location.href),A=u.startsWith("//")?new URL(k.protocol+u):new URL(u),I=Kp(A.pathname,y);A.origin===k.origin&&I!=null?u=I+A.search+A.hash:j=!0}catch{}let w=Hie(u,{relative:i}),S=Nle(u,{replace:o,state:c,target:d,preventScrollReset:m,relative:i,viewTransition:x});function E(k){a&&a(k),k.defaultPrevented||S(k)}return p.createElement("a",Jj({},g,{href:v||w,onClick:j||l?a:E,ref:r,target:d}))}),JS=p.forwardRef(function(s,r){let{"aria-current":a="page",caseSensitive:i=!1,className:l="",end:o=!1,style:c,to:d,viewTransition:u,children:m}=s,x=$U(s,xle),g=Zw(d,{relative:x.relative}),y=pi(),v=p.useContext(IU),{navigator:j,basename:w}=p.useContext(au),S=v!=null&&_le(g)&&u===!0,E=j.encodeLocation?j.encodeLocation(g).pathname:g.pathname,k=y.pathname,A=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;i||(k=k.toLowerCase(),A=A?A.toLowerCase():null,E=E.toLowerCase()),A&&w&&(A=Kp(A,w)||A);const I=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let P=k===E||!o&&k.startsWith(E)&&k.charAt(I)==="/",O=A!=null&&(A===E||!o&&A.startsWith(E)&&A.charAt(E.length)==="/"),D={isActive:P,isPending:O,isTransitioning:S},T=P?a:void 0,B;typeof l=="function"?B=l(D):B=[l,P?"active":null,O?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let U=typeof c=="function"?c(D):c;return p.createElement(ul,Jj({},x,{"aria-current":T,className:B,ref:r,style:U,to:d,viewTransition:u}),typeof m=="function"?m(D):m)});var k3;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(k3||(k3={}));var DO;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(DO||(DO={}));function jle(t){let s=p.useContext(Xw);return s||lr(!1),s}function Nle(t,s){let{target:r,replace:a,state:i,preventScrollReset:l,relative:o,viewTransition:c}=s===void 0?{}:s,d=Qr(),u=pi(),m=Zw(t,{relative:o});return p.useCallback(x=>{if(ule(x,r)){x.preventDefault();let g=a!==void 0?a:Qj(u)===Qj(m);d(t,{replace:g,state:i,preventScrollReset:l,relative:o,viewTransition:c})}},[u,d,m,a,i,r,t,l,o,c])}function wle(t){let s=p.useRef(C3(t)),r=p.useRef(!1),a=pi(),i=p.useMemo(()=>mle(a.search,r.current?null:s.current),[a.search]),l=Qr(),o=p.useCallback((c,d)=>{const u=C3(typeof c=="function"?c(i):c);r.current=!0,l("?"+u,d)},[l,i]);return[i,o]}function _le(t,s){s===void 0&&(s={});let r=p.useContext(fle);r==null&&lr(!1);let{basename:a}=jle(k3.useViewTransitionState),i=Zw(t,{relative:s.relative});if(!r.isTransitioning)return!1;let l=Kp(r.currentLocation.pathname,a)||r.currentLocation.pathname,o=Kp(r.nextLocation.pathname,a)||r.nextLocation.pathname;return _3(i.pathname,o)!=null||_3(i.pathname,l)!=null}function zU(t,s){return function(){return t.apply(s,arguments)}}const{toString:Sle}=Object.prototype,{getPrototypeOf:GE}=Object,{iterator:Jw,toStringTag:UU}=Symbol,e2=(t=>s=>{const r=Sle.call(s);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),pc=t=>(t=t.toLowerCase(),s=>e2(s)===t),t2=t=>s=>typeof s===t,{isArray:Nf}=Array,Yp=t2("undefined");function Jb(t){return t!==null&&!Yp(t)&&t.constructor!==null&&!Yp(t.constructor)&&ll(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const VU=pc("ArrayBuffer");function Cle(t){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&VU(t.buffer),s}const kle=t2("string"),ll=t2("function"),HU=t2("number"),ey=t=>t!==null&&typeof t=="object",Ale=t=>t===!0||t===!1,ej=t=>{if(e2(t)!=="object")return!1;const s=GE(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(UU in t)&&!(Jw in t)},Ele=t=>{if(!ey(t)||Jb(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},Tle=pc("Date"),Ple=pc("File"),Dle=pc("Blob"),Mle=pc("FileList"),Ile=t=>ey(t)&&ll(t.pipe),Ole=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||ll(t.append)&&((s=e2(t))==="formdata"||s==="object"&&ll(t.toString)&&t.toString()==="[object FormData]"))},Rle=pc("URLSearchParams"),[Lle,Fle,Ble,$le]=["ReadableStream","Request","Response","Headers"].map(pc),zle=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ty(t,s,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let a,i;if(typeof t!="object"&&(t=[t]),Nf(t))for(a=0,i=t.length;a<i;a++)s.call(null,t[a],a,t);else{if(Jb(t))return;const l=r?Object.getOwnPropertyNames(t):Object.keys(t),o=l.length;let c;for(a=0;a<o;a++)c=l[a],s.call(null,t[c],c,t)}}function WU(t,s){if(Jb(t))return null;s=s.toLowerCase();const r=Object.keys(t);let a=r.length,i;for(;a-- >0;)if(i=r[a],s===i.toLowerCase())return i;return null}const ah=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,qU=t=>!Yp(t)&&t!==ah;function A3(){const{caseless:t,skipUndefined:s}=qU(this)&&this||{},r={},a=(i,l)=>{const o=t&&WU(r,l)||l;ej(r[o])&&ej(i)?r[o]=A3(r[o],i):ej(i)?r[o]=A3({},i):Nf(i)?r[o]=i.slice():(!s||!Yp(i))&&(r[o]=i)};for(let i=0,l=arguments.length;i<l;i++)arguments[i]&&ty(arguments[i],a);return r}const Ule=(t,s,r,{allOwnKeys:a}={})=>(ty(s,(i,l)=>{r&&ll(i)?t[l]=zU(i,r):t[l]=i},{allOwnKeys:a}),t),Vle=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Hle=(t,s,r,a)=>{t.prototype=Object.create(s.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),r&&Object.assign(t.prototype,r)},Wle=(t,s,r,a)=>{let i,l,o;const c={};if(s=s||{},t==null)return s;do{for(i=Object.getOwnPropertyNames(t),l=i.length;l-- >0;)o=i[l],(!a||a(o,t,s))&&!c[o]&&(s[o]=t[o],c[o]=!0);t=r!==!1&&GE(t)}while(t&&(!r||r(t,s))&&t!==Object.prototype);return s},qle=(t,s,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=s.length;const a=t.indexOf(s,r);return a!==-1&&a===r},Gle=t=>{if(!t)return null;if(Nf(t))return t;let s=t.length;if(!HU(s))return null;const r=new Array(s);for(;s-- >0;)r[s]=t[s];return r},Kle=(t=>s=>t&&s instanceof t)(typeof Uint8Array<"u"&&GE(Uint8Array)),Yle=(t,s)=>{const a=(t&&t[Jw]).call(t);let i;for(;(i=a.next())&&!i.done;){const l=i.value;s.call(t,l[0],l[1])}},Xle=(t,s)=>{let r;const a=[];for(;(r=t.exec(s))!==null;)a.push(r);return a},Qle=pc("HTMLFormElement"),Zle=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,a,i){return a.toUpperCase()+i}),MO=(({hasOwnProperty:t})=>(s,r)=>t.call(s,r))(Object.prototype),Jle=pc("RegExp"),GU=(t,s)=>{const r=Object.getOwnPropertyDescriptors(t),a={};ty(r,(i,l)=>{let o;(o=s(i,l,t))!==!1&&(a[l]=o||i)}),Object.defineProperties(t,a)},eoe=t=>{GU(t,(s,r)=>{if(ll(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=t[r];if(ll(a)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},toe=(t,s)=>{const r={},a=i=>{i.forEach(l=>{r[l]=!0})};return Nf(t)?a(t):a(String(t).split(s)),r},soe=()=>{},noe=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function roe(t){return!!(t&&ll(t.append)&&t[UU]==="FormData"&&t[Jw])}const aoe=t=>{const s=new Array(10),r=(a,i)=>{if(ey(a)){if(s.indexOf(a)>=0)return;if(Jb(a))return a;if(!("toJSON"in a)){s[i]=a;const l=Nf(a)?[]:{};return ty(a,(o,c)=>{const d=r(o,i+1);!Yp(d)&&(l[c]=d)}),s[i]=void 0,l}}return a};return r(t,0)},ioe=pc("AsyncFunction"),loe=t=>t&&(ey(t)||ll(t))&&ll(t.then)&&ll(t.catch),KU=((t,s)=>t?setImmediate:s?((r,a)=>(ah.addEventListener("message",({source:i,data:l})=>{i===ah&&l===r&&a.length&&a.shift()()},!1),i=>{a.push(i),ah.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ll(ah.postMessage)),ooe=typeof queueMicrotask<"u"?queueMicrotask.bind(ah):typeof process<"u"&&process.nextTick||KU,coe=t=>t!=null&&ll(t[Jw]),rt={isArray:Nf,isArrayBuffer:VU,isBuffer:Jb,isFormData:Ole,isArrayBufferView:Cle,isString:kle,isNumber:HU,isBoolean:Ale,isObject:ey,isPlainObject:ej,isEmptyObject:Ele,isReadableStream:Lle,isRequest:Fle,isResponse:Ble,isHeaders:$le,isUndefined:Yp,isDate:Tle,isFile:Ple,isBlob:Dle,isRegExp:Jle,isFunction:ll,isStream:Ile,isURLSearchParams:Rle,isTypedArray:Kle,isFileList:Mle,forEach:ty,merge:A3,extend:Ule,trim:zle,stripBOM:Vle,inherits:Hle,toFlatObject:Wle,kindOf:e2,kindOfTest:pc,endsWith:qle,toArray:Gle,forEachEntry:Yle,matchAll:Xle,isHTMLForm:Qle,hasOwnProperty:MO,hasOwnProp:MO,reduceDescriptors:GU,freezeMethods:eoe,toObjectSet:toe,toCamelCase:Zle,noop:soe,toFiniteNumber:noe,findKey:WU,global:ah,isContextDefined:qU,isSpecCompliantForm:roe,toJSONObject:aoe,isAsyncFn:ioe,isThenable:loe,setImmediate:KU,asap:ooe,isIterable:coe};function ws(t,s,r,a,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),r&&(this.config=r),a&&(this.request=a),i&&(this.response=i,this.status=i.status?i.status:null)}rt.inherits(ws,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:rt.toJSONObject(this.config),code:this.code,status:this.status}}});const YU=ws.prototype,XU={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{XU[t]={value:t}});Object.defineProperties(ws,XU);Object.defineProperty(YU,"isAxiosError",{value:!0});ws.from=(t,s,r,a,i,l)=>{const o=Object.create(YU);rt.toFlatObject(t,o,function(m){return m!==Error.prototype},u=>u!=="isAxiosError");const c=t&&t.message?t.message:"Error",d=s==null&&t?t.code:s;return ws.call(o,c,d,r,a,i),t&&o.cause==null&&Object.defineProperty(o,"cause",{value:t,configurable:!0}),o.name=t&&t.name||"Error",l&&Object.assign(o,l),o};const doe=null;function E3(t){return rt.isPlainObject(t)||rt.isArray(t)}function QU(t){return rt.endsWith(t,"[]")?t.slice(0,-2):t}function IO(t,s,r){return t?t.concat(s).map(function(i,l){return i=QU(i),!r&&l?"["+i+"]":i}).join(r?".":""):s}function uoe(t){return rt.isArray(t)&&!t.some(E3)}const moe=rt.toFlatObject(rt,{},null,function(s){return/^is[A-Z]/.test(s)});function s2(t,s,r){if(!rt.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,r=rt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(j,w){return!rt.isUndefined(w[j])});const a=r.metaTokens,i=r.visitor||m,l=r.dots,o=r.indexes,d=(r.Blob||typeof Blob<"u"&&Blob)&&rt.isSpecCompliantForm(s);if(!rt.isFunction(i))throw new TypeError("visitor must be a function");function u(v){if(v===null)return"";if(rt.isDate(v))return v.toISOString();if(rt.isBoolean(v))return v.toString();if(!d&&rt.isBlob(v))throw new ws("Blob is not supported. Use a Buffer instead.");return rt.isArrayBuffer(v)||rt.isTypedArray(v)?d&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function m(v,j,w){let S=v;if(v&&!w&&typeof v=="object"){if(rt.endsWith(j,"{}"))j=a?j:j.slice(0,-2),v=JSON.stringify(v);else if(rt.isArray(v)&&uoe(v)||(rt.isFileList(v)||rt.endsWith(j,"[]"))&&(S=rt.toArray(v)))return j=QU(j),S.forEach(function(k,A){!(rt.isUndefined(k)||k===null)&&s.append(o===!0?IO([j],A,l):o===null?j:j+"[]",u(k))}),!1}return E3(v)?!0:(s.append(IO(w,j,l),u(v)),!1)}const x=[],g=Object.assign(moe,{defaultVisitor:m,convertValue:u,isVisitable:E3});function y(v,j){if(!rt.isUndefined(v)){if(x.indexOf(v)!==-1)throw Error("Circular reference detected in "+j.join("."));x.push(v),rt.forEach(v,function(S,E){(!(rt.isUndefined(S)||S===null)&&i.call(s,S,rt.isString(E)?E.trim():E,j,g))===!0&&y(S,j?j.concat(E):[E])}),x.pop()}}if(!rt.isObject(t))throw new TypeError("data must be an object");return y(t),s}function OO(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(a){return s[a]})}function KE(t,s){this._pairs=[],t&&s2(t,this,s)}const ZU=KE.prototype;ZU.append=function(s,r){this._pairs.push([s,r])};ZU.toString=function(s){const r=s?function(a){return s.call(this,a,OO)}:OO;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};function hoe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function JU(t,s,r){if(!s)return t;const a=r&&r.encode||hoe;rt.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let l;if(i?l=i(s,r):l=rt.isURLSearchParams(s)?s.toString():new KE(s,r).toString(a),l){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+l}return t}class RO{constructor(){this.handlers=[]}use(s,r,a){return this.handlers.push({fulfilled:s,rejected:r,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){rt.forEach(this.handlers,function(a){a!==null&&s(a)})}}const eV={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xoe=typeof URLSearchParams<"u"?URLSearchParams:KE,poe=typeof FormData<"u"?FormData:null,foe=typeof Blob<"u"?Blob:null,goe={isBrowser:!0,classes:{URLSearchParams:xoe,FormData:poe,Blob:foe},protocols:["http","https","file","blob","url","data"]},YE=typeof window<"u"&&typeof document<"u",T3=typeof navigator=="object"&&navigator||void 0,boe=YE&&(!T3||["ReactNative","NativeScript","NS"].indexOf(T3.product)<0),yoe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",voe=YE&&window.location.href||"http://localhost",joe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:YE,hasStandardBrowserEnv:boe,hasStandardBrowserWebWorkerEnv:yoe,navigator:T3,origin:voe},Symbol.toStringTag,{value:"Module"})),ni={...joe,...goe};function Noe(t,s){return s2(t,new ni.classes.URLSearchParams,{visitor:function(r,a,i,l){return ni.isNode&&rt.isBuffer(r)?(this.append(a,r.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...s})}function woe(t){return rt.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function _oe(t){const s={},r=Object.keys(t);let a;const i=r.length;let l;for(a=0;a<i;a++)l=r[a],s[l]=t[l];return s}function tV(t){function s(r,a,i,l){let o=r[l++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),d=l>=r.length;return o=!o&&rt.isArray(i)?i.length:o,d?(rt.hasOwnProp(i,o)?i[o]=[i[o],a]:i[o]=a,!c):((!i[o]||!rt.isObject(i[o]))&&(i[o]=[]),s(r,a,i[o],l)&&rt.isArray(i[o])&&(i[o]=_oe(i[o])),!c)}if(rt.isFormData(t)&&rt.isFunction(t.entries)){const r={};return rt.forEachEntry(t,(a,i)=>{s(woe(a),i,r,0)}),r}return null}function Soe(t,s,r){if(rt.isString(t))try{return(s||JSON.parse)(t),rt.trim(t)}catch(a){if(a.name!=="SyntaxError")throw a}return(r||JSON.stringify)(t)}const sy={transitional:eV,adapter:["xhr","http","fetch"],transformRequest:[function(s,r){const a=r.getContentType()||"",i=a.indexOf("application/json")>-1,l=rt.isObject(s);if(l&&rt.isHTMLForm(s)&&(s=new FormData(s)),rt.isFormData(s))return i?JSON.stringify(tV(s)):s;if(rt.isArrayBuffer(s)||rt.isBuffer(s)||rt.isStream(s)||rt.isFile(s)||rt.isBlob(s)||rt.isReadableStream(s))return s;if(rt.isArrayBufferView(s))return s.buffer;if(rt.isURLSearchParams(s))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let c;if(l){if(a.indexOf("application/x-www-form-urlencoded")>-1)return Noe(s,this.formSerializer).toString();if((c=rt.isFileList(s))||a.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return s2(c?{"files[]":s}:s,d&&new d,this.formSerializer)}}return l||i?(r.setContentType("application/json",!1),Soe(s)):s}],transformResponse:[function(s){const r=this.transitional||sy.transitional,a=r&&r.forcedJSONParsing,i=this.responseType==="json";if(rt.isResponse(s)||rt.isReadableStream(s))return s;if(s&&rt.isString(s)&&(a&&!this.responseType||i)){const o=!(r&&r.silentJSONParsing)&&i;try{return JSON.parse(s,this.parseReviver)}catch(c){if(o)throw c.name==="SyntaxError"?ws.from(c,ws.ERR_BAD_RESPONSE,this,null,this.response):c}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ni.classes.FormData,Blob:ni.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};rt.forEach(["delete","get","head","post","put","patch"],t=>{sy.headers[t]={}});const Coe=rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),koe=t=>{const s={};let r,a,i;return t&&t.split(`
`).forEach(function(o){i=o.indexOf(":"),r=o.substring(0,i).trim().toLowerCase(),a=o.substring(i+1).trim(),!(!r||s[r]&&Coe[r])&&(r==="set-cookie"?s[r]?s[r].push(a):s[r]=[a]:s[r]=s[r]?s[r]+", "+a:a)}),s},LO=Symbol("internals");function m0(t){return t&&String(t).trim().toLowerCase()}function tj(t){return t===!1||t==null?t:rt.isArray(t)?t.map(tj):String(t)}function Aoe(t){const s=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=r.exec(t);)s[a[1]]=a[2];return s}const Eoe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function eC(t,s,r,a,i){if(rt.isFunction(a))return a.call(this,s,r);if(i&&(s=r),!!rt.isString(s)){if(rt.isString(a))return s.indexOf(a)!==-1;if(rt.isRegExp(a))return a.test(s)}}function Toe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,r,a)=>r.toUpperCase()+a)}function Poe(t,s){const r=rt.toCamelCase(" "+s);["get","set","has"].forEach(a=>{Object.defineProperty(t,a+r,{value:function(i,l,o){return this[a].call(this,s,i,l,o)},configurable:!0})})}let ol=class{constructor(s){s&&this.set(s)}set(s,r,a){const i=this;function l(c,d,u){const m=m0(d);if(!m)throw new Error("header name must be a non-empty string");const x=rt.findKey(i,m);(!x||i[x]===void 0||u===!0||u===void 0&&i[x]!==!1)&&(i[x||d]=tj(c))}const o=(c,d)=>rt.forEach(c,(u,m)=>l(u,m,d));if(rt.isPlainObject(s)||s instanceof this.constructor)o(s,r);else if(rt.isString(s)&&(s=s.trim())&&!Eoe(s))o(koe(s),r);else if(rt.isObject(s)&&rt.isIterable(s)){let c={},d,u;for(const m of s){if(!rt.isArray(m))throw TypeError("Object iterator must return a key-value pair");c[u=m[0]]=(d=c[u])?rt.isArray(d)?[...d,m[1]]:[d,m[1]]:m[1]}o(c,r)}else s!=null&&l(r,s,a);return this}get(s,r){if(s=m0(s),s){const a=rt.findKey(this,s);if(a){const i=this[a];if(!r)return i;if(r===!0)return Aoe(i);if(rt.isFunction(r))return r.call(this,i,a);if(rt.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,r){if(s=m0(s),s){const a=rt.findKey(this,s);return!!(a&&this[a]!==void 0&&(!r||eC(this,this[a],a,r)))}return!1}delete(s,r){const a=this;let i=!1;function l(o){if(o=m0(o),o){const c=rt.findKey(a,o);c&&(!r||eC(a,a[c],c,r))&&(delete a[c],i=!0)}}return rt.isArray(s)?s.forEach(l):l(s),i}clear(s){const r=Object.keys(this);let a=r.length,i=!1;for(;a--;){const l=r[a];(!s||eC(this,this[l],l,s,!0))&&(delete this[l],i=!0)}return i}normalize(s){const r=this,a={};return rt.forEach(this,(i,l)=>{const o=rt.findKey(a,l);if(o){r[o]=tj(i),delete r[l];return}const c=s?Toe(l):String(l).trim();c!==l&&delete r[l],r[c]=tj(i),a[c]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const r=Object.create(null);return rt.forEach(this,(a,i)=>{a!=null&&a!==!1&&(r[i]=s&&rt.isArray(a)?a.join(", "):a)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,r])=>s+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...r){const a=new this(s);return r.forEach(i=>a.set(i)),a}static accessor(s){const a=(this[LO]=this[LO]={accessors:{}}).accessors,i=this.prototype;function l(o){const c=m0(o);a[c]||(Poe(i,o),a[c]=!0)}return rt.isArray(s)?s.forEach(l):l(s),this}};ol.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);rt.reduceDescriptors(ol.prototype,({value:t},s)=>{let r=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(a){this[r]=a}}});rt.freezeMethods(ol);function tC(t,s){const r=this||sy,a=s||r,i=ol.from(a.headers);let l=a.data;return rt.forEach(t,function(c){l=c.call(r,l,i.normalize(),s?s.status:void 0)}),i.normalize(),l}function sV(t){return!!(t&&t.__CANCEL__)}function wf(t,s,r){ws.call(this,t??"canceled",ws.ERR_CANCELED,s,r),this.name="CanceledError"}rt.inherits(wf,ws,{__CANCEL__:!0});function nV(t,s,r){const a=r.config.validateStatus;!r.status||!a||a(r.status)?t(r):s(new ws("Request failed with status code "+r.status,[ws.ERR_BAD_REQUEST,ws.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Doe(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function Moe(t,s){t=t||10;const r=new Array(t),a=new Array(t);let i=0,l=0,o;return s=s!==void 0?s:1e3,function(d){const u=Date.now(),m=a[l];o||(o=u),r[i]=d,a[i]=u;let x=l,g=0;for(;x!==i;)g+=r[x++],x=x%t;if(i=(i+1)%t,i===l&&(l=(l+1)%t),u-o<s)return;const y=m&&u-m;return y?Math.round(g*1e3/y):void 0}}function Ioe(t,s){let r=0,a=1e3/s,i,l;const o=(u,m=Date.now())=>{r=m,i=null,l&&(clearTimeout(l),l=null),t(...u)};return[(...u)=>{const m=Date.now(),x=m-r;x>=a?o(u,m):(i=u,l||(l=setTimeout(()=>{l=null,o(i)},a-x)))},()=>i&&o(i)]}const eN=(t,s,r=3)=>{let a=0;const i=Moe(50,250);return Ioe(l=>{const o=l.loaded,c=l.lengthComputable?l.total:void 0,d=o-a,u=i(d),m=o<=c;a=o;const x={loaded:o,total:c,progress:c?o/c:void 0,bytes:d,rate:u||void 0,estimated:u&&c&&m?(c-o)/u:void 0,event:l,lengthComputable:c!=null,[s?"download":"upload"]:!0};t(x)},r)},FO=(t,s)=>{const r=t!=null;return[a=>s[0]({lengthComputable:r,total:t,loaded:a}),s[1]]},BO=t=>(...s)=>rt.asap(()=>t(...s)),Ooe=ni.hasStandardBrowserEnv?((t,s)=>r=>(r=new URL(r,ni.origin),t.protocol===r.protocol&&t.host===r.host&&(s||t.port===r.port)))(new URL(ni.origin),ni.navigator&&/(msie|trident)/i.test(ni.navigator.userAgent)):()=>!0,Roe=ni.hasStandardBrowserEnv?{write(t,s,r,a,i,l){const o=[t+"="+encodeURIComponent(s)];rt.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),rt.isString(a)&&o.push("path="+a),rt.isString(i)&&o.push("domain="+i),l===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const s=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Loe(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Foe(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function rV(t,s,r){let a=!Loe(s);return t&&(a||r==!1)?Foe(t,s):s}const $O=t=>t instanceof ol?{...t}:t;function Vh(t,s){s=s||{};const r={};function a(u,m,x,g){return rt.isPlainObject(u)&&rt.isPlainObject(m)?rt.merge.call({caseless:g},u,m):rt.isPlainObject(m)?rt.merge({},m):rt.isArray(m)?m.slice():m}function i(u,m,x,g){if(rt.isUndefined(m)){if(!rt.isUndefined(u))return a(void 0,u,x,g)}else return a(u,m,x,g)}function l(u,m){if(!rt.isUndefined(m))return a(void 0,m)}function o(u,m){if(rt.isUndefined(m)){if(!rt.isUndefined(u))return a(void 0,u)}else return a(void 0,m)}function c(u,m,x){if(x in s)return a(u,m);if(x in t)return a(void 0,u)}const d={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(u,m,x)=>i($O(u),$O(m),x,!0)};return rt.forEach(Object.keys({...t,...s}),function(m){const x=d[m]||i,g=x(t[m],s[m],m);rt.isUndefined(g)&&x!==c||(r[m]=g)}),r}const aV=t=>{const s=Vh({},t);let{data:r,withXSRFToken:a,xsrfHeaderName:i,xsrfCookieName:l,headers:o,auth:c}=s;if(s.headers=o=ol.from(o),s.url=JU(rV(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),rt.isFormData(r)){if(ni.hasStandardBrowserEnv||ni.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(rt.isFunction(r.getHeaders)){const d=r.getHeaders(),u=["content-type","content-length"];Object.entries(d).forEach(([m,x])=>{u.includes(m.toLowerCase())&&o.set(m,x)})}}if(ni.hasStandardBrowserEnv&&(a&&rt.isFunction(a)&&(a=a(s)),a||a!==!1&&Ooe(s.url))){const d=i&&l&&Roe.read(l);d&&o.set(i,d)}return s},Boe=typeof XMLHttpRequest<"u",$oe=Boe&&function(t){return new Promise(function(r,a){const i=aV(t);let l=i.data;const o=ol.from(i.headers).normalize();let{responseType:c,onUploadProgress:d,onDownloadProgress:u}=i,m,x,g,y,v;function j(){y&&y(),v&&v(),i.cancelToken&&i.cancelToken.unsubscribe(m),i.signal&&i.signal.removeEventListener("abort",m)}let w=new XMLHttpRequest;w.open(i.method.toUpperCase(),i.url,!0),w.timeout=i.timeout;function S(){if(!w)return;const k=ol.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),I={data:!c||c==="text"||c==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:k,config:t,request:w};nV(function(O){r(O),j()},function(O){a(O),j()},I),w=null}"onloadend"in w?w.onloadend=S:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(S)},w.onabort=function(){w&&(a(new ws("Request aborted",ws.ECONNABORTED,t,w)),w=null)},w.onerror=function(A){const I=A&&A.message?A.message:"Network Error",P=new ws(I,ws.ERR_NETWORK,t,w);P.event=A||null,a(P),w=null},w.ontimeout=function(){let A=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const I=i.transitional||eV;i.timeoutErrorMessage&&(A=i.timeoutErrorMessage),a(new ws(A,I.clarifyTimeoutError?ws.ETIMEDOUT:ws.ECONNABORTED,t,w)),w=null},l===void 0&&o.setContentType(null),"setRequestHeader"in w&&rt.forEach(o.toJSON(),function(A,I){w.setRequestHeader(I,A)}),rt.isUndefined(i.withCredentials)||(w.withCredentials=!!i.withCredentials),c&&c!=="json"&&(w.responseType=i.responseType),u&&([g,v]=eN(u,!0),w.addEventListener("progress",g)),d&&w.upload&&([x,y]=eN(d),w.upload.addEventListener("progress",x),w.upload.addEventListener("loadend",y)),(i.cancelToken||i.signal)&&(m=k=>{w&&(a(!k||k.type?new wf(null,t,w):k),w.abort(),w=null)},i.cancelToken&&i.cancelToken.subscribe(m),i.signal&&(i.signal.aborted?m():i.signal.addEventListener("abort",m)));const E=Doe(i.url);if(E&&ni.protocols.indexOf(E)===-1){a(new ws("Unsupported protocol "+E+":",ws.ERR_BAD_REQUEST,t));return}w.send(l||null)})},zoe=(t,s)=>{const{length:r}=t=t?t.filter(Boolean):[];if(s||r){let a=new AbortController,i;const l=function(u){if(!i){i=!0,c();const m=u instanceof Error?u:this.reason;a.abort(m instanceof ws?m:new wf(m instanceof Error?m.message:m))}};let o=s&&setTimeout(()=>{o=null,l(new ws(`timeout ${s} of ms exceeded`,ws.ETIMEDOUT))},s);const c=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),t=null)};t.forEach(u=>u.addEventListener("abort",l));const{signal:d}=a;return d.unsubscribe=()=>rt.asap(c),d}},Uoe=function*(t,s){let r=t.byteLength;if(r<s){yield t;return}let a=0,i;for(;a<r;)i=a+s,yield t.slice(a,i),a=i},Voe=async function*(t,s){for await(const r of Hoe(t))yield*Uoe(r,s)},Hoe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const s=t.getReader();try{for(;;){const{done:r,value:a}=await s.read();if(r)break;yield a}}finally{await s.cancel()}},zO=(t,s,r,a)=>{const i=Voe(t,s);let l=0,o,c=d=>{o||(o=!0,a&&a(d))};return new ReadableStream({async pull(d){try{const{done:u,value:m}=await i.next();if(u){c(),d.close();return}let x=m.byteLength;if(r){let g=l+=x;r(g)}d.enqueue(new Uint8Array(m))}catch(u){throw c(u),u}},cancel(d){return c(d),i.return()}},{highWaterMark:2})},UO=64*1024,{isFunction:i1}=rt,Woe=(({Request:t,Response:s})=>({Request:t,Response:s}))(rt.global),{ReadableStream:VO,TextEncoder:HO}=rt.global,WO=(t,...s)=>{try{return!!t(...s)}catch{return!1}},qoe=t=>{t=rt.merge.call({skipUndefined:!0},Woe,t);const{fetch:s,Request:r,Response:a}=t,i=s?i1(s):typeof fetch=="function",l=i1(r),o=i1(a);if(!i)return!1;const c=i&&i1(VO),d=i&&(typeof HO=="function"?(v=>j=>v.encode(j))(new HO):async v=>new Uint8Array(await new r(v).arrayBuffer())),u=l&&c&&WO(()=>{let v=!1;const j=new r(ni.origin,{body:new VO,method:"POST",get duplex(){return v=!0,"half"}}).headers.has("Content-Type");return v&&!j}),m=o&&c&&WO(()=>rt.isReadableStream(new a("").body)),x={stream:m&&(v=>v.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(v=>{!x[v]&&(x[v]=(j,w)=>{let S=j&&j[v];if(S)return S.call(j);throw new ws(`Response type '${v}' is not supported`,ws.ERR_NOT_SUPPORT,w)})});const g=async v=>{if(v==null)return 0;if(rt.isBlob(v))return v.size;if(rt.isSpecCompliantForm(v))return(await new r(ni.origin,{method:"POST",body:v}).arrayBuffer()).byteLength;if(rt.isArrayBufferView(v)||rt.isArrayBuffer(v))return v.byteLength;if(rt.isURLSearchParams(v)&&(v=v+""),rt.isString(v))return(await d(v)).byteLength},y=async(v,j)=>{const w=rt.toFiniteNumber(v.getContentLength());return w??g(j)};return async v=>{let{url:j,method:w,data:S,signal:E,cancelToken:k,timeout:A,onDownloadProgress:I,onUploadProgress:P,responseType:O,headers:D,withCredentials:T="same-origin",fetchOptions:B}=aV(v),U=s||fetch;O=O?(O+"").toLowerCase():"text";let W=zoe([E,k&&k.toAbortSignal()],A),V=null;const R=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let F;try{if(P&&u&&w!=="get"&&w!=="head"&&(F=await y(D,S))!==0){let se=new r(j,{method:"POST",body:S,duplex:"half"}),J;if(rt.isFormData(S)&&(J=se.headers.get("content-type"))&&D.setContentType(J),se.body){const[ie,te]=FO(F,eN(BO(P)));S=zO(se.body,UO,ie,te)}}rt.isString(T)||(T=T?"include":"omit");const G=l&&"credentials"in r.prototype,H={...B,signal:W,method:w.toUpperCase(),headers:D.normalize().toJSON(),body:S,duplex:"half",credentials:G?T:void 0};V=l&&new r(j,H);let $=await(l?U(V,B):U(j,H));const K=m&&(O==="stream"||O==="response");if(m&&(I||K&&R)){const se={};["status","statusText","headers"].forEach(ne=>{se[ne]=$[ne]});const J=rt.toFiniteNumber($.headers.get("content-length")),[ie,te]=I&&FO(J,eN(BO(I),!0))||[];$=new a(zO($.body,UO,ie,()=>{te&&te(),R&&R()}),se)}O=O||"text";let le=await x[rt.findKey(x,O)||"text"]($,v);return!K&&R&&R(),await new Promise((se,J)=>{nV(se,J,{data:le,headers:ol.from($.headers),status:$.status,statusText:$.statusText,config:v,request:V})})}catch(G){throw R&&R(),G&&G.name==="TypeError"&&/Load failed|fetch/i.test(G.message)?Object.assign(new ws("Network Error",ws.ERR_NETWORK,v,V),{cause:G.cause||G}):ws.from(G,G&&G.code,v,V)}}},Goe=new Map,iV=t=>{let s=t?t.env:{};const{fetch:r,Request:a,Response:i}=s,l=[a,i,r];let o=l.length,c=o,d,u,m=Goe;for(;c--;)d=l[c],u=m.get(d),u===void 0&&m.set(d,u=c?new Map:qoe(s)),m=u;return u};iV();const P3={http:doe,xhr:$oe,fetch:{get:iV}};rt.forEach(P3,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch{}Object.defineProperty(t,"adapterName",{value:s})}});const qO=t=>`- ${t}`,Koe=t=>rt.isFunction(t)||t===null||t===!1,lV={getAdapter:(t,s)=>{t=rt.isArray(t)?t:[t];const{length:r}=t;let a,i;const l={};for(let o=0;o<r;o++){a=t[o];let c;if(i=a,!Koe(a)&&(i=P3[(c=String(a)).toLowerCase()],i===void 0))throw new ws(`Unknown adapter '${c}'`);if(i&&(rt.isFunction(i)||(i=i.get(s))))break;l[c||"#"+o]=i}if(!i){const o=Object.entries(l).map(([d,u])=>`adapter ${d} `+(u===!1?"is not supported by the environment":"is not available in the build"));let c=r?o.length>1?`since :
`+o.map(qO).join(`
`):" "+qO(o[0]):"as no adapter specified";throw new ws("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return i},adapters:P3};function sC(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new wf(null,t)}function GO(t){return sC(t),t.headers=ol.from(t.headers),t.data=tC.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),lV.getAdapter(t.adapter||sy.adapter,t)(t).then(function(a){return sC(t),a.data=tC.call(t,t.transformResponse,a),a.headers=ol.from(a.headers),a},function(a){return sV(a)||(sC(t),a&&a.response&&(a.response.data=tC.call(t,t.transformResponse,a.response),a.response.headers=ol.from(a.response.headers))),Promise.reject(a)})}const oV="1.12.2",n2={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{n2[t]=function(a){return typeof a===t||"a"+(s<1?"n ":" ")+t}});const KO={};n2.transitional=function(s,r,a){function i(l,o){return"[Axios v"+oV+"] Transitional option '"+l+"'"+o+(a?". "+a:"")}return(l,o,c)=>{if(s===!1)throw new ws(i(o," has been removed"+(r?" in "+r:"")),ws.ERR_DEPRECATED);return r&&!KO[o]&&(KO[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),s?s(l,o,c):!0}};n2.spelling=function(s){return(r,a)=>(console.warn(`${a} is likely a misspelling of ${s}`),!0)};function Yoe(t,s,r){if(typeof t!="object")throw new ws("options must be an object",ws.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let i=a.length;for(;i-- >0;){const l=a[i],o=s[l];if(o){const c=t[l],d=c===void 0||o(c,l,t);if(d!==!0)throw new ws("option "+l+" must be "+d,ws.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new ws("Unknown option "+l,ws.ERR_BAD_OPTION)}}const sj={assertOptions:Yoe,validators:n2},Tc=sj.validators;let bh=class{constructor(s){this.defaults=s||{},this.interceptors={request:new RO,response:new RO}}async request(s,r){try{return await this._request(s,r)}catch(a){if(a instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const l=i.stack?i.stack.replace(/^.+\n/,""):"";try{a.stack?l&&!String(a.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+l):a.stack=l}catch{}}throw a}}_request(s,r){typeof s=="string"?(r=r||{},r.url=s):r=s||{},r=Vh(this.defaults,r);const{transitional:a,paramsSerializer:i,headers:l}=r;a!==void 0&&sj.assertOptions(a,{silentJSONParsing:Tc.transitional(Tc.boolean),forcedJSONParsing:Tc.transitional(Tc.boolean),clarifyTimeoutError:Tc.transitional(Tc.boolean)},!1),i!=null&&(rt.isFunction(i)?r.paramsSerializer={serialize:i}:sj.assertOptions(i,{encode:Tc.function,serialize:Tc.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),sj.assertOptions(r,{baseUrl:Tc.spelling("baseURL"),withXsrfToken:Tc.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o=l&&rt.merge(l.common,l[r.method]);l&&rt.forEach(["delete","get","head","post","put","patch","common"],v=>{delete l[v]}),r.headers=ol.concat(o,l);const c=[];let d=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(r)===!1||(d=d&&j.synchronous,c.unshift(j.fulfilled,j.rejected))});const u=[];this.interceptors.response.forEach(function(j){u.push(j.fulfilled,j.rejected)});let m,x=0,g;if(!d){const v=[GO.bind(this),void 0];for(v.unshift(...c),v.push(...u),g=v.length,m=Promise.resolve(r);x<g;)m=m.then(v[x++],v[x++]);return m}g=c.length;let y=r;for(;x<g;){const v=c[x++],j=c[x++];try{y=v(y)}catch(w){j.call(this,w);break}}try{m=GO.call(this,y)}catch(v){return Promise.reject(v)}for(x=0,g=u.length;x<g;)m=m.then(u[x++],u[x++]);return m}getUri(s){s=Vh(this.defaults,s);const r=rV(s.baseURL,s.url,s.allowAbsoluteUrls);return JU(r,s.params,s.paramsSerializer)}};rt.forEach(["delete","get","head","options"],function(s){bh.prototype[s]=function(r,a){return this.request(Vh(a||{},{method:s,url:r,data:(a||{}).data}))}});rt.forEach(["post","put","patch"],function(s){function r(a){return function(l,o,c){return this.request(Vh(c||{},{method:s,headers:a?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}bh.prototype[s]=r(),bh.prototype[s+"Form"]=r(!0)});let Xoe=class cV{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(l){r=l});const a=this;this.promise.then(i=>{if(!a._listeners)return;let l=a._listeners.length;for(;l-- >0;)a._listeners[l](i);a._listeners=null}),this.promise.then=i=>{let l;const o=new Promise(c=>{a.subscribe(c),l=c}).then(i);return o.cancel=function(){a.unsubscribe(l)},o},s(function(l,o,c){a.reason||(a.reason=new wf(l,o,c),r(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const r=this._listeners.indexOf(s);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const s=new AbortController,r=a=>{s.abort(a)};return this.subscribe(r),s.signal.unsubscribe=()=>this.unsubscribe(r),s.signal}static source(){let s;return{token:new cV(function(i){s=i}),cancel:s}}};function Qoe(t){return function(r){return t.apply(null,r)}}function Zoe(t){return rt.isObject(t)&&t.isAxiosError===!0}const D3={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(D3).forEach(([t,s])=>{D3[s]=t});function dV(t){const s=new bh(t),r=zU(bh.prototype.request,s);return rt.extend(r,bh.prototype,s,{allOwnKeys:!0}),rt.extend(r,s,null,{allOwnKeys:!0}),r.create=function(i){return dV(Vh(t,i))},r}const Dr=dV(sy);Dr.Axios=bh;Dr.CanceledError=wf;Dr.CancelToken=Xoe;Dr.isCancel=sV;Dr.VERSION=oV;Dr.toFormData=s2;Dr.AxiosError=ws;Dr.Cancel=Dr.CanceledError;Dr.all=function(s){return Promise.all(s)};Dr.spread=Qoe;Dr.isAxiosError=Zoe;Dr.mergeConfig=Vh;Dr.AxiosHeaders=ol;Dr.formToJSON=t=>tV(rt.isHTMLForm(t)?new FormData(t):t);Dr.getAdapter=lV.getAdapter;Dr.HttpStatusCode=D3;Dr.default=Dr;const{Axios:SZe,AxiosError:CZe,CanceledError:kZe,isCancel:AZe,CancelToken:EZe,VERSION:TZe,all:PZe,Cancel:DZe,isAxiosError:MZe,spread:IZe,toFormData:OZe,AxiosHeaders:RZe,HttpStatusCode:LZe,formToJSON:FZe,getAdapter:BZe,mergeConfig:$Ze}=Dr;function Joe(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",s.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const ece=t=>{switch(t){case"success":return nce;case"info":return ace;case"warning":return rce;case"error":return ice;default:return null}},tce=Array(12).fill(0),sce=({visible:t,className:s})=>_t.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":t},_t.createElement("div",{className:"sonner-spinner"},tce.map((r,a)=>_t.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),nce=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),rce=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ace=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),ice=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},_t.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),lce=_t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},_t.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_t.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),oce=()=>{const[t,s]=_t.useState(document.hidden);return _t.useEffect(()=>{const r=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),t};let M3=1;class cce{constructor(){this.subscribe=s=>(this.subscribers.push(s),()=>{const r=this.subscribers.indexOf(s);this.subscribers.splice(r,1)}),this.publish=s=>{this.subscribers.forEach(r=>r(s))},this.addToast=s=>{this.publish(s),this.toasts=[...this.toasts,s]},this.create=s=>{var r;const{message:a,...i}=s,l=typeof(s==null?void 0:s.id)=="number"||((r=s.id)==null?void 0:r.length)>0?s.id:M3++,o=this.toasts.find(d=>d.id===l),c=s.dismissible===void 0?!0:s.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),o?this.toasts=this.toasts.map(d=>d.id===l?(this.publish({...d,...s,id:l,title:a}),{...d,...s,id:l,dismissible:c,title:a}):d):this.addToast({title:a,...i,dismissible:c,id:l}),l},this.dismiss=s=>(s?(this.dismissedToasts.add(s),requestAnimationFrame(()=>this.subscribers.forEach(r=>r({id:s,dismiss:!0})))):this.toasts.forEach(r=>{this.subscribers.forEach(a=>a({id:r.id,dismiss:!0}))}),s),this.message=(s,r)=>this.create({...r,message:s}),this.error=(s,r)=>this.create({...r,message:s,type:"error"}),this.success=(s,r)=>this.create({...r,type:"success",message:s}),this.info=(s,r)=>this.create({...r,type:"info",message:s}),this.warning=(s,r)=>this.create({...r,type:"warning",message:s}),this.loading=(s,r)=>this.create({...r,type:"loading",message:s}),this.promise=(s,r)=>{if(!r)return;let a;r.loading!==void 0&&(a=this.create({...r,promise:s,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));const i=Promise.resolve(s instanceof Function?s():s);let l=a!==void 0,o;const c=i.then(async u=>{if(o=["resolve",u],_t.isValidElement(u))l=!1,this.create({id:a,type:"default",message:u});else if(uce(u)&&!u.ok){l=!1;const x=typeof r.error=="function"?await r.error(`HTTP error! status: ${u.status}`):r.error,g=typeof r.description=="function"?await r.description(`HTTP error! status: ${u.status}`):r.description,v=typeof x=="object"&&!_t.isValidElement(x)?x:{message:x};this.create({id:a,type:"error",description:g,...v})}else if(u instanceof Error){l=!1;const x=typeof r.error=="function"?await r.error(u):r.error,g=typeof r.description=="function"?await r.description(u):r.description,v=typeof x=="object"&&!_t.isValidElement(x)?x:{message:x};this.create({id:a,type:"error",description:g,...v})}else if(r.success!==void 0){l=!1;const x=typeof r.success=="function"?await r.success(u):r.success,g=typeof r.description=="function"?await r.description(u):r.description,v=typeof x=="object"&&!_t.isValidElement(x)?x:{message:x};this.create({id:a,type:"success",description:g,...v})}}).catch(async u=>{if(o=["reject",u],r.error!==void 0){l=!1;const m=typeof r.error=="function"?await r.error(u):r.error,x=typeof r.description=="function"?await r.description(u):r.description,y=typeof m=="object"&&!_t.isValidElement(m)?m:{message:m};this.create({id:a,type:"error",description:x,...y})}}).finally(()=>{l&&(this.dismiss(a),a=void 0),r.finally==null||r.finally.call(r)}),d=()=>new Promise((u,m)=>c.then(()=>o[0]==="reject"?m(o[1]):u(o[1])).catch(m));return typeof a!="string"&&typeof a!="number"?{unwrap:d}:Object.assign(a,{unwrap:d})},this.custom=(s,r)=>{const a=(r==null?void 0:r.id)||M3++;return this.create({jsx:s(a),id:a,...r}),a},this.getActiveToasts=()=>this.toasts.filter(s=>!this.dismissedToasts.has(s.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const qi=new cce,dce=(t,s)=>{const r=(s==null?void 0:s.id)||M3++;return qi.addToast({title:t,...s,id:r}),r},uce=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",mce=dce,hce=()=>qi.toasts,xce=()=>qi.getActiveToasts(),ae=Object.assign(mce,{success:qi.success,info:qi.info,warning:qi.warning,error:qi.error,custom:qi.custom,message:qi.message,promise:qi.promise,dismiss:qi.dismiss,loading:qi.loading},{getHistory:hce,getToasts:xce});Joe("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function l1(t){return t.label!==void 0}const pce=3,fce="24px",gce="16px",YO=4e3,bce=356,yce=14,vce=45,jce=200;function Pc(...t){return t.filter(Boolean).join(" ")}function Nce(t){const[s,r]=t.split("-"),a=[];return s&&a.push(s),r&&a.push(r),a}const wce=t=>{var s,r,a,i,l,o,c,d,u;const{invert:m,toast:x,unstyled:g,interacting:y,setHeights:v,visibleToasts:j,heights:w,index:S,toasts:E,expanded:k,removeToast:A,defaultRichColors:I,closeButton:P,style:O,cancelButtonStyle:D,actionButtonStyle:T,className:B="",descriptionClassName:U="",duration:W,position:V,gap:R,expandByDefault:F,classNames:G,icons:H,closeButtonAriaLabel:$="Close toast"}=t,[K,le]=_t.useState(null),[se,J]=_t.useState(null),[ie,te]=_t.useState(!1),[ne,q]=_t.useState(!1),[ee,X]=_t.useState(!1),[Z,Y]=_t.useState(!1),[Q,oe]=_t.useState(!1),[_e,xe]=_t.useState(0),[me,Re]=_t.useState(0),Ze=_t.useRef(x.duration||W||YO),$e=_t.useRef(null),fe=_t.useRef(null),Me=S===0,Ae=S+1<=j,Ke=x.type,Le=x.dismissible!==!1,He=x.className||"",pt=x.descriptionClassName||"",Pe=_t.useMemo(()=>w.findIndex(ke=>ke.toastId===x.id)||0,[w,x.id]),bt=_t.useMemo(()=>{var ke;return(ke=x.closeButton)!=null?ke:P},[x.closeButton,P]),It=_t.useMemo(()=>x.duration||W||YO,[x.duration,W]),De=_t.useRef(0),tt=_t.useRef(0),ve=_t.useRef(0),Ge=_t.useRef(null),[We,Ve]=V.split("-"),Fe=_t.useMemo(()=>w.reduce((ke,je,ht)=>ht>=Pe?ke:ke+je.height,0),[w,Pe]),ot=oce(),ft=x.invert||m,ce=Ke==="loading";tt.current=_t.useMemo(()=>Pe*R+Fe,[Pe,Fe]),_t.useEffect(()=>{Ze.current=It},[It]),_t.useEffect(()=>{te(!0)},[]),_t.useEffect(()=>{const ke=fe.current;if(ke){const je=ke.getBoundingClientRect().height;return Re(je),v(ht=>[{toastId:x.id,height:je,position:x.position},...ht]),()=>v(ht=>ht.filter(At=>At.toastId!==x.id))}},[v,x.id]),_t.useLayoutEffect(()=>{if(!ie)return;const ke=fe.current,je=ke.style.height;ke.style.height="auto";const ht=ke.getBoundingClientRect().height;ke.style.height=je,Re(ht),v(At=>At.find(Zt=>Zt.toastId===x.id)?At.map(Zt=>Zt.toastId===x.id?{...Zt,height:ht}:Zt):[{toastId:x.id,height:ht,position:x.position},...At])},[ie,x.title,x.description,v,x.id,x.jsx,x.action,x.cancel]);const Ce=_t.useCallback(()=>{q(!0),xe(tt.current),v(ke=>ke.filter(je=>je.toastId!==x.id)),setTimeout(()=>{A(x)},jce)},[x,A,v,tt]);_t.useEffect(()=>{if(x.promise&&Ke==="loading"||x.duration===1/0||x.type==="loading")return;let ke;return k||y||ot?(()=>{if(ve.current<De.current){const At=new Date().getTime()-De.current;Ze.current=Ze.current-At}ve.current=new Date().getTime()})():(()=>{Ze.current!==1/0&&(De.current=new Date().getTime(),ke=setTimeout(()=>{x.onAutoClose==null||x.onAutoClose.call(x,x),Ce()},Ze.current))})(),()=>clearTimeout(ke)},[k,y,x,Ke,ot,Ce]),_t.useEffect(()=>{x.delete&&(Ce(),x.onDismiss==null||x.onDismiss.call(x,x))},[Ce,x.delete]);function ze(){var ke;if(H!=null&&H.loading){var je;return _t.createElement("div",{className:Pc(G==null?void 0:G.loader,x==null||(je=x.classNames)==null?void 0:je.loader,"sonner-loader"),"data-visible":Ke==="loading"},H.loading)}return _t.createElement(sce,{className:Pc(G==null?void 0:G.loader,x==null||(ke=x.classNames)==null?void 0:ke.loader),visible:Ke==="loading"})}const Te=x.icon||(H==null?void 0:H[Ke])||ece(Ke);var Nt,Jt;return _t.createElement("li",{tabIndex:0,ref:fe,className:Pc(B,He,G==null?void 0:G.toast,x==null||(s=x.classNames)==null?void 0:s.toast,G==null?void 0:G.default,G==null?void 0:G[Ke],x==null||(r=x.classNames)==null?void 0:r[Ke]),"data-sonner-toast":"","data-rich-colors":(Nt=x.richColors)!=null?Nt:I,"data-styled":!(x.jsx||x.unstyled||g),"data-mounted":ie,"data-promise":!!x.promise,"data-swiped":Q,"data-removed":ne,"data-visible":Ae,"data-y-position":We,"data-x-position":Ve,"data-index":S,"data-front":Me,"data-swiping":ee,"data-dismissible":Le,"data-type":Ke,"data-invert":ft,"data-swipe-out":Z,"data-swipe-direction":se,"data-expanded":!!(k||F&&ie),"data-testid":x.testId,style:{"--index":S,"--toasts-before":S,"--z-index":E.length-S,"--offset":`${ne?_e:tt.current}px`,"--initial-height":F?"auto":`${me}px`,...O,...x.style},onDragEnd:()=>{X(!1),le(null),Ge.current=null},onPointerDown:ke=>{ke.button!==2&&(ce||!Le||($e.current=new Date,xe(tt.current),ke.target.setPointerCapture(ke.pointerId),ke.target.tagName!=="BUTTON"&&(X(!0),Ge.current={x:ke.clientX,y:ke.clientY})))},onPointerUp:()=>{var ke,je,ht;if(Z||!Le)return;Ge.current=null;const At=Number(((ke=fe.current)==null?void 0:ke.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),ms=Number(((je=fe.current)==null?void 0:je.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Zt=new Date().getTime()-((ht=$e.current)==null?void 0:ht.getTime()),hs=K==="x"?At:ms,Is=Math.abs(hs)/Zt;if(Math.abs(hs)>=vce||Is>.11){xe(tt.current),x.onDismiss==null||x.onDismiss.call(x,x),J(K==="x"?At>0?"right":"left":ms>0?"down":"up"),Ce(),Y(!0);return}else{var _s,Sn;(_s=fe.current)==null||_s.style.setProperty("--swipe-amount-x","0px"),(Sn=fe.current)==null||Sn.style.setProperty("--swipe-amount-y","0px")}oe(!1),X(!1),le(null)},onPointerMove:ke=>{var je,ht,At;if(!Ge.current||!Le||((je=window.getSelection())==null?void 0:je.toString().length)>0)return;const Zt=ke.clientY-Ge.current.y,hs=ke.clientX-Ge.current.x;var Is;const _s=(Is=t.swipeDirections)!=null?Is:Nce(V);!K&&(Math.abs(hs)>1||Math.abs(Zt)>1)&&le(Math.abs(hs)>Math.abs(Zt)?"x":"y");let Sn={x:0,y:0};const tn=Ts=>1/(1.5+Math.abs(Ts)/20);if(K==="y"){if(_s.includes("top")||_s.includes("bottom"))if(_s.includes("top")&&Zt<0||_s.includes("bottom")&&Zt>0)Sn.y=Zt;else{const Ts=Zt*tn(Zt);Sn.y=Math.abs(Ts)<Math.abs(Zt)?Ts:Zt}}else if(K==="x"&&(_s.includes("left")||_s.includes("right")))if(_s.includes("left")&&hs<0||_s.includes("right")&&hs>0)Sn.x=hs;else{const Ts=hs*tn(hs);Sn.x=Math.abs(Ts)<Math.abs(hs)?Ts:hs}(Math.abs(Sn.x)>0||Math.abs(Sn.y)>0)&&oe(!0),(ht=fe.current)==null||ht.style.setProperty("--swipe-amount-x",`${Sn.x}px`),(At=fe.current)==null||At.style.setProperty("--swipe-amount-y",`${Sn.y}px`)}},bt&&!x.jsx&&Ke!=="loading"?_t.createElement("button",{"aria-label":$,"data-disabled":ce,"data-close-button":!0,onClick:ce||!Le?()=>{}:()=>{Ce(),x.onDismiss==null||x.onDismiss.call(x,x)},className:Pc(G==null?void 0:G.closeButton,x==null||(a=x.classNames)==null?void 0:a.closeButton)},(Jt=H==null?void 0:H.close)!=null?Jt:lce):null,(Ke||x.icon||x.promise)&&x.icon!==null&&((H==null?void 0:H[Ke])!==null||x.icon)?_t.createElement("div",{"data-icon":"",className:Pc(G==null?void 0:G.icon,x==null||(i=x.classNames)==null?void 0:i.icon)},x.promise||x.type==="loading"&&!x.icon?x.icon||ze():null,x.type!=="loading"?Te:null):null,_t.createElement("div",{"data-content":"",className:Pc(G==null?void 0:G.content,x==null||(l=x.classNames)==null?void 0:l.content)},_t.createElement("div",{"data-title":"",className:Pc(G==null?void 0:G.title,x==null||(o=x.classNames)==null?void 0:o.title)},x.jsx?x.jsx:typeof x.title=="function"?x.title():x.title),x.description?_t.createElement("div",{"data-description":"",className:Pc(U,pt,G==null?void 0:G.description,x==null||(c=x.classNames)==null?void 0:c.description)},typeof x.description=="function"?x.description():x.description):null),_t.isValidElement(x.cancel)?x.cancel:x.cancel&&l1(x.cancel)?_t.createElement("button",{"data-button":!0,"data-cancel":!0,style:x.cancelButtonStyle||D,onClick:ke=>{l1(x.cancel)&&Le&&(x.cancel.onClick==null||x.cancel.onClick.call(x.cancel,ke),Ce())},className:Pc(G==null?void 0:G.cancelButton,x==null||(d=x.classNames)==null?void 0:d.cancelButton)},x.cancel.label):null,_t.isValidElement(x.action)?x.action:x.action&&l1(x.action)?_t.createElement("button",{"data-button":!0,"data-action":!0,style:x.actionButtonStyle||T,onClick:ke=>{l1(x.action)&&(x.action.onClick==null||x.action.onClick.call(x.action,ke),!ke.defaultPrevented&&Ce())},className:Pc(G==null?void 0:G.actionButton,x==null||(u=x.classNames)==null?void 0:u.actionButton)},x.action.label):null)};function XO(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function _ce(t,s){const r={};return[t,s].forEach((a,i)=>{const l=i===1,o=l?"--mobile-offset":"--offset",c=l?gce:fce;function d(u){["top","right","bottom","left"].forEach(m=>{r[`${o}-${m}`]=typeof u=="number"?`${u}px`:u})}typeof a=="number"||typeof a=="string"?d(a):typeof a=="object"?["top","right","bottom","left"].forEach(u=>{a[u]===void 0?r[`${o}-${u}`]=c:r[`${o}-${u}`]=typeof a[u]=="number"?`${a[u]}px`:a[u]}):d(c)}),r}const Sce=_t.forwardRef(function(s,r){const{id:a,invert:i,position:l="bottom-right",hotkey:o=["altKey","KeyT"],expand:c,closeButton:d,className:u,offset:m,mobileOffset:x,theme:g="light",richColors:y,duration:v,style:j,visibleToasts:w=pce,toastOptions:S,dir:E=XO(),gap:k=yce,icons:A,containerAriaLabel:I="Notifications"}=s,[P,O]=_t.useState([]),D=_t.useMemo(()=>a?P.filter(ie=>ie.toasterId===a):P.filter(ie=>!ie.toasterId),[P,a]),T=_t.useMemo(()=>Array.from(new Set([l].concat(D.filter(ie=>ie.position).map(ie=>ie.position)))),[D,l]),[B,U]=_t.useState([]),[W,V]=_t.useState(!1),[R,F]=_t.useState(!1),[G,H]=_t.useState(g!=="system"?g:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),$=_t.useRef(null),K=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),le=_t.useRef(null),se=_t.useRef(!1),J=_t.useCallback(ie=>{O(te=>{var ne;return(ne=te.find(q=>q.id===ie.id))!=null&&ne.delete||qi.dismiss(ie.id),te.filter(({id:q})=>q!==ie.id)})},[]);return _t.useEffect(()=>qi.subscribe(ie=>{if(ie.dismiss){requestAnimationFrame(()=>{O(te=>te.map(ne=>ne.id===ie.id?{...ne,delete:!0}:ne))});return}setTimeout(()=>{EU.flushSync(()=>{O(te=>{const ne=te.findIndex(q=>q.id===ie.id);return ne!==-1?[...te.slice(0,ne),{...te[ne],...ie},...te.slice(ne+1)]:[ie,...te]})})})}),[P]),_t.useEffect(()=>{if(g!=="system"){H(g);return}if(g==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?H("dark"):H("light")),typeof window>"u")return;const ie=window.matchMedia("(prefers-color-scheme: dark)");try{ie.addEventListener("change",({matches:te})=>{H(te?"dark":"light")})}catch{ie.addListener(({matches:ne})=>{try{H(ne?"dark":"light")}catch(q){console.error(q)}})}},[g]),_t.useEffect(()=>{P.length<=1&&V(!1)},[P]),_t.useEffect(()=>{const ie=te=>{var ne;if(o.every(X=>te[X]||te.code===X)){var ee;V(!0),(ee=$.current)==null||ee.focus()}te.code==="Escape"&&(document.activeElement===$.current||(ne=$.current)!=null&&ne.contains(document.activeElement))&&V(!1)};return document.addEventListener("keydown",ie),()=>document.removeEventListener("keydown",ie)},[o]),_t.useEffect(()=>{if($.current)return()=>{le.current&&(le.current.focus({preventScroll:!0}),le.current=null,se.current=!1)}},[$.current]),_t.createElement("section",{ref:r,"aria-label":`${I} ${K}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},T.map((ie,te)=>{var ne;const[q,ee]=ie.split("-");return D.length?_t.createElement("ol",{key:ie,dir:E==="auto"?XO():E,tabIndex:-1,ref:$,className:u,"data-sonner-toaster":!0,"data-sonner-theme":G,"data-y-position":q,"data-x-position":ee,style:{"--front-toast-height":`${((ne=B[0])==null?void 0:ne.height)||0}px`,"--width":`${bce}px`,"--gap":`${k}px`,...j,..._ce(m,x)},onBlur:X=>{se.current&&!X.currentTarget.contains(X.relatedTarget)&&(se.current=!1,le.current&&(le.current.focus({preventScroll:!0}),le.current=null))},onFocus:X=>{X.target instanceof HTMLElement&&X.target.dataset.dismissible==="false"||se.current||(se.current=!0,le.current=X.relatedTarget)},onMouseEnter:()=>V(!0),onMouseMove:()=>V(!0),onMouseLeave:()=>{R||V(!1)},onDragEnd:()=>V(!1),onPointerDown:X=>{X.target instanceof HTMLElement&&X.target.dataset.dismissible==="false"||F(!0)},onPointerUp:()=>F(!1)},D.filter(X=>!X.position&&te===0||X.position===ie).map((X,Z)=>{var Y,Q;return _t.createElement(wce,{key:X.id,icons:A,index:Z,toast:X,defaultRichColors:y,duration:(Y=S==null?void 0:S.duration)!=null?Y:v,className:S==null?void 0:S.className,descriptionClassName:S==null?void 0:S.descriptionClassName,invert:i,visibleToasts:w,closeButton:(Q=S==null?void 0:S.closeButton)!=null?Q:d,interacting:R,position:ie,style:S==null?void 0:S.style,unstyled:S==null?void 0:S.unstyled,classNames:S==null?void 0:S.classNames,cancelButtonStyle:S==null?void 0:S.cancelButtonStyle,actionButtonStyle:S==null?void 0:S.actionButtonStyle,closeButtonAriaLabel:S==null?void 0:S.closeButtonAriaLabel,removeToast:J,toasts:D.filter(oe=>oe.position==X.position),heights:B.filter(oe=>oe.position==X.position),setHeights:U,expandByDefault:c,gap:k,expanded:W,swipeDirections:s.swipeDirections})})):null}))}),XE="https://app.nutruah.com/api",he=Dr.create({baseURL:XE,withCredentials:!0,timeout:6e4}),Cce=new Set(["post","put","patch","delete"]),kce=["/master/","/system/"];function uV(t){try{let s=String(t||"");return s.startsWith("http://")||s.startsWith("https://")?new URL(s).pathname:(s=s.split("?")[0],s="/"+s.replace(/^\/+/,""),s)}catch{return"/"}}const Ace=t=>{var r;const s=uV(t==null?void 0:t.url);return(r=t==null?void 0:t.meta)!=null&&r.skipTenantHeader?!0:kce.some(a=>s.startsWith(a))},Ece=t=>{var s;return!!((s=t==null?void 0:t.meta)!=null&&s.skipAuthHeader)};he.interceptors.request.use(t=>{const s=localStorage.getItem("access_token"),r=localStorage.getItem("tenant_code");return t.headers=t.headers||{},!Ece(t)&&s&&(t.headers.Authorization=`Bearer ${s}`),!Ace(t)&&r?t.headers["X-Tenant-Code"]=r:t.headers["X-Tenant-Code"]&&delete t.headers["X-Tenant-Code"],t.headers["X-Request-Id"]||(t.headers["X-Request-Id"]=`${Date.now()}-${Math.random().toString(16).slice(2)}`),t});async function QO(t,s){var r,a,i,l,o,c;try{const d=localStorage.getItem("tenant_code")||null;let u=null;try{(r=t==null?void 0:t.config)!=null&&r.data&&(u=typeof t.config.data=="string"?JSON.parse(t.config.data):t.config.data)}catch{u={raw:(a=t==null?void 0:t.config)==null?void 0:a.data}}const m={message:s,page_url:window.location.href,request_url:((i=t==null?void 0:t.config)==null?void 0:i.url)||null,request_method:((l=t==null?void 0:t.config)==null?void 0:l.method)||null,http_status:((o=t==null?void 0:t.response)==null?void 0:o.status)||null,request_payload:u,response_payload:((c=t==null?void 0:t.response)==null?void 0:c.data)||null,stack_trace:(t==null?void 0:t.stack)||null,tenant_code:d,user_agent:navigator.userAgent,extra:{network:navigator.onLine?"online":"offline"}};await fetch(`${XE}/system/client-error`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m),keepalive:!0,credentials:"include"})}catch(d){console.error("Failed to report client error",d)}}let h0=null;async function mV(){if(h0)return h0;const t=localStorage.getItem("tenant_code")||null;return h0=(async()=>{try{const s=await fetch(`${XE}/auth/refresh`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...t?{"X-Tenant-Code":t}:{}}});if(!s.ok)throw new Error(`Refresh failed with status ${s.status}`);const r=await s.json();return r!=null&&r.access_token&&localStorage.setItem("access_token",r.access_token),(r==null?void 0:r.access_token)||null}finally{h0=null}})(),h0}he.interceptors.response.use(t=>{var i,l;const s=(t==null?void 0:t.config)||{},r=(s==null?void 0:s.meta)||{},a=String(s.method||"get").toLowerCase();if(!r.silent&&Cce.has(a)&&r.successToast){if(typeof r.successToast=="string"&&r.successToast.trim())ae.success(r.successToast);else if(r.successToast===!0){const o=((i=t==null?void 0:t.data)==null?void 0:i.message)||((l=t==null?void 0:t.data)==null?void 0:l.detail);ae.success(typeof o=="string"&&o.trim()?o:"Saved successfully")}}return t},async t=>{var u,m;const s=(u=t==null?void 0:t.response)==null?void 0:u.status,r=(m=t==null?void 0:t.response)==null?void 0:m.data,a=t.config||{},i=(a==null?void 0:a.meta)||{};if(!(t!=null&&t.response)){const x=navigator.onLine?"Network error / Server unreachable":"You are offline";return i.silentError||ae.error(x),QO(t,x),Promise.reject(t)}const l=uV(a==null?void 0:a.url),o=l.startsWith("/auth/login")||l.startsWith("/auth/refresh");if(s===401&&!o&&!a._retry){a._retry=!0;try{const x=await mV();if(x)return a.headers=a.headers||{},a.headers.Authorization=`Bearer ${x}`,he(a)}catch(x){console.error("Refresh token flow failed",x)}localStorage.removeItem("access_token")}const c=r==null?void 0:r.detail;let d="Unexpected error";return s===403&&(d=typeof c=="string"?c:"Forbidden"),s===404&&(d=typeof c=="string"?c:"Not found"),s===429&&(d=typeof c=="string"?c:"Too many requests, try again"),s>=500&&(d=typeof c=="string"?c:"Server error"),Array.isArray(c)?d=c.map(x=>`${Array.isArray(x.loc)?x.loc.join("."):x.loc}: ${x.msg}`).join(`
`):typeof c=="string"?d=c:typeof(r==null?void 0:r.message)=="string"?d=r.message:t!=null&&t.message&&(d=t.message),i.silentError||ae.error(d),QO(t,d),Promise.reject(t)});const Tce={},ZO=t=>{let s;const r=new Set,a=(m,x)=>{const g=typeof m=="function"?m(s):m;if(!Object.is(g,s)){const y=s;s=x??(typeof g!="object"||g===null)?g:Object.assign({},s,g),r.forEach(v=>v(s,y))}},i=()=>s,d={setState:a,getState:i,getInitialState:()=>u,subscribe:m=>(r.add(m),()=>r.delete(m)),destroy:()=>{(Tce?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},u=s=t(a,i,d);return d},Pce=t=>t?ZO(t):ZO;var hV={exports:{}},xV={},pV={exports:{}},fV={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xp=p;function Dce(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Mce=typeof Object.is=="function"?Object.is:Dce,Ice=Xp.useState,Oce=Xp.useEffect,Rce=Xp.useLayoutEffect,Lce=Xp.useDebugValue;function Fce(t,s){var r=s(),a=Ice({inst:{value:r,getSnapshot:s}}),i=a[0].inst,l=a[1];return Rce(function(){i.value=r,i.getSnapshot=s,nC(i)&&l({inst:i})},[t,r,s]),Oce(function(){return nC(i)&&l({inst:i}),t(function(){nC(i)&&l({inst:i})})},[t]),Lce(r),r}function nC(t){var s=t.getSnapshot;t=t.value;try{var r=s();return!Mce(t,r)}catch{return!0}}function Bce(t,s){return s()}var $ce=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Bce:Fce;fV.useSyncExternalStore=Xp.useSyncExternalStore!==void 0?Xp.useSyncExternalStore:$ce;pV.exports=fV;var zce=pV.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r2=p,Uce=zce;function Vce(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Hce=typeof Object.is=="function"?Object.is:Vce,Wce=Uce.useSyncExternalStore,qce=r2.useRef,Gce=r2.useEffect,Kce=r2.useMemo,Yce=r2.useDebugValue;xV.useSyncExternalStoreWithSelector=function(t,s,r,a,i){var l=qce(null);if(l.current===null){var o={hasValue:!1,value:null};l.current=o}else o=l.current;l=Kce(function(){function d(y){if(!u){if(u=!0,m=y,y=a(y),i!==void 0&&o.hasValue){var v=o.value;if(i(v,y))return x=v}return x=y}if(v=x,Hce(m,y))return v;var j=a(y);return i!==void 0&&i(v,j)?(m=y,v):(m=y,x=j)}var u=!1,m,x,g=r===void 0?null:r;return[function(){return d(s())},g===null?void 0:function(){return d(g())}]},[s,r,a,i]);var c=Wce(t,l[0],l[1]);return Gce(function(){o.hasValue=!0,o.value=c},[c]),Yce(c),c};hV.exports=xV;var gV=hV.exports;const Xce=Ro(gV),bV={},{useDebugValue:Qce}=_t,{useSyncExternalStoreWithSelector:Zce}=Xce;let JO=!1;const Jce=t=>t;function ede(t,s=Jce,r){(bV?"production":void 0)!=="production"&&r&&!JO&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),JO=!0);const a=Zce(t.subscribe,t.getState,t.getServerState||t.getInitialState,s,r);return Qce(a),a}const eR=t=>{(bV?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const s=typeof t=="function"?Pce(t):t,r=(a,i)=>ede(s,a,i);return Object.assign(r,s),r},yV=t=>t?eR(t):eR,dn=yV((t,s)=>({user:null,modules:{},loading:!1,tenantCode:localStorage.getItem("tenant_code")||"",setTenantCode:r=>{r?localStorage.setItem("tenant_code",r):localStorage.removeItem("tenant_code"),t({tenantCode:r})},registerAdmin:async r=>{var l;const a=await he.post("/auth/register-admin",r),i=(l=a==null?void 0:a.data)==null?void 0:l.tenant_code;return i&&(localStorage.setItem("tenant_code",i),t({tenantCode:i})),a},login:async({tenant_code:r,email:a,password:i})=>{const l={tenant_code:r==null?void 0:r.trim(),email:a,password:i},{data:o}=await he.post("/auth/login",l);return r&&(localStorage.setItem("tenant_code",r.trim()),t({tenantCode:r.trim()})),o},verifyOtp:async({tenant_code:r,email:a,otp:i})=>{const l={tenant_code:r==null?void 0:r.trim(),email:a,otp:i},{data:o}=await he.post("/auth/verify-otp",l);return localStorage.setItem("access_token",o.access_token),localStorage.setItem("refresh_token",o.refresh_token),he.defaults.headers.common.Authorization=`Bearer ${o.access_token}`,r&&(localStorage.setItem("tenant_code",r.trim()),t({tenantCode:r.trim()})),o},fetchProfile:async()=>{var r;try{t({loading:!0});const a=await he.get("/auth/me"),i=await he.get("/auth/me/permissions"),l=(r=a==null?void 0:a.data)==null?void 0:r.tenant_code;l&&localStorage.setItem("tenant_code",l),t({user:a.data,modules:i.data.modules||{},tenantCode:l||s().tenantCode})}finally{t({loading:!1})}},logout:()=>{localStorage.clear(),delete he.defaults.headers.common.Authorization,t({user:null,modules:{},tenantCode:""})}}));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tde=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),sde=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,r,a)=>a?a.toUpperCase():r.toLowerCase()),tR=t=>{const s=sde(t);return s.charAt(0).toUpperCase()+s.slice(1)},vV=(...t)=>t.filter((s,r,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===r).join(" ").trim(),nde=t=>{for(const s in t)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rde={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ade=p.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:i="",children:l,iconNode:o,...c},d)=>p.createElement("svg",{ref:d,...rde,width:s,height:s,stroke:t,strokeWidth:a?Number(r)*24/Number(s):r,className:vV("lucide",i),...!l&&!nde(c)&&{"aria-hidden":"true"},...c},[...o.map(([u,m])=>p.createElement(u,m)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=(t,s)=>{const r=p.forwardRef(({className:a,...i},l)=>p.createElement(ade,{ref:l,iconNode:s,className:vV(`lucide-${tde(tR(t))}`,`lucide-${t}`,a),...i}));return r.displayName=tR(t),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ide=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Qs=Ye("activity",ide);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lde=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],ode=Ye("arrow-left-right",lde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cde=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Hl=Ye("arrow-left",cde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dde=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ki=Ye("arrow-right",dde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ude=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],mde=Ye("arrow-up-down",ude);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hde=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],jV=Ye("arrow-up-right",hde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xde=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ny=Ye("badge-check",xde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pde=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["line",{x1:"12",x2:"12",y1:"16",y2:"12",key:"1y1yb1"}],["line",{x1:"12",x2:"12.01",y1:"8",y2:"8",key:"110wyk"}]],fde=Ye("badge-info",pde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gde=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],bde=Ye("ban",gde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yde=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],I3=Ye("banknote",yde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vde=[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]],a2=Ye("beaker",vde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jde=[["path",{d:"M2 20v-8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v8",key:"1k78r4"}],["path",{d:"M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4",key:"fb3tl2"}],["path",{d:"M12 4v6",key:"1dcgq2"}],["path",{d:"M2 18h20",key:"ajqnye"}]],cn=Ye("bed-double",jde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nde=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],sR=Ye("bell",Nde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wde=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],_de=Ye("bold",wde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sde=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M16 12h2",key:"7q9ll5"}],["path",{d:"M16 8h2",key:"msurwy"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}],["path",{d:"M6 12h2",key:"32wvfc"}],["path",{d:"M6 8h2",key:"30oboj"}]],Cde=Ye("book-open-text",Sde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kde=[["path",{d:"M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z",key:"lc1i9w"}],["path",{d:"m7 16.5-4.74-2.85",key:"1o9zyk"}],["path",{d:"m7 16.5 5-3",key:"va8pkn"}],["path",{d:"M7 16.5v5.17",key:"jnp8gn"}],["path",{d:"M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z",key:"8zsnat"}],["path",{d:"m17 16.5-5-3",key:"8arw3v"}],["path",{d:"m17 16.5 4.74-2.85",key:"8rfmw"}],["path",{d:"M17 16.5v5.17",key:"k6z78m"}],["path",{d:"M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z",key:"1xygjf"}],["path",{d:"M12 8 7.26 5.15",key:"1vbdud"}],["path",{d:"m12 8 4.74-2.85",key:"3rx089"}],["path",{d:"M12 13.5V8",key:"1io7kd"}]],NV=Ye("boxes",kde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ade=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],Ede=Ye("bug",Ade);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tde=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Xa=Ye("building-2",Tde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pde=[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],nR=Ye("calendar-clock",Pde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dde=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Ds=Ye("calendar-days",Dde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mde=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],xp=Ye("calendar-range",Mde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ide=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],yg=Ye("calendar",Ide);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ode=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],rR=Ye("camera",Ode);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rde=[["path",{d:"M14.564 14.558a3 3 0 1 1-4.122-4.121",key:"1rnrzw"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M20 20H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 .819-.175",key:"1x3arw"}],["path",{d:"M9.695 4.024A2 2 0 0 1 10.004 4h3.993a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v7.344",key:"1i84u0"}]],Lde=Ye("camera-off",Rde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fde=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],pp=Ye("chart-column",Fde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bde=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],$de=Ye("chart-no-axes-column",Bde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zde=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],So=Ye("check",zde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ude=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Gn=Ye("chevron-down",Ude);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vde=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ry=Ye("chevron-left",Vde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hde=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ti=Ye("chevron-right",Hde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wde=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],el=Ye("chevron-up",Wde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qde=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Vs=Ye("circle-alert",qde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gde=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Xt=Ye("circle-check",Gde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kde=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],rC=Ye("circle-minus",Kde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yde=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],i2=Ye("circle-play",Yde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xde=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],aC=Ye("circle-plus",Xde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qde=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ca=Ye("circle-x",Qde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zde=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Jde=Ye("circle",Zde);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eue=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],tue=Ye("clipboard-check",eue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sue=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]],nue=Ye("clipboard-copy",sue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rue=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Pr=Ye("clipboard-list",rue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aue=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",key:"1oijnt"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-.5",key:"1but9f"}],["path",{d:"M16 4h2a2 2 0 0 1 1.73 1",key:"1p8n7l"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}]],iue=Ye("clipboard-pen-line",aue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lue=[["path",{d:"M12 6v6h4",key:"135r8i"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Na=Ye("clock-3",lue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oue=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],jn=Ye("clock",oue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cue=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],x0=Ye("cloud-upload",cue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const due=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],aR=Ye("columns-2",due);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uue=[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]],wV=Ye("command",uue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mue=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],vg=Ye("copy",mue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hue=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],tN=Ye("credit-card",hue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xue=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],_V=Ye("cpu",xue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pue=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],sN=Ye("database",pue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fue=[["path",{d:"M10 12h.01",key:"1kxr2c"}],["path",{d:"M18 20V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14",key:"36qu9e"}],["path",{d:"M2 20h20",key:"owomy5"}]],SV=Ye("door-closed",fue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gue=[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]],eg=Ye("dot",gue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bue=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],nn=Ye("download",bue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yue=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],vue=Ye("droplet",yue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jue=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],O3=Ye("droplets",jue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nue=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],tg=Ye("ellipsis-vertical",Nue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wue=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],CV=Ye("ellipsis",wue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ue=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Sue=Ye("eraser",_ue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cue=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],iC=Ye("external-link",Cue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kue=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Aue=Ye("eye-off",kue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eue=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Wr=Ye("eye",Eue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],kV=Ye("file-down",Tue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pue=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]],Due=Ye("file-plus-2",Pue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],AV=Ye("file-spreadsheet",Mue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iue=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Xn=Ye("file-text",Iue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oue=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],tl=Ye("flask-conical",Oue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rue=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],jr=Ye("funnel",Rue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lue=[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]],EV=Ye("hand-coins",Lue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fue=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Bue=Ye("hard-drive",Fue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ue=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],jo=Ye("hash",$ue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zue=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],ac=Ye("heart-pulse",zue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uue=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],tb=Ye("history",Uue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vue=[["path",{d:"M12 7v4",key:"xawao1"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M14 9h-4",key:"1w2s2s"}],["path",{d:"M18 11h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2",key:"1tthqt"}],["path",{d:"M18 21V5a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16",key:"dw4p4i"}]],lC=Ye("hospital",Vue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hue=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],Wue=Ye("id-card",Hue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const que=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],TV=Ye("image",que);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gue=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],Mp=Ye("inbox",Gue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kue=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],Qi=Ye("indian-rupee",Kue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],gr=Ye("info",Yue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xue=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],ic=Ye("key-round",Xue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Que=[["rect",{width:"18",height:"12",x:"3",y:"4",rx:"2",ry:"2",key:"1qhy41"}],["line",{x1:"2",x2:"22",y1:"20",y2:"20",key:"ni3hll"}]],Zue=Ye("laptop-minimal",Que);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jue=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],o1=Ye("layout-dashboard",Jue);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eme=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Co=Ye("layers",eme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tme=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],sme=Ye("layout-grid",tme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nme=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],rme=Ye("layout-list",nme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ame=[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]],ime=Ye("layout-template",ame);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lme=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],yh=Ye("link-2",lme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ome=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],cme=Ye("list-checks",ome);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dme=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],ume=Ye("list-ordered",dme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mme=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],hme=Ye("list",mme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xme=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Rt=Ye("loader-circle",xme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pme=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],QE=Ye("log-in",pme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fme=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],gme=Ye("log-out",fme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bme=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],rd=Ye("lock",bme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yme=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Qp=Ye("mail",yme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vme=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],sb=Ye("map-pin",vme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jme=[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]],PV=Ye("microscope",jme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nme=[["path",{d:"M5 12h14",key:"1ays0h"}]],DV=Ye("minus",Nme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wme=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],_me=Ye("music-2",wme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sme=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],nN=Ye("notebook-pen",Sme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cme=[["path",{d:"M12 22v-9",key:"x3hkom"}],["path",{d:"M15.17 2.21a1.67 1.67 0 0 1 1.63 0L21 4.57a1.93 1.93 0 0 1 0 3.36L8.82 14.79a1.655 1.655 0 0 1-1.64 0L3 12.43a1.93 1.93 0 0 1 0-3.36z",key:"2ntwy6"}],["path",{d:"M20 13v3.87a2.06 2.06 0 0 1-1.11 1.83l-6 3.08a1.93 1.93 0 0 1-1.78 0l-6-3.08A2.06 2.06 0 0 1 4 16.87V13",key:"1pmm1c"}],["path",{d:"M21 12.43a1.93 1.93 0 0 0 0-3.36L8.83 2.2a1.64 1.64 0 0 0-1.63 0L3 4.57a1.93 1.93 0 0 0 0 3.36l12.18 6.86a1.636 1.636 0 0 0 1.63 0z",key:"12ttoo"}]],jg=Ye("package-open",Cme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kme=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],l2=Ye("package",kme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ame=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Eme=Ye("paperclip",Ame);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tme=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],MV=Ye("pen",Tme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pme=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Yr=Ye("pencil",Pme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dme=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ad=Ye("phone",Dme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mme=[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]],rr=Ye("pill",Mme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ime=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ome=Ye("play",Ime);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rme=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ds=Ye("plus",Rme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lme=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],Ll=Ye("printer",Lme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fme=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],oC=Ye("qr-code",Fme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bme=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],iR=Ye("radio",Bme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $me=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M8 7h8",key:"i86dvs"}],["path",{d:"M12 17.5 8 15h1a4 4 0 0 0 0-8",key:"grpkl4"}],["path",{d:"M8 11h8",key:"vwpz6n"}]],nj=Ye("receipt-indian-rupee",$me);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zme=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M14 8H8",key:"1l3xfs"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"M13 16H8",key:"wsln4y"}]],Ume=Ye("receipt-text",zme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vme=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],vh=Ye("receipt",Vme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hme=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],ps=Ye("refresh-ccw",Hme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wme=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],jh=Ye("refresh-cw",Wme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qme=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],cl=Ye("rotate-ccw",qme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gme=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Pi=Ye("save",Gme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kme=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]],c1=Ye("scan-barcode",Kme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yme=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],yo=Ye("scan-line",Yme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xme=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]],IV=Ye("scan-search",Xme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qme=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],Ng=Ye("scan",Qme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zme=[["path",{d:"M5.42 9.42 8 12",key:"12pkuq"}],["circle",{cx:"4",cy:"8",r:"2",key:"107mxr"}],["path",{d:"m14 6-8.58 8.58",key:"gvzu5l"}],["circle",{cx:"4",cy:"16",r:"2",key:"1ehqvc"}],["path",{d:"M10.8 14.8 14 18",key:"ax7m9r"}],["path",{d:"M16 12h-2",key:"10asgb"}],["path",{d:"M22 12h-2",key:"14jgyd"}]],lR=Ye("scissors-line-dashed",Zme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jme=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],OV=Ye("scissors",Jme);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ehe=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],RV=Ye("scroll-text",ehe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const the=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Yt=Ye("search",the);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const she=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],rN=Ye("settings-2",she);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nhe=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],rhe=Ye("settings",nhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ahe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],nb=Ye("shield-alert",ahe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ihe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ka=Ye("shield-check",ihe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lhe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]],ohe=Ye("shield-plus",lhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const che=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],LV=Ye("shield",che);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dhe=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],rb=Ye("shopping-cart",dhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uhe=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],ZE=Ye("sliders-horizontal",uhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mhe=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],$n=Ye("sparkles",mhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hhe=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],cC=Ye("square-check-big",hhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xhe=[["path",{d:"M5 8V5c0-1 1-2 2-2h10c1 0 2 1 2 2v3",key:"1pi83i"}],["path",{d:"M19 16v3c0 1-1 2-2 2H7c-1 0-2-1-2-2v-3",key:"ido5k7"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]],phe=Ye("square-split-vertical",xhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fhe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],d1=Ye("square",fhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ghe=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],Hs=Ye("stethoscope",ghe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bhe=[["path",{d:"m18 2 4 4",key:"22kx64"}],["path",{d:"m17 7 3-3",key:"1w1zoj"}],["path",{d:"M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5",key:"1exhtz"}],["path",{d:"m9 11 4 4",key:"rovt3i"}],["path",{d:"m5 19-3 3",key:"59f2uf"}],["path",{d:"m14 4 6 6",key:"yqp9t2"}]],oR=Ye("syringe",bhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yhe=[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]],cR=Ye("table-2",yhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vhe=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ih=Ye("tag",vhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jhe=[["path",{d:"M21 7 6.82 21.18a2.83 2.83 0 0 1-3.99-.01a2.83 2.83 0 0 1 0-4L17 3",key:"1ub6xw"}],["path",{d:"m16 2 6 6",key:"1gw87d"}],["path",{d:"M12 16H4",key:"1cjfip"}]],Nhe=Ye("test-tube-diagonal",jhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const whe=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],ab=Ye("thermometer",whe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _he=[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]],rj=Ye("ticket",_he);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const She=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Che=Ye("timer",She);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const khe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ms=Ye("trash-2",khe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ahe=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Ehe=Ye("trending-down",Ahe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const The=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],FV=Ye("trending-up",The);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phe=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],en=Ye("triangle-alert",Phe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dhe=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],dC=Ye("truck",Dhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mhe=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Ihe=Ye("type",Mhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ohe=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],aj=Ye("undo-2",Ohe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rhe=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],Lhe=Ye("underline",Rhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fhe=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Nh=Ye("upload",Fhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bhe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],dR=Ye("user-plus",Bhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $he=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],wa=Ye("user-round",$he);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zhe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],uc=Ye("users",zhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uhe=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],or=Ye("user",Uhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vhe=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Hhe=Ye("video",Vhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Whe=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Xo=Ye("wallet",Whe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qhe=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],R3=Ye("wand-sparkles",qhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ghe=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],Khe=Ye("wind",Ghe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yhe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ts=Ye("x",Yhe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xhe=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Qhe=Ye("zap",Xhe);function Zhe(){var y,v;const t=pi(),s=Qr(),r=dn(j=>j.login),[a,i]=p.useState({tenant_code:((y=t.state)==null?void 0:y.tenant_code)||localStorage.getItem("tenant_code")||localStorage.getItem("pending_tenant_code")||"",email:((v=t.state)==null?void 0:v.email)||localStorage.getItem("pending_email")||"",password:""}),[l,o]=p.useState(""),[c,d]=p.useState(!1),[u,m]=p.useState(!1),x=p.useMemo(()=>a.tenant_code.trim()&&a.email.trim()&&a.password.trim()&&!c,[a,c]),g=async j=>{var w,S;if(j.preventDefault(),!!x){o(""),d(!0);try{await r({tenant_code:a.tenant_code.trim(),email:a.email.trim(),password:a.password}),localStorage.setItem("pending_email",a.email.trim()),localStorage.setItem("pending_tenant_code",a.tenant_code.trim()),s("/auth/verify",{state:{email:a.email.trim(),tenant_code:a.tenant_code.trim()}})}catch(E){o(((S=(w=E==null?void 0:E.response)==null?void 0:w.data)==null?void 0:S.detail)||"Invalid credentials")}finally{d(!1)}}};return n.jsxs("div",{className:"relative min-h-screen overflow-hidden bg-gradient-to-b from-gray-50 to-white",children:[n.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[n.jsx("div",{className:"absolute -left-24 -top-24 h-64 w-64 rounded-full bg-blue-100 blur-3xl animate-pulse"}),n.jsx("div",{className:"absolute -right-24 -bottom-24 h-72 w-72 rounded-full bg-indigo-100 blur-3xl animate-pulse"})]}),n.jsx("div",{className:"relative z-10 grid min-h-screen place-items-center px-4 py-10",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-gray-100 bg-white/80 p-6 shadow-sm backdrop-blur",children:[n.jsx("div",{className:"pointer-events-none absolute -right-12 -top-12 h-32 w-32 rotate-45 bg-gradient-to-br from-blue-50 to-indigo-50"}),n.jsxs("div",{className:"mb-6 flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"grid h-10 w-10 place-items-center rounded-xl bg-blue-600 text-white ring-8 ring-blue-50",children:n.jsx("span",{className:"text-sm font-bold tracking-tight",children:"NDH"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"NUTRYAH's HIMS & EMR"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Multi-tenant login with Hospital Code + Email + OTP"})]})]}),n.jsx(Ka,{className:"h-6 w-6 text-emerald-600"})]}),n.jsxs("form",{onSubmit:g,className:"space-y-4","aria-busy":c,children:[n.jsxs("label",{className:"block",children:[n.jsx("span",{className:"mb-1 block text-sm text-gray-600",children:"Hospital Code"}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 focus-within:ring-2 focus-within:ring-blue-200",children:[n.jsx(Xa,{className:"h-4 w-4 text-gray-400"}),n.jsx("input",{className:"w-full bg-transparent outline-none placeholder:text-gray-400 uppercase",placeholder:"KGH001",value:a.tenant_code,onChange:j=>i(w=>({...w,tenant_code:j.target.value.toUpperCase()})),required:!0,disabled:c})]}),n.jsx("p",{className:"mt-1 text-[11px] text-gray-500",children:"Hospital / Clinic code assigned by NUTRYAH (Tenant Code)."})]}),n.jsxs("label",{className:"block",children:[n.jsx("span",{className:"mb-1 block text-sm text-gray-600",children:"Email"}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 focus-within:ring-2 focus-within:ring-blue-200",children:[n.jsx(Qp,{className:"h-4 w-4 text-gray-400"}),n.jsx("input",{className:"w-full bg-transparent outline-none placeholder:text-gray-400",placeholder:"you@hospital.org",type:"email",autoComplete:"email",value:a.email,onChange:j=>i(w=>({...w,email:j.target.value})),required:!0,disabled:c})]})]}),n.jsxs("label",{className:"block",children:[n.jsx("span",{className:"mb-1 block text-sm text-gray-600",children:"Password"}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 focus-within:ring-2 focus-within:ring-blue-200",children:[n.jsx(rd,{className:"h-4 w-4 text-gray-400"}),n.jsx("input",{className:"w-full bg-transparent outline-none placeholder:text-gray-400",placeholder:"",type:u?"text":"password",autoComplete:"current-password",value:a.password,onChange:j=>i(w=>({...w,password:j.target.value})),required:!0,disabled:c}),n.jsx("button",{type:"button",onClick:()=>m(j=>!j),className:"rounded-lg p-1.5 text-gray-500 hover:bg-gray-50","aria-label":u?"Hide password":"Show password",tabIndex:-1,disabled:c,children:u?n.jsx(Aue,{className:"h-4 w-4"}):n.jsx(Wr,{className:"h-4 w-4"})})]})]}),n.jsx("button",{className:"inline-flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-2.5 text-white shadow-sm transition active:scale-[0.99] disabled:cursor-not-allowed disabled:opacity-60",disabled:!x,type:"submit",children:c?n.jsxs(n.Fragment,{children:[n.jsx(Rt,{className:"h-5 w-5 animate-spin"}),n.jsx("span",{children:"Sending OTP"})]}):n.jsx(n.Fragment,{children:"Send OTP"})}),l&&n.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:l}),n.jsx("p",{className:"text-center text-xs text-gray-500",children:"Tip: You'll receive a 6-digit OTP in your email. Keep this tab open."})]}),c&&n.jsx("div",{className:"absolute inset-0 grid place-items-center rounded-2xl bg-white/70 backdrop-blur-sm",children:n.jsxs("div",{className:"w-full max-w-xs rounded-xl border border-gray-100 bg-white p-4 shadow-md",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm text-gray-700",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin text-blue-600"}),"Sending OTP"]}),n.jsx("div",{className:"relative h-2 overflow-hidden rounded-full bg-gray-100",children:n.jsx("div",{className:"absolute inset-y-0 left-0 w-1/3 animate-[progress_1.2s_infinite] rounded-full bg-gradient-to-r from-blue-500 to-indigo-500"})}),n.jsxs("div",{className:"mt-3 flex items-center justify-center gap-1",children:[n.jsx("span",{className:"h-2 w-2 animate-bounce rounded-full bg-blue-500 [animation-delay:-0.2s]"}),n.jsx("span",{className:"h-2 w-2 animate-bounce rounded-full bg-blue-500 [animation-delay:-0.1s]"}),n.jsx("span",{className:"h-2 w-2 animate-bounce rounded-full bg-blue-500"})]})]})})]}),n.jsxs("div",{className:"mx-auto mt-6 text-center text-xs text-gray-500",children:[" ",new Date().getFullYear()," NUTRYAH  Multi-tenant Secure Access"]})]})}),n.jsx("style",{children:`
        @keyframes progress {
          0% { transform: translateX(-120%); }
          100% { transform: translateX(300%); }
        }
      `})]})}function Jhe(){const[t,s]=p.useState({tenant_name:"",tenant_code:"",hospital_address:"",contact_person:"",contact_phone:"",subscription_plan:"standard",admin_name:"",email:"",password:"",confirm_password:""}),[r,a]=p.useState(!1),[i,l]=p.useState(""),o=dn(m=>m.registerAdmin),c=Qr(),d=m=>x=>s(g=>({...g,[m]:x.target.value})),u=async m=>{var x,g;if(m.preventDefault(),!r){if(l(""),t.password!==t.confirm_password){l("Passwords do not match");return}a(!0);try{const y=await o(t),{tenant_code:v}=y.data||{};alert(`Hospital onboarded successfully.
Tenant Code: ${v||t.tenant_code||"Generated"}

Please login with Hospital Code + Admin email.`),c("/auth/login",{replace:!0,state:{email:t.email,tenant_code:v||t.tenant_code}})}catch(y){l(((g=(x=y==null?void 0:y.response)==null?void 0:x.data)==null?void 0:g.detail)||"Failed to register tenant admin")}finally{a(!1)}}};return n.jsxs("div",{className:"relative min-h-screen overflow-hidden bg-gradient-to-b from-slate-50 to-white",children:[n.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[n.jsx("div",{className:"absolute -left-24 -top-24 h-64 w-64 rounded-full bg-blue-100 blur-3xl"}),n.jsx("div",{className:"absolute -right-24 -bottom-24 h-72 w-72 rounded-full bg-indigo-100 blur-3xl"})]}),n.jsx("div",{className:"relative z-10 grid min-h-screen place-items-center px-4 py-8",children:n.jsxs("div",{className:"w-full max-w-2xl",children:[n.jsxs("div",{className:"mb-6 flex items-center justify-center gap-3",children:[n.jsx("div",{className:"grid h-10 w-10 place-items-center rounded-xl bg-blue-600 text-white ring-8 ring-blue-50",children:n.jsx("span",{className:"text-sm font-bold tracking-tight",children:"NDH"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-semibold tracking-tight",children:"Onboard a New Hospital / Clinic"}),n.jsx("p",{className:"text-xs text-slate-500",children:"This will create a dedicated NABH HIMS & EMR tenant with its own database."})]})]}),n.jsxs("form",{onSubmit:u,className:"space-y-5 rounded-2xl border border-slate-500 bg-white/80 p-6 shadow-sm backdrop-blur",children:[n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-sm text-slate-700",children:"Hospital / Clinic Name"}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 focus-within:ring-2 focus-within:ring-blue-200",children:[n.jsx(Xa,{className:"h-4 w-4 text-slate-400"}),n.jsx("input",{className:"w-full bg-transparent outline-none placeholder:text-slate-400",placeholder:"Kovai Multispeciality Hospital",value:t.tenant_name,onChange:d("tenant_name"),required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm text-slate-700",children:"Hospital Code (Tenant Code)"}),n.jsx("input",{className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-blue-200",placeholder:"KGH001",value:t.tenant_code,onChange:m=>s(x=>({...x,tenant_code:m.target.value.toUpperCase()}))}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Optional. If empty, the system will generate a code from the name."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm text-slate-700",children:"Contact Person"}),n.jsx("input",{className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-blue-200",placeholder:"Dr. Admin / IT Head",value:t.contact_person,onChange:d("contact_person"),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm text-slate-700",children:"Contact Phone"}),n.jsx("input",{className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-blue-200",placeholder:"+91 9XXXXXXXXX",value:t.contact_phone,onChange:d("contact_phone")})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-sm text-slate-700",children:"Hospital Address"}),n.jsx("textarea",{className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-blue-200",placeholder:"Address, City, State, Pincode",rows:2,value:t.hospital_address,onChange:d("hospital_address")})]})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border border-slate-100 bg-slate-50/70 p-4",children:[n.jsxs("div",{className:"mb-1 flex items-center gap-2 text-sm font-medium text-slate-800",children:[n.jsx(gr,{className:"h-4 w-4 text-blue-600"}),"Subscription & License Period"]}),n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm text-slate-700",children:"Subscription Plan"}),n.jsxs("select",{className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-200",value:t.subscription_plan,onChange:d("subscription_plan"),children:[n.jsx("option",{value:"basic",children:"Basic (Monthly)"}),n.jsx("option",{value:"standard",children:"Standard (6 Months)"}),n.jsx("option",{value:"premium",children:"Premium (1 Year)"})]})]}),n.jsxs("div",{className:"text-xs text-slate-600 space-y-1",children:[n.jsx("p",{className:"font-medium text-slate-700",children:"License Duration (auto-calculated):"}),n.jsxs("ul",{className:"list-disc pl-4 space-y-0.5",children:[n.jsx("li",{children:"Basic  30 days from registration"}),n.jsx("li",{children:"Standard  6 months from registration"}),n.jsx("li",{children:"Premium  1 year from registration"})]}),n.jsx("p",{className:"pt-1 text-[11px] text-slate-500",children:"AMC, subscription amount, and renewals are configured by NUTRYAH admin in the master console. They are not editable from this screen."})]})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50/80 p-4",children:[n.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium text-slate-800",children:[n.jsx(ohe,{className:"h-4 w-4 text-blue-600"}),"Admin Login for this Tenant"]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-slate-600",children:"Admin Name"}),n.jsx("input",{className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-blue-200",placeholder:"Super Admin",value:t.admin_name,onChange:d("admin_name"),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-slate-600",children:"Admin Email"}),n.jsx("input",{type:"email",className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none placeholder:text-slate-400 focus:ring-2 focus:ring-blue-200",placeholder:"admin@hospital.org",value:t.email,onChange:d("email"),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-slate-600",children:"Password"}),n.jsx("input",{type:"password",className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-200",value:t.password,onChange:d("password"),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-slate-600",children:"Confirm Password"}),n.jsx("input",{type:"password",className:"w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-200",value:t.confirm_password,onChange:d("confirm_password"),required:!0})]})]})]}),i&&n.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:i}),n.jsx("button",{type:"submit",disabled:r,className:"inline-flex w-full items-center justify-center gap-2 rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-medium text-white shadow-sm transition active:scale-[0.99] disabled:cursor-not-allowed disabled:opacity-60",children:r?n.jsxs(n.Fragment,{children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Creating Tenant"]}):"Create Tenant & Admin"}),n.jsx("p",{className:"text-center text-[11px] text-slate-500",children:"After this step, use the Hospital Code + Admin Email to login and access the dedicated HIMS database."})]})]})})]})}function exe(){var T,B;const t=pi(),s=Qr(),r=dn(U=>U.verifyOtp),a=dn(U=>U.fetchProfile),[i]=p.useState(((T=t.state)==null?void 0:T.email)||localStorage.getItem("pending_email")||""),[l]=p.useState(((B=t.state)==null?void 0:B.tenant_code)||localStorage.getItem("pending_tenant_code")||localStorage.getItem("tenant_code")||""),[o,c]=p.useState(["","","","","",""]),[d,u]=p.useState(""),[m,x]=p.useState(!1),[g,y]=p.useState(60),[v,j]=p.useState(!1),w=p.useRef([]);p.useEffect(()=>{(!i||!l)&&s("/auth/login",{replace:!0})},[i,l,s]),p.useEffect(()=>{if(g<=0)return;const U=setInterval(()=>y(W=>W-1),1e3);return()=>clearInterval(U)},[g]);const S=p.useMemo(()=>o.join(""),[o]),E=S.length===6&&!o.includes("")&&!m,k=(U,W)=>{var R;const V=(W||"").replace(/\D/g,"").slice(-1);c(F=>{const G=[...F];return G[U]=V,G}),V&&U<5&&((R=w.current[U+1])==null||R.focus())},A=(U,W)=>{var V,R,F;W.key==="Backspace"?o[U]?c(G=>{const H=[...G];return H[U]="",H}):U>0&&((V=w.current[U-1])==null||V.focus(),c(G=>{const H=[...G];return H[U-1]="",H})):W.key==="ArrowLeft"&&U>0?(R=w.current[U-1])==null||R.focus():W.key==="ArrowRight"&&U<5&&((F=w.current[U+1])==null||F.focus())},I=U=>{var R;U.preventDefault();const W=(U.clipboardData.getData("text")||"").replace(/\D/g,"").slice(0,6);if(!W)return;const V=W.split("");c([V[0]||"",V[1]||"",V[2]||"",V[3]||"",V[4]||"",V[5]||""]),(R=w.current[Math.min(W.length,5)])==null||R.focus()},P=async U=>{var W,V;if(U.preventDefault(),!!E){u(""),x(!0);try{await r({tenant_code:l,email:i,otp:S}),await a(),j(!0),setTimeout(()=>{const R=dn.getState().user;R!=null&&R.is_admin?s("/admin",{replace:!0}):s("/dashboard",{replace:!0})},400)}catch(R){u(((V=(W=R==null?void 0:R.response)==null?void 0:W.data)==null?void 0:V.detail)||"Invalid or expired OTP")}finally{x(!1)}}},O=()=>{s("/auth/login",{state:{email:i,tenant_code:l},replace:!0})},D=()=>{O()};return n.jsxs("div",{className:"relative min-h-screen overflow-hidden bg-gradient-to-b from-gray-50 to-white",children:[n.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[n.jsx("div",{className:"absolute -left-24 -top-24 h-64 w-64 rounded-full bg-blue-100 blur-3xl animate-pulse"}),n.jsx("div",{className:"absolute -right-24 -bottom-24 h-72 w-72 rounded-full bg-indigo-100 blur-3xl animate-pulse"})]}),n.jsx("div",{className:"relative z-10 grid min-h-screen place-items-center px-4 py-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-gray-100 bg-white/80 p-6 shadow-sm backdrop-blur",children:[n.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"grid h-10 w-10 place-items-center rounded-xl bg-blue-600 text-white ring-8 ring-blue-50",children:n.jsx("span",{className:"text-sm font-bold",children:"NDH"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"Verify OTP"}),n.jsx("p",{className:"text-xs text-gray-500",children:"We sent a 6-digit code to your email"})]})]}),n.jsx(Ka,{className:"h-6 w-6 text-emerald-600"})]}),n.jsxs("div",{className:"mb-4 space-y-2 text-sm",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-2 text-gray-700",children:[n.jsx(Qp,{className:"h-4 w-4 text-gray-400"}),n.jsx("span",{className:"truncate",children:i}),n.jsx("button",{type:"button",onClick:O,className:"ml-auto text-xs text-blue-700 underline-offset-2 hover:underline",children:"Change"})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-2 text-gray-700",children:[n.jsx(Xa,{className:"h-4 w-4 text-gray-400"}),n.jsxs("span",{className:"text-xs font-medium uppercase",children:["Hospital Code: ",l]})]})]}),n.jsxs("form",{onSubmit:P,className:"space-y-4",children:[n.jsx("div",{className:"grid grid-cols-6 gap-2 sm:gap-3",onPaste:I,children:o.map((U,W)=>n.jsx("input",{ref:V=>w.current[W]=V,value:U,inputMode:"numeric",pattern:"[0-9]*",maxLength:1,autoFocus:W===0,onChange:V=>k(W,V.target.value),onKeyDown:V=>A(W,V),className:`h-12 rounded-xl border border-gray-200 text-center text-lg tracking-[0.2em] outline-none transition\r
                               focus:border-blue-400 focus:ring-2 focus:ring-blue-200 sm:h-14`,"aria-label":`OTP digit ${W+1}`},W))}),n.jsx("button",{className:"inline-flex w-full items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-2.5 text-white shadow-sm transition active:scale-[0.99] disabled:cursor-not-allowed disabled:opacity-60",disabled:!E,type:"submit",children:m?n.jsxs(n.Fragment,{children:[n.jsx(Rt,{className:"h-5 w-5 animate-spin"}),"Verifying"]}):v?n.jsxs(n.Fragment,{children:[n.jsx(Xt,{className:"h-5 w-5"}),"Verified"]}):"Verify & Continue"}),n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[n.jsxs("button",{type:"button",onClick:O,className:"inline-flex items-center gap-1 rounded-lg px-2 py-1 hover:bg-gray-50",children:[n.jsx(Hl,{className:"h-3.5 w-3.5"}),"Back to login"]}),n.jsx("div",{className:"flex items-center gap-2",children:g>0?n.jsxs("span",{className:"rounded-lg bg-gray-50 px-2 py-1 tabular-nums",children:["Resend in ",g,"s"]}):n.jsx("button",{type:"button",onClick:D,className:"rounded-lg bg-gray-900 px-2 py-1 text-white hover:bg-gray-800",children:"Resend OTP"})})]}),d&&n.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",role:"alert","aria-live":"polite",children:d})]}),m&&n.jsx("div",{className:"absolute inset-0 grid place-items-center rounded-2xl bg-white/70 backdrop-blur-sm",children:n.jsxs("div",{className:"w-full max-w-xs rounded-xl border border-gray-100 bg-white p-4 shadow-md",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm text-gray-700",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin text-blue-600"}),"Verifying"]}),n.jsx("div",{className:"relative h-2 overflow-hidden rounded-full bg-gray-100",children:n.jsx("div",{className:"absolute inset-y-0 left-0 w-1/3 animate-[progress_1.1s_infinite_linear] rounded-full bg-gradient-to-r from-blue-500 to-indigo-500"})})]})})]}),n.jsx("div",{className:"mx-auto mt-6 text-center text-xs text-gray-500",children:"Didnt receive the mail? Check Spam/Junk folder."})]})}),n.jsx("style",{children:`
        @keyframes progress {
          0% { transform: translateX(-120%); }
          100% { transform: translateX(300%); }
        }
      `})]})}const txe=(()=>{try{return JSON.parse(localStorage.getItem("sidebarCollapsed")||"false")}catch{return!1}})(),BV=yV(t=>({sidebarCollapsed:txe,sidebarMobileOpen:!1,toggleCollapse:()=>t(s=>{const r=!s.sidebarCollapsed;return localStorage.setItem("sidebarCollapsed",JSON.stringify(r)),{sidebarCollapsed:r}}),openMobile:()=>t({sidebarMobileOpen:!0}),closeMobile:()=>t({sidebarMobileOpen:!1}),toggleMobile:()=>t(s=>({sidebarMobileOpen:!s.sidebarMobileOpen}))}));function sxe(){return he.get("/settings/ui-branding/public")}function nxe(){return he.get("/settings/ui-branding")}function rxe(t){return he.put("/settings/ui-branding",t)}function axe(t){return he.post("/settings/ui-branding/assets",t,{headers:{"Content-Type":"multipart/form-data"}})}function ixe(t){return he.post("/settings/ui-branding/letterhead",t,{headers:{"Content-Type":"multipart/form-data"}})}const $V=p.createContext({branding:null,setBranding:()=>{},loading:!0}),lxe="https://api.nutryah.com/api",oxe=lxe.replace(/\/api\/?$/,"");function Dc(t){if(!t)return;const s=String(t).trim();if(!s)return;if(/^https?:\/\//i.test(s))return s;if(s.startsWith("//"))return`${window.location.protocol}${s}`;const r=s.startsWith("/")?s:`/${s}`;return`${oxe}${r}`}function uC(t){if(!t)return null;const s={...t};return s.primary_color=s.primary_color||"#2563eb",s.primary_color_dark=s.primary_color_dark||null,s.sidebar_bg_color=s.sidebar_bg_color||"#ffffff",s.content_bg_color=s.content_bg_color||"#f9fafb",s.card_bg_color=s.card_bg_color||"#ffffff",s.border_color=s.border_color||"#e5e7eb",s.text_color=s.text_color||"#111827",s.text_muted_color=s.text_muted_color||"#e5e7eb",s.icon_color=s.icon_color||s.text_color||"#2563eb",s.icon_bg_color=s.icon_bg_color||"rgba(37,99,235,0.08)",s.logo_path&&!s.logo_url?s.logo_url=Dc(`/media/${String(s.logo_path).replace(/^\/+/,"")}`):s.logo_url&&(s.logo_url=Dc(s.logo_url)),s.login_logo_path&&!s.login_logo_url?s.login_logo_url=Dc(`/media/${String(s.login_logo_path).replace(/^\/+/,"")}`):s.login_logo_url&&(s.login_logo_url=Dc(s.login_logo_url)),s.favicon_path&&!s.favicon_url?s.favicon_url=Dc(`/media/${String(s.favicon_path).replace(/^\/+/,"")}`):s.favicon_url&&(s.favicon_url=Dc(s.favicon_url)),s.pdf_header_path&&!s.pdf_header_url?s.pdf_header_url=Dc(`/media/${String(s.pdf_header_path).replace(/^\/+/,"")}`):s.pdf_header_url&&(s.pdf_header_url=Dc(s.pdf_header_url)),s.pdf_footer_path&&!s.pdf_footer_url?s.pdf_footer_url=Dc(`/media/${String(s.pdf_footer_path).replace(/^\/+/,"")}`):s.pdf_footer_url&&(s.pdf_footer_url=Dc(s.pdf_footer_url)),s}function cxe({children:t}){const[s,r]=p.useState(null),[a,i]=p.useState(!0),l=o=>{r(typeof o=="function"?c=>uC(o(c)):uC(o))};return p.useEffect(()=>{let o=!0;return(async()=>{try{let d;try{d=(await sxe()).data}catch(m){console.warn("Public branding failed, falling back to /settings/ui-branding",m),d=(await nxe()).data}if(!o)return;console.log("[BrandingProvider] raw branding from API:",d);const u=uC(d);console.log("[BrandingProvider] normalized branding:",u),r(u)}catch(d){console.error("Failed to load branding",d),ae.error("Failed to load customization settings")}finally{o&&i(!1)}})(),()=>{o=!1}},[]),n.jsx($V.Provider,{value:{branding:s,setBranding:l,loading:a},children:t})}function iu(){return p.useContext($V)}const dxe="#2563eb",uxe=t=>!t.startsWith("#")||t.length!==7?"#eff6ff":`${t}1A`,uR=t=>!t.startsWith("#")||t.length!==7?"#bfdbfe":`${t}33`,mxe="NUTRYAH";function hxe(t){try{if(!t)return null;const s=t.split(".");if(s.length<2)return null;const a=s[1].replace(/-/g,"+").replace(/_/g,"/"),i=a.length%4?"=".repeat(4-a.length%4):"";return JSON.parse(atob(a+i))}catch{return null}}function xxe(){const t=localStorage.getItem("access_token"),s=hxe(t),r=String((s==null?void 0:s.tcode)||"").trim().toUpperCase(),a=String(localStorage.getItem("tenant_code")||"").trim().toUpperCase(),i=String(mxe).trim().toUpperCase();return r&&r===i||a&&a===i}const pxe=[{key:"Dashboard",label:"Dashboard",icon:o1,flatLink:{to:"/dashboard",reqAny:["patients.view"]}},{key:"patients",label:"Patients management",icon:uc,flatLink:{to:"/patients",reqAny:["patients.view","patients.create","patients.update"]}},{key:"patients masters",label:"Patients masters",icon:Pr,flatLink:{to:"/patients/masters",reqAny:["patients.masters.view"]}},{key:"MIS",label:"MIS & Analytics",icon:$de,flatLink:{to:"/mis",reqAny:["mis.view"]}},{key:"emr",label:"Patients EMR",icon:Xn,flatLink:{to:"/emr",reqAny:["emr.view"]}},{key:"pharmacy",label:"Pharmacy",icon:rr,items:[{key:"pharmacy-inventory",label:"Inventory & Stock",to:"/pharmacy/inventory",icon:NV,reqAny:["pharmacy.inventory.stock.view","pharmacy.inventory.items.view","pharmacy.inventory.po.view"]},{key:"pharmacy-barcode-lookup",label:"Barcode / QR Lookup",to:"/pharmacy/inventory/barcode-lookup",icon:Ng,reqAny:["pharmacy.inventory.stock.view"]},{key:"pharmacy-rx",label:"Pharmacy RX",to:"/pharmacy/rx",icon:nN,reqAny:["pharmacy.inventory.stock.view"]},{key:"pharmacy-dispense",label:"Pharmacy Dispense",to:"/pharmacy/dispense",icon:rb,reqAny:["pharmacy.inventory.stock.view"]},{key:"pharmacy-supplier-ledger",label:"Supplier Ledger",to:"/pharmacy/accounts/supplier-ledger",icon:Cde,reqAny:["pharmacy.accounts.supplier_ledger.view","pharmacy.accounts.supplier_ledger.manage","pharmacy.accounts.supplier_ledger.export"]},{key:"pharmacy-supplier-monthly-summary",label:"Monthly Summary",to:"/pharmacy/accounts/supplier-monthly-summary",icon:Ds,reqAny:["pharmacy.accounts.supplier_ledger.view","pharmacy.accounts.supplier_ledger.manage","pharmacy.accounts.supplier_ledger.export"]},{key:"pharmacy-supplier-payments",label:"Supplier Payments",to:"/pharmacy/accounts/supplier-payments",icon:Xo,reqAny:["pharmacy.accounts.supplier_ledger.view","pharmacy.accounts.supplier_ledger.manage","pharmacy.accounts.supplier_ledger.export"]},{key:"pharmacy-supplier-statement",label:"Supplier Statement",to:"/pharmacy/accounts/supplier-statement",icon:Xn,reqAny:["pharmacy.accounts.supplier_ledger.view","pharmacy.accounts.supplier_ledger.manage","pharmacy.accounts.supplier_ledger.export"]}]},{key:"user-mgmt",label:"User Management",icon:Ka,items:[{key:"departments",label:"Departments",to:"/admin/departments",icon:Xa,reqAny:["departments.view","departments.create","departments.update","departments.delete"]},{key:"roles",label:"Roles",to:"/admin/roles",icon:Ka,reqAny:["roles.view","roles.create","roles.update","roles.delete"]},{key:"users",label:"Users",to:"/admin/users",icon:uc,reqAny:["users.view","users.create","users.update","users.delete"]}]},{key:"op",label:"OP",icon:Hs,items:[{key:"op-dashboard",label:"Dashboard",to:"/opd/dashboard",icon:o1,reqAny:["appointments.view","mis.opd.view"]},{key:"appointments",label:"Appointments",to:"/opd/appointments",icon:nR,reqAny:["appointments.view","appointments.create"]},{key:"triage",label:"Vitals (Triage)",to:"/opd/triage",icon:Qs,reqAny:["vitals.create"]},{key:"queue",label:"Queue",to:"/opd/queue",icon:cme,reqAny:["appointments.view","visits.view"]},{key:"followups",label:"Follow-ups (Waiting)",to:"/opd/followups",icon:Na,reqAny:["appointments.view","appointments.update"]},{key:"no-shows",label:"No-show Reschedule",to:"/opd/no-shows",icon:tb,reqAny:["appointments.view","appointments.update"]},{key:"Doctor Fees",label:"Doctor Fees",to:"/opd/doctor-fees",icon:vh,reqAny:["appointments.view","appointments.update"]}]},{key:"ip",label:"IP",icon:cn,items:[{key:"ipd-admissions",label:"Admissions",to:"/ipd/admissions",icon:Due,reqAny:["ipd.view","ipd.manage"]},{key:"ipd-tracking",label:"Tracking",to:"/ipd/tracking",icon:o1,reqAny:["ipd.tracking.view"]},{key:"ipd-my",label:"My Admissions",to:"/ipd/my",icon:nN,reqAny:["ipd.my.view","ipd.doctor"]},{key:"ipd-discharged",label:"Discharged",to:"/ipd/discharged",icon:l2,reqAny:["ipd.discharged.view"]},{key:"ipd-bedboard",label:"Bedboard",to:"/ipd/bedboard",icon:cn,reqAny:["ipd.bedboard.view"]},{key:"ipd-masters",label:"IPD Masters",to:"/ipd/masters",icon:ic,reqAny:["ipd.masters.manage","ipd.packages.manage"]}]},{key:"lab",label:"Laboratory",icon:tl,items:[{key:"lab-orders",label:"Orders & Reporting",to:"/lab/orders",icon:Nhe,reqAny:["lab.orders.view","lab.orders.create","orders.lab.view","orders.lab.create"]},{key:"lab-service-master",label:"Lab Service Master",to:"/lab/service/masters",icon:PV,reqAny:["lis.masters.services.view","lis.masters.services.create","lis.masters.services.update"]},{key:"lab-device-mapping",label:"Analyzer Device Mapping",to:"/lis/device-mapping",icon:_V,reqAny:["lab.devices.view","lab.devices.manage"]},{key:"lab-analyzer-staging",label:"Analyzer Staging",to:"/lis/analyzer-staging",icon:rN,reqAny:["lab.device_results.review","lab.devices.view"]},{key:"lab-device-logs",label:"Analyzer Logs",to:"/lis/device-logs",icon:tb,reqAny:["lab.device_logs.view","lab.devices.view"]},{key:"lab-masters",label:"Lab Masters (NABL)",to:"/lab/masters",icon:ic,reqAny:["lab.masters.manage"]}]},{key:"ris",label:"Radiology",icon:Ng,items:[{key:"ris-orders",label:"Orders & Reporting",to:"/ris/orders",icon:Ng,reqAny:["radiology.orders.view","radiology.orders.create","orders.ris.view","orders.ris.create","radiology.report.create","radiology.report.approve","radiology.schedule.manage","radiology.scan.update"]},{key:"ris-masters",label:"RIS Masters",to:"/ris/masters",icon:ic,reqAny:["radiology.masters.manage"]}]},{key:"ot",label:"Operation Theatre",icon:OV,items:[{key:"ot-masters",label:"OT Masters",to:"/ot/masters",icon:rN,reqAny:["ot.masters.view","ot.specialities.view","ot.procedures.view","ot.masters.create","ot.masters.update","ot.masters.delete","ot.specialities.create","ot.specialities.update","ot.specialities.delete","ot.procedures.create","ot.procedures.update","ot.procedures.delete"]},{key:"ot-schedule",label:"OT Schedule",to:"/ot/schedule",icon:Ds,reqAny:["ot.schedule.view"]}]},{key:"billing",label:"Billing",icon:vh,items:[{key:"billing-console",label:"Billing Console",to:"/billing",icon:o1,reqAny:["billing.view","billing.create"]}]},{key:"settings",label:"Settings",icon:rhe,items:[{key:"schedules",label:"Schedules",to:"/opd/schedules",icon:nR,reqAny:["schedules.manage"]},{key:"ui-branding",label:"Customization & Templates",to:"/settings/branding",icon:ime,reqAny:["settings.customization.view","settings.customization.manage"]},{key:"perm-logs",label:"Permissions (Access Logs)",to:"/admin/permissions",icon:ic,reqAny:["permissions.view","permissions.create","permissions.update","permissions.delete"]}]},{key:"provider",label:"Provider Console",icon:sN,items:[{key:"master-migrations",label:"Master Migrations",to:"/master/migrations",icon:sN,reqAny:["master.migrations.view"],providerOnly:!0}]}];function fxe(){const t=dn($=>$.user),s=dn($=>$.modules)||{},r=pi(),{sidebarCollapsed:a,toggleCollapse:i,sidebarMobileOpen:l,closeMobile:o}=BV(),{branding:c}=iu()||{},[d,u]=p.useState(()=>typeof window>"u"?!0:window.matchMedia("(min-width: 768px)").matches);p.useEffect(()=>{if(typeof window>"u")return;const $=window.matchMedia("(min-width: 768px)"),K=le=>u(le.matches);return $.addEventListener?$.addEventListener("change",K):$.addListener(K),u($.matches),()=>{$.removeEventListener?$.removeEventListener("change",K):$.removeListener(K)}},[]);const m=!!a&&d,x=(c==null?void 0:c.primary_color)||dxe,g=(c==null?void 0:c.sidebar_bg_color)||"#ffffff",y=(c==null?void 0:c.text_color)||"#111827",v=(c==null?void 0:c.icon_color)||y,j=(c==null?void 0:c.icon_bg_color)||"rgba(37,99,235,0.08)",w=uxe(x),S=uR(x),E=((c==null?void 0:c.org_name)||"").trim()||"NABH HIMS",k=((c==null?void 0:c.org_tagline)||"").trim()||"Smart  Secure  NABH-Standard",A=((c==null?void 0:c.org_logo_url)||(c==null?void 0:c.logo_url)||(c==null?void 0:c.logo)||"").toString().trim()||null,I=p.useMemo(()=>{var le;const $=(le=c==null?void 0:c.org_name)==null?void 0:le.trim();if(!$)return"NH";const K=$.split(/\s+/).filter(Boolean);return K.length?K.length===1?K[0].slice(0,2).toUpperCase():(K[0][0]+K[1][0]).toUpperCase():"NH"},[c==null?void 0:c.org_name]);p.useEffect(()=>{if(!l)return;const $=document.body.style.overflow,K=document.documentElement.style.overscrollBehavior;return document.body.style.overflow="hidden",document.documentElement.style.overscrollBehavior="none",()=>{document.body.style.overflow=$||"",document.documentElement.style.overscrollBehavior=K||""}},[l]);const P=!!(t!=null&&t.is_admin),O=p.useMemo(()=>xxe(),[]),D=p.useMemo(()=>{const $=Object.values(s).flat().map(le=>typeof le=="string"?le:le==null?void 0:le.code).filter(Boolean),K=((t==null?void 0:t.permissions)||[]).map(le=>typeof le=="string"?le:le==null?void 0:le.code).filter(Boolean);return new Set([...$||[],...K||[]])},[s,t]),T=($=[])=>P?!0:($||[]).some(K=>D.has(K)),B=$=>$.flatLink?r.pathname.startsWith($.flatLink.to):($.items||[]).some(K=>r.pathname.startsWith(K.to)),U=p.useMemo(()=>pxe.map($=>{var se;if($.flatLink){const ie=((se=$.flatLink)!=null&&se.providerOnly?O:!0)&&T($.flatLink.reqAny);return{...$,_visible:ie}}const K=($.items||[]).map(J=>{const ie=J.providerOnly?O:!0;return{...J,_visible:ie&&T(J.reqAny)}}),le=K.some(J=>J._visible);return{...$,items:K,_visible:le}}).filter($=>$._visible),[P,D,O]),[W,V]=p.useState({});p.useEffect(()=>{const $={};U.forEach(K=>{$[K.key]=B(K)}),V(K=>({...K,...$}))},[r.pathname]);const R=$=>V(K=>({...K,[$]:!K[$]})),[F,G]=p.useState(null);p.useEffect(()=>{m||G(null)},[m]),p.useEffect(()=>{G(null)},[r.pathname]);const H=m?"md:w-16":"md:w-64";return n.jsxs(n.Fragment,{children:[n.jsx("div",{onClick:o,className:["fixed inset-0 z-[100] bg-black/35 backdrop-blur-sm transition-opacity md:hidden",l?"opacity-100":"pointer-events-none opacity-0"].join(" ")}),m&&F?n.jsx("div",{className:"fixed inset-0 z-40 hidden md:block",onClick:()=>G(null)}):null,n.jsxs("aside",{className:["z-50 border-r transition-[width,transform] duration-300 ease-out","fixed left-0 top-0 h-[100dvh] w-[86vw] max-w-sm md:w-auto",l?"translate-x-0":"-translate-x-full","md:static md:translate-x-0 md:sticky md:top-0 md:h-[100dvh]",H,"grid grid-rows-[auto,1fr,auto] min-h-0","overflow-x-hidden overflow-y-hidden"].join(" "),style:{backgroundColor:g,color:y},children:[n.jsxs("div",{className:m?"px-2 py-3 flex flex-col items-center gap-2":"px-3 py-3 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:m?"flex flex-col items-center gap-2":"flex items-center gap-2 min-w-0",children:[n.jsx("div",{className:["grid place-items-center rounded-2xl border shadow-sm overflow-hidden shrink-0","h-10 w-10"].join(" "),style:{backgroundColor:j,borderColor:uR(x)},title:E,children:A?n.jsx("img",{src:A,alt:E,className:"h-full w-full object-cover",onError:$=>{$.currentTarget.style.display="none"}}):n.jsx("span",{className:"text-sm font-extrabold tracking-tight",style:{color:x},children:I})}),!m&&n.jsxs("div",{className:"truncate",children:[n.jsx("div",{className:"text-xs font-semibold tracking-tight leading-snug truncate",children:E}),n.jsx("div",{className:"text-[10px] leading-tight text-slate-500 truncate",children:k}),O?n.jsx("div",{className:"mt-1 inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] font-semibold",style:{borderColor:S,color:x,backgroundColor:w},children:"Provider"}):null]})]}),n.jsx("button",{onClick:o,className:"md:hidden inline-flex h-9 w-9 items-center justify-center rounded-2xl hover:bg-gray-50 active:scale-95 transition","aria-label":"Close sidebar",children:n.jsx(ts,{className:"h-5 w-5",style:{color:v}})}),n.jsx("button",{onClick:()=>{G(null),i()},className:["hidden md:inline-flex items-center justify-center",m?"h-9 w-9 rounded-2xl":"h-8 w-8 rounded-xl","hover:bg-gray-50 active:scale-95 transition"].join(" "),"aria-label":m?"Expand sidebar":"Collapse sidebar",title:m?"Expand":"Collapse",children:m?n.jsx(Ti,{className:"h-5 w-5",style:{color:v}}):n.jsx(ry,{className:"h-5 w-5",style:{color:v}})})]}),n.jsxs("nav",{className:"min-h-0 flex-1 overflow-y-auto no-scrollbar y-fade px-2 pb-4 pt-1 space-y-1 overscroll-contain touch-pan-y",style:{WebkitOverflowScrolling:"touch"},children:[U.map($=>{if($.flatLink){const ie=$.icon||ic,te=B($);return n.jsxs(JS,{to:$.flatLink.to,onClick:o,className:["group relative flex h-10 items-center gap-3 rounded-xl px-3 text-sm leading-none","transition-colors duration-200 ease-out active:scale-[0.99]",m?"justify-center":""].join(" "),style:({isActive:ne})=>ne?{color:"#ffffff",backgroundColor:x,boxShadow:`0 0 0 1px ${S}`}:{color:y},title:m?$.label:void 0,children:[n.jsx(ie,{className:"h-5 w-5 shrink-0",style:{color:te?"#ffffff":v}}),!m&&n.jsx("span",{children:$.label})]},$.key)}const K=$.icon||ic,le=B($),se=!!W[$.key]&&!m,J=m&&F===$.key;return n.jsxs("div",{className:"relative rounded-xl",children:[n.jsxs("button",{type:"button",onClick:()=>{if(m){G(ie=>ie===$.key?null:$.key);return}R($.key)},className:["w-full flex items-center gap-3 rounded-xl px-3 h-10 text-sm","transition-colors duration-200 ease-out active:scale-[0.99]",m?"justify-center":"justify-between"].join(" "),title:m?$.label:void 0,"aria-expanded":m?J:se,style:{color:le?x:y,backgroundColor:le?w:"transparent",boxShadow:le?`0 0 0 1px ${S}`:void 0},children:[n.jsxs("span",{className:"flex items-center gap-3",children:[n.jsx(K,{className:"h-5 w-5 shrink-0",style:{color:v}}),!m&&n.jsx("span",{className:"font-medium",children:$.label})]}),!m&&n.jsx(Gn,{className:["h-4 w-4 transition-transform duration-200",se?"rotate-180":"rotate-0"].join(" "),style:{color:v}})]}),se&&n.jsx("div",{className:"mt-1 space-y-1 pl-9",children:$.items.filter(ie=>ie._visible).map(ie=>{const te=ie.icon||ic;return n.jsxs(JS,{to:ie.to,onClick:o,className:"group relative flex h-9 items-center gap-2 rounded-lg px-2 text-sm leading-none transition-colors duration-200 ease-out active:scale-[0.99]",style:({isActive:ne})=>ne?{color:x,backgroundColor:w,boxShadow:`0 0 0 1px ${S}`}:{color:y},children:[n.jsx(te,{className:"h-[18px] w-[18px] shrink-0",style:{color:v}}),n.jsx("span",{children:ie.label})]},ie.key)})}),J?n.jsxs("div",{className:"absolute left-full top-0 ml-2 z-[60] hidden md:block w-72 rounded-2xl border border-slate-500 bg-white shadow-2xl overflow-hidden",children:[n.jsxs("div",{className:"px-3 py-2 border-b bg-slate-50",children:[n.jsx("div",{className:"text-xs font-black text-slate-900",children:$.label}),n.jsx("div",{className:"text-[10px] text-slate-500",children:"Select a page"})]}),n.jsx("div",{className:"p-2 space-y-1 max-h-[70vh] overflow-y-auto no-scrollbar",children:$.items.filter(ie=>ie._visible).map(ie=>{const te=ie.icon||ic;return n.jsxs(JS,{to:ie.to,onClick:()=>{G(null),o()},className:"flex items-center gap-2 rounded-xl px-2.5 py-2 text-sm hover:bg-slate-50 transition",style:({isActive:ne})=>ne?{color:x,backgroundColor:w,boxShadow:`0 0 0 1px ${S}`}:{color:"#0f172a"},children:[n.jsx("span",{className:"grid h-8 w-8 place-items-center rounded-xl border border-slate-500 bg-white",children:n.jsx(te,{className:"h-[18px] w-[18px]",style:{color:v}})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold truncate",children:ie.label}),n.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:ie.to})]})]},ie.key)})}),n.jsx("div",{className:"px-3 py-2 border-t bg-white flex justify-end",children:n.jsx("button",{onClick:()=>G(null),className:"rounded-xl border border-slate-500 bg-white px-3 py-1.5 text-[11px] font-bold text-slate-700 hover:bg-slate-50",children:"Close"})})]}):null]},$.key)}),U.length===0&&n.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No modules granted. Contact administrator."})]}),n.jsx("div",{className:"px-3 pb-3",children:m?n.jsx("div",{className:"grid place-items-center text-[10px] text-gray-400",children:"v1.0"}):n.jsx("div",{className:"rounded-xl border border-gray-100 bg-gray-50 p-3 text-[11px] text-gray-500",children:"Tip: Click the chevron to collapse the sidebar."})})]})]})}const gxe="#0f172a",bxe=t=>typeof t=="string"&&t.startsWith("#")&&t.length===7,mR=(t,s="1A")=>bxe(t)?`${t}${s}`:void 0,yxe=t=>{const s=(t||"").trim();if(!s)return"U";const r=s.split(/\s+/).filter(Boolean);return r.length===1?r[0].slice(0,2).toUpperCase():(r[0][0]+r[1][0]).toUpperCase()};function vxe(){const t=dn(F=>F.user),s=dn(F=>F.logout),r=dn(F=>F.fetchProfile),{toggleMobile:a}=BV(),{branding:i}=iu()||{},l=pi(),[o,c]=p.useState(new Date),[d,u]=p.useState(typeof navigator<"u"?navigator.onLine:!0),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState(!1),w=p.useRef(null),S=p.useRef(null),E=(i==null?void 0:i.primary_color)||gxe,k=(i==null?void 0:i.topbar_bg_color)||(i==null?void 0:i.primary_color_dark)||E,A=(i==null?void 0:i.topbar_text_color)||(i==null?void 0:i.text_muted_color)||"#e5e7eb",I=(i==null?void 0:i.topbar_icon_color)||(i==null?void 0:i.icon_color)||A,P=((i==null?void 0:i.org_name)||"").trim()||"NUTRYAH",O=((i==null?void 0:i.org_tagline)||"").trim()||"Smart  Secure  NABH-Standard",D=p.useMemo(()=>yxe((t==null?void 0:t.name)||(t==null?void 0:t.email)),[t==null?void 0:t.name,t==null?void 0:t.email]);p.useEffect(()=>{const F=setInterval(()=>c(new Date),1e3);return()=>clearInterval(F)},[]);const T=p.useMemo(()=>{try{return o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return o.toTimeString().slice(0,8)}},[o]),B=p.useMemo(()=>{try{return o.toLocaleDateString([],{weekday:"short",day:"2-digit",month:"short"})}catch{return o.toDateString()}},[o]);p.useEffect(()=>{const F=()=>u(navigator.onLine);return window.addEventListener("online",F),window.addEventListener("offline",F),()=>{window.removeEventListener("online",F),window.removeEventListener("offline",F)}},[]);const U=p.useMemo(()=>{if(!t)return"";if(t.is_admin)return"Admin";const F=t.roles||[];if(Array.isArray(F)&&F.length){const G=F[0];return typeof G=="string"?G:(G==null?void 0:G.name)||(G==null?void 0:G.code)||"User"}return"User"},[t]);p.useEffect(()=>{x(!1)},[l.pathname]),p.useEffect(()=>{if(!m)return;const F=H=>{var K,le;const $=H.target;(K=w.current)!=null&&K.contains($)||(le=S.current)!=null&&le.contains($)||x(!1)},G=H=>{H.key==="Escape"&&x(!1)};return window.addEventListener("mousedown",F),window.addEventListener("keydown",G),()=>{window.removeEventListener("mousedown",F),window.removeEventListener("keydown",G)}},[m]);const W=()=>{y(!0),setTimeout(()=>window.location.reload(),120)},V=async()=>{if(typeof r=="function"){j(!0);try{await r()}finally{setTimeout(()=>j(!1),500)}}},R=({ok:F})=>n.jsx("span",{title:F?"Online":"Offline",className:["inline-block h-2.5 w-2.5 rounded-full ring-2",F?"bg-emerald-500 ring-white/70":"bg-rose-500 ring-white/70"].join(" ")});return n.jsx("header",{className:"sticky top-0 z-[80] w-full border-b",style:{backgroundColor:k,color:A,borderColor:mR(E,"33")||"rgba(255,255,255,0.12)"},children:n.jsx("div",{className:"px-3 sm:px-4",children:n.jsxs("div",{className:"h-14 flex items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("button",{className:"md:hidden inline-flex h-10 w-10 items-center justify-center rounded-2xl ring-1 ring-white/20 hover:bg-white/10 active:scale-95 transition",onClick:a,"aria-label":"Open menu",title:"Menu",children:n.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",stroke:"currentColor",strokeWidth:"1.7",fill:"none",style:{color:I},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 7h16M4 12h16M4 17h16"})})}),n.jsx("div",{className:"flex items-center gap-2 min-w-0",children:n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"truncate text-[15px] sm:text-[16px] font-semibold tracking-tight",children:P}),n.jsx("div",{className:"hidden sm:block truncate text-[11px] opacity-90",children:O})]})})]}),n.jsx("div",{className:"hidden md:flex flex-1 items-center justify-center",children:n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-2xl border border-white/15 bg-white/10 px-3 py-2 text-[12px]",children:[n.jsx(R,{ok:d}),n.jsx("span",{className:"opacity-90",children:B}),n.jsx("span",{className:"opacity-60",children:""}),n.jsx("span",{className:"tabular-nums",children:T})]})}),n.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[n.jsxs("div",{className:"md:hidden inline-flex items-center gap-2 rounded-2xl border border-white/15 bg-white/10 px-3 py-2 text-xs",children:[n.jsx(R,{ok:d}),n.jsx("span",{className:"tabular-nums",children:T})]}),n.jsxs("button",{onClick:V,className:["hidden sm:inline-flex h-10 items-center gap-2 rounded-2xl border border-white/15 bg-white/10 px-3 text-sm",v?"animate-pulse":"hover:bg-white/15"].join(" "),title:"Sync profile",children:[n.jsx("svg",{viewBox:"0 0 24 24",className:["h-5 w-5",v?"animate-spin":""].join(" "),stroke:"currentColor",strokeWidth:"1.7",fill:"none",style:{color:I},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12a7.5 7.5 0 0 1 13.5-4.5M19.5 12A7.5 7.5 0 0 1 6 16.5M3 12h3m12 0h3"})}),n.jsx("span",{children:"Sync"})]}),n.jsxs("button",{onClick:W,className:"hidden sm:inline-flex h-10 items-center gap-2 rounded-2xl border border-white/15 bg-white/10 px-3 text-sm hover:bg-white/15 active:scale-95 transition",title:"Refresh",children:[n.jsx("svg",{viewBox:"0 0 24 24",className:["h-5 w-5",g?"animate-spin":""].join(" "),stroke:"currentColor",strokeWidth:"1.7",fill:"none",style:{color:I},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992V4.356M21 12a9 9 0 1 1-3-6.708"})}),n.jsx("span",{children:"Refresh"})]}),n.jsxs("button",{ref:S,onClick:()=>x(F=>!F),className:"inline-flex h-10 items-center gap-2 rounded-2xl border border-white/15 bg-white/10 pl-2 pr-3 hover:bg-white/15 transition","aria-haspopup":"menu","aria-expanded":m,title:"Account",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"grid h-8 w-8 place-items-center rounded-2xl bg-white/15 ring-1 ring-white/15",children:n.jsx("span",{className:"text-[12px] font-extrabold",children:D})}),n.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-3 w-3 rounded-full bg-emerald-500 ring-2 ring-black/20"})]}),n.jsxs("div",{className:"hidden sm:block text-left leading-tight min-w-[9.5rem]",children:[n.jsx("div",{className:"truncate text-[13px] font-semibold",children:(t==null?void 0:t.name)||""}),n.jsx("div",{className:"truncate text-[11px] opacity-90",children:U})]}),n.jsx("svg",{viewBox:"0 0 24 24",className:["hidden sm:block h-4 w-4 transition",m?"rotate-180":""].join(" "),fill:"none",stroke:"currentColor",strokeWidth:"1.7",style:{color:I},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 9l6 6 6-6"})})]}),n.jsxs("div",{ref:w,className:["absolute right-3 sm:right-4 top-[3.7rem] w-[18rem] origin-top-right","rounded-3xl border shadow-2xl overflow-hidden",m?"scale-100 opacity-100":"pointer-events-none scale-95 opacity-0","transition z-[85]"].join(" "),style:{backgroundColor:"#ffffff",borderColor:mR(E,"33")||"#e5e7eb"},children:[n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"grid h-11 w-11 place-items-center rounded-3xl border bg-slate-50",children:n.jsx("span",{className:"text-sm font-extrabold text-slate-900",children:D})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"truncate text-sm font-black text-slate-900",children:(t==null?void 0:t.name)||""}),n.jsx("div",{className:"truncate text-xs text-slate-600",children:U}),n.jsx("div",{className:"truncate text-[11px] text-slate-500",children:(t==null?void 0:t.email)||""})]})]}),n.jsxs("div",{className:"mt-3 grid gap-2",children:[n.jsxs("button",{onClick:V,className:"flex w-full items-center gap-2 rounded-2xl border bg-white px-3 py-2 text-left text-sm hover:bg-slate-50",style:{borderColor:"#e5e7eb"},children:[n.jsx("span",{className:v?"animate-spin":"",children:n.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.7",style:{color:E},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12a7.5 7.5 0 0 1 13.5-4.5M19.5 12A7.5 7.5 0 0 1 6 16.5M3 12h3m12 0h3"})})}),n.jsx("span",{className:"font-semibold text-slate-900",children:"Sync"})]}),n.jsxs("button",{onClick:W,className:"flex w-full items-center gap-2 rounded-2xl border bg-white px-3 py-2 text-left text-sm hover:bg-slate-50",style:{borderColor:"#e5e7eb"},children:[n.jsx("svg",{viewBox:"0 0 24 24",className:["h-5 w-5",g?"animate-spin":""].join(" "),fill:"none",stroke:"currentColor",strokeWidth:"1.7",style:{color:E},children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992V4.356M21 12a9 9 0 1 1-3-6.708"})}),n.jsx("span",{className:"font-semibold text-slate-900",children:"Refresh"})]}),n.jsx("div",{className:"my-1 h-px bg-slate-100"}),n.jsxs("button",{onClick:s,className:"flex w-full items-center gap-2 rounded-2xl bg-rose-50 px-3 py-2 text-left text-sm text-rose-700 hover:bg-rose-100",children:[n.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.7",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6A2.25 2.25 0 0 0 5.25 5.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 8l-4 4m0 0 4 4m-4-4h12"})}),n.jsx("span",{className:"font-extrabold",children:"Logout"})]})]})]}),n.jsxs("div",{className:"px-4 py-3 bg-slate-50 border-t text-[11px] text-slate-500",children:[B,"  ",n.jsx("span",{className:"tabular-nums",children:T})," "," ",n.jsx("span",{className:d?"text-emerald-600 font-bold":"text-rose-600 font-bold",children:d?"Online":"Offline"})]})]})]})]})})})}const jxe="#2563eb";function Nxe(){const{branding:t}=iu()||{},s=(t==null?void 0:t.primary_color)||jxe,r=(t==null?void 0:t.sidebar_bg_color)||"#f9fafb",a=(t==null?void 0:t.text_color)||"#4b5563";return n.jsx("footer",{className:"w-full border-t text-xs sm:text-[13px]",style:{borderTopColor:s,background:r,color:a},children:n.jsxs("div",{className:"mx-auto flex max-w-6xl flex-col gap-2 px-4 py-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"font-medium",children:["Powered by"," ",n.jsx("span",{className:"font-semibold",style:{color:s},children:"NUTRYAH DIGITAL HEALTH"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1",children:[n.jsx("span",{className:"font-medium",children:"Support:"}),n.jsx("a",{href:"tel:+918870787448",className:"hover:underline",style:{color:s},children:"Mobile: +91 88707 87448"}),n.jsx("span",{className:"hidden text-slate-300 md:inline",children:""}),n.jsx("a",{href:"mailto:support@nutryah.com",className:"hover:underline",style:{color:s},children:"Email: support@nutryah.com"}),n.jsx("span",{className:"hidden text-slate-300 md:inline",children:""}),n.jsx("a",{href:"https://www.nutryah.com",target:"_blank",rel:"noreferrer",className:"hover:underline",style:{color:s},children:"Website: www.nutryah.com"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1",children:[n.jsx("a",{href:"/privacy-policy",className:"hover:underline",style:{color:s},children:"Privacy Policy"}),n.jsx("span",{className:"text-slate-300",children:"|"}),n.jsx("a",{href:"/terms-and-conditions",className:"hover:underline",style:{color:s},children:"Terms & Conditions"})]})]})})}function wxe(){const{branding:t}=iu()||{},s=!!(t!=null&&t.content_bg_color),r=s?{backgroundColor:t.content_bg_color,color:t.text_color||void 0}:void 0;return n.jsx("div",{className:s?"h-dvh":"h-dvh bg-gradient-to-b from-gray-50 to-white",style:r,children:n.jsxs("div",{className:"flex h-dvh overflow-hidden ",children:[n.jsx(fxe,{}),n.jsxs("div",{className:"flex min-w-0 flex-1 flex-col ",children:[n.jsx("header",{className:"sticky top-0 z-40 shrink-0 border-b  backdrop-blur p-1 ",children:n.jsx(vxe,{})}),n.jsxs("main",{className:"min-w-0 flex-1 overflow-y-auto overflow-x-hidden",children:[n.jsx("div",{className:"w-full px-3 py-3 sm:px-4 lg:px-5",children:n.jsx(qE,{})}),n.jsx("div",{className:"px-3 pb-3 sm:px-4 lg:px-5",children:n.jsx(Nxe,{})})]})]})]})})}function _xe(){const{user:t,loading:s,fetchProfile:r}=dn(),[a,i]=p.useState(!1),l=localStorage.getItem("access_token"),o=pi();return p.useEffect(()=>{l&&!t&&!s&&(i(!0),r().finally(()=>i(!1)))},[l,t,s,r]),l?a||s||!t&&l?n.jsx("div",{className:"min-h-screen grid place-items-center text-sm",children:"Loading"}):n.jsx(qE,{}):n.jsx(Zj,{to:"/auth/login",state:{from:o},replace:!0})}const Sxe="NUTRYAH";function Cxe(t){try{if(!t)return null;const s=t.split(".");if(s.length<2)return null;const a=s[1].replace(/-/g,"+").replace(/_/g,"/"),i=a.length%4?"=".repeat(4-a.length%4):"";return JSON.parse(atob(a+i))}catch{return null}}function kxe({reqAny:t=[]}){const s=pi(),r=dn(d=>d.user),a=dn(d=>d.modules)||{},{okProvider:i}=p.useMemo(()=>{const d=localStorage.getItem("access_token"),u=Cxe(d),m=String((u==null?void 0:u.tcode)||"").trim().toUpperCase(),x=String(localStorage.getItem("tenant_code")||"").trim().toUpperCase(),g=String(Sxe).trim().toUpperCase();return{okProvider:m&&m===g||x&&x===g}},[]);if(!i)return n.jsx(Zj,{to:"/dashboard",replace:!0,state:{from:s.pathname}});const l=!!(r!=null&&r.is_admin),o=p.useMemo(()=>{const d=Object.values(a).flat().map(m=>typeof m=="string"?m:m==null?void 0:m.code).filter(Boolean),u=((r==null?void 0:r.permissions)||[]).map(m=>typeof m=="string"?m:m==null?void 0:m.code).filter(Boolean);return new Set([...d||[],...u||[]])},[a,r]),c=(d=[])=>l?!0:(d||[]).some(u=>o.has(u));return t!=null&&t.length&&!c(t)?n.jsx(Zj,{to:"/dashboard",replace:!0,state:{from:s.pathname}}):n.jsx(qE,{})}const JE=p.createContext({});function eT(t){const s=p.useRef(null);return s.current===null&&(s.current=t()),s.current}const tT=typeof window<"u",zV=tT?p.useLayoutEffect:p.useEffect,o2=p.createContext(null);function sT(t,s){t.indexOf(s)===-1&&t.push(s)}function nT(t,s){const r=t.indexOf(s);r>-1&&t.splice(r,1)}const Gd=(t,s,r)=>r>s?s:r<t?t:r;let rT=()=>{};const Kd={},UV=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function VV(t){return typeof t=="object"&&t!==null}const HV=t=>/^0[^.\s]+$/u.test(t);function aT(t){let s;return()=>(s===void 0&&(s=t()),s)}const ko=t=>t,Axe=(t,s)=>r=>s(t(r)),ay=(...t)=>t.reduce(Axe),ib=(t,s,r)=>{const a=s-t;return a===0?1:(r-t)/a};class iT{constructor(){this.subscriptions=[]}add(s){return sT(this.subscriptions,s),()=>nT(this.subscriptions,s)}notify(s,r,a){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](s,r,a);else for(let l=0;l<i;l++){const o=this.subscriptions[l];o&&o(s,r,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Jc=t=>t*1e3,No=t=>t/1e3;function WV(t,s){return s?t*(1e3/s):0}const qV=(t,s,r)=>(((1-3*r+3*s)*t+(3*r-6*s))*t+3*s)*t,Exe=1e-7,Txe=12;function Pxe(t,s,r,a,i){let l,o,c=0;do o=s+(r-s)/2,l=qV(o,a,i)-t,l>0?r=o:s=o;while(Math.abs(l)>Exe&&++c<Txe);return o}function iy(t,s,r,a){if(t===s&&r===a)return ko;const i=l=>Pxe(l,0,1,t,r);return l=>l===0||l===1?l:qV(i(l),s,a)}const GV=t=>s=>s<=.5?t(2*s)/2:(2-t(2*(1-s)))/2,KV=t=>s=>1-t(1-s),YV=iy(.33,1.53,.69,.99),lT=KV(YV),XV=GV(lT),QV=t=>(t*=2)<1?.5*lT(t):.5*(2-Math.pow(2,-10*(t-1))),oT=t=>1-Math.sin(Math.acos(t)),ZV=KV(oT),JV=GV(oT),Dxe=iy(.42,0,1,1),Mxe=iy(0,0,.58,1),eH=iy(.42,0,.58,1),Ixe=t=>Array.isArray(t)&&typeof t[0]!="number",tH=t=>Array.isArray(t)&&typeof t[0]=="number",Oxe={linear:ko,easeIn:Dxe,easeInOut:eH,easeOut:Mxe,circIn:oT,circInOut:JV,circOut:ZV,backIn:lT,backInOut:XV,backOut:YV,anticipate:QV},Rxe=t=>typeof t=="string",hR=t=>{if(tH(t)){rT(t.length===4);const[s,r,a,i]=t;return iy(s,r,a,i)}else if(Rxe(t))return Oxe[t];return t},u1=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Lxe(t,s){let r=new Set,a=new Set,i=!1,l=!1;const o=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1};function d(m){o.has(m)&&(u.schedule(m),t()),m(c)}const u={schedule:(m,x=!1,g=!1)=>{const v=g&&i?r:a;return x&&o.add(m),v.has(m)||v.add(m),m},cancel:m=>{a.delete(m),o.delete(m)},process:m=>{if(c=m,i){l=!0;return}i=!0,[r,a]=[a,r],r.forEach(d),r.clear(),i=!1,l&&(l=!1,u.process(m))}};return u}const Fxe=40;function sH(t,s){let r=!1,a=!0;const i={delta:0,timestamp:0,isProcessing:!1},l=()=>r=!0,o=u1.reduce((k,A)=>(k[A]=Lxe(l),k),{}),{setup:c,read:d,resolveKeyframes:u,preUpdate:m,update:x,preRender:g,render:y,postRender:v}=o,j=()=>{const k=Kd.useManualTiming?i.timestamp:performance.now();r=!1,Kd.useManualTiming||(i.delta=a?1e3/60:Math.max(Math.min(k-i.timestamp,Fxe),1)),i.timestamp=k,i.isProcessing=!0,c.process(i),d.process(i),u.process(i),m.process(i),x.process(i),g.process(i),y.process(i),v.process(i),i.isProcessing=!1,r&&s&&(a=!1,t(j))},w=()=>{r=!0,a=!0,i.isProcessing||t(j)};return{schedule:u1.reduce((k,A)=>{const I=o[A];return k[A]=(P,O=!1,D=!1)=>(r||w(),I.schedule(P,O,D)),k},{}),cancel:k=>{for(let A=0;A<u1.length;A++)o[u1[A]].cancel(k)},state:i,steps:o}}const{schedule:Kn,cancel:hm,state:Ba,steps:mC}=sH(typeof requestAnimationFrame<"u"?requestAnimationFrame:ko,!0);let ij;function Bxe(){ij=void 0}const sl={now:()=>(ij===void 0&&sl.set(Ba.isProcessing||Kd.useManualTiming?Ba.timestamp:performance.now()),ij),set:t=>{ij=t,queueMicrotask(Bxe)}},nH=t=>s=>typeof s=="string"&&s.startsWith(t),cT=nH("--"),$xe=nH("var(--"),dT=t=>$xe(t)?zxe.test(t.split("/*")[0].trim()):!1,zxe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,_f={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},lb={..._f,transform:t=>Gd(0,1,t)},m1={..._f,default:1},wg=t=>Math.round(t*1e5)/1e5,uT=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Uxe(t){return t==null}const Vxe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,mT=(t,s)=>r=>!!(typeof r=="string"&&Vxe.test(r)&&r.startsWith(t)||s&&!Uxe(r)&&Object.prototype.hasOwnProperty.call(r,s)),rH=(t,s,r)=>a=>{if(typeof a!="string")return a;const[i,l,o,c]=a.match(uT);return{[t]:parseFloat(i),[s]:parseFloat(l),[r]:parseFloat(o),alpha:c!==void 0?parseFloat(c):1}},Hxe=t=>Gd(0,255,t),hC={..._f,transform:t=>Math.round(Hxe(t))},lh={test:mT("rgb","red"),parse:rH("red","green","blue"),transform:({red:t,green:s,blue:r,alpha:a=1})=>"rgba("+hC.transform(t)+", "+hC.transform(s)+", "+hC.transform(r)+", "+wg(lb.transform(a))+")"};function Wxe(t){let s="",r="",a="",i="";return t.length>5?(s=t.substring(1,3),r=t.substring(3,5),a=t.substring(5,7),i=t.substring(7,9)):(s=t.substring(1,2),r=t.substring(2,3),a=t.substring(3,4),i=t.substring(4,5),s+=s,r+=r,a+=a,i+=i),{red:parseInt(s,16),green:parseInt(r,16),blue:parseInt(a,16),alpha:i?parseInt(i,16)/255:1}}const L3={test:mT("#"),parse:Wxe,transform:lh.transform},ly=t=>({test:s=>typeof s=="string"&&s.endsWith(t)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${t}`}),Mu=ly("deg"),ed=ly("%"),xs=ly("px"),qxe=ly("vh"),Gxe=ly("vw"),xR={...ed,parse:t=>ed.parse(t)/100,transform:t=>ed.transform(t*100)},fp={test:mT("hsl","hue"),parse:rH("hue","saturation","lightness"),transform:({hue:t,saturation:s,lightness:r,alpha:a=1})=>"hsla("+Math.round(t)+", "+ed.transform(wg(s))+", "+ed.transform(wg(r))+", "+wg(lb.transform(a))+")"},Ur={test:t=>lh.test(t)||L3.test(t)||fp.test(t),parse:t=>lh.test(t)?lh.parse(t):fp.test(t)?fp.parse(t):L3.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?lh.transform(t):fp.transform(t),getAnimatableNone:t=>{const s=Ur.parse(t);return s.alpha=0,Ur.transform(s)}},Kxe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Yxe(t){var s,r;return isNaN(t)&&typeof t=="string"&&(((s=t.match(uT))==null?void 0:s.length)||0)+(((r=t.match(Kxe))==null?void 0:r.length)||0)>0}const aH="number",iH="color",Xxe="var",Qxe="var(",pR="${}",Zxe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ob(t){const s=t.toString(),r=[],a={color:[],number:[],var:[]},i=[];let l=0;const c=s.replace(Zxe,d=>(Ur.test(d)?(a.color.push(l),i.push(iH),r.push(Ur.parse(d))):d.startsWith(Qxe)?(a.var.push(l),i.push(Xxe),r.push(d)):(a.number.push(l),i.push(aH),r.push(parseFloat(d))),++l,pR)).split(pR);return{values:r,split:c,indexes:a,types:i}}function lH(t){return ob(t).values}function oH(t){const{split:s,types:r}=ob(t),a=s.length;return i=>{let l="";for(let o=0;o<a;o++)if(l+=s[o],i[o]!==void 0){const c=r[o];c===aH?l+=wg(i[o]):c===iH?l+=Ur.transform(i[o]):l+=i[o]}return l}}const Jxe=t=>typeof t=="number"?0:Ur.test(t)?Ur.getAnimatableNone(t):t;function epe(t){const s=lH(t);return oH(t)(s.map(Jxe))}const xm={test:Yxe,parse:lH,createTransformer:oH,getAnimatableNone:epe};function xC(t,s,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(s-t)*6*r:r<1/2?s:r<2/3?t+(s-t)*(2/3-r)*6:t}function tpe({hue:t,saturation:s,lightness:r,alpha:a}){t/=360,s/=100,r/=100;let i=0,l=0,o=0;if(!s)i=l=o=r;else{const c=r<.5?r*(1+s):r+s-r*s,d=2*r-c;i=xC(d,c,t+1/3),l=xC(d,c,t),o=xC(d,c,t-1/3)}return{red:Math.round(i*255),green:Math.round(l*255),blue:Math.round(o*255),alpha:a}}function aN(t,s){return r=>r>0?s:t}const nr=(t,s,r)=>t+(s-t)*r,pC=(t,s,r)=>{const a=t*t,i=r*(s*s-a)+a;return i<0?0:Math.sqrt(i)},spe=[L3,lh,fp],npe=t=>spe.find(s=>s.test(t));function fR(t){const s=npe(t);if(!s)return!1;let r=s.parse(t);return s===fp&&(r=tpe(r)),r}const gR=(t,s)=>{const r=fR(t),a=fR(s);if(!r||!a)return aN(t,s);const i={...r};return l=>(i.red=pC(r.red,a.red,l),i.green=pC(r.green,a.green,l),i.blue=pC(r.blue,a.blue,l),i.alpha=nr(r.alpha,a.alpha,l),lh.transform(i))},F3=new Set(["none","hidden"]);function rpe(t,s){return F3.has(t)?r=>r<=0?t:s:r=>r>=1?s:t}function ape(t,s){return r=>nr(t,s,r)}function hT(t){return typeof t=="number"?ape:typeof t=="string"?dT(t)?aN:Ur.test(t)?gR:ope:Array.isArray(t)?cH:typeof t=="object"?Ur.test(t)?gR:ipe:aN}function cH(t,s){const r=[...t],a=r.length,i=t.map((l,o)=>hT(l)(l,s[o]));return l=>{for(let o=0;o<a;o++)r[o]=i[o](l);return r}}function ipe(t,s){const r={...t,...s},a={};for(const i in r)t[i]!==void 0&&s[i]!==void 0&&(a[i]=hT(t[i])(t[i],s[i]));return i=>{for(const l in a)r[l]=a[l](i);return r}}function lpe(t,s){const r=[],a={color:0,var:0,number:0};for(let i=0;i<s.values.length;i++){const l=s.types[i],o=t.indexes[l][a[l]],c=t.values[o]??0;r[i]=c,a[l]++}return r}const ope=(t,s)=>{const r=xm.createTransformer(s),a=ob(t),i=ob(s);return a.indexes.var.length===i.indexes.var.length&&a.indexes.color.length===i.indexes.color.length&&a.indexes.number.length>=i.indexes.number.length?F3.has(t)&&!i.values.length||F3.has(s)&&!a.values.length?rpe(t,s):ay(cH(lpe(a,i),i.values),r):aN(t,s)};function dH(t,s,r){return typeof t=="number"&&typeof s=="number"&&typeof r=="number"?nr(t,s,r):hT(t)(t,s)}const cpe=t=>{const s=({timestamp:r})=>t(r);return{start:(r=!0)=>Kn.update(s,r),stop:()=>hm(s),now:()=>Ba.isProcessing?Ba.timestamp:sl.now()}},uH=(t,s,r=10)=>{let a="";const i=Math.max(Math.round(s/r),2);for(let l=0;l<i;l++)a+=Math.round(t(l/(i-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},iN=2e4;function xT(t){let s=0;const r=50;let a=t.next(s);for(;!a.done&&s<iN;)s+=r,a=t.next(s);return s>=iN?1/0:s}function dpe(t,s=100,r){const a=r({...t,keyframes:[0,s]}),i=Math.min(xT(a),iN);return{type:"keyframes",ease:l=>a.next(i*l).value/s,duration:No(i)}}const upe=5;function mH(t,s,r){const a=Math.max(s-upe,0);return WV(r-t(a),s-a)}const pr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},fC=.001;function mpe({duration:t=pr.duration,bounce:s=pr.bounce,velocity:r=pr.velocity,mass:a=pr.mass}){let i,l,o=1-s;o=Gd(pr.minDamping,pr.maxDamping,o),t=Gd(pr.minDuration,pr.maxDuration,No(t)),o<1?(i=u=>{const m=u*o,x=m*t,g=m-r,y=B3(u,o),v=Math.exp(-x);return fC-g/y*v},l=u=>{const x=u*o*t,g=x*r+r,y=Math.pow(o,2)*Math.pow(u,2)*t,v=Math.exp(-x),j=B3(Math.pow(u,2),o);return(-i(u)+fC>0?-1:1)*((g-y)*v)/j}):(i=u=>{const m=Math.exp(-u*t),x=(u-r)*t+1;return-fC+m*x},l=u=>{const m=Math.exp(-u*t),x=(r-u)*(t*t);return m*x});const c=5/t,d=xpe(i,l,c);if(t=Jc(t),isNaN(d))return{stiffness:pr.stiffness,damping:pr.damping,duration:t};{const u=Math.pow(d,2)*a;return{stiffness:u,damping:o*2*Math.sqrt(a*u),duration:t}}}const hpe=12;function xpe(t,s,r){let a=r;for(let i=1;i<hpe;i++)a=a-t(a)/s(a);return a}function B3(t,s){return t*Math.sqrt(1-s*s)}const ppe=["duration","bounce"],fpe=["stiffness","damping","mass"];function bR(t,s){return s.some(r=>t[r]!==void 0)}function gpe(t){let s={velocity:pr.velocity,stiffness:pr.stiffness,damping:pr.damping,mass:pr.mass,isResolvedFromDuration:!1,...t};if(!bR(t,fpe)&&bR(t,ppe))if(t.visualDuration){const r=t.visualDuration,a=2*Math.PI/(r*1.2),i=a*a,l=2*Gd(.05,1,1-(t.bounce||0))*Math.sqrt(i);s={...s,mass:pr.mass,stiffness:i,damping:l}}else{const r=mpe(t);s={...s,...r,mass:pr.mass},s.isResolvedFromDuration=!0}return s}function lN(t=pr.visualDuration,s=pr.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:s}:t;let{restSpeed:a,restDelta:i}=r;const l=r.keyframes[0],o=r.keyframes[r.keyframes.length-1],c={done:!1,value:l},{stiffness:d,damping:u,mass:m,duration:x,velocity:g,isResolvedFromDuration:y}=gpe({...r,velocity:-No(r.velocity||0)}),v=g||0,j=u/(2*Math.sqrt(d*m)),w=o-l,S=No(Math.sqrt(d/m)),E=Math.abs(w)<5;a||(a=E?pr.restSpeed.granular:pr.restSpeed.default),i||(i=E?pr.restDelta.granular:pr.restDelta.default);let k;if(j<1){const I=B3(S,j);k=P=>{const O=Math.exp(-j*S*P);return o-O*((v+j*S*w)/I*Math.sin(I*P)+w*Math.cos(I*P))}}else if(j===1)k=I=>o-Math.exp(-S*I)*(w+(v+S*w)*I);else{const I=S*Math.sqrt(j*j-1);k=P=>{const O=Math.exp(-j*S*P),D=Math.min(I*P,300);return o-O*((v+j*S*w)*Math.sinh(D)+I*w*Math.cosh(D))/I}}const A={calculatedDuration:y&&x||null,next:I=>{const P=k(I);if(y)c.done=I>=x;else{let O=I===0?v:0;j<1&&(O=I===0?Jc(v):mH(k,I,P));const D=Math.abs(O)<=a,T=Math.abs(o-P)<=i;c.done=D&&T}return c.value=c.done?o:P,c},toString:()=>{const I=Math.min(xT(A),iN),P=uH(O=>A.next(I*O).value,I,30);return I+"ms "+P},toTransition:()=>{}};return A}lN.applyToOptions=t=>{const s=dpe(t,100,lN);return t.ease=s.ease,t.duration=Jc(s.duration),t.type="keyframes",t};function $3({keyframes:t,velocity:s=0,power:r=.8,timeConstant:a=325,bounceDamping:i=10,bounceStiffness:l=500,modifyTarget:o,min:c,max:d,restDelta:u=.5,restSpeed:m}){const x=t[0],g={done:!1,value:x},y=D=>c!==void 0&&D<c||d!==void 0&&D>d,v=D=>c===void 0?d:d===void 0||Math.abs(c-D)<Math.abs(d-D)?c:d;let j=r*s;const w=x+j,S=o===void 0?w:o(w);S!==w&&(j=S-x);const E=D=>-j*Math.exp(-D/a),k=D=>S+E(D),A=D=>{const T=E(D),B=k(D);g.done=Math.abs(T)<=u,g.value=g.done?S:B};let I,P;const O=D=>{y(g.value)&&(I=D,P=lN({keyframes:[g.value,v(g.value)],velocity:mH(k,D,g.value),damping:i,stiffness:l,restDelta:u,restSpeed:m}))};return O(0),{calculatedDuration:null,next:D=>{let T=!1;return!P&&I===void 0&&(T=!0,A(D),O(D)),I!==void 0&&D>=I?P.next(D-I):(!T&&A(D),g)}}}function bpe(t,s,r){const a=[],i=r||Kd.mix||dH,l=t.length-1;for(let o=0;o<l;o++){let c=i(t[o],t[o+1]);if(s){const d=Array.isArray(s)?s[o]||ko:s;c=ay(d,c)}a.push(c)}return a}function ype(t,s,{clamp:r=!0,ease:a,mixer:i}={}){const l=t.length;if(rT(l===s.length),l===1)return()=>s[0];if(l===2&&s[0]===s[1])return()=>s[1];const o=t[0]===t[1];t[0]>t[l-1]&&(t=[...t].reverse(),s=[...s].reverse());const c=bpe(s,a,i),d=c.length,u=m=>{if(o&&m<t[0])return s[0];let x=0;if(d>1)for(;x<t.length-2&&!(m<t[x+1]);x++);const g=ib(t[x],t[x+1],m);return c[x](g)};return r?m=>u(Gd(t[0],t[l-1],m)):u}function vpe(t,s){const r=t[t.length-1];for(let a=1;a<=s;a++){const i=ib(0,s,a);t.push(nr(r,1,i))}}function jpe(t){const s=[0];return vpe(s,t.length-1),s}function Npe(t,s){return t.map(r=>r*s)}function wpe(t,s){return t.map(()=>s||eH).splice(0,t.length-1)}function _g({duration:t=300,keyframes:s,times:r,ease:a="easeInOut"}){const i=Ixe(a)?a.map(hR):hR(a),l={done:!1,value:s[0]},o=Npe(r&&r.length===s.length?r:jpe(s),t),c=ype(o,s,{ease:Array.isArray(i)?i:wpe(s,i)});return{calculatedDuration:t,next:d=>(l.value=c(d),l.done=d>=t,l)}}const _pe=t=>t!==null;function pT(t,{repeat:s,repeatType:r="loop"},a,i=1){const l=t.filter(_pe),c=i<0||s&&r!=="loop"&&s%2===1?0:l.length-1;return!c||a===void 0?l[c]:a}const Spe={decay:$3,inertia:$3,tween:_g,keyframes:_g,spring:lN};function hH(t){typeof t.type=="string"&&(t.type=Spe[t.type])}class fT{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,r){return this.finished.then(s,r)}}const Cpe=t=>t/100;class gT extends fT{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var a,i;const{motionValue:r}=this.options;r&&r.updatedAt!==sl.now()&&this.tick(sl.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(i=(a=this.options).onStop)==null||i.call(a))},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;hH(s);const{type:r=_g,repeat:a=0,repeatDelay:i=0,repeatType:l,velocity:o=0}=s;let{keyframes:c}=s;const d=r||_g;d!==_g&&typeof c[0]!="number"&&(this.mixKeyframes=ay(Cpe,dH(c[0],c[1])),c=[0,100]);const u=d({...s,keyframes:c});l==="mirror"&&(this.mirroredGenerator=d({...s,keyframes:[...c].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=xT(u));const{calculatedDuration:m}=u;this.calculatedDuration=m,this.resolvedDuration=m+i,this.totalDuration=this.resolvedDuration*(a+1)-i,this.generator=u}updateTime(s){const r=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(s,r=!1){const{generator:a,totalDuration:i,mixKeyframes:l,mirroredGenerator:o,resolvedDuration:c,calculatedDuration:d}=this;if(this.startTime===null)return a.next(0);const{delay:u=0,keyframes:m,repeat:x,repeatType:g,repeatDelay:y,type:v,onUpdate:j,finalKeyframe:w}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-i/this.speed,this.startTime)),r?this.currentTime=s:this.updateTime(s);const S=this.currentTime-u*(this.playbackSpeed>=0?1:-1),E=this.playbackSpeed>=0?S<0:S>i;this.currentTime=Math.max(S,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let k=this.currentTime,A=a;if(x){const D=Math.min(this.currentTime,i)/c;let T=Math.floor(D),B=D%1;!B&&D>=1&&(B=1),B===1&&T--,T=Math.min(T,x+1),!!(T%2)&&(g==="reverse"?(B=1-B,y&&(B-=y/c)):g==="mirror"&&(A=o)),k=Gd(0,1,B)*c}const I=E?{done:!1,value:m[0]}:A.next(k);l&&(I.value=l(I.value));let{done:P}=I;!E&&d!==null&&(P=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const O=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&P);return O&&v!==$3&&(I.value=pT(m,this.options,w,this.speed)),j&&j(I.value),O&&this.finish(),I}then(s,r){return this.finished.then(s,r)}get duration(){return No(this.calculatedDuration)}get iterationDuration(){const{delay:s=0}=this.options||{};return this.duration+No(s)}get time(){return No(this.currentTime)}set time(s){var r;s=Jc(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),(r=this.driver)==null||r.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(sl.now());const r=this.playbackSpeed!==s;this.playbackSpeed=s,r&&(this.time=No(this.currentTime))}play(){var i,l;if(this.isStopped)return;const{driver:s=cpe,startTime:r}=this.options;this.driver||(this.driver=s(o=>this.tick(o))),(l=(i=this.options).onPlay)==null||l.call(i);const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=r??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(sl.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var s,r;this.notifyFinished(),this.teardown(),this.state="finished",(r=(s=this.options).onComplete)==null||r.call(s)}cancel(){var s,r;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(r=(s=this.options).onCancel)==null||r.call(s)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){var r;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(r=this.driver)==null||r.stop(),s.observe(this)}}function kpe(t){for(let s=1;s<t.length;s++)t[s]??(t[s]=t[s-1])}const oh=t=>t*180/Math.PI,z3=t=>{const s=oh(Math.atan2(t[1],t[0]));return U3(s)},Ape={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:z3,rotateZ:z3,skewX:t=>oh(Math.atan(t[1])),skewY:t=>oh(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},U3=t=>(t=t%360,t<0&&(t+=360),t),yR=z3,vR=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),jR=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),Epe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:vR,scaleY:jR,scale:t=>(vR(t)+jR(t))/2,rotateX:t=>U3(oh(Math.atan2(t[6],t[5]))),rotateY:t=>U3(oh(Math.atan2(-t[2],t[0]))),rotateZ:yR,rotate:yR,skewX:t=>oh(Math.atan(t[4])),skewY:t=>oh(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function V3(t){return t.includes("scale")?1:0}function H3(t,s){if(!t||t==="none")return V3(s);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,i;if(r)a=Epe,i=r;else{const c=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=Ape,i=c}if(!i)return V3(s);const l=a[s],o=i[1].split(",").map(Ppe);return typeof l=="function"?l(o):o[l]}const Tpe=(t,s)=>{const{transform:r="none"}=getComputedStyle(t);return H3(r,s)};function Ppe(t){return parseFloat(t.trim())}const Sf=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Cf=new Set(Sf),NR=t=>t===_f||t===xs,Dpe=new Set(["x","y","z"]),Mpe=Sf.filter(t=>!Dpe.has(t));function Ipe(t){const s=[];return Mpe.forEach(r=>{const a=t.getValue(r);a!==void 0&&(s.push([r,a.get()]),a.set(r.startsWith("scale")?1:0))}),s}const wh={width:({x:t},{paddingLeft:s="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(s)-parseFloat(r),height:({y:t},{paddingTop:s="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(s)-parseFloat(r),top:(t,{top:s})=>parseFloat(s),left:(t,{left:s})=>parseFloat(s),bottom:({y:t},{top:s})=>parseFloat(s)+(t.max-t.min),right:({x:t},{left:s})=>parseFloat(s)+(t.max-t.min),x:(t,{transform:s})=>H3(s,"x"),y:(t,{transform:s})=>H3(s,"y")};wh.translateX=wh.x;wh.translateY=wh.y;const _h=new Set;let W3=!1,q3=!1,G3=!1;function xH(){if(q3){const t=Array.from(_h).filter(a=>a.needsMeasurement),s=new Set(t.map(a=>a.element)),r=new Map;s.forEach(a=>{const i=Ipe(a);i.length&&(r.set(a,i),a.render())}),t.forEach(a=>a.measureInitialState()),s.forEach(a=>{a.render();const i=r.get(a);i&&i.forEach(([l,o])=>{var c;(c=a.getValue(l))==null||c.set(o)})}),t.forEach(a=>a.measureEndState()),t.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}q3=!1,W3=!1,_h.forEach(t=>t.complete(G3)),_h.clear()}function pH(){_h.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(q3=!0)})}function Ope(){G3=!0,pH(),xH(),G3=!1}class bT{constructor(s,r,a,i,l,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=r,this.name=a,this.motionValue=i,this.element=l,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(_h.add(this),W3||(W3=!0,Kn.read(pH),Kn.resolveKeyframes(xH))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:r,element:a,motionValue:i}=this;if(s[0]===null){const l=i==null?void 0:i.get(),o=s[s.length-1];if(l!==void 0)s[0]=l;else if(a&&r){const c=a.readValue(r,o);c!=null&&(s[0]=c)}s[0]===void 0&&(s[0]=o),i&&l===void 0&&i.set(s[0])}kpe(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),_h.delete(this)}cancel(){this.state==="scheduled"&&(_h.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Rpe=t=>t.startsWith("--");function Lpe(t,s,r){Rpe(s)?t.style.setProperty(s,r):t.style[s]=r}const Fpe=aT(()=>window.ScrollTimeline!==void 0),Bpe={};function $pe(t,s){const r=aT(t);return()=>Bpe[s]??r()}const fH=$pe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),sg=([t,s,r,a])=>`cubic-bezier(${t}, ${s}, ${r}, ${a})`,wR={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:sg([0,.65,.55,1]),circOut:sg([.55,0,1,.45]),backIn:sg([.31,.01,.66,-.59]),backOut:sg([.33,1.53,.69,.99])};function gH(t,s){if(t)return typeof t=="function"?fH()?uH(t,s):"ease-out":tH(t)?sg(t):Array.isArray(t)?t.map(r=>gH(r,s)||wR.easeOut):wR[t]}function zpe(t,s,r,{delay:a=0,duration:i=300,repeat:l=0,repeatType:o="loop",ease:c="easeOut",times:d}={},u=void 0){const m={[s]:r};d&&(m.offset=d);const x=gH(c,i);Array.isArray(x)&&(m.easing=x);const g={delay:a,duration:i,easing:Array.isArray(x)?"linear":x,fill:"both",iterations:l+1,direction:o==="reverse"?"alternate":"normal"};return u&&(g.pseudoElement=u),t.animate(m,g)}function bH(t){return typeof t=="function"&&"applyToOptions"in t}function Upe({type:t,...s}){return bH(t)&&fH()?t.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class Vpe extends fT{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,!s)return;const{element:r,name:a,keyframes:i,pseudoElement:l,allowFlatten:o=!1,finalKeyframe:c,onComplete:d}=s;this.isPseudoElement=!!l,this.allowFlatten=o,this.options=s,rT(typeof s.type!="string");const u=Upe(s);this.animation=zpe(r,a,i,u,l),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!l){const m=pT(i,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(m):Lpe(r,a,m),this.animation.cancel()}d==null||d(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var s,r;(r=(s=this.animation).finish)==null||r.call(s)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var s,r;this.isPseudoElement||(r=(s=this.animation).commitStyles)==null||r.call(s)}get duration(){var r,a;const s=((a=(r=this.animation.effect)==null?void 0:r.getComputedTiming)==null?void 0:a.call(r).duration)||0;return No(Number(s))}get iterationDuration(){const{delay:s=0}=this.options||{};return this.duration+No(s)}get time(){return No(Number(this.animation.currentTime)||0)}set time(s){this.finishedTime=null,this.animation.currentTime=Jc(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(s){this.animation.startTime=s}attachTimeline({timeline:s,observe:r}){var a;return this.allowFlatten&&((a=this.animation.effect)==null||a.updateTiming({easing:"linear"})),this.animation.onfinish=null,s&&Fpe()?(this.animation.timeline=s,ko):r(this)}}const yH={anticipate:QV,backInOut:XV,circInOut:JV};function Hpe(t){return t in yH}function Wpe(t){typeof t.ease=="string"&&Hpe(t.ease)&&(t.ease=yH[t.ease])}const _R=10;class qpe extends Vpe{constructor(s){Wpe(s),hH(s),super(s),s.startTime&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:r,onUpdate:a,onComplete:i,element:l,...o}=this.options;if(!r)return;if(s!==void 0){r.set(s);return}const c=new gT({...o,autoplay:!1}),d=Jc(this.finishedTime??this.time);r.setWithVelocity(c.sample(d-_R).value,c.sample(d).value,_R),c.stop()}}const SR=(t,s)=>s==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(xm.test(t)||t==="0")&&!t.startsWith("url("));function Gpe(t){const s=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==s)return!0}function Kpe(t,s,r,a){const i=t[0];if(i===null)return!1;if(s==="display"||s==="visibility")return!0;const l=t[t.length-1],o=SR(i,s),c=SR(l,s);return!o||!c?!1:Gpe(t)||(r==="spring"||bH(r))&&a}function K3(t){t.duration=0,t.type="keyframes"}const Ype=new Set(["opacity","clipPath","filter","transform"]),Xpe=aT(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Qpe(t){var m;const{motionValue:s,name:r,repeatDelay:a,repeatType:i,damping:l,type:o}=t;if(!(((m=s==null?void 0:s.owner)==null?void 0:m.current)instanceof HTMLElement))return!1;const{onUpdate:d,transformTemplate:u}=s.owner.getProps();return Xpe()&&r&&Ype.has(r)&&(r!=="transform"||!u)&&!d&&!a&&i!=="mirror"&&l!==0&&o!=="inertia"}const Zpe=40;class Jpe extends fT{constructor({autoplay:s=!0,delay:r=0,type:a="keyframes",repeat:i=0,repeatDelay:l=0,repeatType:o="loop",keyframes:c,name:d,motionValue:u,element:m,...x}){var v;super(),this.stop=()=>{var j,w;this._animation&&(this._animation.stop(),(j=this.stopTimeline)==null||j.call(this)),(w=this.keyframeResolver)==null||w.cancel()},this.createdAt=sl.now();const g={autoplay:s,delay:r,type:a,repeat:i,repeatDelay:l,repeatType:o,name:d,motionValue:u,element:m,...x},y=(m==null?void 0:m.KeyframeResolver)||bT;this.keyframeResolver=new y(c,(j,w,S)=>this.onKeyframesResolved(j,w,g,!S),d,u,m),(v=this.keyframeResolver)==null||v.scheduleResolve()}onKeyframesResolved(s,r,a,i){this.keyframeResolver=void 0;const{name:l,type:o,velocity:c,delay:d,isHandoff:u,onUpdate:m}=a;this.resolvedAt=sl.now(),Kpe(s,l,o,c)||((Kd.instantAnimations||!d)&&(m==null||m(pT(s,a,r))),s[0]=s[s.length-1],K3(a),a.repeat=0);const g={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>Zpe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...a,keyframes:s},y=!u&&Qpe(g)?new qpe({...g,element:g.motionValue.owner.current}):new gT(g);y.finished.then(()=>this.notifyFinished()).catch(ko),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(s,r){return this.finished.finally(s).then(()=>{})}get animation(){var s;return this._animation||((s=this.keyframeResolver)==null||s.resume(),Ope()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var s;this._animation&&this.animation.cancel(),(s=this.keyframeResolver)==null||s.cancel()}}const efe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function tfe(t){const s=efe.exec(t);if(!s)return[,];const[,r,a,i]=s;return[`--${r??a}`,i]}function vH(t,s,r=1){const[a,i]=tfe(t);if(!a)return;const l=window.getComputedStyle(s).getPropertyValue(a);if(l){const o=l.trim();return UV(o)?parseFloat(o):o}return dT(i)?vH(i,s,r+1):i}function yT(t,s){return(t==null?void 0:t[s])??(t==null?void 0:t.default)??t}const jH=new Set(["width","height","top","left","right","bottom",...Sf]),sfe={test:t=>t==="auto",parse:t=>t},NH=t=>s=>s.test(t),wH=[_f,xs,ed,Mu,Gxe,qxe,sfe],CR=t=>wH.find(NH(t));function nfe(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||HV(t):!0}const rfe=new Set(["brightness","contrast","saturate","opacity"]);function afe(t){const[s,r]=t.slice(0,-1).split("(");if(s==="drop-shadow")return t;const[a]=r.match(uT)||[];if(!a)return t;const i=r.replace(a,"");let l=rfe.has(s)?1:0;return a!==r&&(l*=100),s+"("+l+i+")"}const ife=/\b([a-z-]*)\(.*?\)/gu,Y3={...xm,getAnimatableNone:t=>{const s=t.match(ife);return s?s.map(afe).join(" "):t}},kR={..._f,transform:Math.round},lfe={rotate:Mu,rotateX:Mu,rotateY:Mu,rotateZ:Mu,scale:m1,scaleX:m1,scaleY:m1,scaleZ:m1,skew:Mu,skewX:Mu,skewY:Mu,distance:xs,translateX:xs,translateY:xs,translateZ:xs,x:xs,y:xs,z:xs,perspective:xs,transformPerspective:xs,opacity:lb,originX:xR,originY:xR,originZ:xs},vT={borderWidth:xs,borderTopWidth:xs,borderRightWidth:xs,borderBottomWidth:xs,borderLeftWidth:xs,borderRadius:xs,radius:xs,borderTopLeftRadius:xs,borderTopRightRadius:xs,borderBottomRightRadius:xs,borderBottomLeftRadius:xs,width:xs,maxWidth:xs,height:xs,maxHeight:xs,top:xs,right:xs,bottom:xs,left:xs,padding:xs,paddingTop:xs,paddingRight:xs,paddingBottom:xs,paddingLeft:xs,margin:xs,marginTop:xs,marginRight:xs,marginBottom:xs,marginLeft:xs,backgroundPositionX:xs,backgroundPositionY:xs,...lfe,zIndex:kR,fillOpacity:lb,strokeOpacity:lb,numOctaves:kR},ofe={...vT,color:Ur,backgroundColor:Ur,outlineColor:Ur,fill:Ur,stroke:Ur,borderColor:Ur,borderTopColor:Ur,borderRightColor:Ur,borderBottomColor:Ur,borderLeftColor:Ur,filter:Y3,WebkitFilter:Y3},_H=t=>ofe[t];function SH(t,s){let r=_H(t);return r!==Y3&&(r=xm),r.getAnimatableNone?r.getAnimatableNone(s):void 0}const cfe=new Set(["auto","none","0"]);function dfe(t,s,r){let a=0,i;for(;a<t.length&&!i;){const l=t[a];typeof l=="string"&&!cfe.has(l)&&ob(l).values.length&&(i=t[a]),a++}if(i&&r)for(const l of s)t[l]=SH(r,i)}class ufe extends bT{constructor(s,r,a,i,l){super(s,r,a,i,l,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:r,name:a}=this;if(!r||!r.current)return;super.readKeyframes();for(let d=0;d<s.length;d++){let u=s[d];if(typeof u=="string"&&(u=u.trim(),dT(u))){const m=vH(u,r.current);m!==void 0&&(s[d]=m),d===s.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!jH.has(a)||s.length!==2)return;const[i,l]=s,o=CR(i),c=CR(l);if(o!==c)if(NR(o)&&NR(c))for(let d=0;d<s.length;d++){const u=s[d];typeof u=="string"&&(s[d]=parseFloat(u))}else wh[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:r}=this,a=[];for(let i=0;i<s.length;i++)(s[i]===null||nfe(s[i]))&&a.push(i);a.length&&dfe(s,a,r)}measureInitialState(){const{element:s,unresolvedKeyframes:r,name:a}=this;if(!s||!s.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=wh[a](s.measureViewportBox(),window.getComputedStyle(s.current)),r[0]=this.measuredOrigin;const i=r[r.length-1];i!==void 0&&s.getValue(a,i).jump(i,!1)}measureEndState(){var c;const{element:s,name:r,unresolvedKeyframes:a}=this;if(!s||!s.current)return;const i=s.getValue(r);i&&i.jump(this.measuredOrigin,!1);const l=a.length-1,o=a[l];a[l]=wh[r](s.measureViewportBox(),window.getComputedStyle(s.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(c=this.removedTransforms)!=null&&c.length&&this.removedTransforms.forEach(([d,u])=>{s.getValue(d).set(u)}),this.resolveNoneKeyframes()}}function mfe(t,s,r){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let a=document;const i=(r==null?void 0:r[t])??a.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}const CH=(t,s)=>s&&typeof t=="number"?s.transform(t):t;function kH(t){return VV(t)&&"offsetHeight"in t}const AR=30,hfe=t=>!isNaN(parseFloat(t));class xfe{constructor(s,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{var l;const i=sl.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&((l=this.events.change)==null||l.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=r.owner}setCurrent(s){this.current=s,this.updatedAt=sl.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=hfe(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,r){this.events[s]||(this.events[s]=new iT);const a=this.events[s].add(r);return s==="change"?()=>{a(),Kn.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,r){this.passiveEffect=s,this.stopPassiveEffect=r}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,r,a){this.set(r),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-a}jump(s,r=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var s;(s=this.events.change)==null||s.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=sl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>AR)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,AR);return WV(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(s){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=s(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var s,r;(s=this.dependents)==null||s.clear(),(r=this.events.destroy)==null||r.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Zp(t,s){return new xfe(t,s)}const{schedule:jT}=sH(queueMicrotask,!1),Go={x:!1,y:!1};function AH(){return Go.x||Go.y}function pfe(t){return t==="x"||t==="y"?Go[t]?null:(Go[t]=!0,()=>{Go[t]=!1}):Go.x||Go.y?null:(Go.x=Go.y=!0,()=>{Go.x=Go.y=!1})}function EH(t,s){const r=mfe(t),a=new AbortController,i={passive:!0,...s,signal:a.signal};return[r,i,()=>a.abort()]}function ER(t){return!(t.pointerType==="touch"||AH())}function ffe(t,s,r={}){const[a,i,l]=EH(t,r),o=c=>{if(!ER(c))return;const{target:d}=c,u=s(d,c);if(typeof u!="function"||!d)return;const m=x=>{ER(x)&&(u(x),d.removeEventListener("pointerleave",m))};d.addEventListener("pointerleave",m,i)};return a.forEach(c=>{c.addEventListener("pointerenter",o,i)}),l}const TH=(t,s)=>s?t===s?!0:TH(t,s.parentElement):!1,NT=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,gfe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function bfe(t){return gfe.has(t.tagName)||t.tabIndex!==-1}const lj=new WeakSet;function TR(t){return s=>{s.key==="Enter"&&t(s)}}function gC(t,s){t.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const yfe=(t,s)=>{const r=t.currentTarget;if(!r)return;const a=TR(()=>{if(lj.has(r))return;gC(r,"down");const i=TR(()=>{gC(r,"up")}),l=()=>gC(r,"cancel");r.addEventListener("keyup",i,s),r.addEventListener("blur",l,s)});r.addEventListener("keydown",a,s),r.addEventListener("blur",()=>r.removeEventListener("keydown",a),s)};function PR(t){return NT(t)&&!AH()}function vfe(t,s,r={}){const[a,i,l]=EH(t,r),o=c=>{const d=c.currentTarget;if(!PR(c))return;lj.add(d);const u=s(d,c),m=(y,v)=>{window.removeEventListener("pointerup",x),window.removeEventListener("pointercancel",g),lj.has(d)&&lj.delete(d),PR(y)&&typeof u=="function"&&u(y,{success:v})},x=y=>{m(y,d===window||d===document||r.useGlobalTarget||TH(d,y.target))},g=y=>{m(y,!1)};window.addEventListener("pointerup",x,i),window.addEventListener("pointercancel",g,i)};return a.forEach(c=>{(r.useGlobalTarget?window:c).addEventListener("pointerdown",o,i),kH(c)&&(c.addEventListener("focus",u=>yfe(u,i)),!bfe(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),l}function PH(t){return VV(t)&&"ownerSVGElement"in t}function jfe(t){return PH(t)&&t.tagName==="svg"}const ai=t=>!!(t&&t.getVelocity),Nfe=[...wH,Ur,xm],wfe=t=>Nfe.find(NH(t)),wT=p.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function DR(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function _fe(...t){return s=>{let r=!1;const a=t.map(i=>{const l=DR(i,s);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let i=0;i<a.length;i++){const l=a[i];typeof l=="function"?l():DR(t[i],null)}}}}function Sfe(...t){return p.useCallback(_fe(...t),t)}class Cfe extends p.Component{getSnapshotBeforeUpdate(s){const r=this.props.childRef.current;if(r&&s.isPresent&&!this.props.isPresent){const a=r.offsetParent,i=kH(a)&&a.offsetWidth||0,l=this.props.sizeRef.current;l.height=r.offsetHeight||0,l.width=r.offsetWidth||0,l.top=r.offsetTop,l.left=r.offsetLeft,l.right=i-l.width-l.left}return null}componentDidUpdate(){}render(){return this.props.children}}function kfe({children:t,isPresent:s,anchorX:r,root:a}){const i=p.useId(),l=p.useRef(null),o=p.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=p.useContext(wT),d=Sfe(l,t==null?void 0:t.ref);return p.useInsertionEffect(()=>{const{width:u,height:m,top:x,left:g,right:y}=o.current;if(s||!l.current||!u||!m)return;const v=r==="left"?`left: ${g}`:`right: ${y}`;l.current.dataset.motionPopId=i;const j=document.createElement("style");c&&(j.nonce=c);const w=a??document.head;return w.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${m}px !important;
            ${v}px !important;
            top: ${x}px !important;
          }
        `),()=>{w.contains(j)&&w.removeChild(j)}},[s]),n.jsx(Cfe,{isPresent:s,childRef:l,sizeRef:o,children:p.cloneElement(t,{ref:d})})}const Afe=({children:t,initial:s,isPresent:r,onExitComplete:a,custom:i,presenceAffectsLayout:l,mode:o,anchorX:c,root:d})=>{const u=eT(Efe),m=p.useId();let x=!0,g=p.useMemo(()=>(x=!1,{id:m,initial:s,isPresent:r,custom:i,onExitComplete:y=>{u.set(y,!0);for(const v of u.values())if(!v)return;a&&a()},register:y=>(u.set(y,!1),()=>u.delete(y))}),[r,u,a]);return l&&x&&(g={...g}),p.useMemo(()=>{u.forEach((y,v)=>u.set(v,!1))},[r]),p.useEffect(()=>{!r&&!u.size&&a&&a()},[r]),o==="popLayout"&&(t=n.jsx(kfe,{isPresent:r,anchorX:c,root:d,children:t})),n.jsx(o2.Provider,{value:g,children:t})};function Efe(){return new Map}function DH(t=!0){const s=p.useContext(o2);if(s===null)return[!0,null];const{isPresent:r,onExitComplete:a,register:i}=s,l=p.useId();p.useEffect(()=>{if(t)return i(l)},[t]);const o=p.useCallback(()=>t&&a&&a(l),[l,a,t]);return!r&&a?[!1,o]:[!0]}const h1=t=>t.key||"";function MR(t){const s=[];return p.Children.forEach(t,r=>{p.isValidElement(r)&&s.push(r)}),s}const on=({children:t,custom:s,initial:r=!0,onExitComplete:a,presenceAffectsLayout:i=!0,mode:l="sync",propagate:o=!1,anchorX:c="left",root:d})=>{const[u,m]=DH(o),x=p.useMemo(()=>MR(t),[t]),g=o&&!u?[]:x.map(h1),y=p.useRef(!0),v=p.useRef(x),j=eT(()=>new Map),[w,S]=p.useState(x),[E,k]=p.useState(x);zV(()=>{y.current=!1,v.current=x;for(let P=0;P<E.length;P++){const O=h1(E[P]);g.includes(O)?j.delete(O):j.get(O)!==!0&&j.set(O,!1)}},[E,g.length,g.join("-")]);const A=[];if(x!==w){let P=[...x];for(let O=0;O<E.length;O++){const D=E[O],T=h1(D);g.includes(T)||(P.splice(O,0,D),A.push(D))}return l==="wait"&&A.length&&(P=A),k(MR(P)),S(x),null}const{forceRender:I}=p.useContext(JE);return n.jsx(n.Fragment,{children:E.map(P=>{const O=h1(P),D=o&&!u?!1:x===E||g.includes(O),T=()=>{if(j.has(O))j.set(O,!0);else return;let B=!0;j.forEach(U=>{U||(B=!1)}),B&&(I==null||I(),k(v.current),o&&(m==null||m()),a&&a())};return n.jsx(Afe,{isPresent:D,initial:!y.current||r?void 0:!1,custom:s,presenceAffectsLayout:i,mode:l,root:d,onExitComplete:D?void 0:T,anchorX:c,children:P},O)})})},MH=p.createContext({strict:!1}),IR={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Jp={};for(const t in IR)Jp[t]={isEnabled:s=>IR[t].some(r=>!!s[r])};function Tfe(t){for(const s in t)Jp[s]={...Jp[s],...t[s]}}const Pfe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function oN(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Pfe.has(t)}let IH=t=>!oN(t);function Dfe(t){typeof t=="function"&&(IH=s=>s.startsWith("on")?!oN(s):t(s))}try{Dfe(require("@emotion/is-prop-valid").default)}catch{}function Mfe(t,s,r){const a={};for(const i in t)i==="values"&&typeof t.values=="object"||(IH(i)||r===!0&&oN(i)||!s&&!oN(i)||t.draggable&&i.startsWith("onDrag"))&&(a[i]=t[i]);return a}const c2=p.createContext({});function d2(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function cb(t){return typeof t=="string"||Array.isArray(t)}const _T=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ST=["initial",..._T];function u2(t){return d2(t.animate)||ST.some(s=>cb(t[s]))}function OH(t){return!!(u2(t)||t.variants)}function Ife(t,s){if(u2(t)){const{initial:r,animate:a}=t;return{initial:r===!1||cb(r)?r:void 0,animate:cb(a)?a:void 0}}return t.inherit!==!1?s:{}}function Ofe(t){const{initial:s,animate:r}=Ife(t,p.useContext(c2));return p.useMemo(()=>({initial:s,animate:r}),[OR(s),OR(r)])}function OR(t){return Array.isArray(t)?t.join(" "):t}const db={};function Rfe(t){for(const s in t)db[s]=t[s],cT(s)&&(db[s].isCSSVariable=!0)}function RH(t,{layout:s,layoutId:r}){return Cf.has(t)||t.startsWith("origin")||(s||r!==void 0)&&(!!db[t]||t==="opacity")}const Lfe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Ffe=Sf.length;function Bfe(t,s,r){let a="",i=!0;for(let l=0;l<Ffe;l++){const o=Sf[l],c=t[o];if(c===void 0)continue;let d=!0;if(typeof c=="number"?d=c===(o.startsWith("scale")?1:0):d=parseFloat(c)===0,!d||r){const u=CH(c,vT[o]);if(!d){i=!1;const m=Lfe[o]||o;a+=`${m}(${u}) `}r&&(s[o]=u)}}return a=a.trim(),r?a=r(s,i?"":a):i&&(a="none"),a}function CT(t,s,r){const{style:a,vars:i,transformOrigin:l}=t;let o=!1,c=!1;for(const d in s){const u=s[d];if(Cf.has(d)){o=!0;continue}else if(cT(d)){i[d]=u;continue}else{const m=CH(u,vT[d]);d.startsWith("origin")?(c=!0,l[d]=m):a[d]=m}}if(s.transform||(o||r?a.transform=Bfe(s,t.transform,r):a.transform&&(a.transform="none")),c){const{originX:d="50%",originY:u="50%",originZ:m=0}=l;a.transformOrigin=`${d} ${u} ${m}`}}const kT=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function LH(t,s,r){for(const a in s)!ai(s[a])&&!RH(a,r)&&(t[a]=s[a])}function $fe({transformTemplate:t},s){return p.useMemo(()=>{const r=kT();return CT(r,s,t),Object.assign({},r.vars,r.style)},[s])}function zfe(t,s){const r=t.style||{},a={};return LH(a,r,t),Object.assign(a,$fe(t,s)),a}function Ufe(t,s){const r={},a=zfe(t,s);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=a,r}const Vfe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Hfe={offset:"strokeDashoffset",array:"strokeDasharray"};function Wfe(t,s,r=1,a=0,i=!0){t.pathLength=1;const l=i?Vfe:Hfe;t[l.offset]=xs.transform(-a);const o=xs.transform(s),c=xs.transform(r);t[l.array]=`${o} ${c}`}function FH(t,{attrX:s,attrY:r,attrScale:a,pathLength:i,pathSpacing:l=1,pathOffset:o=0,...c},d,u,m){if(CT(t,c,u),d){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:x,style:g}=t;x.transform&&(g.transform=x.transform,delete x.transform),(g.transform||x.transformOrigin)&&(g.transformOrigin=x.transformOrigin??"50% 50%",delete x.transformOrigin),g.transform&&(g.transformBox=(m==null?void 0:m.transformBox)??"fill-box",delete x.transformBox),s!==void 0&&(x.x=s),r!==void 0&&(x.y=r),a!==void 0&&(x.scale=a),i!==void 0&&Wfe(x,i,l,o,!1)}const BH=()=>({...kT(),attrs:{}}),$H=t=>typeof t=="string"&&t.toLowerCase()==="svg";function qfe(t,s,r,a){const i=p.useMemo(()=>{const l=BH();return FH(l,s,$H(a),t.transformTemplate,t.style),{...l.attrs,style:{...l.style}}},[s]);if(t.style){const l={};LH(l,t.style,t),i.style={...l,...i.style}}return i}const Gfe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function AT(t){return typeof t!="string"||t.includes("-")?!1:!!(Gfe.indexOf(t)>-1||/[A-Z]/u.test(t))}function Kfe(t,s,r,{latestValues:a},i,l=!1){const c=(AT(t)?qfe:Ufe)(s,a,i,t),d=Mfe(s,typeof t=="string",l),u=t!==p.Fragment?{...d,...c,ref:r}:{},{children:m}=s,x=p.useMemo(()=>ai(m)?m.get():m,[m]);return p.createElement(t,{...u,children:x})}function RR(t){const s=[{},{}];return t==null||t.values.forEach((r,a)=>{s[0][a]=r.get(),s[1][a]=r.getVelocity()}),s}function ET(t,s,r,a){if(typeof s=="function"){const[i,l]=RR(a);s=s(r!==void 0?r:t.custom,i,l)}if(typeof s=="string"&&(s=t.variants&&t.variants[s]),typeof s=="function"){const[i,l]=RR(a);s=s(r!==void 0?r:t.custom,i,l)}return s}function oj(t){return ai(t)?t.get():t}function Yfe({scrapeMotionValuesFromProps:t,createRenderState:s},r,a,i){return{latestValues:Xfe(r,a,i,t),renderState:s()}}function Xfe(t,s,r,a){const i={},l=a(t,{});for(const g in l)i[g]=oj(l[g]);let{initial:o,animate:c}=t;const d=u2(t),u=OH(t);s&&u&&!d&&t.inherit!==!1&&(o===void 0&&(o=s.initial),c===void 0&&(c=s.animate));let m=r?r.initial===!1:!1;m=m||o===!1;const x=m?c:o;if(x&&typeof x!="boolean"&&!d2(x)){const g=Array.isArray(x)?x:[x];for(let y=0;y<g.length;y++){const v=ET(t,g[y]);if(v){const{transitionEnd:j,transition:w,...S}=v;for(const E in S){let k=S[E];if(Array.isArray(k)){const A=m?k.length-1:0;k=k[A]}k!==null&&(i[E]=k)}for(const E in j)i[E]=j[E]}}}return i}const zH=t=>(s,r)=>{const a=p.useContext(c2),i=p.useContext(o2),l=()=>Yfe(t,s,a,i);return r?l():eT(l)};function TT(t,s,r){var l;const{style:a}=t,i={};for(const o in a)(ai(a[o])||s.style&&ai(s.style[o])||RH(o,t)||((l=r==null?void 0:r.getValue(o))==null?void 0:l.liveStyle)!==void 0)&&(i[o]=a[o]);return i}const Qfe=zH({scrapeMotionValuesFromProps:TT,createRenderState:kT});function UH(t,s,r){const a=TT(t,s,r);for(const i in t)if(ai(t[i])||ai(s[i])){const l=Sf.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;a[l]=t[i]}return a}const Zfe=zH({scrapeMotionValuesFromProps:UH,createRenderState:BH}),Jfe=Symbol.for("motionComponentSymbol");function gp(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function e0e(t,s,r){return p.useCallback(a=>{a&&t.onMount&&t.onMount(a),s&&(a?s.mount(a):s.unmount()),r&&(typeof r=="function"?r(a):gp(r)&&(r.current=a))},[s])}const PT=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),t0e="framerAppearId",VH="data-"+PT(t0e),HH=p.createContext({});function s0e(t,s,r,a,i){var j,w;const{visualElement:l}=p.useContext(c2),o=p.useContext(MH),c=p.useContext(o2),d=p.useContext(wT).reducedMotion,u=p.useRef(null);a=a||o.renderer,!u.current&&a&&(u.current=a(t,{visualState:s,parent:l,props:r,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d}));const m=u.current,x=p.useContext(HH);m&&!m.projection&&i&&(m.type==="html"||m.type==="svg")&&n0e(u.current,r,i,x);const g=p.useRef(!1);p.useInsertionEffect(()=>{m&&g.current&&m.update(r,c)});const y=r[VH],v=p.useRef(!!y&&!((j=window.MotionHandoffIsComplete)!=null&&j.call(window,y))&&((w=window.MotionHasOptimisedAnimation)==null?void 0:w.call(window,y)));return zV(()=>{m&&(g.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),m.scheduleRenderMicrotask(),v.current&&m.animationState&&m.animationState.animateChanges())}),p.useEffect(()=>{m&&(!v.current&&m.animationState&&m.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var S;(S=window.MotionHandoffMarkAsComplete)==null||S.call(window,y)}),v.current=!1),m.enteringChildren=void 0)}),m}function n0e(t,s,r,a){const{layoutId:i,layout:l,drag:o,dragConstraints:c,layoutScroll:d,layoutRoot:u,layoutCrossfade:m}=s;t.projection=new r(t.latestValues,s["data-framer-portal-id"]?void 0:WH(t.parent)),t.projection.setOptions({layoutId:i,layout:l,alwaysMeasureLayout:!!o||c&&gp(c),visualElement:t,animationType:typeof l=="string"?l:"both",initialPromotionConfig:a,crossfade:m,layoutScroll:d,layoutRoot:u})}function WH(t){if(t)return t.options.allowProjection!==!1?t.projection:WH(t.parent)}function bC(t,{forwardMotionProps:s=!1}={},r,a){r&&Tfe(r);const i=AT(t)?Zfe:Qfe;function l(c,d){let u;const m={...p.useContext(wT),...c,layoutId:r0e(c)},{isStatic:x}=m,g=Ofe(c),y=i(c,x);if(!x&&tT){a0e();const v=i0e(m);u=v.MeasureLayout,g.visualElement=s0e(t,y,m,a,v.ProjectionNode)}return n.jsxs(c2.Provider,{value:g,children:[u&&g.visualElement?n.jsx(u,{visualElement:g.visualElement,...m}):null,Kfe(t,c,e0e(y,g.visualElement,d),y,x,s)]})}l.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const o=p.forwardRef(l);return o[Jfe]=t,o}function r0e({layoutId:t}){const s=p.useContext(JE).id;return s&&t!==void 0?s+"-"+t:t}function a0e(t,s){p.useContext(MH).strict}function i0e(t){const{drag:s,layout:r}=Jp;if(!s&&!r)return{};const a={...s,...r};return{MeasureLayout:s!=null&&s.isEnabled(t)||r!=null&&r.isEnabled(t)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function l0e(t,s){if(typeof Proxy>"u")return bC;const r=new Map,a=(l,o)=>bC(l,o,t,s),i=(l,o)=>a(l,o);return new Proxy(i,{get:(l,o)=>o==="create"?a:(r.has(o)||r.set(o,bC(o,void 0,t,s)),r.get(o))})}function qH({top:t,left:s,right:r,bottom:a}){return{x:{min:s,max:r},y:{min:t,max:a}}}function o0e({x:t,y:s}){return{top:s.min,right:t.max,bottom:s.max,left:t.min}}function c0e(t,s){if(!s)return t;const r=s({x:t.left,y:t.top}),a=s({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:a.y,right:a.x}}function yC(t){return t===void 0||t===1}function X3({scale:t,scaleX:s,scaleY:r}){return!yC(t)||!yC(s)||!yC(r)}function Xm(t){return X3(t)||GH(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function GH(t){return LR(t.x)||LR(t.y)}function LR(t){return t&&t!=="0%"}function cN(t,s,r){const a=t-r,i=s*a;return r+i}function FR(t,s,r,a,i){return i!==void 0&&(t=cN(t,i,a)),cN(t,r,a)+s}function Q3(t,s=0,r=1,a,i){t.min=FR(t.min,s,r,a,i),t.max=FR(t.max,s,r,a,i)}function KH(t,{x:s,y:r}){Q3(t.x,s.translate,s.scale,s.originPoint),Q3(t.y,r.translate,r.scale,r.originPoint)}const BR=.999999999999,$R=1.0000000000001;function d0e(t,s,r,a=!1){const i=r.length;if(!i)return;s.x=s.y=1;let l,o;for(let c=0;c<i;c++){l=r[c],o=l.projectionDelta;const{visualElement:d}=l.options;d&&d.props.style&&d.props.style.display==="contents"||(a&&l.options.layoutScroll&&l.scroll&&l!==l.root&&yp(t,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),o&&(s.x*=o.x.scale,s.y*=o.y.scale,KH(t,o)),a&&Xm(l.latestValues)&&yp(t,l.latestValues))}s.x<$R&&s.x>BR&&(s.x=1),s.y<$R&&s.y>BR&&(s.y=1)}function bp(t,s){t.min=t.min+s,t.max=t.max+s}function zR(t,s,r,a,i=.5){const l=nr(t.min,t.max,i);Q3(t,s,r,l,a)}function yp(t,s){zR(t.x,s.x,s.scaleX,s.scale,s.originX),zR(t.y,s.y,s.scaleY,s.scale,s.originY)}function YH(t,s){return qH(c0e(t.getBoundingClientRect(),s))}function u0e(t,s,r){const a=YH(t,r),{scroll:i}=s;return i&&(bp(a.x,i.offset.x),bp(a.y,i.offset.y)),a}const UR=()=>({translate:0,scale:1,origin:0,originPoint:0}),vp=()=>({x:UR(),y:UR()}),VR=()=>({min:0,max:0}),Cr=()=>({x:VR(),y:VR()}),Z3={current:null},XH={current:!1};function m0e(){if(XH.current=!0,!!tT)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),s=()=>Z3.current=t.matches;t.addEventListener("change",s),s()}else Z3.current=!1}const h0e=new WeakMap;function x0e(t,s,r){for(const a in s){const i=s[a],l=r[a];if(ai(i))t.addValue(a,i);else if(ai(l))t.addValue(a,Zp(i,{owner:t}));else if(l!==i)if(t.hasValue(a)){const o=t.getValue(a);o.liveStyle===!0?o.jump(i):o.hasAnimated||o.set(i)}else{const o=t.getStaticValue(a);t.addValue(a,Zp(o!==void 0?o:i,{owner:t}))}}for(const a in r)s[a]===void 0&&t.removeValue(a);return s}const HR=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class p0e{scrapeMotionValuesFromProps(s,r,a){return{}}constructor({parent:s,props:r,presenceContext:a,reducedMotionConfig:i,blockInitialAnimation:l,visualState:o},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=bT,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const g=sl.now();this.renderScheduledAt<g&&(this.renderScheduledAt=g,Kn.render(this.render,!1,!0))};const{latestValues:d,renderState:u}=o;this.latestValues=d,this.baseTarget={...d},this.initialValues=r.initial?{...d}:{},this.renderState=u,this.parent=s,this.props=r,this.presenceContext=a,this.depth=s?s.depth+1:0,this.reducedMotionConfig=i,this.options=c,this.blockInitialAnimation=!!l,this.isControllingVariants=u2(r),this.isVariantNode=OH(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:m,...x}=this.scrapeMotionValuesFromProps(r,{},this);for(const g in x){const y=x[g];d[g]!==void 0&&ai(y)&&y.set(d[g])}}mount(s){var r;this.current=s,h0e.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,i)=>this.bindToMotionValue(i,a)),XH.current||m0e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Z3.current,(r=this.parent)==null||r.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var s;this.projection&&this.projection.unmount(),hm(this.notifyUpdate),hm(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(s=this.parent)==null||s.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const a=this.features[r];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,r){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const a=Cf.has(s);a&&this.onBindTransform&&this.onBindTransform();const i=r.on("change",o=>{this.latestValues[s]=o,this.props.onUpdate&&Kn.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let l;window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,s,r)),this.valueSubscriptions.set(s,()=>{i(),l&&l(),r.owner&&r.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in Jp){const r=Jp[s];if(!r)continue;const{isEnabled:a,Feature:i}=r;if(!this.features[s]&&i&&a(this.props)&&(this.features[s]=new i(this)),this.features[s]){const l=this.features[s];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Cr()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,r){this.latestValues[s]=r}update(s,r){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let a=0;a<HR.length;a++){const i=HR[a];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const l="on"+i,o=s[l];o&&(this.propEventSubscriptions[i]=this.on(i,o))}this.prevMotionValues=x0e(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(s),()=>r.variantChildren.delete(s)}addValue(s,r){const a=this.values.get(s);r!==a&&(a&&this.removeValue(s),this.bindToMotionValue(s,r),this.values.set(s,r),this.latestValues[s]=r.get())}removeValue(s){this.values.delete(s);const r=this.valueSubscriptions.get(s);r&&(r(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,r){if(this.props.values&&this.props.values[s])return this.props.values[s];let a=this.values.get(s);return a===void 0&&r!==void 0&&(a=Zp(r===null?void 0:r,{owner:this}),this.addValue(s,a)),a}readValue(s,r){let a=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return a!=null&&(typeof a=="string"&&(UV(a)||HV(a))?a=parseFloat(a):!wfe(a)&&xm.test(r)&&(a=SH(s,r)),this.setBaseTarget(s,ai(a)?a.get():a)),ai(a)?a.get():a}setBaseTarget(s,r){this.baseTarget[s]=r}getBaseTarget(s){var l;const{initial:r}=this.props;let a;if(typeof r=="string"||typeof r=="object"){const o=ET(this.props,r,(l=this.presenceContext)==null?void 0:l.custom);o&&(a=o[s])}if(r&&a!==void 0)return a;const i=this.getBaseTargetFromProps(this.props,s);return i!==void 0&&!ai(i)?i:this.initialValues[s]!==void 0&&a===void 0?void 0:this.baseTarget[s]}on(s,r){return this.events[s]||(this.events[s]=new iT),this.events[s].add(r)}notify(s,...r){this.events[s]&&this.events[s].notify(...r)}scheduleRenderMicrotask(){jT.render(this.render)}}class QH extends p0e{constructor(){super(...arguments),this.KeyframeResolver=ufe}sortInstanceNodePosition(s,r){return s.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(s,r){return s.style?s.style[r]:void 0}removeValueFromRenderState(s,{vars:r,style:a}){delete r[s],delete a[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;ai(s)&&(this.childSubscription=s.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function ZH(t,{style:s,vars:r},a,i){const l=t.style;let o;for(o in s)l[o]=s[o];i==null||i.applyProjectionStyles(l,a);for(o in r)l.setProperty(o,r[o])}function f0e(t){return window.getComputedStyle(t)}class g0e extends QH{constructor(){super(...arguments),this.type="html",this.renderInstance=ZH}readValueFromInstance(s,r){var a;if(Cf.has(r))return(a=this.projection)!=null&&a.isProjecting?V3(r):Tpe(s,r);{const i=f0e(s),l=(cT(r)?i.getPropertyValue(r):i[r])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(s,{transformPagePoint:r}){return YH(s,r)}build(s,r,a){CT(s,r,a.transformTemplate)}scrapeMotionValuesFromProps(s,r,a){return TT(s,r,a)}}const JH=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function b0e(t,s,r,a){ZH(t,s,void 0,a);for(const i in s.attrs)t.setAttribute(JH.has(i)?i:PT(i),s.attrs[i])}class y0e extends QH{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Cr}getBaseTargetFromProps(s,r){return s[r]}readValueFromInstance(s,r){if(Cf.has(r)){const a=_H(r);return a&&a.default||0}return r=JH.has(r)?r:PT(r),s.getAttribute(r)}scrapeMotionValuesFromProps(s,r,a){return UH(s,r,a)}build(s,r,a){FH(s,r,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(s,r,a,i){b0e(s,r,a,i)}mount(s){this.isSVGTag=$H(s.tagName),super.mount(s)}}const v0e=(t,s)=>AT(t)?new y0e(s):new g0e(s,{allowProjection:t!==p.Fragment});function Ip(t,s,r){const a=t.getProps();return ET(a,s,r!==void 0?r:a.custom,t)}const J3=t=>Array.isArray(t);function j0e(t,s,r){t.hasValue(s)?t.getValue(s).set(r):t.addValue(s,Zp(r))}function N0e(t){return J3(t)?t[t.length-1]||0:t}function w0e(t,s){const r=Ip(t,s);let{transitionEnd:a={},transition:i={},...l}=r||{};l={...l,...a};for(const o in l){const c=N0e(l[o]);j0e(t,o,c)}}function _0e(t){return!!(ai(t)&&t.add)}function e4(t,s){const r=t.getValue("willChange");if(_0e(r))return r.add(s);if(!r&&Kd.WillChange){const a=new Kd.WillChange("auto");t.addValue("willChange",a),a.add(s)}}function eW(t){return t.props[VH]}const S0e=t=>t!==null;function C0e(t,{repeat:s,repeatType:r="loop"},a){const i=t.filter(S0e),l=s&&r!=="loop"&&s%2===1?0:i.length-1;return i[l]}const k0e={type:"spring",stiffness:500,damping:25,restSpeed:10},A0e=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),E0e={type:"keyframes",duration:.8},T0e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},P0e=(t,{keyframes:s})=>s.length>2?E0e:Cf.has(t)?t.startsWith("scale")?A0e(s[1]):k0e:T0e;function D0e({when:t,delay:s,delayChildren:r,staggerChildren:a,staggerDirection:i,repeat:l,repeatType:o,repeatDelay:c,from:d,elapsed:u,...m}){return!!Object.keys(m).length}const DT=(t,s,r,a={},i,l)=>o=>{const c=yT(a,t)||{},d=c.delay||a.delay||0;let{elapsed:u=0}=a;u=u-Jc(d);const m={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:s.getVelocity(),...c,delay:-u,onUpdate:g=>{s.set(g),c.onUpdate&&c.onUpdate(g)},onComplete:()=>{o(),c.onComplete&&c.onComplete()},name:t,motionValue:s,element:l?void 0:i};D0e(c)||Object.assign(m,P0e(t,m)),m.duration&&(m.duration=Jc(m.duration)),m.repeatDelay&&(m.repeatDelay=Jc(m.repeatDelay)),m.from!==void 0&&(m.keyframes[0]=m.from);let x=!1;if((m.type===!1||m.duration===0&&!m.repeatDelay)&&(K3(m),m.delay===0&&(x=!0)),(Kd.instantAnimations||Kd.skipAnimations)&&(x=!0,K3(m),m.delay=0),m.allowFlatten=!c.type&&!c.ease,x&&!l&&s.get()!==void 0){const g=C0e(m.keyframes,c);if(g!==void 0){Kn.update(()=>{m.onUpdate(g),m.onComplete()});return}}return c.isSync?new gT(m):new Jpe(m)};function M0e({protectedKeys:t,needsAnimating:s},r){const a=t.hasOwnProperty(r)&&s[r]!==!0;return s[r]=!1,a}function tW(t,s,{delay:r=0,transitionOverride:a,type:i}={}){let{transition:l=t.getDefaultTransition(),transitionEnd:o,...c}=s;a&&(l=a);const d=[],u=i&&t.animationState&&t.animationState.getState()[i];for(const m in c){const x=t.getValue(m,t.latestValues[m]??null),g=c[m];if(g===void 0||u&&M0e(u,m))continue;const y={delay:r,...yT(l||{},m)},v=x.get();if(v!==void 0&&!x.isAnimating&&!Array.isArray(g)&&g===v&&!y.velocity)continue;let j=!1;if(window.MotionHandoffAnimation){const S=eW(t);if(S){const E=window.MotionHandoffAnimation(S,m,Kn);E!==null&&(y.startTime=E,j=!0)}}e4(t,m),x.start(DT(m,x,g,t.shouldReduceMotion&&jH.has(m)?{type:!1}:y,t,j));const w=x.animation;w&&d.push(w)}return o&&Promise.all(d).then(()=>{Kn.update(()=>{o&&w0e(t,o)})}),d}function sW(t,s,r,a=0,i=1){const l=Array.from(t).sort((u,m)=>u.sortNodePosition(m)).indexOf(s),o=t.size,c=(o-1)*a;return typeof r=="function"?r(l,o):i===1?l*a:c-l*a}function t4(t,s,r={}){var d;const a=Ip(t,s,r.type==="exit"?(d=t.presenceContext)==null?void 0:d.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=a||{};r.transitionOverride&&(i=r.transitionOverride);const l=a?()=>Promise.all(tW(t,a,r)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:m=0,staggerChildren:x,staggerDirection:g}=i;return I0e(t,s,u,m,x,g,r)}:()=>Promise.resolve(),{when:c}=i;if(c){const[u,m]=c==="beforeChildren"?[l,o]:[o,l];return u().then(()=>m())}else return Promise.all([l(),o(r.delay)])}function I0e(t,s,r=0,a=0,i=0,l=1,o){const c=[];for(const d of t.variantChildren)d.notify("AnimationStart",s),c.push(t4(d,s,{...o,delay:r+(typeof a=="function"?0:a)+sW(t.variantChildren,d,a,i,l)}).then(()=>d.notify("AnimationComplete",s)));return Promise.all(c)}function O0e(t,s,r={}){t.notify("AnimationStart",s);let a;if(Array.isArray(s)){const i=s.map(l=>t4(t,l,r));a=Promise.all(i)}else if(typeof s=="string")a=t4(t,s,r);else{const i=typeof s=="function"?Ip(t,s,r.custom):s;a=Promise.all(tW(t,i,r))}return a.then(()=>{t.notify("AnimationComplete",s)})}function nW(t,s){if(!Array.isArray(s))return!1;const r=s.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(s[a]!==t[a])return!1;return!0}const R0e=ST.length;function rW(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?rW(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const s={};for(let r=0;r<R0e;r++){const a=ST[r],i=t.props[a];(cb(i)||i===!1)&&(s[a]=i)}return s}const L0e=[..._T].reverse(),F0e=_T.length;function B0e(t){return s=>Promise.all(s.map(({animation:r,options:a})=>O0e(t,r,a)))}function $0e(t){let s=B0e(t),r=WR(),a=!0;const i=d=>(u,m)=>{var g;const x=Ip(t,m,d==="exit"?(g=t.presenceContext)==null?void 0:g.custom:void 0);if(x){const{transition:y,transitionEnd:v,...j}=x;u={...u,...j,...v}}return u};function l(d){s=d(t)}function o(d){const{props:u}=t,m=rW(t.parent)||{},x=[],g=new Set;let y={},v=1/0;for(let w=0;w<F0e;w++){const S=L0e[w],E=r[S],k=u[S]!==void 0?u[S]:m[S],A=cb(k),I=S===d?E.isActive:null;I===!1&&(v=w);let P=k===m[S]&&k!==u[S]&&A;if(P&&a&&t.manuallyAnimateOnMount&&(P=!1),E.protectedKeys={...y},!E.isActive&&I===null||!k&&!E.prevProp||d2(k)||typeof k=="boolean")continue;const O=z0e(E.prevProp,k);let D=O||S===d&&E.isActive&&!P&&A||w>v&&A,T=!1;const B=Array.isArray(k)?k:[k];let U=B.reduce(i(S),{});I===!1&&(U={});const{prevResolvedValues:W={}}=E,V={...W,...U},R=H=>{D=!0,g.has(H)&&(T=!0,g.delete(H)),E.needsAnimating[H]=!0;const $=t.getValue(H);$&&($.liveStyle=!1)};for(const H in V){const $=U[H],K=W[H];if(y.hasOwnProperty(H))continue;let le=!1;J3($)&&J3(K)?le=!nW($,K):le=$!==K,le?$!=null?R(H):g.add(H):$!==void 0&&g.has(H)?R(H):E.protectedKeys[H]=!0}E.prevProp=k,E.prevResolvedValues=U,E.isActive&&(y={...y,...U}),a&&t.blockInitialAnimation&&(D=!1);const F=P&&O;D&&(!F||T)&&x.push(...B.map(H=>{const $={type:S};if(typeof H=="string"&&a&&!F&&t.manuallyAnimateOnMount&&t.parent){const{parent:K}=t,le=Ip(K,H);if(K.enteringChildren&&le){const{delayChildren:se}=le.transition||{};$.delay=sW(K.enteringChildren,t,se)}}return{animation:H,options:$}}))}if(g.size){const w={};if(typeof u.initial!="boolean"){const S=Ip(t,Array.isArray(u.initial)?u.initial[0]:u.initial);S&&S.transition&&(w.transition=S.transition)}g.forEach(S=>{const E=t.getBaseTarget(S),k=t.getValue(S);k&&(k.liveStyle=!0),w[S]=E??null}),x.push({animation:w})}let j=!!x.length;return a&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(j=!1),a=!1,j?s(x):Promise.resolve()}function c(d,u){var x;if(r[d].isActive===u)return Promise.resolve();(x=t.variantChildren)==null||x.forEach(g=>{var y;return(y=g.animationState)==null?void 0:y.setActive(d,u)}),r[d].isActive=u;const m=o(d);for(const g in r)r[g].protectedKeys={};return m}return{animateChanges:o,setActive:c,setAnimateFunction:l,getState:()=>r,reset:()=>{r=WR()}}}function z0e(t,s){return typeof s=="string"?s!==t:Array.isArray(s)?!nW(s,t):!1}function $m(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function WR(){return{animate:$m(!0),whileInView:$m(),whileHover:$m(),whileTap:$m(),whileDrag:$m(),whileFocus:$m(),exit:$m()}}class km{constructor(s){this.isMounted=!1,this.node=s}update(){}}class U0e extends km{constructor(s){super(s),s.animationState||(s.animationState=$0e(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();d2(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:r}=this.node.prevProps||{};s!==r&&this.updateAnimationControlsSubscription()}unmount(){var s;this.node.animationState.reset(),(s=this.unmountControls)==null||s.call(this)}}let V0e=0;class H0e extends km{constructor(){super(...arguments),this.id=V0e++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:r}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===a)return;const i=this.node.animationState.setActive("exit",!s);r&&!s&&i.then(()=>{r(this.id)})}mount(){const{register:s,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const W0e={animation:{Feature:U0e},exit:{Feature:H0e}};function ub(t,s,r,a={passive:!0}){return t.addEventListener(s,r,a),()=>t.removeEventListener(s,r)}function oy(t){return{point:{x:t.pageX,y:t.pageY}}}const q0e=t=>s=>NT(s)&&t(s,oy(s));function Sg(t,s,r,a){return ub(t,s,q0e(r),a)}const aW=1e-4,G0e=1-aW,K0e=1+aW,iW=.01,Y0e=0-iW,X0e=0+iW;function ki(t){return t.max-t.min}function Q0e(t,s,r){return Math.abs(t-s)<=r}function qR(t,s,r,a=.5){t.origin=a,t.originPoint=nr(s.min,s.max,t.origin),t.scale=ki(r)/ki(s),t.translate=nr(r.min,r.max,t.origin)-t.originPoint,(t.scale>=G0e&&t.scale<=K0e||isNaN(t.scale))&&(t.scale=1),(t.translate>=Y0e&&t.translate<=X0e||isNaN(t.translate))&&(t.translate=0)}function Cg(t,s,r,a){qR(t.x,s.x,r.x,a?a.originX:void 0),qR(t.y,s.y,r.y,a?a.originY:void 0)}function GR(t,s,r){t.min=r.min+s.min,t.max=t.min+ki(s)}function Z0e(t,s,r){GR(t.x,s.x,r.x),GR(t.y,s.y,r.y)}function KR(t,s,r){t.min=s.min-r.min,t.max=t.min+ki(s)}function kg(t,s,r){KR(t.x,s.x,r.x),KR(t.y,s.y,r.y)}function mo(t){return[t("x"),t("y")]}const lW=({current:t})=>t?t.ownerDocument.defaultView:null,YR=(t,s)=>Math.abs(t-s);function J0e(t,s){const r=YR(t.x,s.x),a=YR(t.y,s.y);return Math.sqrt(r**2+a**2)}class oW{constructor(s,r,{transformPagePoint:a,contextWindow:i=window,dragSnapToOrigin:l=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=jC(this.lastMoveEventInfo,this.history),y=this.startEvent!==null,v=J0e(g.offset,{x:0,y:0})>=this.distanceThreshold;if(!y&&!v)return;const{point:j}=g,{timestamp:w}=Ba;this.history.push({...j,timestamp:w});const{onStart:S,onMove:E}=this.handlers;y||(S&&S(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),E&&E(this.lastMoveEvent,g)},this.handlePointerMove=(g,y)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=vC(y,this.transformPagePoint),Kn.update(this.updatePoint,!0)},this.handlePointerUp=(g,y)=>{this.end();const{onEnd:v,onSessionEnd:j,resumeAnimation:w}=this.handlers;if(this.dragSnapToOrigin&&w&&w(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=jC(g.type==="pointercancel"?this.lastMoveEventInfo:vC(y,this.transformPagePoint),this.history);this.startEvent&&v&&v(g,S),j&&j(g,S)},!NT(s))return;this.dragSnapToOrigin=l,this.handlers=r,this.transformPagePoint=a,this.distanceThreshold=o,this.contextWindow=i||window;const c=oy(s),d=vC(c,this.transformPagePoint),{point:u}=d,{timestamp:m}=Ba;this.history=[{...u,timestamp:m}];const{onSessionStart:x}=r;x&&x(s,jC(d,this.history)),this.removeListeners=ay(Sg(this.contextWindow,"pointermove",this.handlePointerMove),Sg(this.contextWindow,"pointerup",this.handlePointerUp),Sg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),hm(this.updatePoint)}}function vC(t,s){return s?{point:s(t.point)}:t}function XR(t,s){return{x:t.x-s.x,y:t.y-s.y}}function jC({point:t},s){return{point:t,delta:XR(t,cW(s)),offset:XR(t,ege(s)),velocity:tge(s,.1)}}function ege(t){return t[0]}function cW(t){return t[t.length-1]}function tge(t,s){if(t.length<2)return{x:0,y:0};let r=t.length-1,a=null;const i=cW(t);for(;r>=0&&(a=t[r],!(i.timestamp-a.timestamp>Jc(s)));)r--;if(!a)return{x:0,y:0};const l=No(i.timestamp-a.timestamp);if(l===0)return{x:0,y:0};const o={x:(i.x-a.x)/l,y:(i.y-a.y)/l};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function sge(t,{min:s,max:r},a){return s!==void 0&&t<s?t=a?nr(s,t,a.min):Math.max(t,s):r!==void 0&&t>r&&(t=a?nr(r,t,a.max):Math.min(t,r)),t}function QR(t,s,r){return{min:s!==void 0?t.min+s:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function nge(t,{top:s,left:r,bottom:a,right:i}){return{x:QR(t.x,r,i),y:QR(t.y,s,a)}}function ZR(t,s){let r=s.min-t.min,a=s.max-t.max;return s.max-s.min<t.max-t.min&&([r,a]=[a,r]),{min:r,max:a}}function rge(t,s){return{x:ZR(t.x,s.x),y:ZR(t.y,s.y)}}function age(t,s){let r=.5;const a=ki(t),i=ki(s);return i>a?r=ib(s.min,s.max-a,t.min):a>i&&(r=ib(t.min,t.max-i,s.min)),Gd(0,1,r)}function ige(t,s){const r={};return s.min!==void 0&&(r.min=s.min-t.min),s.max!==void 0&&(r.max=s.max-t.min),r}const s4=.35;function lge(t=s4){return t===!1?t=0:t===!0&&(t=s4),{x:JR(t,"left","right"),y:JR(t,"top","bottom")}}function JR(t,s,r){return{min:e6(t,s),max:e6(t,r)}}function e6(t,s){return typeof t=="number"?t:t[s]||0}const oge=new WeakMap;class cge{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Cr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:r=!1,distanceThreshold:a}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const l=x=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(oy(x).point)},o=(x,g)=>{const{drag:y,dragPropagation:v,onDragStart:j}=this.getProps();if(y&&!v&&(this.openDragLock&&this.openDragLock(),this.openDragLock=pfe(y),!this.openDragLock))return;this.latestPointerEvent=x,this.latestPanInfo=g,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),mo(S=>{let E=this.getAxisMotionValue(S).get()||0;if(ed.test(E)){const{projection:k}=this.visualElement;if(k&&k.layout){const A=k.layout.layoutBox[S];A&&(E=ki(A)*(parseFloat(E)/100))}}this.originPoint[S]=E}),j&&Kn.postRender(()=>j(x,g)),e4(this.visualElement,"transform");const{animationState:w}=this.visualElement;w&&w.setActive("whileDrag",!0)},c=(x,g)=>{this.latestPointerEvent=x,this.latestPanInfo=g;const{dragPropagation:y,dragDirectionLock:v,onDirectionLock:j,onDrag:w}=this.getProps();if(!y&&!this.openDragLock)return;const{offset:S}=g;if(v&&this.currentDirection===null){this.currentDirection=dge(S),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",g.point,S),this.updateAxis("y",g.point,S),this.visualElement.render(),w&&w(x,g)},d=(x,g)=>{this.latestPointerEvent=x,this.latestPanInfo=g,this.stop(x,g),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>mo(x=>{var g;return this.getAnimationState(x)==="paused"&&((g=this.getAxisMotionValue(x).animation)==null?void 0:g.play())}),{dragSnapToOrigin:m}=this.getProps();this.panSession=new oW(s,{onSessionStart:l,onStart:o,onMove:c,onSessionEnd:d,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:m,distanceThreshold:a,contextWindow:lW(this.visualElement)})}stop(s,r){const a=s||this.latestPointerEvent,i=r||this.latestPanInfo,l=this.isDragging;if(this.cancel(),!l||!i||!a)return;const{velocity:o}=i;this.startAnimation(o);const{onDragEnd:c}=this.getProps();c&&Kn.postRender(()=>c(a,i))}cancel(){this.isDragging=!1;const{projection:s,animationState:r}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(s,r,a){const{drag:i}=this.getProps();if(!a||!x1(s,i,this.currentDirection))return;const l=this.getAxisMotionValue(s);let o=this.originPoint[s]+a[s];this.constraints&&this.constraints[s]&&(o=sge(o,this.constraints[s],this.elastic[s])),l.set(o)}resolveConstraints(){var l;const{dragConstraints:s,dragElastic:r}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(l=this.visualElement.projection)==null?void 0:l.layout,i=this.constraints;s&&gp(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&a?this.constraints=nge(a.layoutBox,s):this.constraints=!1,this.elastic=lge(r),i!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&mo(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=ige(a.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:r}=this.getProps();if(!s||!gp(s))return!1;const a=s.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const l=u0e(a,i.root,this.visualElement.getTransformPagePoint());let o=rge(i.layout.layoutBox,l);if(r){const c=r(o0e(o));this.hasMutatedConstraints=!!c,c&&(o=qH(c))}return o}startAnimation(s){const{drag:r,dragMomentum:a,dragElastic:i,dragTransition:l,dragSnapToOrigin:o,onDragTransitionEnd:c}=this.getProps(),d=this.constraints||{},u=mo(m=>{if(!x1(m,r,this.currentDirection))return;let x=d&&d[m]||{};o&&(x={min:0,max:0});const g=i?200:1e6,y=i?40:1e7,v={type:"inertia",velocity:a?s[m]:0,bounceStiffness:g,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...l,...x};return this.startAxisValueAnimation(m,v)});return Promise.all(u).then(c)}startAxisValueAnimation(s,r){const a=this.getAxisMotionValue(s);return e4(this.visualElement,s),a.start(DT(s,a,0,r,this.visualElement,!1))}stopAnimation(){mo(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){mo(s=>{var r;return(r=this.getAxisMotionValue(s).animation)==null?void 0:r.pause()})}getAnimationState(s){var r;return(r=this.getAxisMotionValue(s).animation)==null?void 0:r.state}getAxisMotionValue(s){const r=`_drag${s.toUpperCase()}`,a=this.visualElement.getProps(),i=a[r];return i||this.visualElement.getValue(s,(a.initial?a.initial[s]:void 0)||0)}snapToCursor(s){mo(r=>{const{drag:a}=this.getProps();if(!x1(r,a,this.currentDirection))return;const{projection:i}=this.visualElement,l=this.getAxisMotionValue(r);if(i&&i.layout){const{min:o,max:c}=i.layout.layoutBox[r];l.set(s[r]-nr(o,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:r}=this.getProps(),{projection:a}=this.visualElement;if(!gp(r)||!a||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};mo(o=>{const c=this.getAxisMotionValue(o);if(c&&this.constraints!==!1){const d=c.get();i[o]=age({min:d,max:d},this.constraints[o])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),mo(o=>{if(!x1(o,s,null))return;const c=this.getAxisMotionValue(o),{min:d,max:u}=this.constraints[o];c.set(nr(d,u,i[o]))})}addListeners(){if(!this.visualElement.current)return;oge.set(this.visualElement,this);const s=this.visualElement.current,r=Sg(s,"pointerdown",d=>{const{drag:u,dragListener:m=!0}=this.getProps();u&&m&&this.start(d)}),a=()=>{const{dragConstraints:d}=this.getProps();gp(d)&&d.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,l=i.addEventListener("measure",a);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Kn.read(a);const o=ub(window,"resize",()=>this.scalePositionWithinConstraints()),c=i.addEventListener("didUpdate",({delta:d,hasLayoutChanged:u})=>{this.isDragging&&u&&(mo(m=>{const x=this.getAxisMotionValue(m);x&&(this.originPoint[m]+=d[m].translate,x.set(x.get()+d[m].translate))}),this.visualElement.render())});return()=>{o(),r(),l(),c&&c()}}getProps(){const s=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:a=!1,dragPropagation:i=!1,dragConstraints:l=!1,dragElastic:o=s4,dragMomentum:c=!0}=s;return{...s,drag:r,dragDirectionLock:a,dragPropagation:i,dragConstraints:l,dragElastic:o,dragMomentum:c}}}function x1(t,s,r){return(s===!0||s===t)&&(r===null||r===t)}function dge(t,s=10){let r=null;return Math.abs(t.y)>s?r="y":Math.abs(t.x)>s&&(r="x"),r}class uge extends km{constructor(s){super(s),this.removeGroupControls=ko,this.removeListeners=ko,this.controls=new cge(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ko}unmount(){this.removeGroupControls(),this.removeListeners()}}const t6=t=>(s,r)=>{t&&Kn.postRender(()=>t(s,r))};class mge extends km{constructor(){super(...arguments),this.removePointerDownListener=ko}onPointerDown(s){this.session=new oW(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:lW(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:r,onPan:a,onPanEnd:i}=this.node.getProps();return{onSessionStart:t6(s),onStart:t6(r),onMove:a,onEnd:(l,o)=>{delete this.session,i&&Kn.postRender(()=>i(l,o))}}}mount(){this.removePointerDownListener=Sg(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const cj={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function s6(t,s){return s.max===s.min?0:t/(s.max-s.min)*100}const p0={correct:(t,s)=>{if(!s.target)return t;if(typeof t=="string")if(xs.test(t))t=parseFloat(t);else return t;const r=s6(t,s.target.x),a=s6(t,s.target.y);return`${r}% ${a}%`}},hge={correct:(t,{treeScale:s,projectionDelta:r})=>{const a=t,i=xm.parse(t);if(i.length>5)return a;const l=xm.createTransformer(t),o=typeof i[0]!="number"?1:0,c=r.x.scale*s.x,d=r.y.scale*s.y;i[0+o]/=c,i[1+o]/=d;const u=nr(c,d,.5);return typeof i[2+o]=="number"&&(i[2+o]/=u),typeof i[3+o]=="number"&&(i[3+o]/=u),l(i)}};let NC=!1;class xge extends p.Component{componentDidMount(){const{visualElement:s,layoutGroup:r,switchLayoutGroup:a,layoutId:i}=this.props,{projection:l}=s;Rfe(pge),l&&(r.group&&r.group.add(l),a&&a.register&&i&&a.register(l),NC&&l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),cj.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:r,visualElement:a,drag:i,isPresent:l}=this.props,{projection:o}=a;return o&&(o.isPresent=l,NC=!0,i||s.layoutDependency!==r||r===void 0||s.isPresent!==l?o.willUpdate():this.safeToRemove(),s.isPresent!==l&&(l?o.promote():o.relegate()||Kn.postRender(()=>{const c=o.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),jT.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:r,switchLayoutGroup:a}=this.props,{projection:i}=s;NC=!0,i&&(i.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(i),a&&a.deregister&&a.deregister(i))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function dW(t){const[s,r]=DH(),a=p.useContext(JE);return n.jsx(xge,{...t,layoutGroup:a,switchLayoutGroup:p.useContext(HH),isPresent:s,safeToRemove:r})}const pge={borderRadius:{...p0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:p0,borderTopRightRadius:p0,borderBottomLeftRadius:p0,borderBottomRightRadius:p0,boxShadow:hge};function fge(t,s,r){const a=ai(t)?t:Zp(t);return a.start(DT("",a,s,r)),a.animation}const gge=(t,s)=>t.depth-s.depth;class bge{constructor(){this.children=[],this.isDirty=!1}add(s){sT(this.children,s),this.isDirty=!0}remove(s){nT(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(gge),this.isDirty=!1,this.children.forEach(s)}}function yge(t,s){const r=sl.now(),a=({timestamp:i})=>{const l=i-r;l>=s&&(hm(a),t(l-s))};return Kn.setup(a,!0),()=>hm(a)}const uW=["TopLeft","TopRight","BottomLeft","BottomRight"],vge=uW.length,n6=t=>typeof t=="string"?parseFloat(t):t,r6=t=>typeof t=="number"||xs.test(t);function jge(t,s,r,a,i,l){i?(t.opacity=nr(0,r.opacity??1,Nge(a)),t.opacityExit=nr(s.opacity??1,0,wge(a))):l&&(t.opacity=nr(s.opacity??1,r.opacity??1,a));for(let o=0;o<vge;o++){const c=`border${uW[o]}Radius`;let d=a6(s,c),u=a6(r,c);if(d===void 0&&u===void 0)continue;d||(d=0),u||(u=0),d===0||u===0||r6(d)===r6(u)?(t[c]=Math.max(nr(n6(d),n6(u),a),0),(ed.test(u)||ed.test(d))&&(t[c]+="%")):t[c]=u}(s.rotate||r.rotate)&&(t.rotate=nr(s.rotate||0,r.rotate||0,a))}function a6(t,s){return t[s]!==void 0?t[s]:t.borderRadius}const Nge=mW(0,.5,ZV),wge=mW(.5,.95,ko);function mW(t,s,r){return a=>a<t?0:a>s?1:r(ib(t,s,a))}function i6(t,s){t.min=s.min,t.max=s.max}function to(t,s){i6(t.x,s.x),i6(t.y,s.y)}function l6(t,s){t.translate=s.translate,t.scale=s.scale,t.originPoint=s.originPoint,t.origin=s.origin}function o6(t,s,r,a,i){return t-=s,t=cN(t,1/r,a),i!==void 0&&(t=cN(t,1/i,a)),t}function _ge(t,s=0,r=1,a=.5,i,l=t,o=t){if(ed.test(s)&&(s=parseFloat(s),s=nr(o.min,o.max,s/100)-o.min),typeof s!="number")return;let c=nr(l.min,l.max,a);t===l&&(c-=s),t.min=o6(t.min,s,r,c,i),t.max=o6(t.max,s,r,c,i)}function c6(t,s,[r,a,i],l,o){_ge(t,s[r],s[a],s[i],s.scale,l,o)}const Sge=["x","scaleX","originX"],Cge=["y","scaleY","originY"];function d6(t,s,r,a){c6(t.x,s,Sge,r?r.x:void 0,a?a.x:void 0),c6(t.y,s,Cge,r?r.y:void 0,a?a.y:void 0)}function u6(t){return t.translate===0&&t.scale===1}function hW(t){return u6(t.x)&&u6(t.y)}function m6(t,s){return t.min===s.min&&t.max===s.max}function kge(t,s){return m6(t.x,s.x)&&m6(t.y,s.y)}function h6(t,s){return Math.round(t.min)===Math.round(s.min)&&Math.round(t.max)===Math.round(s.max)}function xW(t,s){return h6(t.x,s.x)&&h6(t.y,s.y)}function x6(t){return ki(t.x)/ki(t.y)}function p6(t,s){return t.translate===s.translate&&t.scale===s.scale&&t.originPoint===s.originPoint}class Age{constructor(){this.members=[]}add(s){sT(this.members,s),s.scheduleRender()}remove(s){if(nT(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(s){const r=this.members.findIndex(i=>s===i);if(r===0)return!1;let a;for(let i=r;i>=0;i--){const l=this.members[i];if(l.isPresent!==!1){a=l;break}}return a?(this.promote(a),!0):!1}promote(s,r){const a=this.lead;if(s!==a&&(this.prevLead=a,this.lead=s,s.show(),a)){a.instance&&a.scheduleRender(),s.scheduleRender(),s.resumeFrom=a,r&&(s.resumeFrom.preserveOpacity=!0),a.snapshot&&(s.snapshot=a.snapshot,s.snapshot.latestValues=a.animationValues||a.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:i}=s.options;i===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:r,resumingFrom:a}=s;r.onExitComplete&&r.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Ege(t,s,r){let a="";const i=t.x.translate/s.x,l=t.y.translate/s.y,o=(r==null?void 0:r.z)||0;if((i||l||o)&&(a=`translate3d(${i}px, ${l}px, ${o}px) `),(s.x!==1||s.y!==1)&&(a+=`scale(${1/s.x}, ${1/s.y}) `),r){const{transformPerspective:u,rotate:m,rotateX:x,rotateY:g,skewX:y,skewY:v}=r;u&&(a=`perspective(${u}px) ${a}`),m&&(a+=`rotate(${m}deg) `),x&&(a+=`rotateX(${x}deg) `),g&&(a+=`rotateY(${g}deg) `),y&&(a+=`skewX(${y}deg) `),v&&(a+=`skewY(${v}deg) `)}const c=t.x.scale*s.x,d=t.y.scale*s.y;return(c!==1||d!==1)&&(a+=`scale(${c}, ${d})`),a||"none"}const wC=["","X","Y","Z"],Tge=1e3;let Pge=0;function _C(t,s,r,a){const{latestValues:i}=s;i[t]&&(r[t]=i[t],s.setStaticValue(t,0),a&&(a[t]=0))}function pW(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:s}=t.options;if(!s)return;const r=eW(s);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:i,layoutId:l}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",Kn,!(i||l))}const{parent:a}=t;a&&!a.hasCheckedOptimisedAppear&&pW(a)}function fW({attachResizeListener:t,defaultParent:s,measureScroll:r,checkIsScrollRoot:a,resetTransform:i}){return class{constructor(o={},c=s==null?void 0:s()){this.id=Pge++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Ige),this.nodes.forEach(Fge),this.nodes.forEach(Bge),this.nodes.forEach(Oge)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let d=0;d<this.path.length;d++)this.path[d].shouldResetTransform=!0;this.root===this&&(this.nodes=new bge)}addEventListener(o,c){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new iT),this.eventHandlers.get(o).add(c)}notifyListeners(o,...c){const d=this.eventHandlers.get(o);d&&d.notify(...c)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=PH(o)&&!jfe(o),this.instance=o;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(d||c)&&(this.isLayoutDirty=!0),t){let m,x=0;const g=()=>this.root.updateBlockedByResize=!1;Kn.read(()=>{x=window.innerWidth}),t(o,()=>{const y=window.innerWidth;y!==x&&(x=y,this.root.updateBlockedByResize=!0,m&&m(),m=yge(g,250),cj.hasAnimatedSinceResize&&(cj.hasAnimatedSinceResize=!1,this.nodes.forEach(b6)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:m,hasLayoutChanged:x,hasRelativeLayoutChanged:g,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||Hge,{onLayoutAnimationStart:j,onLayoutAnimationComplete:w}=u.getProps(),S=!this.targetLayout||!xW(this.targetLayout,y),E=!x&&g;if(this.options.layoutRoot||this.resumeFrom||E||x&&(S||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...yT(v,"layout"),onPlay:j,onComplete:w};(u.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(m,E)}else x||b6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),hm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach($ge),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&pW(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let m=0;m<this.path.length;m++){const x=this.path[m];x.shouldResetTransform=!0,x.updateScroll("snapshot"),x.options.layoutRoot&&x.willUpdate(!1)}const{layoutId:c,layout:d}=this.options;if(c===void 0&&!d)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(f6);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(g6);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Lge),this.nodes.forEach(Dge),this.nodes.forEach(Mge)):this.nodes.forEach(g6),this.clearAllSnapshots();const c=sl.now();Ba.delta=Gd(0,1e3/60,c-Ba.timestamp),Ba.timestamp=c,Ba.isProcessing=!0,mC.update.process(Ba),mC.preRender.process(Ba),mC.render.process(Ba),Ba.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,jT.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Rge),this.sharedNodes.forEach(zge)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Kn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Kn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ki(this.snapshot.measuredBox.x)&&!ki(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let d=0;d<this.path.length;d++)this.path[d].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Cr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(c=!1),c&&this.instance){const d=a(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:d,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:d}}}resetTransform(){if(!i)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!hW(this.projectionDelta),d=this.getTransformTemplate(),u=d?d(this.latestValues,""):void 0,m=u!==this.prevTransformTemplateValue;o&&this.instance&&(c||Xm(this.latestValues)||m)&&(i(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const c=this.measurePageBox();let d=this.removeElementScroll(c);return o&&(d=this.removeTransform(d)),Wge(d),{animationId:this.root.animationId,measuredBox:c,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return Cr();const c=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(qge))){const{scroll:m}=this.root;m&&(bp(c.x,m.offset.x),bp(c.y,m.offset.y))}return c}removeElementScroll(o){var d;const c=Cr();if(to(c,o),(d=this.scroll)!=null&&d.wasRoot)return c;for(let u=0;u<this.path.length;u++){const m=this.path[u],{scroll:x,options:g}=m;m!==this.root&&x&&g.layoutScroll&&(x.wasRoot&&to(c,o),bp(c.x,x.offset.x),bp(c.y,x.offset.y))}return c}applyTransform(o,c=!1){const d=Cr();to(d,o);for(let u=0;u<this.path.length;u++){const m=this.path[u];!c&&m.options.layoutScroll&&m.scroll&&m!==m.root&&yp(d,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),Xm(m.latestValues)&&yp(d,m.latestValues)}return Xm(this.latestValues)&&yp(d,this.latestValues),d}removeTransform(o){const c=Cr();to(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];if(!u.instance||!Xm(u.latestValues))continue;X3(u.latestValues)&&u.updateSnapshot();const m=Cr(),x=u.measurePageBox();to(m,x),d6(c,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,m)}return Xm(this.latestValues)&&d6(c,this.latestValues),c}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ba.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var g;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(o||d&&this.isSharedProjectionDirty||this.isProjectionDirty||(g=this.parent)!=null&&g.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:m,layoutId:x}=this.options;if(!(!this.layout||!(m||x))){if(this.resolvedRelativeTargetAt=Ba.timestamp,!this.targetDelta&&!this.relativeTarget){const y=this.getClosestProjectingParent();y&&y.layout&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cr(),this.relativeTargetOrigin=Cr(),kg(this.relativeTargetOrigin,this.layout.layoutBox,y.layout.layoutBox),to(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Cr(),this.targetWithTransforms=Cr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Z0e(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):to(this.target,this.layout.layoutBox),KH(this.target,this.targetDelta)):to(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const y=this.getClosestProjectingParent();y&&!!y.resumingFrom==!!this.resumingFrom&&!y.options.layoutScroll&&y.target&&this.animationProgress!==1?(this.relativeParent=y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cr(),this.relativeTargetOrigin=Cr(),kg(this.relativeTargetOrigin,this.target,y.target),to(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||X3(this.parent.latestValues)||GH(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var v;const o=this.getLead(),c=!!this.resumingFrom||this!==o;let d=!0;if((this.isProjectionDirty||(v=this.parent)!=null&&v.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Ba.timestamp&&(d=!1),d)return;const{layout:u,layoutId:m}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||m))return;to(this.layoutCorrected,this.layout.layoutBox);const x=this.treeScale.x,g=this.treeScale.y;d0e(this.layoutCorrected,this.treeScale,this.path,c),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=Cr());const{target:y}=o;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(l6(this.prevProjectionDelta.x,this.projectionDelta.x),l6(this.prevProjectionDelta.y,this.projectionDelta.y)),Cg(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==x||this.treeScale.y!==g||!p6(this.projectionDelta.x,this.prevProjectionDelta.x)||!p6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var c;if((c=this.options.visualElement)==null||c.scheduleRender(),o){const d=this.getStack();d&&d.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=vp(),this.projectionDelta=vp(),this.projectionDeltaWithTransform=vp()}setAnimationOrigin(o,c=!1){const d=this.snapshot,u=d?d.latestValues:{},m={...this.latestValues},x=vp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const g=Cr(),y=d?d.source:void 0,v=this.layout?this.layout.source:void 0,j=y!==v,w=this.getStack(),S=!w||w.members.length<=1,E=!!(j&&!S&&this.options.crossfade===!0&&!this.path.some(Vge));this.animationProgress=0;let k;this.mixTargetDelta=A=>{const I=A/1e3;y6(x.x,o.x,I),y6(x.y,o.y,I),this.setTargetDelta(x),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(kg(g,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Uge(this.relativeTarget,this.relativeTargetOrigin,g,I),k&&kge(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=Cr()),to(k,this.relativeTarget)),j&&(this.animationValues=m,jge(m,u,this.latestValues,I,E,S)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=I},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var c,d,u;this.notifyListeners("animationStart"),(c=this.currentAnimation)==null||c.stop(),(u=(d=this.resumingFrom)==null?void 0:d.currentAnimation)==null||u.stop(),this.pendingAnimation&&(hm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Kn.update(()=>{cj.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Zp(0)),this.currentAnimation=fge(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:m=>{this.mixTargetDelta(m),o.onUpdate&&o.onUpdate(m)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Tge),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:c,target:d,layout:u,latestValues:m}=o;if(!(!c||!d||!u)){if(this!==o&&this.layout&&u&&gW(this.options.animationType,this.layout.layoutBox,u.layoutBox)){d=this.target||Cr();const x=ki(this.layout.layoutBox.x);d.x.min=o.target.x.min,d.x.max=d.x.min+x;const g=ki(this.layout.layoutBox.y);d.y.min=o.target.y.min,d.y.max=d.y.min+g}to(c,d),yp(c,m),Cg(this.projectionDeltaWithTransform,this.layoutCorrected,c,m)}}registerSharedNode(o,c){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Age),this.sharedNodes.get(o).add(c);const u=c.options.initialPromotionConfig;c.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(c):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var c;const{layoutId:o}=this.options;return o?((c=this.getStack())==null?void 0:c.lead)||this:this}getPrevLead(){var c;const{layoutId:o}=this.options;return o?(c=this.getStack())==null?void 0:c.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:c,preserveFollowOpacity:d}={}){const u=this.getStack();u&&u.promote(this,d),o&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let c=!1;const{latestValues:d}=o;if((d.z||d.rotate||d.rotateX||d.rotateY||d.rotateZ||d.skewX||d.skewY)&&(c=!0),!c)return;const u={};d.z&&_C("z",o,u,this.animationValues);for(let m=0;m<wC.length;m++)_C(`rotate${wC[m]}`,o,u,this.animationValues),_C(`skew${wC[m]}`,o,u,this.animationValues);o.render();for(const m in u)o.setStaticValue(m,u[m]),this.animationValues&&(this.animationValues[m]=u[m]);o.scheduleRender()}applyProjectionStyles(o,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const d=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=oj(c==null?void 0:c.pointerEvents)||"",o.transform=d?d(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=oj(c==null?void 0:c.pointerEvents)||""),this.hasProjected&&!Xm(this.latestValues)&&(o.transform=d?d({},""):"none",this.hasProjected=!1);return}o.visibility="";const m=u.animationValues||u.latestValues;this.applyTransformsToTarget();let x=Ege(this.projectionDeltaWithTransform,this.treeScale,m);d&&(x=d(m,x)),o.transform=x;const{x:g,y}=this.projectionDelta;o.transformOrigin=`${g.origin*100}% ${y.origin*100}% 0`,u.animationValues?o.opacity=u===this?m.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:o.opacity=u===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const v in db){if(m[v]===void 0)continue;const{correct:j,applyTo:w,isCSSVariable:S}=db[v],E=x==="none"?m[v]:j(m[v],u);if(w){const k=w.length;for(let A=0;A<k;A++)o[w[A]]=E}else S?this.options.visualElement.renderState.vars[v]=E:o[v]=E}this.options.layoutId&&(o.pointerEvents=u===this?oj(c==null?void 0:c.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var c;return(c=o.currentAnimation)==null?void 0:c.stop()}),this.root.nodes.forEach(f6),this.root.sharedNodes.clear()}}}function Dge(t){t.updateLayout()}function Mge(t){var r;const s=((r=t.resumeFrom)==null?void 0:r.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&s&&t.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:i}=t.layout,{animationType:l}=t.options,o=s.source!==t.layout.source;l==="size"?mo(x=>{const g=o?s.measuredBox[x]:s.layoutBox[x],y=ki(g);g.min=a[x].min,g.max=g.min+y}):gW(l,s.layoutBox,a)&&mo(x=>{const g=o?s.measuredBox[x]:s.layoutBox[x],y=ki(a[x]);g.max=g.min+y,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[x].max=t.relativeTarget[x].min+y)});const c=vp();Cg(c,a,s.layoutBox);const d=vp();o?Cg(d,t.applyTransform(i,!0),s.measuredBox):Cg(d,a,s.layoutBox);const u=!hW(c);let m=!1;if(!t.resumeFrom){const x=t.getClosestProjectingParent();if(x&&!x.resumeFrom){const{snapshot:g,layout:y}=x;if(g&&y){const v=Cr();kg(v,s.layoutBox,g.layoutBox);const j=Cr();kg(j,a,y.layoutBox),xW(v,j)||(m=!0),x.options.layoutRoot&&(t.relativeTarget=j,t.relativeTargetOrigin=v,t.relativeParent=x)}}}t.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:d,layoutDelta:c,hasLayoutChanged:u,hasRelativeLayoutChanged:m})}else if(t.isLead()){const{onExitComplete:a}=t.options;a&&a()}t.options.transition=void 0}function Ige(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Oge(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Rge(t){t.clearSnapshot()}function f6(t){t.clearMeasurements()}function g6(t){t.isLayoutDirty=!1}function Lge(t){const{visualElement:s}=t.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),t.resetTransform()}function b6(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function Fge(t){t.resolveTargetDelta()}function Bge(t){t.calcProjection()}function $ge(t){t.resetSkewAndRotation()}function zge(t){t.removeLeadSnapshot()}function y6(t,s,r){t.translate=nr(s.translate,0,r),t.scale=nr(s.scale,1,r),t.origin=s.origin,t.originPoint=s.originPoint}function v6(t,s,r,a){t.min=nr(s.min,r.min,a),t.max=nr(s.max,r.max,a)}function Uge(t,s,r,a){v6(t.x,s.x,r.x,a),v6(t.y,s.y,r.y,a)}function Vge(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const Hge={duration:.45,ease:[.4,0,.1,1]},j6=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),N6=j6("applewebkit/")&&!j6("chrome/")?Math.round:ko;function w6(t){t.min=N6(t.min),t.max=N6(t.max)}function Wge(t){w6(t.x),w6(t.y)}function gW(t,s,r){return t==="position"||t==="preserve-aspect"&&!Q0e(x6(s),x6(r),.2)}function qge(t){var s;return t!==t.root&&((s=t.scroll)==null?void 0:s.wasRoot)}const Gge=fW({attachResizeListener:(t,s)=>ub(t,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),SC={current:void 0},bW=fW({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!SC.current){const t=new Gge({});t.mount(window),t.setOptions({layoutScroll:!0}),SC.current=t}return SC.current},resetTransform:(t,s)=>{t.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),Kge={pan:{Feature:mge},drag:{Feature:uge,ProjectionNode:bW,MeasureLayout:dW}};function _6(t,s,r){const{props:a}=t;t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",r==="Start");const i="onHover"+r,l=a[i];l&&Kn.postRender(()=>l(s,oy(s)))}class Yge extends km{mount(){const{current:s}=this.node;s&&(this.unmount=ffe(s,(r,a)=>(_6(this.node,a,"Start"),i=>_6(this.node,i,"End"))))}unmount(){}}class Xge extends km{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ay(ub(this.node.current,"focus",()=>this.onFocus()),ub(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function S6(t,s,r){const{props:a}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&a.whileTap&&t.animationState.setActive("whileTap",r==="Start");const i="onTap"+(r==="End"?"":r),l=a[i];l&&Kn.postRender(()=>l(s,oy(s)))}class Qge extends km{mount(){const{current:s}=this.node;s&&(this.unmount=vfe(s,(r,a)=>(S6(this.node,a,"Start"),(i,{success:l})=>S6(this.node,i,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const n4=new WeakMap,CC=new WeakMap,Zge=t=>{const s=n4.get(t.target);s&&s(t)},Jge=t=>{t.forEach(Zge)};function ebe({root:t,...s}){const r=t||document;CC.has(r)||CC.set(r,{});const a=CC.get(r),i=JSON.stringify(s);return a[i]||(a[i]=new IntersectionObserver(Jge,{root:t,...s})),a[i]}function tbe(t,s,r){const a=ebe(s);return n4.set(t,r),a.observe(t),()=>{n4.delete(t),a.unobserve(t)}}const sbe={some:0,all:1};class nbe extends km{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:r,margin:a,amount:i="some",once:l}=s,o={root:r?r.current:void 0,rootMargin:a,threshold:typeof i=="number"?i:sbe[i]},c=d=>{const{isIntersecting:u}=d;if(this.isInView===u||(this.isInView=u,l&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:m,onViewportLeave:x}=this.node.getProps(),g=u?m:x;g&&g(d)};return tbe(this.node.current,o,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:r}=this.node;["amount","margin","root"].some(rbe(s,r))&&this.startObserver()}unmount(){}}function rbe({viewport:t={}},{viewport:s={}}={}){return r=>t[r]!==s[r]}const abe={inView:{Feature:nbe},tap:{Feature:Qge},focus:{Feature:Xge},hover:{Feature:Yge}},ibe={layout:{ProjectionNode:bW,MeasureLayout:dW}},lbe={...W0e,...abe,...Kge,...ibe},mt=l0e(lbe,v0e);function m2(t){const s=dn(d=>d.modules)||{},r=dn(d=>d.user),a=(r==null?void 0:r.is_admin)&&Object.keys(s).length===0,i=s[t]||[],l=p.useMemo(()=>new Set(i.map(d=>d.code.split(".").pop())),[i]),o=a||i.length>0,c=d=>a||l.has(d);return{hasAny:o,canView:c("view"),canCreate:c("create"),canUpdate:c("update"),canDelete:c("delete")}}function yW(t){var s,r,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(s=0;s<i;s++)t[s]&&(r=yW(t[s]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r);return a}function mn(){for(var t,s,r=0,a="",i=arguments.length;r<i;r++)(t=arguments[r])&&(s=yW(t))&&(a&&(a+=" "),a+=s);return a}const MT="-",obe=t=>{const s=dbe(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:o=>{const c=o.split(MT);return c[0]===""&&c.length!==1&&c.shift(),vW(c,s)||cbe(o)},getConflictingClassGroupIds:(o,c)=>{const d=r[o]||[];return c&&a[o]?[...d,...a[o]]:d}}},vW=(t,s)=>{var o;if(t.length===0)return s.classGroupId;const r=t[0],a=s.nextPart.get(r),i=a?vW(t.slice(1),a):void 0;if(i)return i;if(s.validators.length===0)return;const l=t.join(MT);return(o=s.validators.find(({validator:c})=>c(l)))==null?void 0:o.classGroupId},C6=/^\[(.+)\]$/,cbe=t=>{if(C6.test(t)){const s=C6.exec(t)[1],r=s==null?void 0:s.substring(0,s.indexOf(":"));if(r)return"arbitrary.."+r}},dbe=t=>{const{theme:s,classGroups:r}=t,a={nextPart:new Map,validators:[]};for(const i in r)r4(r[i],a,i,s);return a},r4=(t,s,r,a)=>{t.forEach(i=>{if(typeof i=="string"){const l=i===""?s:k6(s,i);l.classGroupId=r;return}if(typeof i=="function"){if(ube(i)){r4(i(a),s,r,a);return}s.validators.push({validator:i,classGroupId:r});return}Object.entries(i).forEach(([l,o])=>{r4(o,k6(s,l),r,a)})})},k6=(t,s)=>{let r=t;return s.split(MT).forEach(a=>{r.nextPart.has(a)||r.nextPart.set(a,{nextPart:new Map,validators:[]}),r=r.nextPart.get(a)}),r},ube=t=>t.isThemeGetter,mbe=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,r=new Map,a=new Map;const i=(l,o)=>{r.set(l,o),s++,s>t&&(s=0,a=r,r=new Map)};return{get(l){let o=r.get(l);if(o!==void 0)return o;if((o=a.get(l))!==void 0)return i(l,o),o},set(l,o){r.has(l)?r.set(l,o):i(l,o)}}},a4="!",i4=":",hbe=i4.length,xbe=t=>{const{prefix:s,experimentalParseClassName:r}=t;let a=i=>{const l=[];let o=0,c=0,d=0,u;for(let v=0;v<i.length;v++){let j=i[v];if(o===0&&c===0){if(j===i4){l.push(i.slice(d,v)),d=v+hbe;continue}if(j==="/"){u=v;continue}}j==="["?o++:j==="]"?o--:j==="("?c++:j===")"&&c--}const m=l.length===0?i:i.substring(d),x=pbe(m),g=x!==m,y=u&&u>d?u-d:void 0;return{modifiers:l,hasImportantModifier:g,baseClassName:x,maybePostfixModifierPosition:y}};if(s){const i=s+i4,l=a;a=o=>o.startsWith(i)?l(o.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(r){const i=a;a=l=>r({className:l,parseClassName:i})}return a},pbe=t=>t.endsWith(a4)?t.substring(0,t.length-1):t.startsWith(a4)?t.substring(1):t,fbe=t=>{const s=Object.fromEntries(t.orderSensitiveModifiers.map(a=>[a,!0]));return a=>{if(a.length<=1)return a;const i=[];let l=[];return a.forEach(o=>{o[0]==="["||s[o]?(i.push(...l.sort(),o),l=[]):l.push(o)}),i.push(...l.sort()),i}},gbe=t=>({cache:mbe(t.cacheSize),parseClassName:xbe(t),sortModifiers:fbe(t),...obe(t)}),bbe=/\s+/,ybe=(t,s)=>{const{parseClassName:r,getClassGroupId:a,getConflictingClassGroupIds:i,sortModifiers:l}=s,o=[],c=t.trim().split(bbe);let d="";for(let u=c.length-1;u>=0;u-=1){const m=c[u],{isExternal:x,modifiers:g,hasImportantModifier:y,baseClassName:v,maybePostfixModifierPosition:j}=r(m);if(x){d=m+(d.length>0?" "+d:d);continue}let w=!!j,S=a(w?v.substring(0,j):v);if(!S){if(!w){d=m+(d.length>0?" "+d:d);continue}if(S=a(v),!S){d=m+(d.length>0?" "+d:d);continue}w=!1}const E=l(g).join(":"),k=y?E+a4:E,A=k+S;if(o.includes(A))continue;o.push(A);const I=i(S,w);for(let P=0;P<I.length;++P){const O=I[P];o.push(k+O)}d=m+(d.length>0?" "+d:d)}return d};function vbe(){let t=0,s,r,a="";for(;t<arguments.length;)(s=arguments[t++])&&(r=jW(s))&&(a&&(a+=" "),a+=r);return a}const jW=t=>{if(typeof t=="string")return t;let s,r="";for(let a=0;a<t.length;a++)t[a]&&(s=jW(t[a]))&&(r&&(r+=" "),r+=s);return r};function jbe(t,...s){let r,a,i,l=o;function o(d){const u=s.reduce((m,x)=>x(m),t());return r=gbe(u),a=r.cache.get,i=r.cache.set,l=c,c(d)}function c(d){const u=a(d);if(u)return u;const m=ybe(d,r);return i(d,m),m}return function(){return l(vbe.apply(null,arguments))}}const ea=t=>{const s=r=>r[t]||[];return s.isThemeGetter=!0,s},NW=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,wW=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Nbe=/^\d+\/\d+$/,wbe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_be=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Sbe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Cbe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,kbe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Tx=t=>Nbe.test(t),As=t=>!!t&&!Number.isNaN(Number(t)),Su=t=>!!t&&Number.isInteger(Number(t)),kC=t=>t.endsWith("%")&&As(t.slice(0,-1)),yd=t=>wbe.test(t),Abe=()=>!0,Ebe=t=>_be.test(t)&&!Sbe.test(t),_W=()=>!1,Tbe=t=>Cbe.test(t),Pbe=t=>kbe.test(t),Dbe=t=>!Gt(t)&&!Kt(t),Mbe=t=>kf(t,kW,_W),Gt=t=>NW.test(t),zm=t=>kf(t,AW,Ebe),AC=t=>kf(t,Fbe,As),A6=t=>kf(t,SW,_W),Ibe=t=>kf(t,CW,Pbe),p1=t=>kf(t,EW,Tbe),Kt=t=>wW.test(t),f0=t=>Af(t,AW),Obe=t=>Af(t,Bbe),E6=t=>Af(t,SW),Rbe=t=>Af(t,kW),Lbe=t=>Af(t,CW),f1=t=>Af(t,EW,!0),kf=(t,s,r)=>{const a=NW.exec(t);return a?a[1]?s(a[1]):r(a[2]):!1},Af=(t,s,r=!1)=>{const a=wW.exec(t);return a?a[1]?s(a[1]):r:!1},SW=t=>t==="position"||t==="percentage",CW=t=>t==="image"||t==="url",kW=t=>t==="length"||t==="size"||t==="bg-size",AW=t=>t==="length",Fbe=t=>t==="number",Bbe=t=>t==="family-name",EW=t=>t==="shadow",$be=()=>{const t=ea("color"),s=ea("font"),r=ea("text"),a=ea("font-weight"),i=ea("tracking"),l=ea("leading"),o=ea("breakpoint"),c=ea("container"),d=ea("spacing"),u=ea("radius"),m=ea("shadow"),x=ea("inset-shadow"),g=ea("text-shadow"),y=ea("drop-shadow"),v=ea("blur"),j=ea("perspective"),w=ea("aspect"),S=ea("ease"),E=ea("animate"),k=()=>["auto","avoid","all","avoid-page","page","left","right","column"],A=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],I=()=>[...A(),Kt,Gt],P=()=>["auto","hidden","clip","visible","scroll"],O=()=>["auto","contain","none"],D=()=>[Kt,Gt,d],T=()=>[Tx,"full","auto",...D()],B=()=>[Su,"none","subgrid",Kt,Gt],U=()=>["auto",{span:["full",Su,Kt,Gt]},Su,Kt,Gt],W=()=>[Su,"auto",Kt,Gt],V=()=>["auto","min","max","fr",Kt,Gt],R=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],F=()=>["start","end","center","stretch","center-safe","end-safe"],G=()=>["auto",...D()],H=()=>[Tx,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...D()],$=()=>[t,Kt,Gt],K=()=>[...A(),E6,A6,{position:[Kt,Gt]}],le=()=>["no-repeat",{repeat:["","x","y","space","round"]}],se=()=>["auto","cover","contain",Rbe,Mbe,{size:[Kt,Gt]}],J=()=>[kC,f0,zm],ie=()=>["","none","full",u,Kt,Gt],te=()=>["",As,f0,zm],ne=()=>["solid","dashed","dotted","double"],q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ee=()=>[As,kC,E6,A6],X=()=>["","none",v,Kt,Gt],Z=()=>["none",As,Kt,Gt],Y=()=>["none",As,Kt,Gt],Q=()=>[As,Kt,Gt],oe=()=>[Tx,"full",...D()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[yd],breakpoint:[yd],color:[Abe],container:[yd],"drop-shadow":[yd],ease:["in","out","in-out"],font:[Dbe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[yd],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[yd],shadow:[yd],spacing:["px",As],text:[yd],"text-shadow":[yd],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Tx,Gt,Kt,w]}],container:["container"],columns:[{columns:[As,Gt,Kt,c]}],"break-after":[{"break-after":k()}],"break-before":[{"break-before":k()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:I()}],overflow:[{overflow:P()}],"overflow-x":[{"overflow-x":P()}],"overflow-y":[{"overflow-y":P()}],overscroll:[{overscroll:O()}],"overscroll-x":[{"overscroll-x":O()}],"overscroll-y":[{"overscroll-y":O()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:T()}],"inset-x":[{"inset-x":T()}],"inset-y":[{"inset-y":T()}],start:[{start:T()}],end:[{end:T()}],top:[{top:T()}],right:[{right:T()}],bottom:[{bottom:T()}],left:[{left:T()}],visibility:["visible","invisible","collapse"],z:[{z:[Su,"auto",Kt,Gt]}],basis:[{basis:[Tx,"full","auto",c,...D()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[As,Tx,"auto","initial","none",Gt]}],grow:[{grow:["",As,Kt,Gt]}],shrink:[{shrink:["",As,Kt,Gt]}],order:[{order:[Su,"first","last","none",Kt,Gt]}],"grid-cols":[{"grid-cols":B()}],"col-start-end":[{col:U()}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":B()}],"row-start-end":[{row:U()}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":V()}],"auto-rows":[{"auto-rows":V()}],gap:[{gap:D()}],"gap-x":[{"gap-x":D()}],"gap-y":[{"gap-y":D()}],"justify-content":[{justify:[...R(),"normal"]}],"justify-items":[{"justify-items":[...F(),"normal"]}],"justify-self":[{"justify-self":["auto",...F()]}],"align-content":[{content:["normal",...R()]}],"align-items":[{items:[...F(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...F(),{baseline:["","last"]}]}],"place-content":[{"place-content":R()}],"place-items":[{"place-items":[...F(),"baseline"]}],"place-self":[{"place-self":["auto",...F()]}],p:[{p:D()}],px:[{px:D()}],py:[{py:D()}],ps:[{ps:D()}],pe:[{pe:D()}],pt:[{pt:D()}],pr:[{pr:D()}],pb:[{pb:D()}],pl:[{pl:D()}],m:[{m:G()}],mx:[{mx:G()}],my:[{my:G()}],ms:[{ms:G()}],me:[{me:G()}],mt:[{mt:G()}],mr:[{mr:G()}],mb:[{mb:G()}],ml:[{ml:G()}],"space-x":[{"space-x":D()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":D()}],"space-y-reverse":["space-y-reverse"],size:[{size:H()}],w:[{w:[c,"screen",...H()]}],"min-w":[{"min-w":[c,"screen","none",...H()]}],"max-w":[{"max-w":[c,"screen","none","prose",{screen:[o]},...H()]}],h:[{h:["screen","lh",...H()]}],"min-h":[{"min-h":["screen","lh","none",...H()]}],"max-h":[{"max-h":["screen","lh",...H()]}],"font-size":[{text:["base",r,f0,zm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[a,Kt,AC]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",kC,Gt]}],"font-family":[{font:[Obe,Gt,s]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Kt,Gt]}],"line-clamp":[{"line-clamp":[As,"none",Kt,AC]}],leading:[{leading:[l,...D()]}],"list-image":[{"list-image":["none",Kt,Gt]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Kt,Gt]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:$()}],"text-color":[{text:$()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ne(),"wavy"]}],"text-decoration-thickness":[{decoration:[As,"from-font","auto",Kt,zm]}],"text-decoration-color":[{decoration:$()}],"underline-offset":[{"underline-offset":[As,"auto",Kt,Gt]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:D()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Kt,Gt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Kt,Gt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:K()}],"bg-repeat":[{bg:le()}],"bg-size":[{bg:se()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Su,Kt,Gt],radial:["",Kt,Gt],conic:[Su,Kt,Gt]},Lbe,Ibe]}],"bg-color":[{bg:$()}],"gradient-from-pos":[{from:J()}],"gradient-via-pos":[{via:J()}],"gradient-to-pos":[{to:J()}],"gradient-from":[{from:$()}],"gradient-via":[{via:$()}],"gradient-to":[{to:$()}],rounded:[{rounded:ie()}],"rounded-s":[{"rounded-s":ie()}],"rounded-e":[{"rounded-e":ie()}],"rounded-t":[{"rounded-t":ie()}],"rounded-r":[{"rounded-r":ie()}],"rounded-b":[{"rounded-b":ie()}],"rounded-l":[{"rounded-l":ie()}],"rounded-ss":[{"rounded-ss":ie()}],"rounded-se":[{"rounded-se":ie()}],"rounded-ee":[{"rounded-ee":ie()}],"rounded-es":[{"rounded-es":ie()}],"rounded-tl":[{"rounded-tl":ie()}],"rounded-tr":[{"rounded-tr":ie()}],"rounded-br":[{"rounded-br":ie()}],"rounded-bl":[{"rounded-bl":ie()}],"border-w":[{border:te()}],"border-w-x":[{"border-x":te()}],"border-w-y":[{"border-y":te()}],"border-w-s":[{"border-s":te()}],"border-w-e":[{"border-e":te()}],"border-w-t":[{"border-t":te()}],"border-w-r":[{"border-r":te()}],"border-w-b":[{"border-b":te()}],"border-w-l":[{"border-l":te()}],"divide-x":[{"divide-x":te()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":te()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ne(),"hidden","none"]}],"divide-style":[{divide:[...ne(),"hidden","none"]}],"border-color":[{border:$()}],"border-color-x":[{"border-x":$()}],"border-color-y":[{"border-y":$()}],"border-color-s":[{"border-s":$()}],"border-color-e":[{"border-e":$()}],"border-color-t":[{"border-t":$()}],"border-color-r":[{"border-r":$()}],"border-color-b":[{"border-b":$()}],"border-color-l":[{"border-l":$()}],"divide-color":[{divide:$()}],"outline-style":[{outline:[...ne(),"none","hidden"]}],"outline-offset":[{"outline-offset":[As,Kt,Gt]}],"outline-w":[{outline:["",As,f0,zm]}],"outline-color":[{outline:$()}],shadow:[{shadow:["","none",m,f1,p1]}],"shadow-color":[{shadow:$()}],"inset-shadow":[{"inset-shadow":["none",x,f1,p1]}],"inset-shadow-color":[{"inset-shadow":$()}],"ring-w":[{ring:te()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:$()}],"ring-offset-w":[{"ring-offset":[As,zm]}],"ring-offset-color":[{"ring-offset":$()}],"inset-ring-w":[{"inset-ring":te()}],"inset-ring-color":[{"inset-ring":$()}],"text-shadow":[{"text-shadow":["none",g,f1,p1]}],"text-shadow-color":[{"text-shadow":$()}],opacity:[{opacity:[As,Kt,Gt]}],"mix-blend":[{"mix-blend":[...q(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":q()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[As]}],"mask-image-linear-from-pos":[{"mask-linear-from":ee()}],"mask-image-linear-to-pos":[{"mask-linear-to":ee()}],"mask-image-linear-from-color":[{"mask-linear-from":$()}],"mask-image-linear-to-color":[{"mask-linear-to":$()}],"mask-image-t-from-pos":[{"mask-t-from":ee()}],"mask-image-t-to-pos":[{"mask-t-to":ee()}],"mask-image-t-from-color":[{"mask-t-from":$()}],"mask-image-t-to-color":[{"mask-t-to":$()}],"mask-image-r-from-pos":[{"mask-r-from":ee()}],"mask-image-r-to-pos":[{"mask-r-to":ee()}],"mask-image-r-from-color":[{"mask-r-from":$()}],"mask-image-r-to-color":[{"mask-r-to":$()}],"mask-image-b-from-pos":[{"mask-b-from":ee()}],"mask-image-b-to-pos":[{"mask-b-to":ee()}],"mask-image-b-from-color":[{"mask-b-from":$()}],"mask-image-b-to-color":[{"mask-b-to":$()}],"mask-image-l-from-pos":[{"mask-l-from":ee()}],"mask-image-l-to-pos":[{"mask-l-to":ee()}],"mask-image-l-from-color":[{"mask-l-from":$()}],"mask-image-l-to-color":[{"mask-l-to":$()}],"mask-image-x-from-pos":[{"mask-x-from":ee()}],"mask-image-x-to-pos":[{"mask-x-to":ee()}],"mask-image-x-from-color":[{"mask-x-from":$()}],"mask-image-x-to-color":[{"mask-x-to":$()}],"mask-image-y-from-pos":[{"mask-y-from":ee()}],"mask-image-y-to-pos":[{"mask-y-to":ee()}],"mask-image-y-from-color":[{"mask-y-from":$()}],"mask-image-y-to-color":[{"mask-y-to":$()}],"mask-image-radial":[{"mask-radial":[Kt,Gt]}],"mask-image-radial-from-pos":[{"mask-radial-from":ee()}],"mask-image-radial-to-pos":[{"mask-radial-to":ee()}],"mask-image-radial-from-color":[{"mask-radial-from":$()}],"mask-image-radial-to-color":[{"mask-radial-to":$()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":A()}],"mask-image-conic-pos":[{"mask-conic":[As]}],"mask-image-conic-from-pos":[{"mask-conic-from":ee()}],"mask-image-conic-to-pos":[{"mask-conic-to":ee()}],"mask-image-conic-from-color":[{"mask-conic-from":$()}],"mask-image-conic-to-color":[{"mask-conic-to":$()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:K()}],"mask-repeat":[{mask:le()}],"mask-size":[{mask:se()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Kt,Gt]}],filter:[{filter:["","none",Kt,Gt]}],blur:[{blur:X()}],brightness:[{brightness:[As,Kt,Gt]}],contrast:[{contrast:[As,Kt,Gt]}],"drop-shadow":[{"drop-shadow":["","none",y,f1,p1]}],"drop-shadow-color":[{"drop-shadow":$()}],grayscale:[{grayscale:["",As,Kt,Gt]}],"hue-rotate":[{"hue-rotate":[As,Kt,Gt]}],invert:[{invert:["",As,Kt,Gt]}],saturate:[{saturate:[As,Kt,Gt]}],sepia:[{sepia:["",As,Kt,Gt]}],"backdrop-filter":[{"backdrop-filter":["","none",Kt,Gt]}],"backdrop-blur":[{"backdrop-blur":X()}],"backdrop-brightness":[{"backdrop-brightness":[As,Kt,Gt]}],"backdrop-contrast":[{"backdrop-contrast":[As,Kt,Gt]}],"backdrop-grayscale":[{"backdrop-grayscale":["",As,Kt,Gt]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[As,Kt,Gt]}],"backdrop-invert":[{"backdrop-invert":["",As,Kt,Gt]}],"backdrop-opacity":[{"backdrop-opacity":[As,Kt,Gt]}],"backdrop-saturate":[{"backdrop-saturate":[As,Kt,Gt]}],"backdrop-sepia":[{"backdrop-sepia":["",As,Kt,Gt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":D()}],"border-spacing-x":[{"border-spacing-x":D()}],"border-spacing-y":[{"border-spacing-y":D()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Kt,Gt]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[As,"initial",Kt,Gt]}],ease:[{ease:["linear","initial",S,Kt,Gt]}],delay:[{delay:[As,Kt,Gt]}],animate:[{animate:["none",E,Kt,Gt]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[j,Kt,Gt]}],"perspective-origin":[{"perspective-origin":I()}],rotate:[{rotate:Z()}],"rotate-x":[{"rotate-x":Z()}],"rotate-y":[{"rotate-y":Z()}],"rotate-z":[{"rotate-z":Z()}],scale:[{scale:Y()}],"scale-x":[{"scale-x":Y()}],"scale-y":[{"scale-y":Y()}],"scale-z":[{"scale-z":Y()}],"scale-3d":["scale-3d"],skew:[{skew:Q()}],"skew-x":[{"skew-x":Q()}],"skew-y":[{"skew-y":Q()}],transform:[{transform:[Kt,Gt,"","none","gpu","cpu"]}],"transform-origin":[{origin:I()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:oe()}],"translate-x":[{"translate-x":oe()}],"translate-y":[{"translate-y":oe()}],"translate-z":[{"translate-z":oe()}],"translate-none":["translate-none"],accent:[{accent:$()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:$()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Kt,Gt]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":D()}],"scroll-mx":[{"scroll-mx":D()}],"scroll-my":[{"scroll-my":D()}],"scroll-ms":[{"scroll-ms":D()}],"scroll-me":[{"scroll-me":D()}],"scroll-mt":[{"scroll-mt":D()}],"scroll-mr":[{"scroll-mr":D()}],"scroll-mb":[{"scroll-mb":D()}],"scroll-ml":[{"scroll-ml":D()}],"scroll-p":[{"scroll-p":D()}],"scroll-px":[{"scroll-px":D()}],"scroll-py":[{"scroll-py":D()}],"scroll-ps":[{"scroll-ps":D()}],"scroll-pe":[{"scroll-pe":D()}],"scroll-pt":[{"scroll-pt":D()}],"scroll-pr":[{"scroll-pr":D()}],"scroll-pb":[{"scroll-pb":D()}],"scroll-pl":[{"scroll-pl":D()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Kt,Gt]}],fill:[{fill:["none",...$()]}],"stroke-w":[{stroke:[As,f0,zm,AC]}],stroke:[{stroke:["none",...$()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},zbe=jbe($be);function Bt(...t){return zbe(mn(t))}const dt=p.forwardRef(({className:t,...s},r)=>n.jsx("div",{ref:r,className:Bt("rounded-xl border bg-card text-card-foreground shadow",t),...s}));dt.displayName="Card";const gt=p.forwardRef(({className:t,...s},r)=>n.jsx("div",{ref:r,className:Bt("flex flex-col space-y-1.5 p-6",t),...s}));gt.displayName="CardHeader";const jt=p.forwardRef(({className:t,...s},r)=>n.jsx("div",{ref:r,className:Bt("font-semibold leading-none tracking-tight",t),...s}));jt.displayName="CardTitle";const gs=p.forwardRef(({className:t,...s},r)=>n.jsx("div",{ref:r,className:Bt("text-sm text-muted-foreground",t),...s}));gs.displayName="CardDescription";const it=p.forwardRef(({className:t,...s},r)=>n.jsx("div",{ref:r,className:Bt("p-6 pt-0",t),...s}));it.displayName="CardContent";const Ube=p.forwardRef(({className:t,...s},r)=>n.jsx("div",{ref:r,className:Bt("flex items-center p-6 pt-0",t),...s}));Ube.displayName="CardFooter";const T6=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,P6=mn,h2=(t,s)=>r=>{var a;if((s==null?void 0:s.variants)==null)return P6(t,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:i,defaultVariants:l}=s,o=Object.keys(i).map(u=>{const m=r==null?void 0:r[u],x=l==null?void 0:l[u];if(m===null)return null;const g=T6(m)||T6(x);return i[u][g]}),c=r&&Object.entries(r).reduce((u,m)=>{let[x,g]=m;return g===void 0||(u[x]=g),u},{}),d=s==null||(a=s.compoundVariants)===null||a===void 0?void 0:a.reduce((u,m)=>{let{class:x,className:g,...y}=m;return Object.entries(y).every(v=>{let[j,w]=v;return Array.isArray(w)?w.includes({...l,...c}[j]):{...l,...c}[j]===w})?[...u,x,g]:u},[]);return P6(t,o,d,r==null?void 0:r.class,r==null?void 0:r.className)},Vbe=h2("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function et({className:t,variant:s,...r}){return n.jsx("div",{className:Bt(Vbe({variant:s}),t),...r})}function D6(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function x2(...t){return s=>{let r=!1;const a=t.map(i=>{const l=D6(i,s);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let i=0;i<a.length;i++){const l=a[i];typeof l=="function"?l():D6(t[i],null)}}}}function Fs(...t){return p.useCallback(x2(...t),t)}function Hh(t){const s=Wbe(t),r=p.forwardRef((a,i)=>{const{children:l,...o}=a,c=p.Children.toArray(l),d=c.find(Gbe);if(d){const u=d.props.children,m=c.map(x=>x===d?p.Children.count(u)>1?p.Children.only(null):p.isValidElement(u)?u.props.children:null:x);return n.jsx(s,{...o,ref:i,children:p.isValidElement(u)?p.cloneElement(u,void 0,m):null})}return n.jsx(s,{...o,ref:i,children:l})});return r.displayName=`${t}.Slot`,r}var Hbe=Hh("Slot");function Wbe(t){const s=p.forwardRef((r,a)=>{const{children:i,...l}=r;if(p.isValidElement(i)){const o=Ybe(i),c=Kbe(l,i.props);return i.type!==p.Fragment&&(c.ref=a?x2(a,o):o),p.cloneElement(i,c)}return p.Children.count(i)>1?p.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var qbe=Symbol("radix.slottable");function Gbe(t){return p.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===qbe}function Kbe(t,s){const r={...s};for(const a in s){const i=t[a],l=s[a];/^on[A-Z]/.test(a)?i&&l?r[a]=(...c)=>{const d=l(...c);return i(...c),d}:i&&(r[a]=i):a==="style"?r[a]={...i,...l}:a==="className"&&(r[a]=[i,l].filter(Boolean).join(" "))}return{...t,...r}}function Ybe(t){var a,i;let s=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const Xbe=h2("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ge=p.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,...i},l)=>{const o=a?Hbe:"button";return n.jsx(o,{className:Bt(Xbe({variant:s,size:r,className:t})),ref:l,...i})});ge.displayName="Button";const Ee=p.forwardRef(({className:t,type:s,...r},a)=>n.jsx("input",{type:s,className:Bt("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r}));Ee.displayName="Input";function ml({variant:t="default",className:s,children:r,...a}){const i="relative w-full rounded-lg border px-4 py-3 text-sm flex gap-3 items-start",l={default:"bg-slate-50 border-slate-500 text-slate-800",destructive:"bg-rose-50 border-rose-200 text-rose-800"};return n.jsx("div",{role:"alert",className:Bt(i,l[t]||l.default,s),...a,children:r})}function hl({className:t,children:s,...r}){return n.jsx("div",{className:Bt("font-semibold leading-tight text-sm",t),...r,children:s})}function xl({className:t,children:s,...r}){return n.jsx("div",{className:Bt("text-xs mt-1 text-slate-700",t),...r,children:s})}function Qe({className:t,...s}){return n.jsx("div",{className:Bt("animate-pulse rounded-md bg-primary/10",t),...s})}const EC={initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18}},sa={glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",glassSoft:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur-xl shadow-[0_6px_22px_rgba(2,6,23,0.08)]",chip:"inline-flex items-center rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1.5 text-[11px] font-semibold text-slate-700 hover:bg-black/[0.03] active:scale-[0.99] transition",input:"w-full rounded-2xl border border-black/50 bg-white/85 px-3 py-2 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500",pill:"inline-flex items-center rounded-full border border-black/50 bg-black/[0.03] px-2.5 py-0.5 text-[11px] font-semibold text-slate-700"};function $a(...t){return t.filter(Boolean).join(" ")}function g1(t){return t?String(t).replace(/[_-]+/g," ").split(" ").filter(Boolean).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}function Px(t){return String((t==null?void 0:t.code)||"").split(".").filter(Boolean)[0]||"general"}function TW(t){const s=String(t||"").split(".").filter(Boolean);return s[s.length-1]||""}function Qbe(t,s){return TW(t)===s}function M6(t,s){const r=String(t||""),a=String(s||"").trim();if(!a)return r;const i=r.toLowerCase().indexOf(a.toLowerCase());if(i===-1)return r;const l=r.slice(0,i),o=r.slice(i,i+a.length),c=r.slice(i+a.length);return n.jsxs(n.Fragment,{children:[l,n.jsx("mark",{className:"rounded bg-amber-100 px-1 py-0.5 text-slate-900",children:o}),c]})}function Zbe(){const t=(r,a)=>a.some(i=>r.includes(i)),s=(r,a=["view","create","update"])=>i=>{const l=String(i.code||"").toLowerCase(),o=String(i.label||"").toLowerCase(),c=t(l,r)||t(o,r),d=a.includes(TW(l));return c&&d};return{doctor:{label:"Doctor preset",description:"OPD/Visits/Vitals/Prescriptions/Orders (adaptive)",pick:r=>s(["patients","opd","visits","visit","vitals","prescription","rx","orders","lab","ris","radiology","appointments","queue","emr","soap"],["view","create","update","esign"])(r)||s(["dashboard"],["view"])(r)},nurse:{label:"Nurse preset",description:"IPD/Vitals/Nursing/Drug chart (adaptive)",pick:r=>s(["patients","ipd","admission","beds","ward","nursing","notes","vitals","drug","chart","medication","admin","iv","fluids"],["view","create","update"])(r)},reception:{label:"Reception preset",description:"Registration/Appointments/Billing view (adaptive)",pick:r=>s(["patients","registration","opd","appointments","queue","billing","invoice","payments"],["view","create","update"])(r)},lab:{label:"Lab preset",description:"LIS/Orders/Results/Attachments (adaptive)",pick:r=>s(["lab","lis","orders","result","results","attachments","specimen"],["view","create","update"])(r)},pharmacy:{label:"Pharmacy preset",description:"Inventory/RX/Dispense/Billing view (adaptive)",pick:r=>s(["pharmacy","inventory","stock","rx","dispense","bill","billing"],["view","create","update"])(r)},admin:{label:"Admin preset",description:"Broad configuration access (adaptive)",pick:r=>s(["roles","permissions","users","departments","masters","settings"],["view","create","update","delete"])(r)}}}function Jbe(){const{hasAny:t,canView:s,canCreate:r,canUpdate:a,canDelete:i}=m2("roles"),[l,o]=p.useState([]),[c,d]=p.useState([]),[u,m]=p.useState(!1),[x,g]=p.useState(!1),[y,v]=p.useState(""),[j,w]=p.useState(""),[S,E]=p.useState("all"),[k,A]=p.useState(!1),[I,P]=p.useState("create"),[O,D]=p.useState(null),[T,B]=p.useState({name:"",description:"",permission_ids:[]}),U=p.useCallback(async()=>{var $,K,le;if(s){v(""),m(!0);try{const[se,J]=await Promise.all([he.get("/roles/"),he.get("/permissions/")]);o(se.data||[]),d(J.data||[])}catch(se){const J=($=se==null?void 0:se.response)==null?void 0:$.status;v(J===403?"Access denied for Roles.":J===401?"Session expired. Please login again.":((le=(K=se==null?void 0:se.response)==null?void 0:K.data)==null?void 0:le.detail)||"Failed to load roles.")}finally{m(!1)}}},[s]);p.useEffect(()=>{U()},[U]);const W=()=>{r&&(P("create"),D(null),B({name:"",description:"",permission_ids:[]}),A(!0))},V=$=>{a&&(P("edit"),D($.id),B({name:$.name||"",description:$.description||"",permission_ids:$.permission_ids||[]}),A(!0))},R=()=>{A(!1)},F=async()=>{var $,K,le,se;if(k){if(!(($=T.name)!=null&&$.trim())){v("Role name is required.");return}if(!(I==="create"&&!r)&&!(I==="edit"&&!a)){g(!0),v("");try{I==="edit"&&O?await he.put(`/roles/${O}`,T):await he.post("/roles/",T),A(!1),D(null),B({name:"",description:"",permission_ids:[]}),U()}catch(J){const ie=(K=J==null?void 0:J.response)==null?void 0:K.status;v(ie===403?"Access denied.":ie===401?"Session expired. Please login again.":((se=(le=J==null?void 0:J.response)==null?void 0:le.data)==null?void 0:se.detail)||"Failed to save role.")}finally{g(!1)}}}},G=async()=>{var $,K,le;if(i&&O&&window.confirm("Delete this role?"))try{await he.delete(`/roles/${O}`),A(!1),D(null),B({name:"",description:"",permission_ids:[]}),U()}catch(se){const J=($=se==null?void 0:se.response)==null?void 0:$.status;v(J===403?"Access denied.":J===401?"Session expired. Please login again.":((le=(K=se==null?void 0:se.response)==null?void 0:K.data)==null?void 0:le.detail)||"Failed to delete role.")}},H=p.useMemo(()=>(l||[]).filter($=>{var ie;if(!$)return!1;const K=($.name||"").toLowerCase(),le=($.description||"").toLowerCase(),se=j.toLowerCase().trim();if(se&&!`${K} ${le}`.includes(se))return!1;const J=((ie=$.permission_ids)==null?void 0:ie.length)||0;return!(S==="withPerms"&&J===0||S==="noPerms"&&J>0)}),[l,j,S]);return!t||!s?n.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-slate-50 px-4 py-5 md:px-8 md:py-8",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-black/50 bg-white/70 backdrop-blur-xl shadow-[0_10px_32px_rgba(2,6,23,0.12)]",children:[n.jsx("div",{className:"absolute inset-0 opacity-70 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.18),_transparent_55%)]"}),n.jsxs("div",{className:"relative px-6 py-6 md:px-8 md:py-7 flex items-center gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(Ka,{className:"w-6 h-6 text-slate-700"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"Roles & Permissions"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Manage access profiles and permission sets across modules."})]})]})]}),n.jsxs(dt,{className:"rounded-3xl border-amber-200 bg-amber-50 shadow-sm",children:[n.jsx(gt,{children:n.jsx(jt,{className:"text-base font-semibold text-amber-900",children:"Access restricted"})}),n.jsx(it,{children:n.jsxs(ml,{className:"border-amber-200 bg-amber-50 text-amber-900 rounded-2xl",children:[n.jsx(hl,{className:"font-semibold",children:"You dont have permission"}),n.jsx(xl,{className:"text-sm",children:"Your role does not currently include access to the Roles module. Please contact the system administrator if you believe this is a mistake."})]})})]})]})}):n.jsxs("div",{className:"min-h-[calc(100vh-4rem)] bg-slate-50 px-4 py-5 md:px-8 md:py-8",children:[n.jsxs("div",{className:"space-y-4 md:space-y-5",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[n.jsx(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/80 px-3 py-1 text-[11px] font-semibold tracking-wide text-slate-700",children:"Admin  Roles & permissions"}),n.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-sm animate-pulse"}),n.jsx("span",{className:"hidden sm:inline",children:"Workspace"}),n.jsx("span",{className:"sm:hidden",children:"Responsive"})]})]}),n.jsx(mt.div,{...EC,children:n.jsxs("div",{className:$a(sa.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(13,148,136,0.18),_transparent_60%)]"}),n.jsxs("div",{className:"relative px-5 py-5 md:px-7 md:py-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/70 px-3 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-black/[0.04] border border-black/50",children:n.jsx(Ka,{className:"h-3.5 w-3.5 text-slate-700"})}),"Centralised access control"]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(ic,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"Roles & Permission Sets"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600 leading-relaxed",children:"Create roles and assign permissions grouped by module  faster review, easier audit."})]})]})]}),n.jsxs("div",{className:"w-full md:w-auto flex flex-col gap-2 items-start md:items-end",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:sa.chip,children:["Roles ",n.jsx("span",{className:"ml-1 tabular-nums",children:l.length})]}),n.jsxs("span",{className:sa.chip,children:["Permissions ",n.jsx("span",{className:"ml-1 tabular-nums",children:c.length})]})]}),r&&n.jsxs(ge,{type:"button",onClick:W,className:"rounded-2xl bg-blue-600 hover:bg-blue-700 text-white font-semibold",children:[n.jsx(ds,{className:"h-4 w-4 mr-2"}),"New role"]})]})]})]})}),y&&n.jsx(mt.div,{...EC,children:n.jsxs(ml,{className:"rounded-2xl border-red-200 bg-red-50 text-red-800",children:[n.jsx(hl,{className:"font-semibold text-sm",children:"Issue"}),n.jsx(xl,{className:"text-sm",children:y})]})}),n.jsx(mt.div,{...EC,children:n.jsxs(dt,{className:$a("rounded-3xl border-black/50 bg-white/75 backdrop-blur-xl"),children:[n.jsxs(gt,{className:"border-b border-black/50 pb-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Role list"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-600",children:"Search roles and open full-screen editor to manage permissions."})]}),n.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row sm:items-center sm:justify-end",children:[n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{type:"text",value:j,onChange:$=>w($.target.value),placeholder:"Search roles by name / description",className:$a(sa.input,"pl-10")})]}),r&&n.jsxs(ge,{type:"button",onClick:W,className:"rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",children:[n.jsx(ds,{className:"h-4 w-4 mr-2"}),"Create"]})]})]}),n.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:[{key:"all",label:"All"},{key:"withPerms",label:"With permissions"},{key:"noPerms",label:"No permissions"}].map($=>n.jsx("button",{type:"button",onClick:()=>E($.key),className:$a("inline-flex items-center rounded-full px-3 py-1.5 text-[11px] font-semibold transition border",S===$.key?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white/80 text-slate-700 border-black/50 hover:bg-black/[0.03]"),children:$.label},$.key))})]}),n.jsx(it,{className:"pt-5",children:u?n.jsx("div",{className:"space-y-2",children:[0,1,2,3].map($=>n.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-black/50 bg-white/70 px-4 py-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-3.5 w-1/3 rounded-full bg-slate-100"}),n.jsx(Qe,{className:"h-3 w-1/4 rounded-full bg-slate-100"})]}),n.jsx(Qe,{className:"h-9 w-28 rounded-2xl bg-slate-100"})]},$))}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"hidden md:block",children:n.jsx("div",{className:"overflow-x-auto rounded-3xl border border-black/50 bg-white/70",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-black/[0.02] text-[11px] font-semibold text-slate-600 uppercase tracking-wide",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 text-left",children:"#"}),n.jsx("th",{className:"p-3 text-left",children:"Role name"}),n.jsx("th",{className:"p-3 text-left",children:"Description"}),n.jsx("th",{className:"p-3 text-left",children:"Permissions"}),n.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),n.jsxs("tbody",{children:[H.map(($,K)=>{var le;return n.jsxs("tr",{className:"border-t border-black/5 text-slate-800 hover:bg-black/[0.02] transition-colors",children:[n.jsx("td",{className:"p-3 align-top text-slate-500",children:K+1}),n.jsx("td",{className:"p-3 align-top",children:n.jsx("div",{className:"font-semibold text-slate-900",children:$.name})}),n.jsx("td",{className:"p-3 align-top text-slate-600",children:n.jsx("span",{className:"line-clamp-2",children:$.description||""})}),n.jsx("td",{className:"p-3 align-top",children:(((le=$.permission_ids)==null?void 0:le.length)||0)===0?n.jsx("span",{className:"inline-flex items-center rounded-full bg-black/[0.03] px-3 py-1 text-[11px] font-semibold text-slate-700 border border-black/50",children:"No permissions"}):n.jsxs("span",{className:"inline-flex items-center rounded-full bg-teal-50 px-3 py-1 text-[11px] font-semibold text-teal-800 border border-teal-200",children:[$.permission_ids.length," permissions"]})}),n.jsx("td",{className:"p-3 align-top text-right",children:n.jsx("div",{className:"inline-flex gap-2",children:a&&n.jsx(ge,{type:"button",className:"h-9 rounded-2xl bg-slate-900 px-4 text-[12px] font-semibold text-white hover:bg-slate-800",onClick:()=>V($),children:"Edit"})})})]},$.id)}),!H.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"p-6",children:n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-5 py-7 text-center",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"No roles match your filters."}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Change search/filter or create a new role."})]})})})]})]})})}),n.jsxs("div",{className:"grid gap-3 md:hidden",children:[H.map(($,K)=>{var le;return n.jsxs("div",{className:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur px-4 py-4 shadow-[0_8px_24px_rgba(2,6,23,0.10)]",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-black/[0.04] border border-black/50 text-[11px] font-semibold text-slate-700",children:K+1}),n.jsx("div",{className:"font-semibold text-slate-900",children:$.name})]}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-600 line-clamp-2",children:$.description||"No description"})]}),n.jsx("div",{className:"text-right",children:n.jsxs("span",{className:$a(sa.pill,"tabular-nums"),children:[((le=$.permission_ids)==null?void 0:le.length)||0," perms"]})})]}),n.jsx("div",{className:"mt-3 flex items-center justify-end",children:a&&n.jsx("button",{type:"button",onClick:()=>V($),className:"inline-flex items-center rounded-full bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white hover:bg-slate-800",children:"Edit"})})]},$.id)}),!H.length&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-5 py-7 text-center",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"No roles match your filters."}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Change search/filter or create a new role."})]})]})]})})]})})]}),n.jsx(eye,{open:k,mode:I,canCreate:r,canUpdate:a,canDelete:i,onClose:R,onSave:F,onDelete:G,saving:x,form:T,setForm:B,perms:c})]})}function eye({open:t,mode:s,canCreate:r,canUpdate:a,canDelete:i,onClose:l,onSave:o,onDelete:c,saving:d,form:u,setForm:m,perms:x}){var oe,_e;const g=s==="edit"?!a:!r,[y,v]=p.useState(""),[j,w]=p.useState(!1),[S,E]=p.useState("all"),[k,A]=p.useState({}),[I,P]=p.useState(!0),[O,D]=p.useState(!0),T=p.useMemo(()=>Zbe(),[]),[B,U]=p.useState("");p.useEffect(()=>{t&&(v(""),w(!1),E("all"),A({}),P(!0),D(!0),U(""))},[t]);const W=p.useMemo(()=>{const xe=new Set((x||[]).map(Px));return Array.from(xe).sort((me,Re)=>me.localeCompare(Re))},[x]),V=p.useMemo(()=>{let xe=x||[];const me=y.toLowerCase().trim();if(me&&(xe=xe.filter(Re=>{const Ze=String(Re.code||"").toLowerCase();return`${String(Re.label||"").toLowerCase()} ${Ze}`.includes(me)})),S!=="all"&&(xe=xe.filter(Re=>Px(Re)===S)),j){const Re=new Set(u.permission_ids||[]);xe=xe.filter(Ze=>Re.has(Ze.id))}return[...xe].sort((Re,Ze)=>{const $e=Px(Re),fe=Px(Ze);if($e!==fe)return $e.localeCompare(fe);const Me=String(Re.label||""),Ae=String(Ze.label||"");return Me!==Ae?Me.localeCompare(Ae):String(Re.code||"").localeCompare(String(Ze.code||""))})},[x,y,S,j,u.permission_ids]),R=p.useMemo(()=>{const xe={};for(const me of V){const Re=Px(me);xe[Re]||(xe[Re]=[]),xe[Re].push(me)}return xe},[V]),F=p.useMemo(()=>new Set(u.permission_ids||[]),[u.permission_ids]),G=p.useMemo(()=>{const xe=new Map;for(const me of x||[]){const Re=Px(me);F.has(me.id)&&xe.set(Re,(xe.get(Re)||0)+1)}return Array.from(xe.entries()).sort((me,Re)=>Re[1]-me[1]).slice(0,12).map(([me,Re])=>({key:me,count:Re}))},[x,F]),H=!!y.trim(),$=xe=>{if(k[xe]!==void 0)return!!k[xe];const Re=(R[xe]||[]).filter(Ze=>F.has(Ze.id)).length;return H||Re>0},K=xe=>A(me=>({...me,[xe]:!$(xe)})),le=xe=>{m(me=>{const Re=new Set(me.permission_ids||[]);return Re.has(xe)?Re.delete(xe):Re.add(xe),{...me,permission_ids:Array.from(Re)}})},se=xe=>{const me=V.map(Re=>Re.id);m(Re=>{const Ze=new Set(Re.permission_ids||[]);return xe?me.forEach($e=>Ze.add($e)):me.forEach($e=>Ze.delete($e)),{...Re,permission_ids:Array.from(Ze)}})},J=(xe,me)=>{const Re=(R[xe]||[]).map(Ze=>Ze.id);m(Ze=>{const $e=new Set(Ze.permission_ids||[]);return me?Re.forEach(fe=>$e.add(fe)):Re.forEach(fe=>$e.delete(fe)),{...Ze,permission_ids:Array.from($e)}})},ie=(xe,me)=>(R[xe]||[]).filter(Ze=>Qbe(Ze.code,me)).map(Ze=>Ze.id),te=(xe,me)=>{const Re=ie(xe,me);Re.length&&m(Ze=>{const $e=new Set(Ze.permission_ids||[]);return Re.filter(Ae=>$e.has(Ae)).length!==Re.length?Re.forEach(Ae=>$e.add(Ae)):Re.forEach(Ae=>$e.delete(Ae)),{...Ze,permission_ids:Array.from($e)}})},ne=(xe,me)=>{const Re=ie(xe,me);if(!Re.length)return{state:"none",disabled:!0};const Ze=Re.filter($e=>F.has($e)).length;return Ze===0?{state:"none",disabled:!1}:Ze===Re.length?{state:"all",disabled:!1}:{state:"some",disabled:!1}},q=()=>{const xe={};Object.keys(R).forEach(me=>xe[me]=!0),A(xe)},ee=()=>{const xe={};Object.keys(R).forEach(me=>xe[me]=!1),A(xe)},X=xe=>{E(xe),A(me=>({...me,[xe]:!0}))},Z=xe=>{if(g)return;const me=T[xe];if(!me)return;const Re=(x||[]).filter(Ze=>me.pick(Ze)).map(Ze=>Ze.id);m(Ze=>({...Ze,permission_ids:Array.from(new Set([...Ze.permission_ids||[],...Re]))})),U(xe)},Y=()=>{g||m(xe=>({...xe,permission_ids:[]}))},Q=s==="edit"?"Edit role":"Create new role";return n.jsx(on,{children:t&&n.jsxs(mt.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[n.jsx("div",{className:"absolute inset-0 bg-black/35 backdrop-blur-[2px]",onClick:l}),n.jsx(mt.div,{className:"absolute inset-0 bg-white",initial:{y:18,opacity:0,scale:.995},animate:{y:0,opacity:1,scale:1},exit:{y:18,opacity:0,scale:.995},transition:{type:"spring",stiffness:260,damping:26},children:n.jsxs("div",{className:"h-full flex flex-col min-h-0",children:[n.jsx("div",{className:"sticky top-0 z-30 border-b border-black/50 bg-white/80 backdrop-blur-xl",children:n.jsxs("div",{className:"px-4 md:px-8 py-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsx("div",{className:"min-w-0",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-black/[0.04] border border-black/50",children:n.jsx(ic,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[16px] md:text-[18px] font-semibold text-slate-900 tracking-tight",children:Q}),n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-500",children:"Permissions are grouped by module for fast review."})]})]})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{type:"button",onClick:()=>P(xe=>!xe),className:"h-10 px-3 rounded-2xl border border-black/50 bg-white/85 text-[12px] font-semibold text-slate-700 hover:bg-black/[0.03] inline-flex items-center gap-2",disabled:g,title:"Toggle role details",children:[n.jsx(Gn,{className:$a("h-4 w-4 transition",I?"rotate-0":"-rotate-90")}),"Details"]}),n.jsxs("button",{type:"button",onClick:()=>D(xe=>!xe),className:"h-10 px-3 rounded-2xl border border-black/50 bg-white/85 text-[12px] font-semibold text-slate-700 hover:bg-black/[0.03] inline-flex items-center gap-2",disabled:g,title:"Toggle permission filters",children:[n.jsx(Gn,{className:$a("h-4 w-4 transition",O?"rotate-0":"-rotate-90")}),"Filters"]}),s==="edit"&&i&&n.jsxs(ge,{type:"button",variant:"outline",onClick:c,className:"rounded-2xl border-rose-200 bg-rose-50 text-rose-700 hover:bg-rose-100",children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"}),"Delete"]}),n.jsxs(ge,{type:"button",onClick:l,variant:"outline",className:"rounded-2xl",children:[n.jsx(ts,{className:"h-4 w-4 mr-2"}),"Close"]}),n.jsx(ge,{type:"button",onClick:o,disabled:d||g,className:"rounded-2xl bg-blue-600 hover:bg-blue-700",children:d?"Saving":s==="edit"?"Update role":"Create role"})]})]}),n.jsx(on,{initial:!1,children:I?n.jsx(mt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.18},children:n.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-[11px] font-semibold text-slate-600",children:["Role name ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx(Ee,{value:u.name,onChange:xe=>m(me=>({...me,name:xe.target.value})),placeholder:"e.g., OPD Doctor, IPD Nurse",disabled:g,className:"h-11 rounded-2xl border-black/50 bg-white/85",required:!0})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Description"}),n.jsx(Ee,{value:u.description,onChange:xe=>m(me=>({...me,description:xe.target.value})),placeholder:"Optional short description",disabled:g,className:"h-11 rounded-2xl border-black/50 bg-white/85"})]})]})},"details-open"):n.jsx(mt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.18},className:"mt-4",children:n.jsxs("div",{className:"rounded-2xl border border-black/50 bg-black/[0.02] px-3 py-2 text-[12px] text-slate-700 flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"font-semibold",children:"Role:"}),n.jsx("span",{className:"font-semibold text-slate-900",children:(oe=u.name)!=null&&oe.trim()?u.name:"Untitled role"}),((_e=u.description)==null?void 0:_e.trim())&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-slate-400",children:""}),n.jsx("span",{className:"text-slate-600 line-clamp-1",children:u.description})]})]})},"details-closed")}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:sa.chip,children:["Selected"," ",n.jsx("span",{className:"ml-1 tabular-nums",children:(u.permission_ids||[]).length})]}),n.jsxs("span",{className:sa.chip,children:["Visible"," ",n.jsx("span",{className:"ml-1 tabular-nums",children:V.length})]}),n.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[n.jsxs("button",{type:"button",onClick:q,className:sa.chipBtn,disabled:g,children:[n.jsx(Gn,{className:"h-4 w-4"}),"Expand all"]}),n.jsxs("button",{type:"button",onClick:ee,className:sa.chipBtn,disabled:g,children:[n.jsx(Ti,{className:"h-4 w-4"}),"Collapse all"]}),n.jsxs("button",{type:"button",onClick:()=>se(!0),className:sa.chipBtn,disabled:g||V.length===0,children:[n.jsx(cC,{className:"h-4 w-4"}),"Select visible"]}),n.jsxs("button",{type:"button",onClick:()=>se(!1),className:sa.chipBtn,disabled:g||V.length===0,children:[n.jsx(d1,{className:"h-4 w-4"}),"Clear visible"]}),n.jsxs("button",{type:"button",onClick:Y,className:sa.chipBtn,disabled:g||(u.permission_ids||[]).length===0,children:[n.jsx(d1,{className:"h-4 w-4"}),"Clear all"]})]})]}),n.jsx(on,{initial:!1,children:O?n.jsxs(mt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.18},className:"mt-3",children:[n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-semibold text-slate-500",children:[n.jsx($n,{className:"h-4 w-4"}),"Quick presets (adaptive)"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(T).map(([xe,me])=>n.jsxs("button",{type:"button",onClick:()=>Z(xe),className:$a("inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",B===xe?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white/85 text-slate-700 border-black/50 hover:bg-black/[0.03]"),disabled:g,title:me.description,children:[n.jsx($n,{className:"h-4 w-4"}),me.label]},xe))})]}),G.length>0&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[n.jsxs("span",{className:"text-[11px] font-semibold text-slate-500 inline-flex items-center gap-2",children:[n.jsx(Co,{className:"h-4 w-4"}),"Jump to selected modules:"]}),G.map(xe=>n.jsxs("button",{type:"button",onClick:()=>X(xe.key),className:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700 hover:bg-black/[0.03]",disabled:g,title:"Jump / filter to module",children:[g1(xe.key),n.jsx("span",{className:"rounded-full bg-black/[0.05] px-2 py-0.5 tabular-nums",children:xe.count})]},xe.key))]}),n.jsx("div",{className:$a(sa.glassSoft,"p-3 mt-3"),children:n.jsxs("div",{className:"grid gap-2 lg:grid-cols-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{className:$a(sa.input,"pl-10"),value:y,onChange:xe=>v(xe.target.value),placeholder:"Search permissions by label or code",disabled:g})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-end",children:[n.jsxs("button",{type:"button",onClick:()=>w(xe=>!xe),className:$a("h-10 px-3 rounded-2xl border border-black/50 bg-white/85 text-[12px] font-semibold text-slate-700 hover:bg-black/[0.03] inline-flex items-center gap-2",j&&"bg-black/[0.04]"),disabled:g,children:[j?n.jsx(cC,{className:"h-4 w-4"}):n.jsx(d1,{className:"h-4 w-4"}),"Selected only"]}),n.jsxs("select",{className:$a(sa.input,"h-10"),value:S,onChange:xe=>E(xe.target.value),disabled:g,children:[n.jsx("option",{value:"all",children:"All modules"}),W.map(xe=>n.jsx("option",{value:xe,children:g1(xe)},xe))]})]})]})})]},"filters-open"):n.jsx(mt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.18},className:"mt-3",children:n.jsx("div",{className:"rounded-2xl border border-black/50 bg-black/[0.02] px-3 py-2 text-[12px] text-slate-700",children:"Filters collapsed."})},"filters-closed")})]})}),n.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto px-4 md:px-8 py-4",children:[V.length===0?n.jsxs("div",{className:$a(sa.glass,"p-8 text-center"),children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] border border-black/50 grid place-items-center",children:n.jsx(ic,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:"No permissions match"}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Adjust search, module filter, or disable Selected only."})]}):n.jsx("div",{className:"space-y-3",children:Object.keys(R).sort((xe,me)=>xe.localeCompare(me)).map(xe=>{const me=R[xe]||[],Re=me.filter(Me=>F.has(Me.id)).length,Ze=me.length,$e=$(xe),fe=["view","create","update","delete"];return n.jsxs("div",{className:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur overflow-hidden shadow-[0_10px_28px_rgba(2,6,23,0.10)]",children:[n.jsxs("button",{type:"button",onClick:()=>K(xe),className:"w-full px-4 py-3 border-b border-black/50 bg-white/70 text-left",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900 truncate",children:g1(xe)}),n.jsxs("span",{className:sa.pill,children:[n.jsx("span",{className:"tabular-nums",children:Re}),"/",Ze]})]}),n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-500",children:"Module permissions"})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("div",{className:$a("h-9 w-9 rounded-full border border-black/50 bg-white/85 grid place-items-center",$e&&"bg-black/[0.03]"),children:n.jsx(Ti,{className:$a("h-4 w-4 text-slate-600 transition",$e&&"rotate-90")})})})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("button",{type:"button",onClick:Me=>{Me.preventDefault(),Me.stopPropagation(),J(xe,!0)},className:sa.chipBtn,disabled:g,children:[n.jsx(cC,{className:"h-4 w-4"}),"Select module"]}),n.jsxs("button",{type:"button",onClick:Me=>{Me.preventDefault(),Me.stopPropagation(),J(xe,!1)},className:sa.chipBtn,disabled:g,children:[n.jsx(d1,{className:"h-4 w-4"}),"Clear module"]}),n.jsx("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:fe.map(Me=>{const Ae=ne(xe,Me);return n.jsx(tye,{label:g1(Me),state:Ae.state,disabled:g||Ae.disabled,onClick:Ke=>{Ke.stopPropagation(),te(xe,Me)}},Me)})})]})]}),$e&&n.jsx("div",{className:"p-3 sm:p-4",children:n.jsx("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4",children:me.map(Me=>{const Ae=F.has(Me.id);return n.jsxs("label",{className:$a("flex items-start gap-2 rounded-2xl border border-black/50 bg-white/85 px-3 py-2 transition",Ae&&"shadow-[0_6px_18px_rgba(2,6,23,0.10)]"),children:[n.jsx("input",{type:"checkbox",checked:Ae,onChange:()=>le(Me.id),disabled:g,className:"mt-0.5 h-4 w-4 rounded border-slate-300 text-teal-600"}),n.jsxs("span",{className:"min-w-0",children:[n.jsx("span",{className:"block text-[13px] font-semibold text-slate-900 leading-snug",children:M6(Me.label||"Permission",y)}),n.jsx("span",{className:"block text-[11px] text-slate-500 font-mono break-all",children:M6(Me.code||"",y)})]})]},Me.id)})})})]},xe)})}),n.jsx("div",{className:"h-10"})]})]})})]})})}function tye({label:t,state:s,disabled:r,onClick:a}){const i="inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold border transition",l=s==="all"?"bg-emerald-600 text-white border-emerald-600":s==="some"?"bg-amber-50 text-amber-800 border-amber-200":"bg-white/85 text-slate-700 border-black/50 hover:bg-black/[0.03]";return n.jsx("button",{type:"button",onClick:a,disabled:r,className:$a(i,l,r&&"opacity-50 cursor-not-allowed"),title:s==="all"?"All selected":s==="some"?"Partially selected":"None selected",children:t})}const TC={initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18}};function sye(){const{hasAny:t,canView:s,canCreate:r,canUpdate:a,canDelete:i}=m2("users"),[l,o]=p.useState([]),[c,d]=p.useState([]),[u,m]=p.useState([]),[x,g]=p.useState({name:"",email:"",password:"",department_id:"",role_ids:[],is_doctor:!1,is_active:!0}),[y,v]=p.useState(null),[j,w]=p.useState(!1),[S,E]=p.useState(!1),[k,A]=p.useState(""),[I,P]=p.useState("all"),[O,D]=p.useState(""),[T,B]=p.useState(!1),U=y?a:r,W=p.useCallback(async()=>{var te,ne,q;if(s){A(""),E(!0);try{const[ee,X,Z]=await Promise.all([he.get("/users/"),he.get("/roles/").catch(()=>({data:[]})),he.get("/departments/").catch(()=>({data:[]}))]);o(ee.data||[]),d(X.data||[]),m(Z.data||[])}catch(ee){const X=(te=ee==null?void 0:ee.response)==null?void 0:te.status;A(X===403?"Access denied for Users.":X===401?"Session expired. Please login again.":((q=(ne=ee==null?void 0:ee.response)==null?void 0:ne.data)==null?void 0:q.detail)||"Failed to load users.")}finally{E(!1)}}},[s]);p.useEffect(()=>{W()},[W]);const V=p.useMemo(()=>{const te={};return u.forEach(ne=>{te[ne.id]=ne.name}),te},[u]),R=te=>{g(ne=>({...ne,role_ids:ne.role_ids.includes(te)?ne.role_ids.filter(q=>q!==te):[...ne.role_ids,te]}))},F=()=>{g({name:"",email:"",password:"",department_id:"",role_ids:[],is_doctor:!1,is_active:!0}),v(null)},G=()=>{F(),B(!0)},H=te=>{a&&(v(te.id),g({name:te.name||"",email:te.email||"",password:"",department_id:te.department_id||"",role_ids:te.role_ids||[],is_doctor:!!te.is_doctor,is_active:te.is_active??!0}),B(!0))},$=()=>{B(!1)},K=async te=>{var q,ee,X;if(te.preventDefault(),!y&&!r||y&&!a)return;w(!0),A("");const ne={...x,department_id:x.department_id?Number(x.department_id):null};try{y?await he.put(`/users/${y}`,ne):await he.post("/users/",ne),F(),B(!1),W()}catch(Z){const Y=(q=Z==null?void 0:Z.response)==null?void 0:q.status;A(Y===403?"Access denied.":Y===401?"Session expired. Please login again.":((X=(ee=Z==null?void 0:Z.response)==null?void 0:ee.data)==null?void 0:X.detail)||"Failed to save user.")}finally{w(!1)}},le=async te=>{var ne,q,ee;if(i&&window.confirm("Delete this user?"))try{await he.delete(`/users/${te}`),W()}catch(X){const Z=(ne=X==null?void 0:X.response)==null?void 0:ne.status;A(Z===403?"Access denied.":Z===401?"Session expired. Please login again.":((ee=(q=X==null?void 0:X.response)==null?void 0:q.data)==null?void 0:ee.detail)||"Failed to delete user.")}},se=p.useMemo(()=>l.filter(te=>te.is_doctor).length,[l]),J=p.useMemo(()=>l.filter(te=>te.is_active).length,[l]),ie=p.useMemo(()=>{let te=l;if(I==="doctors"&&(te=te.filter(ne=>ne.is_doctor)),O.trim()){const ne=O.toLowerCase();te=te.filter(q=>(q.name||"").toLowerCase().includes(ne)||(q.email||"").toLowerCase().includes(ne))}return te},[l,I,O]);return!t||!s?n.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-slate-50 px-3 py-4 md:px-6 md:py-6 lg:px-8",children:n.jsxs("div",{className:"mx-auto max-w-6xl space-y-4",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-teal-700 via-teal-600 to-blue-600 text-white shadow-md",children:[n.jsx("div",{className:"absolute inset-0 opacity-25 bg-[radial-gradient(circle_at_top,_#e0f2fe,_transparent_55%)]"}),n.jsxs("div",{className:"relative px-5 py-6 sm:px-7 sm:py-7 md:px-9 md:py-8 flex items-center gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-white/10 border border-white/20",children:n.jsx(uc,{className:"w-6 h-6"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg md:text-xl font-semibold tracking-tight",children:"Users & Doctors"}),n.jsx("p",{className:"mt-1 text-xs sm:text-sm text-teal-50/90",children:"Centralised staff management for OPD, IPD, diagnostics and support."})]})]})]}),n.jsxs(dt,{className:"rounded-3xl border-amber-200 bg-amber-50 shadow-sm",children:[n.jsx(gt,{children:n.jsx(jt,{className:"text-base text-amber-900",children:"Access restricted"})}),n.jsx(it,{children:n.jsxs(ml,{className:"border-amber-200 bg-amber-50 text-amber-900 rounded-2xl",children:[n.jsx(hl,{className:"font-semibold",children:"You dont have permission"}),n.jsx(xl,{className:"text-sm",children:"You dont have permission to view the Users module. Contact your administrator for access."})]})})]})]})}):n.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-slate-50 px-3 py-4 md:px-6 md:py-6 lg:px-8",children:n.jsxs("div",{className:"mx-auto max-w-6xl space-y-4 md:space-y-5 lg:space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-xs",children:[n.jsx(et,{variant:"outline",className:"rounded-full border-slate-500 bg-white px-2.5 py-1 text-[11px] font-medium tracking-wide text-slate-700",children:"Admin  User management"}),n.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-sm animate-pulse"}),n.jsx("span",{className:"hidden sm:inline",children:"Desktop workspace"}),n.jsx("span",{className:"sm:hidden",children:"Responsive view"})]})]}),n.jsx(mt.div,{...TC,children:n.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-teal-700 via-teal-600 to-blue-600 text-white shadow-md",children:[n.jsx("div",{className:"absolute inset-0 opacity-25 bg-[radial-gradient(circle_at_top,_#e0f2fe,_transparent_55%)]"}),n.jsxs("div",{className:"relative flex flex-col gap-4 md:flex-row md:items-center md:justify-between px-4 py-5 sm:px-6 sm:py-6 md:px-8 md:py-7 lg:px-10 lg:py-8",children:[n.jsxs("div",{className:"space-y-3 max-w-xl",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-medium backdrop-blur-sm border border-white/20",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/20 text-[11px]",children:n.jsx(uc,{className:"w-3.5 h-3.5"})}),"Staff & access directory"]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 md:h-12 md:w-12 items-center justify-center rounded-3xl bg-white/10 text-white shadow-sm border border-white/20",children:n.jsx(dR,{className:"w-6 h-6"})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-semibold tracking-tight",children:"Users & Doctors Management"}),n.jsxs("p",{className:"text-sm md:text-base text-teal-50/90 leading-relaxed",children:["Create staff accounts, map them to"," ",n.jsx("span",{className:"font-semibold",children:"departments"}),", attach"," ",n.jsx("span",{className:"font-semibold",children:"roles"})," and mark doctors for OPD/IPD routing."]})]})]})]}),n.jsxs("div",{className:"w-full md:w-auto space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap gap-2 justify-start md:justify-end",children:[n.jsx(et,{className:"bg-white/15 text-xs font-semibold border border-white/25 text-white rounded-full px-3 py-1",children:"Multi-module access"}),n.jsx(et,{className:"bg-white/10 text-xs border border-white/20 text-teal-50 rounded-full px-3 py-1",children:"OPD / IPD ready"})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2 md:min-w-[260px]",children:[n.jsx(PC,{label:"Total users",value:l.length}),n.jsx(PC,{label:"Doctors",value:se}),n.jsx(PC,{label:"Active users",value:J})]})]})]})]})}),k&&n.jsx(mt.div,{...TC,children:n.jsxs(ml,{className:"rounded-2xl border-red-200 bg-red-50 text-red-800",children:[n.jsx(hl,{className:"font-semibold",children:"Issue"}),n.jsx(xl,{className:"text-sm",children:k})]})}),n.jsx(mt.div,{...TC,children:n.jsxs(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm",children:[n.jsxs(gt,{className:"border-b border-slate-100 pb-3",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-sm sm:text-base font-semibold text-slate-900",children:"User directory"}),n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:[ie.length," of ",l.length," records visible in this view."]})]}),n.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row sm:items-center sm:justify-end",children:[n.jsxs("div",{className:"relative w-full sm:w-60",children:[n.jsx(Yt,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-slate-400"}),n.jsx("input",{type:"text",value:O,onChange:te=>D(te.target.value),placeholder:"Search by name or email",className:"w-full rounded-xl border border-slate-500 bg-slate-50 pl-8 pr-3 py-1.5 text-xs sm:text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"})]}),r&&n.jsxs(ge,{type:"button",onClick:G,className:"inline-flex items-center justify-center gap-1.5 rounded-full bg-blue-600 px-3 py-1.5 text-xs sm:text-sm font-semibold text-white hover:bg-blue-700 active:scale-95",children:[n.jsx(dR,{className:"w-3.5 h-3.5"}),"New user"]})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-2.5 py-1 text-[10px] font-medium text-slate-600",children:[n.jsx(jr,{className:"h-3 w-3"}),n.jsx("span",{children:"Filter"})]}),n.jsx("button",{type:"button",onClick:()=>P("all"),className:`inline-flex items-center rounded-full px-3 py-1 text-[11px] sm:text-xs transition ${I==="all"?"bg-blue-600 text-white shadow-sm":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:"All users"}),n.jsxs("button",{type:"button",onClick:()=>P("doctors"),className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] sm:text-xs transition ${I==="doctors"?"bg-blue-600 text-white shadow-sm":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:[n.jsx(Hs,{className:"h-3.5 w-3.5"}),"Doctors only"]})]})]}),n.jsx(it,{className:"pt-4",children:S?n.jsx(rye,{}):ie.length===0?n.jsx(nye,{title:"No users match this view"}):n.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:ie.map((te,ne)=>{const q=c.filter(X=>(te.role_ids||[]).includes(X.id)).map(X=>X.name),ee=(te.name||"?").split(" ").map(X=>X[0]).join("").slice(0,2).toUpperCase();return n.jsxs(mt.div,{whileHover:{y:-2,scale:1.01},transition:{duration:.15,ease:"easeOut"},className:"flex flex-col justify-between rounded-2xl border border-slate-500 bg-slate-50 px-3.5 py-3.5 shadow-sm",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-start gap-2.5",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"h-9 w-9 rounded-full bg-slate-200 flex items-center justify-center text-xs font-semibold text-slate-800",children:ee}),te.is_doctor&&n.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-emerald-500 ring-2 ring-slate-50"})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:te.name}),n.jsx("div",{className:"text-[11px] text-slate-500",children:q.length?q.join(", "):"No roles"})]})]}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[te.is_active?n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-semibold text-emerald-700",children:"ACTIVE"}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",children:"INACTIVE"}),te.is_admin&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-2 py-0.5 text-[10px] font-semibold text-white",children:"ADMIN"}),te.is_doctor&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-0.5 text-[10px] font-semibold text-sky-700",children:[n.jsx(Hs,{className:"h-3 w-3"}),"DOCTOR"]})]})]}),n.jsxs("div",{className:"mt-3 space-y-1.5 text-[11px] text-slate-600",children:[n.jsxs("div",{className:"flex justify-between gap-2",children:[n.jsx("span",{className:"text-slate-400",children:"DEPARTMENT"}),n.jsx("span",{className:"font-medium text-slate-700",children:V[te.department_id]||"-"})]}),n.jsxs("div",{className:"flex justify-between gap-2",children:[n.jsx("span",{className:"text-slate-400",children:"EMAIL"}),n.jsx("span",{className:"max-w-[60%] truncate text-right",children:te.email})]})]}),n.jsxs("div",{className:"mt-3 flex justify-between gap-2",children:[a&&n.jsx(ge,{type:"button",variant:"outline",size:"sm",className:"flex-1 h-8 rounded-full border-slate-500 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",onClick:()=>H(te),children:"Edit"}),i&&n.jsx(ge,{type:"button",variant:"outline",size:"sm",className:"flex-1 h-8 rounded-full border border-rose-200 text-[11px] font-semibold text-rose-700 hover:bg-rose-50",onClick:()=>le(te.id),children:"Delete"})]})]},te.id)})})})]})}),n.jsx(on,{children:T&&n.jsx(aye,{isOpen:T,onClose:$,onSubmit:K,form:x,setForm:g,depts:u,roles:c,canEditOrCreate:U,loadingSave:j,editId:y,toggleRole:R})})]})})}function PC({label:t,value:s}){return n.jsxs(mt.div,{whileHover:{y:-2,scale:1.01},transition:{type:"spring",stiffness:240,damping:22},className:"rounded-2xl border border-white/40 bg-white/10 px-3 py-2 text-[11px] text-teal-50/90",children:[n.jsx("div",{className:"text-[10px] font-medium uppercase tracking-wide text-teal-100/90",children:t}),n.jsx("div",{className:"mt-1 text-sm font-semibold text-white",children:s})]})}function nye({title:t}){return n.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-300 bg-slate-50 px-4 py-5 text-center",children:[n.jsx("p",{className:"text-sm font-semibold text-slate-700",children:t}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Try changing filters, clearing the search, or creating a new user."})]})}function rye(){return n.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:[0,1,2,3,4,5].map(t=>n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3.5 py-3.5 shadow-sm",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Qe,{className:"h-9 w-9 rounded-full bg-slate-100"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-3 w-1/2 rounded-full bg-slate-100"}),n.jsx(Qe,{className:"h-2.5 w-2/3 rounded-full bg-slate-100"})]})]}),n.jsxs("div",{className:"mt-3 space-y-2",children:[n.jsx(Qe,{className:"h-2.5 w-full rounded-full bg-slate-100"}),n.jsx(Qe,{className:"h-2.5 w-5/6 rounded-full bg-slate-100"})]}),n.jsxs("div",{className:"mt-3 flex gap-2",children:[n.jsx(Qe,{className:"h-8 w-full rounded-full bg-slate-100"}),n.jsx(Qe,{className:"h-8 w-full rounded-full bg-slate-100"})]})]},t))})}function aye({isOpen:t,onClose:s,onSubmit:r,form:a,setForm:i,depts:l,roles:o,canEditOrCreate:c,loadingSave:d,editId:u,toggleRole:m}){if(!t)return null;const x=g=>{g.target===g.currentTarget&&s()};return n.jsx(mt.div,{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onMouseDown:x,children:n.jsxs(mt.div,{onMouseDown:g=>g.stopPropagation(),initial:{y:40,opacity:0},animate:{y:0,opacity:1},exit:{y:40,opacity:0},transition:{duration:.2,ease:"easeOut"},className:"w-full sm:max-w-lg bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl max-h-[90vh] overflow-y-auto px-4 py-4 sm:px-6 sm:py-5",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2 border-b border-slate-100 pb-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("h2",{className:"text-base sm:text-lg font-semibold text-slate-900",children:u?"Edit user":"Add new user"}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"Fill basic details, map department and attach roles."})]}),n.jsx("button",{type:"button",onClick:s,className:"inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-500 bg-white text-slate-500 hover:bg-slate-100",children:n.jsx(ts,{className:"h-3.5 w-3.5"})})]}),n.jsxs("form",{onSubmit:r,className:"mt-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-2",children:[n.jsx(Ee,{placeholder:"Full name",value:a.name,onChange:g=>i({...a,name:g.target.value}),required:!0,disabled:!c,className:"h-9 rounded-xl border-slate-500 bg-slate-50 text-sm text-slate-900 focus-visible:ring-2 focus-visible:ring-teal-100 focus-visible:border-teal-500"}),n.jsx(Ee,{placeholder:"Email",type:"email",value:a.email,onChange:g=>i({...a,email:g.target.value}),required:!0,disabled:!c,className:"h-9 rounded-xl border-slate-500 bg-slate-50 text-sm text-slate-900 focus-visible:ring-2 focus-visible:ring-teal-100 focus-visible:border-teal-500"})]}),n.jsx(Ee,{placeholder:u?"Password (leave blank to keep)":"Password",type:"password",value:a.password,onChange:g=>i({...a,password:g.target.value}),required:!u,disabled:!c,className:"h-9 rounded-xl border-slate-500 bg-slate-50 text-sm text-slate-900 focus-visible:ring-2 focus-visible:ring-teal-100 focus-visible:border-teal-500"}),n.jsxs("div",{className:"space-y-1 text-xs",children:[n.jsx("label",{className:"font-medium text-slate-700",children:"Department"}),n.jsxs("select",{value:a.department_id,onChange:g=>i({...a,department_id:g.target.value}),disabled:!c,className:"h-9 w-full rounded-xl border border-slate-500 bg-slate-50 px-2 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500",children:[n.jsx("option",{value:"",children:"No department"}),l.map(g=>n.jsx("option",{value:g.id,children:g.name},g.id))]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[n.jsxs("label",{className:`inline-flex flex-1 min-w-[150px] cursor-pointer items-center gap-2 rounded-2xl border px-3 py-2 transition-colors ${a.is_doctor?"border-emerald-300 bg-emerald-50":"border-slate-500 bg-white hover:bg-slate-50"}`,children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300",checked:a.is_doctor,onChange:g=>i({...a,is_doctor:g.target.checked}),disabled:!c}),n.jsxs("span",{className:"inline-flex items-center gap-1 text-slate-700",children:[n.jsx(Hs,{className:"h-3.5 w-3.5 text-emerald-600"}),n.jsx("span",{children:"Mark as doctor"})]})]}),n.jsxs("label",{className:`inline-flex flex-1 min-w-[150px] cursor-pointer items-center gap-2 rounded-2xl border px-3 py-2 transition-colors ${a.is_active?"border-slate-300 bg-slate-50":"border-slate-500 bg-white hover:bg-slate-50"}`,children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300",checked:a.is_active,onChange:g=>i({...a,is_active:g.target.checked}),disabled:!c}),n.jsxs("span",{className:"inline-flex items-center gap-1 text-slate-700",children:[n.jsx(Ka,{className:"h-3.5 w-3.5 text-slate-700"}),n.jsx("span",{children:"Active user"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[n.jsx("span",{className:"font-medium text-slate-700",children:"Roles"}),n.jsxs("span",{className:"text-slate-400",children:[a.role_ids.length||0," selected"]})]}),n.jsxs("div",{className:"grid gap-1.5 sm:grid-cols-2 max-h-44 overflow-y-auto rounded-2xl border border-slate-100 bg-slate-50 px-2 py-2",children:[o.map(g=>n.jsxs("label",{className:`flex cursor-pointer items-center gap-2 rounded-2xl border px-2.5 py-2 text-[11px] transition-colors ${a.role_ids.includes(g.id)?"border-slate-300 bg-white":"border-slate-500 bg-slate-50 hover:bg-white"}`,children:[n.jsx("input",{type:"checkbox",checked:a.role_ids.includes(g.id),onChange:()=>m(g.id),disabled:!c,className:"h-3.5 w-3.5 rounded border-slate-300"}),n.jsx("span",{className:"text-slate-800",children:g.name})]},g.id)),!o.length&&n.jsx("div",{className:"rounded-2xl border border-dashed border-slate-300 bg-slate-50 px-3 py-2 text-[11px] text-slate-500",children:"No roles configured yet."})]})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2 pt-2 border-t border-slate-100",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-full border-slate-500 text-xs sm:text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:s,children:"Cancel"}),n.jsx(ge,{type:"submit",className:"rounded-full bg-blue-600 px-4 py-2 text-xs sm:text-sm font-semibold text-white hover:bg-blue-700 active:scale-95",disabled:d||!c,children:d?"Saving":u?"Update user":"Create user"})]})]})]})})}function iye(){const{hasAny:t,canView:s,canCreate:r,canUpdate:a,canDelete:i}=m2("permissions"),[l,o]=p.useState([]),[c,d]=p.useState({code:"",label:"",module:""}),[u,m]=p.useState(null),[x,g]=p.useState(!1),[y,v]=p.useState(""),j=p.useCallback(async()=>{var k,A,I;if(s){v("");try{const P=await he.get("/permissions/");o(P.data),console.log("============================================="),console.log(P.data),console.log("=============================================")}catch(P){const O=(k=P==null?void 0:P.response)==null?void 0:k.status;v(O===403?"Access denied for Permissions.":O===401?"Session expired. Please login again.":((I=(A=P==null?void 0:P.response)==null?void 0:A.data)==null?void 0:I.detail)||"Failed to load")}}},[s]);p.useEffect(()=>{j()},[j]);const w=async k=>{var A,I;if(k.preventDefault(),!(!u&&!r)&&!(u&&!a)){g(!0),v("");try{u?await he.put(`/permissions/${u}`,c):await he.post("/permissions/",c),d({code:"",label:"",module:""}),m(null),j()}catch(P){v(((I=(A=P==null?void 0:P.response)==null?void 0:A.data)==null?void 0:I.detail)||"Failed to save")}finally{g(!1)}}},S=async k=>{var A,I;if(i&&confirm("Delete this permission?"))try{await he.delete(`/permissions/${k}`),j()}catch(P){v(((I=(A=P==null?void 0:P.response)==null?void 0:A.data)==null?void 0:I.detail)||"Failed to delete")}},E=k=>{a&&(m(k.id),d({code:k.code,label:k.label,module:k.module}))};return!t||!s?n.jsxs("section",{className:"card",children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Permissions"}),n.jsx("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-700",children:"You dont have access to view this module."})]}):n.jsxs("section",{className:"card text-black",children:[n.jsx("div",{className:"flex items-center justify-between mb-4",children:n.jsx("h3",{className:"text-lg font-semibold",children:"Permissions"})}),n.jsxs("form",{onSubmit:w,className:"grid md:grid-cols-4 gap-3 mb-4",children:[n.jsx("input",{className:"input",placeholder:"code (e.g. users.view)",value:c.code,onChange:k=>d({...c,code:k.target.value}),required:!0,disabled:!(u?a:r)}),n.jsx("input",{className:"input",placeholder:"label (Users  View)",value:c.label,onChange:k=>d({...c,label:k.target.value}),required:!0,disabled:!(u?a:r)}),n.jsx("input",{className:"input",placeholder:"module (users)",value:c.module,onChange:k=>d({...c,module:k.target.value}),required:!0,disabled:!(u?a:r)}),n.jsx("button",{className:"btn",disabled:x||(u?!a:!r),children:u?"Update":"Create"})]}),y&&n.jsx("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:y}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"text-left",children:[n.jsx("th",{className:"p-2",children:"#"}),n.jsx("th",{className:"p-2",children:"Code"}),n.jsx("th",{className:"p-2",children:"Label"}),n.jsx("th",{className:"p-2",children:"Module"}),n.jsx("th",{className:"p-2 text-right",children:"Actions"})]})}),n.jsxs("tbody",{children:[l.map((k,A)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"p-2",children:A+1}),n.jsx("td",{className:"p-2 font-mono text-xs",children:k.code}),n.jsx("td",{className:"p-2",children:k.label}),n.jsx("td",{className:"p-2",children:k.module}),n.jsxs("td",{className:"p-2 text-right space-x-2",children:[a&&n.jsx("button",{className:"px-3 py-2 rounded-xl border",onClick:()=>E(k),children:"Edit"}),i&&n.jsx("button",{className:"px-3 py-2 rounded-xl border",onClick:()=>S(k.id),children:"Delete"})]})]},k.id)),!l.length&&n.jsx("tr",{children:n.jsx("td",{className:"p-4 text-sm text-gray-500",colSpan:"5",children:"No permissions yet."})})]})]})})]})}function zt(t,s,{checkForDefaultPrevented:r=!0}={}){return function(i){if(t==null||t(i),r===!1||!i.defaultPrevented)return s==null?void 0:s(i)}}function lye(t,s){const r=p.createContext(s),a=l=>{const{children:o,...c}=l,d=p.useMemo(()=>c,Object.values(c));return n.jsx(r.Provider,{value:d,children:o})};a.displayName=t+"Provider";function i(l){const o=p.useContext(r);if(o)return o;if(s!==void 0)return s;throw new Error(`\`${l}\` must be used within \`${t}\``)}return[a,i]}function fc(t,s=[]){let r=[];function a(l,o){const c=p.createContext(o),d=r.length;r=[...r,o];const u=x=>{var S;const{scope:g,children:y,...v}=x,j=((S=g==null?void 0:g[t])==null?void 0:S[d])||c,w=p.useMemo(()=>v,Object.values(v));return n.jsx(j.Provider,{value:w,children:y})};u.displayName=l+"Provider";function m(x,g){var j;const y=((j=g==null?void 0:g[t])==null?void 0:j[d])||c,v=p.useContext(y);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${x}\` must be used within \`${l}\``)}return[u,m]}const i=()=>{const l=r.map(o=>p.createContext(o));return function(c){const d=(c==null?void 0:c[t])||l;return p.useMemo(()=>({[`__scope${t}`]:{...c,[t]:d}}),[c,d])}};return i.scopeName=t,[a,oye(i,...s)]}function oye(...t){const s=t[0];if(t.length===1)return s;const r=()=>{const a=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(l){const o=a.reduce((c,{useScope:d,scopeName:u})=>{const x=d(l)[`__scope${u}`];return{...c,...x}},{});return p.useMemo(()=>({[`__scope${s.scopeName}`]:o}),[o])}};return r.scopeName=s.scopeName,r}var Qa=globalThis!=null&&globalThis.document?p.useLayoutEffect:()=>{},cye=Iw[" useInsertionEffect ".trim().toString()]||Qa;function pm({prop:t,defaultProp:s,onChange:r=()=>{},caller:a}){const[i,l,o]=dye({defaultProp:s,onChange:r}),c=t!==void 0,d=c?t:i;{const m=p.useRef(t!==void 0);p.useEffect(()=>{const x=m.current;x!==c&&console.warn(`${a} is changing from ${x?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),m.current=c},[c,a])}const u=p.useCallback(m=>{var x;if(c){const g=uye(m)?m(t):m;g!==t&&((x=o.current)==null||x.call(o,g))}else l(m)},[c,t,l,o]);return[d,u]}function dye({defaultProp:t,onChange:s}){const[r,a]=p.useState(t),i=p.useRef(r),l=p.useRef(s);return cye(()=>{l.current=s},[s]),p.useEffect(()=>{var o;i.current!==r&&((o=l.current)==null||o.call(l,r),i.current=r)},[r,i]),[r,a,l]}function uye(t){return typeof t=="function"}var mye=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],us=mye.reduce((t,s)=>{const r=Hh(`Primitive.${s}`),a=p.forwardRef((i,l)=>{const{asChild:o,...c}=i,d=o?r:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),n.jsx(d,{...c,ref:l})});return a.displayName=`Primitive.${s}`,{...t,[s]:a}},{});function PW(t,s){t&&Sm.flushSync(()=>t.dispatchEvent(s))}function IT(t){const s=t+"CollectionProvider",[r,a]=fc(s),[i,l]=r(s,{collectionRef:{current:null},itemMap:new Map}),o=j=>{const{scope:w,children:S}=j,E=_t.useRef(null),k=_t.useRef(new Map).current;return n.jsx(i,{scope:w,itemMap:k,collectionRef:E,children:S})};o.displayName=s;const c=t+"CollectionSlot",d=Hh(c),u=_t.forwardRef((j,w)=>{const{scope:S,children:E}=j,k=l(c,S),A=Fs(w,k.collectionRef);return n.jsx(d,{ref:A,children:E})});u.displayName=c;const m=t+"CollectionItemSlot",x="data-radix-collection-item",g=Hh(m),y=_t.forwardRef((j,w)=>{const{scope:S,children:E,...k}=j,A=_t.useRef(null),I=Fs(w,A),P=l(m,S);return _t.useEffect(()=>(P.itemMap.set(A,{ref:A,...k}),()=>void P.itemMap.delete(A))),n.jsx(g,{[x]:"",ref:I,children:E})});y.displayName=m;function v(j){const w=l(t+"CollectionConsumer",j);return _t.useCallback(()=>{const E=w.collectionRef.current;if(!E)return[];const k=Array.from(E.querySelectorAll(`[${x}]`));return Array.from(w.itemMap.values()).sort((P,O)=>k.indexOf(P.ref.current)-k.indexOf(O.ref.current))},[w.collectionRef,w.itemMap])}return[{Provider:o,Slot:u,ItemSlot:y},v,a]}var hye=p.createContext(void 0);function cy(t){const s=p.useContext(hye);return t||s||"ltr"}function Ha(t){const s=p.useRef(t);return p.useEffect(()=>{s.current=t}),p.useMemo(()=>(...r)=>{var a;return(a=s.current)==null?void 0:a.call(s,...r)},[])}function xye(t,s=globalThis==null?void 0:globalThis.document){const r=Ha(t);p.useEffect(()=>{const a=i=>{i.key==="Escape"&&r(i)};return s.addEventListener("keydown",a,{capture:!0}),()=>s.removeEventListener("keydown",a,{capture:!0})},[r,s])}var pye="DismissableLayer",l4="dismissableLayer.update",fye="dismissableLayer.pointerDownOutside",gye="dismissableLayer.focusOutside",I6,DW=p.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),p2=p.forwardRef((t,s)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:a,onPointerDownOutside:i,onFocusOutside:l,onInteractOutside:o,onDismiss:c,...d}=t,u=p.useContext(DW),[m,x]=p.useState(null),g=(m==null?void 0:m.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,y]=p.useState({}),v=Fs(s,O=>x(O)),j=Array.from(u.layers),[w]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),S=j.indexOf(w),E=m?j.indexOf(m):-1,k=u.layersWithOutsidePointerEventsDisabled.size>0,A=E>=S,I=vye(O=>{const D=O.target,T=[...u.branches].some(B=>B.contains(D));!A||T||(i==null||i(O),o==null||o(O),O.defaultPrevented||c==null||c())},g),P=jye(O=>{const D=O.target;[...u.branches].some(B=>B.contains(D))||(l==null||l(O),o==null||o(O),O.defaultPrevented||c==null||c())},g);return xye(O=>{E===u.layers.size-1&&(a==null||a(O),!O.defaultPrevented&&c&&(O.preventDefault(),c()))},g),p.useEffect(()=>{if(m)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(I6=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(m)),u.layers.add(m),O6(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=I6)}},[m,g,r,u]),p.useEffect(()=>()=>{m&&(u.layers.delete(m),u.layersWithOutsidePointerEventsDisabled.delete(m),O6())},[m,u]),p.useEffect(()=>{const O=()=>y({});return document.addEventListener(l4,O),()=>document.removeEventListener(l4,O)},[]),n.jsx(us.div,{...d,ref:v,style:{pointerEvents:k?A?"auto":"none":void 0,...t.style},onFocusCapture:zt(t.onFocusCapture,P.onFocusCapture),onBlurCapture:zt(t.onBlurCapture,P.onBlurCapture),onPointerDownCapture:zt(t.onPointerDownCapture,I.onPointerDownCapture)})});p2.displayName=pye;var bye="DismissableLayerBranch",yye=p.forwardRef((t,s)=>{const r=p.useContext(DW),a=p.useRef(null),i=Fs(s,a);return p.useEffect(()=>{const l=a.current;if(l)return r.branches.add(l),()=>{r.branches.delete(l)}},[r.branches]),n.jsx(us.div,{...t,ref:i})});yye.displayName=bye;function vye(t,s=globalThis==null?void 0:globalThis.document){const r=Ha(t),a=p.useRef(!1),i=p.useRef(()=>{});return p.useEffect(()=>{const l=c=>{if(c.target&&!a.current){let d=function(){MW(fye,r,u,{discrete:!0})};const u={originalEvent:c};c.pointerType==="touch"?(s.removeEventListener("click",i.current),i.current=d,s.addEventListener("click",i.current,{once:!0})):d()}else s.removeEventListener("click",i.current);a.current=!1},o=window.setTimeout(()=>{s.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(o),s.removeEventListener("pointerdown",l),s.removeEventListener("click",i.current)}},[s,r]),{onPointerDownCapture:()=>a.current=!0}}function jye(t,s=globalThis==null?void 0:globalThis.document){const r=Ha(t),a=p.useRef(!1);return p.useEffect(()=>{const i=l=>{l.target&&!a.current&&MW(gye,r,{originalEvent:l},{discrete:!1})};return s.addEventListener("focusin",i),()=>s.removeEventListener("focusin",i)},[s,r]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function O6(){const t=new CustomEvent(l4);document.dispatchEvent(t)}function MW(t,s,r,{discrete:a}){const i=r.originalEvent.target,l=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});s&&i.addEventListener(t,s,{once:!0}),a?PW(i,l):i.dispatchEvent(l)}var DC=0;function OT(){p.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??R6()),document.body.insertAdjacentElement("beforeend",t[1]??R6()),DC++,()=>{DC===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),DC--}},[])}function R6(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var MC="focusScope.autoFocusOnMount",IC="focusScope.autoFocusOnUnmount",L6={bubbles:!1,cancelable:!0},Nye="FocusScope",f2=p.forwardRef((t,s)=>{const{loop:r=!1,trapped:a=!1,onMountAutoFocus:i,onUnmountAutoFocus:l,...o}=t,[c,d]=p.useState(null),u=Ha(i),m=Ha(l),x=p.useRef(null),g=Fs(s,j=>d(j)),y=p.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;p.useEffect(()=>{if(a){let j=function(k){if(y.paused||!c)return;const A=k.target;c.contains(A)?x.current=A:Iu(x.current,{select:!0})},w=function(k){if(y.paused||!c)return;const A=k.relatedTarget;A!==null&&(c.contains(A)||Iu(x.current,{select:!0}))},S=function(k){if(document.activeElement===document.body)for(const I of k)I.removedNodes.length>0&&Iu(c)};document.addEventListener("focusin",j),document.addEventListener("focusout",w);const E=new MutationObserver(S);return c&&E.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",j),document.removeEventListener("focusout",w),E.disconnect()}}},[a,c,y.paused]),p.useEffect(()=>{if(c){B6.add(y);const j=document.activeElement;if(!c.contains(j)){const S=new CustomEvent(MC,L6);c.addEventListener(MC,u),c.dispatchEvent(S),S.defaultPrevented||(wye(Aye(IW(c)),{select:!0}),document.activeElement===j&&Iu(c))}return()=>{c.removeEventListener(MC,u),setTimeout(()=>{const S=new CustomEvent(IC,L6);c.addEventListener(IC,m),c.dispatchEvent(S),S.defaultPrevented||Iu(j??document.body,{select:!0}),c.removeEventListener(IC,m),B6.remove(y)},0)}}},[c,u,m,y]);const v=p.useCallback(j=>{if(!r&&!a||y.paused)return;const w=j.key==="Tab"&&!j.altKey&&!j.ctrlKey&&!j.metaKey,S=document.activeElement;if(w&&S){const E=j.currentTarget,[k,A]=_ye(E);k&&A?!j.shiftKey&&S===A?(j.preventDefault(),r&&Iu(k,{select:!0})):j.shiftKey&&S===k&&(j.preventDefault(),r&&Iu(A,{select:!0})):S===E&&j.preventDefault()}},[r,a,y.paused]);return n.jsx(us.div,{tabIndex:-1,...o,ref:g,onKeyDown:v})});f2.displayName=Nye;function wye(t,{select:s=!1}={}){const r=document.activeElement;for(const a of t)if(Iu(a,{select:s}),document.activeElement!==r)return}function _ye(t){const s=IW(t),r=F6(s,t),a=F6(s.reverse(),t);return[r,a]}function IW(t){const s=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const i=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||i?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)s.push(r.currentNode);return s}function F6(t,s){for(const r of t)if(!Sye(r,{upTo:s}))return r}function Sye(t,{upTo:s}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(s!==void 0&&t===s)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Cye(t){return t instanceof HTMLInputElement&&"select"in t}function Iu(t,{select:s=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&Cye(t)&&s&&t.select()}}var B6=kye();function kye(){let t=[];return{add(s){const r=t[0];s!==r&&(r==null||r.pause()),t=$6(t,s),t.unshift(s)},remove(s){var r;t=$6(t,s),(r=t[0])==null||r.resume()}}}function $6(t,s){const r=[...t],a=r.indexOf(s);return a!==-1&&r.splice(a,1),r}function Aye(t){return t.filter(s=>s.tagName!=="A")}var Eye=Iw[" useId ".trim().toString()]||(()=>{}),Tye=0;function td(t){const[s,r]=p.useState(Eye());return Qa(()=>{r(a=>a??String(Tye++))},[t]),s?`radix-${s}`:""}const Pye=["top","right","bottom","left"],fm=Math.min,Pl=Math.max,dN=Math.round,b1=Math.floor,sd=t=>({x:t,y:t}),Dye={left:"right",right:"left",bottom:"top",top:"bottom"},Mye={start:"end",end:"start"};function o4(t,s,r){return Pl(t,fm(s,r))}function Yd(t,s){return typeof t=="function"?t(s):t}function Xd(t){return t.split("-")[0]}function Ef(t){return t.split("-")[1]}function RT(t){return t==="x"?"y":"x"}function LT(t){return t==="y"?"height":"width"}const Iye=new Set(["top","bottom"]);function qc(t){return Iye.has(Xd(t))?"y":"x"}function FT(t){return RT(qc(t))}function Oye(t,s,r){r===void 0&&(r=!1);const a=Ef(t),i=FT(t),l=LT(i);let o=i==="x"?a===(r?"end":"start")?"right":"left":a==="start"?"bottom":"top";return s.reference[l]>s.floating[l]&&(o=uN(o)),[o,uN(o)]}function Rye(t){const s=uN(t);return[c4(t),s,c4(s)]}function c4(t){return t.replace(/start|end/g,s=>Mye[s])}const z6=["left","right"],U6=["right","left"],Lye=["top","bottom"],Fye=["bottom","top"];function Bye(t,s,r){switch(t){case"top":case"bottom":return r?s?U6:z6:s?z6:U6;case"left":case"right":return s?Lye:Fye;default:return[]}}function $ye(t,s,r,a){const i=Ef(t);let l=Bye(Xd(t),r==="start",a);return i&&(l=l.map(o=>o+"-"+i),s&&(l=l.concat(l.map(c4)))),l}function uN(t){return t.replace(/left|right|bottom|top/g,s=>Dye[s])}function zye(t){return{top:0,right:0,bottom:0,left:0,...t}}function OW(t){return typeof t!="number"?zye(t):{top:t,right:t,bottom:t,left:t}}function mN(t){const{x:s,y:r,width:a,height:i}=t;return{width:a,height:i,top:r,left:s,right:s+a,bottom:r+i,x:s,y:r}}function V6(t,s,r){let{reference:a,floating:i}=t;const l=qc(s),o=FT(s),c=LT(o),d=Xd(s),u=l==="y",m=a.x+a.width/2-i.width/2,x=a.y+a.height/2-i.height/2,g=a[c]/2-i[c]/2;let y;switch(d){case"top":y={x:m,y:a.y-i.height};break;case"bottom":y={x:m,y:a.y+a.height};break;case"right":y={x:a.x+a.width,y:x};break;case"left":y={x:a.x-i.width,y:x};break;default:y={x:a.x,y:a.y}}switch(Ef(s)){case"start":y[o]-=g*(r&&u?-1:1);break;case"end":y[o]+=g*(r&&u?-1:1);break}return y}const Uye=async(t,s,r)=>{const{placement:a="bottom",strategy:i="absolute",middleware:l=[],platform:o}=r,c=l.filter(Boolean),d=await(o.isRTL==null?void 0:o.isRTL(s));let u=await o.getElementRects({reference:t,floating:s,strategy:i}),{x:m,y:x}=V6(u,a,d),g=a,y={},v=0;for(let j=0;j<c.length;j++){const{name:w,fn:S}=c[j],{x:E,y:k,data:A,reset:I}=await S({x:m,y:x,initialPlacement:a,placement:g,strategy:i,middlewareData:y,rects:u,platform:o,elements:{reference:t,floating:s}});m=E??m,x=k??x,y={...y,[w]:{...y[w],...A}},I&&v<=50&&(v++,typeof I=="object"&&(I.placement&&(g=I.placement),I.rects&&(u=I.rects===!0?await o.getElementRects({reference:t,floating:s,strategy:i}):I.rects),{x:m,y:x}=V6(u,g,d)),j=-1)}return{x:m,y:x,placement:g,strategy:i,middlewareData:y}};async function mb(t,s){var r;s===void 0&&(s={});const{x:a,y:i,platform:l,rects:o,elements:c,strategy:d}=t,{boundary:u="clippingAncestors",rootBoundary:m="viewport",elementContext:x="floating",altBoundary:g=!1,padding:y=0}=Yd(s,t),v=OW(y),w=c[g?x==="floating"?"reference":"floating":x],S=mN(await l.getClippingRect({element:(r=await(l.isElement==null?void 0:l.isElement(w)))==null||r?w:w.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(c.floating)),boundary:u,rootBoundary:m,strategy:d})),E=x==="floating"?{x:a,y:i,width:o.floating.width,height:o.floating.height}:o.reference,k=await(l.getOffsetParent==null?void 0:l.getOffsetParent(c.floating)),A=await(l.isElement==null?void 0:l.isElement(k))?await(l.getScale==null?void 0:l.getScale(k))||{x:1,y:1}:{x:1,y:1},I=mN(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:E,offsetParent:k,strategy:d}):E);return{top:(S.top-I.top+v.top)/A.y,bottom:(I.bottom-S.bottom+v.bottom)/A.y,left:(S.left-I.left+v.left)/A.x,right:(I.right-S.right+v.right)/A.x}}const Vye=t=>({name:"arrow",options:t,async fn(s){const{x:r,y:a,placement:i,rects:l,platform:o,elements:c,middlewareData:d}=s,{element:u,padding:m=0}=Yd(t,s)||{};if(u==null)return{};const x=OW(m),g={x:r,y:a},y=FT(i),v=LT(y),j=await o.getDimensions(u),w=y==="y",S=w?"top":"left",E=w?"bottom":"right",k=w?"clientHeight":"clientWidth",A=l.reference[v]+l.reference[y]-g[y]-l.floating[v],I=g[y]-l.reference[y],P=await(o.getOffsetParent==null?void 0:o.getOffsetParent(u));let O=P?P[k]:0;(!O||!await(o.isElement==null?void 0:o.isElement(P)))&&(O=c.floating[k]||l.floating[v]);const D=A/2-I/2,T=O/2-j[v]/2-1,B=fm(x[S],T),U=fm(x[E],T),W=B,V=O-j[v]-U,R=O/2-j[v]/2+D,F=o4(W,R,V),G=!d.arrow&&Ef(i)!=null&&R!==F&&l.reference[v]/2-(R<W?B:U)-j[v]/2<0,H=G?R<W?R-W:R-V:0;return{[y]:g[y]+H,data:{[y]:F,centerOffset:R-F-H,...G&&{alignmentOffset:H}},reset:G}}}),Hye=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(s){var r,a;const{placement:i,middlewareData:l,rects:o,initialPlacement:c,platform:d,elements:u}=s,{mainAxis:m=!0,crossAxis:x=!0,fallbackPlacements:g,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:j=!0,...w}=Yd(t,s);if((r=l.arrow)!=null&&r.alignmentOffset)return{};const S=Xd(i),E=qc(c),k=Xd(c)===c,A=await(d.isRTL==null?void 0:d.isRTL(u.floating)),I=g||(k||!j?[uN(c)]:Rye(c)),P=v!=="none";!g&&P&&I.push(...$ye(c,j,v,A));const O=[c,...I],D=await mb(s,w),T=[];let B=((a=l.flip)==null?void 0:a.overflows)||[];if(m&&T.push(D[S]),x){const R=Oye(i,o,A);T.push(D[R[0]],D[R[1]])}if(B=[...B,{placement:i,overflows:T}],!T.every(R=>R<=0)){var U,W;const R=(((U=l.flip)==null?void 0:U.index)||0)+1,F=O[R];if(F&&(!(x==="alignment"?E!==qc(F):!1)||B.every($=>qc($.placement)===E?$.overflows[0]>0:!0)))return{data:{index:R,overflows:B},reset:{placement:F}};let G=(W=B.filter(H=>H.overflows[0]<=0).sort((H,$)=>H.overflows[1]-$.overflows[1])[0])==null?void 0:W.placement;if(!G)switch(y){case"bestFit":{var V;const H=(V=B.filter($=>{if(P){const K=qc($.placement);return K===E||K==="y"}return!0}).map($=>[$.placement,$.overflows.filter(K=>K>0).reduce((K,le)=>K+le,0)]).sort(($,K)=>$[1]-K[1])[0])==null?void 0:V[0];H&&(G=H);break}case"initialPlacement":G=c;break}if(i!==G)return{reset:{placement:G}}}return{}}}};function H6(t,s){return{top:t.top-s.height,right:t.right-s.width,bottom:t.bottom-s.height,left:t.left-s.width}}function W6(t){return Pye.some(s=>t[s]>=0)}const Wye=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(s){const{rects:r}=s,{strategy:a="referenceHidden",...i}=Yd(t,s);switch(a){case"referenceHidden":{const l=await mb(s,{...i,elementContext:"reference"}),o=H6(l,r.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:W6(o)}}}case"escaped":{const l=await mb(s,{...i,altBoundary:!0}),o=H6(l,r.floating);return{data:{escapedOffsets:o,escaped:W6(o)}}}default:return{}}}}},RW=new Set(["left","top"]);async function qye(t,s){const{placement:r,platform:a,elements:i}=t,l=await(a.isRTL==null?void 0:a.isRTL(i.floating)),o=Xd(r),c=Ef(r),d=qc(r)==="y",u=RW.has(o)?-1:1,m=l&&d?-1:1,x=Yd(s,t);let{mainAxis:g,crossAxis:y,alignmentAxis:v}=typeof x=="number"?{mainAxis:x,crossAxis:0,alignmentAxis:null}:{mainAxis:x.mainAxis||0,crossAxis:x.crossAxis||0,alignmentAxis:x.alignmentAxis};return c&&typeof v=="number"&&(y=c==="end"?v*-1:v),d?{x:y*m,y:g*u}:{x:g*u,y:y*m}}const Gye=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(s){var r,a;const{x:i,y:l,placement:o,middlewareData:c}=s,d=await qye(s,t);return o===((r=c.offset)==null?void 0:r.placement)&&(a=c.arrow)!=null&&a.alignmentOffset?{}:{x:i+d.x,y:l+d.y,data:{...d,placement:o}}}}},Kye=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(s){const{x:r,y:a,placement:i}=s,{mainAxis:l=!0,crossAxis:o=!1,limiter:c={fn:w=>{let{x:S,y:E}=w;return{x:S,y:E}}},...d}=Yd(t,s),u={x:r,y:a},m=await mb(s,d),x=qc(Xd(i)),g=RT(x);let y=u[g],v=u[x];if(l){const w=g==="y"?"top":"left",S=g==="y"?"bottom":"right",E=y+m[w],k=y-m[S];y=o4(E,y,k)}if(o){const w=x==="y"?"top":"left",S=x==="y"?"bottom":"right",E=v+m[w],k=v-m[S];v=o4(E,v,k)}const j=c.fn({...s,[g]:y,[x]:v});return{...j,data:{x:j.x-r,y:j.y-a,enabled:{[g]:l,[x]:o}}}}}},Yye=function(t){return t===void 0&&(t={}),{options:t,fn(s){const{x:r,y:a,placement:i,rects:l,middlewareData:o}=s,{offset:c=0,mainAxis:d=!0,crossAxis:u=!0}=Yd(t,s),m={x:r,y:a},x=qc(i),g=RT(x);let y=m[g],v=m[x];const j=Yd(c,s),w=typeof j=="number"?{mainAxis:j,crossAxis:0}:{mainAxis:0,crossAxis:0,...j};if(d){const k=g==="y"?"height":"width",A=l.reference[g]-l.floating[k]+w.mainAxis,I=l.reference[g]+l.reference[k]-w.mainAxis;y<A?y=A:y>I&&(y=I)}if(u){var S,E;const k=g==="y"?"width":"height",A=RW.has(Xd(i)),I=l.reference[x]-l.floating[k]+(A&&((S=o.offset)==null?void 0:S[x])||0)+(A?0:w.crossAxis),P=l.reference[x]+l.reference[k]+(A?0:((E=o.offset)==null?void 0:E[x])||0)-(A?w.crossAxis:0);v<I?v=I:v>P&&(v=P)}return{[g]:y,[x]:v}}}},Xye=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(s){var r,a;const{placement:i,rects:l,platform:o,elements:c}=s,{apply:d=()=>{},...u}=Yd(t,s),m=await mb(s,u),x=Xd(i),g=Ef(i),y=qc(i)==="y",{width:v,height:j}=l.floating;let w,S;x==="top"||x==="bottom"?(w=x,S=g===(await(o.isRTL==null?void 0:o.isRTL(c.floating))?"start":"end")?"left":"right"):(S=x,w=g==="end"?"top":"bottom");const E=j-m.top-m.bottom,k=v-m.left-m.right,A=fm(j-m[w],E),I=fm(v-m[S],k),P=!s.middlewareData.shift;let O=A,D=I;if((r=s.middlewareData.shift)!=null&&r.enabled.x&&(D=k),(a=s.middlewareData.shift)!=null&&a.enabled.y&&(O=E),P&&!g){const B=Pl(m.left,0),U=Pl(m.right,0),W=Pl(m.top,0),V=Pl(m.bottom,0);y?D=v-2*(B!==0||U!==0?B+U:Pl(m.left,m.right)):O=j-2*(W!==0||V!==0?W+V:Pl(m.top,m.bottom))}await d({...s,availableWidth:D,availableHeight:O});const T=await o.getDimensions(c.floating);return v!==T.width||j!==T.height?{reset:{rects:!0}}:{}}}};function g2(){return typeof window<"u"}function Tf(t){return LW(t)?(t.nodeName||"").toLowerCase():"#document"}function $l(t){var s;return(t==null||(s=t.ownerDocument)==null?void 0:s.defaultView)||window}function hd(t){var s;return(s=(LW(t)?t.ownerDocument:t.document)||window.document)==null?void 0:s.documentElement}function LW(t){return g2()?t instanceof Node||t instanceof $l(t).Node:!1}function mc(t){return g2()?t instanceof Element||t instanceof $l(t).Element:!1}function id(t){return g2()?t instanceof HTMLElement||t instanceof $l(t).HTMLElement:!1}function q6(t){return!g2()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof $l(t).ShadowRoot}const Qye=new Set(["inline","contents"]);function dy(t){const{overflow:s,overflowX:r,overflowY:a,display:i}=hc(t);return/auto|scroll|overlay|hidden|clip/.test(s+a+r)&&!Qye.has(i)}const Zye=new Set(["table","td","th"]);function Jye(t){return Zye.has(Tf(t))}const e1e=[":popover-open",":modal"];function b2(t){return e1e.some(s=>{try{return t.matches(s)}catch{return!1}})}const t1e=["transform","translate","scale","rotate","perspective"],s1e=["transform","translate","scale","rotate","perspective","filter"],n1e=["paint","layout","strict","content"];function BT(t){const s=$T(),r=mc(t)?hc(t):t;return t1e.some(a=>r[a]?r[a]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!s&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!s&&(r.filter?r.filter!=="none":!1)||s1e.some(a=>(r.willChange||"").includes(a))||n1e.some(a=>(r.contain||"").includes(a))}function r1e(t){let s=gm(t);for(;id(s)&&!ef(s);){if(BT(s))return s;if(b2(s))return null;s=gm(s)}return null}function $T(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const a1e=new Set(["html","body","#document"]);function ef(t){return a1e.has(Tf(t))}function hc(t){return $l(t).getComputedStyle(t)}function y2(t){return mc(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function gm(t){if(Tf(t)==="html")return t;const s=t.assignedSlot||t.parentNode||q6(t)&&t.host||hd(t);return q6(s)?s.host:s}function FW(t){const s=gm(t);return ef(s)?t.ownerDocument?t.ownerDocument.body:t.body:id(s)&&dy(s)?s:FW(s)}function hb(t,s,r){var a;s===void 0&&(s=[]),r===void 0&&(r=!0);const i=FW(t),l=i===((a=t.ownerDocument)==null?void 0:a.body),o=$l(i);if(l){const c=d4(o);return s.concat(o,o.visualViewport||[],dy(i)?i:[],c&&r?hb(c):[])}return s.concat(i,hb(i,[],r))}function d4(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function BW(t){const s=hc(t);let r=parseFloat(s.width)||0,a=parseFloat(s.height)||0;const i=id(t),l=i?t.offsetWidth:r,o=i?t.offsetHeight:a,c=dN(r)!==l||dN(a)!==o;return c&&(r=l,a=o),{width:r,height:a,$:c}}function zT(t){return mc(t)?t:t.contextElement}function Op(t){const s=zT(t);if(!id(s))return sd(1);const r=s.getBoundingClientRect(),{width:a,height:i,$:l}=BW(s);let o=(l?dN(r.width):r.width)/a,c=(l?dN(r.height):r.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!c||!Number.isFinite(c))&&(c=1),{x:o,y:c}}const i1e=sd(0);function $W(t){const s=$l(t);return!$T()||!s.visualViewport?i1e:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function l1e(t,s,r){return s===void 0&&(s=!1),!r||s&&r!==$l(t)?!1:s}function Wh(t,s,r,a){s===void 0&&(s=!1),r===void 0&&(r=!1);const i=t.getBoundingClientRect(),l=zT(t);let o=sd(1);s&&(a?mc(a)&&(o=Op(a)):o=Op(t));const c=l1e(l,r,a)?$W(l):sd(0);let d=(i.left+c.x)/o.x,u=(i.top+c.y)/o.y,m=i.width/o.x,x=i.height/o.y;if(l){const g=$l(l),y=a&&mc(a)?$l(a):a;let v=g,j=d4(v);for(;j&&a&&y!==v;){const w=Op(j),S=j.getBoundingClientRect(),E=hc(j),k=S.left+(j.clientLeft+parseFloat(E.paddingLeft))*w.x,A=S.top+(j.clientTop+parseFloat(E.paddingTop))*w.y;d*=w.x,u*=w.y,m*=w.x,x*=w.y,d+=k,u+=A,v=$l(j),j=d4(v)}}return mN({width:m,height:x,x:d,y:u})}function v2(t,s){const r=y2(t).scrollLeft;return s?s.left+r:Wh(hd(t)).left+r}function zW(t,s){const r=t.getBoundingClientRect(),a=r.left+s.scrollLeft-v2(t,r),i=r.top+s.scrollTop;return{x:a,y:i}}function o1e(t){let{elements:s,rect:r,offsetParent:a,strategy:i}=t;const l=i==="fixed",o=hd(a),c=s?b2(s.floating):!1;if(a===o||c&&l)return r;let d={scrollLeft:0,scrollTop:0},u=sd(1);const m=sd(0),x=id(a);if((x||!x&&!l)&&((Tf(a)!=="body"||dy(o))&&(d=y2(a)),id(a))){const y=Wh(a);u=Op(a),m.x=y.x+a.clientLeft,m.y=y.y+a.clientTop}const g=o&&!x&&!l?zW(o,d):sd(0);return{width:r.width*u.x,height:r.height*u.y,x:r.x*u.x-d.scrollLeft*u.x+m.x+g.x,y:r.y*u.y-d.scrollTop*u.y+m.y+g.y}}function c1e(t){return Array.from(t.getClientRects())}function d1e(t){const s=hd(t),r=y2(t),a=t.ownerDocument.body,i=Pl(s.scrollWidth,s.clientWidth,a.scrollWidth,a.clientWidth),l=Pl(s.scrollHeight,s.clientHeight,a.scrollHeight,a.clientHeight);let o=-r.scrollLeft+v2(t);const c=-r.scrollTop;return hc(a).direction==="rtl"&&(o+=Pl(s.clientWidth,a.clientWidth)-i),{width:i,height:l,x:o,y:c}}const G6=25;function u1e(t,s){const r=$l(t),a=hd(t),i=r.visualViewport;let l=a.clientWidth,o=a.clientHeight,c=0,d=0;if(i){l=i.width,o=i.height;const m=$T();(!m||m&&s==="fixed")&&(c=i.offsetLeft,d=i.offsetTop)}const u=v2(a);if(u<=0){const m=a.ownerDocument,x=m.body,g=getComputedStyle(x),y=m.compatMode==="CSS1Compat"&&parseFloat(g.marginLeft)+parseFloat(g.marginRight)||0,v=Math.abs(a.clientWidth-x.clientWidth-y);v<=G6&&(l-=v)}else u<=G6&&(l+=u);return{width:l,height:o,x:c,y:d}}const m1e=new Set(["absolute","fixed"]);function h1e(t,s){const r=Wh(t,!0,s==="fixed"),a=r.top+t.clientTop,i=r.left+t.clientLeft,l=id(t)?Op(t):sd(1),o=t.clientWidth*l.x,c=t.clientHeight*l.y,d=i*l.x,u=a*l.y;return{width:o,height:c,x:d,y:u}}function K6(t,s,r){let a;if(s==="viewport")a=u1e(t,r);else if(s==="document")a=d1e(hd(t));else if(mc(s))a=h1e(s,r);else{const i=$W(t);a={x:s.x-i.x,y:s.y-i.y,width:s.width,height:s.height}}return mN(a)}function UW(t,s){const r=gm(t);return r===s||!mc(r)||ef(r)?!1:hc(r).position==="fixed"||UW(r,s)}function x1e(t,s){const r=s.get(t);if(r)return r;let a=hb(t,[],!1).filter(c=>mc(c)&&Tf(c)!=="body"),i=null;const l=hc(t).position==="fixed";let o=l?gm(t):t;for(;mc(o)&&!ef(o);){const c=hc(o),d=BT(o);!d&&c.position==="fixed"&&(i=null),(l?!d&&!i:!d&&c.position==="static"&&!!i&&m1e.has(i.position)||dy(o)&&!d&&UW(t,o))?a=a.filter(m=>m!==o):i=c,o=gm(o)}return s.set(t,a),a}function p1e(t){let{element:s,boundary:r,rootBoundary:a,strategy:i}=t;const o=[...r==="clippingAncestors"?b2(s)?[]:x1e(s,this._c):[].concat(r),a],c=o[0],d=o.reduce((u,m)=>{const x=K6(s,m,i);return u.top=Pl(x.top,u.top),u.right=fm(x.right,u.right),u.bottom=fm(x.bottom,u.bottom),u.left=Pl(x.left,u.left),u},K6(s,c,i));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function f1e(t){const{width:s,height:r}=BW(t);return{width:s,height:r}}function g1e(t,s,r){const a=id(s),i=hd(s),l=r==="fixed",o=Wh(t,!0,l,s);let c={scrollLeft:0,scrollTop:0};const d=sd(0);function u(){d.x=v2(i)}if(a||!a&&!l)if((Tf(s)!=="body"||dy(i))&&(c=y2(s)),a){const y=Wh(s,!0,l,s);d.x=y.x+s.clientLeft,d.y=y.y+s.clientTop}else i&&u();l&&!a&&i&&u();const m=i&&!a&&!l?zW(i,c):sd(0),x=o.left+c.scrollLeft-d.x-m.x,g=o.top+c.scrollTop-d.y-m.y;return{x,y:g,width:o.width,height:o.height}}function OC(t){return hc(t).position==="static"}function Y6(t,s){if(!id(t)||hc(t).position==="fixed")return null;if(s)return s(t);let r=t.offsetParent;return hd(t)===r&&(r=r.ownerDocument.body),r}function VW(t,s){const r=$l(t);if(b2(t))return r;if(!id(t)){let i=gm(t);for(;i&&!ef(i);){if(mc(i)&&!OC(i))return i;i=gm(i)}return r}let a=Y6(t,s);for(;a&&Jye(a)&&OC(a);)a=Y6(a,s);return a&&ef(a)&&OC(a)&&!BT(a)?r:a||r1e(t)||r}const b1e=async function(t){const s=this.getOffsetParent||VW,r=this.getDimensions,a=await r(t.floating);return{reference:g1e(t.reference,await s(t.floating),t.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function y1e(t){return hc(t).direction==="rtl"}const v1e={convertOffsetParentRelativeRectToViewportRelativeRect:o1e,getDocumentElement:hd,getClippingRect:p1e,getOffsetParent:VW,getElementRects:b1e,getClientRects:c1e,getDimensions:f1e,getScale:Op,isElement:mc,isRTL:y1e};function HW(t,s){return t.x===s.x&&t.y===s.y&&t.width===s.width&&t.height===s.height}function j1e(t,s){let r=null,a;const i=hd(t);function l(){var c;clearTimeout(a),(c=r)==null||c.disconnect(),r=null}function o(c,d){c===void 0&&(c=!1),d===void 0&&(d=1),l();const u=t.getBoundingClientRect(),{left:m,top:x,width:g,height:y}=u;if(c||s(),!g||!y)return;const v=b1(x),j=b1(i.clientWidth-(m+g)),w=b1(i.clientHeight-(x+y)),S=b1(m),k={rootMargin:-v+"px "+-j+"px "+-w+"px "+-S+"px",threshold:Pl(0,fm(1,d))||1};let A=!0;function I(P){const O=P[0].intersectionRatio;if(O!==d){if(!A)return o();O?o(!1,O):a=setTimeout(()=>{o(!1,1e-7)},1e3)}O===1&&!HW(u,t.getBoundingClientRect())&&o(),A=!1}try{r=new IntersectionObserver(I,{...k,root:i.ownerDocument})}catch{r=new IntersectionObserver(I,k)}r.observe(t)}return o(!0),l}function N1e(t,s,r,a){a===void 0&&(a={});const{ancestorScroll:i=!0,ancestorResize:l=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:d=!1}=a,u=zT(t),m=i||l?[...u?hb(u):[],...hb(s)]:[];m.forEach(S=>{i&&S.addEventListener("scroll",r,{passive:!0}),l&&S.addEventListener("resize",r)});const x=u&&c?j1e(u,r):null;let g=-1,y=null;o&&(y=new ResizeObserver(S=>{let[E]=S;E&&E.target===u&&y&&(y.unobserve(s),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var k;(k=y)==null||k.observe(s)})),r()}),u&&!d&&y.observe(u),y.observe(s));let v,j=d?Wh(t):null;d&&w();function w(){const S=Wh(t);j&&!HW(j,S)&&r(),j=S,v=requestAnimationFrame(w)}return r(),()=>{var S;m.forEach(E=>{i&&E.removeEventListener("scroll",r),l&&E.removeEventListener("resize",r)}),x==null||x(),(S=y)==null||S.disconnect(),y=null,d&&cancelAnimationFrame(v)}}const w1e=Gye,_1e=Kye,S1e=Hye,C1e=Xye,k1e=Wye,X6=Vye,A1e=Yye,E1e=(t,s,r)=>{const a=new Map,i={platform:v1e,...r},l={...i.platform,_c:a};return Uye(t,s,{...i,platform:l})};var T1e=typeof document<"u",P1e=function(){},dj=T1e?p.useLayoutEffect:P1e;function hN(t,s){if(t===s)return!0;if(typeof t!=typeof s)return!1;if(typeof t=="function"&&t.toString()===s.toString())return!0;let r,a,i;if(t&&s&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==s.length)return!1;for(a=r;a--!==0;)if(!hN(t[a],s[a]))return!1;return!0}if(i=Object.keys(t),r=i.length,r!==Object.keys(s).length)return!1;for(a=r;a--!==0;)if(!{}.hasOwnProperty.call(s,i[a]))return!1;for(a=r;a--!==0;){const l=i[a];if(!(l==="_owner"&&t.$$typeof)&&!hN(t[l],s[l]))return!1}return!0}return t!==t&&s!==s}function WW(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Q6(t,s){const r=WW(t);return Math.round(s*r)/r}function RC(t){const s=p.useRef(t);return dj(()=>{s.current=t}),s}function D1e(t){t===void 0&&(t={});const{placement:s="bottom",strategy:r="absolute",middleware:a=[],platform:i,elements:{reference:l,floating:o}={},transform:c=!0,whileElementsMounted:d,open:u}=t,[m,x]=p.useState({x:0,y:0,strategy:r,placement:s,middlewareData:{},isPositioned:!1}),[g,y]=p.useState(a);hN(g,a)||y(a);const[v,j]=p.useState(null),[w,S]=p.useState(null),E=p.useCallback($=>{$!==P.current&&(P.current=$,j($))},[]),k=p.useCallback($=>{$!==O.current&&(O.current=$,S($))},[]),A=l||v,I=o||w,P=p.useRef(null),O=p.useRef(null),D=p.useRef(m),T=d!=null,B=RC(d),U=RC(i),W=RC(u),V=p.useCallback(()=>{if(!P.current||!O.current)return;const $={placement:s,strategy:r,middleware:g};U.current&&($.platform=U.current),E1e(P.current,O.current,$).then(K=>{const le={...K,isPositioned:W.current!==!1};R.current&&!hN(D.current,le)&&(D.current=le,Sm.flushSync(()=>{x(le)}))})},[g,s,r,U,W]);dj(()=>{u===!1&&D.current.isPositioned&&(D.current.isPositioned=!1,x($=>({...$,isPositioned:!1})))},[u]);const R=p.useRef(!1);dj(()=>(R.current=!0,()=>{R.current=!1}),[]),dj(()=>{if(A&&(P.current=A),I&&(O.current=I),A&&I){if(B.current)return B.current(A,I,V);V()}},[A,I,V,B,T]);const F=p.useMemo(()=>({reference:P,floating:O,setReference:E,setFloating:k}),[E,k]),G=p.useMemo(()=>({reference:A,floating:I}),[A,I]),H=p.useMemo(()=>{const $={position:r,left:0,top:0};if(!G.floating)return $;const K=Q6(G.floating,m.x),le=Q6(G.floating,m.y);return c?{...$,transform:"translate("+K+"px, "+le+"px)",...WW(G.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:K,top:le}},[r,c,G.floating,m.x,m.y]);return p.useMemo(()=>({...m,update:V,refs:F,elements:G,floatingStyles:H}),[m,V,F,G,H])}const M1e=t=>{function s(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:a,padding:i}=typeof t=="function"?t(r):t;return a&&s(a)?a.current!=null?X6({element:a.current,padding:i}).fn(r):{}:a?X6({element:a,padding:i}).fn(r):{}}}},I1e=(t,s)=>({...w1e(t),options:[t,s]}),O1e=(t,s)=>({..._1e(t),options:[t,s]}),R1e=(t,s)=>({...A1e(t),options:[t,s]}),L1e=(t,s)=>({...S1e(t),options:[t,s]}),F1e=(t,s)=>({...C1e(t),options:[t,s]}),B1e=(t,s)=>({...k1e(t),options:[t,s]}),$1e=(t,s)=>({...M1e(t),options:[t,s]});var z1e="Arrow",qW=p.forwardRef((t,s)=>{const{children:r,width:a=10,height:i=5,...l}=t;return n.jsx(us.svg,{...l,ref:s,width:a,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:n.jsx("polygon",{points:"0,0 30,0 15,10"})})});qW.displayName=z1e;var U1e=qW;function UT(t){const[s,r]=p.useState(void 0);return Qa(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const a=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const l=i[0];let o,c;if("borderBoxSize"in l){const d=l.borderBoxSize,u=Array.isArray(d)?d[0]:d;o=u.inlineSize,c=u.blockSize}else o=t.offsetWidth,c=t.offsetHeight;r({width:o,height:c})});return a.observe(t,{box:"border-box"}),()=>a.unobserve(t)}else r(void 0)},[t]),s}var VT="Popper",[GW,j2]=fc(VT),[V1e,KW]=GW(VT),YW=t=>{const{__scopePopper:s,children:r}=t,[a,i]=p.useState(null);return n.jsx(V1e,{scope:s,anchor:a,onAnchorChange:i,children:r})};YW.displayName=VT;var XW="PopperAnchor",QW=p.forwardRef((t,s)=>{const{__scopePopper:r,virtualRef:a,...i}=t,l=KW(XW,r),o=p.useRef(null),c=Fs(s,o),d=p.useRef(null);return p.useEffect(()=>{const u=d.current;d.current=(a==null?void 0:a.current)||o.current,u!==d.current&&l.onAnchorChange(d.current)}),a?null:n.jsx(us.div,{...i,ref:c})});QW.displayName=XW;var HT="PopperContent",[H1e,W1e]=GW(HT),ZW=p.forwardRef((t,s)=>{var ee,X,Z,Y,Q,oe;const{__scopePopper:r,side:a="bottom",sideOffset:i=0,align:l="center",alignOffset:o=0,arrowPadding:c=0,avoidCollisions:d=!0,collisionBoundary:u=[],collisionPadding:m=0,sticky:x="partial",hideWhenDetached:g=!1,updatePositionStrategy:y="optimized",onPlaced:v,...j}=t,w=KW(HT,r),[S,E]=p.useState(null),k=Fs(s,_e=>E(_e)),[A,I]=p.useState(null),P=UT(A),O=(P==null?void 0:P.width)??0,D=(P==null?void 0:P.height)??0,T=a+(l!=="center"?"-"+l:""),B=typeof m=="number"?m:{top:0,right:0,bottom:0,left:0,...m},U=Array.isArray(u)?u:[u],W=U.length>0,V={padding:B,boundary:U.filter(G1e),altBoundary:W},{refs:R,floatingStyles:F,placement:G,isPositioned:H,middlewareData:$}=D1e({strategy:"fixed",placement:T,whileElementsMounted:(..._e)=>N1e(..._e,{animationFrame:y==="always"}),elements:{reference:w.anchor},middleware:[I1e({mainAxis:i+D,alignmentAxis:o}),d&&O1e({mainAxis:!0,crossAxis:!1,limiter:x==="partial"?R1e():void 0,...V}),d&&L1e({...V}),F1e({...V,apply:({elements:_e,rects:xe,availableWidth:me,availableHeight:Re})=>{const{width:Ze,height:$e}=xe.reference,fe=_e.floating.style;fe.setProperty("--radix-popper-available-width",`${me}px`),fe.setProperty("--radix-popper-available-height",`${Re}px`),fe.setProperty("--radix-popper-anchor-width",`${Ze}px`),fe.setProperty("--radix-popper-anchor-height",`${$e}px`)}}),A&&$1e({element:A,padding:c}),K1e({arrowWidth:O,arrowHeight:D}),g&&B1e({strategy:"referenceHidden",...V})]}),[K,le]=tq(G),se=Ha(v);Qa(()=>{H&&(se==null||se())},[H,se]);const J=(ee=$.arrow)==null?void 0:ee.x,ie=(X=$.arrow)==null?void 0:X.y,te=((Z=$.arrow)==null?void 0:Z.centerOffset)!==0,[ne,q]=p.useState();return Qa(()=>{S&&q(window.getComputedStyle(S).zIndex)},[S]),n.jsx("div",{ref:R.setFloating,"data-radix-popper-content-wrapper":"",style:{...F,transform:H?F.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ne,"--radix-popper-transform-origin":[(Y=$.transformOrigin)==null?void 0:Y.x,(Q=$.transformOrigin)==null?void 0:Q.y].join(" "),...((oe=$.hide)==null?void 0:oe.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:n.jsx(H1e,{scope:r,placedSide:K,onArrowChange:I,arrowX:J,arrowY:ie,shouldHideArrow:te,children:n.jsx(us.div,{"data-side":K,"data-align":le,...j,ref:k,style:{...j.style,animation:H?void 0:"none"}})})})});ZW.displayName=HT;var JW="PopperArrow",q1e={top:"bottom",right:"left",bottom:"top",left:"right"},eq=p.forwardRef(function(s,r){const{__scopePopper:a,...i}=s,l=W1e(JW,a),o=q1e[l.placedSide];return n.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:n.jsx(U1e,{...i,ref:r,style:{...i.style,display:"block"}})})});eq.displayName=JW;function G1e(t){return t!==null}var K1e=t=>({name:"transformOrigin",options:t,fn(s){var w,S,E;const{placement:r,rects:a,middlewareData:i}=s,o=((w=i.arrow)==null?void 0:w.centerOffset)!==0,c=o?0:t.arrowWidth,d=o?0:t.arrowHeight,[u,m]=tq(r),x={start:"0%",center:"50%",end:"100%"}[m],g=(((S=i.arrow)==null?void 0:S.x)??0)+c/2,y=(((E=i.arrow)==null?void 0:E.y)??0)+d/2;let v="",j="";return u==="bottom"?(v=o?x:`${g}px`,j=`${-d}px`):u==="top"?(v=o?x:`${g}px`,j=`${a.floating.height+d}px`):u==="right"?(v=`${-d}px`,j=o?x:`${y}px`):u==="left"&&(v=`${a.floating.width+d}px`,j=o?x:`${y}px`),{data:{x:v,y:j}}}});function tq(t){const[s,r="center"]=t.split("-");return[s,r]}var sq=YW,nq=QW,rq=ZW,aq=eq,Y1e="Portal",N2=p.forwardRef((t,s)=>{var c;const{container:r,...a}=t,[i,l]=p.useState(!1);Qa(()=>l(!0),[]);const o=r||i&&((c=globalThis==null?void 0:globalThis.document)==null?void 0:c.body);return o?EU.createPortal(n.jsx(us.div,{...a,ref:s}),o):null});N2.displayName=Y1e;function X1e(t,s){return p.useReducer((r,a)=>s[r][a]??r,t)}var fl=t=>{const{present:s,children:r}=t,a=Q1e(s),i=typeof r=="function"?r({present:a.isPresent}):p.Children.only(r),l=Fs(a.ref,Z1e(i));return typeof r=="function"||a.isPresent?p.cloneElement(i,{ref:l}):null};fl.displayName="Presence";function Q1e(t){const[s,r]=p.useState(),a=p.useRef(null),i=p.useRef(t),l=p.useRef("none"),o=t?"mounted":"unmounted",[c,d]=X1e(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return p.useEffect(()=>{const u=y1(a.current);l.current=c==="mounted"?u:"none"},[c]),Qa(()=>{const u=a.current,m=i.current;if(m!==t){const g=l.current,y=y1(u);t?d("MOUNT"):y==="none"||(u==null?void 0:u.display)==="none"?d("UNMOUNT"):d(m&&g!==y?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,d]),Qa(()=>{if(s){let u;const m=s.ownerDocument.defaultView??window,x=y=>{const j=y1(a.current).includes(CSS.escape(y.animationName));if(y.target===s&&j&&(d("ANIMATION_END"),!i.current)){const w=s.style.animationFillMode;s.style.animationFillMode="forwards",u=m.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=w)})}},g=y=>{y.target===s&&(l.current=y1(a.current))};return s.addEventListener("animationstart",g),s.addEventListener("animationcancel",x),s.addEventListener("animationend",x),()=>{m.clearTimeout(u),s.removeEventListener("animationstart",g),s.removeEventListener("animationcancel",x),s.removeEventListener("animationend",x)}}else d("ANIMATION_END")},[s,d]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:p.useCallback(u=>{a.current=u?getComputedStyle(u):null,r(u)},[])}}function y1(t){return(t==null?void 0:t.animationName)||"none"}function Z1e(t){var a,i;let s=(a=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:a.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var LC="rovingFocusGroup.onEntryFocus",J1e={bubbles:!1,cancelable:!0},uy="RovingFocusGroup",[u4,iq,eve]=IT(uy),[tve,w2]=fc(uy,[eve]),[sve,nve]=tve(uy),lq=p.forwardRef((t,s)=>n.jsx(u4.Provider,{scope:t.__scopeRovingFocusGroup,children:n.jsx(u4.Slot,{scope:t.__scopeRovingFocusGroup,children:n.jsx(rve,{...t,ref:s})})}));lq.displayName=uy;var rve=p.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:r,orientation:a,loop:i=!1,dir:l,currentTabStopId:o,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:d,onEntryFocus:u,preventScrollOnEntryFocus:m=!1,...x}=t,g=p.useRef(null),y=Fs(s,g),v=cy(l),[j,w]=pm({prop:o,defaultProp:c??null,onChange:d,caller:uy}),[S,E]=p.useState(!1),k=Ha(u),A=iq(r),I=p.useRef(!1),[P,O]=p.useState(0);return p.useEffect(()=>{const D=g.current;if(D)return D.addEventListener(LC,k),()=>D.removeEventListener(LC,k)},[k]),n.jsx(sve,{scope:r,orientation:a,dir:v,loop:i,currentTabStopId:j,onItemFocus:p.useCallback(D=>w(D),[w]),onItemShiftTab:p.useCallback(()=>E(!0),[]),onFocusableItemAdd:p.useCallback(()=>O(D=>D+1),[]),onFocusableItemRemove:p.useCallback(()=>O(D=>D-1),[]),children:n.jsx(us.div,{tabIndex:S||P===0?-1:0,"data-orientation":a,...x,ref:y,style:{outline:"none",...t.style},onMouseDown:zt(t.onMouseDown,()=>{I.current=!0}),onFocus:zt(t.onFocus,D=>{const T=!I.current;if(D.target===D.currentTarget&&T&&!S){const B=new CustomEvent(LC,J1e);if(D.currentTarget.dispatchEvent(B),!B.defaultPrevented){const U=A().filter(G=>G.focusable),W=U.find(G=>G.active),V=U.find(G=>G.id===j),F=[W,V,...U].filter(Boolean).map(G=>G.ref.current);dq(F,m)}}I.current=!1}),onBlur:zt(t.onBlur,()=>E(!1))})})}),oq="RovingFocusGroupItem",cq=p.forwardRef((t,s)=>{const{__scopeRovingFocusGroup:r,focusable:a=!0,active:i=!1,tabStopId:l,children:o,...c}=t,d=td(),u=l||d,m=nve(oq,r),x=m.currentTabStopId===u,g=iq(r),{onFocusableItemAdd:y,onFocusableItemRemove:v,currentTabStopId:j}=m;return p.useEffect(()=>{if(a)return y(),()=>v()},[a,y,v]),n.jsx(u4.ItemSlot,{scope:r,id:u,focusable:a,active:i,children:n.jsx(us.span,{tabIndex:x?0:-1,"data-orientation":m.orientation,...c,ref:s,onMouseDown:zt(t.onMouseDown,w=>{a?m.onItemFocus(u):w.preventDefault()}),onFocus:zt(t.onFocus,()=>m.onItemFocus(u)),onKeyDown:zt(t.onKeyDown,w=>{if(w.key==="Tab"&&w.shiftKey){m.onItemShiftTab();return}if(w.target!==w.currentTarget)return;const S=lve(w,m.orientation,m.dir);if(S!==void 0){if(w.metaKey||w.ctrlKey||w.altKey||w.shiftKey)return;w.preventDefault();let k=g().filter(A=>A.focusable).map(A=>A.ref.current);if(S==="last")k.reverse();else if(S==="prev"||S==="next"){S==="prev"&&k.reverse();const A=k.indexOf(w.currentTarget);k=m.loop?ove(k,A+1):k.slice(A+1)}setTimeout(()=>dq(k))}}),children:typeof o=="function"?o({isCurrentTabStop:x,hasTabStop:j!=null}):o})})});cq.displayName=oq;var ave={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ive(t,s){return s!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function lve(t,s,r){const a=ive(t.key,r);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return ave[a]}function dq(t,s=!1){const r=document.activeElement;for(const a of t)if(a===r||(a.focus({preventScroll:s}),document.activeElement!==r))return}function ove(t,s){return t.map((r,a)=>t[(s+a)%t.length])}var uq=lq,mq=cq,cve=function(t){if(typeof document>"u")return null;var s=Array.isArray(t)?t[0]:t;return s.ownerDocument.body},Dx=new WeakMap,v1=new WeakMap,j1={},FC=0,hq=function(t){return t&&(t.host||hq(t.parentNode))},dve=function(t,s){return s.map(function(r){if(t.contains(r))return r;var a=hq(r);return a&&t.contains(a)?a:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},uve=function(t,s,r,a){var i=dve(s,Array.isArray(t)?t:[t]);j1[r]||(j1[r]=new WeakMap);var l=j1[r],o=[],c=new Set,d=new Set(i),u=function(x){!x||c.has(x)||(c.add(x),u(x.parentNode))};i.forEach(u);var m=function(x){!x||d.has(x)||Array.prototype.forEach.call(x.children,function(g){if(c.has(g))m(g);else try{var y=g.getAttribute(a),v=y!==null&&y!=="false",j=(Dx.get(g)||0)+1,w=(l.get(g)||0)+1;Dx.set(g,j),l.set(g,w),o.push(g),j===1&&v&&v1.set(g,!0),w===1&&g.setAttribute(r,"true"),v||g.setAttribute(a,"true")}catch(S){console.error("aria-hidden: cannot operate on ",g,S)}})};return m(s),c.clear(),FC++,function(){o.forEach(function(x){var g=Dx.get(x)-1,y=l.get(x)-1;Dx.set(x,g),l.set(x,y),g||(v1.has(x)||x.removeAttribute(a),v1.delete(x)),y||x.removeAttribute(r)}),FC--,FC||(Dx=new WeakMap,Dx=new WeakMap,v1=new WeakMap,j1={})}},WT=function(t,s,r){r===void 0&&(r="data-aria-hidden");var a=Array.from(Array.isArray(t)?t:[t]),i=cve(t);return i?(a.push.apply(a,Array.from(i.querySelectorAll("[aria-live], script"))),uve(a,i,r,"aria-hidden")):function(){return null}},Uc=function(){return Uc=Object.assign||function(s){for(var r,a=1,i=arguments.length;a<i;a++){r=arguments[a];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(s[l]=r[l])}return s},Uc.apply(this,arguments)};function xq(t,s){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&s.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(t);i<a.length;i++)s.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(r[a[i]]=t[a[i]]);return r}function mve(t,s,r){if(r||arguments.length===2)for(var a=0,i=s.length,l;a<i;a++)(l||!(a in s))&&(l||(l=Array.prototype.slice.call(s,0,a)),l[a]=s[a]);return t.concat(l||Array.prototype.slice.call(s))}var uj="right-scroll-bar-position",mj="width-before-scroll-bar",hve="with-scroll-bars-hidden",xve="--removed-body-scroll-bar-size";function BC(t,s){return typeof t=="function"?t(s):t&&(t.current=s),t}function pve(t,s){var r=p.useState(function(){return{value:t,callback:s,facade:{get current(){return r.value},set current(a){var i=r.value;i!==a&&(r.value=a,r.callback(a,i))}}}})[0];return r.callback=s,r.facade}var fve=typeof window<"u"?p.useLayoutEffect:p.useEffect,Z6=new WeakMap;function gve(t,s){var r=pve(null,function(a){return t.forEach(function(i){return BC(i,a)})});return fve(function(){var a=Z6.get(r);if(a){var i=new Set(a),l=new Set(t),o=r.current;i.forEach(function(c){l.has(c)||BC(c,null)}),l.forEach(function(c){i.has(c)||BC(c,o)})}Z6.set(r,t)},[t]),r}function bve(t){return t}function yve(t,s){s===void 0&&(s=bve);var r=[],a=!1,i={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(l){var o=s(l,a);return r.push(o),function(){r=r.filter(function(c){return c!==o})}},assignSyncMedium:function(l){for(a=!0;r.length;){var o=r;r=[],o.forEach(l)}r={push:function(c){return l(c)},filter:function(){return r}}},assignMedium:function(l){a=!0;var o=[];if(r.length){var c=r;r=[],c.forEach(l),o=r}var d=function(){var m=o;o=[],m.forEach(l)},u=function(){return Promise.resolve().then(d)};u(),r={push:function(m){o.push(m),u()},filter:function(m){return o=o.filter(m),r}}}};return i}function vve(t){t===void 0&&(t={});var s=yve(null);return s.options=Uc({async:!0,ssr:!1},t),s}var pq=function(t){var s=t.sideCar,r=xq(t,["sideCar"]);if(!s)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=s.read();if(!a)throw new Error("Sidecar medium not found");return p.createElement(a,Uc({},r))};pq.isSideCarExport=!0;function jve(t,s){return t.useMedium(s),pq}var fq=vve(),$C=function(){},_2=p.forwardRef(function(t,s){var r=p.useRef(null),a=p.useState({onScrollCapture:$C,onWheelCapture:$C,onTouchMoveCapture:$C}),i=a[0],l=a[1],o=t.forwardProps,c=t.children,d=t.className,u=t.removeScrollBar,m=t.enabled,x=t.shards,g=t.sideCar,y=t.noRelative,v=t.noIsolation,j=t.inert,w=t.allowPinchZoom,S=t.as,E=S===void 0?"div":S,k=t.gapMode,A=xq(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),I=g,P=gve([r,s]),O=Uc(Uc({},A),i);return p.createElement(p.Fragment,null,m&&p.createElement(I,{sideCar:fq,removeScrollBar:u,shards:x,noRelative:y,noIsolation:v,inert:j,setCallbacks:l,allowPinchZoom:!!w,lockRef:r,gapMode:k}),o?p.cloneElement(p.Children.only(c),Uc(Uc({},O),{ref:P})):p.createElement(E,Uc({},O,{className:d,ref:P}),c))});_2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};_2.classNames={fullWidth:mj,zeroRight:uj};var Nve=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function wve(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var s=Nve();return s&&t.setAttribute("nonce",s),t}function _ve(t,s){t.styleSheet?t.styleSheet.cssText=s:t.appendChild(document.createTextNode(s))}function Sve(t){var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(t)}var Cve=function(){var t=0,s=null;return{add:function(r){t==0&&(s=wve())&&(_ve(s,r),Sve(s)),t++},remove:function(){t--,!t&&s&&(s.parentNode&&s.parentNode.removeChild(s),s=null)}}},kve=function(){var t=Cve();return function(s,r){p.useEffect(function(){return t.add(s),function(){t.remove()}},[s&&r])}},gq=function(){var t=kve(),s=function(r){var a=r.styles,i=r.dynamic;return t(a,i),null};return s},Ave={left:0,top:0,right:0,gap:0},zC=function(t){return parseInt(t||"",10)||0},Eve=function(t){var s=window.getComputedStyle(document.body),r=s[t==="padding"?"paddingLeft":"marginLeft"],a=s[t==="padding"?"paddingTop":"marginTop"],i=s[t==="padding"?"paddingRight":"marginRight"];return[zC(r),zC(a),zC(i)]},Tve=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return Ave;var s=Eve(t),r=document.documentElement.clientWidth,a=window.innerWidth;return{left:s[0],top:s[1],right:s[2],gap:Math.max(0,a-r+s[2]-s[0])}},Pve=gq(),Rp="data-scroll-locked",Dve=function(t,s,r,a){var i=t.left,l=t.top,o=t.right,c=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(hve,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(c,"px ").concat(a,`;
  }
  body[`).concat(Rp,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([s&&"position: relative ".concat(a,";"),r==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(a,`;
    `),r==="padding"&&"padding-right: ".concat(c,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(uj,` {
    right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(mj,` {
    margin-right: `).concat(c,"px ").concat(a,`;
  }
  
  .`).concat(uj," .").concat(uj,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(mj," .").concat(mj,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(Rp,`] {
    `).concat(xve,": ").concat(c,`px;
  }
`)},J6=function(){var t=parseInt(document.body.getAttribute(Rp)||"0",10);return isFinite(t)?t:0},Mve=function(){p.useEffect(function(){return document.body.setAttribute(Rp,(J6()+1).toString()),function(){var t=J6()-1;t<=0?document.body.removeAttribute(Rp):document.body.setAttribute(Rp,t.toString())}},[])},Ive=function(t){var s=t.noRelative,r=t.noImportant,a=t.gapMode,i=a===void 0?"margin":a;Mve();var l=p.useMemo(function(){return Tve(i)},[i]);return p.createElement(Pve,{styles:Dve(l,!s,i,r?"":"!important")})},m4=!1;if(typeof window<"u")try{var N1=Object.defineProperty({},"passive",{get:function(){return m4=!0,!0}});window.addEventListener("test",N1,N1),window.removeEventListener("test",N1,N1)}catch{m4=!1}var Mx=m4?{passive:!1}:!1,Ove=function(t){return t.tagName==="TEXTAREA"},bq=function(t,s){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[s]!=="hidden"&&!(r.overflowY===r.overflowX&&!Ove(t)&&r[s]==="visible")},Rve=function(t){return bq(t,"overflowY")},Lve=function(t){return bq(t,"overflowX")},e8=function(t,s){var r=s.ownerDocument,a=s;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var i=yq(t,a);if(i){var l=vq(t,a),o=l[1],c=l[2];if(o>c)return!0}a=a.parentNode}while(a&&a!==r.body);return!1},Fve=function(t){var s=t.scrollTop,r=t.scrollHeight,a=t.clientHeight;return[s,r,a]},Bve=function(t){var s=t.scrollLeft,r=t.scrollWidth,a=t.clientWidth;return[s,r,a]},yq=function(t,s){return t==="v"?Rve(s):Lve(s)},vq=function(t,s){return t==="v"?Fve(s):Bve(s)},$ve=function(t,s){return t==="h"&&s==="rtl"?-1:1},zve=function(t,s,r,a,i){var l=$ve(t,window.getComputedStyle(s).direction),o=l*a,c=r.target,d=s.contains(c),u=!1,m=o>0,x=0,g=0;do{if(!c)break;var y=vq(t,c),v=y[0],j=y[1],w=y[2],S=j-w-l*v;(v||S)&&yq(t,c)&&(x+=S,g+=v);var E=c.parentNode;c=E&&E.nodeType===Node.DOCUMENT_FRAGMENT_NODE?E.host:E}while(!d&&c!==document.body||d&&(s.contains(c)||s===c));return(m&&Math.abs(x)<1||!m&&Math.abs(g)<1)&&(u=!0),u},w1=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},t8=function(t){return[t.deltaX,t.deltaY]},s8=function(t){return t&&"current"in t?t.current:t},Uve=function(t,s){return t[0]===s[0]&&t[1]===s[1]},Vve=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Hve=0,Ix=[];function Wve(t){var s=p.useRef([]),r=p.useRef([0,0]),a=p.useRef(),i=p.useState(Hve++)[0],l=p.useState(gq)[0],o=p.useRef(t);p.useEffect(function(){o.current=t},[t]),p.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var j=mve([t.lockRef.current],(t.shards||[]).map(s8),!0).filter(Boolean);return j.forEach(function(w){return w.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),j.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var c=p.useCallback(function(j,w){if("touches"in j&&j.touches.length===2||j.type==="wheel"&&j.ctrlKey)return!o.current.allowPinchZoom;var S=w1(j),E=r.current,k="deltaX"in j?j.deltaX:E[0]-S[0],A="deltaY"in j?j.deltaY:E[1]-S[1],I,P=j.target,O=Math.abs(k)>Math.abs(A)?"h":"v";if("touches"in j&&O==="h"&&P.type==="range")return!1;var D=e8(O,P);if(!D)return!0;if(D?I=O:(I=O==="v"?"h":"v",D=e8(O,P)),!D)return!1;if(!a.current&&"changedTouches"in j&&(k||A)&&(a.current=I),!I)return!0;var T=a.current||I;return zve(T,w,j,T==="h"?k:A)},[]),d=p.useCallback(function(j){var w=j;if(!(!Ix.length||Ix[Ix.length-1]!==l)){var S="deltaY"in w?t8(w):w1(w),E=s.current.filter(function(I){return I.name===w.type&&(I.target===w.target||w.target===I.shadowParent)&&Uve(I.delta,S)})[0];if(E&&E.should){w.cancelable&&w.preventDefault();return}if(!E){var k=(o.current.shards||[]).map(s8).filter(Boolean).filter(function(I){return I.contains(w.target)}),A=k.length>0?c(w,k[0]):!o.current.noIsolation;A&&w.cancelable&&w.preventDefault()}}},[]),u=p.useCallback(function(j,w,S,E){var k={name:j,delta:w,target:S,should:E,shadowParent:qve(S)};s.current.push(k),setTimeout(function(){s.current=s.current.filter(function(A){return A!==k})},1)},[]),m=p.useCallback(function(j){r.current=w1(j),a.current=void 0},[]),x=p.useCallback(function(j){u(j.type,t8(j),j.target,c(j,t.lockRef.current))},[]),g=p.useCallback(function(j){u(j.type,w1(j),j.target,c(j,t.lockRef.current))},[]);p.useEffect(function(){return Ix.push(l),t.setCallbacks({onScrollCapture:x,onWheelCapture:x,onTouchMoveCapture:g}),document.addEventListener("wheel",d,Mx),document.addEventListener("touchmove",d,Mx),document.addEventListener("touchstart",m,Mx),function(){Ix=Ix.filter(function(j){return j!==l}),document.removeEventListener("wheel",d,Mx),document.removeEventListener("touchmove",d,Mx),document.removeEventListener("touchstart",m,Mx)}},[]);var y=t.removeScrollBar,v=t.inert;return p.createElement(p.Fragment,null,v?p.createElement(l,{styles:Vve(i)}):null,y?p.createElement(Ive,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function qve(t){for(var s=null;t!==null;)t instanceof ShadowRoot&&(s=t.host,t=t.host),t=t.parentNode;return s}const Gve=jve(fq,Wve);var S2=p.forwardRef(function(t,s){return p.createElement(_2,Uc({},t,{ref:s,sideCar:Gve}))});S2.classNames=_2.classNames;var h4=["Enter"," "],Kve=["ArrowDown","PageUp","Home"],jq=["ArrowUp","PageDown","End"],Yve=[...Kve,...jq],Xve={ltr:[...h4,"ArrowRight"],rtl:[...h4,"ArrowLeft"]},Qve={ltr:["ArrowLeft"],rtl:["ArrowRight"]},my="Menu",[xb,Zve,Jve]=IT(my),[mx,Nq]=fc(my,[Jve,j2,w2]),C2=j2(),wq=w2(),[eje,hx]=mx(my),[tje,hy]=mx(my),_q=t=>{const{__scopeMenu:s,open:r=!1,children:a,dir:i,onOpenChange:l,modal:o=!0}=t,c=C2(s),[d,u]=p.useState(null),m=p.useRef(!1),x=Ha(l),g=cy(i);return p.useEffect(()=>{const y=()=>{m.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>m.current=!1;return document.addEventListener("keydown",y,{capture:!0}),()=>{document.removeEventListener("keydown",y,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),n.jsx(sq,{...c,children:n.jsx(eje,{scope:s,open:r,onOpenChange:x,content:d,onContentChange:u,children:n.jsx(tje,{scope:s,onClose:p.useCallback(()=>x(!1),[x]),isUsingKeyboardRef:m,dir:g,modal:o,children:a})})})};_q.displayName=my;var sje="MenuAnchor",qT=p.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t,i=C2(r);return n.jsx(nq,{...i,...a,ref:s})});qT.displayName=sje;var GT="MenuPortal",[nje,Sq]=mx(GT,{forceMount:void 0}),Cq=t=>{const{__scopeMenu:s,forceMount:r,children:a,container:i}=t,l=hx(GT,s);return n.jsx(nje,{scope:s,forceMount:r,children:n.jsx(fl,{present:r||l.open,children:n.jsx(N2,{asChild:!0,container:i,children:a})})})};Cq.displayName=GT;var Ao="MenuContent",[rje,KT]=mx(Ao),kq=p.forwardRef((t,s)=>{const r=Sq(Ao,t.__scopeMenu),{forceMount:a=r.forceMount,...i}=t,l=hx(Ao,t.__scopeMenu),o=hy(Ao,t.__scopeMenu);return n.jsx(xb.Provider,{scope:t.__scopeMenu,children:n.jsx(fl,{present:a||l.open,children:n.jsx(xb.Slot,{scope:t.__scopeMenu,children:o.modal?n.jsx(aje,{...i,ref:s}):n.jsx(ije,{...i,ref:s})})})})}),aje=p.forwardRef((t,s)=>{const r=hx(Ao,t.__scopeMenu),a=p.useRef(null),i=Fs(s,a);return p.useEffect(()=>{const l=a.current;if(l)return WT(l)},[]),n.jsx(YT,{...t,ref:i,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:zt(t.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),ije=p.forwardRef((t,s)=>{const r=hx(Ao,t.__scopeMenu);return n.jsx(YT,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),lje=Hh("MenuContent.ScrollLock"),YT=p.forwardRef((t,s)=>{const{__scopeMenu:r,loop:a=!1,trapFocus:i,onOpenAutoFocus:l,onCloseAutoFocus:o,disableOutsidePointerEvents:c,onEntryFocus:d,onEscapeKeyDown:u,onPointerDownOutside:m,onFocusOutside:x,onInteractOutside:g,onDismiss:y,disableOutsideScroll:v,...j}=t,w=hx(Ao,r),S=hy(Ao,r),E=C2(r),k=wq(r),A=Zve(r),[I,P]=p.useState(null),O=p.useRef(null),D=Fs(s,O,w.onContentChange),T=p.useRef(0),B=p.useRef(""),U=p.useRef(0),W=p.useRef(null),V=p.useRef("right"),R=p.useRef(0),F=v?S2:p.Fragment,G=v?{as:lje,allowPinchZoom:!0}:void 0,H=K=>{var ee,X;const le=B.current+K,se=A().filter(Z=>!Z.disabled),J=document.activeElement,ie=(ee=se.find(Z=>Z.ref.current===J))==null?void 0:ee.textValue,te=se.map(Z=>Z.textValue),ne=yje(te,le,ie),q=(X=se.find(Z=>Z.textValue===ne))==null?void 0:X.ref.current;(function Z(Y){B.current=Y,window.clearTimeout(T.current),Y!==""&&(T.current=window.setTimeout(()=>Z(""),1e3))})(le),q&&setTimeout(()=>q.focus())};p.useEffect(()=>()=>window.clearTimeout(T.current),[]),OT();const $=p.useCallback(K=>{var se,J;return V.current===((se=W.current)==null?void 0:se.side)&&jje(K,(J=W.current)==null?void 0:J.area)},[]);return n.jsx(rje,{scope:r,searchRef:B,onItemEnter:p.useCallback(K=>{$(K)&&K.preventDefault()},[$]),onItemLeave:p.useCallback(K=>{var le;$(K)||((le=O.current)==null||le.focus(),P(null))},[$]),onTriggerLeave:p.useCallback(K=>{$(K)&&K.preventDefault()},[$]),pointerGraceTimerRef:U,onPointerGraceIntentChange:p.useCallback(K=>{W.current=K},[]),children:n.jsx(F,{...G,children:n.jsx(f2,{asChild:!0,trapped:i,onMountAutoFocus:zt(l,K=>{var le;K.preventDefault(),(le=O.current)==null||le.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:n.jsx(p2,{asChild:!0,disableOutsidePointerEvents:c,onEscapeKeyDown:u,onPointerDownOutside:m,onFocusOutside:x,onInteractOutside:g,onDismiss:y,children:n.jsx(uq,{asChild:!0,...k,dir:S.dir,orientation:"vertical",loop:a,currentTabStopId:I,onCurrentTabStopIdChange:P,onEntryFocus:zt(d,K=>{S.isUsingKeyboardRef.current||K.preventDefault()}),preventScrollOnEntryFocus:!0,children:n.jsx(rq,{role:"menu","aria-orientation":"vertical","data-state":Vq(w.open),"data-radix-menu-content":"",dir:S.dir,...E,...j,ref:D,style:{outline:"none",...j.style},onKeyDown:zt(j.onKeyDown,K=>{const se=K.target.closest("[data-radix-menu-content]")===K.currentTarget,J=K.ctrlKey||K.altKey||K.metaKey,ie=K.key.length===1;se&&(K.key==="Tab"&&K.preventDefault(),!J&&ie&&H(K.key));const te=O.current;if(K.target!==te||!Yve.includes(K.key))return;K.preventDefault();const q=A().filter(ee=>!ee.disabled).map(ee=>ee.ref.current);jq.includes(K.key)&&q.reverse(),gje(q)}),onBlur:zt(t.onBlur,K=>{K.currentTarget.contains(K.target)||(window.clearTimeout(T.current),B.current="")}),onPointerMove:zt(t.onPointerMove,pb(K=>{const le=K.target,se=R.current!==K.clientX;if(K.currentTarget.contains(le)&&se){const J=K.clientX>R.current?"right":"left";V.current=J,R.current=K.clientX}}))})})})})})})});kq.displayName=Ao;var oje="MenuGroup",XT=p.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return n.jsx(us.div,{role:"group",...a,ref:s})});XT.displayName=oje;var cje="MenuLabel",Aq=p.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return n.jsx(us.div,{...a,ref:s})});Aq.displayName=cje;var xN="MenuItem",n8="menu.itemSelect",k2=p.forwardRef((t,s)=>{const{disabled:r=!1,onSelect:a,...i}=t,l=p.useRef(null),o=hy(xN,t.__scopeMenu),c=KT(xN,t.__scopeMenu),d=Fs(s,l),u=p.useRef(!1),m=()=>{const x=l.current;if(!r&&x){const g=new CustomEvent(n8,{bubbles:!0,cancelable:!0});x.addEventListener(n8,y=>a==null?void 0:a(y),{once:!0}),PW(x,g),g.defaultPrevented?u.current=!1:o.onClose()}};return n.jsx(Eq,{...i,ref:d,disabled:r,onClick:zt(t.onClick,m),onPointerDown:x=>{var g;(g=t.onPointerDown)==null||g.call(t,x),u.current=!0},onPointerUp:zt(t.onPointerUp,x=>{var g;u.current||(g=x.currentTarget)==null||g.click()}),onKeyDown:zt(t.onKeyDown,x=>{const g=c.searchRef.current!=="";r||g&&x.key===" "||h4.includes(x.key)&&(x.currentTarget.click(),x.preventDefault())})})});k2.displayName=xN;var Eq=p.forwardRef((t,s)=>{const{__scopeMenu:r,disabled:a=!1,textValue:i,...l}=t,o=KT(xN,r),c=wq(r),d=p.useRef(null),u=Fs(s,d),[m,x]=p.useState(!1),[g,y]=p.useState("");return p.useEffect(()=>{const v=d.current;v&&y((v.textContent??"").trim())},[l.children]),n.jsx(xb.ItemSlot,{scope:r,disabled:a,textValue:i??g,children:n.jsx(mq,{asChild:!0,...c,focusable:!a,children:n.jsx(us.div,{role:"menuitem","data-highlighted":m?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...l,ref:u,onPointerMove:zt(t.onPointerMove,pb(v=>{a?o.onItemLeave(v):(o.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:zt(t.onPointerLeave,pb(v=>o.onItemLeave(v))),onFocus:zt(t.onFocus,()=>x(!0)),onBlur:zt(t.onBlur,()=>x(!1))})})})}),dje="MenuCheckboxItem",Tq=p.forwardRef((t,s)=>{const{checked:r=!1,onCheckedChange:a,...i}=t;return n.jsx(Oq,{scope:t.__scopeMenu,checked:r,children:n.jsx(k2,{role:"menuitemcheckbox","aria-checked":pN(r)?"mixed":r,...i,ref:s,"data-state":ZT(r),onSelect:zt(i.onSelect,()=>a==null?void 0:a(pN(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Tq.displayName=dje;var Pq="MenuRadioGroup",[uje,mje]=mx(Pq,{value:void 0,onValueChange:()=>{}}),Dq=p.forwardRef((t,s)=>{const{value:r,onValueChange:a,...i}=t,l=Ha(a);return n.jsx(uje,{scope:t.__scopeMenu,value:r,onValueChange:l,children:n.jsx(XT,{...i,ref:s})})});Dq.displayName=Pq;var Mq="MenuRadioItem",Iq=p.forwardRef((t,s)=>{const{value:r,...a}=t,i=mje(Mq,t.__scopeMenu),l=r===i.value;return n.jsx(Oq,{scope:t.__scopeMenu,checked:l,children:n.jsx(k2,{role:"menuitemradio","aria-checked":l,...a,ref:s,"data-state":ZT(l),onSelect:zt(a.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,r)},{checkForDefaultPrevented:!1})})})});Iq.displayName=Mq;var QT="MenuItemIndicator",[Oq,hje]=mx(QT,{checked:!1}),Rq=p.forwardRef((t,s)=>{const{__scopeMenu:r,forceMount:a,...i}=t,l=hje(QT,r);return n.jsx(fl,{present:a||pN(l.checked)||l.checked===!0,children:n.jsx(us.span,{...i,ref:s,"data-state":ZT(l.checked)})})});Rq.displayName=QT;var xje="MenuSeparator",Lq=p.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t;return n.jsx(us.div,{role:"separator","aria-orientation":"horizontal",...a,ref:s})});Lq.displayName=xje;var pje="MenuArrow",Fq=p.forwardRef((t,s)=>{const{__scopeMenu:r,...a}=t,i=C2(r);return n.jsx(aq,{...i,...a,ref:s})});Fq.displayName=pje;var fje="MenuSub",[UZe,Bq]=mx(fje),ng="MenuSubTrigger",$q=p.forwardRef((t,s)=>{const r=hx(ng,t.__scopeMenu),a=hy(ng,t.__scopeMenu),i=Bq(ng,t.__scopeMenu),l=KT(ng,t.__scopeMenu),o=p.useRef(null),{pointerGraceTimerRef:c,onPointerGraceIntentChange:d}=l,u={__scopeMenu:t.__scopeMenu},m=p.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return p.useEffect(()=>m,[m]),p.useEffect(()=>{const x=c.current;return()=>{window.clearTimeout(x),d(null)}},[c,d]),n.jsx(qT,{asChild:!0,...u,children:n.jsx(Eq,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":i.contentId,"data-state":Vq(r.open),...t,ref:x2(s,i.onTriggerChange),onClick:x=>{var g;(g=t.onClick)==null||g.call(t,x),!(t.disabled||x.defaultPrevented)&&(x.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:zt(t.onPointerMove,pb(x=>{l.onItemEnter(x),!x.defaultPrevented&&!t.disabled&&!r.open&&!o.current&&(l.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{r.onOpenChange(!0),m()},100))})),onPointerLeave:zt(t.onPointerLeave,pb(x=>{var y,v;m();const g=(y=r.content)==null?void 0:y.getBoundingClientRect();if(g){const j=(v=r.content)==null?void 0:v.dataset.side,w=j==="right",S=w?-5:5,E=g[w?"left":"right"],k=g[w?"right":"left"];l.onPointerGraceIntentChange({area:[{x:x.clientX+S,y:x.clientY},{x:E,y:g.top},{x:k,y:g.top},{x:k,y:g.bottom},{x:E,y:g.bottom}],side:j}),window.clearTimeout(c.current),c.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(x),x.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:zt(t.onKeyDown,x=>{var y;const g=l.searchRef.current!=="";t.disabled||g&&x.key===" "||Xve[a.dir].includes(x.key)&&(r.onOpenChange(!0),(y=r.content)==null||y.focus(),x.preventDefault())})})})});$q.displayName=ng;var zq="MenuSubContent",Uq=p.forwardRef((t,s)=>{const r=Sq(Ao,t.__scopeMenu),{forceMount:a=r.forceMount,...i}=t,l=hx(Ao,t.__scopeMenu),o=hy(Ao,t.__scopeMenu),c=Bq(zq,t.__scopeMenu),d=p.useRef(null),u=Fs(s,d);return n.jsx(xb.Provider,{scope:t.__scopeMenu,children:n.jsx(fl,{present:a||l.open,children:n.jsx(xb.Slot,{scope:t.__scopeMenu,children:n.jsx(YT,{id:c.contentId,"aria-labelledby":c.triggerId,...i,ref:u,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:m=>{var x;o.isUsingKeyboardRef.current&&((x=d.current)==null||x.focus()),m.preventDefault()},onCloseAutoFocus:m=>m.preventDefault(),onFocusOutside:zt(t.onFocusOutside,m=>{m.target!==c.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:zt(t.onEscapeKeyDown,m=>{o.onClose(),m.preventDefault()}),onKeyDown:zt(t.onKeyDown,m=>{var y;const x=m.currentTarget.contains(m.target),g=Qve[o.dir].includes(m.key);x&&g&&(l.onOpenChange(!1),(y=c.trigger)==null||y.focus(),m.preventDefault())})})})})})});Uq.displayName=zq;function Vq(t){return t?"open":"closed"}function pN(t){return t==="indeterminate"}function ZT(t){return pN(t)?"indeterminate":t?"checked":"unchecked"}function gje(t){const s=document.activeElement;for(const r of t)if(r===s||(r.focus(),document.activeElement!==s))return}function bje(t,s){return t.map((r,a)=>t[(s+a)%t.length])}function yje(t,s,r){const i=s.length>1&&Array.from(s).every(u=>u===s[0])?s[0]:s,l=r?t.indexOf(r):-1;let o=bje(t,Math.max(l,0));i.length===1&&(o=o.filter(u=>u!==r));const d=o.find(u=>u.toLowerCase().startsWith(i.toLowerCase()));return d!==r?d:void 0}function vje(t,s){const{x:r,y:a}=t;let i=!1;for(let l=0,o=s.length-1;l<s.length;o=l++){const c=s[l],d=s[o],u=c.x,m=c.y,x=d.x,g=d.y;m>a!=g>a&&r<(x-u)*(a-m)/(g-m)+u&&(i=!i)}return i}function jje(t,s){if(!s)return!1;const r={x:t.clientX,y:t.clientY};return vje(r,s)}function pb(t){return s=>s.pointerType==="mouse"?t(s):void 0}var Nje=_q,wje=qT,_je=Cq,Sje=kq,Cje=XT,kje=Aq,Aje=k2,Eje=Tq,Tje=Dq,Pje=Iq,Dje=Rq,Mje=Lq,Ije=Fq,Oje=$q,Rje=Uq,A2="DropdownMenu",[Lje]=fc(A2,[Nq]),Ri=Nq(),[Fje,Hq]=Lje(A2),Wq=t=>{const{__scopeDropdownMenu:s,children:r,dir:a,open:i,defaultOpen:l,onOpenChange:o,modal:c=!0}=t,d=Ri(s),u=p.useRef(null),[m,x]=pm({prop:i,defaultProp:l??!1,onChange:o,caller:A2});return n.jsx(Fje,{scope:s,triggerId:td(),triggerRef:u,contentId:td(),open:m,onOpenChange:x,onOpenToggle:p.useCallback(()=>x(g=>!g),[x]),modal:c,children:n.jsx(Nje,{...d,open:m,onOpenChange:x,dir:a,modal:c,children:r})})};Wq.displayName=A2;var qq="DropdownMenuTrigger",Gq=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,disabled:a=!1,...i}=t,l=Hq(qq,r),o=Ri(r);return n.jsx(wje,{asChild:!0,...o,children:n.jsx(us.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...i,ref:x2(s,l.triggerRef),onPointerDown:zt(t.onPointerDown,c=>{!a&&c.button===0&&c.ctrlKey===!1&&(l.onOpenToggle(),l.open||c.preventDefault())}),onKeyDown:zt(t.onKeyDown,c=>{a||(["Enter"," "].includes(c.key)&&l.onOpenToggle(),c.key==="ArrowDown"&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(c.key)&&c.preventDefault())})})})});Gq.displayName=qq;var Bje="DropdownMenuPortal",Kq=t=>{const{__scopeDropdownMenu:s,...r}=t,a=Ri(s);return n.jsx(_je,{...a,...r})};Kq.displayName=Bje;var Yq="DropdownMenuContent",Xq=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Hq(Yq,r),l=Ri(r),o=p.useRef(!1);return n.jsx(Sje,{id:i.contentId,"aria-labelledby":i.triggerId,...l,...a,ref:s,onCloseAutoFocus:zt(t.onCloseAutoFocus,c=>{var d;o.current||(d=i.triggerRef.current)==null||d.focus(),o.current=!1,c.preventDefault()}),onInteractOutside:zt(t.onInteractOutside,c=>{const d=c.detail.originalEvent,u=d.button===0&&d.ctrlKey===!0,m=d.button===2||u;(!i.modal||m)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Xq.displayName=Yq;var $je="DropdownMenuGroup",zje=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Cje,{...i,...a,ref:s})});zje.displayName=$je;var Uje="DropdownMenuLabel",Qq=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(kje,{...i,...a,ref:s})});Qq.displayName=Uje;var Vje="DropdownMenuItem",Zq=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Aje,{...i,...a,ref:s})});Zq.displayName=Vje;var Hje="DropdownMenuCheckboxItem",Jq=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Eje,{...i,...a,ref:s})});Jq.displayName=Hje;var Wje="DropdownMenuRadioGroup",qje=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Tje,{...i,...a,ref:s})});qje.displayName=Wje;var Gje="DropdownMenuRadioItem",eG=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Pje,{...i,...a,ref:s})});eG.displayName=Gje;var Kje="DropdownMenuItemIndicator",tG=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Dje,{...i,...a,ref:s})});tG.displayName=Kje;var Yje="DropdownMenuSeparator",sG=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Mje,{...i,...a,ref:s})});sG.displayName=Yje;var Xje="DropdownMenuArrow",Qje=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Ije,{...i,...a,ref:s})});Qje.displayName=Xje;var Zje="DropdownMenuSubTrigger",nG=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Oje,{...i,...a,ref:s})});nG.displayName=Zje;var Jje="DropdownMenuSubContent",rG=p.forwardRef((t,s)=>{const{__scopeDropdownMenu:r,...a}=t,i=Ri(r);return n.jsx(Rje,{...i,...a,ref:s,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});rG.displayName=Jje;var eNe=Wq,tNe=Gq,sNe=Kq,aG=Xq,iG=Qq,lG=Zq,oG=Jq,cG=eG,dG=tG,uG=sG,mG=nG,hG=rG;const Vc=eNe,Hc=tNe,nNe=p.forwardRef(({className:t,inset:s,children:r,...a},i)=>n.jsxs(mG,{ref:i,className:Bt("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...a,children:[r,n.jsx(Ti,{className:"ml-auto"})]}));nNe.displayName=mG.displayName;const rNe=p.forwardRef(({className:t,...s},r)=>n.jsx(hG,{ref:r,className:Bt("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));rNe.displayName=hG.displayName;const tc=p.forwardRef(({className:t,sideOffset:s=4,...r},a)=>n.jsx(sNe,{children:n.jsx(aG,{ref:a,sideOffset:s,className:Bt("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...r})}));tc.displayName=aG.displayName;const kr=p.forwardRef(({className:t,inset:s,...r},a)=>n.jsx(lG,{ref:a,className:Bt("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...r}));kr.displayName=lG.displayName;const aNe=p.forwardRef(({className:t,children:s,checked:r,...a},i)=>n.jsxs(oG,{ref:i,className:Bt("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...a,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(dG,{children:n.jsx(So,{className:"h-4 w-4"})})}),s]}));aNe.displayName=oG.displayName;const iNe=p.forwardRef(({className:t,children:s,...r},a)=>n.jsxs(cG,{ref:a,className:Bt("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(dG,{children:n.jsx(Jde,{className:"h-2 w-2 fill-current"})})}),s]}));iNe.displayName=cG.displayName;const Yx=p.forwardRef(({className:t,inset:s,...r},a)=>n.jsx(iG,{ref:a,className:Bt("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...r}));Yx.displayName=iG.displayName;const Dd=p.forwardRef(({className:t,...s},r)=>n.jsx(uG,{ref:r,className:Bt("-mx-1 my-1 h-px bg-muted",t),...s}));Dd.displayName=uG.displayName;const xo=(...t)=>t.filter(Boolean).join(" "),_1={initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18}},$r={page:"min-h-[calc(100vh-4rem)] bg-slate-50 px-3 py-4 md:px-6 md:py-6 lg:px-8",container:"mx-auto max-w-6xl space-y-4 md:space-y-5 lg:space-y-6",card:"rounded-3xl border border-black/50 bg-white/85 backdrop-blur shadow-[0_1px_2px_rgba(0,0,0,0.06)]",inset:"rounded-3xl border border-black/50 bg-white/90 backdrop-blur shadow-[0_1px_2px_rgba(0,0,0,0.05)]",label:"text-[11px] font-semibold text-slate-600",input:"w-full rounded-2xl border border-black/50 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-black/20 focus:ring-2 focus:ring-black/10",inputSm:"w-full rounded-2xl border border-black/50 bg-white px-3 py-2 text-[13px] text-slate-900 outline-none focus:border-black/20 focus:ring-2 focus:ring-black/10",btn:"inline-flex items-center justify-center gap-2 rounded-2xl px-3 py-2 text-sm font-semibold transition active:scale-[0.99]",btnOutline:"inline-flex items-center justify-center gap-2 rounded-2xl px-3 py-2 text-sm font-semibold border border-black/50 bg-white hover:bg-black/[0.03] transition active:scale-[0.99]",badge:"inline-flex items-center rounded-full border border-black/50 bg-black/[0.03] px-2 py-0.5 text-[11px] font-semibold text-slate-700"};function lNe({value:t,onChange:s,options:r,className:a=""}){return n.jsx("div",{className:xo("inline-flex items-center rounded-2xl border border-black/50 bg-black/[0.03] p-1",a),children:r.map(i=>{const l=t===i.value;return n.jsx("button",{type:"button",onClick:()=>s(i.value),className:xo("h-9 px-3 rounded-xl text-[12px] font-semibold tracking-tight transition",l?"bg-white text-slate-900 border border-black/50 shadow-[0_1px_2px_rgba(0,0,0,0.08)]":"text-slate-600 hover:text-slate-800 hover:bg-white/60"),children:i.label},i.value)})})}function oNe({value:t,onChange:s,placeholder:r="Search",className:a=""}){return n.jsxs("div",{className:xo("relative w-full",a),children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{value:t,onChange:i=>s(i.target.value),placeholder:r,className:xo($r.inputSm,"pl-9 pr-9 bg-white/90")}),!!t&&n.jsx("button",{type:"button",onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 inline-flex h-8 w-8 items-center justify-center rounded-full hover:bg-black/[0.04]",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})})]})}function cNe({title:t,subtitle:s,onClose:r,children:a}){return n.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/35 backdrop-blur-sm p-0 sm:p-4",children:n.jsxs("div",{className:"w-full max-w-xl max-h-[92vh] overflow-y-auto rounded-t-3xl sm:rounded-3xl border border-black/50 bg-white/90 backdrop-blur-xl shadow-[0_20px_60px_rgba(0,0,0,0.22)] px-4 py-4 sm:px-5 sm:py-5",children:[n.jsxs("div",{className:"mb-4 flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("h3",{className:"text-[16px] sm:text-[18px] font-semibold text-slate-900 tracking-tight",children:t}),s?n.jsx("p",{className:"mt-1 text-[12px] sm:text-[13px] text-slate-500 leading-relaxed",children:s}):null]}),n.jsx("button",{onClick:r,type:"button",className:"rounded-full p-2 text-slate-500 hover:bg-black/[0.04] hover:text-slate-700",title:"Close",children:n.jsx(ts,{className:"h-4 w-4"})})]}),a]})})}function r8({title:t,right:s,children:r}){return n.jsxs("div",{className:"overflow-hidden rounded-3xl border border-black/50 bg-white/85 backdrop-blur",children:[(t||s)&&n.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3 border-b border-black/50 bg-white/80 backdrop-blur",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-700 tracking-tight",children:t}),n.jsx("div",{className:"flex items-center gap-2",children:s})]}),n.jsx("div",{className:"divide-y divide-black/5",children:r})]})}function dNe({canUpdate:t,canDelete:s,onEdit:r,onDelete:a}){return!t&&!s?null:n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-black/[0.04] text-slate-600",title:"Actions",onClick:i=>i.stopPropagation(),children:n.jsx(CV,{className:"h-4.5 w-4.5"})})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[t&&n.jsxs(kr,{onSelect:i=>{i.preventDefault(),r==null||r()},className:"cursor-pointer",children:[n.jsx(Yr,{className:"h-4 w-4 mr-2"}),"Edit"]}),t&&s&&n.jsx(Dd,{}),s&&n.jsxs(kr,{onSelect:i=>{i.preventDefault(),a==null||a()},className:"cursor-pointer text-rose-700 focus:text-rose-700",children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}function uNe({index:t,title:s,subtitle:r,canClick:a,onClick:i,canUpdate:l,canDelete:o,onEdit:c,onDelete:d}){return n.jsx("div",{role:a?"button":void 0,tabIndex:a?0:-1,onClick:a?i:void 0,onKeyDown:u=>{a&&(u.key==="Enter"||u.key===" ")&&(i==null||i())},className:xo("group px-4 py-3 transition",a?"cursor-pointer hover:bg-black/[0.02]":"cursor-default"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"mt-0.5 inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-black/[0.04] border border-black/50 text-[11px] font-semibold text-slate-600",children:t}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-[14px] sm:text-[15px] font-semibold text-slate-900 truncate",children:s}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-600 line-clamp-1",children:r||n.jsx("span",{className:"text-slate-400",children:"No description"})})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(dNe,{canUpdate:l,canDelete:o,onEdit:c,onDelete:d}),n.jsx(Ti,{className:"h-5 w-5 text-slate-300 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition"})]})]})})}function mNe(){return n.jsx("div",{className:"px-4 py-3",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"h-6 w-6 rounded-full bg-black/[0.06]"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-3 w-1/3 rounded-full bg-black/[0.06]"}),n.jsx("div",{className:"h-2.5 w-1/2 rounded-full bg-black/[0.05]"})]}),n.jsx("div",{className:"h-9 w-9 rounded-full bg-black/[0.05]"})]})})}function hNe({title:t,subtitle:s}){return n.jsxs("div",{className:"rounded-3xl border border-black/50 bg-white/80 p-6 text-center text-slate-600",children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] grid place-items-center",children:n.jsx(Xa,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:t}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:s})]})}function xNe(){const{hasAny:t,canView:s,canCreate:r,canUpdate:a,canDelete:i}=m2("departments"),[l,o]=p.useState([]),[c,d]=p.useState(""),[u,m]=p.useState(!1),[x,g]=p.useState(""),[y,v]=p.useState("all"),[j,w]=p.useState(!1),[S,E]=p.useState(null),[k,A]=p.useState({name:"",description:""}),[I,P]=p.useState(!1),O=p.useCallback(async()=>{var R,F,G;if(s){d(""),m(!0);try{const{data:H}=await he.get("/departments/");o(H||[])}catch(H){const $=(R=H==null?void 0:H.response)==null?void 0:R.status;d($===403?"Access denied for Departments.":$===401?"Session expired. Please login again.":((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to load departments.")}finally{m(!1)}}},[s]);p.useEffect(()=>{O()},[O]);const D=p.useMemo(()=>(l||[]).filter(R=>{if(!R)return!1;const F=(R.name||"").toLowerCase(),G=(R.description||"").toLowerCase(),H=x.toLowerCase().trim();return!(H&&!`${F} ${G}`.includes(H)||y==="withDesc"&&!R.description||y==="withoutDesc"&&R.description)}),[l,x,y]);if(!t||!s)return n.jsx("div",{className:$r.page,children:n.jsxs("div",{className:$r.container,children:[n.jsxs("div",{className:xo($r.card,"relative overflow-hidden text-white bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900"),children:[n.jsx("div",{className:"absolute inset-0 opacity-25 bg-[radial-gradient(circle_at_top,_#e5e7eb,_transparent_55%)]"}),n.jsxs("div",{className:"relative px-5 py-6 sm:px-7 sm:py-7 md:px-9 md:py-8 flex items-center gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-white/10 border border-white/20",children:n.jsx(Xa,{className:"w-6 h-6"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg md:text-xl font-semibold tracking-tight",children:"Departments"}),n.jsx("p",{className:"mt-1 text-xs sm:text-sm text-slate-100/90",children:"Configure clinical and support departments for your hospital."})]})]})]}),n.jsx("div",{className:xo($r.card,"p-4"),children:n.jsxs(ml,{className:"border-amber-200 bg-amber-50 text-amber-900 rounded-2xl",children:[n.jsx(hl,{className:"font-semibold",children:"Access restricted"}),n.jsx(xl,{className:"text-sm",children:"Your role does not currently include access to Departments configuration. Please contact your system administrator."})]})})]})});const T=()=>{r&&(E(null),A({name:"",description:""}),w(!0))},B=R=>{a&&(E(R.id),A({name:R.name||"",description:R.description||""}),w(!0))},U=()=>{w(!1),E(null),A({name:"",description:""})},W=async R=>{var F,G,H;if(R.preventDefault(),!(!S&&!r)&&!(S&&!a)){P(!0),d("");try{S?await he.put(`/departments/${S}`,k):await he.post("/departments/",k),U(),O()}catch($){const K=(F=$==null?void 0:$.response)==null?void 0:F.status;d(K===403?"Access denied.":K===401?"Session expired. Please login again.":((H=(G=$==null?void 0:$.response)==null?void 0:G.data)==null?void 0:H.detail)||"Failed to save department.")}finally{P(!1)}}},V=async R=>{var F,G,H;if(i&&window.confirm("Delete this department?"))try{await he.delete(`/departments/${R}`),O()}catch($){const K=(F=$==null?void 0:$.response)==null?void 0:F.status;d(K===403?"Access denied.":K===401?"Session expired. Please login again.":((H=(G=$==null?void 0:$.response)==null?void 0:G.data)==null?void 0:H.detail)||"Failed to delete department.")}};return n.jsx("div",{className:$r.page,children:n.jsxs("div",{className:$r.container,children:[n.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 text-xs",children:n.jsx(et,{variant:"outline",className:"rounded-full border-slate-500 bg-white px-2.5 py-1 text-[11px] font-medium tracking-wide text-slate-700",children:"Admin  Departments"})}),n.jsx(mt.div,{..._1,children:n.jsxs("div",{className:xo($r.card,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-teal-700 via-teal-600 to-blue-600 opacity-90"}),n.jsx("div",{className:"absolute inset-0 opacity-25 pointer-events-none bg-[radial-gradient(circle_at_top,_#e0f2fe,_transparent_55%)]"}),n.jsx("div",{className:"relative px-5 py-6 sm:px-7 sm:py-7 md:px-9 md:py-8 text-white",children:n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"max-w-2xl space-y-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-medium backdrop-blur-sm border border-white/20",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/20 text-[11px]",children:n.jsx(Xa,{className:"w-3.5 h-3.5"})}),"Core clinical & support structure"]}),n.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-semibold tracking-tight",children:"Clinical & Support Departments"}),n.jsx("p",{className:"text-sm md:text-base text-teal-50/90 leading-relaxed",children:"Keep OPD/IPD, diagnostics and support services aligned across the hospital."}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[n.jsx("span",{className:"inline-flex items-center rounded-full border border-white/25 bg-white/10 px-3 py-1 text-xs font-semibold",children:"Master configuration"}),n.jsx("span",{className:"inline-flex items-center rounded-full border border-white/20 bg-white/5 px-3 py-1 text-xs",children:"Used by OPD / IPD / Lab / OT"})]})]}),n.jsx("div",{className:"w-full md:w-auto",children:n.jsxs("div",{className:"rounded-3xl border border-white/20 bg-white/10 backdrop-blur px-4 py-3",children:[n.jsx("div",{className:"text-[10px] font-medium uppercase tracking-wide text-teal-100/90",children:"Departments"}),n.jsx("div",{className:"mt-1 text-2xl font-semibold text-white tabular-nums",children:l.length}),n.jsx("div",{className:"mt-1 text-[11px] text-teal-100/80",children:"Active list used across modules"})]})})]})})]})}),c&&n.jsx(mt.div,{..._1,children:n.jsxs(ml,{className:"rounded-2xl border-red-200 bg-red-50 text-red-800",children:[n.jsx(hl,{className:"font-semibold",children:"Issue"}),n.jsx(xl,{className:"text-sm",children:c})]})}),n.jsx(mt.div,{..._1,children:n.jsx("div",{className:xo($r.inset,"p-3 sm:p-4"),children:n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:$r.badge,children:["Total: ",n.jsx("span",{className:"ml-1 tabular-nums",children:l.length})]}),n.jsxs("span",{className:$r.badge,children:["Showing: ",n.jsx("span",{className:"ml-1 tabular-nums",children:D.length})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:$r.label,children:"Filter"}),n.jsx(lNe,{value:y,onChange:v,options:[{value:"all",label:"All"},{value:"withDesc",label:"With description"},{value:"withoutDesc",label:"Without description"}]})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-end",children:[n.jsx(oNe,{value:x,onChange:g,placeholder:"Search name or description",className:"sm:w-[320px]"}),r&&n.jsxs("button",{type:"button",onClick:T,className:xo($r.btn,"text-white shadow-sm bg-blue-600 hover:bg-blue-700"),children:[n.jsx(ds,{className:"h-4 w-4"}),"New"]})]})]})})}),n.jsx(mt.div,{..._1,children:u?n.jsx(r8,{title:"Department list",right:n.jsx("span",{className:$r.badge,children:"Loading"}),children:[0,1,2,3].map(R=>n.jsx(mNe,{},R))}):D.length===0?n.jsx(hNe,{title:"No departments found",subtitle:"Try changing your search/filter, or create a new department."}):n.jsx(r8,{title:"Department list",children:D.map((R,F)=>n.jsx(uNe,{index:F+1,title:R.name,subtitle:R.description,canClick:a,onClick:()=>B(R),canUpdate:a,canDelete:i,onEdit:()=>B(R),onDelete:()=>V(R.id)},R.id))})}),j&&n.jsx(cNe,{title:S?"Edit department":"New department",subtitle:"Departments are used in OPD/IPD registration, staff workflows, and reporting.",onClose:U,children:n.jsxs("form",{onSubmit:W,className:"space-y-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:$r.label,children:["Department name ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{className:$r.input,placeholder:"e.g., General Medicine",value:k.name,onChange:R=>A({...k,name:R.target.value}),required:!0,disabled:S?!a:!r})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:$r.label,children:"Description"}),n.jsx("input",{className:$r.input,placeholder:"Optional short description",value:k.description,onChange:R=>A({...k,description:R.target.value}),disabled:S?!a:!r})]}),n.jsxs("div",{className:"pt-2 flex flex-wrap items-center justify-between gap-2",children:[S&&i?n.jsxs("button",{type:"button",onClick:()=>V(S),className:"inline-flex items-center gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-700 hover:bg-rose-100/60",children:[n.jsx(Ms,{className:"h-4 w-4"}),"Delete"]}):n.jsx("div",{}),n.jsxs("div",{className:"ml-auto flex gap-2",children:[n.jsx("button",{type:"button",onClick:U,className:xo($r.btnOutline,"h-10"),children:"Cancel"}),n.jsx("button",{className:xo($r.btn,"h-10 text-white shadow-sm bg-blue-600 hover:bg-blue-700"),disabled:I||(S?!a:!r),children:I?"Saving":S?"Update":"Create"})]})]})]})})]})})}function Wn({anyOf:t=[],fallback:s=null,children:r}){const a=dn(d=>d.user),i=dn(d=>d.modules)||{};if(!!(a!=null&&a.is_admin))return r;const o=new Set(Object.values(i).flat().map(d=>typeof d=="string"?d:d==null?void 0:d.code).filter(Boolean));return t.length===0||t.some(d=>o.has(d))?r:s}const Pf=(t={})=>{const s={};return Object.entries(t).forEach(([r,a])=>{a!=null&&a!==""&&(s[r]=a)}),s},E2=()=>he.get("/ipd/wards"),pNe=t=>he.post("/ipd/wards",t),a8=(t,s)=>he.put(`/ipd/wards/${t}`,s),fNe=t=>he.delete(`/ipd/wards/${t}`),xy=(t={})=>he.get("/ipd/rooms",{params:Pf(t)}),gNe=t=>he.post("/ipd/rooms",t),i8=(t,s)=>he.put(`/ipd/rooms/${t}`,s),bNe=t=>he.delete(`/ipd/rooms/${t}`),Eo=(t={})=>he.get("/ipd/beds",{params:Pf(t)}),yNe=t=>he.post("/ipd/beds",t),l8=(t,s)=>he.put(`/ipd/beds/${t}`,s),vNe=t=>he.delete(`/ipd/beds/${t}`),jNe=(t,s)=>he.patch(`/ipd/beds/${t}/state`,null,{params:Pf(s)}),xG=()=>he.get("/ipd/packages"),NNe=t=>he.post("/ipd/packages",t),wNe=(t,s)=>he.put(`/ipd/packages/${t}`,s),_Ne=t=>he.delete(`/ipd/packages/${t}`),SNe=(t={})=>he.get("/ipd/bed-rates",{params:Pf(t)}),CNe=t=>he.post("/ipd/bed-rates",t),kNe=(t,s)=>he.put(`/ipd/bed-rates/${t}`,s),ANe=t=>he.delete(`/ipd/bed-rates/${t}`),T2=(t={})=>he.get("/ipd/admissions",{params:Pf(t)}),ENe=t=>he.post("/ipd/admissions",t),pG=async t=>{var s,r;try{return await he.get(`/ipd/admissions/${t}`)}catch(a){const i=(s=a==null?void 0:a.response)==null?void 0:s.status;if(i===404||i===405)try{return await he.get(`/ipd/admission/${t}`)}catch(l){const o=(r=l==null?void 0:l.response)==null?void 0:r.status;if(o===404||o===405){const{data:c=[]}=await he.get("/ipd/admissions",{params:{limit:500}}),d=(c||[]).find(u=>Number(u==null?void 0:u.id)===Number(t));if(!d){const u=new Error("Not found");throw u.status=404,u}return{data:d}}throw l}throw a}},TNe=t=>he.patch(`/ipd/admissions/${t}/cancel`),PNe=(t,s)=>he.post(`/ipd/admissions/${t}/transfer`,s),DNe=t=>he.get(`/ipd/admissions/${t}/nursing-notes`),MNe=(t,s)=>he.post(`/ipd/admissions/${t}/nursing-notes`,s),INe=t=>he.get(`/ipd/admissions/${t}/vitals/latest`),ONe=t=>he.get(`/ipd/admissions/${t}/vitals`),RNe=(t,s)=>he.post(`/ipd/admissions/${t}/vitals`,s),LNe=t=>he.get(`/ipd/admissions/${t}/io`),FNe=(t,s)=>he.post(`/ipd/admissions/${t}/io`,s),BNe=t=>he.get(`/ipd/admissions/${t}/referrals`),$Ne=(t,s)=>he.post(`/ipd/admissions/${t}/referrals`,s),zNe=t=>he.get(`/ipd/admissions/${t}/assessments/pain`),UNe=(t,s)=>he.post(`/ipd/admissions/${t}/assessments/pain`,s),VNe=t=>he.get(`/ipd/admissions/${t}/assessments/fall-risk`),HNe=(t,s)=>he.post(`/ipd/admissions/${t}/assessments/fall-risk`,s),WNe=t=>he.get(`/ipd/admissions/${t}/assessments/pressure-ulcer`),qNe=(t,s)=>he.post(`/ipd/admissions/${t}/assessments/pressure-ulcer`,s),GNe=t=>he.get(`/ipd/admissions/${t}/assessments/nutrition`),KNe=(t,s)=>he.post(`/ipd/admissions/${t}/assessments/nutrition`,s),YNe=t=>he.get(`/ipd/admissions/${t}/medications`),XNe=(t,s)=>he.post(`/ipd/admissions/${t}/medications`,s),QNe=(t,s)=>he.put(`/ipd/medications/${t}`,s),ZNe=t=>he.get(`/ipd/admissions/${t}/drug-chart/meta`),JNe=(t,s)=>he.put(`/ipd/admissions/${t}/drug-chart/meta`,s),ewe=t=>he.get(`/ipd/admissions/${t}/drug-chart/iv-fluids`),twe=(t,s)=>he.post(`/ipd/admissions/${t}/drug-chart/iv-fluids`,s),swe=t=>he.delete(`/ipd/iv-fluids/${t}`),nwe=t=>he.get(`/ipd/admissions/${t}/drug-chart/nurses`),rwe=(t,s)=>he.post(`/ipd/admissions/${t}/drug-chart/nurses`,s),awe=t=>he.delete(`/ipd/drug-chart/nurses/${t}`),iwe=t=>he.get(`/ipd/admissions/${t}/drug-chart/doctor-auth`),lwe=(t,s)=>he.post(`/ipd/admissions/${t}/drug-chart/doctor-auth`,s),owe=t=>he.delete(`/ipd/drug-chart/doctor-auth/${t}`),cwe=t=>he.get(`/ipd/admissions/${t}/drug-chart/pdf`,{responseType:"blob"}),dwe=t=>he.get(`/ipd/admissions/${t}/discharge-summary`),uwe=(t,s)=>he.post(`/ipd/admissions/${t}/discharge-summary`,s),mwe=t=>he.get(`/ipd/admissions/${t}/discharge-checklist`),hwe=(t,s)=>he.post(`/ipd/admissions/${t}/discharge-checklist`,s),fG=t=>he.get(`/ipd/admissions/${t}/discharge-meds`),xwe=(t,s)=>he.post(`/ipd/admissions/${t}/discharge-meds`,s),pwe=(t,s={})=>he.get("/ipd/bed-charges/preview",{params:{admission_id:t,...Pf(s)}}),fwe=t=>he.get(`/ipd/admissions/${t}/feedback`),gwe=(t,s)=>he.post(`/ipd/admissions/${t}/feedback`,s),P2=t=>he.get(`/patients/${t}`),bwe=(...t)=>RNe(...t),ywe=(t,s)=>he.post(`/ipd/admissions / ${t} / dressing - transfusion, payload`),vwe=t=>he.get(`/ipd/admissions/${t}/dressing-transfusion`),fN=["General Ward","Semi-Private","Private","Deluxe","Suite","ICU","HDU","PICU","NICU","Isolation Room","Day Care","Observation","Emergency / ER"],jwe={initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.22,ease:"easeOut"}};function na(...t){return t.filter(Boolean).join(" ")}function Nwe(t){const[s,r]=p.useState(!1);return p.useEffect(()=>{var a;try{const i=window.matchMedia(t),l=()=>r(!!i.matches);return l(),(a=i.addEventListener)==null||a.call(i,"change",l),()=>{var o;return(o=i.removeEventListener)==null?void 0:o.call(i,"change",l)}}catch{return}},[t]),s}function wwe(){return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-[radial-gradient(1200px_circle_at_20%_10%,rgba(56,189,248,0.18),transparent_55%),radial-gradient(900px_circle_at_80%_20%,rgba(99,102,241,0.12),transparent_60%),radial-gradient(900px_circle_at_30%_90%,rgba(16,185,129,0.10),transparent_55%)]"}),n.jsx("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-slate-50"})]})}function JT({message:t}){return t?n.jsxs("div",{className:"flex items-start gap-2 rounded-[22px] border border-rose-200/70 bg-rose-50/70 px-4 py-3 text-xs text-rose-700 shadow-sm backdrop-blur-xl",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("div",{className:"min-w-0",children:t})]}):null}function Gc({children:t,onClick:s,disabled:r,className:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:na("inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-4 py-2 text-xs font-semibold text-slate-800 shadow-sm backdrop-blur-xl transition active:scale-[0.99] disabled:opacity-50","hover:bg-white/90 hover:shadow",a),children:t})}function xx({children:t,onClick:s,disabled:r,className:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:na("inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white shadow-sm transition active:scale-[0.99] disabled:opacity-50","hover:bg-slate-800 hover:shadow",a),children:t})}function gG({children:t,onClick:s,disabled:r,className:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:na("inline-flex items-center gap-2 rounded-full bg-rose-600 px-4 py-2 text-xs font-semibold text-white shadow-sm transition active:scale-[0.99] disabled:opacity-50","hover:bg-rose-700 hover:shadow",a),children:t})}function Sd({title:t,onClick:s,danger:r,children:a}){return n.jsx("button",{type:"button",title:t,onClick:s,className:na("inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-white/60 bg-white/70 text-slate-800 shadow-sm backdrop-blur-xl transition active:scale-[0.99]","hover:bg-white/90 hover:shadow",r&&"text-rose-700"),children:a})}function jp({value:t,onChange:s,placeholder:r}){return n.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-3 py-2 shadow-sm backdrop-blur-xl",children:[n.jsx(Yt,{className:"h-4 w-4 text-slate-500"}),n.jsx("input",{value:t,onChange:a=>s==null?void 0:s(a.target.value),placeholder:r,className:"w-full bg-transparent text-xs font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none"}),t?n.jsx("button",{type:"button",onClick:()=>s==null?void 0:s(""),className:"inline-flex h-7 w-7 items-center justify-center rounded-full hover:bg-white/70",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})}):null]})}function ri({label:t,value:s,onChange:r,placeholder:a,type:i="text",required:l}){return n.jsxs("label",{className:"space-y-1",children:[n.jsxs("div",{className:"text-[11px] font-semibold text-slate-600",children:[t," ",l?n.jsx("span",{className:"text-rose-600",children:"*"}):null]}),n.jsx("input",{type:i,value:s??"",required:l,placeholder:a,onChange:o=>r==null?void 0:r(o.target.value),className:"w-full rounded-2xl border border-white/60 bg-white/70 px-3 py-2 text-sm font-medium text-slate-900 placeholder:text-slate-400 shadow-sm backdrop-blur-xl focus:outline-none focus:ring-2 focus:ring-sky-400/35"})]})}function Sh({label:t,value:s,onChange:r,options:a=[],placeholder:i="Select",required:l}){return n.jsxs("label",{className:"space-y-1",children:[n.jsxs("div",{className:"text-[11px] font-semibold text-slate-600",children:[t," ",l?n.jsx("span",{className:"text-rose-600",children:"*"}):null]}),n.jsxs("select",{value:s??"",required:l,onChange:o=>r==null?void 0:r(o.target.value),className:"w-full rounded-2xl border border-white/60 bg-white/70 px-3 py-2 text-sm font-medium text-slate-900 shadow-sm backdrop-blur-xl focus:outline-none focus:ring-2 focus:ring-sky-400/35",children:[n.jsx("option",{value:"",children:i}),a.map(o=>n.jsx("option",{value:o.value,children:o.label},String(o.value)))]})]})}function bG({type:t}){return t?n.jsx("span",{className:"inline-flex items-center rounded-full border border-sky-200/70 bg-sky-50/70 px-3 py-1 text-[11px] font-semibold text-sky-700",children:t}):n.jsx("span",{className:"text-xs text-slate-500",children:""})}function _we({state:t}){const s=String(t||"unknown").toLowerCase();let r="border-slate-500/70 bg-slate-100/70 text-slate-700";return s==="vacant"||s==="available"?r="border-emerald-200/70 bg-emerald-50/70 text-emerald-700":s==="occupied"?r="border-rose-200/70 bg-rose-50/70 text-rose-700":(s==="reserved"||s==="cleaning")&&(r="border-amber-200/70 bg-amber-50/70 text-amber-700"),n.jsx("span",{className:na("inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold capitalize",r),children:t||"Unknown"})}function Swe({basis:t}){const r=(t||"Daily").toLowerCase()==="hourly";return n.jsx("span",{className:na("inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold",r?"border-purple-200/70 bg-purple-50/70 text-purple-700":"border-emerald-200/70 bg-emerald-50/70 text-emerald-700"),children:r?"Hourly":"Daily"})}function eP({icon:t,title:s,subtitle:r,right:a,children:i}){return n.jsxs("div",{className:"rounded-[28px] border border-white/60 bg-white/55 p-4 shadow-[0_24px_90px_-60px_rgba(15,23,42,0.45)] backdrop-blur-2xl md:p-5",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-[22px] bg-slate-900 text-white shadow-sm",children:n.jsx(t,{className:"h-5 w-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-base font-semibold tracking-tight text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[11px] font-medium text-slate-600",children:r}):null]})]}),a?n.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a}):null]}),n.jsx("div",{className:"mt-4",children:i})]})}function tP({label:t="Loading"}){return n.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-600",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),t]})}function D2({open:t,title:s,subtitle:r,onClose:a,children:i}){const l=Nwe("(min-width: 768px)");p.useEffect(()=>{if(!t)return;const c=d=>{d.key==="Escape"&&(a==null||a())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[t,a]);const o=l?{initial:{opacity:0,x:18},animate:{opacity:1,x:0},exit:{opacity:0,x:18}}:{initial:{opacity:0,y:18},animate:{opacity:1,y:0},exit:{opacity:0,y:18}};return n.jsx(on,{children:t?n.jsx(mt.div,{className:"fixed inset-0 z-[90] flex items-end justify-center bg-black/35 p-3 backdrop-blur-sm md:items-stretch md:justify-end",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onMouseDown:c=>{c.target===c.currentTarget&&(a==null||a())},children:n.jsxs(mt.div,{...o,transition:{duration:.18,ease:"easeOut"},className:na("w-full rounded-[28px] border border-white/45 bg-white/85 p-4 shadow-2xl backdrop-blur-2xl","md:h-full md:max-w-[520px] md:rounded-r-none md:rounded-l-[28px] md:p-5"),children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-[22px] bg-slate-900 text-white",children:n.jsx(Yr,{className:"h-5 w-5"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[11px] font-medium text-slate-600",children:r}):null]}),n.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-[20px] border border-white/60 bg-white/70 text-slate-700 shadow-sm backdrop-blur-xl hover:bg-white/90",onClick:a,children:n.jsx(ts,{className:"h-5 w-5"})})]}),n.jsx("div",{className:"mt-4",children:i})]})}):null})}function Cwe({open:t,anchorRect:s,title:r,onClose:a,children:i}){const[l,o]=p.useState({top:100,left:20});return p.useEffect(()=>{if(!t||!s)return;const c=()=>{const x=Math.min(window.innerHeight-12-20,s.bottom+10),g=Math.max(12,Math.min(window.innerWidth-12-360,s.right-360));o({top:x,left:g})};c();const d=u=>u.key==="Escape"&&(a==null?void 0:a());return window.addEventListener("resize",c),window.addEventListener("scroll",a,!0),window.addEventListener("keydown",d),()=>{window.removeEventListener("resize",c),window.removeEventListener("scroll",a,!0),window.removeEventListener("keydown",d)}},[t,s,a]),n.jsx(on,{children:t?n.jsxs(n.Fragment,{children:[n.jsx(mt.div,{className:"fixed inset-0 z-[95]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onMouseDown:a}),n.jsxs(mt.div,{className:"fixed z-[96] w-[360px] max-w-[calc(100vw-24px)] rounded-[26px] border border-white/55 bg-white/92 p-4 shadow-2xl backdrop-blur-2xl",style:{top:l.top,left:l.left},initial:{opacity:0,y:8,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:8,scale:.98},transition:{duration:.16,ease:"easeOut"},onMouseDown:c=>c.stopPropagation(),children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900",children:r}),n.jsx("div",{className:"mt-0.5 text-[11px] font-medium text-slate-500",children:"Quick edit (no sheet)"})]}),n.jsx(Sd,{title:"Close",onClick:a,children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsx("div",{className:"mt-3",children:i})]})]}):null})}function kwe(){return n.jsxs(Wn,{anyOf:["ipd.masters.manage","ipd.packages.manage"],children:[n.jsx(wwe,{}),n.jsx("div",{className:"min-h-screen px-3 py-3 text-slate-900 md:px-6 md:py-6",children:n.jsxs(mt.div,{...jwe,className:"mx-auto w-full max-w-[1600px] rounded-[32px] border border-white/60 bg-white/55 p-4 shadow-[0_30px_120px_-80px_rgba(15,23,42,0.55)] backdrop-blur-2xl md:p-6",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-[24px] bg-slate-900 text-white shadow-sm",children:n.jsx(cn,{className:"h-5 w-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("h1",{className:"text-lg font-semibold tracking-tight text-slate-900 md:text-xl",children:["IPD Masters",n.jsx("span",{className:"text-slate-400",children:"  "}),"Wards  Rooms  Beds  Tariffs  Packages"]}),n.jsx("p",{className:"mt-1 text-[11px] font-medium text-slate-600 md:text-xs",children:"Apple-style explorer layout. Select ward  rooms  beds. Changes reflect in Admission, Bedboard and Billing."})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"rounded-full border border-white/60 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:"Admin / Permission gated"}),n.jsx("span",{className:"rounded-full border border-emerald-200/60 bg-emerald-50/70 px-3 py-2 text-[11px] font-semibold text-emerald-700 shadow-sm backdrop-blur-xl",children:"Live billing impact"})]})]}),n.jsxs("div",{className:"mt-5 space-y-5",children:[n.jsx(Awe,{}),n.jsx(Iwe,{}),n.jsx(Owe,{})]})]})})]})}function Awe(){const[t,s]=p.useState([]),[r,a]=p.useState([]),[i,l]=p.useState([]),[o,c]=p.useState(!1),[d,u]=p.useState(""),[m,x]=p.useState(""),[g,y]=p.useState(""),[v,j]=p.useState(""),[w,S]=p.useState("all"),[E,k]=p.useState(null),[A,I]=p.useState(null),[P,O]=p.useState(null),[D,T]=p.useState(null),B=async()=>{var Y,Q;c(!0),u("");try{const[oe,_e,xe]=await Promise.all([E2(),xy(),Eo()]);s(oe.data||[]),a(_e.data||[]),l(xe.data||[])}catch(oe){u(((Q=(Y=oe==null?void 0:oe.response)==null?void 0:Y.data)==null?void 0:Q.detail)||"Failed to load ward/room/bed data.")}finally{c(!1)}};p.useEffect(()=>{B()},[]);const U=p.useMemo(()=>{const Y=(r||[]).map(Q=>Q.type).filter(Boolean).map(Q=>String(Q).trim());return Array.from(new Set(Y))},[r]),W=p.useMemo(()=>Array.from(new Set([...fN,...U])),[U]),V=p.useMemo(()=>{const Y=t||[];if(!m.trim())return Y;const Q=m.toLowerCase();return Y.filter(oe=>String(oe.code||"").toLowerCase().includes(Q)||String(oe.name||"").toLowerCase().includes(Q)||String(oe.floor||"").toLowerCase().includes(Q))},[t,m]),R=p.useMemo(()=>(t||[]).find(Y=>Y.id===E)||null,[t,E]),F=p.useMemo(()=>E?(r||[]).filter(Y=>Y.ward_id===E):[],[r,E]),G=p.useMemo(()=>{let Y=F;if(!g.trim())return Y;const Q=g.toLowerCase();return Y.filter(oe=>String(oe.number||"").toLowerCase().includes(Q)||String(oe.type||"").toLowerCase().includes(Q))},[F,g]);p.useEffect(()=>{if(!E){I(null);return}if(A){const Q=(r||[]).find(oe=>oe.id===A);if(Q&&Q.ward_id===E)return}const Y=(r||[]).find(Q=>Q.ward_id===E);I((Y==null?void 0:Y.id)??null)},[E,r]);const H=p.useMemo(()=>(r||[]).find(Y=>Y.id===A)||null,[r,A]),$=p.useMemo(()=>A?(i||[]).filter(Y=>Y.room_id===A):[],[i,A]),K=p.useMemo(()=>{let Y=$;if(w!=="all"&&(Y=Y.filter(Q=>String(Q.state||"").toLowerCase()===w)),v.trim()){const Q=v.toLowerCase();Y=Y.filter(oe=>String(oe.code||"").toLowerCase().includes(Q))}return Y},[$,w,v]),le=p.useMemo(()=>(t||[]).map(Y=>({value:Y.id,label:`${Y.code}  ${Y.name}`})),[t]),se=p.useMemo(()=>(r||[]).map(Y=>({value:Y.id,label:`Ward ${Y.ward_id}  Room ${Y.number} (${Y.type||"Unspecified"})`})),[r]),J=Y=>{try{return window.confirm(Y||"Delete this record?")}catch{return!0}},ie=(Y,Q)=>O({mode:"create",entity:Y,row:null,defaults:Q||null}),te=(Y,Q)=>O({mode:"edit",entity:Y,row:Q,defaults:null}),ne=()=>O(null),q=async(Y,Q,oe)=>{var _e,xe;if(J(oe))try{Y==="ward"&&await fNe(Q),Y==="room"&&await bNe(Q),Y==="bed"&&await vNe(Q),ae.success("Deleted"),await B()}catch(me){ae.error(((xe=(_e=me==null?void 0:me.response)==null?void 0:_e.data)==null?void 0:xe.detail)||"Delete failed")}},ee=async(Y,Q,oe)=>{var _e,xe;try{Y==="ward"&&await a8(Q,oe),Y==="room"&&await i8(Q,oe),Y==="bed"&&await l8(Q,oe),ae.success("Updated"),T(null),await B()}catch(me){ae.error(((xe=(_e=me==null?void 0:me.response)==null?void 0:_e.data)==null?void 0:xe.detail)||"Update failed")}},[X,Z]=p.useState(!1);return n.jsx(n.Fragment,{children:n.jsxs(eP,{icon:Co,title:"Ward  Room  Bed Explorer",subtitle:"No grid. Apple Finder-style navigation with sticky sidebar + animated detail panes.",right:n.jsxs(n.Fragment,{children:[n.jsxs(Gc,{onClick:()=>ie("ward"),children:[n.jsx(ds,{className:"h-4 w-4"})," New Ward"]}),n.jsxs(Gc,{onClick:()=>E?ie("room",{ward_id:E}):ae.error("Select a ward first"),children:[n.jsx(ds,{className:"h-4 w-4"})," New Room"]}),n.jsxs(Gc,{onClick:()=>A?ie("bed",{room_id:A}):ae.error("Select a room first"),children:[n.jsx(ds,{className:"h-4 w-4"})," New Bed"]})]}),children:[n.jsx(JT,{message:d}),n.jsxs("div",{className:"mb-3 mt-2 flex flex-col gap-2 md:hidden",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(xx,{onClick:()=>Z(!0),className:"flex-1 justify-center",children:[n.jsx(Xa,{className:"h-4 w-4"}),"Choose Ward"]}),n.jsx(Gc,{onClick:()=>{k(null),I(null)},children:"Clear"})]}),n.jsxs("div",{className:"rounded-[22px] border border-white/60 bg-white/55 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:["Ward:"," ",n.jsx("span",{className:"text-slate-900",children:R?`${R.code}  ${R.name}`:"Not selected"}),n.jsx("span",{className:"mx-2 text-slate-300",children:""}),"Room:"," ",n.jsx("span",{className:"text-slate-900",children:H?`${H.number} (${H.type||"Unspecified"})`:"Not selected"})]})]}),n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[n.jsx("div",{className:"hidden md:block md:w-[340px] md:shrink-0",children:n.jsxs("div",{className:"rounded-[26px] border border-white/60 bg-white/45 shadow-sm backdrop-blur-2xl",children:[n.jsxs("div",{className:"sticky top-0 z-10 rounded-[26px] border-b border-white/50 bg-white/65 px-3 py-3 backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900",children:"Wards"}),n.jsxs("span",{className:"text-[11px] font-semibold text-slate-500",children:[(t||[]).length," total"]})]}),n.jsx("div",{className:"mt-2",children:n.jsx(jp,{value:m,onChange:x,placeholder:"Search ward"})})]}),n.jsxs("div",{className:"max-h-[520px] overflow-auto p-2",children:[(V||[]).map(Y=>{const Q=Y.id===E;return n.jsx("button",{type:"button",onClick:()=>k(Y.id),className:na("group w-full rounded-2xl px-3 py-2 text-left transition",Q?"bg-slate-900 text-white shadow-sm":"hover:bg-white/55"),children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:na("truncate text-sm font-semibold",Q?"text-white":"text-slate-900"),children:[Y.code||""," ",n.jsx("span",{className:na(Q?"text-white/70":"text-slate-400"),children:""})," ",n.jsx("span",{className:na(Q?"text-white/90":"text-slate-700"),children:Y.name||"Unnamed"})]}),n.jsx("div",{className:na("truncate text-[11px] font-medium",Q?"text-white/75":"text-slate-600"),children:Y.floor?`Floor: ${Y.floor}`:"No floor set"})]}),n.jsxs("div",{className:"flex shrink-0 items-center gap-1 opacity-0 transition group-hover:opacity-100",children:[n.jsx(Sd,{title:"Quick edit",onClick:oe=>{oe.stopPropagation(),T({entity:"ward",row:Y,rect:oe.currentTarget.getBoundingClientRect()})},children:n.jsx(Yr,{className:"h-4 w-4"})}),n.jsx(Sd,{title:"Delete",danger:!0,onClick:oe=>{oe.stopPropagation(),q("ward",Y.id,"Delete ward? (Only possible if no rooms exist)")},children:n.jsx(Ms,{className:"h-4 w-4"})})]})]})},Y.id)}),!(V!=null&&V.length)&&n.jsx("div",{className:"rounded-2xl border border-dashed border-white/60 bg-white/40 p-4 text-center text-xs font-semibold text-slate-500 backdrop-blur-xl",children:"No wards found."})]})]})}),n.jsxs("div",{className:"min-w-0 flex-1 space-y-4",children:[n.jsxs("div",{className:"hidden md:flex md:flex-wrap md:items-center md:gap-2 rounded-[22px] border border-white/60 bg-white/55 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:[n.jsx("span",{className:"text-slate-900",children:"Context"}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsx("span",{className:"text-slate-500",children:"Ward:"}),n.jsx("span",{className:"text-slate-900",children:R?`${R.code}  ${R.name}`:"Not selected"}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsx("span",{className:"text-slate-500",children:"Room:"}),n.jsx("span",{className:"text-slate-900",children:H?`${H.number} (${H.type||"Unspecified"})`:"Not selected"}),(E||A)&&n.jsx("button",{type:"button",className:"ml-auto rounded-full border border-white/60 bg-white/70 px-3 py-1.5 text-[11px] font-semibold text-slate-700 hover:bg-white/90",onClick:()=>{k(null),I(null)},children:"Clear"})]}),n.jsxs("div",{className:"rounded-[26px] border border-white/60 bg-white/45 p-3 shadow-sm backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900",children:"Rooms"}),n.jsx("div",{className:"text-[11px] font-medium text-slate-600",children:R?`Ward ${R.code} rooms`:"Select a ward to view rooms"})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx(jp,{value:g,onChange:y,placeholder:"Search rooms"})})]}),n.jsx(on,{mode:"wait",children:n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.18},children:n.jsx("div",{className:"mt-3 overflow-hidden rounded-2xl border border-white/60 bg-white/55 backdrop-blur-xl",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-[680px] w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-white/40 text-xs font-semibold text-slate-500",children:[n.jsx("th",{className:"px-4 py-3 text-left",children:"Room"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Type"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Ward"}),n.jsx("th",{className:"px-4 py-3 text-right w-[260px]",children:"Actions"})]})}),n.jsx("tbody",{children:E?n.jsxs(n.Fragment,{children:[G.map(Y=>{const Q=Y.id===A;return n.jsxs("tr",{className:na("border-t border-white/50",Q?"bg-slate-900/5":"hover:bg-white/35"),children:[n.jsx("td",{className:"px-4 py-3 font-semibold text-slate-900",children:n.jsx("button",{type:"button",onClick:()=>I(Y.id),className:"underline-offset-2 hover:underline",children:Y.number})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(bG,{type:Y.type})}),n.jsx("td",{className:"px-4 py-3 text-xs font-semibold text-slate-700",children:R?`${R.code}`:`#${Y.ward_id}`}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsxs("div",{className:"inline-flex items-center justify-end gap-2",children:[n.jsx("button",{type:"button",className:na("rounded-full px-3 py-2 text-xs font-semibold transition active:scale-[0.99]",Q?"bg-slate-900 text-white":"border border-white/60 bg-white/70 text-slate-800 hover:bg-white/90"),onClick:()=>I(Y.id),children:"Select"}),n.jsx(Sd,{title:"Quick edit",onClick:oe=>T({entity:"room",row:Y,rect:oe.currentTarget.getBoundingClientRect()}),children:n.jsx(Yr,{className:"h-4 w-4"})}),n.jsx(Sd,{title:"Edit (sheet)",onClick:()=>te("room",Y),children:n.jsx(Co,{className:"h-4 w-4"})}),n.jsx(Sd,{title:"Delete",danger:!0,onClick:()=>q("room",Y.id,"Delete room? (Only possible if no beds exist)"),children:n.jsx(Ms,{className:"h-4 w-4"})})]})})]},Y.id)}),!G.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-5 text-sm font-semibold text-slate-500",children:"No rooms found for this ward."})})]}):n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-5 text-sm font-semibold text-slate-500",children:"Select a ward to see rooms."})})})]})})})},String(E||"none"))})]}),n.jsxs("div",{className:"rounded-[26px] border border-white/60 bg-white/45 p-3 shadow-sm backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900",children:"Beds"}),n.jsx("div",{className:"text-[11px] font-medium text-slate-600",children:H?`Room ${H.number} beds`:"Select a room to view beds"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(jp,{value:v,onChange:j,placeholder:"Search beds"}),n.jsx("div",{className:"inline-flex items-center rounded-full border border-white/60 bg-white/55 p-1 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:["all","vacant","occupied","reserved"].map(Y=>n.jsx("button",{type:"button",onClick:()=>S(Y),className:na("rounded-full px-3 py-2 capitalize transition active:scale-[0.99]",w===Y?"bg-slate-900 text-white":"text-slate-700 hover:bg-white/70"),children:Y},Y))})]})]}),n.jsx(on,{mode:"wait",children:n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:.18},children:n.jsx("div",{className:"mt-3 overflow-hidden rounded-2xl border border-white/60 bg-white/55 backdrop-blur-xl",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-[680px] w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-white/40 text-xs font-semibold text-slate-500",children:[n.jsx("th",{className:"px-4 py-3 text-left",children:"Bed code"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Room"}),n.jsx("th",{className:"px-4 py-3 text-right w-[260px]",children:"Actions"})]})}),n.jsx("tbody",{children:A?n.jsxs(n.Fragment,{children:[K.map(Y=>n.jsxs("tr",{className:"border-t border-white/50 hover:bg-white/35",children:[n.jsx("td",{className:"px-4 py-3 font-semibold text-slate-900",children:Y.code}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(_we,{state:Y.state})}),n.jsx("td",{className:"px-4 py-3 text-xs font-semibold text-slate-700",children:H?`${H.number}`:`#${Y.room_id}`}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsxs("div",{className:"inline-flex items-center justify-end gap-2",children:[n.jsx(Sd,{title:"Quick edit",onClick:Q=>T({entity:"bed",row:Y,rect:Q.currentTarget.getBoundingClientRect()}),children:n.jsx(Yr,{className:"h-4 w-4"})}),n.jsx(Sd,{title:"Edit (sheet)",onClick:()=>te("bed",Y),children:n.jsx(Co,{className:"h-4 w-4"})}),n.jsx(Sd,{title:"Delete",danger:!0,onClick:()=>q("bed",Y.id,"Delete bed? (Blocked if occupied)"),children:n.jsx(Ms,{className:"h-4 w-4"})})]})})]},Y.id)),!K.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-5 text-sm font-semibold text-slate-500",children:"No beds found for this room."})})]}):n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-5 text-sm font-semibold text-slate-500",children:"Select a room to see beds."})})})]})})})},String(A||"none"))}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[W.slice(0,8).map(Y=>n.jsx("span",{className:"rounded-full border border-white/60 bg-white/60 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:Y},Y)),W.length>8&&n.jsxs("span",{className:"rounded-full border border-white/60 bg-white/60 px-3 py-2 text-[11px] font-semibold text-slate-600 backdrop-blur-xl",children:["+",W.length-8," more room types"]})]})]}),o?n.jsx(tP,{label:"Refreshing masters"}):null]})]}),n.jsxs(D2,{open:X,title:"Choose Ward",subtitle:"Select ward to load rooms & beds.",onClose:()=>Z(!1),children:[n.jsx(jp,{value:m,onChange:x,placeholder:"Search ward"}),n.jsxs("div",{className:"mt-3 max-h-[60vh] overflow-auto pr-1",children:[(V||[]).map(Y=>{const Q=Y.id===E;return n.jsx("button",{type:"button",onClick:()=>{k(Y.id),Z(!1)},className:na("mt-2 w-full rounded-2xl border px-3 py-3 text-left shadow-sm backdrop-blur-xl transition",Q?"border-slate-900 bg-slate-900 text-white":"border-white/60 bg-white/70 hover:bg-white/90"),children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"truncate text-sm font-semibold",children:[Y.code||"","  ",Y.name||"Unnamed"]}),n.jsx("div",{className:na("truncate text-[11px] font-medium",Q?"text-white/75":"text-slate-600"),children:Y.floor?`Floor: ${Y.floor}`:"No floor set"})]}),Q?n.jsx(So,{className:"h-5 w-5"}):null]})},Y.id)}),!(V!=null&&V.length)&&n.jsx("div",{className:"mt-3 rounded-2xl border border-dashed border-white/60 bg-white/50 p-4 text-center text-xs font-semibold text-slate-500",children:"No wards found."})]})]}),n.jsx(Cwe,{open:!!D,anchorRect:D==null?void 0:D.rect,title:(D==null?void 0:D.entity)==="ward"?"Quick edit ward":(D==null?void 0:D.entity)==="room"?"Quick edit room":(D==null?void 0:D.entity)==="bed"?"Quick edit bed":"Quick edit",onClose:()=>T(null),children:n.jsx(Ewe,{entity:D==null?void 0:D.entity,row:D==null?void 0:D.row,wardOptions:le,roomOptions:se,allRoomTypes:W,onCancel:()=>T(null),onSave:Y=>{(Y==null?void 0:Y.ward_id)!=null&&(Y.ward_id=Number(Y.ward_id)),(Y==null?void 0:Y.room_id)!=null&&(Y.room_id=Number(Y.room_id)),ee(D.entity,D.row.id,Y)}})}),n.jsx(Twe,{open:!!P,mode:P==null?void 0:P.mode,entity:P==null?void 0:P.entity,row:P==null?void 0:P.row,defaults:P==null?void 0:P.defaults,wardOptions:le,roomOptions:se,allRoomTypes:W,onClose:ne,onSaved:async()=>{ne(),await B()},api:{createWard:pNe,updateWard:a8,createRoom:gNe,updateRoom:i8,createBed:yNe,updateBed:l8}})]})})}function Ewe({entity:t,row:s,wardOptions:r,roomOptions:a,allRoomTypes:i,onCancel:l,onSave:o}){const[c,d]=p.useState({}),[u,m]=p.useState(""),[x,g]=p.useState(!1);p.useEffect(()=>{s&&(t==="ward"&&d({code:s.code||"",name:s.name||"",floor:s.floor||""}),t==="room"&&d({ward_id:String(s.ward_id??""),number:s.number||"",type:s.type||""}),t==="bed"&&d({room_id:String(s.room_id??""),code:s.code||""}),m(""))},[t,s]);const y=async()=>{if(m(""),t==="ward"){if(!String(c.code||"").trim())return m("Ward code required.");if(!String(c.name||"").trim())return m("Ward name required.")}if(t==="room"){if(!String(c.ward_id||"").trim())return m("Ward required.");if(!String(c.number||"").trim())return m("Room number required.")}if(t==="bed"){if(!String(c.room_id||"").trim())return m("Room required.");if(!String(c.code||"").trim())return m("Bed code required.")}const j={...c};Object.keys(j).forEach(w=>{typeof j[w]=="string"&&(j[w]=j[w].trim()),j[w]===""&&delete j[w]}),g(!0);try{await o(j)}finally{g(!1)}},v=p.useMemo(()=>(i||[]).map(w=>({value:w,label:w})),[i]);return n.jsxs("div",{className:"space-y-3",children:[t==="ward"?n.jsxs("div",{className:"grid gap-3",children:[n.jsx(ri,{label:"Ward code",required:!0,value:c.code??"",onChange:j=>d(w=>({...w,code:j})),placeholder:"e.g. GW-1"}),n.jsx(ri,{label:"Ward name",required:!0,value:c.name??"",onChange:j=>d(w=>({...w,name:j})),placeholder:"e.g. General Ward"}),n.jsx(ri,{label:"Floor / Level",value:c.floor??"",onChange:j=>d(w=>({...w,floor:j})),placeholder:"e.g. 1st Floor"})]}):null,t==="room"?n.jsxs("div",{className:"grid gap-3",children:[n.jsx(Sh,{label:"Ward",required:!0,value:c.ward_id??"",onChange:j=>d(w=>({...w,ward_id:j})),options:r,placeholder:"Select ward"}),n.jsx(ri,{label:"Room number",required:!0,value:c.number??"",onChange:j=>d(w=>({...w,number:j})),placeholder:"e.g. 101"}),n.jsx(Sh,{label:"Room type",value:c.type??"",onChange:j=>d(w=>({...w,type:j})),options:v,placeholder:"(Optional) Select type"})]}):null,t==="bed"?n.jsxs("div",{className:"grid gap-3",children:[n.jsx(Sh,{label:"Room",required:!0,value:c.room_id??"",onChange:j=>d(w=>({...w,room_id:j})),options:a,placeholder:"Select room"}),n.jsx(ri,{label:"Bed code",required:!0,value:c.code??"",onChange:j=>d(w=>({...w,code:j})),placeholder:"e.g. GW-101-A"})]}):null,u?n.jsx("div",{className:"text-xs font-semibold text-rose-600",children:u}):null,n.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[n.jsx(Gc,{onClick:l,disabled:x,children:"Cancel"}),n.jsxs(xx,{onClick:y,disabled:x,children:[n.jsx(Pi,{className:"h-4 w-4"}),x?"Saving":"Save"]})]})]})}function Twe({open:t,mode:s,entity:r,row:a,defaults:i,wardOptions:l,roomOptions:o,allRoomTypes:c,onClose:d,onSaved:u,api:m}){const x=s==="create"?r==="ward"?"New Ward":r==="room"?"New Room":r==="bed"?"New Bed":"Create":r==="ward"?"Edit Ward":r==="room"?"Edit Room":r==="bed"?"Edit Bed":"Edit",g=r==="ward"?"Code, name and floor define the ward identity.":r==="room"?"Rooms belong to a ward and may have a type (ICU, Private, etc.).":r==="bed"?"Beds belong to rooms and appear in occupancy + billing.":"";return n.jsxs(D2,{open:t,title:x,subtitle:g,onClose:d,children:[r==="ward"?n.jsx(Pwe,{mode:s,row:a,defaults:i,onSaved:u,onClose:d,api:m}):null,r==="room"?n.jsx(Dwe,{mode:s,row:a,defaults:i,wardOptions:l,allRoomTypes:c,onSaved:u,onClose:d,api:m}):null,r==="bed"?n.jsx(Mwe,{mode:s,row:a,defaults:i,roomOptions:o,onSaved:u,onClose:d,api:m}):null]})}function Pwe({mode:t,row:s,defaults:r,onClose:a,onSaved:i,api:l}){const[o,c]=p.useState({code:"",name:"",floor:""}),[d,u]=p.useState(""),[m,x]=p.useState(!1);p.useEffect(()=>{c(t==="edit"&&s?{code:s.code||"",name:s.name||"",floor:s.floor||""}:{code:"",name:"",floor:""}),u("")},[t,s,r]);const g=async()=>{var v,j;if(u(""),!o.code.trim())return u("Ward code required.");if(!o.name.trim())return u("Ward name required.");const y={code:o.code.trim(),name:o.name.trim(),floor:(o.floor||"").trim()||void 0};x(!0);try{t==="create"?await l.createWard(y):await l.updateWard(s.id,y),ae.success(t==="create"?"Ward created":"Ward updated"),await(i==null?void 0:i())}catch(w){u(((j=(v=w==null?void 0:w.response)==null?void 0:v.data)==null?void 0:j.detail)||"Save failed.")}finally{x(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx(ri,{label:"Ward code",required:!0,value:o.code,onChange:y=>c(v=>({...v,code:y})),placeholder:"e.g. GW-1"}),n.jsx(ri,{label:"Ward name",required:!0,value:o.name,onChange:y=>c(v=>({...v,name:y})),placeholder:"e.g. General Ward"}),n.jsx(ri,{label:"Floor / Level",value:o.floor,onChange:y=>c(v=>({...v,floor:y})),placeholder:"e.g. 1st Floor"}),d?n.jsx("div",{className:"text-xs font-semibold text-rose-600",children:d}):null,n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Gc,{onClick:a,disabled:m,children:"Cancel"}),n.jsxs(xx,{onClick:g,disabled:m,children:[n.jsx(Pi,{className:"h-4 w-4"}),m?"Saving":"Save"]})]})]})}function Dwe({mode:t,row:s,defaults:r,wardOptions:a,allRoomTypes:i,onClose:l,onSaved:o,api:c}){const[d,u]=p.useState({ward_id:"",number:"",typeChoice:"",customType:""}),[m,x]=p.useState(""),[g,y]=p.useState(!1);p.useEffect(()=>{u(t==="edit"&&s?{ward_id:String(s.ward_id??""),number:s.number||"",typeChoice:s.type||"",customType:""}:{ward_id:r!=null&&r.ward_id?String(r.ward_id):"",number:"",typeChoice:"",customType:""}),x("")},[t,s,r]);const v=p.useMemo(()=>{const w=fN.map(E=>({value:E,label:E})),S=(i||[]).filter(E=>!fN.includes(E)).map(E=>({value:E,label:`${E} (existing)`}));return[...w,...S,{value:"__custom",label:"Other (custom)"}]},[i]),j=async()=>{var E,k,A;if(x(""),!d.ward_id)return x("Ward required.");if(!d.number.trim())return x("Room number required.");if(d.typeChoice==="__custom"&&!d.customType.trim())return x("Enter custom room type.");const w=d.typeChoice==="__custom"?d.customType.trim():(E=d.typeChoice)!=null&&E.trim()?d.typeChoice.trim():void 0,S={ward_id:Number(d.ward_id),number:d.number.trim(),type:w};y(!0);try{t==="create"?await c.createRoom(S):await c.updateRoom(s.id,S),ae.success(t==="create"?"Room created":"Room updated"),await(o==null?void 0:o())}catch(I){x(((A=(k=I==null?void 0:I.response)==null?void 0:k.data)==null?void 0:A.detail)||"Save failed.")}finally{y(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx(Sh,{label:"Ward",required:!0,value:d.ward_id,onChange:w=>u(S=>({...S,ward_id:w})),options:a,placeholder:"Select ward"}),n.jsx(ri,{label:"Room number",required:!0,value:d.number,onChange:w=>u(S=>({...S,number:w})),placeholder:"e.g. 101"}),n.jsx(Sh,{label:"Room type",value:d.typeChoice,onChange:w=>u(S=>({...S,typeChoice:w})),options:v,placeholder:"(Optional) Select room type"}),d.typeChoice==="__custom"?n.jsx(ri,{label:"Custom room type",required:!0,value:d.customType,onChange:w=>u(S=>({...S,customType:w})),placeholder:"e.g. Chemotherapy Day Care"}):null,n.jsx("div",{className:"rounded-2xl border border-white/60 bg-white/55 px-3 py-2 text-[11px] font-medium text-slate-600 shadow-sm backdrop-blur-xl",children:"Tip: Standard types like ICU/NICU/Private help billing tariff mapping."}),m?n.jsx("div",{className:"text-xs font-semibold text-rose-600",children:m}):null,n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Gc,{onClick:l,disabled:g,children:"Cancel"}),n.jsxs(xx,{onClick:j,disabled:g,children:[n.jsx(Pi,{className:"h-4 w-4"}),g?"Saving":"Save"]})]})]})}function Mwe({mode:t,row:s,defaults:r,roomOptions:a,onClose:i,onSaved:l,api:o}){const[c,d]=p.useState({room_id:"",code:""}),[u,m]=p.useState(""),[x,g]=p.useState(!1);p.useEffect(()=>{d(t==="edit"&&s?{room_id:String(s.room_id??""),code:s.code||""}:{room_id:r!=null&&r.room_id?String(r.room_id):"",code:""}),m("")},[t,s,r]);const y=async()=>{var j,w;if(m(""),!c.room_id)return m("Room required.");if(!c.code.trim())return m("Bed code required.");const v={room_id:Number(c.room_id),code:c.code.trim()};g(!0);try{t==="create"?await o.createBed(v):await o.updateBed(s.id,v),ae.success(t==="create"?"Bed created":"Bed updated"),await(l==null?void 0:l())}catch(S){m(((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Save failed.")}finally{g(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx(Sh,{label:"Room",required:!0,value:c.room_id,onChange:v=>d(j=>({...j,room_id:v})),options:a,placeholder:"Select room"}),n.jsx(ri,{label:"Bed code",required:!0,value:c.code,onChange:v=>d(j=>({...j,code:v})),placeholder:"e.g. GW-101-A"}),u?n.jsx("div",{className:"text-xs font-semibold text-rose-600",children:u}):null,n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(Gc,{onClick:i,disabled:x,children:"Cancel"}),n.jsxs(xx,{onClick:y,disabled:x,children:[n.jsx(Pi,{className:"h-4 w-4"}),x?"Saving":"Save"]})]})]})}function Ag(t){if(!t)return{baseType:"",basis:"Daily"};const s=String(t);return/\(hourly\)/i.test(s)?{baseType:s.replace(/\(hourly\)/i,"").trim(),basis:"Hourly"}:/\(daily\)/i.test(s)?{baseType:s.replace(/\(daily\)/i,"").trim(),basis:"Daily"}:{baseType:s.trim(),basis:"Daily"}}function Iwe(){const[t,s]=p.useState([]),[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState(""),[d,u]=p.useState("all"),[m,x]=p.useState(""),[g,y]=p.useState(null),[v,j]=p.useState(!1),w=async()=>{var A,I;l(!0),c("");try{const[P,O]=await Promise.all([SNe(),xy()]);s(P.data||[]),a(O.data||[])}catch(P){c(((I=(A=P==null?void 0:P.response)==null?void 0:A.data)==null?void 0:I.detail)||"Failed to load bed rates.")}finally{l(!1)}};p.useEffect(()=>{w()},[]);const S=p.useMemo(()=>{const A=(r||[]).map(P=>P.type).filter(Boolean).map(P=>String(P).trim()),I=(t||[]).map(P=>Ag(P.room_type).baseType).filter(Boolean);return Array.from(new Set([...fN,...A,...I]))},[r,t]),E=p.useMemo(()=>{let A=t||[];if(d!=="all"&&(A=A.filter(I=>(Ag(I.room_type).basis||"Daily").toLowerCase()===d)),m.trim()){const I=m.toLowerCase();A=A.filter(P=>String(P.room_type||"").toLowerCase().includes(I)||String(P.daily_rate||"").toLowerCase().includes(I))}return A},[t,d,m]),k=async A=>{var I,P;try{if(!window.confirm("Delete / deactivate this bed rate?"))return;await ANe(A),ae.success("Bed rate deleted"),await w()}catch(O){ae.error(((P=(I=O==null?void 0:O.response)==null?void 0:I.data)==null?void 0:P.detail)||"Delete failed")}};return n.jsxs(n.Fragment,{children:[n.jsxs(eP,{icon:jn,title:"Bed Rates",subtitle:"Daily & Hourly tariffs. Used by IP billing resolution.",right:n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:[n.jsx(jr,{className:"h-4 w-4"}),n.jsx("span",{children:"Basis"}),n.jsx("div",{className:"inline-flex rounded-full bg-white/70 p-1",children:["all","daily","hourly"].map(A=>n.jsx("button",{type:"button",onClick:()=>u(A),className:na("rounded-full px-3 py-1.5 text-[11px] font-semibold capitalize transition",d===A?"bg-slate-900 text-white":"text-slate-700 hover:bg-white"),children:A},A))})]}),n.jsx(jp,{value:m,onChange:x,placeholder:"Search room type / tariff"})]}),children:[n.jsx(JT,{message:o}),n.jsx(o8,{mode:"create",roomTypeOptions:S,onSaved:async()=>{await w()}}),n.jsx("div",{className:"mt-4 overflow-hidden rounded-[26px] border border-white/60 bg-white/55 shadow-sm backdrop-blur-2xl",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-[920px] w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-white/40 text-xs font-semibold text-slate-500",children:[n.jsx("th",{className:"px-4 py-3 text-left",children:"Room type"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Tariff"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"From"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"To"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Active"}),n.jsx("th",{className:"px-4 py-3 text-right w-[260px]",children:"Actions"})]})}),n.jsxs("tbody",{children:[(E||[]).map(A=>{const I=Ag(A.room_type);return n.jsxs("tr",{className:"border-t border-white/50 hover:bg-white/35",children:[n.jsx("td",{className:"px-4 py-3",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(bG,{type:I.baseType||A.room_type}),n.jsx(Swe,{basis:I.basis})]})}),n.jsxs("td",{className:"px-4 py-3 font-semibold text-slate-900",children:[" ",A.daily_rate??""]}),n.jsx("td",{className:"px-4 py-3 text-xs font-semibold text-slate-700",children:String(A.effective_from||"").slice(0,10)}),n.jsx("td",{className:"px-4 py-3 text-xs font-semibold text-slate-700",children:A.effective_to?String(A.effective_to).slice(0,10):""}),n.jsx("td",{className:"px-4 py-3 text-xs font-semibold text-slate-700",children:A.is_active?"Yes":"No"}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsxs("div",{className:"inline-flex items-center justify-end gap-2",children:[n.jsxs(Gc,{onClick:()=>{y(A),j(!0)},children:[n.jsx(Yr,{className:"h-4 w-4"})," Edit"]}),n.jsxs(gG,{onClick:()=>k(A.id),children:[n.jsx(Ms,{className:"h-4 w-4"})," Delete"]})]})})]},A.id)}),E!=null&&E.length?null:n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-4 py-6 text-sm font-semibold text-slate-500",children:"No bed rates found."})})]})]})})}),i?n.jsx("div",{className:"mt-3",children:n.jsx(tP,{label:"Refreshing bed rates"})}):null]}),n.jsx(D2,{open:v,title:"Edit Bed Rate",subtitle:"Update tariff, basis and effective dates.",onClose:()=>j(!1),children:n.jsx(o8,{mode:"edit",row:g,roomTypeOptions:S,onSaved:async()=>{j(!1),y(null),await w()}})})]})}function o8({mode:t,row:s,roomTypeOptions:r=[],onSaved:a}){p.useMemo(()=>Ag(s==null?void 0:s.room_type),[s]);const[i,l]=p.useState({baseRoomType:"",basis:"daily",amount:"",effective_from:"",effective_to:"",is_active:!0}),[o,c]=p.useState(""),[d,u]=p.useState(!1);p.useEffect(()=>{if(t==="edit"&&s){const x=Ag(s.room_type);l({baseRoomType:x.baseType||"",basis:(x.basis||"Daily").toLowerCase()==="hourly"?"hourly":"daily",amount:s.daily_rate??"",effective_from:s.effective_from?String(s.effective_from).slice(0,10):"",effective_to:s.effective_to?String(s.effective_to).slice(0,10):"",is_active:s.is_active??!0})}else l({baseRoomType:"",basis:"daily",amount:"",effective_from:"",effective_to:"",is_active:!0});c("")},[t,s]);const m=async()=>{var v,j;if(c(""),!i.baseRoomType)return c("Select a room type.");if(!i.amount||Number(i.amount)<=0)return c("Tariff must be > 0.");if(!i.effective_from)return c("Effective from date required.");const x=i.basis==="hourly"?"Hourly":"Daily",y={room_type:`${i.baseRoomType} (${x})`,daily_rate:Number(i.amount),effective_from:i.effective_from,effective_to:i.effective_to||void 0,is_active:!!i.is_active};u(!0);try{t==="create"?await CNe(y):await kNe(s.id,y),ae.success(t==="create"?"Bed rate created":"Bed rate updated"),await(a==null?void 0:a())}catch(w){c(((j=(v=w==null?void 0:w.response)==null?void 0:v.data)==null?void 0:j.detail)||"Save failed.")}finally{u(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(Sh,{label:"Room type",required:!0,value:i.baseRoomType,onChange:x=>l(g=>({...g,baseRoomType:x})),options:r.map(x=>({value:x,label:x})),placeholder:"Select room type"}),n.jsxs("label",{className:"space-y-1",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Tariff basis"}),n.jsx("div",{className:"inline-flex w-full items-center justify-between rounded-2xl border border-white/60 bg-white/70 p-1 shadow-sm backdrop-blur-xl",children:[{key:"daily",label:"Daily"},{key:"hourly",label:"Hourly"}].map(x=>n.jsx("button",{type:"button",onClick:()=>l(g=>({...g,basis:x.key})),className:na("flex-1 rounded-2xl px-3 py-2 text-xs font-semibold transition",i.basis===x.key?"bg-slate-900 text-white":"text-slate-700 hover:bg-white/80"),children:x.label},x.key))}),n.jsx("div",{className:"text-[11px] font-medium text-slate-500",children:i.basis==="hourly"?"Use hourly tariff for short-stay/observation.":"Use daily tariff for standard IP stays."})]}),n.jsx(ri,{label:"Tariff amount ()",required:!0,type:"number",value:i.amount,onChange:x=>l(g=>({...g,amount:x})),placeholder:"e.g. 2500"}),n.jsxs("label",{className:"space-y-1",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Active"}),n.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-white/60 bg-white/70 px-3 py-2 shadow-sm backdrop-blur-xl",children:[n.jsx("input",{type:"checkbox",checked:!!i.is_active,onChange:x=>l(g=>({...g,is_active:x.target.checked}))}),n.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"Enabled (used in billing resolution)"})]})]}),n.jsx(ri,{label:"Effective from",required:!0,type:"date",value:i.effective_from,onChange:x=>l(g=>({...g,effective_from:x}))}),n.jsx(ri,{label:"Effective to (optional)",type:"date",value:i.effective_to,onChange:x=>l(g=>({...g,effective_to:x}))})]}),o?n.jsx("div",{className:"text-xs font-semibold text-rose-600",children:o}):null,n.jsx("div",{className:"flex justify-end gap-2",children:n.jsxs(xx,{onClick:m,disabled:d,children:[n.jsx(Pi,{className:"h-4 w-4"}),d?"Saving":t==="create"?"Create rate":"Save changes"]})})]})}function Owe(){const[t,s]=p.useState([]),[r,a]=p.useState(!1),[i,l]=p.useState(""),[o,c]=p.useState(""),[d,u]=p.useState(null),[m,x]=p.useState(!1),g=async()=>{var j,w;a(!0),l("");try{const{data:S}=await xG();s(S||[])}catch(S){l(((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to load packages.")}finally{a(!1)}};p.useEffect(()=>{g()},[]);const y=p.useMemo(()=>{const j=t||[];if(!o.trim())return j;const w=o.toLowerCase();return j.filter(S=>String(S.name||"").toLowerCase().includes(w))},[t,o]),v=async j=>{var w,S;try{if(!window.confirm("Delete package?"))return;await _Ne(j),ae.success("Package deleted"),await g()}catch(E){ae.error(((S=(w=E==null?void 0:E.response)==null?void 0:w.data)==null?void 0:S.detail)||"Delete failed")}};return n.jsxs(n.Fragment,{children:[n.jsxs(eP,{icon:cn,title:"IPD Packages",subtitle:"Packages like LSCS / Normal Delivery with inclusions & exclusions.",right:n.jsx(jp,{value:o,onChange:c,placeholder:"Search package"}),children:[n.jsx(JT,{message:i}),n.jsx(c8,{mode:"create",onSaved:async()=>{await g()}}),n.jsx("div",{className:"mt-4 overflow-hidden rounded-[26px] border border-white/60 bg-white/55 shadow-sm backdrop-blur-2xl",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-[980px] w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-white/40 text-xs font-semibold text-slate-500",children:[n.jsx("th",{className:"px-4 py-3 text-left",children:"Name"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Charges"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Included"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Excluded"}),n.jsx("th",{className:"px-4 py-3 text-right w-[260px]",children:"Actions"})]})}),n.jsxs("tbody",{children:[(y||[]).map(j=>n.jsxs("tr",{className:"border-t border-white/50 hover:bg-white/35",children:[n.jsx("td",{className:"px-4 py-3 font-semibold text-slate-900",children:j.name}),n.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-slate-900",children:j.charges!=null?` ${j.charges}`:""}),n.jsx("td",{className:"px-4 py-3 text-xs font-medium text-slate-700",children:j.included||""}),n.jsx("td",{className:"px-4 py-3 text-xs font-medium text-slate-700",children:j.excluded||""}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsxs("div",{className:"inline-flex items-center justify-end gap-2",children:[n.jsxs(Gc,{onClick:()=>{u(j),x(!0)},children:[n.jsx(Yr,{className:"h-4 w-4"})," Edit"]}),n.jsxs(gG,{onClick:()=>v(j.id),children:[n.jsx(Ms,{className:"h-4 w-4"})," Delete"]})]})})]},j.id)),y!=null&&y.length?null:n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-4 py-6 text-sm font-semibold text-slate-500",children:"No packages found."})})]})]})})}),r?n.jsx("div",{className:"mt-3",children:n.jsx(tP,{label:"Refreshing packages"})}):null]}),n.jsx(D2,{open:m,title:"Edit Package",subtitle:"Update name, inclusions, exclusions and charges.",onClose:()=>x(!1),children:n.jsx(c8,{mode:"edit",row:d,onSaved:async()=>{x(!1),u(null),await g()}})})]})}function c8({mode:t,row:s,onSaved:r}){const[a,i]=p.useState({name:"",included:"",excluded:"",charges:""}),[l,o]=p.useState(""),[c,d]=p.useState(!1);p.useEffect(()=>{i(t==="edit"&&s?{name:s.name||"",included:s.included||"",excluded:s.excluded||"",charges:s.charges??""}:{name:"",included:"",excluded:"",charges:""}),o("")},[t,s]);const u=async()=>{var x,g;if(o(""),!String(a.name||"").trim())return o("Package name required.");const m={name:String(a.name||"").trim(),included:String(a.included||"").trim()||void 0,excluded:String(a.excluded||"").trim()||void 0,charges:a.charges===""||a.charges==null?void 0:Number(a.charges)};d(!0);try{t==="create"?await NNe(m):await wNe(s.id,m),ae.success(t==="create"?"Package created":"Package updated"),await(r==null?void 0:r())}catch(y){o(((g=(x=y==null?void 0:y.response)==null?void 0:x.data)==null?void 0:g.detail)||"Save failed.")}finally{d(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(ri,{label:"Package name",required:!0,value:a.name,onChange:m=>i(x=>({...x,name:m})),placeholder:"e.g. Normal Delivery"}),n.jsx(ri,{label:"Charges ()",type:"number",value:a.charges,onChange:m=>i(x=>({...x,charges:m})),placeholder:"e.g. 25000"}),n.jsxs("label",{className:"md:col-span-2 space-y-1",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Included"}),n.jsx("textarea",{value:a.included??"",onChange:m=>i(x=>({...x,included:m.target.value})),placeholder:"e.g. bed, nursing, routine labs",className:"min-h-[84px] w-full rounded-2xl border border-white/60 bg-white/70 px-3 py-2 text-sm font-medium text-slate-900 placeholder:text-slate-400 shadow-sm backdrop-blur-xl focus:outline-none focus:ring-2 focus:ring-sky-400/35"})]}),n.jsxs("label",{className:"md:col-span-2 space-y-1",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Excluded"}),n.jsx("textarea",{value:a.excluded??"",onChange:m=>i(x=>({...x,excluded:m.target.value})),placeholder:"e.g. blood, implants, high-value drugs",className:"min-h-[84px] w-full rounded-2xl border border-white/60 bg-white/70 px-3 py-2 text-sm font-medium text-slate-900 placeholder:text-slate-400 shadow-sm backdrop-blur-xl focus:outline-none focus:ring-2 focus:ring-sky-400/35"})]})]}),l?n.jsx("div",{className:"text-xs font-semibold text-rose-600",children:l}):null,n.jsx("div",{className:"flex justify-end gap-2",children:n.jsxs(xx,{onClick:u,disabled:c,children:[n.jsx(Pi,{className:"h-4 w-4"}),c?"Saving":t==="create"?"Create package":"Save changes"]})})]})}const lu=(t={})=>{const s={};return Object.entries(t).forEach(([r,a])=>{a!=null&&a!==""&&(s[r]=a)}),s};function yG(){return he.get("/opd/departments")}function vG({departmentId:t,roleId:s,roleName:r,isDoctor:a}={}){const i=lu({department_id:t,role_id:s,role:r,is_doctor:typeof a=="boolean"?a:void 0});return he.get("/opd/users",{params:i})}function Rwe({doctorUserId:t,date:s,detailed:r=!0}){return he.get("/opd/slots",{params:{doctor_user_id:t,date:s,detailed:r}})}function Lwe({doctorUserId:t,date:s}){return he.get("/opd/slots/free",{params:{doctor_user_id:t,date:s}})}function Fwe(t){return he.get("/opd/schedules",{params:{doctor_user_id:t}})}function Bwe(t){return he.post("/opd/schedules",t)}function $we(t){return he.delete(`/opd/schedules/${t}`)}function sP(t=""){const s=t?{q:t}:{};return he.get("/patients",{params:s})}function zwe(t){return he.post("/opd/appointments",t)}function Uwe(t={}){return he.get("/opd/appointments",{params:lu(t)})}function jG(t,s){return he.patch(`/opd/appointments/${t}/status`,{status:s})}function Vwe(t,s){return he.post(`/opd/appointments/${t}/reschedule`,s)}function Hwe(t={}){return he.get("/opd/appointments/noshow",{params:lu(t)})}function NG(t={}){return he.get("/opd/queue",{params:lu(t)})}function Wwe(t){return he.get(`/opd/visits/${t}`)}function qwe(t,s){return he.put(`/opd/visits/${t}`,s)}function Gwe(t){return he.post("/opd/vitals",t)}function d8(t={}){return he.get("/opd/vitals/latest",{params:lu(t)})}function Kwe(t={}){return he.get("/opd/vitals/history",{params:lu(t)})}function Ywe(t,s){return he.post(`/opd/visits/${t}/followup`,s)}function Xwe(t={}){return he.get("/opd/followups",{params:lu(t)})}function Qwe(t,s){return he.put(`/opd/followups/${t}`,s)}function Zwe(t,s){return he.post(`/opd/followups/${t}/schedule`,s)}function Jwe(t={}){return he.get("/opd/doctor-fees",{params:lu(t)})}function e2e(t){return he.post("/opd/doctor-fees",t)}function t2e(t,s){return he.put(`/opd/doctor-fees/${t}`,s)}function u8(t){if(t.id){const{id:s,...r}=t;return t2e(s,r)}return e2e(t)}function s2e(t){return he.delete(`/opd/doctor-fees/${t}`)}function nP(){return yG()}function rP({departmentId:t,roleId:s,isDoctor:r}={}){return vG({departmentId:t,roleId:s,isDoctor:r})}function n2e({dateFrom:t,dateTo:s,doctorId:r}={}){return he.get("/opd/dashboard",{params:lu({date_from:t,date_to:s,doctor_id:r})})}const r2e=t=>he.get(`/opd/visits/${t}/summary.pdf`,{responseType:"arraybuffer"}),a2e=(t,{scope:s="patient",limit:r=50}={})=>he.get(`/opd/visits/${t}/followups`,{params:{scope:s,limit:r}}),UC=10;function i2e({value:t,onChange:s}){const[r,a]=p.useState(""),[i,l]=p.useState(""),[o,c]=p.useState([]),[d,u]=p.useState(0),[m,x]=p.useState(!1),[g,y]=p.useState(null);p.useEffect(()=>{const I=setTimeout(()=>l(r.trim()),300);return()=>clearTimeout(I)},[r]),p.useEffect(()=>{let I=!0;return(async()=>{var O,D;x(!0),y(null);try{const{data:T}=await sP(i||"");if(!I)return;c(Array.isArray(T)?T:[]),u(0)}catch(T){if(!I)return;const B=((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||(T==null?void 0:T.message)||"Could not load patients. Please try again.";y(B),c([]),u(0)}finally{I&&x(!1)}})(),()=>{I=!1}},[i]);const v=Math.max(1,Math.ceil(((o==null?void 0:o.length)||0)/UC)),j=d*UC,w=p.useMemo(()=>(o||[]).slice(j,j+UC),[o,j]),S=I=>{s&&s(I)},E=d===0||m,k=d>=v-1||m,A=t??null;return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Patient"}),n.jsx("span",{className:"text-sm font-medium text-slate-900",children:"Search and select patient for admission"})]}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Search by UHID, name, phone or email and choose the correct patient."})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-500 bg-white px-9 py-2.5 text-sm text-slate-900 placeholder:text-slate-400 shadow-sm outline-none transition focus:border-sky-500 focus:ring-2 focus:ring-sky-100",placeholder:"Search by UHID, name, phone, email",value:r,onChange:I=>a(I.target.value)})]}),n.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50 text-xs text-slate-500",children:[n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"UHID"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Name"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Phone"}),n.jsx("th",{className:"px-4 py-2 text-right font-medium",children:"Action"})]})}),n.jsxs("tbody",{children:[m&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-slate-500",children:n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-500 px-3 py-1.5 text-xs text-slate-600",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Loading patients"]})})}),!m&&g&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-rose-600",children:g})}),!m&&!g&&w.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm text-slate-500",children:"No patients found. Try a different search."})}),!m&&!g&&w.map(I=>{const P=A===I.id,O=`${I.first_name||""} ${I.last_name||""}`.trim();return n.jsxs("tr",{className:`border-t text-sm transition hover:bg-slate-50 ${P?"bg-sky-50":""}`,children:[n.jsx("td",{className:"px-4 py-2 align-middle text-slate-800",children:n.jsxs("div",{className:"flex items-center gap-2",children:[P&&n.jsx(Xt,{className:"h-4 w-4 text-sky-500"}),n.jsx("span",{className:"font-medium",children:I.uhid||""})]})}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-800",children:O||I.name||""}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-700",children:I.phone||""}),n.jsx("td",{className:"px-4 py-2 align-middle text-right",children:n.jsx("button",{type:"button",onClick:()=>S(I.id),className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold shadow-sm transition ${P?"bg-sky-600 text-white hover:bg-sky-700":"bg-slate-900 text-white hover:bg-slate-800"}`,children:P?"Selected":"Select"})})]},I.id)})]})]})}),n.jsxs("div",{className:"flex flex-col items-center justify-between gap-3 border-t border-slate-100 px-4 py-3 text-xs text-slate-600 sm:flex-row",children:[n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-full border border-slate-500 px-3 py-1.5 font-medium shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>u(I=>Math.max(0,I-1)),disabled:E,children:[n.jsx(ry,{className:"h-4 w-4"}),"Prev"]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Page ",n.jsx("span",{className:"font-medium",children:d+1})," / ",v]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-full border border-slate-500 px-3 py-1.5 font-medium shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>u(I=>Math.min(v-1,I+1)),disabled:k,children:["Next",n.jsx(Ti,{className:"h-4 w-4"})]})]})]})]})}function wG({value:t,onChange:s,label:r="Allocate Bed (Ward  Room  Bed)"}){const[a,i]=p.useState([]),[l,o]=p.useState([]),[c,d]=p.useState([]),[u,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState(!1),[j,w]=p.useState(!1),[S,E]=p.useState(!1),[k,A]=p.useState("");p.useEffect(()=>{let T=!0;return(async()=>{var U,W;v(!0),A("");try{const{data:V}=await E2();if(!T)return;i(V||[])}catch(V){if(!T)return;console.error("listWards error",V),A(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to load wards. Please refresh and try again."),i([])}finally{T&&v(!1)}})(),()=>{T=!1}},[]),p.useEffect(()=>{let T=!0;return o([]),g(""),d([]),A(""),s==null||s(null),u?((async()=>{var U,W;w(!0);try{const{data:V}=await xy({ward_id:Number(u)});if(!T)return;o(V||[])}catch(V){if(!T)return;console.error("listRooms error",V),A(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to load rooms for this ward."),o([])}finally{T&&w(!1)}})(),()=>{T=!1}):void 0},[u]),p.useEffect(()=>{let T=!0;return d([]),A(""),s==null||s(null),x?((async()=>{var U,W;E(!0);try{const{data:V}=await Eo({room_id:Number(x)});if(!T)return;d(V||[])}catch(V){if(!T)return;console.error("listBeds error",V),A(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to load beds for this room."),d([])}finally{T&&E(!1)}})(),()=>{T=!1}):void 0},[x]);const I=p.useMemo(()=>{const T=t?Number(t):null;return T&&c.find(B=>B.id===T)||null},[c,t]),P=T=>{m(T.target.value)},O=T=>{g(T.target.value)},D=T=>{const B=T.target.value,U=B?Number(B):null;s==null||s(U)};return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Bed Allocation"}),n.jsx("span",{className:"text-sm font-medium text-slate-900",children:r})]}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Select ward, then room, then an available bed for this admission."})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsx(Xa,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-medium",children:"Ward"})]}),n.jsxs("div",{className:"relative",children:[y&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{className:"input w-full rounded-2xl border border-slate-500 bg-white text-sm shadow-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",value:u,onChange:P,disabled:y,children:[n.jsx("option",{value:"",children:y?"Loading wards":"Select ward"}),a.map(T=>n.jsxs("option",{value:T.id,children:[T.code,"  ",T.name]},T.id))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsx(SV,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-medium",children:"Room"})]}),n.jsxs("div",{className:"relative",children:[j&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{className:"input w-full rounded-2xl border border-slate-500 bg-white text-sm shadow-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",value:x,onChange:O,disabled:!u||j||a.length===0,children:[n.jsx("option",{value:"",children:u?j?"Loading rooms":l.length===0?"No rooms in this ward":"Select room":"Select ward first"}),l.map(T=>n.jsxs("option",{value:T.id,children:[T.number,"  ",T.type]},T.id))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsx(cn,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-medium",children:"Bed"})]}),n.jsxs("div",{className:"relative",children:[S&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{className:"input w-full rounded-2xl border border-slate-500 bg-white text-sm shadow-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",value:t||"",onChange:D,disabled:!x||S||l.length===0,children:[n.jsx("option",{value:"",children:x?S?"Loading beds":c.length===0?"No beds in this room":"Select bed":"Select room first"}),c.map(T=>n.jsxs("option",{value:T.id,children:[T.code,T.state&&T.state!=="vacant"?`  ${T.state}`:""]},T.id))]})]})]})]}),I&&n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-800",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{className:"font-semibold",children:"Selected bed:"}),n.jsx("span",{className:"font-medium",children:I.code}),I.state&&n.jsxs("span",{className:"text-emerald-700",children:[" ",I.state]})]}),k&&n.jsxs("div",{className:"mt-1 flex items-start gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:k})]})]})}function xc({value:t,onChange:s,label:r="Primary Doctor  Department  Role  User"}){const[a,i]=p.useState([]),[l,o]=p.useState(""),[c,d]=p.useState([]),[u,m]=p.useState(!1),[x,g]=p.useState(!1),[y,v]=p.useState(""),j=p.useMemo(()=>l?a.find(k=>Number(k.id)===Number(l)):null,[a,l]);p.useEffect(()=>{let k=!0;return m(!0),nP().then(A=>{k&&i(A.data||[])}).catch(A=>{var P,O;if(!k)return;console.error("fetchDepartments error",A);const I=((O=(P=A==null?void 0:A.response)==null?void 0:P.data)==null?void 0:O.detail)||"Failed to load departments.";i([]),v(I),ae.error(I)}).finally(()=>{k&&m(!1)}),()=>{k=!1}},[]),p.useEffect(()=>{let k=!0;v(""),d([]);const A=l?Number(l):null,I=(j==null?void 0:j.name)||null;if(s==null||s(null,{department_id:A,department_name:I}),!!l)return g(!0),rP({departmentId:A,isDoctor:!0}).then(P=>{k&&d(P.data||[])}).catch(P=>{var D,T;if(!k)return;console.error("fetchDepartmentUsers error",P);const O=((T=(D=P==null?void 0:P.response)==null?void 0:D.data)==null?void 0:T.detail)||"Failed to load doctors.";v(O),d([]),ae.error(O)}).finally(()=>{k&&g(!1)}),()=>{k=!1}},[l]);const w=p.useMemo(()=>c.find(k=>Number(k.id)===Number(t))||null,[c,t]),S=k=>{const A=k.target.value;o(A)},E=k=>{const A=k.target.value,I=A?Number(A):null,P=l?Number(l):null,O=(j==null?void 0:j.name)||null;if(!I){s==null||s(null,{department_id:P,department_name:O});return}const D=c.find(T=>Number(T.id)===Number(I))||null;s==null||s(I,{department_id:P,department_name:O,doctor_name:(D==null?void 0:D.name)||null,doctor_email:(D==null?void 0:D.email)||null})};return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-slate-600",children:"Doctor & Department"}),n.jsx("span",{className:"text-sm font-medium text-slate-900",children:r})]}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Choose department and doctor (or leave empty to show all)."})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsx(Xa,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-medium",children:"Department"})]}),n.jsxs("div",{className:"relative",children:[u&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{className:"input w-full rounded-2xl border border-slate-500 bg-white text-sm shadow-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",value:l,onChange:S,disabled:u,children:[n.jsx("option",{value:"",children:u?"Loading departments":"All departments"}),a.map(k=>n.jsx("option",{value:k.id,children:k.name},k.id))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[n.jsx(Hs,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-medium",children:"Doctor"})]}),n.jsxs("div",{className:"relative",children:[x&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{className:"input w-full rounded-2xl border border-slate-500 bg-white text-sm shadow-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",value:t||"",onChange:E,disabled:!l||x||c.length===0,children:[n.jsx("option",{value:"",children:x?"Loading doctors":l?c.length===0?"No doctors in this department":"All doctors (in this dept)":"Select department first"}),c.map(k=>n.jsxs("option",{value:k.id,children:[k.name,k.email?` (${k.email})`:""]},k.id))]})]})]})]}),w&&n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-800",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{className:"font-semibold",children:"Selected doctor:"}),n.jsx("span",{className:"font-medium",children:w.name}),w.email&&n.jsxs("span",{className:"text-emerald-700",children:[" ",w.email]})]}),y&&n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:y})]})]})}var l2e="Separator",m8="horizontal",o2e=["horizontal","vertical"],_G=p.forwardRef((t,s)=>{const{decorative:r,orientation:a=m8,...i}=t,l=c2e(a)?a:m8,c=r?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return n.jsx(us.div,{"data-orientation":l,...c,...i,ref:s})});_G.displayName=l2e;function c2e(t){return o2e.includes(t)}var SG=_G;const vr=p.forwardRef(({className:t,orientation:s="horizontal",decorative:r=!0,...a},i)=>n.jsx(SG,{ref:i,decorative:r,orientation:s,className:Bt("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));vr.displayName=SG.displayName;const fs=p.forwardRef(({className:t,...s},r)=>n.jsx("textarea",{className:Bt("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...s}));fs.displayName="Textarea";function mr(...t){return t.filter(Boolean).join(" ")}const Un={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1.5 text-[11px] font-semibold text-slate-700 hover:bg-black/[0.03] active:scale-[0.99] transition disabled:opacity-60",input:"h-11 w-full rounded-2xl border border-black/50 bg-white/85 px-3 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-100 focus:border-sky-500"};function d2e(t){if(!t)return"";try{return t.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}catch{return""}}const bi=t=>typeof t=="number"?Number.isInteger(t)&&t>0:typeof t=="string"&&t.trim()!==""&&/^\d+$/.test(t)?Number(t)>0:!1,u2e=t=>t?t.length===16?`${t}:00`:t:void 0;function m2e({kind:t="success",title:s,message:r,onClose:a}){const i={success:{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-800",Icon:Xt},warn:{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-900",Icon:en},error:{bg:"bg-rose-50",border:"border-rose-200",text:"text-rose-800",Icon:ca}},l=i[t]||i.success;return n.jsxs("div",{className:mr("flex w-full max-w-md items-start gap-3 rounded-2xl border p-3 shadow-[0_18px_40px_rgba(2,6,23,0.16)]","bg-white/80 backdrop-blur-xl",l.border),children:[n.jsx("div",{className:mr("mt-0.5 inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-black/50",l.bg),children:n.jsx(l.Icon,{className:mr("h-5 w-5",l.text)})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:r}):null]}),n.jsx("button",{className:"ml-auto inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-black/50 bg-white/70 hover:bg-black/[0.04]",onClick:a,"aria-label":"Close",type:"button",children:n.jsx(ts,{className:"h-4 w-4 text-slate-700"})})]})}function S1({label:t,value:s,icon:r,tone:a="slate"}){const i=a==="dark"?"bg-slate-900 text-white border-slate-900":a==="emerald"?"bg-emerald-50 text-emerald-900 border-emerald-200":a==="amber"?"bg-amber-50 text-amber-900 border-amber-200":a==="sky"?"bg-sky-50 text-sky-900 border-sky-200":"bg-white/80 text-slate-900 border-black/50";return n.jsx("div",{className:mr("rounded-3xl border px-4 py-3",i),children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-[20px] font-semibold tracking-tight tabular-nums",children:s})]}),r?n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/30",children:n.jsx(r,{className:"h-5 w-5 opacity-80"})}):null]})})}function h2e(){const[t,s]=p.useState([]),[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState(null),[d,u]=p.useState(!1),[m,x]=p.useState(null),[g,y]=p.useState(null),[v,j]=p.useState(null),[w,S]=p.useState(null),[E,k]=p.useState({admission_type:"planned",expected_discharge_at:"",package_id:"",payor_type:"cash",insurer_name:"",policy_number:"",preliminary_diagnosis:"",history:"",care_plan:""}),[A,I]=p.useState(null),P=p.useRef(null),O=G=>{P.current&&clearTimeout(P.current),I(G),P.current=setTimeout(()=>I(null),4500)},D=p.useMemo(()=>t.find(G=>G.id===Number(w))||null,[t,w]),T=p.useMemo(()=>{const G=t.length,H=t.filter(le=>le.state==="vacant").length,$=t.filter(le=>le.state==="reserved").length,K=t.filter(le=>le.state==="occupied").length;return{total:G,vacant:H,reserved:$,occupied:K}},[t]),B=p.useCallback(async(G={bedsOnly:!1})=>{var H,$;try{if(l(!0),G!=null&&G.bedsOnly){const K=await Eo();s(K.data||[])}else{const[K,le]=await Promise.all([Eo(),xG()]);s(K.data||[]),a(le.data||[])}c(new Date)}catch(K){O({kind:"error",title:"Failed to load data",message:(($=(H=K==null?void 0:K.response)==null?void 0:H.data)==null?void 0:$.detail)||"Could not load beds / packages. Please refresh and try again."})}finally{l(!1)}},[]);p.useEffect(()=>{let G=!0;return(async()=>G&&await B({bedsOnly:!1}))(),()=>{G=!1}},[B]),p.useEffect(()=>{if(!d)return;const G=setInterval(()=>{B({bedsOnly:!0})},15e3);return()=>clearInterval(G)},[d,B]);const U=async G=>{try{const{data:H}=await T2({status:"admitted",patient_id:G});return Array.isArray(H)&&H.length>0?H[0]:null}catch{return null}},W=async G=>{var $;if(G.preventDefault(),i)return;if(!bi(m)){O({kind:"warn",title:"Select a patient",message:"Pick a patient before admitting."});return}if(!bi(w)){O({kind:"warn",title:"Select a bed",message:"Choose Ward  Room  Bed."});return}if(!t.find(K=>K.id===Number(w))){O({kind:"warn",title:"Selected bed is unavailable",message:"Refresh beds and select again."});return}l(!0);try{const K=await U(Number(m));if(K!=null&&K.id){const J=`ADM-${String(K.id).padStart(6,"0")}`;O({kind:"warn",title:"Patient already admitted",message:`Active admission ${J} exists. Open Tracking / My Admissions to view.`});return}const le={patient_id:Number(m),bed_id:Number(w),admission_type:E.admission_type||"planned",expected_discharge_at:u2e(E.expected_discharge_at),department_id:bi(g)?Number(g):void 0,practitioner_user_id:bi(v)?Number(v):void 0,package_id:bi(E.package_id)?Number(E.package_id):void 0,payor_type:E.payor_type||"cash",insurer_name:E.insurer_name||"",policy_number:E.policy_number||"",preliminary_diagnosis:E.preliminary_diagnosis||"",history:E.history||"",care_plan:E.care_plan||""};Object.keys(le).forEach(J=>le[J]===void 0&&delete le[J]);const{data:se}=await ENe(le);O({kind:"success",title:"Admission created",message:`Admission ADM-${String(se.id).padStart(6,"0")} created successfully.`});try{const J=await Eo();s(J.data||[]),c(new Date)}catch{}S(null),k(J=>({...J,expected_discharge_at:"",preliminary_diagnosis:"",history:"",care_plan:"",package_id:"",payor_type:"cash",insurer_name:"",policy_number:""}))}catch(K){const le=($=K==null?void 0:K.response)==null?void 0:$.data,se=Array.isArray(le==null?void 0:le.detail)?le.detail.map(ie=>ie==null?void 0:ie.msg).filter(Boolean).join(", "):(le==null?void 0:le.detail)||K.message||"Failed to create admission",J=/Bed not found/i.test(se)?"Please select a valid bed.":/Bed not available/i.test(se)?"That bed is not available. Pick another one.":se;O({kind:"error",title:"Admission failed",message:J})}finally{l(!1)}},V=()=>{x(null),y(null),j(null),S(null),k({admission_type:"planned",expected_discharge_at:"",package_id:"",payor_type:"cash",insurer_name:"",policy_number:"",preliminary_diagnosis:"",history:"",care_plan:""}),O({kind:"success",title:"Cleared",message:"Admission draft cleared."})},R=["insurance","tpa"].includes(E.payor_type),F=bi(m)&&bi(w)&&!i;return n.jsxs("div",{className:Un.page,children:[A&&n.jsx("div",{className:"fixed inset-x-0 top-16 z-50 flex justify-center px-4 sm:justify-end sm:px-6",children:n.jsx(m2e,{kind:A.kind,title:A.title,message:A.message,onClose:()=>I(null)})}),n.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 space-y-4 md:px-8",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:mr(Un.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.16),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-sky-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-sky-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-sky-700",children:"Real-time IPD"})]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(cn,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"IPD Admission"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Admit an in-patient with duplicate guard, live bed availability and payer details."}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Un.chip,children:[n.jsx(Ka,{className:"h-3.5 w-3.5"}),"Duplicate guard ON"]}),n.jsxs("span",{className:Un.chip,children:[n.jsx(Qs,{className:"h-3.5 w-3.5"}),"Vacant ",n.jsx("span",{className:"ml-1 tabular-nums",children:T.vacant})]}),n.jsxs("button",{type:"button",className:mr(Un.chipBtn,d&&"bg-slate-900 text-white border-slate-900 hover:bg-slate-800"),onClick:()=>u(G=>!G),title:"Auto refresh beds every 15s",children:[n.jsx(Qs,{className:"h-4 w-4"}),"Auto refresh beds"]}),o&&n.jsxs("span",{className:Un.chip,children:[n.jsx(jn,{className:"h-3.5 w-3.5"}),"Synced ",n.jsx("span",{className:"ml-1 tabular-nums",children:d2e(o)})]}),bi(m)&&n.jsxs("span",{className:Un.chip,children:[n.jsx(or,{className:"h-3.5 w-3.5"}),"Patient selected"]}),bi(w)&&n.jsxs("span",{className:Un.chip,children:[n.jsx(cn,{className:"h-3.5 w-3.5"}),"Bed selected"]})]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:()=>B({bedsOnly:!1}),className:Un.chipBtn,disabled:i,title:"Refresh beds & packages",children:[n.jsx(ps,{className:mr("h-4 w-4",i&&"animate-spin")}),"Refresh"]}),n.jsxs("span",{className:Un.chip,children:["Beds ",n.jsx("span",{className:"ml-1 tabular-nums",children:T.total})]})]})]}),n.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[n.jsx(S1,{label:"Vacant",value:T.vacant,icon:Xt,tone:"emerald"}),n.jsx(S1,{label:"Reserved",value:T.reserved,icon:en,tone:"amber"}),n.jsx(S1,{label:"Occupied",value:T.occupied,icon:ca,tone:"dark"}),n.jsx(S1,{label:"Total beds",value:T.total,icon:cn,tone:"sky"})]})]})]}),n.jsx(Wn,{anyOf:["ipd.manage"],fallback:n.jsx("div",{className:mr(Un.glass,"p-5"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl border border-black/50 bg-amber-50",children:n.jsx(en,{className:"h-5 w-5 text-amber-800"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Permission required"}),n.jsxs("p",{className:"mt-1 text-[12px] text-slate-600",children:["You do not have permission to create admissions. Ask admin to enable"," ",n.jsx("span",{className:"font-semibold",children:"ipd.manage"}),"."]})]})]})}),children:n.jsxs("form",{onSubmit:W,className:"grid gap-4 lg:grid-cols-[1.05fr,0.95fr]",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs(dt,{className:mr(Un.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Step 1  Patient"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Search and select the patient to admit."})]}),n.jsxs(it,{className:"pt-4 space-y-3",children:[n.jsx(i2e,{value:m??void 0,onChange:x}),bi(m)&&n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/80 px-4 py-3 text-[12px] text-slate-600",children:"Tip: Duplicate active admission is blocked automatically."})]})]}),n.jsxs(dt,{className:mr(Un.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Step 2  Primary doctor"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Pick Department  Role  Doctor."})]}),n.jsx(it,{className:"pt-4",children:n.jsx(xc,{label:"Primary doctor  Department  Role  User",value:v??void 0,onChange:(G,H)=>{j(G||null),y((H==null?void 0:H.department_id)||null)}})})]}),n.jsxs(dt,{className:mr(Un.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Step 3  Assign bed"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Choose Ward  Room  Bed (live availability)."})]}),n.jsxs("button",{type:"button",className:Un.chipBtn,onClick:()=>B({bedsOnly:!0}),disabled:i,title:"Refresh beds",children:[n.jsx(ps,{className:mr("h-4 w-4",i&&"animate-spin")}),"Beds"]})]})}),n.jsxs(it,{className:"pt-4 space-y-3",children:[n.jsx(wG,{value:w??"",onChange:G=>S(bi(G)?Number(G):null)}),i&&t.length===0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-10 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-full rounded-2xl"})]}),D&&n.jsxs("div",{className:"rounded-3xl border border-black/50 bg-white/80 px-4 py-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"text-[12px] font-semibold text-slate-900",children:["Selected: ",D.code]}),n.jsx("span",{className:mr("rounded-full border px-2.5 py-1 text-[11px] font-semibold",D.state==="vacant"?"border-emerald-200 bg-emerald-50 text-emerald-800":D.state==="reserved"?"border-amber-200 bg-amber-50 text-amber-900":"border-slate-500 bg-slate-100 text-slate-700"),children:D.state}),D.reserved_until?n.jsxs("span",{className:"text-[11px] text-slate-500",children:["reserved until ",new Date(D.reserved_until).toLocaleString("en-IN")]}):null]}),n.jsx("div",{className:"mt-1 text-[11px] text-slate-500",children:"If bed state changes during selection, refresh beds and choose again."})]})]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs(dt,{className:mr(Un.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Admission details"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Type, expected discharge, package, and payor."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Admission type"}),n.jsx("select",{className:mr(Un.input,"h-11"),value:E.admission_type,onChange:G=>k(H=>({...H,admission_type:G.target.value})),children:["planned","emergency","daycare"].map(G=>n.jsx("option",{value:G,children:G},G))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Expected discharge"}),n.jsx("input",{type:"datetime-local",className:mr(Un.input,"h-11"),value:E.expected_discharge_at,onChange:G=>k(H=>({...H,expected_discharge_at:G.target.value}))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Package"}),n.jsxs("select",{className:mr(Un.input,"h-11"),value:E.package_id,onChange:G=>k(H=>({...H,package_id:G.target.value})),children:[n.jsx("option",{value:"",children:""}),r.map(G=>n.jsx("option",{value:G.id,children:G.name},G.id))]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Payor type"}),n.jsx("select",{className:mr(Un.input,"h-11"),value:E.payor_type,onChange:G=>k(H=>({...H,payor_type:G.target.value})),children:["cash","insurance","tpa"].map(G=>n.jsx("option",{value:G,children:G},G))})]}),R&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-1.5 md:col-span-2",children:[n.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Insurer name"}),n.jsx(Ee,{className:mr(Un.input,"h-11"),value:E.insurer_name,onChange:G=>k(H=>({...H,insurer_name:G.target.value})),placeholder:"e.g. Star Health / TPA name"})]}),n.jsxs("div",{className:"space-y-1.5 md:col-span-2",children:[n.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Policy number"}),n.jsx(Ee,{className:mr(Un.input,"h-11"),value:E.policy_number,onChange:G=>k(H=>({...H,policy_number:G.target.value})),placeholder:"Policy / Member ID"})]})]})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:"Clinical notes"}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 text-[11px]",children:[n.jsx(Hs,{className:"mr-1 h-3.5 w-3.5"}),"Optional"]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ee,{className:mr(Un.input,"h-11"),value:E.preliminary_diagnosis,onChange:G=>k(H=>({...H,preliminary_diagnosis:G.target.value})),placeholder:"Preliminary diagnosis"}),n.jsx(fs,{className:"min-h-[92px] rounded-2xl border border-black/50 bg-white/85 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-100 focus:border-sky-500",value:E.history,onChange:G=>k(H=>({...H,history:G.target.value})),placeholder:"Short history (complaints, duration, relevant past history)"}),n.jsx(fs,{className:"min-h-[92px] rounded-2xl border border-black/50 bg-white/85 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-100 focus:border-sky-500",value:E.care_plan,onChange:G=>k(H=>({...H,care_plan:G.target.value})),placeholder:"Care plan (initial orders / monitoring / consults)"})]})]})]})]}),n.jsxs("div",{className:mr(Un.glass,"p-4 md:p-5 sticky bottom-4"),children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsx("div",{className:"text-[12px] text-slate-600",children:"After admission, manage vitals, nursing notes, orders and discharge from Admission Details."}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"h-11 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:V,disabled:i,children:"Clear"}),n.jsx(ge,{type:"submit",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",disabled:!F,children:i?n.jsxs(n.Fragment,{children:[n.jsx(ps,{className:"mr-2 h-4 w-4 animate-spin"}),"Admitting"]}):n.jsxs(n.Fragment,{children:[n.jsx(Pr,{className:"mr-2 h-4 w-4"}),"Admit patient"]})})]})]}),!bi(m)||!bi(w)?n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[!bi(m)&&n.jsx("span",{className:"rounded-full border border-amber-200 bg-amber-50 px-2.5 py-1 text-[11px] font-semibold text-amber-900",children:"Select patient"}),!bi(w)&&n.jsx("span",{className:"rounded-full border border-amber-200 bg-amber-50 px-2.5 py-1 text-[11px] font-semibold text-amber-900",children:"Select bed"})]}):null]})]})]})})]})]})}function x2e(t){return t?Array.isArray(t)?t:typeof t=="object"?Object.values(t).flat().filter(Boolean):[]:[]}function ct(t){const s=dn(c=>c.user),r=dn(c=>c.modules);if(!t||!s)return!1;if(s.is_admin||(s.roles||[]).some(c=>(c==null?void 0:c.name)==="Admin"||(c==null?void 0:c.code)==="admin"))return!0;const[i]=t.split("."),l=r&&typeof r=="object"&&Array.isArray(r[i])?r[i]:null;return l!=null&&l.some(c=>(c==null?void 0:c.code)===t)?!0:x2e(r).some(c=>(c==null?void 0:c.code)===t)}var M2="Tabs",[p2e]=fc(M2,[w2]),CG=w2(),[f2e,aP]=p2e(M2),kG=p.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,onValueChange:i,defaultValue:l,orientation:o="horizontal",dir:c,activationMode:d="automatic",...u}=t,m=cy(c),[x,g]=pm({prop:a,onChange:i,defaultProp:l??"",caller:M2});return n.jsx(f2e,{scope:r,baseId:td(),value:x,onValueChange:g,orientation:o,dir:m,activationMode:d,children:n.jsx(us.div,{dir:m,"data-orientation":o,...u,ref:s})})});kG.displayName=M2;var AG="TabsList",EG=p.forwardRef((t,s)=>{const{__scopeTabs:r,loop:a=!0,...i}=t,l=aP(AG,r),o=CG(r);return n.jsx(uq,{asChild:!0,...o,orientation:l.orientation,dir:l.dir,loop:a,children:n.jsx(us.div,{role:"tablist","aria-orientation":l.orientation,...i,ref:s})})});EG.displayName=AG;var TG="TabsTrigger",PG=p.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,disabled:i=!1,...l}=t,o=aP(TG,r),c=CG(r),d=IG(o.baseId,a),u=OG(o.baseId,a),m=a===o.value;return n.jsx(mq,{asChild:!0,...c,focusable:!i,active:m,children:n.jsx(us.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":u,"data-state":m?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:d,...l,ref:s,onMouseDown:zt(t.onMouseDown,x=>{!i&&x.button===0&&x.ctrlKey===!1?o.onValueChange(a):x.preventDefault()}),onKeyDown:zt(t.onKeyDown,x=>{[" ","Enter"].includes(x.key)&&o.onValueChange(a)}),onFocus:zt(t.onFocus,()=>{const x=o.activationMode!=="manual";!m&&!i&&x&&o.onValueChange(a)})})})});PG.displayName=TG;var DG="TabsContent",MG=p.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,forceMount:i,children:l,...o}=t,c=aP(DG,r),d=IG(c.baseId,a),u=OG(c.baseId,a),m=a===c.value,x=p.useRef(m);return p.useEffect(()=>{const g=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(g)},[]),n.jsx(fl,{present:i||m,children:({present:g})=>n.jsx(us.div,{"data-state":m?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":d,hidden:!g,id:u,tabIndex:0,...o,ref:s,style:{...t.style,animationDuration:x.current?"0s":void 0},children:g&&l})})});MG.displayName=DG;function IG(t,s){return`${t}-trigger-${s}`}function OG(t,s){return`${t}-content-${s}`}var g2e=kG,RG=EG,LG=PG,FG=MG;const Do=g2e,Wl=p.forwardRef(({className:t,...s},r)=>n.jsx(RG,{ref:r,className:Bt("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s}));Wl.displayName=RG.displayName;const zs=p.forwardRef(({className:t,...s},r)=>n.jsx(LG,{ref:r,className:Bt("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...s}));zs.displayName=LG.displayName;const Ls=p.forwardRef(({className:t,...s},r)=>n.jsx(FG,{ref:r,className:Bt("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Ls.displayName=FG.displayName;function x4(t,[s,r]){return Math.min(r,Math.max(s,t))}function b2e(t,s){return p.useReducer((r,a)=>s[r][a]??r,t)}var iP="ScrollArea",[BG]=fc(iP),[y2e,Lo]=BG(iP),$G=p.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:i,scrollHideDelay:l=600,...o}=t,[c,d]=p.useState(null),[u,m]=p.useState(null),[x,g]=p.useState(null),[y,v]=p.useState(null),[j,w]=p.useState(null),[S,E]=p.useState(0),[k,A]=p.useState(0),[I,P]=p.useState(!1),[O,D]=p.useState(!1),T=Fs(s,U=>d(U)),B=cy(i);return n.jsx(y2e,{scope:r,type:a,dir:B,scrollHideDelay:l,scrollArea:c,viewport:u,onViewportChange:m,content:x,onContentChange:g,scrollbarX:y,onScrollbarXChange:v,scrollbarXEnabled:I,onScrollbarXEnabledChange:P,scrollbarY:j,onScrollbarYChange:w,scrollbarYEnabled:O,onScrollbarYEnabledChange:D,onCornerWidthChange:E,onCornerHeightChange:A,children:n.jsx(us.div,{dir:B,...o,ref:T,style:{position:"relative","--radix-scroll-area-corner-width":S+"px","--radix-scroll-area-corner-height":k+"px",...t.style}})})});$G.displayName=iP;var zG="ScrollAreaViewport",UG=p.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:a,nonce:i,...l}=t,o=Lo(zG,r),c=p.useRef(null),d=Fs(s,c,o.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),n.jsx(us.div,{"data-radix-scroll-area-viewport":"",...l,ref:d,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:n.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});UG.displayName=zG;var xd="ScrollAreaScrollbar",lP=p.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=Lo(xd,t.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:o}=i,c=t.orientation==="horizontal";return p.useEffect(()=>(c?l(!0):o(!0),()=>{c?l(!1):o(!1)}),[c,l,o]),i.type==="hover"?n.jsx(v2e,{...a,ref:s,forceMount:r}):i.type==="scroll"?n.jsx(j2e,{...a,ref:s,forceMount:r}):i.type==="auto"?n.jsx(VG,{...a,ref:s,forceMount:r}):i.type==="always"?n.jsx(oP,{...a,ref:s}):null});lP.displayName=xd;var v2e=p.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=Lo(xd,t.__scopeScrollArea),[l,o]=p.useState(!1);return p.useEffect(()=>{const c=i.scrollArea;let d=0;if(c){const u=()=>{window.clearTimeout(d),o(!0)},m=()=>{d=window.setTimeout(()=>o(!1),i.scrollHideDelay)};return c.addEventListener("pointerenter",u),c.addEventListener("pointerleave",m),()=>{window.clearTimeout(d),c.removeEventListener("pointerenter",u),c.removeEventListener("pointerleave",m)}}},[i.scrollArea,i.scrollHideDelay]),n.jsx(fl,{present:r||l,children:n.jsx(VG,{"data-state":l?"visible":"hidden",...a,ref:s})})}),j2e=p.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=Lo(xd,t.__scopeScrollArea),l=t.orientation==="horizontal",o=O2(()=>d("SCROLL_END"),100),[c,d]=b2e("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return p.useEffect(()=>{if(c==="idle"){const u=window.setTimeout(()=>d("HIDE"),i.scrollHideDelay);return()=>window.clearTimeout(u)}},[c,i.scrollHideDelay,d]),p.useEffect(()=>{const u=i.viewport,m=l?"scrollLeft":"scrollTop";if(u){let x=u[m];const g=()=>{const y=u[m];x!==y&&(d("SCROLL"),o()),x=y};return u.addEventListener("scroll",g),()=>u.removeEventListener("scroll",g)}},[i.viewport,l,d,o]),n.jsx(fl,{present:r||c!=="hidden",children:n.jsx(oP,{"data-state":c==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:zt(t.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:zt(t.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),VG=p.forwardRef((t,s)=>{const r=Lo(xd,t.__scopeScrollArea),{forceMount:a,...i}=t,[l,o]=p.useState(!1),c=t.orientation==="horizontal",d=O2(()=>{if(r.viewport){const u=r.viewport.offsetWidth<r.viewport.scrollWidth,m=r.viewport.offsetHeight<r.viewport.scrollHeight;o(c?u:m)}},10);return tf(r.viewport,d),tf(r.content,d),n.jsx(fl,{present:a||l,children:n.jsx(oP,{"data-state":l?"visible":"hidden",...i,ref:s})})}),oP=p.forwardRef((t,s)=>{const{orientation:r="vertical",...a}=t,i=Lo(xd,t.__scopeScrollArea),l=p.useRef(null),o=p.useRef(0),[c,d]=p.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=KG(c.viewport,c.content),m={...a,sizes:c,onSizesChange:d,hasThumb:u>0&&u<1,onThumbChange:g=>l.current=g,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:g=>o.current=g};function x(g,y){return k2e(g,o.current,c,y)}return r==="horizontal"?n.jsx(N2e,{...m,ref:s,onThumbPositionChange:()=>{if(i.viewport&&l.current){const g=i.viewport.scrollLeft,y=h8(g,c,i.dir);l.current.style.transform=`translate3d(${y}px, 0, 0)`}},onWheelScroll:g=>{i.viewport&&(i.viewport.scrollLeft=g)},onDragScroll:g=>{i.viewport&&(i.viewport.scrollLeft=x(g,i.dir))}}):r==="vertical"?n.jsx(w2e,{...m,ref:s,onThumbPositionChange:()=>{if(i.viewport&&l.current){const g=i.viewport.scrollTop,y=h8(g,c);l.current.style.transform=`translate3d(0, ${y}px, 0)`}},onWheelScroll:g=>{i.viewport&&(i.viewport.scrollTop=g)},onDragScroll:g=>{i.viewport&&(i.viewport.scrollTop=x(g))}}):null}),N2e=p.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...i}=t,l=Lo(xd,t.__scopeScrollArea),[o,c]=p.useState(),d=p.useRef(null),u=Fs(s,d,l.onScrollbarXChange);return p.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),n.jsx(WG,{"data-orientation":"horizontal",...i,ref:u,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":I2(r)+"px",...t.style},onThumbPointerDown:m=>t.onThumbPointerDown(m.x),onDragScroll:m=>t.onDragScroll(m.x),onWheelScroll:(m,x)=>{if(l.viewport){const g=l.viewport.scrollLeft+m.deltaX;t.onWheelScroll(g),XG(g,x)&&m.preventDefault()}},onResize:()=>{d.current&&l.viewport&&o&&a({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:bN(o.paddingLeft),paddingEnd:bN(o.paddingRight)}})}})}),w2e=p.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...i}=t,l=Lo(xd,t.__scopeScrollArea),[o,c]=p.useState(),d=p.useRef(null),u=Fs(s,d,l.onScrollbarYChange);return p.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),n.jsx(WG,{"data-orientation":"vertical",...i,ref:u,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":I2(r)+"px",...t.style},onThumbPointerDown:m=>t.onThumbPointerDown(m.y),onDragScroll:m=>t.onDragScroll(m.y),onWheelScroll:(m,x)=>{if(l.viewport){const g=l.viewport.scrollTop+m.deltaY;t.onWheelScroll(g),XG(g,x)&&m.preventDefault()}},onResize:()=>{d.current&&l.viewport&&o&&a({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:bN(o.paddingTop),paddingEnd:bN(o.paddingBottom)}})}})}),[_2e,HG]=BG(xd),WG=p.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:i,onThumbChange:l,onThumbPointerUp:o,onThumbPointerDown:c,onThumbPositionChange:d,onDragScroll:u,onWheelScroll:m,onResize:x,...g}=t,y=Lo(xd,r),[v,j]=p.useState(null),w=Fs(s,T=>j(T)),S=p.useRef(null),E=p.useRef(""),k=y.viewport,A=a.content-a.viewport,I=Ha(m),P=Ha(d),O=O2(x,10);function D(T){if(S.current){const B=T.clientX-S.current.left,U=T.clientY-S.current.top;u({x:B,y:U})}}return p.useEffect(()=>{const T=B=>{const U=B.target;(v==null?void 0:v.contains(U))&&I(B,A)};return document.addEventListener("wheel",T,{passive:!1}),()=>document.removeEventListener("wheel",T,{passive:!1})},[k,v,A,I]),p.useEffect(P,[a,P]),tf(v,O),tf(y.content,O),n.jsx(_2e,{scope:r,scrollbar:v,hasThumb:i,onThumbChange:Ha(l),onThumbPointerUp:Ha(o),onThumbPositionChange:P,onThumbPointerDown:Ha(c),children:n.jsx(us.div,{...g,ref:w,style:{position:"absolute",...g.style},onPointerDown:zt(t.onPointerDown,T=>{T.button===0&&(T.target.setPointerCapture(T.pointerId),S.current=v.getBoundingClientRect(),E.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",y.viewport&&(y.viewport.style.scrollBehavior="auto"),D(T))}),onPointerMove:zt(t.onPointerMove,D),onPointerUp:zt(t.onPointerUp,T=>{const B=T.target;B.hasPointerCapture(T.pointerId)&&B.releasePointerCapture(T.pointerId),document.body.style.webkitUserSelect=E.current,y.viewport&&(y.viewport.style.scrollBehavior=""),S.current=null})})})}),gN="ScrollAreaThumb",qG=p.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=HG(gN,t.__scopeScrollArea);return n.jsx(fl,{present:r||i.hasThumb,children:n.jsx(S2e,{ref:s,...a})})}),S2e=p.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:a,...i}=t,l=Lo(gN,r),o=HG(gN,r),{onThumbPositionChange:c}=o,d=Fs(s,x=>o.onThumbChange(x)),u=p.useRef(void 0),m=O2(()=>{u.current&&(u.current(),u.current=void 0)},100);return p.useEffect(()=>{const x=l.viewport;if(x){const g=()=>{if(m(),!u.current){const y=A2e(x,c);u.current=y,c()}};return c(),x.addEventListener("scroll",g),()=>x.removeEventListener("scroll",g)}},[l.viewport,m,c]),n.jsx(us.div,{"data-state":o.hasThumb?"visible":"hidden",...i,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:zt(t.onPointerDownCapture,x=>{const y=x.target.getBoundingClientRect(),v=x.clientX-y.left,j=x.clientY-y.top;o.onThumbPointerDown({x:v,y:j})}),onPointerUp:zt(t.onPointerUp,o.onThumbPointerUp)})});qG.displayName=gN;var cP="ScrollAreaCorner",GG=p.forwardRef((t,s)=>{const r=Lo(cP,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?n.jsx(C2e,{...t,ref:s}):null});GG.displayName=cP;var C2e=p.forwardRef((t,s)=>{const{__scopeScrollArea:r,...a}=t,i=Lo(cP,r),[l,o]=p.useState(0),[c,d]=p.useState(0),u=!!(l&&c);return tf(i.scrollbarX,()=>{var x;const m=((x=i.scrollbarX)==null?void 0:x.offsetHeight)||0;i.onCornerHeightChange(m),d(m)}),tf(i.scrollbarY,()=>{var x;const m=((x=i.scrollbarY)==null?void 0:x.offsetWidth)||0;i.onCornerWidthChange(m),o(m)}),u?n.jsx(us.div,{...a,ref:s,style:{width:l,height:c,position:"absolute",right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function bN(t){return t?parseInt(t,10):0}function KG(t,s){const r=t/s;return isNaN(r)?0:r}function I2(t){const s=KG(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*s;return Math.max(a,18)}function k2e(t,s,r,a="ltr"){const i=I2(r),l=i/2,o=s||l,c=i-o,d=r.scrollbar.paddingStart+o,u=r.scrollbar.size-r.scrollbar.paddingEnd-c,m=r.content-r.viewport,x=a==="ltr"?[0,m]:[m*-1,0];return YG([d,u],x)(t)}function h8(t,s,r="ltr"){const a=I2(s),i=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,l=s.scrollbar.size-i,o=s.content-s.viewport,c=l-a,d=r==="ltr"?[0,o]:[o*-1,0],u=x4(t,d);return YG([0,o],[0,c])(u)}function YG(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(r-t[0])}}function XG(t,s){return t>0&&t<s}var A2e=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return function i(){const l={left:t.scrollLeft,top:t.scrollTop},o=r.left!==l.left,c=r.top!==l.top;(o||c)&&s(),r=l,a=window.requestAnimationFrame(i)}(),()=>window.cancelAnimationFrame(a)};function O2(t,s){const r=Ha(t),a=p.useRef(0);return p.useEffect(()=>()=>window.clearTimeout(a.current),[]),p.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function tf(t,s){const r=Ha(s);Qa(()=>{let a=0;if(t){const i=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return i.observe(t),()=>{window.cancelAnimationFrame(a),i.unobserve(t)}}},[t,r])}var QG=$G,E2e=UG,T2e=GG;const Fn=p.forwardRef(({className:t,children:s,...r},a)=>n.jsxs(QG,{ref:a,className:Bt("relative overflow-hidden",t),...r,children:[n.jsx(E2e,{className:"h-full w-full rounded-[inherit]",children:s}),n.jsx(ZG,{}),n.jsx(T2e,{})]}));Fn.displayName=QG.displayName;const ZG=p.forwardRef(({className:t,orientation:s="vertical",...r},a)=>n.jsx(lP,{ref:a,orientation:s,className:Bt("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:n.jsx(qG,{className:"relative flex-1 rounded-full bg-border"})}));ZG.displayName=lP.displayName;var R2="Dialog",[JG]=fc(R2),[P2e,gc]=JG(R2),eK=t=>{const{__scopeDialog:s,children:r,open:a,defaultOpen:i,onOpenChange:l,modal:o=!0}=t,c=p.useRef(null),d=p.useRef(null),[u,m]=pm({prop:a,defaultProp:i??!1,onChange:l,caller:R2});return n.jsx(P2e,{scope:s,triggerRef:c,contentRef:d,contentId:td(),titleId:td(),descriptionId:td(),open:u,onOpenChange:m,onOpenToggle:p.useCallback(()=>m(x=>!x),[m]),modal:o,children:r})};eK.displayName=R2;var tK="DialogTrigger",D2e=p.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,i=gc(tK,r),l=Fs(s,i.triggerRef);return n.jsx(us.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":mP(i.open),...a,ref:l,onClick:zt(t.onClick,i.onOpenToggle)})});D2e.displayName=tK;var dP="DialogPortal",[M2e,sK]=JG(dP,{forceMount:void 0}),nK=t=>{const{__scopeDialog:s,forceMount:r,children:a,container:i}=t,l=gc(dP,s);return n.jsx(M2e,{scope:s,forceMount:r,children:p.Children.map(a,o=>n.jsx(fl,{present:r||l.open,children:n.jsx(N2,{asChild:!0,container:i,children:o})}))})};nK.displayName=dP;var yN="DialogOverlay",rK=p.forwardRef((t,s)=>{const r=sK(yN,t.__scopeDialog),{forceMount:a=r.forceMount,...i}=t,l=gc(yN,t.__scopeDialog);return l.modal?n.jsx(fl,{present:a||l.open,children:n.jsx(O2e,{...i,ref:s})}):null});rK.displayName=yN;var I2e=Hh("DialogOverlay.RemoveScroll"),O2e=p.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,i=gc(yN,r);return n.jsx(S2,{as:I2e,allowPinchZoom:!0,shards:[i.contentRef],children:n.jsx(us.div,{"data-state":mP(i.open),...a,ref:s,style:{pointerEvents:"auto",...a.style}})})}),qh="DialogContent",aK=p.forwardRef((t,s)=>{const r=sK(qh,t.__scopeDialog),{forceMount:a=r.forceMount,...i}=t,l=gc(qh,t.__scopeDialog);return n.jsx(fl,{present:a||l.open,children:l.modal?n.jsx(R2e,{...i,ref:s}):n.jsx(L2e,{...i,ref:s})})});aK.displayName=qh;var R2e=p.forwardRef((t,s)=>{const r=gc(qh,t.__scopeDialog),a=p.useRef(null),i=Fs(s,r.contentRef,a);return p.useEffect(()=>{const l=a.current;if(l)return WT(l)},[]),n.jsx(iK,{...t,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:zt(t.onCloseAutoFocus,l=>{var o;l.preventDefault(),(o=r.triggerRef.current)==null||o.focus()}),onPointerDownOutside:zt(t.onPointerDownOutside,l=>{const o=l.detail.originalEvent,c=o.button===0&&o.ctrlKey===!0;(o.button===2||c)&&l.preventDefault()}),onFocusOutside:zt(t.onFocusOutside,l=>l.preventDefault())})}),L2e=p.forwardRef((t,s)=>{const r=gc(qh,t.__scopeDialog),a=p.useRef(!1),i=p.useRef(!1);return n.jsx(iK,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{var o,c;(o=t.onCloseAutoFocus)==null||o.call(t,l),l.defaultPrevented||(a.current||(c=r.triggerRef.current)==null||c.focus(),l.preventDefault()),a.current=!1,i.current=!1},onInteractOutside:l=>{var d,u;(d=t.onInteractOutside)==null||d.call(t,l),l.defaultPrevented||(a.current=!0,l.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=l.target;((u=r.triggerRef.current)==null?void 0:u.contains(o))&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&i.current&&l.preventDefault()}})}),iK=p.forwardRef((t,s)=>{const{__scopeDialog:r,trapFocus:a,onOpenAutoFocus:i,onCloseAutoFocus:l,...o}=t,c=gc(qh,r),d=p.useRef(null),u=Fs(s,d);return OT(),n.jsxs(n.Fragment,{children:[n.jsx(f2,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:i,onUnmountAutoFocus:l,children:n.jsx(p2,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":mP(c.open),...o,ref:u,onDismiss:()=>c.onOpenChange(!1)})}),n.jsxs(n.Fragment,{children:[n.jsx(F2e,{titleId:c.titleId}),n.jsx($2e,{contentRef:d,descriptionId:c.descriptionId})]})]})}),uP="DialogTitle",lK=p.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,i=gc(uP,r);return n.jsx(us.h2,{id:i.titleId,...a,ref:s})});lK.displayName=uP;var oK="DialogDescription",cK=p.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,i=gc(oK,r);return n.jsx(us.p,{id:i.descriptionId,...a,ref:s})});cK.displayName=oK;var dK="DialogClose",uK=p.forwardRef((t,s)=>{const{__scopeDialog:r,...a}=t,i=gc(dK,r);return n.jsx(us.button,{type:"button",...a,ref:s,onClick:zt(t.onClick,()=>i.onOpenChange(!1))})});uK.displayName=dK;function mP(t){return t?"open":"closed"}var mK="DialogTitleWarning",[VZe,hK]=lye(mK,{contentName:qh,titleName:uP,docsSlug:"dialog"}),F2e=({titleId:t})=>{const s=hK(mK),r=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return p.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},B2e="DialogDescriptionWarning",$2e=({contentRef:t,descriptionId:s})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${hK(B2e).contentName}}.`;return p.useEffect(()=>{var l;const i=(l=t.current)==null?void 0:l.getAttribute("aria-describedby");s&&i&&(document.getElementById(s)||console.warn(a))},[a,t,s]),null},xK=eK,pK=nK,L2=rK,F2=aK,B2=lK,$2=cK,fK=uK;const fb=xK,z2e=pK,gK=p.forwardRef(({className:t,...s},r)=>n.jsx(L2,{className:Bt("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));gK.displayName=L2.displayName;const U2e=h2("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),sf=p.forwardRef(({side:t="right",className:s,children:r,...a},i)=>n.jsxs(z2e,{children:[n.jsx(gK,{}),n.jsxs(F2,{ref:i,className:Bt(U2e({side:t}),s),...a,children:[n.jsxs(fK,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[n.jsx(ts,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]}),r]})]}));sf.displayName=F2.displayName;const gb=({className:t,...s})=>n.jsx("div",{className:Bt("flex flex-col space-y-2 text-center sm:text-left",t),...s});gb.displayName="SheetHeader";const bb=p.forwardRef(({className:t,...s},r)=>n.jsx(B2,{ref:r,className:Bt("text-lg font-semibold text-foreground",t),...s}));bb.displayName=B2.displayName;const yb=p.forwardRef(({className:t,...s},r)=>n.jsx($2,{ref:r,className:Bt("text-sm text-muted-foreground",t),...s}));yb.displayName=$2.displayName;const hP=({q:t="",active:s,page:r=1,page_size:a=50}={})=>he.get("/masters/lab-tests",{params:{q:t,active:s,page:r,page_size:a}}),V2e=t=>he.post("/masters/lab-tests",t),H2e=(t,s)=>he.put(`/masters/lab-tests/${t}`,s),W2e=t=>he.delete(`/masters/lab-tests/${t}`),bK=({patient_id:t,context_type:s=null,context_id:r=null,priority:a="routine",test_ids:i=[]})=>{const l=(i||[]).map(o=>({test_id:o}));return he.post("/lab/orders",{patient_id:t,context_type:s,context_id:r,priority:a,items:l})},yK=(t={})=>he.get("/lab/orders",{params:t}),q2e=t=>he.get(`/lab/orders/${t}`),G2e=t=>he.post(`/lab/orders/${t}/finalize`);function K2e(t={}){return he.get("/lis/masters/departments",{params:t})}function Y2e(t,{department_id:s,sub_department_id:r}={}){const a={department_id:s};return r&&(a.sub_department_id=r),he.get(`/lab/orders/${t}/panel`,{params:a})}function X2e(t,s){return he.post(`/lab/orders/${t}/panel/results`,s)}function Q2e(t){return he.get(`/lab/orders/${t}/report-data`)}const Z2e=t=>he.get(`/lab/orders/${t}/report-pdf`,{responseType:"blob"}),xP=({q:t="",active:s,page:r=1,page_size:a=50}={})=>he.get("/ris/masters/tests",{params:{q:t,active:s,page:r,page_size:a}}),J2e=t=>he.post("/ris/masters/tests",t),e_e=(t,s)=>he.put(`/ris/masters/tests/${t}`,s),t_e=t=>he.delete(`/ris/masters/tests/${t}`),vK=({patient_id:t,test_id:s,context_type:r=null,context_id:a=null,ordering_user_id:i=null,priority:l="routine"})=>he.post("/ris/orders",{patient_id:t,test_id:s,context_type:r,context_id:a,ordering_user_id:i,priority:l}),jK=(t={})=>he.get("/ris/orders",{params:t}),s_e=t=>he.get(`/ris/orders/${t}`),n_e=t=>he.get(`/ris/orders/${t}/attachments`),r_e=t=>he.delete(`/ris/attachments/${t}`),a_e=(t,s)=>he.put(`/ris/orders/${t}/notes`,s),i_e=(t,s,r)=>{const a=new FormData;return a.append("file",s),r&&a.append("note",r),he.post(`/ris/orders/${t}/upload`,a)},l_e=(t,s,r)=>he.post(`/ris/attachments/${t}`,{file_url:s,note:r}),o_e=t=>he.post(`/ris/orders/${t}/finalize`);function z2(){return he.get("/inventory/locations")}function c_e(t){return he.post("/inventory/locations",t)}function d_e(t,s){return he.put(`/inventory/locations/${t}`,s)}function px(t=""){const s=t?{q:t}:{};return he.get("/inventory/suppliers",{params:s})}function u_e(t){return he.post("/inventory/suppliers",t)}function m_e(t,s){return he.put(`/inventory/suppliers/${t}`,s)}function Df(t={}){return he.get("/inventory/items",{params:t})}function h_e(t){return he.post("/inventory/items",t)}function x_e(t,s){return he.put(`/inventory/items/${t}`,s)}function NK(t="csv"){return he.get("/inventory/items/bulk-upload/template",{params:{format:t},responseType:"blob"})}function p_e(t){const s=new FormData;return s.append("file",t),he.post("/inventory/items/bulk-upload/preview",s,{headers:{"Content-Type":"multipart/form-data"}})}function f_e(t,{updateBlanks:s=!1,strict:r=!0}={}){const a=new FormData;return a.append("file",t),he.post("/inventory/items/bulk-upload/commit",a,{params:{update_blanks:s,strict:r},headers:{"Content-Type":"multipart/form-data"}})}function g_e(t={}){return he.get("/inventory/stock",{params:t})}function b_e(t={}){return he.get("/inventory/alerts/expiry",{params:t})}function y_e(t={}){return he.get("/inventory/alerts/expired",{params:t})}function v_e(t={}){return he.get("/inventory/stock/quarantine",{params:t})}function j_e(t={}){return he.get("/inventory/alerts/low-stock",{params:t})}function N_e(t={}){return he.get("/inventory/alerts/max-stock",{params:t})}function w_e(t){return he.post("/inventory/purchase-orders",t)}function wK(t={}){return he.get("/inventory/purchase-orders",{params:t})}function __e(t,s){return he.put(`/inventory/purchase-orders/${t}`,s)}function x8(t,s){return he.post(`/inventory/purchase-orders/${t}/status`,null,{params:{status:s}})}function S_e(t){return he.get(`/inventory/purchase-orders/${t}/pdf`,{responseType:"blob"})}function C_e(t,s){return he.post(`/inventory/purchase-orders/${t}/mark-sent`,null,{params:{email_to:s}})}function _K(t={}){return he.get("/inventory/locations",{params:t})}function k_e(t){return he.post("/inventory/grn",t)}function A_e(t={}){return he.get("/inventory/grn",{params:t})}function E_e(t){return he.get(`/inventory/grn/${t}`)}function T_e(t,s){return he.put(`/inventory/grn/${t}`,s)}function P_e(t,s={}){return he.post(`/inventory/grn/${t}/post`,s)}function D_e(t={}){return he.get("/inventory/purchase-orders/pending",{params:t})}function M_e(t){return he.get(`/inventory/purchase-orders/${t}/pending-items`)}function I_e(t){return he.post("/inventory/returns",t)}function O_e(t={}){return he.get("/inventory/returns",{params:t})}function R_e(t){return he.post(`/inventory/returns/${t}/post`)}function L_e(t={}){return he.get("/inventory/transactions",{params:t})}function F_e(t){return he.get(`/inventory/items/by-qr/${encodeURIComponent(t)}`)}function B_e(t){return he.get("/inventory/items/by-qr-number",{params:{qr_number:t}})}function p8(t){return he.get(`/inventory/items/${t}/qr`,{responseType:"blob"})}function SK(t){return he.post("/pharmacy/prescriptions",t)}function CK(t={}){return he.get("/pharmacy/prescriptions",{params:t})}function $_e(t,s){return he.post(`/pharmacy/prescriptions/${t}/dispense`,s)}function z_e(t){return he.post(`/pharmacy/prescriptions/${t}/bill`)}async function kK({q:t="",type:s="all",limit:r=50}={}){const a={is_active:!0};t&&(a.q=t),s==="drug"&&(a.type="drug"),s==="consumable"&&(a.type="consumable"),r&&(a.limit=r);const i=await Df(a);return{data:(Array.isArray(i==null?void 0:i.data)?i.data:[]).slice(0,r).map(c=>({id:c.id,code:c.code,name:c.name,generic_name:c.generic_name,strength:c.strength,form:c.form,unit:c.unit,pack_size:c.pack_size,is_consumable:!!c.is_consumable,type:c.is_consumable?"consumable":"drug"}))}}function U_e(t={}){return he.get("/pharmacy/billing",{params:t})}function V_e(t={}){return he.get("/pharmacy/billing/returns/list",{params:t})}function H_e(t){return he.get(`/pharmacy/prescriptions/${t}`)}function W_e(t){return he.get(`/pharmacy/prescriptions/${t}/pdf`,{responseType:"blob"})}const Mf=(t={})=>{const s={};return Object.entries(t).forEach(([r,a])=>{a!=null&&a!==""&&(s[r]=a)}),s};function AK({active:t,search:s}={}){const r=Mf({active:t,search:s});return he.get("/ot/specialities",{params:r})}function q_e(t){return he.post("/ot/specialities",t)}function G_e(t,s){return he.put(`/ot/specialities/${t}`,s)}function K_e(t){return he.delete(`/ot/specialities/${t}`)}function pP({search:t,specialityId:s,isActive:r,limit:a}={}){const i=Mf({search:t,speciality_id:s,is_active:typeof r=="boolean"?r:void 0,limit:a});return he.get("/ot/procedures",{params:i})}function Y_e(t){return he.post("/ot/procedures",t)}function X_e(t,s){return he.put(`/ot/procedures/${t}`,s)}function Q_e(t){return he.delete(`/ot/procedures/${t}`)}function Z_e({active:t,search:s,specialityId:r}={}){const a=Mf({active:t,search:s,speciality_id:r});return he.get("/ot/theatres",{params:a})}function EK({date:t,bedId:s,surgeonUserId:r,patientId:a,status:i}={}){const l=Mf({date:t,bed_id:s,surgeon_user_id:r,patient_id:a,status:i});return he.get("/ot/schedule",{params:l})}function TK(t){return he.post("/ot/schedules",t)}function J_e(t,s){return he.put(`/ot/schedules/${t}`,s)}function eSe(t,s){return he.post(`/ot/cases/${t}/close`,s)}function tSe(t){return he.get(`/ot/cases/${t}`)}function sSe(t){return he.get(`/ot/cases/${t}/preop-checklist`).then(s=>s.data)}function nSe(t,s){return he.post(`/ot/cases/${t}/preop-checklist`,s).then(r=>r.data)}function rSe(t,s){return he.put(`/ot/cases/${t}/preop-checklist`,s).then(r=>r.data)}function aSe(t){return he.get(`/ot/cases/${t}/safety-checklist`)}function iSe(t,s){return he.post(`/ot/cases/${t}/safety-checklist`,{...s,case_id:t})}function lSe(t,s){return he.put(`/ot/cases/${t}/safety-checklist`,s)}const oSe=t=>he.get(`/ot/cases/${t}/anaesthesia-record`),cSe=(t,s)=>he.post(`/ot/cases/${t}/anaesthesia-record`,s),dSe=(t,s)=>he.put(`/ot/cases/${t}/anaesthesia-record`,s),uSe=t=>he.get(`/ot/anaesthesia-records/${t}/vitals`),mSe=(t,s)=>he.post(`/ot/anaesthesia-records/${t}/vitals`,s),hSe=t=>he.delete(`/ot/anaesthesia-vitals/${t}`),xSe=t=>he.get(`/ot/anaesthesia-records/${t}/drugs`),pSe=(t,s)=>he.post(`/ot/anaesthesia-records/${t}/drugs`,s),fSe=t=>he.delete(`/ot/anaesthesia-drugs/${t}`);function gSe(t){return he.get(`/ot/cases/${t}/nursing-record`)}function bSe(t,s){return he.post(`/ot/cases/${t}/nursing-record`,{...s,case_id:t,primary_nurse_id:s.primary_nurse_id??null})}function f8(t,s){return he.put(`/ot/cases/${t}/nursing-record`,{...s,case_id:t,primary_nurse_id:s.primary_nurse_id??null})}function ySe(t){return he.get(`/ot/cases/${t}/counts`)}function vSe(t,s){return he.post(`/ot/cases/${t}/counts`,s)}function g8(t,s){return he.put(`/ot/cases/${t}/counts`,s)}function jSe(t){return he.get(`/ot/cases/${t}/operation-note`)}function NSe(t,s){return he.post(`/ot/cases/${t}/operation-note`,{...s,case_id:t})}function wSe(t,s){return he.put(`/ot/cases/${t}/operation-note`,s)}function _Se(t){return he.get(`/ot/cases/${t}/blood-transfusions`)}function SSe(t,s){return he.post(`/ot/cases/${t}/blood-transfusions`,{...s,case_id:t})}function CSe(t){return he.delete(`/ot/blood-transfusions/${t}`)}function kSe(t){return he.get(`/ot/cases/${t}/pacu`)}function ASe(t,s){return he.post(`/ot/cases/${t}/pacu`,{...s,case_id:t})}function ESe(t,s){return he.put(`/ot/cases/${t}/pacu`,s)}function TSe({theatreId:t,caseId:s,date:r,fromDate:a,toDate:i,session:l}={}){const o=Mf({theatre_id:t,case_id:s,date:r,from_date:a,to_date:i,session:l});return he.get("/ot/cleaning-logs",{params:o})}function PSe(t){return he.post("/ot/cleaning-logs",t)}function DSe(t,s){return he.put(`/ot/cleaning-logs/${t}`,s)}function MSe(t){return he.delete(`/ot/cleaning-logs/${t}`)}function ISe({theatreId:t,date:s,fromDate:r,toDate:a}={}){const i=Mf({theatre_id:t,date:s,from_date:r,to_date:a});return he.get("/ot/environment-logs",{params:i})}function OSe(t){return he.post("/ot/environment-logs",t)}function RSe(t,s){return he.put(`/ot/environment-logs/${t}`,s)}function LSe(t){return he.delete(`/ot/environment-logs/${t}`)}function FSe(t,s={}){return he.post(`/ot/schedule/${t}/open-case`,s)}function b8(t,s="attachment"){return he.get(`/ot/cases/${t}/pdf`,{params:{disposition:s},responseType:"blob",headers:{Accept:"application/pdf"}})}function py(t){if(!t)return null;const s=String(t).toLowerCase();return s==="op"||s==="opd"?"opd":s==="ip"||s==="ipd"?"ipd":s}const BSe=t=>he.get(`/opd/visits/${t}/summary.pdf`,{responseType:"arraybuffer"});async function $Se({patientId:t,contextType:s,contextId:r,limit:a=10}){if(!t)return[];const i=py(s),l=await yK({patient_id:t});return(Array.isArray(l==null?void 0:l.data)?l.data:[]).filter(d=>!(i&&d.context_type&&d.context_type!==i||r&&d.context_id&&d.context_id!==r)).slice(0,a)}async function zSe({patientId:t,contextType:s,contextId:r,limit:a=10}){if(!t)return[];const i=py(s),l=await jK({patient_id:t});return(Array.isArray(l==null?void 0:l.data)?l.data:[]).filter(d=>!(i&&d.context_type&&d.context_type!==i||r&&d.context_id&&d.context_id!==r)).slice(0,a)}async function USe({patientId:t,contextType:s,contextId:r,doctorUserId:a,locationId:i,notes:l,lines:o=[]}){var g;const c=py(s);if(!t||!c||!r)throw new Error("Missing patient / context for prescription");const d=c==="ipd"?"IPD":"OPD",u=[];for(const y of o){const v=(y.item_name||"").trim();if(!v)continue;const j=await kK({q:v,type:"drug",limit:1}),w=(g=j==null?void 0:j.data)==null?void 0:g[0];w&&u.push({item_id:w.id,requested_qty:y.requested_qty||1,dose_text:y.dose_text||null,frequency_code:y.frequency_code||null,timing:y.timing||null,duration_days:y.duration_days||null,instructions:y.instructions||null})}if(!u.length)throw new Error("No medicines found in inventory master");return(await SK({type:d,patient_id:t,visit_id:c==="opd"?r:null,ipd_admission_id:c==="ipd"?r:null,location_id:i??null,doctor_user_id:a??null,notes:l||null,lines:u})).data}async function VSe({patientId:t,contextType:s,contextId:r,limit:a=10}){if(!t)return[];const i=py(s),o=await CK({patient_id:t,type:i==="ipd"?"IPD":"OPD",visit_id:i==="opd"?r:void 0,ipd_admission_id:i==="ipd"?r:void 0});return(Array.isArray(o==null?void 0:o.data)?o.data:[]).slice(0,a)}function HSe({patientId:t,contextType:s,admissionId:r,bedId:a,surgeonUserId:i,anaesthetistUserId:l,date:o,plannedStartTime:c,plannedEndTime:d,priority:u,side:m,procedureName:x,primaryProcedureId:g,additionalProcedureIds:y=[],notes:v}){const j=py(s);if(!o||!c)throw new Error("OT date and start time are required");if(!i)throw new Error("Surgeon is required for OT schedule");const w=(x||"").trim();if(!w)throw new Error("Procedure name is required for OT schedule");const S={date:o,planned_start_time:c,planned_end_time:d||null,patient_id:t?Number(t):null,admission_id:j==="ipd"&&r?Number(r):null,bed_id:a?Number(a):null,surgeon_user_id:Number(i),anaesthetist_user_id:l?Number(l):null,procedure_name:w,side:m||null,priority:u||"Elective",notes:v||null,primary_procedure_id:g?Number(g):null,additional_procedure_ids:Array.isArray(y)?y.map(E=>Number(E)):[]};return TK(S)}async function WSe({patientId:t,admissionId:s,limit:r=10}){if(!t)return[];const a=await EK({});return(Array.isArray(a==null?void 0:a.data)?a.data:[]).filter(o=>!(s&&o.admission_id&&o.admission_id!==s)).slice(0,r)}async function qSe(t){return(await H_e(t)).data}async function GSe(t){return W_e(t)}function fP({value:t,onChange:s}){const[r,a]=p.useState([]),[i,l]=p.useState(""),[o,c]=p.useState([]),[d,u]=p.useState(""),[m,x]=p.useState([]);return p.useEffect(()=>{E2().then(g=>a(g.data||[]))},[]),p.useEffect(()=>{c([]),u(""),x([]),i&&xy({ward_id:i}).then(g=>c(g.data||[]))},[i]),p.useEffect(()=>{x([]),d&&Eo({room_id:d}).then(g=>x(g.data||[]))},[d]),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Allocate Bed (Ward  Room  Bed)"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("select",{className:"input",value:i,onChange:g=>l(g.target.value),children:[n.jsx("option",{value:"",children:"Select ward"}),r.map(g=>n.jsxs("option",{value:g.id,children:[g.code,"  ",g.name]},g.id))]}),n.jsxs("select",{className:"input",value:d,onChange:g=>u(g.target.value),disabled:!i,children:[n.jsx("option",{value:"",children:"Select room"}),o.map(g=>n.jsxs("option",{value:g.id,children:[g.number,"  ",g.type]},g.id))]}),n.jsxs("select",{className:"input",value:t||"",onChange:g=>s(Number(g.target.value)),disabled:!d,children:[n.jsx("option",{value:"",children:"Select bed"}),m.map(g=>n.jsxs("option",{value:g.id,children:[g.code," ",g.state!=="vacant"?` ${g.state}`:""]},g.id))]})]}),!!t&&(()=>{const g=m.find(y=>y.id===t);return g?n.jsxs("div",{className:"text-xs text-gray-500",children:["Selected: ",n.jsx("span",{className:"font-medium",children:g.code})," (",g.state,")"]}):null})()]})}const KSe={initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18}},VC="nutryah_rx_templates_v1";function vb(...t){return t.filter(Boolean).join(" ")}const Gh={lab:{solid:"bg-gradient-to-b from-sky-500 via-sky-600 to-sky-700 text-white shadow-[0_12px_30px_rgba(2,132,199,0.22)] hover:brightness-[1.06] active:brightness-[0.98]",soft:"bg-sky-50 text-sky-800 border border-sky-200 hover:bg-sky-100/70",ring:"focus-visible:ring-sky-500/35",chip:"bg-sky-50 text-sky-700",icon:"text-sky-600"},ris:{solid:"bg-gradient-to-b from-indigo-500 via-indigo-600 to-indigo-700 text-white shadow-[0_12px_30px_rgba(79,70,229,0.22)] hover:brightness-[1.06] active:brightness-[0.98]",soft:"bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100/70",ring:"focus-visible:ring-indigo-500/35",chip:"bg-indigo-50 text-indigo-700",icon:"text-indigo-600"},rx:{solid:"bg-gradient-to-b from-emerald-500 via-emerald-600 to-emerald-700 text-white shadow-[0_12px_30px_rgba(16,185,129,0.22)] hover:brightness-[1.06] active:brightness-[0.98]",soft:"bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100/70",ring:"focus-visible:ring-emerald-500/35",chip:"bg-emerald-50 text-emerald-700",icon:"text-emerald-600"},ot:{solid:"bg-gradient-to-b from-amber-500 via-amber-600 to-amber-700 text-white shadow-[0_12px_30px_rgba(245,158,11,0.22)] hover:brightness-[1.06] active:brightness-[0.98]",soft:"bg-amber-50 text-amber-900 border border-amber-200 hover:bg-amber-100/70",ring:"focus-visible:ring-amber-500/35",chip:"bg-amber-50 text-amber-800",icon:"text-amber-600"},slate:{solid:"bg-gradient-to-b from-slate-800 via-slate-900 to-black text-white shadow-[0_14px_34px_rgba(2,6,23,0.24)] hover:brightness-[1.06] active:brightness-[0.98]",soft:"bg-slate-50 text-slate-800 border border-slate-200 hover:bg-slate-100/70",ring:"focus-visible:ring-slate-500/30",chip:"bg-slate-100 text-slate-700",icon:"text-slate-600"}};function g0({children:t,tone:s="slate"}){const r=Gh[s]||Gh.slate;return n.jsx("span",{className:vb("inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-semibold",r.chip),children:t})}function y8({icon:t,tone:s="slate",title:r,subtitle:a}){const i=Gh[s]||Gh.slate;return n.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-slate-200 bg-white/70 px-3 py-2 backdrop-blur",children:[n.jsx("div",{className:vb("h-9 w-9 rounded-2xl flex items-center justify-center shadow-sm border",i.soft),children:n.jsx(t,{className:vb("h-4 w-4",i.icon)})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:r}),n.jsx("div",{className:"text-[12px] font-semibold text-slate-900 truncate",children:a})]})]})}function yn({tone:t="slate",variant:s="solid",className:r="",...a}){const i=Gh[t]||Gh.slate,l="rounded-2xl font-semibold transition-all focus-visible:outline-none focus-visible:ring-4 disabled:opacity-60 disabled:pointer-events-none",o=s==="solid"?i.solid:s==="soft"?i.soft:"bg-white border border-slate-300 text-slate-800 hover:bg-slate-50";return n.jsx(ge,{...a,className:vb(l,o,i.ring,r),variant:s==="outline"?"outline":"default"})}function YSe(t){return t?t.full_name||t.name||`${t.prefix||""} ${t.first_name||""} ${t.last_name||""}`.replace(/\s+/g," ").trim():"Unknown patient"}function XSe(t){if(!t)return"";const s=t.gender||t.sex||"",r=t.age_display||t.age||"";return`${s}  ${r}`}function b0(t){if(!t)return"";try{return new Date(t).toLocaleString()}catch{return String(t)}}function Xx(t,s="Something went wrong"){var a,i;const r=(i=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:i.detail;if(typeof r=="string")return r;if(r&&!Array.isArray(r)&&typeof r=="object"){if(r.msg)return r.msg;try{return JSON.stringify(r)}catch{return s}}if(Array.isArray(r)){const l=r.map(o=>o==null?void 0:o.msg).filter(Boolean);if(l.length)return l.join(", ");try{return JSON.stringify(r)}catch{return s}}return t!=null&&t.message?t.message:s}function QSe(t){if(!t)return{am:0,af:0,pm:0,night:0};const s=String(t).trim().toUpperCase();if(s.includes("-")){const a=s.split("-").map(i=>parseInt(i||"0",10)||0);if(a.length===3)return{am:a[0],af:a[1],pm:0,night:a[2]};if(a.length>=4)return{am:a[0],af:a[1],pm:a[2],night:a[3]}}return{OD:{am:1,af:0,pm:0,night:0},QD:{am:1,af:0,pm:0,night:0},BD:{am:1,af:0,pm:0,night:1},BID:{am:1,af:0,pm:0,night:1},TID:{am:1,af:1,pm:0,night:1},TDS:{am:1,af:1,pm:0,night:1},QID:{am:1,af:1,pm:1,night:1},HS:{am:0,af:0,pm:0,night:1},NIGHT:{am:0,af:0,pm:0,night:1}}[s]||{am:0,af:0,pm:0,night:0}}function HC(t){const s=t!=null&&t.am?1:0,r=t!=null&&t.af?1:0,a=t!=null&&t.pm?1:0,i=t!=null&&t.night?1:0;return`${s}-${r}-${a}-${i}`}function p4(t){const s=URL.createObjectURL(t);window.open(s,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(s),6e4)}function f4(t,s){const r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=s,document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>URL.revokeObjectURL(r),6e4)}function g4(t){const s=URL.createObjectURL(t),r=window.open(s,"_blank","noopener,noreferrer");if(!r){ae.error("Popup blocked. Please allow popups to print.");return}const a=setInterval(()=>{try{r.focus(),r.print(),clearInterval(a),setTimeout(()=>URL.revokeObjectURL(s),6e4)}catch{}},700);setTimeout(()=>clearInterval(a),8e3)}async function y0(t,s){if(!t)return ae.error("Invalid Lab Order ID");try{const r=await Z2e(t),a=new Blob([r.data],{type:"application/pdf"});s==="view"&&p4(a),s==="download"&&f4(a,`lab_report_${t}.pdf`),s==="print"&&g4(a)}catch(r){console.error(r),ae.error(Xx(r,"Lab PDF failed"))}}function PK({patient:t,contextType:s,contextId:r,opNumber:a,ipNumber:i,bedLabel:l,currentUser:o,defaultLocationId:c}){var Xf,Sc,Ly,gu,bu,yu,Qf,vu,ju,Pa,Zf,Jf;const[d,u]=p.useState("lab"),[m,x]=p.useState(!1),[g,y]=p.useState({lab:[],ris:[],rx:[],ot:[]}),[v,j]=p.useState(""),[w,S]=p.useState([]),[E,k]=p.useState(!1),[A,I]=p.useState(!1),P=p.useRef(null),[O,D]=p.useState([]),[T,B]=p.useState("routine"),[U,W]=p.useState(""),[V,R]=p.useState(!1),F=p.useMemo(()=>O.map(we=>we.id),[O]),[G,H]=p.useState(""),[$,K]=p.useState([]),[le,se]=p.useState(!1),[J,ie]=p.useState(!1),te=p.useRef(null),[ne,q]=p.useState([]),[ee,X]=p.useState("routine"),[Z,Y]=p.useState(""),[Q,oe]=p.useState(!1),_e=p.useMemo(()=>ne.map(we=>we.id),[ne]),[xe,me]=p.useState(""),[Re,Ze]=p.useState([]),[$e,fe]=p.useState(!1),[Me,Ae]=p.useState(!1),Ke=p.useRef(null),[Le,He]=p.useState(null),[pt,Pe]=p.useState([]),[bt,It]=p.useState(""),[De,tt]=p.useState("5"),[ve,Ge]=p.useState("10"),[We,Ve]=p.useState("oral"),[Fe,ot]=p.useState("BF"),[ft,ce]=p.useState(""),[Ce,ze]=p.useState(!1),[Te,Nt]=p.useState({am:!0,af:!1,pm:!1,night:!0}),[Jt,ke]=p.useState(()=>{try{const we=localStorage.getItem(VC),Dt=we?JSON.parse(we):[];return Array.isArray(Dt)?Dt:[]}catch{return[]}}),[je,ht]=p.useState(""),[At,ms]=p.useState(null),[Zt,hs]=p.useState(""),[Is,_s]=p.useState(""),[Sn,tn]=p.useState(""),[Ts,Cn]=p.useState(""),[Pt,Ea]=p.useState([]),[Rr,Jn]=p.useState(!1),[Zl,Fi]=p.useState(!1),Jl=p.useRef(null),[Nr,xu]=p.useState(null),[pu,Ta]=p.useState("Elective"),[Pn,Os]=p.useState(""),[bl,Za]=p.useState(""),[Bo,yt]=p.useState(null),[yl,ln]=p.useState((o==null?void 0:o.id)||null),[wr,Nc]=p.useState(null),[Ss,bs]=p.useState(!1),[vs,Ne]=p.useState(!1),[ut,Ft]=p.useState(null),[Vt,Cs]=p.useState(null),[zn,Rs]=p.useState(!1),[gi,wc]=p.useState(null),$o=()=>{Ne(!1),Ft(null),Cs(null),wc(null),Rs(!1)},ye=p.useMemo(()=>{if(!s)return null;const we=String(s).toLowerCase();return we==="op"||we==="opd"?"opd":we==="ip"||we==="ipd"?"ipd":we},[s]),at=ye==="ipd"?"IPD Admission":"OPD Visit",Oe=ye==="ipd"?i?`IP No: ${i}`:"IP Number not set":a?`OP No: ${a}`:"OP Number not set",be=ye==="ipd"&&l?`Bed: ${l}`:null,$t=(o==null?void 0:o.id)||null,bn=!!(t!=null&&t.id&&ye&&r);p.useEffect(()=>{const we=Ot=>{const ys=Ot.target;P.current&&!P.current.contains(ys)&&I(!1),te.current&&!te.current.contains(ys)&&ie(!1),Ke.current&&!Ke.current.contains(ys)&&Ae(!1),Jl.current&&!Jl.current.contains(ys)&&Fi(!1)},Dt=Ot=>{Ot.key==="Escape"&&(I(!1),ie(!1),Ae(!1),Fi(!1))};return document.addEventListener("mousedown",we),document.addEventListener("keydown",Dt),()=>{document.removeEventListener("mousedown",we),document.removeEventListener("keydown",Dt)}},[]);const er=p.useCallback(async()=>{if(!(!(t!=null&&t.id)||!ye||!r)){x(!0);try{const[we,Dt,Ot,ys]=await Promise.all([$Se({patientId:t.id,contextType:ye,contextId:r,limit:10}),zSe({patientId:t.id,contextType:ye,contextId:r,limit:10}),VSe({patientId:t.id,contextType:ye,contextId:r,limit:10}),ye==="ipd"?WSe({patientId:t.id,admissionId:r,limit:10}):Promise.resolve([])]);y({lab:we||[],ris:Dt||[],rx:Ot||[],ot:ys||[]})}catch(we){console.error("Failed to load quick orders summary",we),ae.error("Unable to load recent orders for this patient.")}finally{x(!1)}}},[t==null?void 0:t.id,ye,r]);p.useEffect(()=>{er()},[er]);const qf=async we=>{if(ye!=="opd"||!r)return ae.error("Visit context missing");try{const Dt=await BSe(Number(r)),Ot=new Blob([Dt.data],{type:"application/pdf"});we==="view"&&p4(Ot),we==="download"&&f4(Ot,`opd_visit_${r}_summary.pdf`),we==="print"&&g4(Ot)}catch(Dt){console.error(Dt),ae.error(Xx(Dt,"Visit PDF failed"))}};p.useEffect(()=>{if(!v||v.trim().length<2){S([]);return}let we=!1;const Dt=setTimeout(async()=>{try{k(!0);const{data:Ot}=await hP({q:v.trim()});if(we)return;const ys=Array.isArray(Ot)?Ot:(Ot==null?void 0:Ot.items)||[];S(ys),I(!0)}catch(Ot){console.error(Ot),ae.error("Failed to fetch lab tests.")}finally{we||k(!1)}},180);return()=>{we=!0,clearTimeout(Dt)}},[v]);function Gf(we){we!=null&&we.id&&(D(Dt=>Dt.some(Ot=>Ot.id===we.id)?Dt:[...Dt,{id:we.id,code:we.code||we.short_code||"",name:we.name||we.test_name||""}]),j(""),I(!1))}function Bi(we){D(Dt=>Dt.filter(Ot=>Ot.id!==we))}async function ss(){if(!F.length)return ae.error("Add at least one lab test.");if(!(t!=null&&t.id))return ae.error("Patient missing for lab order.");if(!ye||!r)return ae.error("Missing context (OPD/IPD) for lab order.");R(!0);try{await bK({patient_id:t.id,context_type:ye,context_id:r,priority:T,test_ids:F,note:U||null}),ae.success("Lab order created"),D([]),W(""),j(""),er()}catch(we){console.error(we),ae.error(Xx(we,"Failed to create lab order"))}finally{R(!1)}}p.useEffect(()=>{if(!G||G.trim().length<2){K([]);return}let we=!1;const Dt=setTimeout(async()=>{try{se(!0);const{data:Ot}=await xP({q:G.trim()});if(we)return;const ys=Array.isArray(Ot)?Ot:(Ot==null?void 0:Ot.items)||[];K(ys),ie(!0)}catch(Ot){console.error(Ot),ae.error("Failed to fetch radiology tests.")}finally{we||se(!1)}},180);return()=>{we=!0,clearTimeout(Dt)}},[G]);function Dn(we){we!=null&&we.id&&(q(Dt=>Dt.some(Ot=>Ot.id===we.id)?Dt:[...Dt,{id:we.id,code:we.code||"",name:we.name||we.test_name||"",modality:we.modality||we.modality_code||""}]),H(""),ie(!1))}function Ry(we){q(Dt=>Dt.filter(Ot=>Ot.id!==we))}async function xS(){if(!_e.length)return ae.error("Add at least one radiology test.");if(!(t!=null&&t.id))return ae.error("Patient missing for radiology order.");if(!ye||!r)return ae.error("Missing context (OPD/IPD) for radiology order.");oe(!0);try{await Promise.all(_e.map(we=>vK({patient_id:t.id,test_id:Number(we),context_type:ye,context_id:r,ordering_user_id:$t,priority:ee,note:Z||null}))),ae.success("Radiology order(s) created"),q([]),Y(""),H(""),er()}catch(we){console.error(we),ae.error(Xx(we,"Failed to create radiology order(s)"))}finally{oe(!1)}}p.useEffect(()=>{if(!xe||xe.trim().length<2){Ze([]);return}let we=!1;const Dt=setTimeout(async()=>{try{fe(!0);const Ot=await kK({q:xe.trim(),type:"drug",limit:20});if(we)return;const ys=Array.isArray(Ot==null?void 0:Ot.data)?Ot.data:[];Ze(ys),Ae(!0)}catch(Ot){console.error(Ot),ae.error("Failed to search medicines from inventory.")}finally{we||fe(!1)}},180);return()=>{we=!0,clearTimeout(Dt)}},[xe]);function Kf(we){He(we),me(we.name||""),Ae(!1)}function _x(we){we==="OD"&&Nt({am:!0,af:!1,pm:!1,night:!1}),we==="BD"&&Nt({am:!0,af:!1,pm:!1,night:!0}),we==="TID"&&Nt({am:!0,af:!0,pm:!1,night:!0}),we==="QID"&&Nt({am:!0,af:!0,pm:!0,night:!0}),we==="NIGHT"&&Nt({am:!1,af:!1,pm:!1,night:!0})}function Yf(){if(!Le)return ae.error("Select a medicine from inventory.");const we=parseFloat(ve||"0")||0,Dt=parseInt(De||"0",10)||null;if(!we)return ae.error("Enter a valid quantity.");const Ot=HC(Te);Pe(ys=>[...ys,{item_id:Le.id,item_name:Le.name,requested_qty:we,dose_text:bt||null,frequency_code:Ot,duration_days:Dt,route:We||null,timing:Fe||null,instructions:null}]),He(null),me(""),Ge("10"),It("")}function pS(we){Pe(Dt=>Dt.filter((Ot,ys)=>ys!==we))}async function Lr(){if(!pt.length)return ae.error("Add at least one medicine.");if(!(t!=null&&t.id)||!ye||!r)return ae.error("Missing patient or context for prescription.");ze(!0);try{const we=await USe({patientId:t.id,contextType:ye,contextId:r,doctorUserId:$t,locationId:c,notes:ft,lines:pt});ae.success("Prescription created & sent to Pharmacy."),Pe([]),ce(""),me(""),He(null),ms(we&&typeof we=="object"?we:null),er()}catch(we){console.error(we),ae.error(Xx(we,"Failed to create prescription."))}finally{ze(!1)}}const $i=async(we,Dt)=>{if(!we)return ae.error("Invalid prescription ID");try{const Ot=await GSe(we),ys=new Blob([Ot.data],{type:"application/pdf"});Dt==="view"&&p4(ys),Dt==="download"&&f4(ys,`prescription_${we}.pdf`),Dt==="print"&&g4(ys)}catch(Ot){console.error(Ot),ae.error("Prescription PDF failed")}};p.useEffect(()=>{if(!Ts||Ts.trim().length<2){Ea([]);return}let we=!1;const Dt=setTimeout(async()=>{var Ot;try{Jn(!0);const ys=await pP({search:Ts.trim(),isActive:!0,limit:20});if(we)return;const Gs=Array.isArray((Ot=ys==null?void 0:ys.data)==null?void 0:Ot.items)?ys.data.items:Array.isArray(ys==null?void 0:ys.data)?ys.data:[];Ea(Gs),Fi(!0)}catch(ys){console.error(ys),ae.error("Failed to fetch OT procedures.")}finally{we||Jn(!1)}},180);return()=>{we=!0,clearTimeout(Dt)}},[Ts]);function _c(we){xu(we),Cn(we.name||we.procedure_name||""),Fi(!1)}async function ls(){if(ye!=="ipd")return ae.warning("OT booking via quick orders is only for IPD.");if(!Zt||!Is)return ae.warning("Please select OT date and start time.");if(!(t!=null&&t.id)||!r)return ae.error("Missing patient or admission for OT schedule.");const we=yl||(o==null?void 0:o.id);if(!we)return ae.error("Please select a surgeon.");const Dt=Nr?Nr.name||Nr.procedure_name:Ts==null?void 0:Ts.trim();if(!Dt)return ae.error("Please enter a procedure name.");bs(!0);try{await HSe({patientId:t.id,contextType:ye,admissionId:r,bedId:Bo,surgeonUserId:we,anaesthetistUserId:wr,date:Zt,plannedStartTime:Is,plannedEndTime:Sn||null,priority:pu,side:Pn||null,procedureName:Dt,primaryProcedureId:(Nr==null?void 0:Nr.id)||null,additionalProcedureIds:[],notes:bl}),ae.success("OT schedule created."),hs(""),_s(""),tn(""),yt(null),Cn(""),xu(null),Os(""),Ta("Elective"),Nc(null),Za(""),er()}catch(Ot){console.error(Ot),ae.error(Xx(Ot,"Failed to create OT schedule."))}finally{bs(!1)}}const fS=we=>{var Dt,Ot,ys,Gs,e0;we&&(ce(we.note||""),(Dt=we.defaults)!=null&&Dt.route&&Ve(we.defaults.route),(Ot=we.defaults)!=null&&Ot.timing&&ot(we.defaults.timing),(ys=we.defaults)!=null&&ys.days&&tt(String(we.defaults.days)),(Gs=we.defaults)!=null&&Gs.qty&&Ge(String(we.defaults.qty)),(e0=we.defaults)!=null&&e0.slots&&Nt(we.defaults.slots),ae.success(`Template applied: ${we.name}`))},js=()=>{const we=window.prompt("Template name? (e.g. OPD Standard)");if(!we)return;const Dt={id:`tpl_${Date.now()}`,name:we.trim(),note:ft||"",defaults:{route:We,timing:Fe,days:parseInt(De||"0",10)||0,qty:parseFloat(ve||"0")||0,slots:Te},created_at:new Date().toISOString()},Ot=[Dt,...Jt||[]].slice(0,30);ke(Ot);try{localStorage.setItem(VC,JSON.stringify(Ot||[]))}catch{}ht(Dt.id),ae.success("Template saved")},Zr=we=>{const Dt=(Jt||[]).filter(Ot=>Ot.id!==we);ke(Dt);try{localStorage.setItem(VC,JSON.stringify(Dt||[]))}catch{}je===we&&ht(""),ae.success("Template deleted")},gS=()=>{var Dt;const we=HC(Te);(Dt=navigator.clipboard)==null||Dt.writeText(we).then(()=>ae.success(`Copied: ${we}`),()=>ae.error("Copy failed"))},fu=async(we,Dt)=>{Ft(we),Cs(Dt),Ne(!0),wc(null);try{if(Rs(!0),we==="rx"&&(Dt!=null&&Dt.id)){const Ot=await qSe(Dt.id);wc(Ot);return}wc(Dt)}catch(Ot){console.error(Ot),ae.error("Failed to load details"),wc(Dt)}finally{Rs(!1)}};return n.jsxs(n.Fragment,{children:[n.jsx(mt.div,{className:"w-full",...KSe,children:n.jsx("div",{className:"rounded-[30px] bg-gradient-to-br from-slate-50 via-white to-slate-100 p-[1px] shadow-[0_26px_70px_rgba(15,23,42,0.12)]",children:n.jsxs(dt,{className:"border-0 bg-white/70 backdrop-blur-xl rounded-[30px] overflow-hidden",children:[n.jsx(gt,{className:"border-b border-slate-100 pb-4",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-b from-slate-900 to-black text-white flex items-center justify-center shadow-sm",children:n.jsx(Qs,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx(jt,{className:"text-base sm:text-lg font-semibold text-slate-900",children:"Quick Orders"}),n.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"Premium workflow  order Lab / Radiology / Pharmacy / OT from one place."})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[n.jsx(et,{className:"bg-slate-900 text-slate-50 px-3 py-1 rounded-full",children:at}),n.jsxs(et,{variant:"outline",className:"flex items-center gap-1.5 border-slate-300 bg-white/80 rounded-full",children:[n.jsx(jo,{className:"h-3 w-3 text-slate-500"}),n.jsx("span",{className:"font-medium text-slate-800",children:Oe})]}),be&&n.jsxs(et,{variant:"outline",className:"flex items-center gap-1.5 border-emerald-300 bg-emerald-50/90 rounded-full",children:[n.jsx(cn,{className:"h-3 w-3 text-emerald-600"}),n.jsx("span",{className:"font-medium text-emerald-700",children:be})]}),ye==="opd"&&r&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(yn,{tone:"slate",variant:"outline",className:"h-9 text-[11px]",onClick:()=>qf("view"),type:"button",children:[n.jsx(Wr,{className:"h-4 w-4 mr-2"}),"Visit PDF"]}),n.jsxs(yn,{tone:"slate",variant:"outline",className:"h-9 text-[11px]",onClick:()=>qf("print"),type:"button",children:[n.jsx(Ll,{className:"h-4 w-4 mr-2"}),"Print"]}),n.jsxs(yn,{tone:"slate",variant:"solid",className:"h-9 text-[11px]",onClick:()=>qf("download"),type:"button",children:[n.jsx(nn,{className:"h-4 w-4 mr-2"}),"Download"]})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(y8,{icon:or,tone:"slate",title:"Patient",subtitle:YSe(t)}),n.jsx(y8,{icon:jn,tone:"slate",title:"Demographics",subtitle:XSe(t)}),n.jsxs(yn,{type:"button",tone:"slate",variant:"outline",className:"h-10 ml-auto",onClick:()=>{er(),ae.success("Refreshed")},children:[n.jsx(ps,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})}),n.jsx(it,{className:"p-3 sm:p-4",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.22fr)_minmax(0,0.95fr)]",children:[n.jsx("div",{className:"space-y-3",children:n.jsxs(Do,{value:d,onValueChange:u,className:"w-full",children:[n.jsxs(Wl,{className:"w-full justify-start overflow-x-auto rounded-2xl bg-white/70 border border-slate-200 p-1 sticky top-0 z-10 backdrop-blur",children:[n.jsxs(zs,{value:"lab",className:"flex items-center gap-1.5 text-xs sm:text-[13px] rounded-xl",children:[n.jsx(tl,{className:"h-3.5 w-3.5"}),"Lab"]}),n.jsxs(zs,{value:"ris",className:"flex items-center gap-1.5 text-xs sm:text-[13px] rounded-xl",children:[n.jsx(iR,{className:"h-3.5 w-3.5"}),"Radiology"]}),n.jsxs(zs,{value:"rx",className:"flex items-center gap-1.5 text-xs sm:text-[13px] rounded-xl",children:[n.jsx(rr,{className:"h-3.5 w-3.5"}),"Pharmacy"]}),n.jsxs(zs,{value:"ot",className:"flex items-center gap-1.5 text-xs sm:text-[13px] rounded-xl",children:[n.jsx(lR,{className:"h-3.5 w-3.5"}),"OT"]})]}),n.jsx(Ls,{value:"lab",className:"mt-3",children:n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white/70 backdrop-blur p-4",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900",children:"Lab Order"}),n.jsx("div",{className:"text-[12px] text-slate-500 mt-1",children:"Select tests  priority  place order."})]}),n.jsxs(g0,{tone:"lab",children:[O.length," selected"]})]})}),n.jsxs("div",{className:"grid sm:grid-cols-[2fr_minmax(0,1fr)] gap-3",children:[n.jsxs("div",{ref:P,className:"space-y-1.5 relative",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Lab test (from Masters)"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"h-3.5 w-3.5 text-slate-400 absolute left-2 top-2.5"}),n.jsx(Ee,{value:v,onChange:we=>{j(we.target.value),I(!0)},placeholder:"Search test code / name",className:"h-10 text-xs pl-7 rounded-2xl"})]}),A&&(w.length>0||E)&&n.jsxs("div",{className:"absolute z-20 mt-1 w-full rounded-2xl border border-slate-200 bg-white shadow-xl max-h-56 overflow-auto text-xs",children:[E&&n.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 text-slate-500",children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}),"Searching"]}),!E&&!w.length&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"No tests found."}),!E&&w.map(we=>n.jsxs("button",{type:"button",onClick:()=>Gf(we),className:"w-full text-left px-3 py-2 hover:bg-slate-50 flex flex-col gap-0.5",children:[n.jsx("span",{className:"font-medium text-slate-900",children:we.name||we.test_name}),n.jsx("span",{className:"text-[11px] text-slate-500",children:we.code||we.short_code||""})]},we.id))]}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Linked to LIS Lab Test Masters."})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Priority"}),n.jsx("div",{className:"flex gap-1.5",children:["routine","urgent","stat"].map(we=>{const Dt=T===we;return n.jsx(yn,{type:"button",tone:"lab",variant:Dt?"solid":"outline",className:"flex-1 h-9 text-xs",onClick:()=>B(we),children:we==="routine"?"Routine":we==="urgent"?"Urgent":"STAT"},we)})})]})]}),O.length>0&&n.jsx(Fn,{className:"max-h-40 rounded-2xl border border-slate-200 bg-slate-50/60 p-2",children:n.jsx("ul",{className:"space-y-1.5 text-xs",children:O.map(we=>n.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-2xl bg-white px-3 py-2 border border-slate-100",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"font-semibold text-slate-900 truncate",children:we.name||"Lab test"}),n.jsxs("span",{className:"text-[11px] text-slate-500 truncate",children:["Code: ",we.code||""]})]}),n.jsx(ge,{type:"button",size:"icon",variant:"ghost",className:"h-9 w-9 text-slate-400 hover:text-red-500 rounded-2xl",onClick:()=>Bi(we.id),title:"Remove",children:""})]},we.id))})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Note (optional)"}),n.jsx(fs,{rows:2,value:U,onChange:we=>W(we.target.value),placeholder:"Special instructions for sample collection / processing.",className:"resize-none text-xs rounded-2xl"})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"PDF available after reporting (View/Print/Download from details)."}),n.jsx(yn,{type:"button",tone:"lab",variant:"solid",disabled:V||!bn,onClick:ss,className:"h-10 px-5 text-xs",children:V?"Placing Lab Order":"Place Lab Order"})]})]})}),n.jsx(Ls,{value:"ris",className:"mt-3",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"rounded-2xl border border-indigo-200 bg-indigo-50/60 px-3 py-2 text-[11px] text-indigo-800 flex items-start gap-2",children:[n.jsx(en,{className:"h-4 w-4 mt-0.5"}),n.jsx("div",{children:"RIS supports order creation here."})]}),n.jsxs("div",{className:"grid sm:grid-cols-[2fr_minmax(0,1fr)] gap-3",children:[n.jsxs("div",{ref:te,className:"space-y-1.5 relative",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Radiology test (from RIS Masters)"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"h-3.5 w-3.5 text-slate-400 absolute left-2 top-2.5"}),n.jsx(Ee,{value:G,onChange:we=>{H(we.target.value),ie(!0)},placeholder:"Search X-Ray / CT / MRI / USG",className:"h-10 text-xs pl-7 rounded-2xl"})]}),J&&($.length>0||le)&&n.jsxs("div",{className:"absolute z-20 mt-1 w-full rounded-2xl border border-slate-200 bg-white shadow-xl max-h-56 overflow-auto text-xs",children:[le&&n.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 text-slate-500",children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}),"Searching"]}),!le&&!$.length&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"No tests found."}),!le&&$.map(we=>n.jsxs("button",{type:"button",onClick:()=>Dn(we),className:"w-full text-left px-3 py-2 hover:bg-slate-50 flex flex-col gap-0.5",children:[n.jsxs("div",{className:"flex justify-between items-center gap-2",children:[n.jsx("span",{className:"font-medium text-slate-900 truncate",children:we.name||we.test_name}),n.jsx("span",{className:"text-[10px] text-slate-500 shrink-0",children:we.modality||we.modality_code||""})]}),n.jsx("span",{className:"text-[11px] text-slate-500 truncate",children:we.code||""})]},we.id))]}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Linked to Radiology masters."})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Priority"}),n.jsx("div",{className:"flex gap-1.5",children:["routine","urgent","stat"].map(we=>{const Dt=ee===we;return n.jsx(yn,{type:"button",tone:"ris",variant:Dt?"solid":"outline",className:"flex-1 h-9 text-xs",onClick:()=>X(we),children:we==="routine"?"Routine":we==="urgent"?"Urgent":"STAT"},we)})})]})]}),ne.length>0&&n.jsx(Fn,{className:"max-h-40 rounded-2xl border border-slate-200 bg-slate-50/60 p-2",children:n.jsx("ul",{className:"space-y-1.5 text-xs",children:ne.map(we=>n.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-2xl bg-white px-3 py-2 border border-slate-100",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"font-semibold text-slate-900 truncate",children:we.name||"Radiology test"}),n.jsxs("span",{className:"text-[11px] text-slate-500 truncate",children:[we.modality||"RIS","  Code: ",we.code||""]})]}),n.jsx(ge,{type:"button",size:"icon",variant:"ghost",className:"h-9 w-9 text-slate-400 hover:text-red-500 rounded-2xl",onClick:()=>Ry(we.id),title:"Remove",children:""})]},we.id))})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Note (optional)"}),n.jsx(fs,{rows:2,value:Z,onChange:we=>Y(we.target.value),placeholder:"Side / position / contrast / clinical history etc.",className:"resize-none text-xs rounded-2xl"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(yn,{type:"button",tone:"ris",variant:"solid",disabled:Q||!bn,onClick:xS,className:"h-10 px-5 text-xs",children:Q?"Placing Radiology Order":"Place Radiology Order"})})]})}),n.jsx(Ls,{value:"rx",className:"mt-3",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white/70 backdrop-blur p-4",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx($n,{className:"h-4 w-4 text-emerald-600"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900",children:"Macros & Templates"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Fast Rx creation  schedule macros + reusable templates."})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(yn,{type:"button",tone:"rx",variant:"outline",className:"h-9 text-[11px]",onClick:gS,children:[n.jsx(nue,{className:"h-4 w-4 mr-2"}),"Copy schedule"]}),n.jsxs(yn,{type:"button",tone:"rx",variant:"outline",className:"h-9 text-[11px]",onClick:js,children:[n.jsx(Xn,{className:"h-4 w-4 mr-2"}),"Save template"]}),n.jsxs("select",{className:"h-9 rounded-2xl border border-slate-300 bg-white px-3 text-[11px] font-semibold text-slate-800",value:je,onChange:we=>{const Dt=we.target.value;ht(Dt);const Ot=(Jt||[]).find(ys=>ys.id===Dt);Ot&&fS(Ot)},children:[n.jsx("option",{value:"",children:"Select template"}),(Jt||[]).map(we=>n.jsx("option",{value:we.id,children:we.name},we.id))]}),je&&n.jsxs(ge,{type:"button",variant:"ghost",className:"h-9 rounded-2xl text-[11px] text-rose-600 hover:text-rose-700",onClick:()=>Zr(je),title:"Delete selected template",children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[["OD","BD","TID","QID","NIGHT"].map(we=>n.jsx(yn,{type:"button",tone:"rx",variant:"outline",className:"h-9 rounded-full text-[11px]",onClick:()=>_x(we),children:we},we)),n.jsxs("span",{className:"ml-1 text-[11px] text-slate-500 inline-flex items-center",children:["Schedule:"," ",n.jsx("span",{className:"ml-1 font-semibold text-slate-900",children:HC(Te)})]})]})]}),n.jsxs("div",{ref:Ke,className:"space-y-1.5 relative",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Search medicine (Pharmacy Inventory)"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"h-3.5 w-3.5 text-slate-400 absolute left-2 top-3"}),n.jsx(Ee,{value:xe,onChange:we=>{me(we.target.value),Ae(!0)},placeholder:"Search drug name / brand / generic",className:"h-10 text-xs pl-7 rounded-2xl"})]}),Me&&(Re.length>0||$e)&&n.jsxs("div",{className:"absolute z-20 mt-1 w-full rounded-2xl border border-slate-200 bg-white shadow-xl max-h-56 overflow-auto text-xs",children:[$e&&n.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 text-slate-500",children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}),"Searching"]}),!$e&&!Re.length&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"No items found."}),!$e&&Re.map(we=>n.jsxs("button",{type:"button",onClick:()=>Kf(we),className:"w-full text-left px-3 py-2 hover:bg-slate-50 flex flex-col gap-0.5",children:[n.jsxs("div",{className:"flex justify-between items-center gap-2",children:[n.jsx("span",{className:"font-medium text-slate-900 truncate",children:we.name}),we.code&&n.jsx("span",{className:"text-[10px] text-slate-500 shrink-0",children:we.code})]}),n.jsx("span",{className:"text-[11px] text-slate-500 truncate",children:we.strength||we.form||""})]},we.id))]})]}),n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Dosage"}),n.jsx(Ee,{value:bt,onChange:we=>It(we.target.value),placeholder:"e.g. 500mg / 1 tab",className:"h-9 text-[11px] rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Days"}),n.jsx(Ee,{value:De,onChange:we=>tt(we.target.value),placeholder:"5",className:"h-9 text-[11px] rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Qty"}),n.jsx(Ee,{value:ve,onChange:we=>Ge(we.target.value),placeholder:"10",className:"h-9 text-[11px] rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Timing"}),n.jsxs("select",{className:"h-9 w-full rounded-2xl border border-slate-300 bg-white px-3 text-[11px] font-semibold text-slate-800",value:Fe,onChange:we=>ot(we.target.value),children:[n.jsx("option",{value:"BF",children:"Before food (BF)"}),n.jsx("option",{value:"AF",children:"After food (AF)"}),n.jsx("option",{value:"NA",children:"No timing"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_1fr_auto] gap-2 items-end",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Route"}),n.jsxs("select",{className:"h-9 w-full rounded-2xl border border-slate-300 bg-white px-3 text-[11px] font-semibold text-slate-800",value:We,onChange:we=>Ve(we.target.value),children:[n.jsx("option",{value:"oral",children:"Oral"}),n.jsx("option",{value:"iv",children:"IV"}),n.jsx("option",{value:"im",children:"IM"}),n.jsx("option",{value:"topical",children:"Topical"}),n.jsx("option",{value:"inhalation",children:"Inhalation"}),n.jsx("option",{value:"other",children:"Other"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Schedule (AM / AF / PM / NIGHT)"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:[["am","AM"],["af","AF"],["pm","PM"],["night","NIGHT"]].map(([we,Dt])=>{const Ot=!!Te[we];return n.jsx("button",{type:"button",onClick:()=>Nt(ys=>({...ys,[we]:!ys[we]})),className:vb("h-9 px-4 rounded-full border text-[11px] font-semibold transition-all",Ot?Gh.rx.solid:"bg-white border-slate-300 text-slate-800 hover:bg-slate-50"),children:Dt},we)})})]}),n.jsx(yn,{type:"button",tone:"rx",variant:"solid",className:"h-9 px-4 text-[11px] rounded-full",onClick:Yf,children:"Add line"})]}),pt.length>0&&n.jsx("div",{className:"border border-slate-200 rounded-2xl bg-slate-50/60 overflow-hidden",children:n.jsx(Fn,{className:"max-h-60",children:n.jsx("div",{className:"min-w-[860px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-100 text-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-2 text-left font-semibold",children:"S.NO"}),n.jsx("th",{className:"px-2 py-2 text-left font-semibold",children:"Drug/Medicine"}),n.jsx("th",{className:"px-2 py-2 text-left font-semibold",children:"Dosage"}),n.jsx("th",{className:"px-2 py-2 text-center font-semibold",children:"AM"}),n.jsx("th",{className:"px-2 py-2 text-center font-semibold",children:"AF"}),n.jsx("th",{className:"px-2 py-2 text-center font-semibold",children:"PM"}),n.jsx("th",{className:"px-2 py-2 text-center font-semibold",children:"NIGHT"}),n.jsx("th",{className:"px-2 py-2 text-center font-semibold",children:"DAYS"}),n.jsx("th",{className:"px-2 py-2 text-right font-semibold",children:"Qty"}),n.jsx("th",{className:"px-2 py-2 text-right font-semibold",children:"Action"})]})}),n.jsx("tbody",{className:"bg-white",children:pt.map((we,Dt)=>{const Ot=QSe(we.frequency_code),ys=[we.dose_text,we.route,we.timing].filter(Boolean).join("  ");return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-2 py-2 text-slate-500",children:Dt+1}),n.jsx("td",{className:"px-2 py-2 font-medium text-slate-900",children:we.item_name}),n.jsx("td",{className:"px-2 py-2 text-slate-700",children:ys||""}),n.jsx("td",{className:"px-2 py-2 text-center font-semibold",children:Ot.am}),n.jsx("td",{className:"px-2 py-2 text-center font-semibold",children:Ot.af}),n.jsx("td",{className:"px-2 py-2 text-center font-semibold",children:Ot.pm}),n.jsx("td",{className:"px-2 py-2 text-center font-semibold",children:Ot.night}),n.jsx("td",{className:"px-2 py-2 text-center font-semibold",children:we.duration_days??""}),n.jsx("td",{className:"px-2 py-2 text-right font-semibold text-slate-800",children:we.requested_qty}),n.jsx("td",{className:"px-2 py-2 text-right",children:n.jsx(ge,{type:"button",size:"icon",variant:"ghost",className:"h-8 w-8 text-slate-400 hover:text-red-500 rounded-2xl",onClick:()=>pS(Dt),title:"Remove",children:""})})]},Dt)})})]})})})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Clinical notes / Rx note (optional)"}),n.jsx(fs,{rows:2,value:ft,onChange:we=>ce(we.target.value),className:"resize-none text-xs rounded-2xl"})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Creates patient-ready Prescription PDF (View/Print/Download)."}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[(At==null?void 0:At.id)&&n.jsxs(n.Fragment,{children:[n.jsxs(yn,{type:"button",tone:"rx",variant:"outline",className:"h-10",onClick:()=>$i(At.id,"view"),children:[n.jsx(Wr,{className:"h-4 w-4 mr-2"}),"View PDF"]}),n.jsxs(yn,{type:"button",tone:"rx",variant:"outline",className:"h-10",onClick:()=>$i(At.id,"print"),children:[n.jsx(Ll,{className:"h-4 w-4 mr-2"}),"Print"]}),n.jsxs(yn,{type:"button",tone:"rx",variant:"solid",className:"h-10",onClick:()=>$i(At.id,"download"),children:[n.jsx(nn,{className:"h-4 w-4 mr-2"}),"Download"]})]}),n.jsx(yn,{type:"button",tone:"rx",variant:"solid",disabled:Ce||!bn,onClick:Lr,className:"h-10 px-5 text-xs",children:Ce?"Saving Rx":"Save & Send to Pharmacy"})]})]})]})}),n.jsx(Ls,{value:"ot",className:"mt-3",children:n.jsxs("div",{className:"space-y-3",children:[ye!=="ipd"&&n.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-800 flex items-start gap-2",children:[n.jsx(en,{className:"h-4 w-4 mt-0.5"}),"OT quick booking is only for IPD admission context."]}),n.jsxs("div",{className:"grid sm:grid-cols-3 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-xs font-medium text-slate-600",children:["OT Date ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx(Ee,{type:"date",value:Zt,onChange:we=>hs(we.target.value),className:"h-10 text-xs rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-xs font-medium text-slate-600",children:["Start time ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx(Ee,{type:"time",value:Is,onChange:we=>_s(we.target.value),className:"h-10 text-xs rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"End time (optional)"}),n.jsx(Ee,{type:"time",value:Sn,onChange:we=>tn(we.target.value),className:"h-10 text-xs rounded-2xl"})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"OT Location / Bed"}),n.jsx(fP,{value:Bo?Number(Bo):null,onChange:we=>yt(we||null)})]}),n.jsxs("div",{ref:Jl,className:"space-y-1.5 relative",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Procedure (OT Master or free text)"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"h-3.5 w-3.5 text-slate-400 absolute left-2 top-3"}),n.jsx(Ee,{value:Ts,onChange:we=>{Cn(we.target.value),Fi(!0)},placeholder:"Search procedure name / code",className:"h-10 text-xs pl-7 rounded-2xl"})]}),Zl&&(Pt.length>0||Rr)&&n.jsxs("div",{className:"absolute z-20 mt-1 w-full rounded-2xl border border-slate-200 bg-white shadow-xl max-h-56 overflow-auto text-xs",children:[Rr&&n.jsxs("div",{className:"px-3 py-2 flex items-center gap-2 text-slate-500",children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}),"Searching"]}),!Rr&&!Pt.length&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"No procedures found."}),!Rr&&Pt.map(we=>n.jsxs("button",{type:"button",onClick:()=>_c(we),className:"w-full text-left px-3 py-2 hover:bg-slate-50 flex flex-col gap-0.5",children:[n.jsx("span",{className:"font-medium text-slate-900",children:we.name||we.procedure_name}),n.jsx("span",{className:"text-[11px] text-slate-500",children:we.code||""})]},we.id))]})]}),n.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Side"}),n.jsxs("select",{className:"w-full rounded-2xl border border-slate-300 bg-white px-3 py-2.5 text-xs text-slate-800",value:Pn,onChange:we=>Os(we.target.value),children:[n.jsx("option",{value:"",children:"Not applicable"}),n.jsx("option",{value:"Right",children:"Right"}),n.jsx("option",{value:"Left",children:"Left"}),n.jsx("option",{value:"Bilateral",children:"Bilateral"}),n.jsx("option",{value:"Midline",children:"Midline"})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Priority"}),n.jsx("div",{className:"flex gap-1.5",children:["Elective","Emergency"].map(we=>{const Dt=pu===we;return n.jsx(yn,{type:"button",tone:"ot",variant:Dt?"solid":"outline",className:"flex-1 h-9 text-xs",onClick:()=>Ta(we),children:we},we)})})]})]}),n.jsxs("div",{className:"grid sm:grid-cols-2 gap-3",children:[n.jsx(xc,{label:"Surgeon",value:yl?Number(yl):null,onChange:we=>ln(we||null)}),n.jsx(xc,{label:"Anaesthetist",value:wr?Number(wr):null,onChange:we=>Nc(we||null)})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Notes / anaesthesia plan (optional)"}),n.jsx(fs,{rows:2,value:bl,onChange:we=>Za(we.target.value),className:"resize-none text-xs rounded-2xl"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(yn,{type:"button",tone:"ot",variant:"solid",disabled:Ss||!bn||ye!=="ipd",onClick:ls,className:"h-10 px-5 text-xs",children:Ss?"Creating OT schedule":"Create OT schedule"})})]})})]})}),n.jsxs("div",{className:"space-y-3 lg:sticky lg:top-3 self-start",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-xs font-semibold text-slate-700 uppercase tracking-wide",children:["Recent orders (this ",at.toLowerCase(),")"]}),m&&n.jsxs("span",{className:"text-[11px] text-slate-500 flex items-center gap-1",children:[n.jsx(Rt,{className:"h-3 w-3 animate-spin"}),"Loading"]})]}),n.jsxs(dt,{className:"border-slate-200 bg-white/70 backdrop-blur rounded-2xl",children:[n.jsxs(gt,{className:"py-3 px-4 flex flex-row items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(tl,{className:"h-4 w-4 text-sky-600"}),n.jsx(jt,{className:"text-xs font-semibold",children:"Lab Orders"})]}),n.jsxs(g0,{tone:"lab",children:[((Xf=g.lab)==null?void 0:Xf.length)||0," orders"]})]}),n.jsx(it,{className:"px-4 pb-4 pt-0",children:n.jsxs("div",{className:"space-y-2 max-h-40 overflow-auto text-[11px]",children:[!((Sc=g.lab)!=null&&Sc.length)&&!m&&n.jsx("div",{className:"text-slate-500 text-[12px]",children:"No lab orders for this context yet."}),(Ly=g.lab)==null?void 0:Ly.map(we=>n.jsxs("div",{className:"flex items-stretch gap-2",children:[n.jsxs("button",{type:"button",onClick:()=>fu("lab",we),className:"flex-1 text-left flex items-center justify-between gap-2 px-3 py-2 rounded-2xl bg-white border border-slate-200 hover:bg-slate-50",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"font-semibold text-slate-900 truncate",children:we.order_no||`LAB-${String(we.id).padStart(6,"0")}`}),n.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:b0(we.created_at||we.order_datetime)})]}),n.jsx("span",{className:"text-[10px] text-slate-600 capitalize shrink-0",children:we.status||"ordered"})]}),n.jsx(yn,{type:"button",tone:"lab",variant:"outline",size:"icon",className:"h-10 w-10",title:"View PDF",onClick:()=>y0(we.id,"view"),children:n.jsx(Wr,{className:"h-4 w-4"})}),n.jsx(yn,{type:"button",tone:"lab",variant:"outline",size:"icon",className:"h-10 w-10",title:"Download PDF",onClick:()=>y0(we.id,"download"),children:n.jsx(nn,{className:"h-4 w-4"})})]},we.id))]})})]}),n.jsxs(dt,{className:"border-slate-200 bg-white/70 backdrop-blur rounded-2xl",children:[n.jsxs(gt,{className:"py-3 px-4 flex flex-row items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(iR,{className:"h-4 w-4 text-indigo-600"}),n.jsx(jt,{className:"text-xs font-semibold",children:"Radiology Orders"})]}),n.jsxs(g0,{tone:"ris",children:[((gu=g.ris)==null?void 0:gu.length)||0," orders"]})]}),n.jsx(it,{className:"px-4 pb-4 pt-0",children:n.jsxs("div",{className:"space-y-2 max-h-40 overflow-auto text-[11px]",children:[!((bu=g.ris)!=null&&bu.length)&&!m&&n.jsx("div",{className:"text-slate-500 text-[12px]",children:"No radiology orders for this context yet."}),(yu=g.ris)==null?void 0:yu.map(we=>n.jsxs("button",{type:"button",onClick:()=>fu("ris",we),className:"w-full text-left flex items-center justify-between gap-2 px-3 py-2 rounded-2xl bg-white border border-slate-200 hover:bg-slate-50",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"font-semibold text-slate-900 truncate",children:we.order_no||`RIS-${String(we.id).padStart(6,"0")}`}),n.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:b0(we.created_at||we.order_datetime)})]}),n.jsx("span",{className:"text-[10px] text-slate-600 capitalize shrink-0",children:we.status||"ordered"})]},we.id))]})})]}),n.jsxs(dt,{className:"border-slate-200 bg-white/70 backdrop-blur rounded-2xl",children:[n.jsxs(gt,{className:"py-3 px-4 flex flex-row items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(rr,{className:"h-4 w-4 text-emerald-600"}),n.jsx(jt,{className:"text-xs font-semibold",children:"Pharmacy Rx"})]}),n.jsxs(g0,{tone:"rx",children:[((Qf=g.rx)==null?void 0:Qf.length)||0," Rx"]})]}),n.jsx(it,{className:"px-4 pb-4 pt-0",children:n.jsxs("div",{className:"space-y-2 max-h-40 overflow-auto text-[11px]",children:[!((vu=g.rx)!=null&&vu.length)&&!m&&n.jsx("div",{className:"text-slate-500 text-[12px]",children:"No prescriptions for this context yet."}),(ju=g.rx)==null?void 0:ju.map(we=>n.jsxs("div",{className:"flex items-stretch gap-2",children:[n.jsxs("button",{type:"button",onClick:()=>fu("rx",we),className:"flex-1 text-left flex items-center justify-between gap-2 px-3 py-2 rounded-2xl bg-white border border-slate-200 hover:bg-slate-50",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"font-semibold text-slate-900 truncate",children:we.rx_number||`RX-${String(we.id).padStart(6,"0")}`}),n.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:b0(we.rx_datetime||we.created_at)})]}),n.jsx("span",{className:"text-[10px] text-slate-600 capitalize shrink-0",children:we.status||"pending"})]}),n.jsx(yn,{type:"button",tone:"rx",variant:"outline",size:"icon",className:"h-10 w-10",title:"View PDF",onClick:()=>$i(we.id,"view"),children:n.jsx(Wr,{className:"h-4 w-4"})}),n.jsx(yn,{type:"button",tone:"rx",variant:"outline",size:"icon",className:"h-10 w-10",title:"Download PDF",onClick:()=>$i(we.id,"download"),children:n.jsx(nn,{className:"h-4 w-4"})})]},we.id))]})})]}),ye==="ipd"&&n.jsxs(dt,{className:"border-slate-200 bg-white/70 backdrop-blur rounded-2xl",children:[n.jsxs(gt,{className:"py-3 px-4 flex flex-row items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(lR,{className:"h-4 w-4 text-amber-600"}),n.jsx(jt,{className:"text-xs font-semibold",children:"OT Schedules"})]}),n.jsxs(g0,{tone:"ot",children:[((Pa=g.ot)==null?void 0:Pa.length)||0," cases"]})]}),n.jsx(it,{className:"px-4 pb-4 pt-0",children:n.jsxs("div",{className:"space-y-2 max-h-40 overflow-auto text-[11px]",children:[!((Zf=g.ot)!=null&&Zf.length)&&!m&&n.jsx("div",{className:"text-slate-500 text-[12px]",children:"No OT schedules for this admission yet."}),(Jf=g.ot)==null?void 0:Jf.map(we=>n.jsxs("button",{type:"button",onClick:()=>fu("ot",we),className:"w-full text-left flex items-center justify-between gap-2 px-3 py-2 rounded-2xl bg-white border border-slate-200 hover:bg-slate-50",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"font-semibold text-slate-900 truncate",children:we.case_no||`OT-${String(we.id).padStart(6,"0")}`}),n.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:b0(we.created_at||we.scheduled_at)})]}),n.jsx("span",{className:"text-[10px] text-slate-600 capitalize shrink-0",children:we.status||"planned"})]},we.id))]})})]})]})]})})]})})}),n.jsx(fb,{open:vs,onOpenChange:we=>we?Ne(!0):$o(),children:n.jsxs(sf,{side:"right",className:"w-full sm:max-w-xl",children:[n.jsxs(gb,{children:[n.jsxs(bb,{className:"text-base",children:[ut==="lab"&&"Lab Order",ut==="ris"&&"Radiology Order",ut==="rx"&&"Prescription",ut==="ot"&&"OT Schedule"]}),n.jsx(yb,{className:"text-xs",children:Vt!=null&&Vt.id?`ID: ${Vt.id}`:""})]}),n.jsxs("div",{className:"mt-4 space-y-3",children:[zn&&n.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-2",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"})," Loading"]}),!zn&&Vt&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 text-xs",children:[n.jsx("div",{className:"font-semibold text-slate-900",children:"Summary"}),n.jsxs("div",{className:"mt-1 text-slate-600",children:["Created:"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:b0(Vt.created_at||Vt.order_datetime)})]}),n.jsxs("div",{className:"mt-1 text-slate-600",children:["Status:"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:Vt.status||""})]})]}),ut==="lab"&&(Vt==null?void 0:Vt.id)&&n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs(yn,{tone:"lab",variant:"outline",className:"rounded-2xl",onClick:()=>y0(Vt.id,"view"),children:[n.jsx(Wr,{className:"h-4 w-4 mr-2"})," View PDF"]}),n.jsxs(yn,{tone:"lab",variant:"outline",className:"rounded-2xl",onClick:()=>y0(Vt.id,"print"),children:[n.jsx(Ll,{className:"h-4 w-4 mr-2"})," Print"]}),n.jsxs(yn,{tone:"lab",variant:"solid",className:"rounded-2xl",onClick:()=>y0(Vt.id,"download"),children:[n.jsx(nn,{className:"h-4 w-4 mr-2"})," Download"]})]}),ut==="rx"&&(Vt==null?void 0:Vt.id)&&n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs(yn,{tone:"rx",variant:"outline",className:"rounded-2xl",onClick:()=>$i(Vt.id,"view"),children:[n.jsx(Wr,{className:"h-4 w-4 mr-2"})," View PDF"]}),n.jsxs(yn,{tone:"rx",variant:"outline",className:"rounded-2xl",onClick:()=>$i(Vt.id,"print"),children:[n.jsx(Ll,{className:"h-4 w-4 mr-2"})," Print"]}),n.jsxs(yn,{tone:"rx",variant:"solid",className:"rounded-2xl",onClick:()=>$i(Vt.id,"download"),children:[n.jsx(nn,{className:"h-4 w-4 mr-2"})," Download"]})]})]})]})]})})]})}function b4(t){const s=dn(l=>l.user),r=dn(l=>l.modules)||{};if(!t||!s)return!1;if(s.is_admin)return!0;const[a]=t.split(".");return(r[a]||[]).some(l=>l.code===t)}const ZSe=["Conscious, oriented, stable","Conscious, disoriented","Drowsy but arousable","Unconscious","Restless / agitated","Breathless / tachypnoeic","Post-op stable","Critical, on ventilator"],JSe=["Dressing clean, dry, intact","Dressing slightly soaked","Dressing soaked  change required","Oozing serous discharge","Oozing blood","Redness / swelling around wound","Signs of infection  pus / foul smell"],eCe=["Room air","Nasal cannula 2 L/min","Nasal cannula 4 L/min","Simple face mask 5 L/min","NRBM 10 L/min","HFNC","BiPAP","Ventilator  pressure mode","Ventilator  volume mode"],tCe=["None","Foley catheter in situ","Ryles tube in situ","Intercostal drain (ICD) in situ","Wound drain in situ","Central line in situ","Multiple drains / tubes present"],sCe=[{value:"routine",label:"Routine note"},{value:"incident",label:"Incident note"},{value:"shift_handover",label:"Shift handover note"}];function nCe({admissionId:t,canWrite:s}){const r=b4("ipd.nursing.create"),a=(s??!0)&&r,[i,l]=p.useState([]),[o,c]=p.useState(null),[d,u]=p.useState({entry_time:"",note_type:"routine",patient_condition:"",wound_status:"",oxygen_support:"",urine_output:"",drains_tubes:"",pain_score:"",other_findings:"",significant_events:"",nursing_interventions:"",response_progress:"",handover_note:"",shift:"",is_icu:!1,vital_signs_summary:"",todays_procedures:"",current_condition:"",recent_changes:"",ongoing_treatment:"",watch_next_shift:""}),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState(""),w=d.note_type==="shift_handover",S=()=>u({entry_time:"",note_type:"routine",patient_condition:"",wound_status:"",oxygen_support:"",urine_output:"",drains_tubes:"",pain_score:"",other_findings:"",significant_events:"",nursing_interventions:"",response_progress:"",handover_note:"",shift:"",is_icu:!1,vital_signs_summary:"",todays_procedures:"",current_condition:"",recent_changes:"",ongoing_treatment:"",watch_next_shift:""}),E=D=>{if(!D)return"";const T=new Date(D);return Number.isNaN(T.getTime())?"":T.toLocaleString()},k=p.useMemo(()=>!!(o&&(o.bp_systolic||o.temp_c||o.pulse)),[o]),A=async()=>{var D,T,B;if(t){x(!0),j("");try{const[U,W]=await Promise.allSettled([DNe(t),INe(t)]);U.status==="fulfilled"?l(U.value.data||[]):j(((B=(T=(D=U.reason)==null?void 0:D.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to load nursing notes"),W.status==="fulfilled"&&c(W.value.data||null)}finally{x(!1)}}};p.useEffect(()=>{A()},[t]);const I=D=>T=>{const B=T.target.type==="checkbox"?T.target.checked:T.target.value;u(U=>({...U,[D]:B}))},P=async D=>{var T,B;D.preventDefault(),j(""),y(!0);try{const U={entry_time:d.entry_time?new Date(d.entry_time).toISOString():void 0,note_type:d.note_type||"routine",patient_condition:d.patient_condition||"",wound_status:d.wound_status||"",oxygen_support:d.oxygen_support||"",urine_output:d.urine_output||"",drains_tubes:d.drains_tubes||"",pain_score:d.pain_score||"",other_findings:d.other_findings||"",significant_events:d.significant_events||"",nursing_interventions:d.nursing_interventions||"",response_progress:d.response_progress||"",handover_note:d.handover_note||"",shift:d.shift||null,is_icu:!!d.is_icu,vital_signs_summary:d.vital_signs_summary||"",todays_procedures:d.todays_procedures||"",current_condition:d.current_condition||"",recent_changes:d.recent_changes||"",ongoing_treatment:d.ongoing_treatment||"",watch_next_shift:d.watch_next_shift||"",linked_vital_id:(o==null?void 0:o.id)||void 0};await MNe(t,U),S(),await A()}catch(U){j(((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to save nursing note")}finally{y(!1)}},O=D=>{const T=D.note_type||"routine";return T==="incident"?n.jsx("span",{className:"inline-flex items-center rounded-full bg-rose-50 px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide text-rose-700",children:"Incident"}):T==="shift_handover"?n.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide text-amber-700",children:"Shift Handover"}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide text-emerald-700",children:"Routine"})};return n.jsxs("div",{className:"space-y-4",children:[!a&&n.jsxs("div",{className:"flex items-start gap-2 rounded-xl border border-amber-200 bg-amber-50 p-3 text-xs text-amber-800",children:[n.jsx(en,{className:"mt-0.5 h-4 w-4"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-semibold",children:"View-only access"}),n.jsx("div",{children:"You dont have permission to add nursing notes."})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50/80 p-3 md:p-4",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ac,{className:"h-4 w-4 text-slate-700"}),n.jsx("span",{className:"text-sm font-semibold text-slate-800",children:"Latest Vitals Snapshot"})]}),n.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[n.jsx(jn,{className:"h-3 w-3"}),n.jsx("span",{children:o!=null&&o.recorded_at?E(o.recorded_at):"No recent vitals"})]})]}),k?n.jsxs("div",{className:"grid gap-2 text-xs md:grid-cols-5",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-white px-2 py-1.5 shadow-sm",children:[n.jsx(Qs,{className:"h-3.5 w-3.5 text-slate-700"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"BP"}),n.jsxs("div",{className:"font-semibold text-slate-800",children:[o.bp_systolic??"","/",o.bp_diastolic??""," mmHg"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-white px-2 py-1.5 shadow-sm",children:[n.jsx(ab,{className:"h-3.5 w-3.5 text-slate-700"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Temp"}),n.jsxs("div",{className:"font-semibold text-slate-800",children:[o.temp_c??""," C"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-white px-2 py-1.5 shadow-sm",children:[n.jsx(Khe,{className:"h-3.5 w-3.5 text-slate-700"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"RR"}),n.jsxs("div",{className:"font-semibold text-slate-800",children:[o.rr??"","/min"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-white px-2 py-1.5 shadow-sm",children:[n.jsx(O3,{className:"h-3.5 w-3.5 text-slate-700"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"SpO"}),n.jsxs("div",{className:"font-semibold text-slate-800",children:[o.spo2??""," %"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-white px-2 py-1.5 shadow-sm",children:[n.jsx(Qs,{className:"h-3.5 w-3.5 text-slate-700"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-400",children:"Pulse"}),n.jsxs("div",{className:"font-semibold text-slate-800",children:[o.pulse??"","/min"]})]})]})]}):n.jsx("div",{className:"rounded-lg border border-dashed border-slate-500 bg-white px-3 py-2 text-xs text-slate-500",children:"No vitals recorded yet for this admission. Vitals should be entered in the Vitals tab  nursing notes will automatically link to the latest record."})]}),a&&n.jsxs("form",{onSubmit:P,className:"rounded-2xl border border-slate-500 bg-white p-3 shadow-sm md:p-4",children:[n.jsxs("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Pr,{className:"h-4 w-4 text-slate-700"}),n.jsx("h3",{className:"text-sm font-semibold text-slate-800",children:"Add Nursing Note"})]}),n.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Note type"}),n.jsx("select",{className:"rounded-full border border-slate-500 bg-slate-50 px-2 py-1 text-[11px] text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.note_type,onChange:I("note_type"),children:sCe.map(D=>n.jsx("option",{value:D.value,children:D.label},D.value))})]}),n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300",checked:d.is_icu,onChange:I("is_icu")}),n.jsx("span",{children:"ICU note"})]})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Entry time"}),n.jsx("input",{type:"datetime-local",className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.entry_time,onChange:I("entry_time")}),n.jsx("p",{className:"text-[10px] text-slate-400",children:"Leave blank to use current date & time."})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Patient condition"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.patient_condition,onChange:I("patient_condition"),children:[n.jsx("option",{value:"",children:"Select condition"}),ZSe.map(D=>n.jsx("option",{value:D,children:D},D))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Wound status"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.wound_status,onChange:I("wound_status"),children:[n.jsx("option",{value:"",children:"Select wound status"}),JSe.map(D=>n.jsx("option",{value:D,children:D},D))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Oxygen support"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.oxygen_support,onChange:I("oxygen_support"),children:[n.jsx("option",{value:"",children:"Select oxygen support"}),eCe.map(D=>n.jsx("option",{value:D,children:D},D))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Urine output"}),n.jsx("input",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",placeholder:"E.g. 200 ml clear in last 4 hrs; catheter in situ",value:d.urine_output,onChange:I("urine_output")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Drains / Tubes"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.drains_tubes,onChange:I("drains_tubes"),children:[n.jsx("option",{value:"",children:"Select drains / tubes"}),tCe.map(D=>n.jsx("option",{value:D,children:D},D))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Pain score"}),n.jsx("input",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",placeholder:"E.g. 3/10 on VAS",value:d.pain_score,onChange:I("pain_score")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Shift"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",value:d.shift,onChange:I("shift"),children:[n.jsx("option",{value:"",children:"Select shift"}),n.jsx("option",{value:"Morning",children:"Morning"}),n.jsx("option",{value:"Evening",children:"Evening"}),n.jsx("option",{value:"Night",children:"Night"})]})]}),n.jsxs("div",{className:"md:col-span-2 space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Significant events"}),n.jsx("textarea",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",rows:2,placeholder:"Shifting, fall, vomiting, seizure, desaturation, transfusion",value:d.significant_events,onChange:I("significant_events")})]}),n.jsxs("div",{className:"md:col-span-2 space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Nursing interventions"}),n.jsx("textarea",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",rows:2,placeholder:"Medications given, oxygen started, IV fluids, dressing, catheter care",value:d.nursing_interventions,onChange:I("nursing_interventions")})]}),n.jsxs("div",{className:"md:col-span-2 space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Patient response / progress"}),n.jsx("textarea",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",rows:2,placeholder:"Improved / no change / worsened, tolerance to interventions",value:d.response_progress,onChange:I("response_progress")})]}),n.jsxs("div",{className:"md:col-span-2 space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Handover note"}),n.jsx("textarea",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",rows:2,placeholder:"What next nurse must watch / continue",value:d.handover_note,onChange:I("handover_note")})]}),n.jsxs("div",{className:"md:col-span-2 space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Other findings"}),n.jsx("textarea",{className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2 py-1.5 text-xs text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-300",rows:2,placeholder:"Any other clinical observations",value:d.other_findings,onChange:I("other_findings")})]})]}),w&&n.jsxs("div",{className:"mt-4 rounded-2xl border border-amber-200 bg-amber-50/60 p-3 md:p-4",children:[n.jsx("div",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-amber-700",children:"Shift Handover Details"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"md:col-span-2 space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Vital signs summary"}),n.jsx("textarea",{className:"w-full rounded-lg border border-amber-200 bg-white px-2 py-1.5 text-xs text-slate-800 focus:border-amber-400 focus:outline-none focus:ring-1 focus:ring-amber-300",rows:2,placeholder:"E.g. Vitals stable, BP 120/80, HR 80/min, SpO 98% on room air",value:d.vital_signs_summary,onChange:I("vital_signs_summary")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Todays procedures"}),n.jsx("textarea",{className:"w-full rounded-lg border border-amber-200 bg-white px-2 py-1.5 text-xs text-slate-800 focus:border-amber-400 focus:outline-none focus:ring-1 focus:ring-amber-300",rows:2,placeholder:"Dressings, transfusions, physiotherapy, procedures done this shift",value:d.todays_procedures,onChange:I("todays_procedures")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Current condition"}),n.jsx("textarea",{className:"w-full rounded-lg border border-amber-200 bg-white px-2 py-1.5 text-xs text-slate-800 focus:border-amber-400 focus:outline-none focus:ring-1 focus:ring-amber-300",rows:2,placeholder:"Short summary: stable / critical / pain level / oxygen support",value:d.current_condition,onChange:I("current_condition")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Recent changes"}),n.jsx("textarea",{className:"w-full rounded-lg border border-amber-200 bg-white px-2 py-1.5 text-xs text-slate-800 focus:border-amber-400 focus:outline-none focus:ring-1 focus:ring-amber-300",rows:2,placeholder:"New symptoms, change in vitals, changes in orders this shift",value:d.recent_changes,onChange:I("recent_changes")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Ongoing treatment"}),n.jsx("textarea",{className:"w-full rounded-lg border border-amber-200 bg-white px-2 py-1.5 text-xs text-slate-800 focus:border-amber-400 focus:outline-none focus:ring-1 focus:ring-amber-300",rows:2,placeholder:"IV fluids, antibiotics, oxygen therapy, infusions",value:d.ongoing_treatment,onChange:I("ongoing_treatment")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"To be watched next shift"}),n.jsx("textarea",{className:"w-full rounded-lg border border-amber-200 bg-white px-2 py-1.5 text-xs text-slate-800 focus:border-amber-400 focus:outline-none focus:ring-1 focus:ring-amber-300",rows:2,placeholder:"Risks, observations, next dose timings, lab results to follow up",value:d.watch_next_shift,onChange:I("watch_next_shift")})]})]})]}),n.jsxs("div",{className:"mt-4 flex items-center justify-between gap-2",children:[v&&n.jsx("div",{className:"text-xs text-rose-600",children:v}),n.jsx("button",{type:"submit",disabled:g,className:"ml-auto inline-flex items-center gap-1 rounded-full bg-sky-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:bg-sky-300",children:g?"Saving":"Add Nursing Note"})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 md:px-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Pr,{className:"h-4 w-4 text-slate-700"}),n.jsx("span",{className:"text-sm font-semibold text-slate-800",children:"Recent Nursing Notes"})]}),m&&n.jsx("span",{className:"text-xs text-slate-500",children:"Loading"})]}),!m&&(!i||i.length===0)&&n.jsx("div",{className:"px-3 py-4 text-sm text-slate-500 md:px-4",children:"No nursing notes recorded yet."}),!m&&i&&i.length>0&&n.jsx("div",{className:"divide-y divide-slate-100",children:i.map(D=>n.jsxs("div",{className:"px-3 py-3 text-xs text-slate-800 md:px-4",children:[n.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-2 py-0.5 text-[11px] font-medium text-slate-700",children:[n.jsx(jn,{className:"h-3 w-3"}),E(D.entry_time)]}),O(D),D.shift&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-sky-50 px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide text-sky-700",children:D.shift}),D.is_icu&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-rose-50 px-2 py-0.5 text-[10px] font-medium uppercase tracking-wide text-rose-700",children:"ICU"})]}),D.nurse&&n.jsxs("div",{className:"flex items-center gap-1 text-[11px] text-slate-500",children:[n.jsx(or,{className:"h-3 w-3"}),n.jsx("span",{children:D.nurse.full_name})]})]}),D.vitals&&n.jsxs("div",{className:"mb-2 flex flex-wrap gap-1.5 text-[11px] text-slate-600",children:[n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-50 px-1.5 py-0.5",children:[n.jsx(Qs,{className:"h-3 w-3"}),"BP:"," ",D.vitals.bp_systolic??"","/",D.vitals.bp_diastolic??""]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-50 px-1.5 py-0.5",children:[n.jsx(ab,{className:"h-3 w-3"}),"Temp: ",D.vitals.temp_c??""," C"]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-50 px-1.5 py-0.5",children:[n.jsx(Qs,{className:"h-3 w-3"}),"Pulse: ",D.vitals.pulse??"","/min"]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-50 px-1.5 py-0.5",children:[n.jsx(O3,{className:"h-3 w-3"}),"SpO: ",D.vitals.spo2??""," %"]})]}),n.jsxs("div",{className:"space-y-0.5",children:[D.patient_condition&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Condition: "}),n.jsx("span",{children:D.patient_condition})]}),D.wound_status&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Wound: "}),n.jsx("span",{children:D.wound_status})]}),D.oxygen_support&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Oxygen: "}),n.jsx("span",{children:D.oxygen_support})]}),D.urine_output&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Urine: "}),n.jsx("span",{children:D.urine_output})]}),D.drains_tubes&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Drains/Tubes: "}),n.jsx("span",{children:D.drains_tubes})]}),D.pain_score&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Pain: "}),n.jsx("span",{children:D.pain_score})]}),D.significant_events&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Events: "}),n.jsx("span",{children:D.significant_events})]}),D.nursing_interventions&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Interventions: "}),n.jsx("span",{children:D.nursing_interventions})]}),D.response_progress&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Response: "}),n.jsx("span",{children:D.response_progress})]}),D.handover_note&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Handover: "}),n.jsx("span",{children:D.handover_note})]}),D.other_findings&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Other: "}),n.jsx("span",{children:D.other_findings})]}),D.note_type==="shift_handover"&&n.jsxs("div",{className:"mt-2 rounded-xl border border-amber-100 bg-amber-50/60 p-2 space-y-0.5",children:[D.vital_signs_summary&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Vital signs summary: "}),n.jsx("span",{children:D.vital_signs_summary})]}),D.todays_procedures&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Todays procedures: "}),n.jsx("span",{children:D.todays_procedures})]}),D.current_condition&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Current condition: "}),n.jsx("span",{children:D.current_condition})]}),D.recent_changes&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Recent changes: "}),n.jsx("span",{children:D.recent_changes})]}),D.ongoing_treatment&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Ongoing treatment: "}),n.jsx("span",{children:D.ongoing_treatment})]}),D.watch_next_shift&&n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"To be watched next shift: "}),n.jsx("span",{children:D.watch_next_shift})]})]})]})]},D.id))})]}),v&&!a&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 p-2 text-xs text-rose-700",children:v})]})}function rCe({admissionId:t,canWrite:s}){const r=ct("ipd.nursing"),a=typeof s=="boolean"?s:r,[i,l]=p.useState([]),[o,c]=p.useState({recorded_at:"",bp_systolic:"",bp_diastolic:"",temp_c:"",rr:"",spo2:"",pulse:""}),[d,u]=p.useState(""),[m,x]=p.useState(!1),[g,y]=p.useState(!1),v=p.useMemo(()=>i&&i.length>0?i[0]:null,[i]),j=async()=>{var k,A;if(t){x(!0),u("");try{const{data:I}=await ONe(t),P=Array.isArray(I)?I:[];P.sort((O,D)=>new Date(D.recorded_at||0)-new Date(O.recorded_at||0)),l(P)}catch(I){console.error("Vitals load error:",I),u(((A=(k=I==null?void 0:I.response)==null?void 0:k.data)==null?void 0:A.detail)||"Failed to load vitals"),l([])}finally{x(!1)}}};p.useEffect(()=>{j()},[t]);const w=(k,A)=>{c(I=>({...I,[k]:A}))},S=async k=>{var I,P;if(k.preventDefault(),u(""),!(o.recorded_at||o.bp_systolic||o.bp_diastolic||o.temp_c||o.rr||o.spo2||o.pulse)){u("Please enter at least one vital value before saving.");return}try{y(!0);const O={recorded_at:o.recorded_at?new Date(o.recorded_at).toISOString():void 0,bp_systolic:o.bp_systolic?Number(o.bp_systolic):void 0,bp_diastolic:o.bp_diastolic?Number(o.bp_diastolic):void 0,temp_c:o.temp_c?Number(o.temp_c):void 0,rr:o.rr?Number(o.rr):void 0,spo2:o.spo2?Number(o.spo2):void 0,pulse:o.pulse?Number(o.pulse):void 0};await bwe(t,O),c({recorded_at:"",bp_systolic:"",bp_diastolic:"",temp_c:"",rr:"",spo2:"",pulse:""}),await j()}catch(O){console.error("Vitals save error:",O),u(((P=(I=O==null?void 0:O.response)==null?void 0:I.data)==null?void 0:P.detail)||"Failed to save vitals")}finally{y(!1)}},E=k=>{if(!k)return"";try{const A=new Date(k);return Number.isNaN(A.getTime())?"":A.toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}catch{return""}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Vitals"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Track blood pressure, temperature, pulse, SpO and respiratory rate."})]}),v&&n.jsxs("div",{className:"rounded-xl border border-slate-500 bg-slate-50 px-3 py-2 text-xs text-slate-700",children:[n.jsx("div",{className:"font-medium text-[11px] uppercase tracking-wide text-slate-500",children:"Last recorded"}),n.jsx("div",{className:"mt-0.5 text-[13px]",children:E(v.recorded_at)}),n.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[11px]",children:[n.jsxs("span",{className:"rounded-full bg-white px-2 py-0.5 border border-slate-500",children:["BP:"," ",[v.bp_systolic,v.bp_diastolic].filter(Boolean).join("/")||""]}),n.jsxs("span",{className:"rounded-full bg-white px-2 py-0.5 border border-slate-500",children:["Temp: ",v.temp_c??""," C"]}),n.jsxs("span",{className:"rounded-full bg-white px-2 py-0.5 border border-slate-500",children:["SpO: ",v.spo2??""," %"]}),n.jsxs("span",{className:"rounded-full bg-white px-2 py-0.5 border border-slate-500",children:["Pulse: ",v.pulse??""," /min"]})]})]})]}),!a&&n.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:"View only. You dont have permission to record vitals."}),a&&n.jsxs("form",{onSubmit:S,className:"rounded-2xl border border-slate-500 bg-white p-4 shadow-sm space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h3",{className:"text-sm font-medium text-slate-900",children:"Record new vitals"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Fields are optional  fill what is measured."})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-4 lg:grid-cols-6",children:[n.jsxs("div",{className:"md:col-span-2 lg:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Recorded at"}),n.jsx("input",{type:"datetime-local",className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2.5 py-1.5 text-xs text-slate-900 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",value:o.recorded_at,onChange:k=>w("recorded_at",k.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"BP (Systolic)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"mmHg",value:o.bp_systolic,onChange:k=>w("bp_systolic",k.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"BP (Diastolic)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"mmHg",value:o.bp_diastolic,onChange:k=>w("bp_diastolic",k.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Temp (C)"}),n.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"C",value:o.temp_c,onChange:k=>w("temp_c",k.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"RR (/min)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"breaths/min",value:o.rr,onChange:k=>w("rr",k.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"SpO (%)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"%",value:o.spo2,onChange:k=>w("spo2",k.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Pulse (/min)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"/min",value:o.pulse,onChange:k=>w("pulse",k.target.value)})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-1",children:[d&&n.jsx("div",{className:"text-xs text-rose-600",children:d}),n.jsxs("button",{type:"submit",disabled:g,className:"inline-flex items-center gap-1 rounded-lg bg-sky-600 px-4 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[g&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border border-white border-t-transparent"}),n.jsx("span",{children:g?"Saving":"Record vitals"})]})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white shadow-sm overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 px-3 py-2",children:[n.jsx("div",{className:"text-xs font-medium text-slate-700",children:"Vitals history"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:m?"Loading":`${(i==null?void 0:i.length)||0} record${((i==null?void 0:i.length)||0)===1?"":"s"}`})]}),n.jsx("div",{className:"max-h-[320px] overflow-auto text-xs",children:n.jsxs("table",{className:"min-w-full border-collapse",children:[n.jsx("thead",{className:"sticky top-0 bg-slate-50 text-[11px] uppercase tracking-wide text-slate-500",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"BP (mmHg)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Temp (C)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"RR (/min)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"SpO (%)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Pulse (/min)"})]})}),n.jsxs("tbody",{children:[!m&&i&&i.map(k=>n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/60",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:E(k.recorded_at)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:[k.bp_systolic,k.bp_diastolic].filter(Boolean).join("/")||""}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:k.temp_c??""}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:k.rr??""}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:k.spo2??""}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:k.pulse??""})]},k.id)),!m&&(!i||i.length===0)&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-4 text-center text-slate-400",children:"No vitals recorded yet."})}),m&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-4 text-center text-slate-400",children:"Loading vitals"})})]})]})})]})]})}function aCe({admissionId:t}){const[s,r]=p.useState([]),[a,i]=p.useState(""),[l,o]=p.useState(!1),[c,d]=p.useState(!1),[u,m]=p.useState({recorded_at:"",intake_oral_ml:"",intake_iv_ml:"",intake_blood_ml:"",urine_foley_ml:"",urine_voided_ml:"",drains_ml:"",stools_count:"",remarks:""}),x=(T,B)=>{m(U=>({...U,[T]:B}))},g=T=>{if(T)return T.length===16?`${T}:00`:T},y=async()=>{var T,B;if(t){i(""),o(!0);try{const{data:U}=await LNe(t),W=(U||[]).slice().sort((V,R)=>new Date(R.recorded_at||0)-new Date(V.recorded_at||0));r(W)}catch(U){console.error("I/O load error:",U),i(((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to load intake / output"),r([])}finally{o(!1)}}};p.useEffect(()=>{y()},[t]);const v=T=>{const B=Number(T);return Number.isFinite(B)?B:0},j=T=>{const B=v(T==null?void 0:T.intake_oral_ml),U=v(T==null?void 0:T.intake_iv_ml),W=v(T==null?void 0:T.intake_blood_ml),V=B+U+W;return V>0?V:v(T==null?void 0:T.intake_ml)},w=T=>{const B=v(T==null?void 0:T.urine_foley_ml),U=v(T==null?void 0:T.urine_voided_ml),W=B+U;return W>0?W:v(T==null?void 0:T.urine_ml)},S=T=>w(T)+v(T==null?void 0:T.drains_ml),E=T=>{if(!T)return"";try{const B=new Date(T);return Number.isNaN(B.getTime())?"":B.toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}catch{return""}},k=T=>{if(!T)return"Night";const B=new Date(T);if(Number.isNaN(B.getTime()))return"Night";const U=B.getHours();return U>=6&&U<14?"Morning":U>=14&&U<22?"Evening":"Night"},A=T=>!T||Number(T)===0?"":`${Number(T)} ml`,I=T=>{const B=Number(T||0);return B===0?"0 ml":`${B>0?"+":""}${B} ml`},P=p.useMemo(()=>{const T=v(u.intake_oral_ml)+v(u.intake_iv_ml)+v(u.intake_blood_ml),B=v(u.urine_foley_ml)+v(u.urine_voided_ml),U=B+v(u.drains_ml);return{intake:T,urine:B,output:U,net:T-U}},[u]),O=p.useMemo(()=>{if(!s||s.length===0)return null;const T=new Date,B=new Date(T);B.setHours(0,0,0,0);const U=new Date(B);U.setDate(U.getDate()+1);const W={Morning:{intake:0,output:0,net:0},Evening:{intake:0,output:0,net:0},Night:{intake:0,output:0,net:0}};let V=0,R=0;return s.forEach(F=>{const G=new Date(F.recorded_at);if(Number.isNaN(G.getTime())||G<B||G>=U)return;const H=j(F),$=S(F);V+=H,R+=$;const K=k(F.recorded_at);W[K].intake+=H,W[K].output+=$,W[K].net+=H-$}),{date:B,intake:V,output:R,net:V-R,shifts:W}},[s]),D=async T=>{var U,W;if(T.preventDefault(),i(""),!(u.intake_oral_ml||u.intake_iv_ml||u.intake_blood_ml||u.urine_foley_ml||u.urine_voided_ml||u.drains_ml||u.stools_count)){i("Enter at least one value (Intake / Urine / Drains / Stools).");return}try{d(!0);const V={recorded_at:g(u.recorded_at),intake_oral_ml:v(u.intake_oral_ml),intake_iv_ml:v(u.intake_iv_ml),intake_blood_ml:v(u.intake_blood_ml),urine_foley_ml:v(u.urine_foley_ml),urine_voided_ml:v(u.urine_voided_ml),drains_ml:v(u.drains_ml),stools_count:v(u.stools_count),remarks:u.remarks||"",intake_ml:P.intake,urine_ml:P.urine};await FNe(t,V),m({recorded_at:"",intake_oral_ml:"",intake_iv_ml:"",intake_blood_ml:"",urine_foley_ml:"",urine_voided_ml:"",drains_ml:"",stools_count:"",remarks:""}),await y()}catch(V){console.error("I/O save error:",V),i(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to add intake / output")}finally{d(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Intake / Output Chart"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Record split intake & output. Automatically shows today's 24-hr totals + net balance and shift summary."})]}),n.jsxs("div",{className:"flex flex-col gap-2 rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2 text-xs text-slate-800",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("span",{className:"font-medium text-[11px] uppercase tracking-wide text-slate-500",children:"Today's 24-hr balance"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:O?O.date.toLocaleDateString():"No data"})]}),n.jsxs("div",{className:"mt-1 grid grid-cols-3 gap-2",children:[n.jsxs("div",{className:"rounded-xl bg-white px-2 py-1.5 text-center shadow-sm",children:[n.jsx("div",{className:"text-[10px] font-medium text-slate-500",children:"Total Intake"}),n.jsx("div",{className:"text-xs font-semibold text-sky-700",children:O?`${O.intake} ml`:"0 ml"})]}),n.jsxs("div",{className:"rounded-xl bg-white px-2 py-1.5 text-center shadow-sm",children:[n.jsx("div",{className:"text-[10px] font-medium text-slate-500",children:"Total Output"}),n.jsx("div",{className:"text-xs font-semibold text-emerald-700",children:O?`${O.output} ml`:"0 ml"})]}),n.jsxs("div",{className:"rounded-xl bg-white px-2 py-1.5 text-center shadow-sm",children:[n.jsx("div",{className:"text-[10px] font-medium text-slate-500",children:"Net Balance"}),n.jsx("div",{className:`text-xs font-semibold ${O?O.net>=0?"text-sky-800":"text-rose-700":"text-slate-400"}`,children:O?I(O.net):"0 ml"})]})]}),O&&n.jsx("div",{className:"mt-1 grid grid-cols-3 gap-1 text-[10px] text-slate-600",children:["Morning","Evening","Night"].map(T=>n.jsxs("div",{className:"rounded-lg border border-slate-500 bg-white px-1.5 py-1",children:[n.jsx("div",{className:"font-medium text-[10px]",children:T}),n.jsxs("div",{className:"mt-0.5 flex flex-col gap-0.5",children:[n.jsxs("span",{children:["In:"," ",O.shifts[T].intake||O.shifts[T].output?`${O.shifts[T].intake} ml`:""]}),n.jsxs("span",{children:["Out:"," ",O.shifts[T].output||O.shifts[T].intake?`${O.shifts[T].output} ml`:""]})]})]},T))})]})]}),n.jsx(Wn,{anyOf:["ipd.nursing"],children:n.jsxs("form",{onSubmit:D,className:"space-y-3 rounded-2xl border border-slate-500 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-medium text-slate-900",children:"Record Intake / Output"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Fill only measured values. Totals update automatically."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-[11px] text-slate-700",children:["Intake: ",n.jsxs("span",{className:"font-semibold",children:[P.intake," ml"]})]}),n.jsxs("span",{className:"rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-[11px] text-slate-700",children:["Output: ",n.jsxs("span",{className:"font-semibold",children:[P.output," ml"]})]}),n.jsxs("span",{className:`rounded-full border px-2.5 py-1 text-[11px] ${P.net>=0?"border-sky-200 bg-sky-50 text-sky-800":"border-rose-200 bg-rose-50 text-rose-800"}`,children:["Net: ",n.jsx("span",{className:"font-semibold",children:I(P.net)})]})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-12",children:[n.jsxs("div",{className:"md:col-span-3",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Date & Time"}),n.jsx("input",{type:"datetime-local",className:"w-full rounded-lg border border-slate-500 bg-slate-50 px-2.5 py-1.5 text-xs text-slate-900 outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",value:u.recorded_at,onChange:T=>x("recorded_at",T.target.value)})]}),n.jsx("div",{className:"md:col-span-9",children:n.jsxs("div",{className:"grid gap-3 rounded-xl border border-slate-200 bg-slate-50 p-3 md:grid-cols-12",children:[n.jsx("div",{className:"md:col-span-12",children:n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Intake (ml)"})}),n.jsxs("div",{className:"md:col-span-4",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Oral"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"Water / Feed / ORS",value:u.intake_oral_ml,onChange:T=>x("intake_oral_ml",T.target.value)})]}),n.jsxs("div",{className:"md:col-span-4",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"IV"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"NS / RL / Dextrose",value:u.intake_iv_ml,onChange:T=>x("intake_iv_ml",T.target.value)})]}),n.jsxs("div",{className:"md:col-span-4",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Blood"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"PRBC / FFP",value:u.intake_blood_ml,onChange:T=>x("intake_blood_ml",T.target.value)})]})]})}),n.jsx("div",{className:"md:col-span-12",children:n.jsxs("div",{className:"grid gap-3 rounded-xl border border-slate-200 bg-slate-50 p-3 md:grid-cols-12",children:[n.jsx("div",{className:"md:col-span-12",children:n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:"Output (ml)"})}),n.jsxs("div",{className:"md:col-span-4",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Urine  Foley"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500",placeholder:"Catheter output",value:u.urine_foley_ml,onChange:T=>x("urine_foley_ml",T.target.value)})]}),n.jsxs("div",{className:"md:col-span-4",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Urine  Voided"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500",placeholder:"Measured void",value:u.urine_voided_ml,onChange:T=>x("urine_voided_ml",T.target.value)})]}),n.jsxs("div",{className:"md:col-span-4",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Drains"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500",placeholder:"Chest / Abdominal",value:u.drains_ml,onChange:T=>x("drains_ml",T.target.value)})]}),n.jsxs("div",{className:"md:col-span-3",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Stools (count)"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-slate-700 focus:ring-1 focus:ring-slate-400",placeholder:"Number of times",value:u.stools_count,onChange:T=>x("stools_count",T.target.value)})]}),n.jsxs("div",{className:"md:col-span-9",children:[n.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Remarks / Description"}),n.jsx("input",{className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500",placeholder:"Eg: RL 500ml, Urine via Foley, Drain: ICD...",value:u.remarks,onChange:T=>x("remarks",T.target.value)})]})]})})]}),n.jsxs("div",{className:"flex items-center justify-between pt-1",children:[a&&n.jsx("div",{className:"text-xs text-rose-600",children:a}),n.jsxs("button",{type:"submit",disabled:c,className:"inline-flex items-center gap-1 rounded-lg bg-sky-600 px-4 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[c&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border border-white border-t-transparent"}),n.jsx("span",{children:c?"Saving":"Save entry"})]})]})]})}),n.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 px-3 py-2 text-xs",children:[n.jsx("div",{className:"font-medium text-slate-700",children:"I/O history"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:l?"Loading":`${(s==null?void 0:s.length)||0} record${((s==null?void 0:s.length)||0)===1?"":"s"}`})]}),n.jsx("div",{className:"max-h-[360px] overflow-auto text-xs",children:n.jsxs("table",{className:"min-w-[1100px] w-full border-collapse",children:[n.jsx("thead",{className:"sticky top-0 bg-slate-50 text-[11px] uppercase tracking-wide text-slate-500",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Oral"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"IV"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Blood"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Intake (Total)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Foley"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Voided"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Urine (Total)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Drains"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Output (Total)"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Net"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Stools"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Shift"}),n.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Remarks"})]})}),n.jsxs("tbody",{children:[!l&&s&&s.map(T=>{const B=v(T.intake_oral_ml),U=v(T.intake_iv_ml),W=v(T.intake_blood_ml),V=j(T),R=v(T.urine_foley_ml),F=v(T.urine_voided_ml),G=w(T),H=v(T.drains_ml),$=G+H,K=V-$;return n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/60",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:E(T.recorded_at)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:A(B)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:A(U)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:A(W)}),n.jsx("td",{className:"px-3 py-2 align-top font-semibold text-slate-800",children:A(V)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:A(R)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:A(F)}),n.jsx("td",{className:"px-3 py-2 align-top font-semibold text-slate-800",children:A(G)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:A(H)}),n.jsx("td",{className:"px-3 py-2 align-top font-semibold text-slate-800",children:A($)}),n.jsx("td",{className:`px-3 py-2 align-top font-semibold ${K>=0?"text-sky-800":"text-rose-700"}`,children:I(K)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:T.stools_count||""}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:k(T.recorded_at)}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:T.remarks||""})]},T.id)}),!l&&(!s||s.length===0)&&n.jsx("tr",{children:n.jsx("td",{colSpan:14,className:"px-3 py-4 text-center text-slate-400",children:"No intake / output entries yet."})}),l&&n.jsx("tr",{children:n.jsx("td",{colSpan:14,className:"px-3 py-4 text-center text-slate-400",children:"Loading intake / output"})})]})]})})]})]})}function iCe({label:t="Department  Doctor",value:s,onChange:r}){const[a,i]=p.useState([]),[l,o]=p.useState([]),[c,d]=p.useState(null),[u,m]=p.useState(null),[x,g]=p.useState(!1),[y,v]=p.useState("");p.useEffect(()=>{let S=!0;return(async()=>{var E,k;g(!0),v("");try{const{data:A}=await yG();if(!S)return;i(A||[])}catch(A){if(!S)return;v(((k=(E=A==null?void 0:A.response)==null?void 0:E.data)==null?void 0:k.detail)||"Failed to load departments")}finally{S&&g(!1)}})(),()=>{S=!1}},[]),p.useEffect(()=>{if(!c){o([]);return}let S=!0;return(async()=>{var E,k;g(!0),v("");try{const{data:A}=await vG({departmentId:c,isDoctor:!0});if(!S)return;o(A||[])}catch(A){if(!S)return;v(((k=(E=A==null?void 0:A.response)==null?void 0:E.data)==null?void 0:k.detail)||"Failed to load doctors")}finally{S&&g(!1)}})(),()=>{S=!1}},[c]),p.useEffect(()=>{if(s==null||s===""){m(null);return}const S=Number(s);Number.isFinite(S)&&m(E=>E===S?E:S)},[s]),p.useMemo(()=>l.find(S=>S.id===u)||null,[l,u]);const j=p.useCallback(S=>{const E=S.target.value,k=E?Number(E):null;d(k),m(null),r&&r(null,{department_id:k})},[r]),w=p.useCallback(S=>{const E=S.target.value,k=E?Number(E):null;if(m(k),r){const A={department_id:c,user:l.find(I=>I.id===k)||null};r(k,A)}},[r,c,l]);return n.jsxs("div",{className:"space-y-1 text-sm",children:[t&&n.jsx("label",{className:"block text-xs font-medium text-gray-600",children:t}),n.jsxs("div",{className:"grid gap-2 md:grid-cols-2",children:[n.jsxs("select",{className:"input",value:c??"",onChange:j,children:[n.jsx("option",{value:"",children:"Select department"}),a.map(S=>n.jsx("option",{value:S.id,children:S.name},S.id))]}),n.jsxs("select",{className:"input",value:u??"",onChange:w,disabled:!c||x,children:[n.jsx("option",{value:"",children:c?x?"Loading doctors":"Select doctor":"Select department first"}),l.map(S=>n.jsx("option",{value:S.id,children:S.full_name||S.name||`User #${S.id}`},S.id))]})]}),y&&n.jsx("div",{className:"rounded-md border border-rose-200 bg-rose-50 px-2 py-1 text-xs text-rose-700",children:y})]})}function lCe({admissionId:t}){const[s,r]=p.useState([]),[a,i]=p.useState(""),[l,o]=p.useState(null),[c,d]=p.useState(null),[u,m]=p.useState({type:"internal",to_department:"",external_org:"",reason:""}),x=async()=>{var y,v;i("");try{const{data:j}=await BNe(t);r(j||[])}catch(j){i(((v=(y=j==null?void 0:j.response)==null?void 0:y.data)==null?void 0:v.detail)||"Failed to load referrals")}};p.useEffect(()=>{x()},[t]);const g=async y=>{var v,j;y.preventDefault();try{const w={type:u.type,to_department:u.to_department||"",to_user_id:l||void 0,external_org:u.external_org||"",reason:u.reason||""};await $Ne(t,w),m({type:"internal",to_department:"",external_org:"",reason:""}),o(null),d(null),await x()}catch(w){i(((j=(v=w==null?void 0:w.response)==null?void 0:v.data)==null?void 0:j.detail)||"Failed to create referral")}};return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("form",{onSubmit:g,className:"rounded-xl border bg-white p-3 text-sm space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Type"}),n.jsxs("select",{className:"input",value:u.type,onChange:y=>m(v=>({...v,type:y.target.value})),children:[n.jsx("option",{value:"internal",children:"Internal"}),n.jsx("option",{value:"external",children:"External"})]})]}),u.type==="internal"?n.jsx("div",{className:"md:col-span-2",children:n.jsx(iCe,{label:"Department  Role  User",value:l||void 0,onChange:(y,v)=>{o(y||null),d((v==null?void 0:v.department_id)||null),m(j=>({...j,to_department:v!=null&&v.department_id?String(v.department_id):""}))}})}):n.jsx("input",{className:"input md:col-span-2",placeholder:"External organization",value:u.external_org,onChange:y=>m(v=>({...v,external_org:y.target.value}))})]}),n.jsx("input",{className:"input",placeholder:"Reason",value:u.reason,onChange:y=>m(v=>({...v,reason:y.target.value}))}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",children:"Save"})}),a&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 p-2 text-rose-700 text-sm",children:a})]}),n.jsx("div",{className:"rounded-xl border overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"text-left text-xs text-gray-500 bg-gray-50",children:[n.jsx("th",{className:"px-3 py-2",children:"Type"}),n.jsx("th",{className:"px-3 py-2",children:"To"}),n.jsx("th",{className:"px-3 py-2",children:"Status"})]})}),n.jsxs("tbody",{children:[(s||[]).map(y=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-3 py-2",children:y.type}),n.jsx("td",{className:"px-3 py-2",children:y.type==="internal"?y.to_user_id?`User#${y.to_user_id}`:`Dept ${y.to_department}`:y.external_org||""}),n.jsx("td",{className:"px-3 py-2",children:y.status})]},y.id)),!(s!=null&&s.length)&&n.jsx("tr",{children:n.jsx("td",{className:"p-3 text-sm text-gray-500",colSpan:3,children:"No referrals"})})]})]})})]})}const v8=t=>{if(!t)return"";const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const r=d=>String(d).padStart(2,"0"),a=s.getFullYear(),i=r(s.getMonth()+1),l=r(s.getDate()),o=r(s.getHours()),c=r(s.getMinutes());return`${a}-${i}-${l}T${o}:${c}`},j8=t=>t?t.length===16?`${t}:00`:t:null,WC=[{code:"A90",name:"Dengue fever"},{code:"I10",name:"Essential (primary) hypertension"},{code:"E11",name:"Type 2 diabetes mellitus"},{code:"J45",name:"Asthma"},{code:"K35",name:"Acute appendicitis"}];function oCe({admissionId:t,admission:s,patient:r,canWrite:a=!0,followupOptions:i=[]}){const[l,o]=p.useState(null),[c,d]=p.useState(null),[u,m]=p.useState(""),[x,g]=p.useState(!1),[y,v]=p.useState(!1),[j]=p.useState(!1),[w,S]=p.useState(""),[E,k]=p.useState(WC),A=Array.isArray(i)&&i.length>0,[I,P]=p.useState(!1),[O,D]=p.useState({medical_history:"",treatment_summary:"",medications:"",follow_up:"",icd10_codes:"",final_diagnosis_primary:"",final_diagnosis_secondary:"",hospital_course:"",discharge_condition:"stable",discharge_type:"routine",allergies:"",procedures:"",investigations:"",diet_instructions:"",activity_instructions:"",warning_signs:"",referral_details:"",insurance_details:"",stay_summary:"",patient_ack_name:"",patient_ack_datetime:"",prepared_by_name:"",reviewed_by_name:"",reviewed_by_regno:"",discharge_datetime:"",implants:"",pending_reports:"",patient_education:"",followup_appointment_ref:"",finalize:!1}),[T,B]=p.useState({financial_clearance:!1,clinical_clearance:!1,delay_reason:"",submit:!1}),[U,W]=p.useState([]),V=!!(l!=null&&l.finalized),R=V||a===!1,F=p.useMemo(()=>{if(!(l!=null&&l.finalized_at))return"";try{return new Date(l.finalized_at).toLocaleString()}catch{return String(l.finalized_at)}},[l]),G=p.useMemo(()=>{if(!(c!=null&&c.submitted_at))return"";try{return new Date(c.submitted_at).toLocaleString()}catch{return String(c.submitted_at)}},[c]),H=(s==null?void 0:s.display_code)||(s==null?void 0:s.admission_code)||(l==null?void 0:l.admission_no)||(l==null?void 0:l.admission_code)||"",$=(r==null?void 0:r.uhid)||(r==null?void 0:r.patient_code)||(l==null?void 0:l.patient_code)||(l==null?void 0:l.uhid)||"",K=(s==null?void 0:s.bed_label)||(s==null?void 0:s.bed_code)||(l==null?void 0:l.bed_label)||(l==null?void 0:l.bed_code)||"",le=r?[r.prefix,r.first_name,r.last_name].filter(Boolean).join(" "):"",se=(r==null?void 0:r.age_years)??(r==null?void 0:r.age)??null,J=(r==null?void 0:r.gender)||(r==null?void 0:r.sex)||"",ie=[se!=null?`${se} yrs`:null,J].filter(Boolean).join(" / "),te=(s==null?void 0:s.ward_name)||(s==null?void 0:s.ward)||(s==null?void 0:s.ward_display)||"";function ne(fe){if(!fe)return"";const Me=fe.drug_name||fe.medicine_name||fe.item_name||"",Ae=fe.strength||"",Ke=fe.dose!=null&&fe.dose!==""?`${fe.dose}${fe.dose_unit?` ${fe.dose_unit}`:""}`:"",Le=fe.frequency_label||fe.frequency||fe.freq||"",He=fe.route||"",pt=fe.duration_days!=null&&fe.duration_days!==""?`${fe.duration_days} days`:fe.duration||"";return[Me,Ae&&`(${Ae})`,Ke&&`Dose: ${Ke}`,Le&&`Freq: ${Le}`,He&&`Route: ${He}`,pt&&`For ${pt}`].filter(Boolean).join("  ")}const q=p.useMemo(()=>Array.isArray(U)&&U.length?U.map(ne).filter(Boolean).join(`
`):"",[U]),ee=()=>{if(!R){if(!q){ae.info("No active medications found for this admission.");return}D(fe=>({...fe,medications:q})),ae.success("Discharge medications auto-filled from IPD medication chart.")}},X=async()=>{var fe,Me;if(t){m("");try{const[Ae,Ke]=await Promise.all([dwe(t),mwe(t)]),Le=(Ae==null?void 0:Ae.data)||null;o(Le),Le?(P(!!(Le.follow_up&&Le.follow_up.trim())),D(pt=>({...pt,medical_history:Le.medical_history||"",treatment_summary:Le.treatment_summary||"",medications:Le.medications||"",follow_up:Le.follow_up||"",icd10_codes:Le.icd10_codes||"",final_diagnosis_primary:Le.final_diagnosis_primary||"",final_diagnosis_secondary:Le.final_diagnosis_secondary||"",hospital_course:Le.hospital_course||"",discharge_condition:Le.discharge_condition||"stable",discharge_type:Le.discharge_type||"routine",allergies:Le.allergies||"",procedures:Le.procedures||"",investigations:Le.investigations||"",diet_instructions:Le.diet_instructions||"",activity_instructions:Le.activity_instructions||"",warning_signs:Le.warning_signs||"",referral_details:Le.referral_details||"",insurance_details:Le.insurance_details||"",stay_summary:Le.stay_summary||"",implants:Le.implants||"",pending_reports:Le.pending_reports||"",patient_education:Le.patient_education||"",followup_appointment_ref:Le.followup_appointment_ref||"",prepared_by_name:Le.prepared_by_name||"",reviewed_by_name:Le.reviewed_by_name||"",reviewed_by_regno:Le.reviewed_by_regno||"",discharge_datetime:v8(Le.discharge_datetime),patient_ack_name:Le.patient_ack_name||"",patient_ack_datetime:v8(Le.patient_ack_datetime),finalize:!1}))):P(!1);const He=(Ke==null?void 0:Ke.data)||null;d(He),He&&B({financial_clearance:!!He.financial_clearance,clinical_clearance:!!He.clinical_clearance,delay_reason:He.delay_reason||"",submit:!1});try{const pt=await fG(t);console.log("``````````````````````````````````````````"),console.log(pt),console.log("``````````````````````````````````````````");const Pe=Array.isArray(pt==null?void 0:pt.data)?pt.data:[];W(Pe)}catch(pt){console.error("Failed to load IPD medications for discharge",pt)}}catch(Ae){const Ke=((Me=(fe=Ae==null?void 0:Ae.response)==null?void 0:fe.data)==null?void 0:Me.detail)||(Ae==null?void 0:Ae.message)||"Failed to load discharge data";m(Ke),ae.error(Ke)}}};p.useEffect(()=>{X()},[t]);const Z=async fe=>{var Me,Ae;if(fe.preventDefault(),!!t&&!(O.finalize&&!V&&!window.confirm("Once finalized, this discharge summary cannot be edited. Do you want to continue?"))){g(!0),m("");try{const Ke={...O,discharge_datetime:j8(O.discharge_datetime),patient_ack_datetime:j8(O.patient_ack_datetime)};await uwe(t,Ke),await X(),O.finalize&&!V?ae.success("Discharge summary finalized successfully. You can now print and hand over to the patient."):ae.success("Discharge draft saved successfully.")}catch(Ke){const Le=((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||(Ke==null?void 0:Ke.message)||"Failed to save discharge summary";m(Le),ae.error(Le)}finally{g(!1)}}},Y=async fe=>{var Me,Ae;if(fe.preventDefault(),!!t){v(!0),m("");try{await hwe(t,{...T}),await X(),ae.success("Discharge checklist submitted successfully.")}catch(Ke){const Le=((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||(Ke==null?void 0:Ke.message)||"Failed to save checklist";m(Le),ae.error(Le)}finally{v(!1)}}},Q=fe=>Me=>{var Ke;const Ae=((Ke=Me==null?void 0:Me.target)==null?void 0:Ke.type)==="checkbox"?Me.target.checked:Me.target.value;fe==="follow_up"&&P(!1),D(Le=>({...Le,[fe]:Ae}))},oe=fe=>Me=>{var Ke;const Ae=((Ke=Me==null?void 0:Me.target)==null?void 0:Ke.type)==="checkbox"?Me.target.checked:Me.target.value;B(Le=>({...Le,[fe]:Ae}))},_e=async()=>{var fe,Me,Ae;if(t)try{const Ke=await he.get(`/ipd/admissions/${t}/discharge-summary/pdf`,{responseType:"blob"}),Le=new Blob([Ke.data],{type:"application/pdf"}),He=window.URL.createObjectURL(Le),pt=document.createElement("a");pt.href=He,pt.download=`discharge-summary-${t}.pdf`,document.body.appendChild(pt),pt.click(),pt.remove(),window.URL.revokeObjectURL(He)}catch(Ke){console.error("PDF download error:",Ke);const Le=((Me=(fe=Ke==null?void 0:Ke.response)==null?void 0:fe.data)==null?void 0:Me.detail)||(((Ae=Ke==null?void 0:Ke.response)==null?void 0:Ae.status)===401?"Session expired. Please login again.":"Failed to download discharge summary PDF.");alert(Le)}},xe=fe=>{const Me=fe.trim().toLowerCase();if(!Me){k(WC);return}k(WC.filter(Ae=>Ae.code.toLowerCase().includes(Me)||Ae.name.toLowerCase().includes(Me)))},me=fe=>{const Me=fe.target.value;S(Me),xe(Me)},Re=fe=>{if(!fe)return;const Me=(O.icd10_codes||"").split(`
`).map(Ke=>Ke.trim()).filter(Boolean),Ae=`${fe.code}  ${fe.name}`;Me.includes(Ae)||Me.push(Ae),D(Ke=>({...Ke,icd10_codes:Me.join(`
`)})),ae.success(`Added ICD-10: ${Ae}`)},Ze=fe=>{const Ae=(O.icd10_codes||"").split(`
`).map(Ke=>Ke.trim()).filter(Boolean).filter(Ke=>Ke!==fe);D(Ke=>({...Ke,icd10_codes:Ae.join(`
`)}))},$e=V?n.jsxs("span",{className:"rounded-full bg-emerald-100 px-3 py-1 font-medium text-emerald-800",children:["Finalized ",F&&` ${F}`]}):n.jsx("span",{className:"rounded-full bg-amber-100 px-3 py-1 font-medium text-amber-800",children:"Draft  Not yet finalized"});return n.jsxs("div",{className:"space-y-4 text-sm text-black",children:[n.jsxs("div",{className:"flex flex-col gap-2 rounded-2xl border bg-gradient-to-r from-sky-50 to-emerald-50 p-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-sky-900",children:"Discharge  Medico-Legal Summary"}),n.jsx("div",{className:"text-[11px] text-slate-600",children:"Capture final diagnosis, hospital course, instructions & clearances as per NABH / medico-legal best practice."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[11px]",children:[$e,n.jsx("button",{type:"button",onClick:_e,className:"btn btn-sm whitespace-nowrap",children:"Download Discharge PDF"})]})]}),n.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[n.jsx(Wn,{anyOf:["ipd.doctor"],children:n.jsxs("div",{className:"rounded-xl border bg-white p-2.5 text-[11px] text-slate-700",children:[n.jsx("div",{className:"mb-0.5 font-semibold",children:"Doctor view"}),n.jsxs("div",{children:["Please complete ",n.jsx("strong",{children:"diagnosis"}),","," ",n.jsx("strong",{children:"hospital course"}),","," ",n.jsx("strong",{children:"discharge medications"}),", and approve discharge."]})]})}),n.jsx(Wn,{anyOf:["ipd.nurse"],children:n.jsxs("div",{className:"rounded-xl border bg-white p-2.5 text-[11px] text-slate-700",children:[n.jsx("div",{className:"mb-0.5 font-semibold",children:"Nurse view"}),n.jsx("div",{children:"Please complete nursing checklist, education, vitals & pending reports before discharge."})]})}),n.jsx(Wn,{anyOf:["billing.manage","billing.view"],children:n.jsxs("div",{className:"rounded-xl border bg-white p-2.5 text-[11px] text-slate-700",children:[n.jsx("div",{className:"mb-0.5 font-semibold",children:"Billing view"}),n.jsx("div",{children:"Confirm all bills and insurance claims are settled to enable final discharge."})]})})]}),n.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 rounded-2xl border bg-white px-3 py-2 text-[11px] md:text-xs",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"Admission:"})," ",n.jsx("span",{className:"text-slate-800",children:H||t||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"Patient:"})," ",n.jsx("span",{className:"text-slate-800",children:le||$||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"UHID:"})," ",n.jsx("span",{className:"text-slate-800",children:$||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"Age / Sex:"})," ",n.jsx("span",{className:"text-slate-800",children:ie||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"Ward / Bed:"})," ",n.jsx("span",{className:"text-slate-800",children:[te,K].filter(Boolean).join(" / ")||""})]}),n.jsx("div",{className:"mt-1 w-full text-[10px] text-slate-500 md:mt-0 md:w-auto",children:"Patient demographics are auto-filled from IPD admission. Editing not allowed in this screen."})]}),u&&n.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:u}),n.jsx(Wn,{anyOf:["ipd.manage","ipd.doctor"],children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[n.jsxs("form",{onSubmit:Z,className:"lg:col-span-2 space-y-4 rounded-2xl border bg-white p-3 md:p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Discharge Summary  Clinical Details"}),x&&n.jsx("span",{className:"text-[11px] text-gray-500",children:"Saving"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Medical history"}),n.jsx("span",{className:"text-[10px] text-gray-400",children:"Select known conditions or type to add new history (Diabetes, HTN, Asthma, Surgery, Smoking, Alcohol, etc.)"})]}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Known diabetes, hypertension, CAD, past surgeries, addictions",value:O.medical_history,onChange:Q("medical_history"),disabled:R})]}),n.jsxs("div",{className:"space-y-3 rounded-xl border bg-slate-50/80 p-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"A. Final Diagnosis & Hospital Course"}),n.jsx("span",{className:"text-[10px] text-slate-500",children:"Core medico-legal section"})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Final primary diagnosis"}),n.jsx("input",{className:"input",placeholder:"Search diagnosis by name or ICD-10 code (e.g., Dengue, A90)",value:O.final_diagnosis_primary,onChange:Q("final_diagnosis_primary"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Secondary / comorbid diagnoses"}),n.jsx("input",{className:"input",placeholder:"Add comorbid conditions (optional)",value:O.final_diagnosis_secondary,onChange:Q("final_diagnosis_secondary"),disabled:R})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Hospital course / clinical summary"}),n.jsx("textarea",{className:"input min-h-[90px]",placeholder:"Brief day-wise summary of treatment, response & complications (if any)",value:O.hospital_course,onChange:Q("hospital_course"),disabled:R})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Discharge condition"}),n.jsxs("select",{className:"input",value:O.discharge_condition,onChange:Q("discharge_condition"),disabled:R,children:[n.jsx("option",{value:"stable",children:"Stable"}),n.jsx("option",{value:"improved",children:"Improved"}),n.jsx("option",{value:"unchanged",children:"Unchanged"}),n.jsx("option",{value:"dama",children:"DAMA"}),n.jsx("option",{value:"expired",children:"Expired"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Discharge type"}),n.jsxs("select",{className:"input",value:O.discharge_type,onChange:Q("discharge_type"),disabled:R,children:[n.jsx("option",{value:"routine",children:"Routine"}),n.jsx("option",{value:"dama",children:"DAMA"}),n.jsx("option",{value:"lama",children:"LAMA"}),n.jsx("option",{value:"referred",children:"Referred"}),n.jsx("option",{value:"absconded",children:"Absconded"})]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Allergies"}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Search allergy or select NKDA if no known allergies",value:O.allergies,onChange:Q("allergies"),disabled:R}),n.jsx("div",{className:"flex flex-wrap gap-2 pt-1 text-[10px]",children:n.jsx("button",{type:"button",className:"rounded-full border px-2 py-0.5 text-[10px]",onClick:()=>!R&&D(fe=>({...fe,allergies:"No known drug allergy (NKDA)"})),children:" Set NKDA"})})]})]}),n.jsxs("div",{className:"space-y-3 rounded-xl border bg-slate-50/40 p-3",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-700",children:"B. Procedures, Investigations & Instructions"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Procedures / surgeries performed"}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Search and select performed procedures, then summarise (procedure, date, surgeon)",value:O.procedures,onChange:Q("procedures"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Investigation highlights"}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Select key abnormal reports to display (labs, imaging) and summarise here",value:O.investigations,onChange:Q("investigations"),disabled:R})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Diet instructions"}),n.jsxs("select",{className:"input",value:O.diet_instructions,onChange:Q("diet_instructions"),disabled:R,children:[n.jsx("option",{value:"",children:"Select diet"}),n.jsx("option",{value:"normal",children:"Normal diet"}),n.jsx("option",{value:"soft",children:"Soft diet"}),n.jsx("option",{value:"diabetic",children:"Diabetic diet"}),n.jsx("option",{value:"renal",children:"Renal diet"}),n.jsx("option",{value:"cardiac",children:"Cardiac diet"}),n.jsx("option",{value:"other",children:"Other / see notes"})]}),n.jsx("div",{className:"text-[10px] text-gray-400",children:"Select recommended discharge diet; details will appear in the summary."})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Activity instructions"}),n.jsxs("select",{className:"input",value:O.activity_instructions,onChange:Q("activity_instructions"),disabled:R,children:[n.jsx("option",{value:"",children:"Select activity"}),n.jsx("option",{value:"bed_rest",children:"Bed rest"}),n.jsx("option",{value:"assisted_walk",children:"Assisted walking / short walks"}),n.jsx("option",{value:"normal_activity",children:"Normal activity as tolerated"}),n.jsx("option",{value:"avoid_heavy_lifting",children:"Avoid heavy lifting / strenuous activity"}),n.jsx("option",{value:"other",children:"Other / see notes"})]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Warning / red-flag symptoms"}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Select symptoms that require immediate hospital visit and list here",value:O.warning_signs,onChange:Q("warning_signs"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Referral / transfer details (if referred)"}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Search referred hospital / doctor and note reason for transfer",value:O.referral_details,onChange:Q("referral_details"),disabled:R})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Discharge medications"}),!R&&n.jsx("button",{type:"button",onClick:ee,className:"rounded-full border px-2 py-0.5 text-[10px] text-sky-700 hover:bg-sky-50",children:"Use IPD medication chart"})]}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Search drug name to auto-fill dose & frequency, then summarise (name, dose, frequency, duration)",value:O.medications,onChange:Q("medications"),disabled:R}),Array.isArray(U)&&U.length>0&&n.jsxs("div",{className:"mt-1 rounded-lg border bg-slate-50 p-2",children:[n.jsx("div",{className:"mb-1 text-[10px] text-slate-500",children:"IPD medication chart (preview):"}),n.jsx("ul",{className:"max-h-32 space-y-0.5 overflow-auto text-[11px] text-slate-700",children:U.slice(0,10).map((fe,Me)=>n.jsx("li",{children:ne(fe)},fe.id||Me))})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Follow-up advice"}),n.jsxs("div",{className:"flex flex-col items-end",children:[n.jsx("span",{className:"text-[10px] text-gray-400",children:"Follow-up auto-linked from OPD appointment (backend)."}),I&&!V&&n.jsx("span",{className:"text-[10px] text-emerald-600",children:"Auto-filled from records  editable"})]})]}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Follow-up date, department, OPD number, additional instructions",value:O.follow_up,onChange:Q("follow_up"),disabled:R})]})]}),n.jsxs("div",{className:"space-y-3 rounded-xl border bg-slate-50/60 p-3",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-700",children:"E. Safety & Quality"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Implants used (if any)"}),n.jsx("textarea",{className:"input min-h-[50px]",placeholder:"Search implant by name or serial number (optional), then record details here",value:O.implants,onChange:Q("implants"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Pending reports"}),n.jsx("textarea",{className:"input min-h-[50px]",placeholder:"Select pending test reports and note how / when patient will receive them",value:O.pending_reports,onChange:Q("pending_reports"),disabled:R})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Patient education provided"}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Select education provided (wound care, insulin injection, physiotherapy, lifestyle advice) and summarise here",value:O.patient_education,onChange:Q("patient_education"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Follow-up appointment ID / token"}),A?n.jsxs("select",{className:"input",value:O.followup_appointment_ref,onChange:Q("followup_appointment_ref"),disabled:R||j,children:[n.jsx("option",{value:"",children:j?"Loading follow-ups":"Select linked OPD follow-up"}),i.map(fe=>n.jsx("option",{value:fe.value,children:fe.label},fe.value))]}):n.jsx("input",{className:"input",placeholder:"Linked OPD appointment ID / token",value:O.followup_appointment_ref,onChange:Q("followup_appointment_ref"),disabled:R}),n.jsx("div",{className:"text-[10px] text-gray-400",children:"Dropdown will show OPD follow-ups for this patient (to be wired from OPD module)."})]})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-gray-600",children:"ICD-10 codes"}),n.jsxs("div",{className:"space-y-1 rounded-lg border bg-slate-50/70 p-2",children:[n.jsx("div",{className:"mb-1 text-[11px] text-slate-600",children:'Search ICD-10 by diagnosis name or code (e.g., "Dengue"  A90). Start typing to see suggestions.'}),n.jsx("input",{className:"input h-8 text-[12px]",placeholder:'Type to search (e.g., "dengue", "A90")',value:w,onChange:me,disabled:R}),!R&&n.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[E.length===0&&n.jsx("span",{className:"text-[10px] text-slate-400",children:"No matches. Try a different spelling."}),E.map(fe=>n.jsxs("button",{type:"button",className:"rounded-full border px-2 py-0.5 text-[10px] hover:bg-slate-100",onClick:()=>Re(fe),children:[fe.code,"  ",fe.name]},fe.code))]})]}),n.jsx("textarea",{className:"input mt-2 min-h-[70px] text-[12px]",placeholder:"Selected ICD-10 codes will appear here, one per line (e.g., A90  Dengue fever).",value:O.icd10_codes,onChange:Q("icd10_codes"),disabled:R}),!R&&O.icd10_codes&&n.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-slate-500",children:(O.icd10_codes||"").split(`
`).map(fe=>fe.trim()).filter(Boolean).map(fe=>n.jsxs("button",{type:"button",className:"rounded-full border px-2 py-0.5 hover:bg-rose-50",onClick:()=>Ze(fe),children:[" ",fe]},fe))})]}),n.jsxs("div",{className:"flex flex-col gap-2 border-t pt-2 text-xs text-gray-600 md:flex-row md:items-center md:justify-between",children:[n.jsx("div",{children:V?n.jsxs("span",{children:["Finalized at"," ",n.jsx("span",{className:"font-medium text-emerald-700",children:F})]}):n.jsx("span",{children:"Fill mandatory details before finalizing. Once finalized, this summary cannot be edited."})}),n.jsxs("div",{className:"flex items-center gap-3",children:[!V&&n.jsxs("label",{className:"inline-flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:O.finalize,onChange:Q("finalize"),disabled:R}),n.jsx("span",{className:"text-xs",children:"Mark as finalized"})]}),n.jsx("button",{className:"btn",disabled:x||V||!a,children:x?"Saving":"Save summary"})]})]})]})]}),n.jsx("div",{className:"space-y-4",children:n.jsxs("form",{onSubmit:Y,className:"space-y-4 rounded-2xl border bg-white p-3 md:p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Discharge Checklist & Clearance"}),y&&n.jsx("span",{className:"text-[11px] text-gray-500",children:"Saving"})]}),n.jsxs("div",{className:"space-y-2 rounded-xl bg-slate-50/80 p-3",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-700",children:"Financial & clinical clearance"}),n.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:T.financial_clearance,onChange:oe("financial_clearance")}),n.jsx("span",{children:"Financial clearance completed  confirm all bills and insurance claims are settled."})]}),n.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:T.clinical_clearance,onChange:oe("clinical_clearance")}),n.jsx("span",{children:"Clinical discharge clearance given by doctor."})]}),n.jsx("input",{className:"input mt-1",placeholder:"Delay reason (if any)",value:T.delay_reason,onChange:oe("delay_reason")})]}),n.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-50/80 p-3",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-700",children:"Insurance / TPA & stay summary"}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Payer name, claim number, pre-auth number, claim status",value:O.insurance_details,onChange:Q("insurance_details"),disabled:R}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Total days admitted, ICU days (if any), ward type (general / semi-private / private)",value:O.stay_summary,onChange:Q("stay_summary"),disabled:R})]}),n.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-50/80 p-3",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-700",children:"Patient acknowledgement"}),n.jsx("input",{className:"input",placeholder:"Patient / attendant name",value:O.patient_ack_name,onChange:Q("patient_ack_name"),disabled:R}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-gray-600",children:"Acknowledgement date & time"}),n.jsx("input",{type:"datetime-local",className:"input",value:O.patient_ack_datetime,onChange:Q("patient_ack_datetime"),disabled:R})]})]}),n.jsxs("div",{className:"space-y-3 rounded-xl bg-slate-50/80 p-3",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-700",children:"Doctor & system validation"}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-gray-600",children:"Prepared by (nurse / junior doctor)"}),n.jsx("input",{className:"input",placeholder:"Name of nurse / intern",value:O.prepared_by_name,onChange:Q("prepared_by_name"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-gray-600",children:"Reviewed & approved by"}),n.jsx("input",{className:"input mb-1",placeholder:"Consultant doctor name",value:O.reviewed_by_name,onChange:Q("reviewed_by_name"),disabled:R}),n.jsx("input",{className:"input",placeholder:"Registration number",value:O.reviewed_by_regno,onChange:Q("reviewed_by_regno"),disabled:R})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-gray-600",children:"Discharge date & time"}),n.jsx("input",{type:"datetime-local",className:"input",value:O.discharge_datetime,onChange:Q("discharge_datetime"),disabled:R})]}),n.jsx("div",{className:"text-[10px] text-slate-500",children:"Clinical clearance confirms the patient is medically fit for discharge."})]}),n.jsxs("div",{className:"flex items-center justify-between border-t pt-2 text-xs",children:[n.jsxs("label",{className:"inline-flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:T.submit,onChange:oe("submit")}),n.jsx("span",{children:"Submit discharge checklist"})]}),n.jsx("button",{className:"btn",disabled:y,children:y?"Saving":"Save checklist"})]}),(c==null?void 0:c.submitted)&&n.jsxs("div",{className:"text-[11px] text-emerald-700",children:["Checklist submitted at"," ",n.jsx("span",{className:"font-medium",children:G})]})]})})]})})]})}function cCe({admissionId:t}){const s=b4("ipd.view")||b4("ipd.manage"),[r,a]=p.useState(""),[i,l]=p.useState(""),[o,c]=p.useState(null),[d,u]=p.useState(""),[m,x]=p.useState([]),g=p.useMemo(()=>{const v=new Map;for(const j of m||[])v.set(j.id,j.code);return v},[m]);p.useEffect(()=>{let v=!0;return(async()=>{try{const j=await Eo();v&&x((j==null?void 0:j.data)||[])}catch{}try{const{data:j}=await pG(t);if(!v)return;const w=j!=null&&j.admitted_at?new Date(j.admitted_at).toISOString().slice(0,10):"",S=new Date().toISOString().slice(0,10);a(w),l(S)}catch{}})(),()=>{v=!1}},[t]);const y=async()=>{var v,j;u(""),c(null);try{const{data:w}=await pwe(t,{...r?{from_date:r}:{},...i?{to_date:i}:{}});c(w)}catch(w){u(((j=(v=w==null?void 0:w.response)==null?void 0:v.data)==null?void 0:j.detail)||"Failed to preview charges")}};return s?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"rounded-xl border bg-white p-3 grid gap-3 md:grid-cols-5 text-sm",children:[n.jsx("div",{className:"md:col-span-5 font-medium",children:"Bed Charge Preview"}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"From"}),n.jsx("input",{type:"date",className:"input",value:r,onChange:v=>a(v.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"To"}),n.jsx("input",{type:"date",className:"input",value:i,onChange:v=>l(v.target.value)})]}),n.jsx("div",{className:"md:col-span-3 flex items-end justify-end",children:n.jsx("button",{className:"btn",onClick:y,children:"Preview"})}),d&&n.jsx("div",{className:"md:col-span-5 rounded-xl border border-rose-200 bg-rose-50 p-2 text-rose-700",children:d})]}),o&&n.jsxs("div",{className:"rounded-xl border overflow-hidden bg-white",children:[n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"text-left text-xs text-gray-500 bg-gray-50",children:[n.jsx("th",{className:"px-3 py-2",children:"Date"}),n.jsx("th",{className:"px-3 py-2",children:"Room Type"}),n.jsx("th",{className:"px-3 py-2",children:"Bed"}),n.jsx("th",{className:"px-3 py-2",children:"Rate"})]})}),n.jsxs("tbody",{children:[(o.days||[]).map((v,j)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-3 py-2",children:new Date(v.date).toLocaleDateString()}),n.jsx("td",{className:"px-3 py-2",children:v.room_type||""}),n.jsx("td",{className:"px-3 py-2",children:v.bed_id&&g.get(v.bed_id)||""}),n.jsx("td",{className:"px-3 py-2",children:Number(v.rate).toFixed(2)})]},j)),n.jsxs("tr",{className:"bg-gray-50 font-medium",children:[n.jsx("td",{className:"px-3 py-2",colSpan:3,children:"Total"}),n.jsx("td",{className:"px-3 py-2",children:Number(o.total_amount||0).toFixed(2)})]})]})]}),!!o.missing_rate_days&&n.jsxs("div",{className:"px-3 py-2 text-xs text-amber-700 bg-amber-50 border-t",children:["Note: ",o.missing_rate_days," day(s) had no bed rate set for the room type."]})]})]}):n.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-2 text-sm text-rose-700",children:"Access denied (need ipd.view)."})}function gP(t){const s=p.useRef({value:t,previous:t});return p.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var DK=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),dCe="VisuallyHidden",uCe=p.forwardRef((t,s)=>n.jsx(us.span,{...t,ref:s,style:{...DK,...t.style}}));uCe.displayName=dCe;var mCe=[" ","Enter","ArrowUp","ArrowDown"],hCe=[" ","Enter"],Kh="Select",[U2,V2,xCe]=IT(Kh),[If]=fc(Kh,[xCe,j2]),H2=j2(),[pCe,Am]=If(Kh),[fCe,gCe]=If(Kh),MK=t=>{const{__scopeSelect:s,children:r,open:a,defaultOpen:i,onOpenChange:l,value:o,defaultValue:c,onValueChange:d,dir:u,name:m,autoComplete:x,disabled:g,required:y,form:v}=t,j=H2(s),[w,S]=p.useState(null),[E,k]=p.useState(null),[A,I]=p.useState(!1),P=cy(u),[O,D]=pm({prop:a,defaultProp:i??!1,onChange:l,caller:Kh}),[T,B]=pm({prop:o,defaultProp:c,onChange:d,caller:Kh}),U=p.useRef(null),W=w?v||!!w.closest("form"):!0,[V,R]=p.useState(new Set),F=Array.from(V).map(G=>G.props.value).join(";");return n.jsx(sq,{...j,children:n.jsxs(pCe,{required:y,scope:s,trigger:w,onTriggerChange:S,valueNode:E,onValueNodeChange:k,valueNodeHasChildren:A,onValueNodeHasChildrenChange:I,contentId:td(),value:T,onValueChange:B,open:O,onOpenChange:D,dir:P,triggerPointerDownPosRef:U,disabled:g,children:[n.jsx(U2.Provider,{scope:s,children:n.jsx(fCe,{scope:t.__scopeSelect,onNativeOptionAdd:p.useCallback(G=>{R(H=>new Set(H).add(G))},[]),onNativeOptionRemove:p.useCallback(G=>{R(H=>{const $=new Set(H);return $.delete(G),$})},[]),children:r})}),W?n.jsxs(nY,{"aria-hidden":!0,required:y,tabIndex:-1,name:m,autoComplete:x,value:T,onChange:G=>B(G.target.value),disabled:g,form:v,children:[T===void 0?n.jsx("option",{value:""}):null,Array.from(V)]},F):null]})})};MK.displayName=Kh;var IK="SelectTrigger",OK=p.forwardRef((t,s)=>{const{__scopeSelect:r,disabled:a=!1,...i}=t,l=H2(r),o=Am(IK,r),c=o.disabled||a,d=Fs(s,o.onTriggerChange),u=V2(r),m=p.useRef("touch"),[x,g,y]=aY(j=>{const w=u().filter(k=>!k.disabled),S=w.find(k=>k.value===o.value),E=iY(w,j,S);E!==void 0&&o.onValueChange(E.value)}),v=j=>{c||(o.onOpenChange(!0),y()),j&&(o.triggerPointerDownPosRef.current={x:Math.round(j.pageX),y:Math.round(j.pageY)})};return n.jsx(nq,{asChild:!0,...l,children:n.jsx(us.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":rY(o.value)?"":void 0,...i,ref:d,onClick:zt(i.onClick,j=>{j.currentTarget.focus(),m.current!=="mouse"&&v(j)}),onPointerDown:zt(i.onPointerDown,j=>{m.current=j.pointerType;const w=j.target;w.hasPointerCapture(j.pointerId)&&w.releasePointerCapture(j.pointerId),j.button===0&&j.ctrlKey===!1&&j.pointerType==="mouse"&&(v(j),j.preventDefault())}),onKeyDown:zt(i.onKeyDown,j=>{const w=x.current!=="";!(j.ctrlKey||j.altKey||j.metaKey)&&j.key.length===1&&g(j.key),!(w&&j.key===" ")&&mCe.includes(j.key)&&(v(),j.preventDefault())})})})});OK.displayName=IK;var RK="SelectValue",LK=p.forwardRef((t,s)=>{const{__scopeSelect:r,className:a,style:i,children:l,placeholder:o="",...c}=t,d=Am(RK,r),{onValueNodeHasChildrenChange:u}=d,m=l!==void 0,x=Fs(s,d.onValueNodeChange);return Qa(()=>{u(m)},[u,m]),n.jsx(us.span,{...c,ref:x,style:{pointerEvents:"none"},children:rY(d.value)?n.jsx(n.Fragment,{children:o}):l})});LK.displayName=RK;var bCe="SelectIcon",FK=p.forwardRef((t,s)=>{const{__scopeSelect:r,children:a,...i}=t;return n.jsx(us.span,{"aria-hidden":!0,...i,ref:s,children:a||""})});FK.displayName=bCe;var yCe="SelectPortal",BK=t=>n.jsx(N2,{asChild:!0,...t});BK.displayName=yCe;var Yh="SelectContent",$K=p.forwardRef((t,s)=>{const r=Am(Yh,t.__scopeSelect),[a,i]=p.useState();if(Qa(()=>{i(new DocumentFragment)},[]),!r.open){const l=a;return l?Sm.createPortal(n.jsx(zK,{scope:t.__scopeSelect,children:n.jsx(U2.Slot,{scope:t.__scopeSelect,children:n.jsx("div",{children:t.children})})}),l):null}return n.jsx(UK,{...t,ref:s})});$K.displayName=Yh;var Ko=10,[zK,Em]=If(Yh),vCe="SelectContentImpl",jCe=Hh("SelectContent.RemoveScroll"),UK=p.forwardRef((t,s)=>{const{__scopeSelect:r,position:a="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:l,onPointerDownOutside:o,side:c,sideOffset:d,align:u,alignOffset:m,arrowPadding:x,collisionBoundary:g,collisionPadding:y,sticky:v,hideWhenDetached:j,avoidCollisions:w,...S}=t,E=Am(Yh,r),[k,A]=p.useState(null),[I,P]=p.useState(null),O=Fs(s,ee=>A(ee)),[D,T]=p.useState(null),[B,U]=p.useState(null),W=V2(r),[V,R]=p.useState(!1),F=p.useRef(!1);p.useEffect(()=>{if(k)return WT(k)},[k]),OT();const G=p.useCallback(ee=>{const[X,...Z]=W().map(oe=>oe.ref.current),[Y]=Z.slice(-1),Q=document.activeElement;for(const oe of ee)if(oe===Q||(oe==null||oe.scrollIntoView({block:"nearest"}),oe===X&&I&&(I.scrollTop=0),oe===Y&&I&&(I.scrollTop=I.scrollHeight),oe==null||oe.focus(),document.activeElement!==Q))return},[W,I]),H=p.useCallback(()=>G([D,k]),[G,D,k]);p.useEffect(()=>{V&&H()},[V,H]);const{onOpenChange:$,triggerPointerDownPosRef:K}=E;p.useEffect(()=>{if(k){let ee={x:0,y:0};const X=Y=>{var Q,oe;ee={x:Math.abs(Math.round(Y.pageX)-(((Q=K.current)==null?void 0:Q.x)??0)),y:Math.abs(Math.round(Y.pageY)-(((oe=K.current)==null?void 0:oe.y)??0))}},Z=Y=>{ee.x<=10&&ee.y<=10?Y.preventDefault():k.contains(Y.target)||$(!1),document.removeEventListener("pointermove",X),K.current=null};return K.current!==null&&(document.addEventListener("pointermove",X),document.addEventListener("pointerup",Z,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",X),document.removeEventListener("pointerup",Z,{capture:!0})}}},[k,$,K]),p.useEffect(()=>{const ee=()=>$(!1);return window.addEventListener("blur",ee),window.addEventListener("resize",ee),()=>{window.removeEventListener("blur",ee),window.removeEventListener("resize",ee)}},[$]);const[le,se]=aY(ee=>{const X=W().filter(Q=>!Q.disabled),Z=X.find(Q=>Q.ref.current===document.activeElement),Y=iY(X,ee,Z);Y&&setTimeout(()=>Y.ref.current.focus())}),J=p.useCallback((ee,X,Z)=>{const Y=!F.current&&!Z;(E.value!==void 0&&E.value===X||Y)&&(T(ee),Y&&(F.current=!0))},[E.value]),ie=p.useCallback(()=>k==null?void 0:k.focus(),[k]),te=p.useCallback((ee,X,Z)=>{const Y=!F.current&&!Z;(E.value!==void 0&&E.value===X||Y)&&U(ee)},[E.value]),ne=a==="popper"?y4:VK,q=ne===y4?{side:c,sideOffset:d,align:u,alignOffset:m,arrowPadding:x,collisionBoundary:g,collisionPadding:y,sticky:v,hideWhenDetached:j,avoidCollisions:w}:{};return n.jsx(zK,{scope:r,content:k,viewport:I,onViewportChange:P,itemRefCallback:J,selectedItem:D,onItemLeave:ie,itemTextRefCallback:te,focusSelectedItem:H,selectedItemText:B,position:a,isPositioned:V,searchRef:le,children:n.jsx(S2,{as:jCe,allowPinchZoom:!0,children:n.jsx(f2,{asChild:!0,trapped:E.open,onMountAutoFocus:ee=>{ee.preventDefault()},onUnmountAutoFocus:zt(i,ee=>{var X;(X=E.trigger)==null||X.focus({preventScroll:!0}),ee.preventDefault()}),children:n.jsx(p2,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:l,onPointerDownOutside:o,onFocusOutside:ee=>ee.preventDefault(),onDismiss:()=>E.onOpenChange(!1),children:n.jsx(ne,{role:"listbox",id:E.contentId,"data-state":E.open?"open":"closed",dir:E.dir,onContextMenu:ee=>ee.preventDefault(),...S,...q,onPlaced:()=>R(!0),ref:O,style:{display:"flex",flexDirection:"column",outline:"none",...S.style},onKeyDown:zt(S.onKeyDown,ee=>{const X=ee.ctrlKey||ee.altKey||ee.metaKey;if(ee.key==="Tab"&&ee.preventDefault(),!X&&ee.key.length===1&&se(ee.key),["ArrowUp","ArrowDown","Home","End"].includes(ee.key)){let Y=W().filter(Q=>!Q.disabled).map(Q=>Q.ref.current);if(["ArrowUp","End"].includes(ee.key)&&(Y=Y.slice().reverse()),["ArrowUp","ArrowDown"].includes(ee.key)){const Q=ee.target,oe=Y.indexOf(Q);Y=Y.slice(oe+1)}setTimeout(()=>G(Y)),ee.preventDefault()}})})})})})})});UK.displayName=vCe;var NCe="SelectItemAlignedPosition",VK=p.forwardRef((t,s)=>{const{__scopeSelect:r,onPlaced:a,...i}=t,l=Am(Yh,r),o=Em(Yh,r),[c,d]=p.useState(null),[u,m]=p.useState(null),x=Fs(s,O=>m(O)),g=V2(r),y=p.useRef(!1),v=p.useRef(!0),{viewport:j,selectedItem:w,selectedItemText:S,focusSelectedItem:E}=o,k=p.useCallback(()=>{if(l.trigger&&l.valueNode&&c&&u&&j&&w&&S){const O=l.trigger.getBoundingClientRect(),D=u.getBoundingClientRect(),T=l.valueNode.getBoundingClientRect(),B=S.getBoundingClientRect();if(l.dir!=="rtl"){const Q=B.left-D.left,oe=T.left-Q,_e=O.left-oe,xe=O.width+_e,me=Math.max(xe,D.width),Re=window.innerWidth-Ko,Ze=x4(oe,[Ko,Math.max(Ko,Re-me)]);c.style.minWidth=xe+"px",c.style.left=Ze+"px"}else{const Q=D.right-B.right,oe=window.innerWidth-T.right-Q,_e=window.innerWidth-O.right-oe,xe=O.width+_e,me=Math.max(xe,D.width),Re=window.innerWidth-Ko,Ze=x4(oe,[Ko,Math.max(Ko,Re-me)]);c.style.minWidth=xe+"px",c.style.right=Ze+"px"}const U=g(),W=window.innerHeight-Ko*2,V=j.scrollHeight,R=window.getComputedStyle(u),F=parseInt(R.borderTopWidth,10),G=parseInt(R.paddingTop,10),H=parseInt(R.borderBottomWidth,10),$=parseInt(R.paddingBottom,10),K=F+G+V+$+H,le=Math.min(w.offsetHeight*5,K),se=window.getComputedStyle(j),J=parseInt(se.paddingTop,10),ie=parseInt(se.paddingBottom,10),te=O.top+O.height/2-Ko,ne=W-te,q=w.offsetHeight/2,ee=w.offsetTop+q,X=F+G+ee,Z=K-X;if(X<=te){const Q=U.length>0&&w===U[U.length-1].ref.current;c.style.bottom="0px";const oe=u.clientHeight-j.offsetTop-j.offsetHeight,_e=Math.max(ne,q+(Q?ie:0)+oe+H),xe=X+_e;c.style.height=xe+"px"}else{const Q=U.length>0&&w===U[0].ref.current;c.style.top="0px";const _e=Math.max(te,F+j.offsetTop+(Q?J:0)+q)+Z;c.style.height=_e+"px",j.scrollTop=X-te+j.offsetTop}c.style.margin=`${Ko}px 0`,c.style.minHeight=le+"px",c.style.maxHeight=W+"px",a==null||a(),requestAnimationFrame(()=>y.current=!0)}},[g,l.trigger,l.valueNode,c,u,j,w,S,l.dir,a]);Qa(()=>k(),[k]);const[A,I]=p.useState();Qa(()=>{u&&I(window.getComputedStyle(u).zIndex)},[u]);const P=p.useCallback(O=>{O&&v.current===!0&&(k(),E==null||E(),v.current=!1)},[k,E]);return n.jsx(_Ce,{scope:r,contentWrapper:c,shouldExpandOnScrollRef:y,onScrollButtonChange:P,children:n.jsx("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:n.jsx(us.div,{...i,ref:x,style:{boxSizing:"border-box",maxHeight:"100%",...i.style}})})})});VK.displayName=NCe;var wCe="SelectPopperPosition",y4=p.forwardRef((t,s)=>{const{__scopeSelect:r,align:a="start",collisionPadding:i=Ko,...l}=t,o=H2(r);return n.jsx(rq,{...o,...l,ref:s,align:a,collisionPadding:i,style:{boxSizing:"border-box",...l.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});y4.displayName=wCe;var[_Ce,bP]=If(Yh,{}),v4="SelectViewport",HK=p.forwardRef((t,s)=>{const{__scopeSelect:r,nonce:a,...i}=t,l=Em(v4,r),o=bP(v4,r),c=Fs(s,l.onViewportChange),d=p.useRef(0);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),n.jsx(U2.Slot,{scope:r,children:n.jsx(us.div,{"data-radix-select-viewport":"",role:"presentation",...i,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...i.style},onScroll:zt(i.onScroll,u=>{const m=u.currentTarget,{contentWrapper:x,shouldExpandOnScrollRef:g}=o;if(g!=null&&g.current&&x){const y=Math.abs(d.current-m.scrollTop);if(y>0){const v=window.innerHeight-Ko*2,j=parseFloat(x.style.minHeight),w=parseFloat(x.style.height),S=Math.max(j,w);if(S<v){const E=S+y,k=Math.min(v,E),A=E-k;x.style.height=k+"px",x.style.bottom==="0px"&&(m.scrollTop=A>0?A:0,x.style.justifyContent="flex-end")}}}d.current=m.scrollTop})})})]})});HK.displayName=v4;var WK="SelectGroup",[SCe,CCe]=If(WK),kCe=p.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t,i=td();return n.jsx(SCe,{scope:r,id:i,children:n.jsx(us.div,{role:"group","aria-labelledby":i,...a,ref:s})})});kCe.displayName=WK;var qK="SelectLabel",GK=p.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t,i=CCe(qK,r);return n.jsx(us.div,{id:i.id,...a,ref:s})});GK.displayName=qK;var vN="SelectItem",[ACe,KK]=If(vN),YK=p.forwardRef((t,s)=>{const{__scopeSelect:r,value:a,disabled:i=!1,textValue:l,...o}=t,c=Am(vN,r),d=Em(vN,r),u=c.value===a,[m,x]=p.useState(l??""),[g,y]=p.useState(!1),v=Fs(s,E=>{var k;return(k=d.itemRefCallback)==null?void 0:k.call(d,E,a,i)}),j=td(),w=p.useRef("touch"),S=()=>{i||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return n.jsx(ACe,{scope:r,value:a,disabled:i,textId:j,isSelected:u,onItemTextChange:p.useCallback(E=>{x(k=>k||((E==null?void 0:E.textContent)??"").trim())},[]),children:n.jsx(U2.ItemSlot,{scope:r,value:a,disabled:i,textValue:m,children:n.jsx(us.div,{role:"option","aria-labelledby":j,"data-highlighted":g?"":void 0,"aria-selected":u&&g,"data-state":u?"checked":"unchecked","aria-disabled":i||void 0,"data-disabled":i?"":void 0,tabIndex:i?void 0:-1,...o,ref:v,onFocus:zt(o.onFocus,()=>y(!0)),onBlur:zt(o.onBlur,()=>y(!1)),onClick:zt(o.onClick,()=>{w.current!=="mouse"&&S()}),onPointerUp:zt(o.onPointerUp,()=>{w.current==="mouse"&&S()}),onPointerDown:zt(o.onPointerDown,E=>{w.current=E.pointerType}),onPointerMove:zt(o.onPointerMove,E=>{var k;w.current=E.pointerType,i?(k=d.onItemLeave)==null||k.call(d):w.current==="mouse"&&E.currentTarget.focus({preventScroll:!0})}),onPointerLeave:zt(o.onPointerLeave,E=>{var k;E.currentTarget===document.activeElement&&((k=d.onItemLeave)==null||k.call(d))}),onKeyDown:zt(o.onKeyDown,E=>{var A;((A=d.searchRef)==null?void 0:A.current)!==""&&E.key===" "||(hCe.includes(E.key)&&S(),E.key===" "&&E.preventDefault())})})})})});YK.displayName=vN;var rg="SelectItemText",XK=p.forwardRef((t,s)=>{const{__scopeSelect:r,className:a,style:i,...l}=t,o=Am(rg,r),c=Em(rg,r),d=KK(rg,r),u=gCe(rg,r),[m,x]=p.useState(null),g=Fs(s,S=>x(S),d.onItemTextChange,S=>{var E;return(E=c.itemTextRefCallback)==null?void 0:E.call(c,S,d.value,d.disabled)}),y=m==null?void 0:m.textContent,v=p.useMemo(()=>n.jsx("option",{value:d.value,disabled:d.disabled,children:y},d.value),[d.disabled,d.value,y]),{onNativeOptionAdd:j,onNativeOptionRemove:w}=u;return Qa(()=>(j(v),()=>w(v)),[j,w,v]),n.jsxs(n.Fragment,{children:[n.jsx(us.span,{id:d.textId,...l,ref:g}),d.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Sm.createPortal(l.children,o.valueNode):null]})});XK.displayName=rg;var QK="SelectItemIndicator",ZK=p.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t;return KK(QK,r).isSelected?n.jsx(us.span,{"aria-hidden":!0,...a,ref:s}):null});ZK.displayName=QK;var j4="SelectScrollUpButton",JK=p.forwardRef((t,s)=>{const r=Em(j4,t.__scopeSelect),a=bP(j4,t.__scopeSelect),[i,l]=p.useState(!1),o=Fs(s,a.onScrollButtonChange);return Qa(()=>{if(r.viewport&&r.isPositioned){let c=function(){const u=d.scrollTop>0;l(u)};const d=r.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[r.viewport,r.isPositioned]),i?n.jsx(tY,{...t,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=r;c&&d&&(c.scrollTop=c.scrollTop-d.offsetHeight)}}):null});JK.displayName=j4;var N4="SelectScrollDownButton",eY=p.forwardRef((t,s)=>{const r=Em(N4,t.__scopeSelect),a=bP(N4,t.__scopeSelect),[i,l]=p.useState(!1),o=Fs(s,a.onScrollButtonChange);return Qa(()=>{if(r.viewport&&r.isPositioned){let c=function(){const u=d.scrollHeight-d.clientHeight,m=Math.ceil(d.scrollTop)<u;l(m)};const d=r.viewport;return c(),d.addEventListener("scroll",c),()=>d.removeEventListener("scroll",c)}},[r.viewport,r.isPositioned]),i?n.jsx(tY,{...t,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:d}=r;c&&d&&(c.scrollTop=c.scrollTop+d.offsetHeight)}}):null});eY.displayName=N4;var tY=p.forwardRef((t,s)=>{const{__scopeSelect:r,onAutoScroll:a,...i}=t,l=Em("SelectScrollButton",r),o=p.useRef(null),c=V2(r),d=p.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return p.useEffect(()=>()=>d(),[d]),Qa(()=>{var m;const u=c().find(x=>x.ref.current===document.activeElement);(m=u==null?void 0:u.ref.current)==null||m.scrollIntoView({block:"nearest"})},[c]),n.jsx(us.div,{"aria-hidden":!0,...i,ref:s,style:{flexShrink:0,...i.style},onPointerDown:zt(i.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(a,50))}),onPointerMove:zt(i.onPointerMove,()=>{var u;(u=l.onItemLeave)==null||u.call(l),o.current===null&&(o.current=window.setInterval(a,50))}),onPointerLeave:zt(i.onPointerLeave,()=>{d()})})}),ECe="SelectSeparator",sY=p.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t;return n.jsx(us.div,{"aria-hidden":!0,...a,ref:s})});sY.displayName=ECe;var w4="SelectArrow",TCe=p.forwardRef((t,s)=>{const{__scopeSelect:r,...a}=t,i=H2(r),l=Am(w4,r),o=Em(w4,r);return l.open&&o.position==="popper"?n.jsx(aq,{...i,...a,ref:s}):null});TCe.displayName=w4;var PCe="SelectBubbleInput",nY=p.forwardRef(({__scopeSelect:t,value:s,...r},a)=>{const i=p.useRef(null),l=Fs(a,i),o=gP(s);return p.useEffect(()=>{const c=i.current;if(!c)return;const d=window.HTMLSelectElement.prototype,m=Object.getOwnPropertyDescriptor(d,"value").set;if(o!==s&&m){const x=new Event("change",{bubbles:!0});m.call(c,s),c.dispatchEvent(x)}},[o,s]),n.jsx(us.select,{...r,style:{...DK,...r.style},ref:l,defaultValue:s})});nY.displayName=PCe;function rY(t){return t===""||t===void 0}function aY(t){const s=Ha(t),r=p.useRef(""),a=p.useRef(0),i=p.useCallback(o=>{const c=r.current+o;s(c),function d(u){r.current=u,window.clearTimeout(a.current),u!==""&&(a.current=window.setTimeout(()=>d(""),1e3))}(c)},[s]),l=p.useCallback(()=>{r.current="",window.clearTimeout(a.current)},[]);return p.useEffect(()=>()=>window.clearTimeout(a.current),[]),[r,i,l]}function iY(t,s,r){const i=s.length>1&&Array.from(s).every(u=>u===s[0])?s[0]:s,l=r?t.indexOf(r):-1;let o=DCe(t,Math.max(l,0));i.length===1&&(o=o.filter(u=>u!==r));const d=o.find(u=>u.textValue.toLowerCase().startsWith(i.toLowerCase()));return d!==r?d:void 0}function DCe(t,s){return t.map((r,a)=>t[(s+a)%t.length])}var MCe=MK,lY=OK,ICe=LK,OCe=FK,RCe=BK,oY=$K,LCe=HK,cY=GK,dY=YK,FCe=XK,BCe=ZK,uY=JK,mY=eY,hY=sY;const Zs=MCe,Js=ICe,Ws=p.forwardRef(({className:t,children:s,...r},a)=>n.jsxs(lY,{ref:a,className:Bt("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[s,n.jsx(OCe,{asChild:!0,children:n.jsx(Gn,{className:"h-4 w-4 opacity-50"})})]}));Ws.displayName=lY.displayName;const xY=p.forwardRef(({className:t,...s},r)=>n.jsx(uY,{ref:r,className:Bt("flex cursor-default items-center justify-center py-1",t),...s,children:n.jsx(el,{className:"h-4 w-4"})}));xY.displayName=uY.displayName;const pY=p.forwardRef(({className:t,...s},r)=>n.jsx(mY,{ref:r,className:Bt("flex cursor-default items-center justify-center py-1",t),...s,children:n.jsx(Gn,{className:"h-4 w-4"})}));pY.displayName=mY.displayName;const qs=p.forwardRef(({className:t,children:s,position:r="popper",...a},i)=>n.jsx(RCe,{children:n.jsxs(oY,{ref:i,className:Bt("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...a,children:[n.jsx(xY,{}),n.jsx(LCe,{className:Bt("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),n.jsx(pY,{})]})}));qs.displayName=oY.displayName;const $Ce=p.forwardRef(({className:t,...s},r)=>n.jsx(cY,{ref:r,className:Bt("px-2 py-1.5 text-sm font-semibold",t),...s}));$Ce.displayName=cY.displayName;const Ut=p.forwardRef(({className:t,children:s,...r},a)=>n.jsxs(dY,{ref:a,className:Bt("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[n.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(BCe,{children:n.jsx(So,{className:"h-4 w-4"})})}),n.jsx(FCe,{children:s})]}));Ut.displayName=dY.displayName;const zCe=p.forwardRef(({className:t,...s},r)=>n.jsx(hY,{ref:r,className:Bt("-mx-1 my-1 h-px bg-muted",t),...s}));zCe.displayName=hY.displayName;const C1=t=>t?t.length===16?`${t}:00`:t:null;function UCe({admissionId:t,canWrite:s}){const[r,a]=p.useState("pain"),[i,l]=p.useState(!1),[o,c]=p.useState(""),[d,u]=p.useState([]),[m,x]=p.useState([]),[g,y]=p.useState([]),[v,j]=p.useState([]),[w,S]=p.useState({recorded_at:"",scale_type:"",score:"",location:"",character:"",intervention:"",post_intervention_score:""}),[E,k]=p.useState({recorded_at:"",tool:"",score:"",risk_level:"",precautions:""}),[A,I]=p.useState({recorded_at:"",tool:"",score:"",risk_level:"",existing_ulcer:!1,site:"",stage:"",management_plan:""}),[P,O]=p.useState({recorded_at:"",bmi:"",weight_kg:"",height_cm:"",screening_tool:"",score:"",risk_level:"",dietician_referral:!1}),D=async()=>{var R,F;if(t){l(!0),c("");try{const[G,H,$,K]=await Promise.all([zNe(t),VNe(t),WNe(t),GNe(t)]);u(G.data||[]),x(H.data||[]),y($.data||[]),j(K.data||[])}catch(G){c(((F=(R=G==null?void 0:G.response)==null?void 0:R.data)==null?void 0:F.detail)||"Failed to load assessments")}finally{l(!1)}}};p.useEffect(()=>{D()},[t]);const T=async R=>{var F,G;if(R.preventDefault(),!(!s||!t))try{const H={recorded_at:C1(w.recorded_at),scale_type:w.scale_type||"",score:w.score!==""?Number(w.score):null,location:w.location||"",character:w.character||"",intervention:w.intervention||"",post_intervention_score:w.post_intervention_score!==""?Number(w.post_intervention_score):null};await UNe(t,H),S({recorded_at:"",scale_type:"",score:"",location:"",character:"",intervention:"",post_intervention_score:""}),await D()}catch(H){alert(((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to add pain assessment")}},B=async R=>{var F,G;if(R.preventDefault(),!(!s||!t))try{const H={recorded_at:C1(E.recorded_at),tool:E.tool||"",score:E.score!==""?Number(E.score):null,risk_level:E.risk_level||"",precautions:E.precautions||""};await HNe(t,H),k({recorded_at:"",tool:"",score:"",risk_level:"",precautions:""}),await D()}catch(H){alert(((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to add fall risk assessment")}},U=async R=>{var F,G;if(R.preventDefault(),!(!s||!t))try{const H={recorded_at:C1(A.recorded_at),tool:A.tool||"",score:A.score!==""?Number(A.score):null,risk_level:A.risk_level||"",existing_ulcer:!!A.existing_ulcer,site:A.site||"",stage:A.stage||"",management_plan:A.management_plan||""};await qNe(t,H),I({recorded_at:"",tool:"",score:"",risk_level:"",existing_ulcer:!1,site:"",stage:"",management_plan:""}),await D()}catch(H){alert(((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to add pressure-ulcer assessment")}},W=async R=>{var F,G;if(R.preventDefault(),!(!s||!t))try{const H={recorded_at:C1(P.recorded_at),bmi:P.bmi!==""?Number(P.bmi):null,weight_kg:P.weight_kg!==""?Number(P.weight_kg):null,height_cm:P.height_cm!==""?Number(P.height_cm):null,screening_tool:P.screening_tool||"",score:P.score!==""?Number(P.score):null,risk_level:P.risk_level||"",dietician_referral:!!P.dietician_referral};await KNe(t,H),O({recorded_at:"",bmi:"",weight_kg:"",height_cm:"",screening_tool:"",score:"",risk_level:"",dietician_referral:!1}),await D()}catch(H){alert(((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to add nutrition assessment")}},V=[{key:"pain",label:"Pain"},{key:"fall",label:"Fall Risk"},{key:"pressure",label:"Pressure Ulcer"},{key:"nutrition",label:"Nutrition"}];return n.jsxs("div",{className:"space-y-4 text-sm text-black",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsx("h2",{className:"font-semibold",children:"Risk & Clinical Assessments"})}),o&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:o}),n.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(R=>n.jsx("button",{type:"button",onClick:()=>a(R.key),className:["rounded-full px-3 py-1 text-xs md:text-sm border",r===R.key?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-500 hover:bg-slate-50"].join(" "),children:R.label},R.key))}),i&&n.jsx("div",{className:"text-xs text-gray-500",children:"Loading assessments"}),r==="pain"&&n.jsxs("section",{className:"space-y-3",children:[s&&n.jsxs("form",{onSubmit:T,className:"rounded-xl border bg-gray-50 p-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Recorded at"}),n.jsx("input",{type:"datetime-local",className:"input",value:w.recorded_at,onChange:R=>S(F=>({...F,recorded_at:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Scale"}),n.jsx("input",{className:"input",placeholder:"NRS / VAS / Wong-Baker",value:w.scale_type,onChange:R=>S(F=>({...F,scale_type:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Score"}),n.jsx("input",{className:"input",type:"number",min:"0",max:"10",value:w.score,onChange:R=>S(F=>({...F,score:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Location"}),n.jsx("input",{className:"input",placeholder:"Site",value:w.location,onChange:R=>S(F=>({...F,location:R.target.value}))})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Character"}),n.jsx("input",{className:"input",placeholder:"sharp / dull / throbbing",value:w.character,onChange:R=>S(F=>({...F,character:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Post-intervention score"}),n.jsx("input",{className:"input",type:"number",min:"0",max:"10",value:w.post_intervention_score,onChange:R=>S(F=>({...F,post_intervention_score:R.target.value}))})]})]}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Interventions / remarks",value:w.intervention,onChange:R=>S(F=>({...F,intervention:R.target.value}))}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",children:"Save pain assessment"})})]}),n.jsx("div",{className:"rounded-xl border bg-white overflow-hidden",children:n.jsxs("table",{className:"w-full text-xs md:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50 text-gray-500 text-[11px] md:text-xs",children:[n.jsx("th",{className:"px-2 md:px-3 py-2",children:"When"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Scale"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Score"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Location / Character"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Intervention"})]})}),n.jsxs("tbody",{children:[d.map(R=>n.jsxs("tr",{className:"border-t align-top",children:[n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.recorded_at?new Date(R.recorded_at).toLocaleString():""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.scale_type||""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.score??""}),n.jsxs("td",{className:"px-2 md:px-3 py-2 whitespace-pre-wrap",children:[R.location||"",R.character?` (${R.character})`:""]}),n.jsx("td",{className:"px-2 md:px-3 py-2 whitespace-pre-wrap",children:R.intervention||""})]},R.id)),!d.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-3 text-gray-500 text-xs",children:"No pain assessments recorded."})})]})]})})]}),r==="fall"&&n.jsxs("section",{className:"space-y-3",children:[s&&n.jsxs("form",{onSubmit:B,className:"rounded-xl border bg-gray-50 p-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Recorded at"}),n.jsx("input",{type:"datetime-local",className:"input",value:E.recorded_at,onChange:R=>k(F=>({...F,recorded_at:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Tool"}),n.jsx("input",{className:"input",placeholder:"Morse, etc.",value:E.tool,onChange:R=>k(F=>({...F,tool:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Score"}),n.jsx("input",{className:"input",type:"number",value:E.score,onChange:R=>k(F=>({...F,score:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Risk level"}),n.jsx("input",{className:"input",placeholder:"low / moderate / high",value:E.risk_level,onChange:R=>k(F=>({...F,risk_level:R.target.value}))})]})]}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Precautions / instructions",value:E.precautions,onChange:R=>k(F=>({...F,precautions:R.target.value}))}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",children:"Save fall risk assessment"})})]}),n.jsx("div",{className:"rounded-xl border bg-white overflow-hidden",children:n.jsxs("table",{className:"w-full text-xs md:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50 text-gray-500 text-[11px] md:text-xs",children:[n.jsx("th",{className:"px-2 md:px-3 py-2",children:"When"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Tool"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Score"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Risk"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Precautions"})]})}),n.jsxs("tbody",{children:[m.map(R=>n.jsxs("tr",{className:"border-t align-top",children:[n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.recorded_at?new Date(R.recorded_at).toLocaleString():""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.tool||""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.score??""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.risk_level||""}),n.jsx("td",{className:"px-2 md:px-3 py-2 whitespace-pre-wrap",children:R.precautions||""})]},R.id)),!m.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-3 text-gray-500 text-xs",children:"No fall risk assessments recorded."})})]})]})})]}),r==="pressure"&&n.jsxs("section",{className:"space-y-3",children:[s&&n.jsxs("form",{onSubmit:U,className:"rounded-xl border bg-gray-50 p-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Recorded at"}),n.jsx("input",{type:"datetime-local",className:"input",value:A.recorded_at,onChange:R=>I(F=>({...F,recorded_at:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Tool"}),n.jsx("input",{className:"input",placeholder:"Braden, etc.",value:A.tool,onChange:R=>I(F=>({...F,tool:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Score"}),n.jsx("input",{className:"input",type:"number",value:A.score,onChange:R=>I(F=>({...F,score:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Risk level"}),n.jsx("input",{className:"input",placeholder:"low / moderate / high",value:A.risk_level,onChange:R=>I(F=>({...F,risk_level:R.target.value}))})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[n.jsx("input",{type:"checkbox",className:"h-3 w-3",checked:!!A.existing_ulcer,onChange:R=>I(F=>({...F,existing_ulcer:R.target.checked}))}),"Existing ulcer"]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Site"}),n.jsx("input",{className:"input",value:A.site,onChange:R=>I(F=>({...F,site:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Stage"}),n.jsx("input",{className:"input",placeholder:"Stage IIV",value:A.stage,onChange:R=>I(F=>({...F,stage:R.target.value}))})]})]}),n.jsx("textarea",{className:"input min-h-[70px]",placeholder:"Management plan",value:A.management_plan,onChange:R=>I(F=>({...F,management_plan:R.target.value}))}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",children:"Save pressure-ulcer assessment"})})]}),n.jsx("div",{className:"rounded-xl border bg-white overflow-hidden",children:n.jsxs("table",{className:"w-full text-xs md:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50 text-gray-500 text-[11px] md:text-xs",children:[n.jsx("th",{className:"px-2 md:px-3 py-2",children:"When"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Tool"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Score"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Risk / Site / Stage"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Management plan"})]})}),n.jsxs("tbody",{children:[g.map(R=>n.jsxs("tr",{className:"border-t align-top",children:[n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.recorded_at?new Date(R.recorded_at).toLocaleString():""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.tool||""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.score??""}),n.jsxs("td",{className:"px-2 md:px-3 py-2 whitespace-pre-wrap",children:[R.risk_level||"",R.site?`  ${R.site}`:"",R.stage?` (Stage ${R.stage})`:"",R.existing_ulcer?"  Existing":""]}),n.jsx("td",{className:"px-2 md:px-3 py-2 whitespace-pre-wrap",children:R.management_plan||""})]},R.id)),!g.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-3 text-gray-500 text-xs",children:"No pressure-ulcer assessments recorded."})})]})]})})]}),r==="nutrition"&&n.jsxs("section",{className:"space-y-3",children:[s&&n.jsxs("form",{onSubmit:W,className:"rounded-xl border bg-gray-50 p-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Recorded at"}),n.jsx("input",{type:"datetime-local",className:"input",value:P.recorded_at,onChange:R=>O(F=>({...F,recorded_at:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"BMI"}),n.jsx("input",{className:"input",type:"number",step:"0.1",value:P.bmi,onChange:R=>O(F=>({...F,bmi:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Weight (kg)"}),n.jsx("input",{className:"input",type:"number",step:"0.1",value:P.weight_kg,onChange:R=>O(F=>({...F,weight_kg:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Height (cm)"}),n.jsx("input",{className:"input",type:"number",step:"0.1",value:P.height_cm,onChange:R=>O(F=>({...F,height_cm:R.target.value}))})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Screening tool"}),n.jsx("input",{className:"input",placeholder:"MUST, etc.",value:P.screening_tool,onChange:R=>O(F=>({...F,screening_tool:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Score"}),n.jsx("input",{className:"input",type:"number",value:P.score,onChange:R=>O(F=>({...F,score:R.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Risk level"}),n.jsx("input",{className:"input",placeholder:"low / moderate / high",value:P.risk_level,onChange:R=>O(F=>({...F,risk_level:R.target.value}))})]})]}),n.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[n.jsx("input",{type:"checkbox",className:"h-3 w-3",checked:!!P.dietician_referral,onChange:R=>O(F=>({...F,dietician_referral:R.target.checked}))}),"Dietician referral required"]}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",children:"Save nutrition assessment"})})]}),n.jsx("div",{className:"rounded-xl border bg-white overflow-hidden",children:n.jsxs("table",{className:"w-full text-xs md:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50 text-gray-500 text-[11px] md:text-xs",children:[n.jsx("th",{className:"px-2 md:px-3 py-2",children:"When"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"BMI"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Wt / Ht"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Tool / Score / Risk"}),n.jsx("th",{className:"px-2 md:px-3 py-2",children:"Dietician referral"})]})}),n.jsxs("tbody",{children:[v.map(R=>n.jsxs("tr",{className:"border-t align-top",children:[n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.recorded_at?new Date(R.recorded_at).toLocaleString():""}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.bmi!=null?String(R.bmi):""}),n.jsxs("td",{className:"px-2 md:px-3 py-2",children:[R.weight_kg!=null?`${R.weight_kg} kg`:"",R.height_cm!=null?` / ${R.height_cm} cm`:""]}),n.jsxs("td",{className:"px-2 md:px-3 py-2 whitespace-pre-wrap",children:[R.screening_tool||"",R.score!=null?`  Score ${R.score}`:"",R.risk_level?`  ${R.risk_level}`:""]}),n.jsx("td",{className:"px-2 md:px-3 py-2",children:R.dietician_referral?"Yes":"No"})]},R.id)),!v.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-3 text-gray-500 text-xs",children:"No nutrition assessments recorded."})})]})]})})]})]})}const VCe=["po","iv","im","sc","topical","nebulisation"],HCe=["od","bd","tds","qid","stat","prn"],WCe=["mg","g","ml","units","drops","puffs","tab","cap","sachet"],N8=[{value:"regular",label:"Regular"},{value:"sos",label:"SOS"},{value:"stat_premed",label:"STAT / Premed"}];function qCe({admissionId:t,canWrite:s=!0}){const[r,a]=p.useState(!1),[i,l]=p.useState(!1),[o,c]=p.useState({allergies:"",diagnosis:"",weight_kg:"",height_cm:"",blood_group:"",bsa:"",bmi:"",diet_oral_fluid_per_day:"",diet_salt_gm_per_day:"",diet_calorie_per_day:"",diet_protein_gm_per_day:"",diet_remarks:""}),[d,u]=p.useState([]),[m,x]=p.useState({date:"",fluid:"",additive:"",dose:"",rate_ml_per_hr:"",start_time:"",stop_time:"",remarks:""}),[g,y]=p.useState(!1),[v,j]=p.useState([]),[w,S]=p.useState({name:"",specimen:"",emp_no:""}),[E,k]=p.useState(!1),[A,I]=p.useState([]),[P,O]=p.useState({date:"",remarks:""}),[D,T]=p.useState(!1),[B,U]=p.useState([]),[W,V]=p.useState(""),[R,F]=p.useState(!1),[G,H]=p.useState(!1),[$,K]=p.useState(!0),[le,se]=p.useState("all"),[J,ie]=p.useState({drug_name:"",order_type:"regular",route:"iv",frequency:"bd",dose_value:"",dose_unit:"mg",start_date:"",end_date:"",duration_days:"",instructions:""});p.useMemo(()=>Array.isArray(B)&&B.length>0,[B]);const te=p.useMemo(()=>{let ve=B;return $&&(ve=ve.filter(Ge=>(Ge.order_status||"active")!=="stopped")),le!=="all"&&(ve=ve.filter(Ge=>(Ge.order_type||"regular")===le)),ve},[B,$,le]),ne=ve=>{if(!ve)return"";const Ge=new Date(ve);return Number.isNaN(Ge.getTime())?"":Ge.toLocaleDateString()},q=ve=>ve.dose==null&&!ve.dose_unit?"":ve.dose==null?ve.dose_unit||"":`${ve.dose} ${ve.dose_unit||""}`.trim(),ee=ve=>{const Ge=ve||"active";return Ge==="stopped"?"inline-flex rounded-full bg-slate-100 px-2 py-0.5 text-[11px] text-slate-600":Ge==="completed"?"inline-flex rounded-full bg-blue-50 px-2 py-0.5 text-[11px] text-blue-700":"inline-flex rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] text-emerald-700"};p.useEffect(()=>{const ve=Number(o.weight_kg),Ge=Number(o.height_cm);if(!ve||!Ge||Number.isNaN(ve)||Number.isNaN(Ge)){c(Fe=>({...Fe,bmi:""}));return}const We=Ge/100;if(!We){c(Fe=>({...Fe,bmi:""}));return}const Ve=ve/(We*We);c(Fe=>({...Fe,bmi:Ve.toFixed(1)}))},[o.weight_kg,o.height_cm]);const X=async()=>{if(t)try{const{data:ve}=await ZNe(t);ve&&c({allergies:ve.allergies||"",diagnosis:ve.diagnosis||"",weight_kg:ve.weight_kg??"",height_cm:ve.height_cm??"",blood_group:ve.blood_group||"",bsa:ve.bsa??"",bmi:ve.bmi??"",diet_oral_fluid_per_day:ve.diet_oral_fluid_per_day??"",diet_salt_gm_per_day:ve.diet_salt_gm_per_day??"",diet_calorie_per_day:ve.diet_calorie_per_day??"",diet_protein_gm_per_day:ve.diet_protein_gm_per_day??"",diet_remarks:ve.diet_remarks||""})}catch(ve){const Ge=jl(ve,"Failed to load medications");ae.error(Ge)}},Z=async()=>{if(t)try{const{data:ve}=await ewe(t);u(Array.isArray(ve)?ve:[])}catch(ve){const Ge=jl(ve,"Failed to load medications");ae.error(Ge)}},Y=async()=>{if(t)try{const{data:ve}=await nwe(t);j(Array.isArray(ve)?ve:[])}catch{}},Q=async()=>{if(t)try{const{data:ve}=await iwe(t);I(Array.isArray(ve)?ve:[])}catch(ve){const Ge=jl(ve,"Failed to load medications");ae.error(Ge)}},oe=async()=>{if(t){F(!0),V("");try{const{data:ve}=await YNe(t);U(Array.isArray(ve)?ve:[])}catch(ve){const Ge=jl(ve,"Failed to load medications");V(Ge),ae.error(Ge)}finally{F(!1)}}},_e=async()=>{t&&(a(!0),await Promise.all([X(),Z(),Y(),Q(),oe()]),a(!1))};p.useEffect(()=>{_e()},[t]);const xe=ve=>Ge=>{const We=Ge.target.value;c(Ve=>({...Ve,[ve]:We}))},me=async()=>{if(t)try{const ve={allergies:o.allergies||"",diagnosis:o.diagnosis||"",weight_kg:o.weight_kg!==""&&!Number.isNaN(Number(o.weight_kg))?Number(o.weight_kg):Re(o.weight_kg),height_cm:o.height_cm!==""&&!Number.isNaN(Number(o.height_cm))?Number(o.height_cm):Re(o.height_cm),blood_group:o.blood_group||"",bsa:o.bsa!==""&&!Number.isNaN(Number(o.bsa))?Number(o.bsa):Re(o.bsa),bmi:o.bmi!==""&&!Number.isNaN(Number(o.bmi))?Number(o.bmi):Re(o.bmi),diet_oral_fluid_per_day:o.diet_oral_fluid_per_day!==""&&!Number.isNaN(Number(o.diet_oral_fluid_per_day))?Number(o.diet_oral_fluid_per_day):Re(o.diet_oral_fluid_per_day),diet_salt_gm_per_day:o.diet_salt_gm_per_day!==""&&!Number.isNaN(Number(o.diet_salt_gm_per_day))?Number(o.diet_salt_gm_per_day):Re(o.diet_salt_gm_per_day),diet_calorie_per_day:o.diet_calorie_per_day!==""&&!Number.isNaN(Number(o.diet_calorie_per_day))?Number(o.diet_calorie_per_day):Re(o.diet_calorie_per_day),diet_protein_gm_per_day:o.diet_protein_gm_per_day!==""&&!Number.isNaN(Number(o.diet_protein_gm_per_day))?Number(o.diet_protein_gm_per_day):Re(o.diet_protein_gm_per_day),diet_remarks:o.diet_remarks||""};await JNe(t,ve),ae.success("Drug chart header details updated")}catch(ve){const Ge=jl(ve,"Failed to load medications");ae.error(Ge)}},Re=ve=>ve===""||ve==null?null:ve,Ze=ve=>Ge=>{const We=Ge.target.value;x(Ve=>({...Ve,[ve]:We}))},$e=async ve=>{if(ve.preventDefault(),!(!s||!t)){if(!m.fluid.trim()){ae.error("Please enter IV fluid");return}try{y(!0);const Ge={date:m.date||null,fluid:m.fluid.trim(),additive:m.additive||"",dose:m.dose||"",rate_ml_per_hr:m.rate_ml_per_hr&&!Number.isNaN(Number(m.rate_ml_per_hr))?Number(m.rate_ml_per_hr):null,start_time:m.start_time||null,stop_time:m.stop_time||null,remarks:m.remarks||""};await twe(t,Ge),x({date:"",fluid:"",additive:"",dose:"",rate_ml_per_hr:"",start_time:"",stop_time:"",remarks:""}),await Z(),ae.success("IV fluid order added")}catch(Ge){const We=jl(Ge,"Failed to load medications");ae.error(We)}finally{y(!1)}}},fe=async ve=>{if(!(!s||!window.confirm(`Remove IV fluid "${ve.fluid}"?`)))try{await swe(ve.id),await Z(),ae.success("IV fluid deleted")}catch(We){const Ve=jl(We,"Failed to load medications");ae.error(Ve)}},Me=ve=>Ge=>{const We=Ge.target.value;S(Ve=>({...Ve,[ve]:We}))},Ae=async ve=>{if(ve.preventDefault(),!(!s||!t)){if(!w.name.trim()){ae.error("Please enter nurse name");return}try{k(!0);const Ge={name:w.name.trim(),specimen:w.specimen||"",emp_no:w.emp_no||""};await rwe(t,Ge),S({name:"",specimen:"",emp_no:""}),await Y(),ae.success("Nurse row added")}catch(Ge){const We=jl(Ge,"Failed to load medications");ae.error(We)}finally{k(!1)}}},Ke=async ve=>{if(!(!s||!window.confirm(`Remove nurse "${ve.name}"?`)))try{await awe(ve.id),await Y(),ae.success("Nurse row deleted")}catch(We){const Ve=jl(We,"Failed to load medications");ae.error(Ve)}},Le=ve=>Ge=>{const We=Ge.target.value;O(Ve=>({...Ve,[ve]:We}))},He=async ve=>{if(ve.preventDefault(),!(!s||!t)){if(!P.date){ae.error("Please select date");return}try{T(!0);const Ge={date:P.date,remarks:P.remarks||""};await lwe(t,Ge),O({date:"",remarks:""}),await Q(),ae.success("Doctor's daily authorization added")}catch(Ge){const We=jl(Ge,"Failed to load medications");ae.error(We)}finally{T(!1)}}},pt=async ve=>{if(!(!s||!window.confirm(`Remove authorization entry for ${ne(ve.date)}?`)))try{await owe(ve.id),await Q(),ae.success("Authorization entry deleted")}catch(We){const Ve=jl(We,"Failed to load medications");ae.error(Ve)}},Pe=ve=>Ge=>{const We=Ge.target.value;ie(Ve=>({...Ve,[ve]:We}))},bt=()=>ie({drug_name:"",order_type:"regular",route:"iv",frequency:"bd",dose_value:"",dose_unit:"mg",start_date:"",end_date:"",duration_days:"",instructions:""}),It=async ve=>{if(ve.preventDefault(),!s||!t)return;const Ge=J.drug_name.trim();if(!Ge){ae.error("Please enter a drug name");return}const We=J.dose_value&&String(J.dose_value).trim()!==""?String(J.dose_value).trim():"",Ve=J.dose_value.trim()?Number(J.dose_value):null;if(J.dose_value&&Number.isNaN(Ve)){ae.error("Dose must be a number (e.g. 500)");return}const Fe=J.duration_days.trim()?Number(J.duration_days):null;if(J.duration_days&&(Number.isNaN(Fe)||!Number.isInteger(Fe))){ae.error("Duration must be whole days (e.g. 5)");return}const ot=J.start_date?`${J.start_date}T00:00:00`:null,ft=J.end_date?`${J.end_date}T00:00:00`:null,ce={drug_id:null,drug_name:Ge,order_type:J.order_type||"regular",route:J.route||"iv",frequency:J.frequency||"bd",dose:We,dose_unit:J.dose_unit||"",duration_days:Fe,start_datetime:ot,stop_datetime:ft,special_instructions:J.instructions||"",order_status:"active"};try{H(!0),await XNe(t,ce),ae.success("Medication order added"),bt(),await oe()}catch(Ce){const ze=jl(Ce,"Failed to add medication");ae.error(ze)}finally{H(!1)}},De=async ve=>{if(!(!s||(ve.order_status||"active")==="stopped"||!window.confirm(`Stop "${ve.drug_name}" for this admission?`)))try{const We=new Date().toISOString();await QNe(ve.id,{order_status:"stopped",stop_datetime:ve.stop_datetime||We}),ae.success("Medication stopped"),await oe()}catch(We){const Ve=jl(We,"Failed to load medications");ae.error(Ve)}},tt=async()=>{var ve,Ge;if(t)try{l(!0);const We=await cwe(t),Ve=new Blob([We.data],{type:"application/pdf"}),Fe=window.URL.createObjectURL(Ve),ot=document.createElement("a");ot.href=Fe,ot.download=`drug-chart-${t}.pdf`,document.body.appendChild(ot),ot.click(),ot.remove(),window.URL.revokeObjectURL(Fe)}catch(We){const Ve=((Ge=(ve=We==null?void 0:We.response)==null?void 0:ve.data)==null?void 0:Ge.detail)||"Failed to download drug chart PDF";ae.error(Ve)}finally{l(!1)}};return n.jsxs("div",{className:"space-y-4 text-sm text-slate-900",children:[n.jsxs("div",{className:"flex flex-col gap-2 rounded-2xl border bg-gradient-to-r from-sky-50 via-indigo-50 to-emerald-50 p-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("h2",{className:"text-xs font-semibold uppercase tracking-wide text-sky-900",children:"IPD Drug Chart  NABH Format"}),n.jsxs("p",{className:"text-[11px] text-slate-700 leading-snug",children:["This page captures the complete ",n.jsx("strong",{children:"inpatient medication and drug chart"})," ","as per NABH style: patient details, allergies, diagnosis, IV fluids, main drug grid with hours/sign, SOS & STAT orders, nurse signatures and daily doctor authorisation. All entries can be used for the ",n.jsx("strong",{children:"official Drug Chart PDF"}),"."]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:_e,className:"rounded-full border border-slate-300 bg-white px-3 py-1 text-[11px] text-slate-700 shadow-sm hover:bg-slate-50",disabled:r,children:r?"Refreshing":"Refresh"}),n.jsx("button",{type:"button",onClick:tt,className:"rounded-full border border-slate-300 bg-white px-3 py-1 text-[11px] font-semibold text-slate-800 shadow-sm hover:bg-slate-50",disabled:i,children:i?"Preparing PDF":"Download Drug Chart PDF"})]})]}),n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Patient details & clinical header"})}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Allergic to"}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. Penicillin, NSAIDs",value:o.allergies,onChange:xe("allergies"),disabled:!s})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Diagnosis"}),n.jsx("textarea",{className:"input min-h-[48px] text-sm",placeholder:"Primary / secondary diagnosis",value:o.diagnosis,onChange:xe("diagnosis"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Weight (kg)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.weight_kg,onChange:xe("weight_kg"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Height (cm)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.height_cm,onChange:xe("height_cm"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Blood group"}),n.jsx("input",{className:"input h-9 text-sm uppercase",placeholder:"e.g. B+",value:o.blood_group,onChange:xe("blood_group"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"BSA (m)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.bsa,onChange:xe("bsa"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"BMI (kg/m)"}),n.jsx("input",{className:"input h-9 text-sm bg-slate-50",value:o.bmi,readOnly:!0}),n.jsx("p",{className:"mt-1 text-[10px] text-slate-400",children:"Auto-calculated from weight & height."})]})]}),s&&n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{type:"button",onClick:me,className:"btn",children:"Save header"})})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Dietary advice (per day)"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Oral fluid (ml/day)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.diet_oral_fluid_per_day,onChange:xe("diet_oral_fluid_per_day"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Salt (gm/day)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.diet_salt_gm_per_day,onChange:xe("diet_salt_gm_per_day"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Calories (kcal/day)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.diet_calorie_per_day,onChange:xe("diet_calorie_per_day"),disabled:!s})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Protein (gm/day)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:o.diet_protein_gm_per_day,onChange:xe("diet_protein_gm_per_day"),disabled:!s})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Dietary remarks"}),n.jsx("textarea",{className:"input min-h-[48px] text-sm",placeholder:"Any additional diet advice / restrictions",value:o.diet_remarks,onChange:xe("diet_remarks"),disabled:!s})]}),s&&n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{type:"button",onClick:me,className:"rounded-full border border-slate-500 px-3 py-1 text-xs text-slate-700 hover:bg-slate-50",children:"Save diet"})})]})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Intravenous fluids"})}),s&&n.jsxs("form",{onSubmit:$e,className:"grid gap-2 md:grid-cols-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Date"}),n.jsx("input",{type:"date",className:"input h-9 text-sm",value:m.date,onChange:Ze("date")})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Fluid"}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. DNS 500 ml",value:m.fluid,onChange:Ze("fluid")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Additive (if any)"}),n.jsx("input",{className:"input h-9 text-sm",value:m.additive,onChange:Ze("additive")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Dose"}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. 1 amp",value:m.dose,onChange:Ze("dose")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Rate (ml/hr)"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"input h-9 text-sm",value:m.rate_ml_per_hr,onChange:Ze("rate_ml_per_hr")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Start time (hrs)"}),n.jsx("input",{type:"time",className:"input h-9 text-sm",value:m.start_time,onChange:Ze("start_time")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Stop time (hrs)"}),n.jsx("input",{type:"time",className:"input h-9 text-sm",value:m.stop_time,onChange:Ze("stop_time")})]}),n.jsxs("div",{className:"md:col-span-3",children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Remarks"}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"Doctor sign / notes",value:m.remarks,onChange:Ze("remarks")})]}),n.jsx("div",{className:"flex items-end justify-end",children:n.jsx("button",{type:"submit",className:"btn w-full md:w-auto",disabled:g,children:g?"Saving":"Add IV fluid"})})]}),n.jsx("div",{className:"overflow-auto rounded-xl border bg-slate-50",children:n.jsxs("table",{className:"w-full text-[11px] md:text-xs",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-100 text-slate-600",children:[n.jsx("th",{className:"px-2 py-2 text-left",children:"Date"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Fluid"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Additive"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Dose"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Rate (ml/hr)"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Start"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Stop"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Remarks"}),s&&n.jsx("th",{className:"px-2 py-2"})]})}),n.jsx("tbody",{children:d.length?d.map(ve=>n.jsxs("tr",{className:"border-t bg-white",children:[n.jsx("td",{className:"px-2 py-1",children:ne(ve.date)}),n.jsx("td",{className:"px-2 py-1",children:ve.fluid||""}),n.jsx("td",{className:"px-2 py-1",children:ve.additive||""}),n.jsx("td",{className:"px-2 py-1",children:ve.dose||""}),n.jsx("td",{className:"px-2 py-1",children:ve.rate_ml_per_hr!=null?ve.rate_ml_per_hr:""}),n.jsx("td",{className:"px-2 py-1",children:ve.start_time||""}),n.jsx("td",{className:"px-2 py-1",children:ve.stop_time||""}),n.jsx("td",{className:"px-2 py-1",children:ve.remarks||""}),s&&n.jsx("td",{className:"px-2 py-1 text-right",children:n.jsx("button",{type:"button",onClick:()=>fe(ve),className:"text-[10px] text-rose-600 underline hover:text-rose-700",children:"Remove"})})]},ve.id)):n.jsx("tr",{children:n.jsx("td",{className:"px-3 py-3 text-center text-[11px] text-slate-500",colSpan:s?9:8,children:"No IV fluids recorded."})})})]})})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Drug orders (Regular / SOS / STAT & Premed)"}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:()=>K(ve=>!ve),className:`rounded-full border px-3 py-1 text-[11px] ${$?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-slate-300 bg-white text-slate-600"}`,children:$?"Showing active only":"Showing all orders"}),n.jsxs("div",{className:"flex gap-1 rounded-full bg-slate-50 p-1 text-[11px]",children:[n.jsx("button",{type:"button",onClick:()=>se("all"),className:`rounded-full px-2 py-0.5 ${le==="all"?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:"All"}),N8.map(ve=>n.jsx("button",{type:"button",onClick:()=>se(ve.value),className:`rounded-full px-2 py-0.5 ${le===ve.value?"bg-white text-slate-900 shadow-sm":"text-slate-600"}`,children:ve.label},ve.value))]})]})]}),W&&n.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:W}),s&&n.jsxs("form",{onSubmit:It,className:"space-y-3 rounded-2xl border bg-slate-50 p-3 md:p-4",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-6",children:[n.jsxs("div",{className:"md:col-span-2",children:[n.jsxs("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:["Drug name ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. Tab. Paracetamol",value:J.drug_name,onChange:Pe("drug_name")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Order type"}),n.jsx("select",{className:"input h-9 text-sm",value:J.order_type,onChange:Pe("order_type"),children:N8.map(ve=>n.jsx("option",{value:ve.value,children:ve.label},ve.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Route"}),n.jsx("select",{className:"input h-9 text-sm",value:J.route,onChange:Pe("route"),children:VCe.map(ve=>n.jsx("option",{value:ve,children:ve.toUpperCase()},ve))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Frequency"}),n.jsx("select",{className:"input h-9 text-sm",value:J.frequency,onChange:Pe("frequency"),children:HCe.map(ve=>n.jsx("option",{value:ve,children:ve.toUpperCase()},ve))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Dose"}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx("input",{className:"input h-9 w-1/2 text-sm",type:"text",inputMode:"decimal",placeholder:"e.g. 500",value:J.dose_value,onChange:Pe("dose_value")}),n.jsx("select",{className:"input h-9 w-1/2 text-sm",value:J.dose_unit,onChange:Pe("dose_unit"),children:WCe.map(ve=>n.jsx("option",{value:ve,children:ve},ve))})]})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Start date"}),n.jsx("input",{type:"date",className:"input h-9 text-sm",value:J.start_date,onChange:Pe("start_date")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Planned end date"}),n.jsx("input",{type:"date",className:"input h-9 text-sm",value:J.end_date,onChange:Pe("end_date")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Duration (days)"}),n.jsx("input",{className:"input h-9 text-sm",type:"text",inputMode:"numeric",placeholder:"e.g. 5",value:J.duration_days,onChange:Pe("duration_days")})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Special instructions"}),n.jsx("textarea",{className:"input min-h-[48px] text-sm",placeholder:"e.g. Before food, monitor BP, tapering etc.",value:J.instructions,onChange:Pe("instructions")})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{type:"button",onClick:bt,className:"rounded-full border border-slate-500 px-3 py-1 text-xs text-slate-600 hover:bg-slate-50",children:"Clear"}),n.jsx("button",{type:"submit",className:"btn",disabled:G||!s,children:G?"Saving":"Add medication"})]})]}),n.jsx("div",{className:"overflow-auto rounded-2xl border bg-white",children:n.jsxs("table",{className:"w-full text-[11px] md:text-xs",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50 text-slate-500",children:[n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Type"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Drug"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Route"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Freq"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Dose"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Start"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"End"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Instructions"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Status"}),s&&n.jsx("th",{className:"px-2 py-2 md:px-3"})]})}),n.jsx("tbody",{children:te.length?te.map(ve=>n.jsxs("tr",{className:"border-t align-top text-slate-800",children:[n.jsx("td",{className:"px-2 py-2 md:px-3",children:ve.order_type==="sos"&&"SOS"||ve.order_type==="stat_premed"&&"STAT / Premed"||"Regular"}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:ve.drug_name||""}),n.jsx("td",{className:"px-2 py-2 uppercase md:px-3",children:ve.route||""}),n.jsx("td",{className:"px-2 py-2 uppercase md:px-3",children:ve.frequency||""}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:q(ve)}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:ne(ve.start_datetime)}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:ne(ve.stop_datetime)}),n.jsx("td",{className:"whitespace-pre-wrap px-2 py-2 md:px-3",children:ve.special_instructions||""}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:n.jsx("span",{className:ee(ve.order_status),children:ve.order_status||"active"})}),s&&n.jsx("td",{className:"px-2 py-2 text-right md:px-3",children:(ve.order_status||"active")!=="stopped"&&n.jsx("button",{type:"button",onClick:()=>De(ve),className:"text-[10px] text-rose-600 underline hover:text-rose-700",children:"Stop"})})]},ve.id)):n.jsx("tr",{children:n.jsx("td",{className:"px-3 py-3 text-center text-xs text-slate-500",colSpan:s?10:9,children:R?"Loading medication orders":"No medications recorded for this admission."})})})]})}),n.jsxs("p",{className:"text-[10px] text-slate-500",children:[n.jsx("strong",{children:"Note:"})," If medicines are not administered, indicate as"," ",n.jsx("strong",{children:"NOT GIVEN"})," in the drug chart and document the reason in nurses notes. Verbal orders should be clearly marked (e.g. 'V') and read-back practiced for all orders. Verbal orders are"," ",n.jsx("strong",{children:"not accepted for high-risk drugs"})," and must be signed by the ordering doctor within 24 hours."]})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Nurse signature register"}),s&&n.jsxs("form",{onSubmit:Ae,className:"grid gap-2 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Name of nurse"}),n.jsx("input",{className:"input h-9 text-sm",value:w.name,onChange:Me("name")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Specimen sign"}),n.jsx("input",{className:"input h-9 text-sm",value:w.specimen,onChange:Me("specimen")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Emp. no"}),n.jsx("input",{className:"input h-9 text-sm",value:w.emp_no,onChange:Me("emp_no")})]}),n.jsx("div",{className:"flex items-end justify-end",children:n.jsx("button",{type:"submit",className:"btn w-full md:w-auto",disabled:E,children:E?"Saving":"Add nurse"})})]}),n.jsx("div",{className:"overflow-auto rounded-xl border bg-slate-50",children:n.jsxs("table",{className:"w-full text-[11px] md:text-xs",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-100 text-slate-600",children:[n.jsx("th",{className:"px-2 py-2 text-left",children:"S. No"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Name"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Specimen sign"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Emp. no"}),s&&n.jsx("th",{className:"px-2 py-2"})]})}),n.jsx("tbody",{children:v.length?v.map((ve,Ge)=>n.jsxs("tr",{className:"border-t bg-white",children:[n.jsx("td",{className:"px-2 py-1",children:Ge+1}),n.jsx("td",{className:"px-2 py-1",children:ve.name||""}),n.jsx("td",{className:"px-2 py-1",children:ve.specimen||""}),n.jsx("td",{className:"px-2 py-1",children:ve.emp_no||""}),s&&n.jsx("td",{className:"px-2 py-1 text-right",children:n.jsx("button",{type:"button",onClick:()=>Ke(ve),className:"text-[10px] text-rose-600 underline hover:text-rose-700",children:"Remove"})})]},ve.id)):n.jsx("tr",{children:n.jsx("td",{className:"px-3 py-3 text-center text-xs text-slate-500",colSpan:s?5:4,children:"No nurse entries recorded."})})})]})})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Doctor's daily authorisation"}),s&&n.jsxs("form",{onSubmit:He,className:"grid gap-2 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Date"}),n.jsx("input",{type:"date",className:"input h-9 text-sm",value:P.date,onChange:Le("date")})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Remarks / authorisation notes"}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. continue same drug chart, modify doses etc.",value:P.remarks,onChange:Le("remarks")})]}),n.jsx("div",{className:"flex items-end justify-end",children:n.jsx("button",{type:"submit",className:"btn w-full md:w-auto",disabled:D,children:D?"Saving":"Add authorisation"})})]}),n.jsx("div",{className:"overflow-auto rounded-xl border bg-slate-50",children:n.jsxs("table",{className:"w-full text-[11px] md:text-xs",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-100 text-slate-600",children:[n.jsx("th",{className:"px-2 py-2 text-left",children:"Date"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Remarks"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Doctor"}),n.jsx("th",{className:"px-2 py-2 text-left",children:"Sign"}),s&&n.jsx("th",{className:"px-2 py-2"})]})}),n.jsx("tbody",{children:A.length?A.map(ve=>n.jsxs("tr",{className:"border-t bg-white",children:[n.jsx("td",{className:"px-2 py-1",children:ne(ve.date)}),n.jsx("td",{className:"px-2 py-1",children:ve.remarks||""}),n.jsx("td",{className:"px-2 py-1",children:ve.doctor_name||""}),n.jsx("td",{className:"px-2 py-1",children:ve.doctor_sign||""}),s&&n.jsx("td",{className:"px-2 py-1 text-right",children:n.jsx("button",{type:"button",onClick:()=>pt(ve),className:"text-[10px] text-rose-600 underline hover:text-rose-700",children:"Remove"})})]},ve.id)):n.jsx("tr",{children:n.jsx("td",{className:"px-3 py-3 text-center text-xs text-slate-500",colSpan:s?5:4,children:"No daily authorisation entries recorded."})})})]})})]})]})}function jl(t,s="Something went wrong"){var a,i;const r=(i=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:i.detail;if(!r)return s;if(typeof r=="string")return r;if(Array.isArray(r)){const l=r.map(o=>(o==null?void 0:o.msg)||(typeof o=="string"?o:"")).filter(Boolean);if(l.length)return l.join("; ")}return typeof r=="object"&&r.msg?r.msg:s}function GCe({admissionId:t,canWrite:s}){const[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState(""),[d,u]=p.useState(!1),[m,x]=p.useState({entry_type:"dressing",done_at:"",site:"",product:"",volume:"",notes:""}),g=async()=>{var S,E;if(t){l(!0),c("");try{const{data:k}=await vwe(t);a(k||[])}catch(k){c(((E=(S=k==null?void 0:k.response)==null?void 0:S.data)==null?void 0:E.detail)||"Failed to load dressing / transfusion entries")}finally{l(!1)}}};p.useEffect(()=>{g()},[t]);const y=S=>S?S.length===16?`${S}:00`:S:null,v=S=>E=>{const k=E.target.value;x(A=>({...A,[S]:k}))},j=async S=>{var E,k;if(S.preventDefault(),!(!s||!t)){if(!m.entry_type){alert("Please select type (Dressing / Transfusion)");return}u(!0);try{const A={entry_type:m.entry_type||"dressing",done_at:y(m.done_at)||new Date().toISOString(),site:m.site||"",product:m.entry_type==="transfusion"&&m.product||"",volume:m.entry_type==="transfusion"&&m.volume||"",notes:m.notes||""};await ywe(t,A),x(I=>({entry_type:I.entry_type,done_at:"",site:"",product:"",volume:"",notes:""})),await g()}catch(A){alert(((k=(E=A==null?void 0:A.response)==null?void 0:E.data)==null?void 0:k.detail)||"Failed to save entry")}finally{u(!1)}}},w=m.entry_type==="transfusion";return n.jsxs("div",{className:"space-y-4 text-sm text-black",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"font-semibold",children:"Dressing / Transfusion"}),i&&n.jsx("span",{className:"text-[11px] text-gray-500",children:"Loading entries"})]}),o&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:o}),s&&n.jsxs("form",{onSubmit:j,className:"rounded-xl border bg-gray-50 p-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Type"}),n.jsxs("select",{className:"input",value:m.entry_type,onChange:v("entry_type"),children:[n.jsx("option",{value:"dressing",children:"Dressing"}),n.jsx("option",{value:"transfusion",children:"Transfusion"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Date & time"}),n.jsx("input",{type:"datetime-local",className:"input",value:m.done_at,onChange:v("done_at")})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Site"}),n.jsx("input",{className:"input",placeholder:w?"e.g. IV line / central line":"e.g. abdominal wound",value:m.site,onChange:v("site")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Product / bag"}),n.jsx("input",{className:"input",placeholder:"e.g. PRBC, FFP",value:m.product,onChange:v("product"),disabled:!w})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:"Volume"}),n.jsx("input",{className:"input",placeholder:"e.g. 1 unit / 300 ml",value:m.volume,onChange:v("volume"),disabled:!w})]})]}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:w?"Notes (vitals, reaction, transfusion details)":"Notes (wound status, exudate, dressing type)",value:m.notes,onChange:v("notes")}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",disabled:d,children:d?"Saving":"Save entry"})})]}),n.jsx("div",{className:"rounded-xl border bg-white overflow-auto",children:n.jsxs("table",{className:"w-full text-xs md:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-gray-50 text-gray-500 text-[11px] md:text-xs",children:[n.jsx("th",{className:"px-2 md:px-3 py-2 text-left",children:"When"}),n.jsx("th",{className:"px-2 md:px-3 py-2 text-left",children:"Type"}),n.jsx("th",{className:"px-2 md:px-3 py-2 text-left",children:"Site"}),n.jsx("th",{className:"px-2 md:px-3 py-2 text-left",children:"Product"}),n.jsx("th",{className:"px-2 md:px-3 py-2 text-left",children:"Volume"}),n.jsx("th",{className:"px-2 md:px-3 py-2 text-left",children:"Notes"})]})}),n.jsxs("tbody",{children:[r.map(S=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-2 md:px-3 py-2 align-top",children:S.done_at?new Date(S.done_at).toLocaleString():""}),n.jsx("td",{className:"px-2 md:px-3 py-2 align-top capitalize",children:S.entry_type||""}),n.jsx("td",{className:"px-2 md:px-3 py-2 align-top",children:S.site||""}),n.jsx("td",{className:"px-2 md:px-3 py-2 align-top",children:S.product||(S.entry_type==="transfusion"?"":"")}),n.jsx("td",{className:"px-2 md:px-3 py-2 align-top",children:S.volume||(S.entry_type==="transfusion"?"":"")}),n.jsx("td",{className:"px-2 md:px-3 py-2 align-top whitespace-pre-wrap",children:S.notes||""})]},S.id)),!r.length&&!i&&n.jsx("tr",{children:n.jsx("td",{className:"px-3 py-3 text-gray-500 text-xs",colSpan:6,children:"No dressing / transfusion entries yet."})})]})]})})]})}const KCe=["mg","g","ml","units","drops","puff","tab","cap","sachet"],YCe=["OD","BD","TDS","QID","HS","SOS","PRN"],XCe=[3,5,7,10,14];function QCe({admissionId:t,canWrite:s=!0}){const[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState(""),[d,u]=p.useState({drugName:"",doseValue:"",doseUnit:"mg",frequency:"",durationDays:"",instructions:""}),[m,x]=p.useState(!1),g=p.useMemo(()=>Array.isArray(r)&&r.length>0,[r]),y=async()=>{var I,P;if(t){l(!0),c("");try{const{data:O}=await fG(t);console.log("======================================================"),console.log(t,"dcbjdbgjdsbcjbsd"),console.log(O,"data"),console.log("======================================================"),a(Array.isArray(O)?O:[])}catch(O){const D=((P=(I=O==null?void 0:O.response)==null?void 0:I.data)==null?void 0:P.detail)||"Failed to load discharge medicines";c(D),ae.error(D)}finally{l(!1)}}};p.useEffect(()=>{y()},[t]);const v=I=>P=>{const O=P.target.value;u(D=>({...D,[I]:O}))},j=I=>{u(P=>({...P,frequency:I}))},w=I=>{u(P=>({...P,durationDays:String(I)}))},S=()=>u({drugName:"",doseValue:"",doseUnit:"mg",frequency:"",durationDays:"",instructions:""}),E=async I=>{var B,U;if(I.preventDefault(),!s||!t)return;const P=d.drugName.trim();if(!P){ae.error("Please enter a drug name");return}const O=d.doseValue.trim()?Number(d.doseValue):null;if(d.doseValue&&Number.isNaN(O)){ae.error("Dose must be a number (e.g. 500)");return}const D=d.durationDays.trim()?Number(d.durationDays):null;if(d.durationDays&&(Number.isNaN(D)||!Number.isInteger(D))){ae.error("Duration must be a whole number of days");return}const T={drug_name:P,dose:O,dose_unit:d.doseUnit||"",route:"",frequency:d.frequency.trim(),duration_days:D,advice_text:d.instructions.trim()};try{x(!0),await xwe(t,T),ae.success("Discharge medicine added"),S(),await y()}catch(W){const V=((U=(B=W==null?void 0:W.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to save discharge medicine";ae.error(V)}finally{x(!1)}},k=I=>I.dose==null&&!I.dose_unit?"":I.dose==null?I.dose_unit||"":`${I.dose} ${I.dose_unit||""}`.trim(),A=I=>I.duration_days==null?"":I.duration_days===0?"0 days":`${I.duration_days} days`;return n.jsxs("div",{className:"space-y-4 text-sm text-slate-900",children:[n.jsxs("div",{className:"flex flex-col gap-2 rounded-2xl border bg-gradient-to-r from-sky-50 via-indigo-50 to-emerald-50 p-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xs font-semibold uppercase tracking-wide text-sky-900",children:"Discharge Medications"}),n.jsx("p",{className:"text-[11px] text-slate-600",children:"Define clear post-discharge prescriptions. These lines can be merged into the discharge summary PDF."})]}),g&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Total medicines:"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:r.length})]})]}),o&&n.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:o}),s&&n.jsxs("form",{onSubmit:E,className:"space-y-3 rounded-2xl border bg-white p-3 shadow-sm md:p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-800",children:"Add / edit discharge prescription line"}),m&&n.jsx("div",{className:"text-[11px] text-slate-500",children:"Saving"})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs("div",{className:"md:col-span-2",children:[n.jsxs("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:["Drug / formulation ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. Tab. Paracetamol",value:d.drugName,onChange:v("drugName")}),n.jsx("p",{className:"mt-1 text-[10px] text-slate-400",children:"Include form (tab / cap / syrup) for clarity."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Dose"}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx("input",{className:"input h-9 w-1/2 text-sm",type:"text",inputMode:"decimal",placeholder:"e.g. 500",value:d.doseValue,onChange:v("doseValue")}),n.jsx("select",{className:"input h-9 w-1/2 text-sm",value:d.doseUnit,onChange:v("doseUnit"),children:KCe.map(I=>n.jsx("option",{value:I,children:I},I))})]}),n.jsx("p",{className:"mt-1 text-[10px] text-slate-400",children:"Number in dose box, unit separately (mg / ml / units)."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Frequency"}),n.jsx("input",{className:"input h-9 text-sm",placeholder:"e.g. BD, TDS, HS",value:d.frequency,onChange:v("frequency")}),n.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:YCe.map(I=>n.jsx("button",{type:"button",onClick:()=>j(I),className:"rounded-full border border-slate-500 px-2 py-[1px] text-[10px] text-slate-600 hover:bg-slate-100",children:I},I))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Duration (days)"}),n.jsx("input",{className:"input h-9 text-sm",type:"text",inputMode:"numeric",placeholder:"e.g. 5",value:d.durationDays,onChange:v("durationDays")}),n.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:XCe.map(I=>n.jsxs("button",{type:"button",onClick:()=>w(I),className:"rounded-full border border-slate-500 px-2 py-[1px] text-[10px] text-slate-600 hover:bg-slate-100",children:[I,"d"]},I))})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-[11px] font-medium text-slate-600",children:"Instructions"}),n.jsx("textarea",{className:"input min-h-[60px] text-sm",placeholder:"e.g. After food; stop if rash / vomiting; avoid alcohol",value:d.instructions,onChange:v("instructions")})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{type:"button",onClick:S,className:"rounded-full border border-slate-500 px-3 py-1 text-xs text-slate-600 hover:bg-slate-50",children:"Clear"}),n.jsx("button",{type:"submit",className:"btn",disabled:m||!s,children:m?"Saving":"Add discharge med"})]})]}),n.jsx("div",{className:"overflow-auto rounded-2xl border bg-white shadow-sm",children:n.jsxs("table",{className:"w-full text-xs md:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50 text-[11px] text-slate-500 md:text-xs",children:[n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Drug"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Dose"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Frequency"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Duration"}),n.jsx("th",{className:"px-2 py-2 text-left md:px-3",children:"Instructions"})]})}),n.jsx("tbody",{children:g?r.map(I=>n.jsxs("tr",{className:"border-t text-slate-800",children:[n.jsx("td",{className:"px-2 py-2 md:px-3",children:I.drug_name||""}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:k(I)}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:I.frequency||""}),n.jsx("td",{className:"px-2 py-2 md:px-3",children:A(I)}),n.jsx("td",{className:"whitespace-pre-wrap px-2 py-2 md:px-3",children:I.advice_text||""})]},I.id)):n.jsx("tr",{children:n.jsx("td",{className:"px-3 py-3 text-center text-xs text-slate-500",colSpan:5,children:i?"Loading discharge medicines":"No discharge medicines added yet."})})})]})})]})}function ZCe({admissionId:t,canWrite:s}){const[r,a]=p.useState(null),[i,l]=p.useState(!1),[o,c]=p.useState(""),[d,u]=p.useState({rating_nursing:5,rating_doctor:5,rating_cleanliness:5,comments:"",suggestions:""}),m=async()=>{var v,j,w;if(t){l(!0),c("");try{const{data:S}=await fwe(t);a(S||null),S&&u({rating_nursing:S.rating_nursing??5,rating_doctor:S.rating_doctor??5,rating_cleanliness:S.rating_cleanliness??5,comments:S.comments||"",suggestions:S.suggestions||""})}catch(S){const E=(v=S==null?void 0:S.response)==null?void 0:v.status;E&&E!==404&&c(((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to load feedback")}finally{l(!1)}}};p.useEffect(()=>{m()},[t]);const x=async v=>{var j,w;if(v.preventDefault(),!(!s||!t))try{const S={rating_nursing:Number(d.rating_nursing)||0,rating_doctor:Number(d.rating_doctor)||0,rating_cleanliness:Number(d.rating_cleanliness)||0,comments:d.comments||"",suggestions:d.suggestions||""},{data:E}=await gwe(t,S);a(E||S),alert("Feedback saved")}catch(S){alert(((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to save feedback")}},g=({label:v,value:j,onChange:w,disabled:S})=>n.jsxs("div",{children:[n.jsx("label",{className:"text-xs text-gray-500",children:v}),n.jsx("select",{className:"input",value:j,disabled:S,onChange:E=>w(Number(E.target.value)),children:[1,2,3,4,5].map(E=>n.jsxs("option",{value:E,children:[E," / 5"]},E))})]}),y=!s;return n.jsxs("div",{className:"space-y-4 text-sm text-black",children:[n.jsx("h2",{className:"font-semibold",children:"Patient Feedback"}),n.jsx("p",{className:"text-xs text-gray-600",children:"Capture patient or attendant feedback for this admission (NABH requirement  patient satisfaction)."}),i&&n.jsx("div",{className:"text-xs text-gray-500",children:"Loading"}),o&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:o}),n.jsxs("form",{onSubmit:x,className:"rounded-xl border bg-gray-50 p-3 space-y-3",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsx(g,{label:"Nursing care",value:d.rating_nursing,disabled:y,onChange:v=>u(j=>({...j,rating_nursing:v}))}),n.jsx(g,{label:"Doctor communication",value:d.rating_doctor,disabled:y,onChange:v=>u(j=>({...j,rating_doctor:v}))}),n.jsx(g,{label:"Cleanliness / facilities",value:d.rating_cleanliness,disabled:y,onChange:v=>u(j=>({...j,rating_cleanliness:v}))})]}),n.jsx("textarea",{className:"input min-h-[80px]",placeholder:"Comments",value:d.comments,disabled:y,onChange:v=>u(j=>({...j,comments:v.target.value}))}),n.jsx("textarea",{className:"input min-h-[60px]",placeholder:"Suggestions for improvement",value:d.suggestions,disabled:y,onChange:v=>u(j=>({...j,suggestions:v.target.value}))}),s&&n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{className:"btn",children:"Save feedback"})})]}),r&&n.jsxs("div",{className:"rounded-xl border bg-white p-3 text-xs text-gray-700",children:[n.jsx("div",{className:"font-semibold mb-1",children:"Snapshot"}),n.jsxs("div",{children:["Nursing care: ",n.jsxs("b",{children:[r.rating_nursing,"/5"]}),", Doctor:"," ",n.jsxs("b",{children:[r.rating_doctor,"/5"]}),", Cleanliness:"," ",n.jsxs("b",{children:[r.rating_cleanliness,"/5"]})]}),r.comments&&n.jsxs("div",{className:"mt-1",children:[n.jsx("span",{className:"font-semibold",children:"Comments:"})," ",r.comments]}),r.suggestions&&n.jsxs("div",{className:"mt-1",children:[n.jsx("span",{className:"font-semibold",children:"Suggestions:"})," ",r.suggestions]})]})]})}function JCe({admission:t,beds:s,canWrite:r,onTransfer:a}){const i=(t==null?void 0:t.current_bed_id)&&s.find(l=>l.id===t.current_bed_id);return n.jsxs("div",{className:"space-y-4 text-sm text-slate-900",children:[n.jsxs("div",{className:"flex flex-col gap-1 rounded-2xl border bg-gradient-to-r from-sky-50 via-slate-50 to-emerald-50 p-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xs font-semibold uppercase tracking-wide text-sky-900",children:"Bed / Transfer"}),n.jsx("p",{className:"text-[11px] text-slate-600",children:"View current bed and transfer the patient to another available bed with proper tracking. This action affects IPD bed occupancy and billing."})]}),i?n.jsxs("div",{className:"text-[11px] text-slate-600",children:["Current bed:"," ",n.jsx("span",{className:"font-semibold text-slate-900",children:i.code}),i.ward_name&&n.jsxs("span",{className:"ml-1 text-slate-500",children:["(",i.ward_name,")"]})]}):n.jsx("div",{className:"text-[11px] text-slate-500",children:"No active bed mapped for this admission."})]}),n.jsxs("div",{className:"rounded-2xl border bg-white p-3 shadow-sm md:p-4",children:[n.jsx("div",{className:"mb-2 text-xs font-semibold text-slate-800",children:"Transfer to another bed"}),!r&&n.jsx("div",{className:"mb-3 rounded-lg border border-amber-100 bg-amber-50 px-3 py-2 text-[11px] text-amber-700",children:"You have view-only access. Contact an IPD incharge / Admin to perform transfers."}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-[minmax(0,320px)_1fr]",children:[n.jsx("div",{children:n.jsx(wG,{value:"",onChange:l=>{!r||!l||a(l)}})}),n.jsx("div",{className:"text-[11px] text-slate-500",children:n.jsxs("ul",{className:"list-disc space-y-1 pl-4",children:[n.jsx("li",{children:"Only vacant beds can be selected for transfer."}),n.jsx("li",{children:"Bed transfer will automatically update bed occupancy and subsequent bed charges."}),n.jsx("li",{children:"Ensure the new bed type is clinically appropriate for the patient's condition (ICU / HDU / Ward etc.)."})]})})]})]})]})}const w8=[{key:"nursing",label:"Nursing Notes",el:nCe,writePerm:"ipd.nursing"},{key:"vitals",label:"Vitals",el:rCe,writePerm:"ipd.nursing"},{key:"io",label:"Intake/Output",el:aCe,writePerm:"ipd.nursing"},{key:"assessments",label:"Assessments",el:UCe,writePerm:"ipd.nursing"},{key:"medications",label:"Medications / Drug Chart",el:qCe,writePerm:"ipd.doctor"},{key:"dressing",label:"Dressing / Transfusion",el:GCe,writePerm:"ipd.nursing"},{key:"discharge-meds",label:"Discharge Meds",el:QCe,writePerm:"ipd.doctor"},{key:"bed-transfer",label:"Bed / Transfer",el:JCe,writePerm:"ipd.manage"},{key:"referrals",label:"Referrals",el:lCe,writePerm:"ipd.manage"},{key:"discharge",label:"Discharge Summary",el:oCe,writePerm:"ipd.manage"},{key:"charges",label:"Bed Charges",el:cCe,writePerm:"ipd.manage"},{key:"feedback",label:"Feedback",el:ZCe,writePerm:"ipd.manage"}];function eke(){var W;const{id:t}=Cm(),s=pi(),r=((W=s==null?void 0:s.state)==null?void 0:W.admission)||null,[a,i]=p.useState(r),[l,o]=p.useState([]),[c,d]=p.useState("nursing"),[u,m]=p.useState(""),[x,g]=p.useState(!1),[y,v]=p.useState(null),j=ct("ipd.view"),w=ct("ipd.manage"),S=ct("ipd.nursing"),E=ct("ipd.doctor"),k={"ipd.nursing":S,"ipd.doctor":E,"ipd.manage":w},A=V=>`ADM-${String(V).padStart(6,"0")}`,I=async()=>{var V,R,F;g(!0),m("");try{const[{data:G},H]=await Promise.all([pG(Number(t)),Eo()]),$=G||r||null;if(i($),o(H.data||[]),$!=null&&$.patient_id)try{const{data:K}=await P2($.patient_id);v(K)}catch{}}catch(G){((G==null?void 0:G.status)||((V=G==null?void 0:G.response)==null?void 0:V.status))===404&&r?i(r):m(((F=(R=G==null?void 0:G.response)==null?void 0:R.data)==null?void 0:F.detail)||"Failed to load admission details")}finally{g(!1)}};p.useEffect(()=>{I()},[t]);const P=async()=>{var V,R;if(a&&window.confirm("Are you sure you want to cancel this admission? This will mark the admission as cancelled."))try{await TNe(a.id),window.location.assign("/ipd/tracking")}catch(F){m(((R=(V=F==null?void 0:F.response)==null?void 0:V.data)==null?void 0:R.detail)||"Cancel failed")}},O=async V=>{var R,F;if(!(!a||!V))try{await PNe(a.id,{to_bed_id:Number(V),reason:"Transfer"}),await I()}catch(G){m(((F=(R=G==null?void 0:G.response)==null?void 0:R.data)==null?void 0:F.detail)||"Transfer failed")}};if(!j&&!w)return n.jsx("div",{className:"p-4 text-sm text-rose-700",children:"Access denied (need ipd.view)."});if(x&&!a)return n.jsx("div",{className:"p-4 text-sm",children:"Loading"});if(!a)return n.jsx("div",{className:"p-4 text-sm",children:"No data"});const D=a.current_bed_id&&l.find(V=>V.id===a.current_bed_id),T=a.ip_number||a.ipNo||null,B=(D==null?void 0:D.code)||null,U=()=>n.jsxs("div",{className:"grid gap-3 rounded-2xl border bg-white p-3 text-xs text-slate-800 md:grid-cols-4 md:p-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:"Admission"}),n.jsx("div",{className:"font-semibold text-slate-900",children:A(a.id)}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Admitted on:"," ",a.admitted_at?new Date(a.admitted_at).toLocaleString():""]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:"Patient"}),n.jsx("div",{className:"font-semibold text-slate-900",children:(y==null?void 0:y.full_name)||(y==null?void 0:y.name)||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID:"," ",n.jsx("span",{className:"font-medium",children:(y==null?void 0:y.uhid)||`P-${a.patient_id}`})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:"Bed / Ward"}),n.jsx("div",{className:"font-semibold text-slate-900",children:(D==null?void 0:D.code)||""}),(D==null?void 0:D.ward_name)&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Ward: ",D.ward_name]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:"Status"}),n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-[11px] font-medium capitalize text-slate-800",children:[n.jsx("span",{className:a.status==="active"?"h-2 w-2 rounded-full bg-emerald-500":"h-2 w-2 rounded-full bg-slate-400"}),a.status||""]}),a.practitioner_name&&n.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["Primary doctor:"," ",n.jsx("span",{className:"font-medium",children:a.practitioner_name})]})]})]});return n.jsxs("div",{className:"space-y-4 p-3 md:p-4",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-base font-semibold text-slate-900 md:text-lg",children:"IPD Admission  Patient Tracking"}),n.jsx("p",{className:"text-xs text-slate-500 md:text-[13px]",children:"View and manage all in-patient clinical documentation for this admission  nursing notes, vitals, drug chart, handovers, discharge summary and more."})]}),n.jsx("div",{className:"flex flex-wrap items-center gap-2",children:w&&n.jsx("button",{type:"button",onClick:P,className:"rounded-full bg-rose-600 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-rose-700",children:"Cancel Admission"})})]}),u&&n.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700 md:text-sm",children:u}),n.jsx(U,{}),n.jsx(PK,{patient:y,contextType:"ipd",contextId:a.id,ipNumber:T,bedLabel:B}),n.jsx("div",{className:"rounded-2xl border bg-white shadow-sm",children:n.jsxs(Do,{value:c,onValueChange:d,className:"w-full",children:[n.jsx("div",{className:"border-b px-2 py-2 md:px-3",children:n.jsx(Wl,{className:"h-auto flex flex-wrap gap-1 bg-transparent p-0 md:gap-2",children:w8.map(V=>{const R=k[V.writePerm]??!1;return n.jsxs(zs,{value:V.key,className:"rounded-full px-3 py-1 text-[11px] text-slate-700 data-[state=active]:bg-slate-900 data-[state=active]:text-white md:text-xs",children:[V.label,!R&&n.jsx("span",{className:"ml-2 rounded-full bg-slate-200 px-1.5 py-[1px] text-[9px] uppercase tracking-wide text-slate-700",children:"view"})]},V.key)})})}),n.jsx("div",{className:"p-2 md:p-3",children:w8.map(V=>{const R=V.el,F=k[V.writePerm]??!1;return n.jsx(Ls,{value:V.key,className:"mt-2",children:n.jsx(R,{admissionId:a.id,admission:a,patient:y,canWrite:F,beds:l,onTransfer:O})},V.key)})})]})})]})}const k1=10;function Ad(...t){return t.filter(Boolean).join(" ")}const Vi={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1.5 text-[11px] font-semibold text-slate-700 hover:bg-black/[0.03] active:scale-[0.99] transition disabled:opacity-60",input:"h-11 w-full rounded-2xl border border-black/50 bg-white/85 px-3 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-100 focus:border-sky-500"};function _8(t){if(!t)return"";try{return new Date(t).toLocaleString("en-IN")}catch{return String(t)}}function tke(t){if(!t)return"";try{return t.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})}catch{return""}}const qC=t=>{const s=(t==null?void 0:t.display_code)||(t==null?void 0:t.admission_code)||(t==null?void 0:t.admission_no)||(t==null?void 0:t.ipd_no)||(t==null?void 0:t.ip_uhid);if(s)return String(s);const r=t==null?void 0:t.id;return r==null?"":`ADM-${String(r).padStart(6,"0")}`};function S8(t){return t?t==="vacant"?"border-emerald-200 bg-emerald-50 text-emerald-800":t==="occupied"?"border-rose-200 bg-rose-50 text-rose-800":t==="reserved"?"border-amber-200 bg-amber-50 text-amber-900":t==="preoccupied"?"border-sky-200 bg-sky-50 text-sky-900":"border-slate-500 bg-slate-50 text-slate-700":"border-slate-500 bg-slate-50 text-slate-700"}function A1({label:t,value:s,icon:r,tone:a="slate"}){const i=a==="dark"?"bg-slate-900 text-white border-slate-900":a==="emerald"?"bg-emerald-50 text-emerald-900 border-emerald-200":a==="amber"?"bg-amber-50 text-amber-900 border-amber-200":a==="rose"?"bg-rose-50 text-rose-900 border-rose-200":a==="sky"?"bg-sky-50 text-sky-900 border-sky-200":"bg-white/80 text-slate-900 border-black/50";return n.jsx("div",{className:Ad("rounded-3xl border px-4 py-3",i),children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-[20px] font-semibold tracking-tight tabular-nums",children:s})]}),r?n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/30",children:n.jsx(r,{className:"h-5 w-5 opacity-80"})}):null]})})}const ske=[{key:"all",label:"All"},{key:"occupied",label:"Occupied"},{key:"reserved",label:"Reserved"},{key:"vacant",label:"Vacant"},{key:"preoccupied",label:"Pre-occupied"}];function nke({value:t,onChange:s}){return n.jsx("div",{className:"flex items-center gap-1.5 overflow-auto no-scrollbar py-1",children:ske.map(r=>{const a=t===r.key;return n.jsx("button",{type:"button",onClick:()=>s(r.key),className:Ad("whitespace-nowrap rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",a?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:r.label},r.key)})})}function rke(){const[t,s]=p.useState([]),[r,a]=p.useState({}),[i,l]=p.useState({}),[o,c]=p.useState(!1),[d,u]=p.useState(!1),[m,x]=p.useState(""),[g,y]=p.useState(""),[v,j]=p.useState("all"),[w,S]=p.useState(1),[E,k]=p.useState(null),[A,I]=p.useState(!1),P=p.useRef(!0),O=se=>{const J={};for(const ie of se||[])J[ie.id]=ie;return J},D=p.useCallback(async({silent:se=!1}={})=>{var J,ie;se?u(!0):c(!0),x("");try{const[te,ne]=await Promise.all([T2({status:"admitted"}),Eo()]);let q=te.data||[];const ee=ne.data||[];if(q=[...q].sort((X,Z)=>new Date(Z.admitted_at||0)-new Date(X.admitted_at||0)),!P.current)return;s(q),a(O(ee)),k(new Date),S(1)}catch(te){if(console.error("TrackingAdmissions loadData error",te),!P.current)return;x(((ie=(J=te==null?void 0:te.response)==null?void 0:J.data)==null?void 0:ie.detail)||"Failed to load active admissions. Please try again."),s([]),a({})}finally{if(!P.current)return;c(!1),u(!1)}},[]);p.useEffect(()=>(P.current=!0,D(),()=>{P.current=!1}),[D]),p.useEffect(()=>{if(!A)return;const se=setInterval(()=>D({silent:!0}),15e3);return()=>clearInterval(se)},[A,D]);const T=p.useMemo(()=>{const se=g.trim().toLowerCase();let J=t;return v!=="all"&&(J=J.filter(ie=>{const te=r[ie.current_bed_id];return((te==null?void 0:te.state)||"")===v})),se?J.filter(ie=>{var ee;const te=qC(ie).toLowerCase(),ne=(i[ie.patient_id]||`P-${ie.patient_id}`).toLowerCase(),q=(((ee=r[ie.current_bed_id])==null?void 0:ee.code)||"").toLowerCase();return te.includes(se)||ne.includes(se)||q.includes(se)}):J},[t,g,i,r,v]),B=Math.max(1,Math.ceil(T.length/k1)),U=(w-1)*k1,W=T.slice(U,U+k1);p.useEffect(()=>{S(1)},[g,v]);const V=()=>S(se=>Math.max(1,se-1)),R=()=>S(se=>Math.min(B,se+1)),F=w<=1||o,G=w>=B||o,H=p.useCallback(async se=>{const ie=[...new Set(se)].filter(Boolean).filter(ne=>!i[ne]);if(ie.length===0)return;const te={};await Promise.all(ie.map(async ne=>{try{const{data:q}=await P2(ne);te[ne]=(q==null?void 0:q.uhid)||`P-${ne}`}catch{te[ne]=`P-${ne}`}})),P.current&&l(ne=>({...ne,...te}))},[i]);p.useEffect(()=>{const se=W.map(J=>J.patient_id);se.length&&H(se)},[W,H]);const $=p.useMemo(()=>{var q;let se=0,J=0,ie=0,te=0,ne=0;for(const ee of t){const X=(q=r[ee.current_bed_id])==null?void 0:q.state;X==="occupied"?se+=1:X==="reserved"?J+=1:X==="vacant"?ie+=1:X==="preoccupied"?te+=1:ne+=1}return{total:t.length,occupied:se,reserved:J,vacant:ie,preoccupied:te,unknown:ne}},[t,r]),K=t.length===0?0:U+1,le=Math.min(U+k1,T.length);return n.jsx("div",{className:Vi.page,children:n.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 space-y-4 md:px-8",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:Ad(Vi.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.16),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-sky-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-sky-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-sky-700",children:"Live IPD Tracking"})]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(cn,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"Tracking Admissions"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Monitor currently admitted patients with bed position and quick open to nursing / vitals / orders."}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Vi.chip,children:[n.jsx(or,{className:"h-3.5 w-3.5"}),"Active ",n.jsx("span",{className:"ml-1 tabular-nums",children:$.total})]}),n.jsxs("span",{className:Vi.chip,children:[n.jsx(Qs,{className:"h-3.5 w-3.5"}),"Occupied ",n.jsx("span",{className:"ml-1 tabular-nums",children:$.occupied})]}),n.jsxs("button",{type:"button",className:Ad(Vi.chipBtn,A&&"bg-slate-900 text-white border-slate-900 hover:bg-slate-800"),onClick:()=>I(se=>!se),title:"Auto refresh every 15s",children:[n.jsx(Qs,{className:"h-4 w-4"}),"Auto refresh"]}),E&&n.jsxs("span",{className:Vi.chip,children:[n.jsx(Na,{className:"h-3.5 w-3.5"}),"Synced ",n.jsx("span",{className:"ml-1 tabular-nums",children:tke(E)})]}),d&&n.jsxs("span",{className:Vi.chip,children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}),"Syncing"]})]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:()=>D(),className:Vi.chipBtn,disabled:o,title:"Refresh",children:[n.jsx(ps,{className:Ad("h-4 w-4",(o||d)&&"animate-spin")}),"Refresh"]}),n.jsxs("span",{className:Vi.chip,children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:T.length})]})]})]}),n.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[n.jsx(A1,{label:"Active admissions",value:$.total,icon:or,tone:"dark"}),n.jsx(A1,{label:"Occupied beds",value:$.occupied,icon:cn,tone:"rose"}),n.jsx(A1,{label:"Reserved beds",value:$.reserved,icon:Vs,tone:"amber"}),n.jsx(A1,{label:"Unknown bed state",value:$.unknown,icon:Vs,tone:"sky"})]})]})]}),n.jsxs(dt,{className:Ad(Vi.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsx("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:n.jsxs("div",{className:"grid w-full gap-3 md:grid-cols-[2fr,1.2fr]",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Active Admissions"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Search by IP admission code, UHID, or bed code. Filter by bed state."}),n.jsxs("div",{className:"mt-3 relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{className:Ad(Vi.input,"pl-10"),placeholder:"Search IP code / UHID / Bed",value:g,onChange:se=>y(se.target.value)})]}),n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:["Tip: Type an IP code like ",n.jsx("span",{className:"font-semibold",children:"NHIP16122025000001"})," or a bed code like"," ",n.jsx("span",{className:"font-semibold",children:"W2-R1-B03"}),"."]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Range"}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:[T.length===0?"0":`${K}-${le}`," / ",T.length]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"h-11 rounded-2xl border-black/50 bg-white/85 font-semibold w-full",onClick:()=>{y(""),j("all")},disabled:o,children:"Clear"}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold w-full",onClick:()=>D(),disabled:o,children:[o?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(ps,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]})]})}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Bed state"}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:["Page ",n.jsx("span",{className:"ml-1 tabular-nums",children:w})," / ",B]})]}),n.jsx(nke,{value:v,onChange:j})]})}),n.jsxs(it,{className:"pt-4",children:[m&&n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-3xl border border-rose-200 bg-rose-50 px-4 py-3 text-[12px] text-rose-800",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:m})]}),o&&n.jsx("div",{className:"space-y-2",children:[0,1,2,3].map(se=>n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-40 rounded-xl"}),n.jsx(Qe,{className:"h-3 w-72 rounded-xl"})]}),n.jsx(Qe,{className:"h-10 w-24 rounded-2xl"})]})},se))}),!o&&W.length===0&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"mx-auto mb-3 inline-flex h-12 w-12 items-center justify-center rounded-3xl border border-black/50 bg-white/60",children:n.jsx(Vs,{className:"h-5 w-5 text-slate-600"})}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No active admissions found"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Try clearing filters or refreshing."})]}),!o&&W.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"hidden md:block overflow-x-auto rounded-3xl border border-black/50 bg-white/70",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-white/70 text-[11px] uppercase tracking-wide text-slate-500",children:[n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Admission"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Patient (UHID)"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Bed"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Admitted at"}),n.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Action"})]})}),n.jsx("tbody",{children:W.map(se=>{const J=r[se.current_bed_id],ie=(J==null?void 0:J.code)||"",te=i[se.patient_id]||`P-${se.patient_id}`;return n.jsxs("tr",{className:"border-t border-black/5 hover:bg-black/[0.02]",children:[n.jsx("td",{className:"px-4 py-3",children:n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-semibold text-white tabular-nums",children:qC(se)})}),n.jsx("td",{className:"px-4 py-3 text-slate-800",children:n.jsx("span",{className:"font-semibold",children:te})}),n.jsxs("td",{className:"px-4 py-3 text-slate-800",children:[n.jsx("span",{className:"font-semibold",children:ie}),n.jsx("span",{className:Ad("ml-2 inline-flex items-center rounded-full border px-2.5 py-1 text-[11px] font-semibold",S8(J==null?void 0:J.state)),children:(J==null?void 0:J.state)||"unknown"})]}),n.jsx("td",{className:"px-4 py-3 text-slate-700",children:_8(se.admitted_at)}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsx(ul,{to:`/ipd/admission/${se.id}`,state:{admission:se},className:"inline-flex items-center justify-center rounded-2xl bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white hover:bg-slate-800",children:"Open"})})]},se.id)})})]})}),n.jsx("div",{className:"md:hidden space-y-2",children:n.jsx(on,{initial:!1,children:W.map(se=>{const J=r[se.current_bed_id],ie=(J==null?void 0:J.code)||"",te=i[se.patient_id]||`P-${se.patient_id}`;return n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14},className:"rounded-3xl border border-black/50 bg-white/80 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-semibold text-white tabular-nums",children:qC(se)}),n.jsx(ul,{to:`/ipd/admission/${se.id}`,state:{admission:se},className:"inline-flex items-center rounded-2xl bg-slate-900 px-3 py-2 text-[12px] font-semibold text-white hover:bg-slate-800",children:"Open"})]}),n.jsxs("div",{className:"mt-3 space-y-2 text-[12px] text-slate-700",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(or,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-semibold text-slate-900",children:te})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(cn,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"font-semibold text-slate-900",children:ie}),n.jsx("span",{className:Ad("inline-flex items-center rounded-full border px-2.5 py-1 text-[11px] font-semibold",S8(J==null?void 0:J.state)),children:(J==null?void 0:J.state)||"unknown"})]}),n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(Na,{className:"mt-0.5 h-4 w-4 text-slate-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Admitted at"}),n.jsx("div",{className:"text-[12px]",children:_8(se.admitted_at)})]})]})]})]},se.id)})})}),n.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[n.jsxs("button",{type:"button",onClick:V,disabled:F,className:Vi.chipBtn,children:[n.jsx(ry,{className:"h-4 w-4"}),"Prev"]}),n.jsxs("span",{className:Vi.chip,children:["Page ",n.jsx("span",{className:"ml-1 tabular-nums",children:w})," / ",B]}),n.jsxs("button",{type:"button",onClick:R,disabled:G,className:Vi.chipBtn,children:["Next",n.jsx(Ti,{className:"h-4 w-4"})]})]})]})]})]})]})})}const GC=10;function ake(){const t=dn(W=>W.user),[s,r]=p.useState([]),[a,i]=p.useState({}),[l,o]=p.useState({}),[c,d]=p.useState(!1),[u,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState(1),j=W=>`ADM-${String(W).padStart(6,"0")}`,w=W=>W?W==="vacant"?"bg-emerald-50 text-emerald-700 border-emerald-200":W==="occupied"?"bg-rose-50 text-rose-700 border-rose-200":W==="reserved"?"bg-amber-50 text-amber-700 border-amber-200":W==="preoccupied"?"bg-sky-50 text-sky-700 border-sky-200":"bg-slate-50 text-slate-700 border-slate-500":"bg-slate-50 text-slate-700 border-slate-500",S=async()=>{var W,V;if(t!=null&&t.id){d(!0),m("");try{const[R,F]=await Promise.all([T2({status:"admitted",practitioner_user_id:t.id}),Eo()]),G=R.data||[],H=F.data||[];G.sort((se,J)=>new Date(J.admitted_at||0)-new Date(se.admitted_at||0)),r(G);const $={};for(const se of H)$[se.id]=se;i($);const K=[...new Set(G.map(se=>se.patient_id))].slice(0,100),le={};await Promise.all(K.map(async se=>{try{const{data:J}=await P2(se);le[se]=(J==null?void 0:J.uhid)||`P-${se}`}catch{le[se]=`P-${se}`}})),o(le),v(1)}catch(R){console.error("MyAdmissions loadData error",R),m(((V=(W=R==null?void 0:R.response)==null?void 0:W.data)==null?void 0:V.detail)||"Failed to load your admissions. Please try again."),r([]),i({}),o({})}finally{d(!1)}}};p.useEffect(()=>{if(!(t!=null&&t.id))return;let W=!0;return(async()=>await S())(),()=>{W=!1}},[t==null?void 0:t.id]);const E=p.useMemo(()=>{const W=x.trim().toLowerCase();return W?s.filter(V=>{var H;const R=j(V.id).toLowerCase(),F=(l[V.patient_id]||`P-${V.patient_id}`).toLowerCase(),G=(((H=a[V.current_bed_id])==null?void 0:H.code)||"").toLowerCase();return R.includes(W)||F.includes(W)||G.includes(W)}):s},[s,x,l,a]),k=Math.max(1,Math.ceil(E.length/GC));p.useEffect(()=>{v(1)},[x,s]);const A=(y-1)*GC,I=E.slice(A,A+GC),P=()=>v(W=>Math.max(1,W-1)),O=()=>v(W=>Math.min(k,W+1)),D=y<=1||c,T=y>=k||c,B=s.length;if(!(t!=null&&t.id))return n.jsx("div",{className:"min-h-screen bg-slate-50 px-4 py-6 text-sm text-slate-700 md:px-6",children:n.jsx("div",{className:"mx-auto max-w-3xl rounded-2xl border border-slate-500 bg-white p-4 shadow-sm",children:"You are not logged in or your user information is missing. Please log in again to view your admissions."})});const U=(t==null?void 0:t.full_name)||(t==null?void 0:t.name)||(t==null?void 0:t.username)||(t==null?void 0:t.email)||"you";return n.jsxs("div",{className:"min-h-screen bg-slate-50 px-4 py-4 text-black md:px-6 md:py-6",children:[n.jsxs("div",{className:"mx-auto mb-4 flex max-w-6xl flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-semibold tracking-tight text-slate-900",children:"My Admissions"}),n.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-slate-600",children:["This view shows all"," ",n.jsx("span",{className:"font-semibold",children:"active in-patient admissions"})," ","where ",n.jsx("span",{className:"font-semibold",children:U})," is set as the primary doctor / practitioner. Use it to quickly jump into your patients' admission detail screens for orders, notes, vitals and discharge planning."]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 shadow-sm",children:[n.jsx(or,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{className:"leading-tight",children:[n.jsx("span",{className:"font-medium text-slate-800",children:"Your in-patients"}),n.jsx("br",{}),"Assigned to you"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 shadow-sm",children:[n.jsx(cn,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{className:"leading-tight",children:[n.jsx("span",{className:"font-medium text-slate-800",children:"Bed overview"}),n.jsx("br",{}),"Ward / room / bed"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 shadow-sm",children:[n.jsx(Na,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{className:"leading-tight",children:[n.jsx("span",{className:"font-medium text-slate-800",children:"Admitted since"}),n.jsx("br",{}),"Length of stay"]})]})]})]}),n.jsxs("div",{className:"mx-auto max-w-6xl space-y-3",children:[n.jsxs("div",{className:"flex flex-col gap-3 rounded-2xl border border-slate-500 bg-white p-3 shadow-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"w-full md:max-w-md",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-500 bg-white px-9 py-2 text-sm text-slate-900 placeholder:text-slate-400 outline-none transition focus:border-sky-500 focus:ring-2 focus:ring-sky-100",placeholder:"Search by Admission no, UHID, Bed code",value:x,onChange:W=>g(W.target.value)})]}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Tip: Type an admission number (ADM-000123), UHID or bed code to quickly find a patient."})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 md:justify-end",children:[n.jsxs("div",{className:"text-xs text-slate-600",children:[n.jsx("span",{className:"font-semibold text-slate-900",children:E.length})," ","of ",B," active admissions assigned to you"]}),n.jsxs("button",{type:"button",onClick:S,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-60",disabled:c,children:[c?n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}):n.jsx(cl,{className:"h-3.5 w-3.5"}),"Refresh"]})]})]}),u&&n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:u})]}),c&&!s.length&&n.jsx("div",{className:"flex items-center justify-center rounded-2xl border border-slate-500 bg-white px-4 py-10 text-sm text-slate-600 shadow-sm",children:n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-500 px-3 py-1.5 text-xs",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin text-slate-500"}),"Loading your admissions"]})}),!c&&I.length===0&&n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white px-4 py-8 text-center text-sm text-slate-500 shadow-sm",children:"No active admissions assigned to you."}),!c&&I.length>0&&n.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50 text-xs text-slate-500",children:[n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Admission"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Patient (UHID)"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Bed"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Admitted at"}),n.jsx("th",{className:"px-4 py-2 text-right font-medium",children:"Action"})]})}),n.jsx("tbody",{children:I.map(W=>{const V=a[W.current_bed_id],R=(V==null?void 0:V.code)||"",F=l[W.patient_id]||`P-${W.patient_id}`;return n.jsxs("tr",{className:"border-t text-sm hover:bg-slate-50",children:[n.jsx("td",{className:"px-4 py-2 align-middle text-slate-900",children:n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2.5 py-0.5 text-[11px] font-semibold tracking-wide text-slate-800",children:j(W.id)})}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-800",children:F}),n.jsxs("td",{className:"px-4 py-2 align-middle text-slate-800",children:[R,(V==null?void 0:V.state)&&n.jsx("span",{className:`ml-1 inline-flex items-center rounded-full border px-1.5 py-0.5 text-[10px] ${w(V.state)}`,children:V.state})]}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-700",children:W.admitted_at?new Date(W.admitted_at).toLocaleString():""}),n.jsx("td",{className:"px-4 py-2 align-middle text-right",children:n.jsx(ul,{to:`/ipd/admission/${W.id}`,state:{admission:W},className:"inline-flex items-center rounded-full bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white shadow-sm transition hover:bg-slate-800",children:"Open"})})]},W.id)})})]})}),n.jsx("div",{className:"space-y-2 p-3 md:hidden",children:I.map(W=>{const V=a[W.current_bed_id],R=(V==null?void 0:V.code)||"",F=l[W.patient_id]||`P-${W.patient_id}`;return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2 text-xs shadow-sm",children:[n.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-2.5 py-0.5 text-[11px] font-semibold tracking-wide text-white",children:j(W.id)}),n.jsx(ul,{to:`/ipd/admission/${W.id}`,state:{admission:W},className:"inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-semibold text-white shadow-sm transition hover:bg-slate-800",children:"Open"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[n.jsx(or,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-medium",children:F})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-slate-800",children:[n.jsx(cn,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-medium",children:R}),(V==null?void 0:V.state)&&n.jsx("span",{className:`inline-flex items-center rounded-full border px-1.5 py-0.5 text-[10px] ${w(V.state)}`,children:V.state})]}),n.jsxs("div",{className:"flex items-start gap-2 text-slate-700",children:[n.jsx(Na,{className:"mt-0.5 h-3.5 w-3.5 text-slate-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Admitted at"}),n.jsx("div",{className:"text-[11px]",children:W.admitted_at?new Date(W.admitted_at).toLocaleString():""})]})]})]})]},W.id)})}),E.length>0&&n.jsxs("div",{className:"flex flex-col items-center justify-between gap-3 border-t border-slate-100 px-4 py-3 text-xs text-slate-600 sm:flex-row",children:[n.jsxs("button",{type:"button",onClick:P,disabled:D,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 font-medium shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",children:[n.jsx(ry,{className:"h-4 w-4"}),"Prev"]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Page"," ",n.jsx("span",{className:"font-medium text-slate-900",children:y})," ","of ",k]}),n.jsxs("button",{type:"button",onClick:O,disabled:T,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 font-medium shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",children:["Next",n.jsx(Ti,{className:"h-4 w-4"})]})]})]})]})]})}const KC=10;function ike(){const[t,s]=p.useState([]),[r,a]=p.useState({}),[i,l]=p.useState({}),[o,c]=p.useState(!1),[d,u]=p.useState(""),[m,x]=p.useState(""),[g,y]=p.useState(1),v=B=>`ADM-${String(B).padStart(6,"0")}`,j=async()=>{var B,U;c(!0),u("");try{const[W,V]=await Promise.all([T2({status:"discharged"}),Eo()]),R=W.data||[],F=V.data||[];R.sort((K,le)=>new Date(le.discharged_at||le.admitted_at||0)-new Date(K.discharged_at||K.admitted_at||0)),s(R);const G={};for(const K of F)G[K.id]=K;a(G);const H=[...new Set(R.map(K=>K.patient_id))].slice(0,100),$={};await Promise.all(H.map(async K=>{try{const{data:le}=await P2(K);$[K]=(le==null?void 0:le.uhid)||`P-${K}`}catch{$[K]=`P-${K}`}})),l($),y(1)}catch(W){console.error("DischargedList loadData error",W),u(((U=(B=W==null?void 0:W.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to load discharged admissions. Please try again."),s([]),a({}),l({})}finally{c(!1)}};p.useEffect(()=>{let B=!0;return(async()=>await j())(),()=>{B=!1}},[]);const w=p.useMemo(()=>{const B=m.trim().toLowerCase();return B?t.filter(U=>{var F;const W=v(U.id).toLowerCase(),V=(i[U.patient_id]||`P-${U.patient_id}`).toLowerCase(),R=(((F=r[U.current_bed_id])==null?void 0:F.code)||"").toLowerCase();return W.includes(B)||V.includes(B)||R.includes(B)}):t},[t,m,i,r]),S=Math.max(1,Math.ceil(w.length/KC));p.useEffect(()=>{y(1)},[m,t]);const E=(g-1)*KC,k=w.slice(E,E+KC),A=()=>y(B=>Math.max(1,B-1)),I=()=>y(B=>Math.min(S,B+1)),P=g<=1||o,O=g>=S||o,D=t.length,T=B=>B?B==="vacant"?"bg-emerald-50 text-emerald-700 border-emerald-200":B==="occupied"?"bg-rose-50 text-rose-700 border-rose-200":B==="reserved"?"bg-amber-50 text-amber-700 border-amber-200":B==="preoccupied"?"bg-sky-50 text-sky-700 border-sky-200":"bg-slate-50 text-slate-700 border-slate-500":"bg-slate-50 text-slate-700 border-slate-500";return n.jsxs("div",{className:"min-h-screen bg-slate-50 px-4 py-4 text-black md:px-6 md:py-6",children:[n.jsxs("div",{className:"mx-auto mb-4 flex max-w-6xl flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-semibold tracking-tight text-slate-900",children:"Discharged Patients"}),n.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-slate-600",children:["This list shows all"," ",n.jsx("span",{className:"font-semibold",children:"completed in-patient admissions"})," ","that have been discharged. Use it for audit, reporting, medical record review, and follow-up planning. Search by admission number, patient UHID or bed code to quickly find a case."]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 shadow-sm",children:[n.jsx(or,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{className:"leading-tight",children:[n.jsx("span",{className:"font-medium text-slate-800",children:"Discharged IP"}),n.jsx("br",{}),"Completed stays"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 shadow-sm",children:[n.jsx(cn,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{className:"leading-tight",children:[n.jsx("span",{className:"font-medium text-slate-800",children:"Last bed"}),n.jsx("br",{}),"Ward / room / bed"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-3 py-2 shadow-sm",children:[n.jsx(Na,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{className:"leading-tight",children:[n.jsx("span",{className:"font-medium text-slate-800",children:"LOS view"}),n.jsx("br",{}),"Admit vs discharge"]})]})]})]}),n.jsxs("div",{className:"mx-auto max-w-6xl space-y-3",children:[n.jsxs("div",{className:"flex flex-col gap-3 rounded-2xl border border-slate-500 bg-white p-3 shadow-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"w-full md:max-w-md",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-500 bg-white px-9 py-2 text-sm text-slate-900 placeholder:text-slate-400 outline-none transition focus:border-sky-500 focus:ring-2 focus:ring-sky-100",placeholder:"Search by Admission no, UHID, Bed code",value:m,onChange:B=>x(B.target.value)})]}),n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:["Tip: Example search  ",n.jsx("span",{className:"font-mono",children:"ADM-000245"}),","," ","a UHID, or a bed code like"," ",n.jsx("span",{className:"font-mono",children:"IP-2B-05"}),"."]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 md:justify-end",children:[n.jsxs("div",{className:"text-xs text-slate-600",children:[n.jsx("span",{className:"font-semibold text-slate-900",children:w.length})," ","of ",D," discharged admissions"]}),n.jsxs("button",{type:"button",onClick:j,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-60",disabled:o,children:[o?n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}):n.jsx(cl,{className:"h-3.5 w-3.5"}),"Refresh"]})]})]}),d&&n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:d})]}),o&&!t.length&&n.jsx("div",{className:"flex items-center justify-center rounded-2xl border border-slate-500 bg-white px-4 py-10 text-sm text-slate-600 shadow-sm",children:n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-500 px-3 py-1.5 text-xs",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin text-slate-500"}),"Loading discharged admissions"]})}),!o&&k.length===0&&n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white px-4 py-8 text-center text-sm text-slate-500 shadow-sm",children:"No discharged records found."}),!o&&k.length>0&&n.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50 text-xs text-slate-500",children:[n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Admission"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Patient (UHID)"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Bed"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Admitted at"}),n.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Status"})]})}),n.jsx("tbody",{children:k.map(B=>{const U=r[B.current_bed_id],W=(U==null?void 0:U.code)||"",V=i[B.patient_id]||`P-${B.patient_id}`;return n.jsxs("tr",{className:"border-t text-sm hover:bg-slate-50",children:[n.jsx("td",{className:"px-4 py-2 align-middle text-slate-900",children:n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2.5 py-0.5 text-[11px] font-semibold tracking-wide text-slate-800",children:v(B.id)})}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-800",children:V}),n.jsxs("td",{className:"px-4 py-2 align-middle text-slate-800",children:[W,(U==null?void 0:U.state)&&n.jsx("span",{className:`ml-1 inline-flex items-center rounded-full border px-1.5 py-0.5 text-[10px] ${T(U.state)}`,children:U.state})]}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-700",children:B.admitted_at?new Date(B.admitted_at).toLocaleString():""}),n.jsx("td",{className:"px-4 py-2 align-middle text-slate-700",children:n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-2.5 py-0.5 text-[11px] font-semibold text-emerald-700",children:B.status||"discharged"})})]},B.id)})})]})}),n.jsx("div",{className:"space-y-2 p-3 md:hidden",children:k.map(B=>{const U=r[B.current_bed_id],W=(U==null?void 0:U.code)||"",V=i[B.patient_id]||`P-${B.patient_id}`;return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2 text-xs shadow-sm",children:[n.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-2.5 py-0.5 text-[11px] font-semibold tracking-wide text-white",children:v(B.id)}),n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-semibold text-emerald-700",children:B.status||"discharged"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[n.jsx(or,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-medium",children:V})]}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[n.jsx(cn,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-medium",children:W}),(U==null?void 0:U.state)&&n.jsx("span",{className:`inline-flex items-center rounded-full border px-1.5 py-0.5 text-[10px] ${T(U.state)}`,children:U.state})]}),n.jsxs("div",{className:"flex items-start gap-2 text-slate-700",children:[n.jsx(Na,{className:"mt-0.5 h-3.5 w-3.5 text-slate-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Admitted at"}),n.jsx("div",{className:"text-[11px]",children:B.admitted_at?new Date(B.admitted_at).toLocaleString():""})]})]})]})]},B.id)})}),w.length>0&&n.jsxs("div",{className:"flex flex-col items-center justify-between gap-3 border-t border-slate-100 px-4 py-3 text-xs text-slate-600 sm:flex-row",children:[n.jsxs("button",{type:"button",onClick:A,disabled:P,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 font-medium shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",children:[n.jsx(ry,{className:"h-4 w-4"}),"Prev"]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Page"," ",n.jsx("span",{className:"font-medium text-slate-900",children:g})," ","of ",S]}),n.jsxs("button",{type:"button",onClick:I,disabled:O,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 font-medium shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50",children:["Next",n.jsx(Ti,{className:"h-4 w-4"})]})]})]})]})]})}function lke(){const[t,s]=p.useState([]),[r,a]=p.useState([]),[i,l]=p.useState([]),[o,c]=p.useState(!1),[d,u]=p.useState(""),[m,x]=p.useState(null),[g,y]=p.useState(""),[v,j]=p.useState(!1),[w,S]=p.useState(""),E=async()=>{var U,W;c(!0),u("");try{const[V,R,F]=await Promise.all([E2(),xy(),Eo()]);s(V.data||[]),a(R.data||[]),l(F.data||[])}catch(V){u(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to load bedboard.")}finally{c(!1)}};p.useEffect(()=>{E()},[]);const k=p.useMemo(()=>{const U={};return r.forEach(W=>{var V;(U[V=W.ward_id]||(U[V]=[])).push(W)}),U},[r]),A=p.useMemo(()=>{const U={};return i.forEach(W=>{var V;(U[V=W.room_id]||(U[V]=[])).push(W)}),U},[i]),I=({s:U})=>{const W=U==="vacant"?"bg-emerald-50 text-emerald-700 border-emerald-200":U==="occupied"?"bg-rose-50 text-rose-700 border-rose-200":U==="reserved"?"bg-amber-50 text-amber-700 border-amber-200":U==="preoccupied"?"bg-sky-50 text-sky-700 border-sky-200":"bg-slate-50 text-slate-700 border-slate-500";return n.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] capitalize ${W}`,children:U||"unknown"})},P=U=>U==="vacant"?"border-emerald-200 bg-emerald-50/60":U==="occupied"?"border-rose-200 bg-rose-50/70":U==="reserved"?"border-amber-200 bg-amber-50/70":U==="preoccupied"?"border-sky-200 bg-sky-50/70":"border-slate-500 bg-white",O=(U,W,V)=>{x({id:U,code:W,action:V,dt:"",note:""}),S("")},D=async()=>{var U,W;if(m){if(S(""),m.action==="reserved"&&!m.dt){S('Please select a "Reserved until" date & time.');return}try{j(!0);const V={state:m.action};m.action==="reserved"&&(V.reserved_until=m.dt?m.dt.length===16?`${m.dt}:00`:m.dt:null),m.note&&(V.note=m.note),await jNe(m.id,V),x(null),await E()}catch(V){S(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to update bed state.")}finally{j(!1)}}},T=g.trim().toLowerCase(),B=p.useMemo(()=>{if(!T)return t.map(W=>W.id);const U=new Set;return t.forEach(W=>{var G,H;const V=((G=W.code)==null?void 0:G.toLowerCase().includes(T))||((H=W.name)==null?void 0:H.toLowerCase().includes(T)),R=k[W.id]||[];let F=V;R.forEach($=>{const K=String($.number||"").toLowerCase().includes(T)||String($.type||"").toLowerCase().includes(T),se=(A[$.id]||[]).some(J=>{var te;const ie=(J.state||"").toLowerCase();return((te=J.code)==null?void 0:te.toLowerCase().includes(T))||ie.includes(T)});(K||se)&&(F=!0)}),F&&U.add(W.id)}),Array.from(U)},[T,t,k,A]);return n.jsxs("div",{className:"min-h-screen bg-slate-50 px-4 py-4 text-black md:px-6 md:py-6",children:[n.jsxs("div",{className:"mx-auto mb-4 flex max-w-6xl flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-semibold tracking-tight text-slate-900",children:"Bedboard"}),n.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-slate-600",children:["Live overview of ",n.jsx("span",{className:"font-semibold",children:"IPD bed occupancy"})," ","by ward and room. Colours help you quickly spot which beds are vacant, occupied, reserved or preoccupied. Use the quick actions to reserve or vacate beds in real time."]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[11px] md:grid-cols-4",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-2.5 py-1.5 shadow-sm",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-500"}),n.jsxs("span",{className:"leading-tight text-emerald-800",children:[n.jsx("span",{className:"font-semibold",children:"Vacant"}),n.jsx("br",{}),"Ready to allocate"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-2.5 py-1.5 shadow-sm",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-rose-500"}),n.jsxs("span",{className:"leading-tight text-rose-800",children:[n.jsx("span",{className:"font-semibold",children:"Occupied"}),n.jsx("br",{}),"Patient in bed"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-amber-200 bg-amber-50 px-2.5 py-1.5 shadow-sm",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-amber-500"}),n.jsxs("span",{className:"leading-tight text-amber-800",children:[n.jsx("span",{className:"font-semibold",children:"Reserved"}),n.jsx("br",{}),"Booked for patient"]})]}),n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-sky-200 bg-sky-50 px-2.5 py-1.5 shadow-sm",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-sky-500"}),n.jsxs("span",{className:"leading-tight text-sky-800",children:[n.jsx("span",{className:"font-semibold",children:"Preoccupied"}),n.jsx("br",{}),"Pending admission"]})]})]})]}),n.jsxs("div",{className:"mx-auto max-w-6xl space-y-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 rounded-2xl border border-slate-500 bg-white p-3 shadow-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"w-full md:max-w-md",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-500 bg-white px-9 py-2 text-sm text-slate-900 placeholder:text-slate-400 outline-none transition focus:border-sky-500 focus:ring-2 focus:ring-sky-100",placeholder:"Search by ward, room, bed code or state (vacant, occupied, reserved)",value:g,onChange:U=>y(U.target.value)})]}),n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:["Example: type ",n.jsx("span",{className:"font-mono",children:"VACANT"}),", ward code like"," ",n.jsx("span",{className:"font-mono",children:"W1"}),", or bed code like"," ",n.jsx("span",{className:"font-mono",children:"B-102"}),"."]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 md:justify-end",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-slate-50 px-3 py-1.5 text-[11px] text-slate-700",children:[n.jsx(cn,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsxs("span",{children:["Total beds:"," ",n.jsx("span",{className:"font-semibold text-slate-900",children:i.length})]})]}),n.jsxs("button",{type:"button",onClick:E,className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 shadow-sm transition hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-60",disabled:o,children:[o?n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}):n.jsx(cl,{className:"h-3.5 w-3.5"}),"Refresh"]})]})]}),d&&n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:d})]}),o&&!i.length&&n.jsx("div",{className:"flex items-center justify-center rounded-2xl border border-slate-500 bg-white px-4 py-10 text-sm text-slate-600 shadow-sm",children:n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-500 px-3 py-1.5 text-xs",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin text-slate-500"}),"Loading bedboard"]})}),!o&&n.jsxs("div",{className:"space-y-4",children:[t.filter(U=>B.includes(U.id)).map(U=>n.jsxs("div",{className:"overflow-hidden rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-100 bg-slate-50 px-3 py-2 text-sm font-semibold text-slate-900",children:[n.jsx(Xa,{className:"h-4 w-4 text-slate-500"}),n.jsxs("span",{children:[U.code,"  ",U.name]})]}),(k[U.id]||[]).length===0?n.jsx("div",{className:"px-3 py-3 text-sm text-slate-500",children:"No rooms configured for this ward."}):(k[U.id]||[]).map(W=>{var R;const V=(A[W.id]||[]).filter(F=>{var H;if(!T)return!0;const G=(F.state||"").toLowerCase();return((H=F.code)==null?void 0:H.toLowerCase().includes(T))||G.includes(T)});return!V.length&&T&&!(String(W.number||"").toLowerCase().includes(T)||String(W.type||"").toLowerCase().includes(T))?null:n.jsxs("div",{className:"border-t border-slate-100 px-3 py-3",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-xs text-slate-600",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(SV,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsxs("span",{className:"font-medium",children:["Room ",W.number]}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:[" ",W.type]})]}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:["Beds: ",((R=A[W.id])==null?void 0:R.length)||0]})]}),V.length===0?n.jsx("div",{className:"rounded-xl border border-dashed border-slate-500 bg-slate-50 px-3 py-3 text-xs text-slate-500",children:"No beds match your search in this room."}):n.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(F=>n.jsxs("div",{className:`flex w-full flex-col justify-between rounded-2xl border px-3 py-2 text-xs shadow-sm transition hover:-translate-y-0.5 hover:shadow-md sm:w-[calc(50%-0.25rem)] lg:w-[calc(25%-0.375rem)] ${P(F.state)}`,children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"font-semibold text-slate-900",children:F.code}),n.jsx(I,{s:F.state})]}),F.note&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-600 line-clamp-2",children:F.note}),F.reserved_until&&n.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["Reserved until:"," ",new Date(F.reserved_until).toLocaleString()]}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-1.5",children:[n.jsx("button",{type:"button",className:"inline-flex flex-1 items-center justify-center rounded-full bg-amber-50 px-2 py-1 text-[11px] font-medium text-amber-800 ring-1 ring-amber-200 hover:bg-amber-100",onClick:()=>O(F.id,F.code,"reserved"),children:"Reserve"}),n.jsx("button",{type:"button",className:"inline-flex flex-1 items-center justify-center rounded-full bg-sky-50 px-2 py-1 text-[11px] font-medium text-sky-800 ring-1 ring-sky-200 hover:bg-sky-100",onClick:()=>O(F.id,F.code,"preoccupied"),children:"Preoccupy"}),n.jsx("button",{type:"button",className:"inline-flex flex-1 items-center justify-center rounded-full bg-emerald-50 px-2 py-1 text-[11px] font-medium text-emerald-800 ring-1 ring-emerald-200 hover:bg-emerald-100",onClick:()=>O(F.id,F.code,"vacant"),children:"Vacate"})]})]},F.id))})]},W.id)})]},U.id)),!o&&B.length===0&&n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white px-4 py-8 text-center text-sm text-slate-500 shadow-sm",children:"No beds match your search. Try clearing the filter or searching with a different ward, room or bed code."})]})]}),m&&n.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 px-4",children:n.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-4 text-sm shadow-xl",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Update bed state"}),n.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:[m.code,"  ",m.action]})]}),n.jsx(I,{s:m.action})]}),m.action==="reserved"&&n.jsxs("div",{className:"mt-2 space-y-1",children:[n.jsx("label",{className:"text-xs text-slate-500",children:"Reserved until"}),n.jsx("input",{type:"datetime-local",className:"input w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",value:m.dt,onChange:U=>x(W=>({...W,dt:U.target.value}))})]}),n.jsxs("div",{className:"mt-3 space-y-1",children:[n.jsx("label",{className:"text-xs text-slate-500",children:"Note (optional)"}),n.jsx("input",{className:"input w-full rounded-xl border border-slate-500 bg-white px-3 py-2 text-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-100",placeholder:"Reason for change, patient reference, etc.",value:m.note,onChange:U=>x(W=>({...W,note:U.target.value}))})]}),w&&n.jsxs("div",{className:"mt-2 flex items-start gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("span",{children:w})]}),n.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[n.jsx("button",{type:"button",className:"inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-200",onClick:()=>x(null),disabled:v,children:"Cancel"}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-full bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-60",onClick:D,disabled:v,children:[v?n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}):n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Save"]})]})]})})]})}function nf({patient:t,patientId:s,className:r=""}){const[a,i]=p.useState(t||null);p.useEffect(()=>{let u=!1;return!t&&s&&(async()=>{try{const{data:m}=await he.get(`/patients/${s}`);u||i(m)}catch{}})(),()=>{u=!0}},[t,s]);const l=(a==null?void 0:a.uhid)||"",o=(a==null?void 0:a.name)||(a!=null&&a.first_name?`${a.first_name} ${a.last_name||""}`.trim():""),c=a!=null&&a.id?`/patients?focus=${a.id}`:void 0,d=n.jsxs("span",{className:["inline-flex items-center gap-2 rounded-md border px-2 py-0.5 text-xs","bg-gray-50 border-gray-200 text-gray-700","max-w-[18rem]",r].join(" "),title:o!==""?o:void 0,children:[n.jsx("span",{className:"font-medium",children:l}),n.jsx("span",{className:"text-gray-400",children:""}),n.jsx("span",{className:"truncate",children:o})]});return c?n.jsx(ul,{to:c,children:d}):d}const oke=t=>t?new Date(t).toLocaleString():"",cke=t=>t?`LAB-${String(t).padStart(6,"0")}`:"";function Eg(...t){return t.filter(Boolean).join(" ")}function dke(t){const s=(t??"").toString().replace(/\r\n/g,`
`).trim();if(!s||s==="-")return{raw:"-",lines:[""]};if(s.includes(`
`)){const r=s.split(`
`).map(a=>a.trim()).filter(Boolean);return{raw:s,lines:r.length?r:[""]}}if(s.includes(";")){const r=s.split(";").map(a=>a.trim()).filter(Boolean);return{raw:s,lines:r.length?r:[""]}}return{raw:s,lines:[s]}}function C8({value:t,expanded:s,onToggle:r}){const{lines:a}=dke(t),i=a.length>3;return n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:Eg("text-[11px] leading-4 text-slate-700 whitespace-pre-line",s?"":"max-h-[3.2rem] overflow-hidden"),children:a.slice(0,s?a.length:3).join(`
`)}),i&&n.jsx("button",{type:"button",onClick:r,className:"mt-1 inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-700 hover:bg-slate-50",children:s?n.jsxs(n.Fragment,{children:[n.jsx(el,{className:"h-3 w-3"}),"Less"]}):n.jsxs(n.Fragment,{children:[n.jsx(Gn,{className:"h-3 w-3"}),"More"]})})]})}function k8({flag:t}){const s=(t||"").toUpperCase().trim();if(!s)return null;const r=s==="H"?"bg-rose-50 text-rose-700 border-rose-100":s==="L"?"bg-amber-50 text-amber-800 border-amber-100":"bg-slate-50 text-slate-700 border-slate-200";return n.jsx("span",{className:Eg("inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-semibold",r),children:s})}function uke(){const{id:t}=Cm(),s=Qr(),[r,a]=p.useState(!1),[i,l]=p.useState(null),[o,c]=p.useState([]),[d,u]=p.useState([]),[m,x]=p.useState([]),[g,y]=p.useState(!1),[v,j]=p.useState(!1),[w,S]=p.useState(null),[E,k]=p.useState({}),A=p.useMemo(()=>i?cke(i.id):"",[i]),I=p.useCallback(async()=>{a(!0);try{const{data:se}=await q2e(t);l(se)}catch(se){console.error(se),ae.error("Failed to load order")}finally{a(!1)}},[t]),P=p.useCallback(async()=>{try{const{data:se}=await K2e({active_only:!0}),J=Array.isArray(se)?se:(se==null?void 0:se.items)||[];c(J)}catch(se){console.error(se),ae.error("Failed to load lab departments")}},[]);p.useEffect(()=>{I(),P()},[I,P]);const O=p.useMemo(()=>{const se=Array.isArray(o)?o:[],J=se.filter(ne=>!ne.parent_id),ie={};se.forEach(ne=>{ne.parent_id&&(ie[ne.parent_id]||(ie[ne.parent_id]=[]),ie[ne.parent_id].push(ne))});const te=(ne,q)=>{const ee=ne.display_order??999999,X=q.display_order??999999;return ee!==X?ee-X:String(ne.name||"").localeCompare(String(q.name||""))};return J.slice().sort(te).map(ne=>({...ne,children:(ie[ne.id]||[]).slice().sort(te)}))},[o]),D=p.useMemo(()=>i?(i.status||"").toLowerCase()!=="reported":!1,[i]),T=async()=>{var se,J;try{await G2e(t),ae.success("Report finalized"),I()}catch(ie){console.error(ie),ae.error(((J=(se=ie==null?void 0:ie.response)==null?void 0:se.data)==null?void 0:J.detail)||"Finalize failed")}},B=()=>s(`/lab/orders/${t}/print`),U=(se,J=null)=>{const ie=`${se}::${J||"root"}`;return d.some(te=>te.key===ie)},W=(se,J=null,ie="",te=null)=>{const ne=`${se}::${J||"root"}`;u(q=>q.some(X=>X.key===ne)?q.filter(X=>X.key!==ne):[...q,{key:ne,department_id:se,department_name:ie,sub_department_id:J,sub_department_name:te}])},V=()=>{u([]),x([]),S(null),k({})},R=async()=>{var se,J;if(!d.length){ae.error("Select at least one Department / Panel");return}y(!0);try{const te=(await Promise.all(d.map(q=>Y2e(t,{department_id:q.department_id,sub_department_id:q.sub_department_id||void 0}).then(ee=>({panel:q,rows:Array.isArray(ee.data)?ee.data:[]}))))).map(({panel:q,rows:ee})=>({key:q.key,department_id:q.department_id,department_name:q.department_name,sub_department_id:q.sub_department_id,sub_department_name:q.sub_department_name,rows:ee.map(X=>({...X,result_value:X.result_value??"",flag:X.flag??"",comments:X.comments??""}))}));x(te);const ne={};te.forEach(q=>ne[q.key]=!1),k(ne),ae.success("Panels loaded")}catch(ie){console.error(ie),ae.error(((J=(se=ie==null?void 0:ie.response)==null?void 0:se.data)==null?void 0:J.detail)||"Failed to load panel services")}finally{y(!1)}},F=(se,J,ie)=>{x(te=>te.map(ne=>ne.key!==se?ne:{...ne,rows:ne.rows.map((q,ee)=>ee===J?{...q,...ie}:q)}))},G=async()=>{var se,J;if(!m.length){ae.error("No panel rows loaded");return}j(!0);try{await Promise.all(m.map(ie=>{if(!ie.rows.length)return Promise.resolve();const te={department_id:Number(ie.department_id),sub_department_id:ie.sub_department_id?Number(ie.sub_department_id):null,results:ie.rows.map(ne=>({service_id:ne.service_id,result_value:(ne.result_value??"").toString(),flag:(ne.flag||"").toString().trim()||null,comments:(ne.comments||"").toString().trim()||null}))};return X2e(Number(t),te)})),ae.success("Panel results saved"),I()}catch(ie){console.error(ie),ae.error(((J=(se=ie==null?void 0:ie.response)==null?void 0:se.data)==null?void 0:J.detail)||"Failed to save panel results")}finally{j(!1)}},H=se=>{k(J=>({...J,[se]:!J[se]}))};if(r&&!i)return n.jsx("div",{className:"p-6 text-sm text-slate-600",children:"Loading"});if(!i)return n.jsx("div",{className:"p-6 text-sm text-slate-600",children:"Order not found"});const $=(i.status||"ORDERED").toString(),K=(i.priority||"routine").toString(),le=i.created_at||i.createdAt;return n.jsxs("div",{className:"p-3 md:p-6 space-y-4",children:[n.jsx("div",{className:"rounded-3xl border border-slate-200/70 bg-white shadow-sm overflow-hidden",children:n.jsx("div",{className:"p-4 md:p-5 bg-[radial-gradient(60%_120%_at_30%_0%,rgba(15,23,42,0.06),transparent_60%)]",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{type:"button",onClick:()=>s(-1),className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-white text-slate-700 hover:bg-slate-50",title:"Back",children:n.jsx(Hl,{className:"h-4 w-4"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Lab Order"}),n.jsx("h1",{className:"text-lg md:text-xl font-semibold text-slate-900 truncate",children:A})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsx(nf,{patient:i==null?void 0:i.patient,patientId:i==null?void 0:i.patient_id,className:"border-slate-200 bg-slate-50"}),n.jsxs("span",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-700",children:["Created: ",n.jsx("span",{className:"ml-1 font-semibold",children:oke(le)})]}),n.jsxs("span",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-700",children:["Priority: ",n.jsx("span",{className:"ml-1 font-semibold capitalize",children:K})]}),n.jsxs("span",{className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-700",children:["Status: ",n.jsx("span",{className:"ml-1 font-semibold uppercase",children:$})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("button",{type:"button",onClick:B,className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50",children:[n.jsx(Xn,{className:"h-4 w-4"}),"View / Print"]}),n.jsx(Wn,{anyOf:["lab.results.report","lab.results.enter","lab.results.approve"],children:n.jsxs("button",{type:"button",disabled:!D,onClick:T,className:Eg("inline-flex items-center gap-2 rounded-2xl px-3 py-2 text-xs font-semibold text-white shadow-sm",D?"bg-slate-900 hover:bg-slate-800":"bg-slate-400 cursor-not-allowed"),children:[n.jsx(So,{className:"h-4 w-4"}),"Finalize"]})})]})]})})}),n.jsxs("section",{className:"rounded-3xl border border-slate-200/70 bg-white shadow-sm overflow-hidden",children:[n.jsxs("div",{className:"flex flex-col gap-2 border-b border-slate-100 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx("div",{className:"mt-0.5 inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-slate-50",children:n.jsx(Co,{className:"h-4 w-4 text-slate-600"})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Result Entry"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Select panels, enter values, save, then finalize. Normal ranges show in the same multi-line report style."})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("button",{type:"button",onClick:R,disabled:g||!d.length,className:Eg("inline-flex items-center gap-2 rounded-2xl border px-3 py-2 text-xs font-semibold",g||!d.length?"border-slate-200 bg-slate-50 text-slate-400 cursor-not-allowed":"border-slate-200 bg-white text-slate-700 hover:bg-slate-50"),children:[g?n.jsx(Rt,{className:"h-4 w-4 animate-spin"}):n.jsx(i2,{className:"h-4 w-4"}),"Start Entry"]}),n.jsx(Wn,{anyOf:["lab.results.enter"],children:n.jsxs("button",{type:"button",onClick:G,disabled:v||!m.length,className:Eg("inline-flex items-center gap-2 rounded-2xl px-3 py-2 text-xs font-semibold text-white shadow-sm",v||!m.length?"bg-emerald-300 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700"),children:[v?n.jsx(Rt,{className:"h-4 w-4 animate-spin"}):n.jsx(Pi,{className:"h-4 w-4"}),"Save Results"]})}),n.jsx("button",{type:"button",onClick:V,className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50",children:"Clear"})]})]}),n.jsxs("div",{className:"border-b border-slate-100 bg-slate-50/60 px-4 py-4",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-800",children:"Select Departments & Panels"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Tick one or more Departments / Sub-Departments. Selected tests will load below grouped by heading."})]}),n.jsx("div",{className:"mt-3 max-h-64 overflow-y-auto rounded-3xl border border-slate-200 bg-white p-3",children:O.length===0?n.jsx("div",{className:"py-6 text-center text-xs text-slate-400",children:"No lab departments configured."}):n.jsx("div",{className:"space-y-2",children:O.map(se=>n.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/60 p-3",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-800",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-200",checked:U(se.id,null),onChange:()=>W(se.id,null,se.name,null)}),n.jsx("span",{className:"min-w-0 truncate",children:se.name}),n.jsx("span",{className:"ml-auto text-[11px] font-medium text-slate-500",children:"(All tests)"})]}),!!se.children.length&&n.jsx("div",{className:"mt-2 grid gap-1 pl-6",children:se.children.map(J=>n.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-700",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-slate-900 focus:ring-slate-200",checked:U(se.id,J.id),onChange:()=>W(se.id,J.id,se.name,J.name)}),n.jsx("span",{className:"min-w-0 truncate",children:J.name})]},J.id))})]},se.id))})}),n.jsxs("div",{className:"mt-2 text-[11px] text-slate-600",children:["Selected panels: ",n.jsx("span",{className:"font-semibold",children:d.length||0})]})]}),g&&n.jsxs("div",{className:"px-4 py-10 text-center text-sm text-slate-500",children:[n.jsx(Rt,{className:"mx-auto mb-2 h-5 w-5 animate-spin"}),"Loading selected panels"]}),!g&&m.length===0&&n.jsxs("div",{className:"px-4 py-10 text-center text-xs text-slate-400",children:["Select panels above and click ",n.jsx("span",{className:"font-semibold text-slate-600",children:"Start Entry"})," to load tests."]}),!g&&m.map(se=>{var te;const J=`${se.department_name}${se.sub_department_name?` / ${se.sub_department_name}`:""}`,ie=!!E[se.key];return n.jsxs("div",{className:"border-t border-slate-100",children:[n.jsxs("button",{type:"button",onClick:()=>H(se.key),className:"flex w-full items-center justify-between gap-3 bg-slate-50 px-4 py-3 text-left hover:bg-slate-100/70",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-800 truncate",children:J}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:[((te=se.rows)==null?void 0:te.length)||0," test(s)"]})]}),n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-white text-slate-700",children:ie?n.jsx(Gn,{className:"h-4 w-4"}):n.jsx(el,{className:"h-4 w-4"})})]}),!ie&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"md:hidden p-4 space-y-2",children:[se.rows.length===0&&n.jsx("div",{className:"text-xs text-slate-400",children:"No services configured for this panel."}),se.rows.map((ne,q)=>{const ee=`${se.key}::${ne.service_id}`,X=w===ee;return n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-3 shadow-sm",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-900 truncate",children:ne.service_name}),n.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["Unit: ",n.jsx("span",{className:"font-semibold text-slate-700",children:ne.unit||""})]})]}),n.jsx(k8,{flag:ne.flag})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Result"}),n.jsx("input",{className:"mt-1 h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:ne.result_value,onChange:Z=>F(se.key,q,{result_value:Z.target.value})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Flag"}),n.jsx("input",{className:"mt-1 h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"H / L / N",value:ne.flag||"",onChange:Z=>F(se.key,q,{flag:(Z.target.value||"").toUpperCase().slice(0,2)})})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("div",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Normal Range"}),n.jsx("div",{className:"mt-1 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2",children:n.jsx(C8,{value:ne.normal_range,expanded:X,onToggle:()=>S(X?null:ee)})})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("div",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Comments"}),n.jsx("input",{className:"mt-1 h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Optional",value:ne.comments||"",onChange:Z=>F(se.key,q,{comments:Z.target.value})})]})]},ne.service_id)})]}),n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full border-separate border-spacing-0",children:[n.jsx("thead",{className:"sticky top-0 z-10 bg-white",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"border-b border-slate-100 px-4 py-3 text-left font-semibold",children:"Service"}),n.jsx("th",{className:"border-b border-slate-100 px-4 py-3 text-left font-semibold w-[180px]",children:"Result"}),n.jsx("th",{className:"border-b border-slate-100 px-4 py-3 text-left font-semibold w-[110px]",children:"Unit"}),n.jsx("th",{className:"border-b border-slate-100 px-4 py-3 text-left font-semibold",children:"Normal Range"}),n.jsx("th",{className:"border-b border-slate-100 px-4 py-3 text-left font-semibold w-[140px]",children:"Flag"}),n.jsx("th",{className:"border-b border-slate-100 px-4 py-3 text-left font-semibold w-[220px]",children:"Comments"})]})}),n.jsxs("tbody",{children:[se.rows.map((ne,q)=>{const ee=`${se.key}::${ne.service_id}`,X=w===ee;return n.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/60",children:[n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:ne.service_name})}),n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsx("input",{className:"h-10 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:ne.result_value,onChange:Z=>F(se.key,q,{result_value:Z.target.value})})}),n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsx("div",{className:"text-sm text-slate-700",children:ne.unit||""})}),n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2",children:n.jsx(C8,{value:ne.normal_range,expanded:X,onToggle:()=>S(X?null:ee)})})}),n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{className:"h-10 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"H / L / N",value:ne.flag||"",onChange:Z=>F(se.key,q,{flag:(Z.target.value||"").toUpperCase().slice(0,2)})}),n.jsx(k8,{flag:ne.flag})]})}),n.jsx("td",{className:"px-4 py-3 align-top",children:n.jsx("input",{className:"h-10 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Optional",value:ne.comments||"",onChange:Z=>F(se.key,q,{comments:Z.target.value})})})]},ne.service_id)}),se.rows.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-xs text-slate-400",children:"No services configured for this panel."})})]})]})})]})]},se.key)})]})]})}const _4=t=>`${Number(t||0).toFixed(2)}`;function E1(t,s=0){const r=typeof t=="number"?t:parseFloat(String(t??""));return Number.isFinite(r)?r:s}function mke(t,s=350){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}const T1=Object.freeze({id:null,code:"",name:"",price_ui:"",is_active:!0}),hke=_t.memo(function({children:s}){return n.jsx("div",{className:"min-h-[calc(100vh-56px)] w-full text-slate-900",children:n.jsx("div",{className:"mx-auto w-full max-w-[1400px] px-3 py-4 sm:px-5 sm:py-6",children:n.jsxs("div",{className:"relative overflow-hidden rounded-[28px] border border-slate-200/70 bg-white/70 shadow-[0_12px_40px_rgba(15,23,42,0.10)] backdrop-blur-xl",children:[n.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(900px_circle_at_20%_-20%,rgba(15,23,42,0.10),transparent_55%),radial-gradient(900px_circle_at_95%_0%,rgba(59,130,246,0.10),transparent_55%)]"}),n.jsx("div",{className:"relative p-4 sm:p-6",children:s})]})})})}),xke=_t.memo(function({loading:s,onRefresh:r,onCreate:a}){return n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[n.jsx("div",{className:"space-y-1",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl border border-slate-200 bg-white shadow-sm grid place-items-center",children:n.jsx("span",{className:"text-sm font-semibold text-slate-900",children:"LAB"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg sm:text-xl font-semibold tracking-tight text-slate-900",children:"Lab Masters"}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"Manage test catalogue (Code  Name  Price)"})]})]})}),n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 active:scale-[0.99]",children:[n.jsx(jh,{className:`h-4 w-4 ${s?"animate-spin":""}`}),n.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),n.jsx(Wn,{anyOf:["lab.masters.manage","masters.lab.manage"],children:n.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 rounded-2xl bg-slate-900 px-3.5 py-2 text-sm font-semibold text-white shadow-md shadow-slate-900/20 hover:bg-slate-800 active:scale-[0.99]",children:[n.jsx(ds,{className:"h-4 w-4"}),"New Test"]})})]})]})}),pke=_t.memo(function({q:s,setQ:r,total:a}){return n.jsxs("div",{className:"mt-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"relative w-full sm:max-w-md",children:[n.jsx(Yt,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-200 bg-white/80 px-9 py-2.5 text-sm text-slate-900 shadow-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Search by code or name",value:s,onChange:i=>r(i.target.value)}),s?n.jsx("button",{onClick:()=>r(""),className:"absolute right-2 top-2 inline-flex h-7 w-7 items-center justify-center rounded-xl hover:bg-slate-100","aria-label":"Clear search",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})}):null]}),n.jsx("div",{className:"flex items-center justify-between sm:justify-end gap-3",children:n.jsxs("div",{className:"text-xs text-slate-500",children:["Total: ",n.jsx("span",{className:"font-semibold text-slate-700",children:a})]})})]})}),fke=_t.memo(function({rows:s,loading:r,deletingId:a,onEdit:i,onDelete:l}){return r?n.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:Array.from({length:9}).map((o,c)=>n.jsxs("div",{className:"rounded-[26px] border border-slate-200 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"space-y-2 min-w-0",children:[n.jsx("div",{className:"h-6 w-20 rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-5 w-full max-w-[280px] rounded bg-slate-100"}),n.jsx("div",{className:"h-4 w-24 rounded bg-slate-100"})]}),n.jsx("div",{className:"h-9 w-20 rounded-2xl bg-slate-100"})]}),n.jsx("div",{className:"mt-4 h-10 w-full rounded-2xl bg-slate-100"})]},c))}):s.length?n.jsx("div",{className:"mt-4 grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:s.map(o=>n.jsxs("div",{className:"group relative overflow-hidden rounded-[26px] border border-slate-200 bg-white shadow-sm transition hover:shadow-[0_14px_40px_rgba(15,23,42,0.10)]",children:[n.jsx("div",{className:"pointer-events-none absolute inset-0 opacity-0 transition group-hover:opacity-100 bg-[radial-gradient(900px_circle_at_20%_-30%,rgba(15,23,42,0.10),transparent_55%),radial-gradient(800px_circle_at_110%_0%,rgba(59,130,246,0.10),transparent_60%)]"}),n.jsxs("div",{className:"relative p-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"inline-flex items-center rounded-xl border border-slate-200 bg-slate-50 px-2.5 py-1 text-xs font-semibold text-slate-800",children:o.code}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:["ID: ",o.id]})]}),n.jsx("div",{className:"mt-2 line-clamp-2 text-sm font-semibold text-slate-900",children:o.name}),n.jsx("div",{className:"mt-3 inline-flex items-center rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm",children:_4(o.price)})]}),n.jsx(Wn,{anyOf:["lab.masters.manage","masters.lab.manage"],children:n.jsxs("div",{className:"flex shrink-0 flex-col gap-2",children:[n.jsx("button",{onClick:()=>i(o),className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-slate-200 bg-white text-slate-700 shadow-sm hover:bg-slate-50 active:scale-[0.99]","aria-label":"Edit",title:"Edit",children:n.jsx(Yr,{className:"h-4 w-4"})}),n.jsx("button",{onClick:()=>l(o.id),disabled:a===o.id,className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-rose-200 bg-rose-50 text-rose-700 shadow-sm hover:bg-rose-100 disabled:opacity-60 active:scale-[0.99]","aria-label":"Delete",title:"Delete",children:a===o.id?n.jsx(Rt,{className:"h-4 w-4 animate-spin"}):n.jsx(Ms,{className:"h-4 w-4"})})]})})]}),n.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-600",children:[n.jsxs("span",{className:"truncate",children:["Code: ",n.jsx("span",{className:"font-semibold text-slate-800",children:o.code})]}),n.jsx("span",{className:"font-semibold text-slate-800",children:_4(o.price)})]})]})]},o.id))}):n.jsx("div",{className:"mt-4 rounded-[26px] border border-slate-200 bg-white p-8 text-center text-sm text-slate-500",children:"No tests found."})});function gke(){const[t,s]=p.useState(""),r=mke(t,350),[a,i]=p.useState([]),[l,o]=p.useState(!1),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(()=>({...T1})),j=p.useRef({...T1}),w=p.useCallback((K,le)=>{v(se=>se[K]===le?se:{...se,[K]:le})},[]),S=p.useRef(null),E=p.useRef(null),k=p.useRef(0),[A,I]=p.useState(0),P=p.useRef(null),O=p.useCallback(K=>{K.stopPropagation(),K.key==="Enter"&&K.preventDefault()},[]),D=p.useCallback(()=>{const K=j.current,le=y;return(K.id??null)!==(le.id??null)||String(K.code??"")!==String(le.code??"")||String(K.name??"")!==String(le.name??"")||String(K.price_ui??"")!==String(le.price_ui??"")||!!K.is_active!=!!le.is_active},[y]),T=p.useCallback(()=>{const K={...T1};j.current=K,v(K)},[]),B=p.useCallback(()=>{u||c&&D()&&!window.confirm("You have unsaved changes. Close anyway?")||(d(!1),T())},[c,D,T,u]),U=p.useCallback(()=>{const K={...T1};j.current=K,v(K),d(!0),k.current+=1,I(k.current)},[]),W=p.useCallback(K=>{const le=E1(K==null?void 0:K.price,0),se={id:(K==null?void 0:K.id)??null,code:(K==null?void 0:K.code)??"",name:(K==null?void 0:K.name)??"",price_ui:String(le),is_active:(K==null?void 0:K.is_active)??!0};j.current={...se},v(se),d(!0),k.current+=1,I(k.current)},[]);p.useEffect(()=>{if(!c)return;const K=window.requestAnimationFrame(()=>{var le,se,J,ie;(se=(le=S.current)==null?void 0:le.focus)==null||se.call(le),(ie=(J=S.current)==null?void 0:J.select)==null||ie.call(J)});return()=>window.cancelAnimationFrame(K)},[c,A]),p.useEffect(()=>{if(!c)return;const K=le=>{le.key==="Escape"&&B(),(le.ctrlKey||le.metaKey)&&le.key==="Enter"&&le.preventDefault()};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[c,B]),p.useEffect(()=>{if(!c)return;const K=le=>{const se=E.current;if(!se)return;const J=document.activeElement;!J||!se.contains(J)||(le.stopPropagation(),typeof le.stopImmediatePropagation=="function"&&le.stopImmediatePropagation(),le.key==="Enter"&&le.preventDefault())};return document.addEventListener("keydown",K,!0),()=>document.removeEventListener("keydown",K,!0)},[c]);const V=p.useCallback(async()=>{var le,se,J,ie;(se=(le=P.current)==null?void 0:le.abort)==null||se.call(le);const K=new AbortController;P.current=K,o(!0);try{const{data:te}=await hP({q:r,page_size:200,signal:K.signal});i(Array.isArray(te)?te:[])}catch(te){if((te==null?void 0:te.name)==="CanceledError"||(te==null?void 0:te.code)==="ERR_CANCELED")return;ae.error(((ie=(J=te==null?void 0:te.response)==null?void 0:J.data)==null?void 0:ie.detail)||"Failed to load lab tests")}finally{o(!1)}},[r]);p.useEffect(()=>{V()},[V]);const R=p.useMemo(()=>a.length,[a]),F=p.useCallback(()=>{const K=(y.code||"").trim(),le=(y.name||"").trim(),se=E1(y.price_ui,0);return K?le?K.length>32?"Code is too long":le.length>200?"Name is too long":se<0?"Price cannot be negative":null:"Name is required":"Code is required"},[y]),G=p.useCallback(async()=>{var le,se;const K=F();if(K)return ae.error(K);m(!0);try{const J={code:(y.code||"").trim(),name:(y.name||"").trim(),price:E1(y.price_ui,0),is_active:!!y.is_active};y.id?(await H2e(y.id,J),ae.success("Updated")):(await V2e(J),ae.success("Created")),d(!1),T(),V()}catch(J){ae.error(((se=(le=J==null?void 0:J.response)==null?void 0:le.data)==null?void 0:se.detail)||"Save failed")}finally{m(!1)}},[y,F,V,T]),H=p.useCallback(async K=>{var le,se;if(window.confirm("Delete this test?")){g(K);try{await W2e(K),ae.success("Deleted"),V()}catch(J){ae.error(((se=(le=J==null?void 0:J.response)==null?void 0:le.data)==null?void 0:se.detail)||"Delete failed")}finally{g(null)}}},[V]),$=c?n.jsxs("div",{className:"fixed inset-0 z-50",children:[n.jsx("div",{className:"absolute inset-0 bg-slate-900/30 backdrop-blur-sm",onClick:B}),n.jsx("div",{className:"absolute inset-x-0 bottom-0 sm:inset-y-0 sm:right-0 sm:left-auto w-full sm:w-[520px]",children:n.jsxs("div",{ref:E,className:"relative h-[92vh] sm:h-full rounded-t-3xl sm:rounded-none sm:rounded-l-3xl border border-slate-200 bg-white shadow-2xl overflow-hidden",onKeyDownCapture:K=>{O(K),(K.ctrlKey||K.metaKey)&&K.key==="Enter"&&G()},children:[n.jsx("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(1000px_circle_at_20%_-20%,rgba(15,23,42,0.10),transparent_55%),radial-gradient(900px_circle_at_100%_0%,rgba(59,130,246,0.10),transparent_60%)]"}),n.jsxs("div",{className:"relative flex items-start justify-between gap-3 border-b border-slate-200 px-5 py-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-base font-semibold text-slate-900",children:y.id?"Edit Test":"New Test"}),n.jsx("div",{className:"text-xs text-slate-500",children:y.id?`Update test #${y.id}`:"Add a new lab test"})]}),n.jsx("button",{onClick:B,className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-white hover:bg-slate-50","aria-label":"Close",children:n.jsx(ts,{className:"h-4 w-4 text-slate-600"})})]}),n.jsx("div",{className:"relative h-[calc(92vh-140px)] sm:h-[calc(100%-140px)] overflow-y-auto px-5 py-4",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Code"}),n.jsx("input",{ref:S,className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:y.code,onChange:K=>w("code",K.target.value),placeholder:"e.g. CBC",maxLength:32})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Price"}),n.jsx("input",{type:"text",inputMode:"decimal",className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:y.price_ui,onChange:K=>{const le=K.target.value;(le===""||/^[0-9]*\.?[0-9]*$/.test(le))&&w("price_ui",le)},onPaste:K=>{var J;const se=(((J=K.clipboardData)==null?void 0:J.getData("text"))||"").trim().replace(/[^\d.]/g,"");(se===""||/^[0-9]*\.?[0-9]*$/.test(se))&&(K.preventDefault(),w("price_ui",se))},placeholder:"0.00"}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Preview: ",n.jsx("span",{className:"font-semibold",children:_4(E1(y.price_ui,0))})]})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Name"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:y.name,onChange:K=>w("name",K.target.value),placeholder:"e.g. Complete Blood Count",maxLength:200})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-700",children:"Keyboard"}),n.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:[n.jsx("span",{className:"font-semibold",children:"ESC"})," close "," ",n.jsx("span",{className:"font-semibold",children:"Ctrl/ + Enter"})," save"]})]})]})}),n.jsx("div",{className:"relative border-t border-slate-200 px-5 py-4",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-xs text-slate-500",children:D()?n.jsxs("span",{className:"inline-flex items-center gap-2",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-amber-400"}),"Unsaved changes"]}):n.jsxs("span",{className:"inline-flex items-center gap-2",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-400"}),"Saved state"]})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:B,className:"inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50 disabled:opacity-60",disabled:u,children:"Cancel"}),n.jsx("button",{onClick:G,disabled:u,className:"inline-flex items-center justify-center rounded-2xl bg-slate-900 px-5 py-2.5 text-sm font-semibold text-white shadow-md shadow-slate-900/20 hover:bg-slate-800 disabled:opacity-70",children:u?n.jsxs(n.Fragment,{children:[n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving"]}):"Save"})]})]})})]})})]}):null;return n.jsxs("div",{children:[n.jsxs(hke,{children:[n.jsx(xke,{loading:l,onRefresh:V,onCreate:U}),n.jsx(pke,{q:t,setQ:s,total:R}),n.jsx(fke,{rows:a,loading:l,deletingId:x,onEdit:W,onDelete:H}),!l&&a.length>0?n.jsx("div",{className:"mt-4 rounded-3xl border border-slate-200 bg-white px-4 py-3 text-xs text-slate-500",children:"Showing up to 200 results. Refine search for faster access."}):null]}),$]})}function v0(...t){return t.filter(Boolean).join(" ")}const Mc={shell:"rounded-2xl border border-black/10 bg-white/80 backdrop-blur-xl shadow-[0_10px_28px_rgba(2,6,23,0.07)]",row:"rounded-2xl border border-black/10 bg-white/85 hover:bg-black/[0.02] transition px-3 py-2",chip:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700"};function A8(t){const s=(t==null?void 0:t.first_name)||(t==null?void 0:t.firstname)||"",r=(t==null?void 0:t.last_name)||(t==null?void 0:t.lastname)||"",a=(t==null?void 0:t.full_name)||(t==null?void 0:t.name)||"",i=t!=null&&t.prefix?`${t.prefix} `:"";return(a||`${i}${s} ${r}`.trim()||"").replace(/\s+/g," ").trim()}function E8(t){return((t==null?void 0:t.sex)||(t==null?void 0:t.gender)||(t==null?void 0:t.gender_name)||"").toString().toUpperCase()||""}function T8(t){if(!t)return"";try{const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const r=new Date;let a=r.getFullYear()-s.getFullYear();const i=r.getMonth()-s.getMonth();return(i<0||i===0&&r.getDate()<s.getDate())&&(a-=1),a>=0&&a<130?String(a):""}catch{return""}}function W2({value:t,onChange:s}){const[r,a]=p.useState(""),[i,l]=p.useState([]),[o,c]=p.useState(!1),d=p.useRef(null),u=t?Number(t):null,m=async g=>{try{c(!0);const{data:y}=await sP(g||"");l(Array.isArray(y)?y:[])}catch{l([])}finally{c(!1)}};p.useEffect(()=>{m("")},[]),p.useEffect(()=>(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>m(r),250),()=>d.current&&clearTimeout(d.current)),[r]);const x=p.useMemo(()=>u&&(i||[]).find(g=>Number(g==null?void 0:g.id)===u)||null,[i,u]);return n.jsxs("div",{className:v0(Mc.shell,"p-3"),children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Select Patient"}),u?n.jsxs("span",{className:Mc.chip,children:[n.jsx(So,{className:"h-3.5 w-3.5 text-emerald-600"}),"Selected #",u]}):n.jsxs("span",{className:Mc.chip,children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),"Not selected"]})]}),n.jsxs("div",{className:"mt-2 relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx(Ee,{value:r,onChange:g=>a(g.target.value),placeholder:"Search name / UHID / phone",className:"h-11 rounded-2xl border-black/10 bg-white/90 pl-10 text-[12px] font-semibold"})]}),x?n.jsxs("div",{className:"mt-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[n.jsx("div",{className:"text-[12px] font-semibold text-emerald-900",children:A8(x)}),n.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[11px] text-emerald-900/80",children:[n.jsxs("span",{className:v0(Mc.chip,"border-emerald-200 bg-white/70"),children:[n.jsx(jo,{className:"h-3.5 w-3.5"}),"UHID ",(x==null?void 0:x.uhid)||""]}),n.jsxs("span",{className:v0(Mc.chip,"border-emerald-200 bg-white/70"),children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),x!=null&&x.dob||x!=null&&x.date_of_birth?"DOB":"Age"," ",(x==null?void 0:x.dob)||(x==null?void 0:x.date_of_birth)||T8((x==null?void 0:x.dob)||(x==null?void 0:x.date_of_birth))||""," "," ",E8(x)]}),n.jsxs("span",{className:v0(Mc.chip,"border-emerald-200 bg-white/70"),children:[n.jsx(ad,{className:"h-3.5 w-3.5"}),(x==null?void 0:x.phone)||(x==null?void 0:x.mobile)||""]})]})]}):null,n.jsx("div",{className:"mt-3 rounded-2xl border border-black/10 bg-white/75",children:n.jsx(Fn,{className:"h-[260px] p-2",children:o?n.jsxs("div",{className:"flex items-center gap-2 p-3 text-[12px] text-slate-500",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Loading"]}):i.length===0?n.jsx("div",{className:"p-3 text-[12px] text-slate-500",children:"No patients found."}):n.jsx("div",{className:"space-y-2",children:i.map(g=>{const y=Number(g==null?void 0:g.id),v=u===y,j=A8(g),w=(g==null?void 0:g.uhid)||"",S=(g==null?void 0:g.phone)||(g==null?void 0:g.mobile)||"",E=T8((g==null?void 0:g.dob)||(g==null?void 0:g.date_of_birth)),k=E8(g);return n.jsx("button",{type:"button",onClick:()=>s==null?void 0:s(y,g),className:v0(Mc.row,"w-full text-left",v&&"border-emerald-300 bg-emerald-50"),children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"truncate text-[13px] font-semibold text-slate-900",children:j}),n.jsxs("div",{className:"mt-0.5 flex flex-wrap gap-2 text-[11px] text-slate-600",children:[n.jsxs("span",{className:Mc.chip,children:[n.jsx(jo,{className:"h-3.5 w-3.5"}),"UHID ",w]}),n.jsxs("span",{className:Mc.chip,children:[n.jsx(ad,{className:"h-3.5 w-3.5"}),S]}),n.jsxs("span",{className:Mc.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),E?`${E}y`:"","  ",k]})]})]}),v?n.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl border border-emerald-200 bg-white/70",children:n.jsx(So,{className:"h-4 w-4 text-emerald-700"})}):n.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl border border-black/10 bg-white/70",children:n.jsx(wa,{className:"h-4 w-4 text-slate-600"})})]})},y)})})})})]})}function bke({value:t=[],onChange:s}){const[r,a]=p.useState(""),[i,l]=p.useState(!1),[o,c]=p.useState([]),[d,u]=p.useState(!1);p.useEffect(()=>{let S=!0;return l(!0),hP({q:r,active:!0,page_size:80}).then(E=>{S&&c(Array.isArray(E==null?void 0:E.data)?E.data:[])}).finally(()=>S&&l(!1)),()=>{S=!1}},[r]);const m=p.useMemo(()=>new Set(t||[]),[t]),x=p.useMemo(()=>(o||[]).filter(E=>m.has(E.id)),[o,m]),g=S=>{const E=new Set(m);E.has(S)?E.delete(S):E.add(S),s==null||s([...E])},y=()=>s==null?void 0:s([]),v=p.useMemo(()=>{const S=Array.isArray(o)?o:[],E=[],k=[];for(const A of S)m.has(A.id)?E.push(A):k.push(A);return[...E,...k]},[o,m]),j=p.useMemo(()=>{const S=v||[],E=d?40:12;return S.slice(0,E)},[v,d]),w=S=>Number(S||0).toFixed(2);return n.jsxs("div",{className:"space-y-3 text-slate-900",children:[n.jsxs("div",{className:"flex items-end justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold tracking-tight",children:"Select Tests"}),n.jsx("div",{className:"mt-0.5 text-xs text-slate-500",children:"Search and pick required lab investigations."})]}),n.jsxs("div",{className:"shrink-0 text-xs text-slate-500",children:["Selected:"," ",n.jsx("span",{className:"font-semibold text-slate-900",children:(t==null?void 0:t.length)||0})]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{value:r,onChange:S=>a(S.target.value),placeholder:"Search by code / name",className:["h-11 w-full rounded-2xl border bg-white/80 px-3 pl-10 pr-10 text-sm","border-slate-200 shadow-sm","placeholder:text-slate-400","focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-300","backdrop-blur supports-[backdrop-filter]:bg-white/60"].join(" ")}),!!r&&n.jsx("button",{type:"button",onClick:()=>a(""),className:"absolute right-2 top-1/2 inline-flex h-8 w-8 -translate-y-1/2 items-center justify-center rounded-xl hover:bg-slate-100","aria-label":"Clear search",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})})]}),((t==null?void 0:t.length)||0)>0&&n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-slate-50 p-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Selected tests"}),n.jsx("button",{type:"button",onClick:y,className:"text-[11px] font-semibold text-slate-600 underline underline-offset-2 hover:text-slate-900",children:"Clear all"})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[x.slice(0,14).map(S=>n.jsxs("span",{className:"inline-flex max-w-full items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-[11px] text-slate-700 shadow-sm",children:[n.jsx("span",{className:"truncate font-medium",children:S.code}),n.jsx("button",{type:"button",onClick:()=>g(S.id),className:"inline-flex h-5 w-5 items-center justify-center rounded-full hover:bg-slate-100","aria-label":"Remove",children:n.jsx(ts,{className:"h-3.5 w-3.5"})})]},S.id)),(x.length||0)>14?n.jsxs("span",{className:"self-center text-[11px] text-slate-500",children:["+",x.length-14," more"]}):null]})]}),n.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:i?n.jsx(n.Fragment,{children:Array.from({length:6}).map((S,E)=>n.jsxs("div",{className:"h-[76px] rounded-2xl border border-slate-200 bg-white p-3 shadow-sm",children:[n.jsx("div",{className:"h-4 w-2/3 animate-pulse rounded bg-slate-100"}),n.jsx("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-slate-100"}),n.jsx("div",{className:"mt-2 h-3 w-1/4 animate-pulse rounded bg-slate-100"})]},E))}):n.jsxs(n.Fragment,{children:[j.map(S=>{const E=m.has(S.id);return n.jsxs("button",{type:"button",onClick:()=>g(S.id),className:["group relative rounded-2xl border p-3 text-left shadow-sm transition","bg-white hover:bg-slate-50",E?"border-slate-900/20 ring-2 ring-slate-900/10":"border-slate-200","focus:outline-none focus:ring-2 focus:ring-slate-900/10"].join(" "),children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"truncate text-sm font-semibold text-slate-900",children:[S.code," ",n.jsxs("span",{className:"font-medium text-slate-600",children:[" ",S.name]})]}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[11px] font-medium text-slate-700",children:["",w(S.price)]}),S.department?n.jsx("span",{className:"text-[11px] text-slate-500",children:S.department}):null]})]}),n.jsx("div",{className:"shrink-0",children:E?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-1 text-[11px] font-semibold text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Selected"]}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-1 text-[11px] font-semibold text-slate-700 group-hover:bg-slate-200",children:"Add"})})]}),n.jsx("div",{className:"mt-3 h-px w-full bg-slate-100"}),n.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-slate-500",children:[n.jsxs("span",{className:"truncate",children:["Code: ",S.code]}),n.jsx("span",{className:"font-medium text-slate-600",children:"Tap to toggle"})]})]},S.id)}),!j.length&&n.jsxs("div",{className:"col-span-full rounded-2xl border border-dashed border-slate-200 bg-white p-6 text-center",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No tests found"}),n.jsx("div",{className:"mt-1 text-xs text-slate-500",children:"Try a different keyword (code or name)."})]})]})}),!i&&((v==null?void 0:v.length)||0)>12&&n.jsx("div",{className:"flex justify-center",children:n.jsxs("button",{type:"button",onClick:()=>u(S=>!S),className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-4 py-2 text-xs font-semibold text-slate-700 shadow-sm hover:bg-slate-50",children:[d?"Show less":`Show more (${Math.min(40,v.length)} shown)`,n.jsx(Gn,{className:["h-4 w-4 transition",d?"rotate-180":""].join(" ")})]})})]})}function q2({order:t,to:s,className:r="",prefix:a="LAB"}){const i=new Date((t==null?void 0:t.created_at)||(t==null?void 0:t.createdAt)||Date.now()),l=i.toISOString().slice(2,7).replace("-",""),o=Number((t==null?void 0:t.id)||0).toString(36).toUpperCase().padStart(3,"0"),c=`${a}-${l}-${o}`,d=(t==null?void 0:t.accession_no)||c,u=n.jsx("span",{className:["inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-medium","bg-blue-50 border-blue-200 text-blue-700",r].join(" "),title:`Created ${i.toLocaleString()}`,children:d});return s?n.jsx(ul,{to:s,children:u}):u}function jb({status:t}){const s=String(t||"ordered").toLowerCase(),a={ordered:"bg-amber-50 text-amber-700 border-amber-200",collected:"bg-blue-50 text-blue-700 border-blue-200",validated:"bg-purple-50 text-purple-700 border-purple-200",reported:"bg-emerald-50 text-emerald-700 border-emerald-200",cancelled:"bg-rose-50 text-rose-700 border-rose-200"}[s]||"bg-gray-50 text-gray-700 border-gray-200";return n.jsx("span",{className:`inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-medium ${a}`,children:s.charAt(0).toUpperCase()+s.slice(1)})}const yke="en-IN",vke="Asia/Kolkata",jke=330;function Nke(t){if(!t)return null;if(t instanceof Date)return isNaN(t)?null:t;if(typeof t=="number")return new Date(t);const s=String(t).trim();if(!s)return null;if(s.endsWith("Z")||/[+-]\d{2}:\d{2}$/.test(s)){const i=new Date(s);return isNaN(i)?null:i}const r=s.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2})(?::(\d{2}))?(?:\.(\d{1,3}))?$/);if(r){const i=Number(r[1]),l=Number(r[2])-1,o=Number(r[3]),c=Number(r[4]),d=Number(r[5]),u=Number(r[6]||0),m=Number((r[7]||"0").padEnd(3,"0")),x=Date.UTC(i,l,o,c,d,u,m)-jke*60*1e3;return new Date(x)}const a=new Date(s);return isNaN(a)?null:a}const wke=new Intl.DateTimeFormat(yke,{timeZone:vke,day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),P8=t=>{const s=Nke(t);return s?wke.format(s):""},YC=t=>t?`LAB-${String(t).padStart(6,"0")}`:"",D8=[{key:"patient",title:"Patient"},{key:"tests",title:"Tests"},{key:"review",title:"Review"}],_ke=[{key:"routine",label:"Routine",hint:"Standard queue"},{key:"urgent",label:"Urgent",hint:"High priority"},{key:"stat",label:"STAT",hint:"Immediate"}];function Ske(t,s=300){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}function Cke(t){const s=p.useRef(t);return p.useEffect(()=>{s.current=t},[t]),s}function j0(t){const s=Cke(t);return p.useCallback((...r)=>{var a;return(a=s.current)==null?void 0:a.call(s,...r)},[s])}function M8(t,s){if(t===s)return!0;if(!Array.isArray(t)||!Array.isArray(s)||t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(String(t[r])!==String(s[r]))return!1;return!0}function kke(t){return t?typeof t=="number"||typeof t=="string"?t:t.id??t.patient_id??t.patientId??t.value??t.key??null:null}function Ake(t,s){if(t&&typeof t=="object"){const r=t.uhid||t.UHID||t.patient_uhid,a=t.full_name||t.fullName||t.name||`${t.first_name||""} ${t.last_name||""}`.trim();if(a&&r)return`${a}  ${r}`;if(a)return a;if(r)return r}return s?`Patient #${s}`:"Not selected"}function yP(t){return t?typeof t=="number"||typeof t=="string"?t:t.id??t.test_id??t.value??t.key??null:null}function Eke(t){if(!t)return"";if(typeof t=="number"||typeof t=="string")return`#${t}`;const s=t.code||t.test_code,r=t.name||t.test_name;return s&&r?`${s}  ${r}`:r||s||`#${yP(t)||""}`}const Tke=p.memo(W2),Pke=p.memo(bke),Dke=p.memo(function({value:s,onChange:r}){return n.jsx("div",{className:"rounded-3xl border border-slate-200 bg-white p-2 shadow-sm",children:n.jsx("div",{className:"grid grid-cols-3 gap-2",children:_ke.map(a=>{const i=s===a.key;return n.jsxs("button",{type:"button",onClick:()=>r(a.key),className:`group rounded-2xl px-3 py-2.5 text-left transition active:scale-[0.99] ${i?"bg-slate-900 text-white shadow-md shadow-slate-900/20":"bg-slate-50 text-slate-800 hover:bg-slate-100"}`,children:[n.jsx("div",{className:"text-sm font-semibold",children:a.label}),n.jsx("div",{className:`mt-0.5 text-[11px] ${i?"text-white/75":"text-slate-500"}`,children:a.hint})]},a.key)})})})}),Mke=p.memo(function({onClose:s,onCreate:r,createSaving:a,patientId:i,patientMeta:l,setPatient:o,testIds:c,testMeta:d,setTests:u,priority:m,setPriority:x}){const g=p.useRef(null),y=p.useRef(null),v=p.useRef(!1),[j,w]=p.useState("patient"),S=j0(s),E=j0(r),k=j0(o),A=j0(u),I=j0(x),P=p.useMemo(()=>Math.max(0,D8.findIndex(H=>H.key===j)),[j]),O=p.useMemo(()=>j==="patient"?!!i:j==="tests"?Array.isArray(c)&&c.length>0:!0,[j,i,c]),D=p.useMemo(()=>j==="patient"?"Continue":j==="tests"?"Review":"Create Order",[j]),T=p.useMemo(()=>j!=="review"?null:i?c!=null&&c.length?null:"Select at least 1 test":"Select patient",[j,i,c]),B=p.useMemo(()=>Ake(l,i),[l,i]),U=p.useMemo(()=>!!i||((c==null?void 0:c.length)||0)>0||(m||"routine")!=="routine",[i,c,m]),W=p.useCallback(()=>{a||U&&!window.confirm("Discard this new order draft?")||S()},[a,U,S]),V=p.useCallback(H=>{const $=(c||[]).filter(K=>String(K)!==String(H));A($)},[c,A]),R=p.useCallback(()=>{a||(k(null),A([]),I("routine"),w("patient"))},[a,k,A,I]),F=p.useCallback(()=>{if(!a){if(j==="review")return w("tests");if(j==="tests")return w("patient")}},[a,j]),G=p.useCallback(()=>{if(!a){if(j==="patient"){if(!i)return ae.error("Select a patient");w("tests");return}if(j==="tests"){if(!(c!=null&&c.length))return ae.error("Select at least one test");w("review");return}E()}},[a,j,i,c,E]);return p.useEffect(()=>{y.current=document.activeElement;const H=document.body.style.overflow;document.body.style.overflow="hidden";const $=requestAnimationFrame(()=>{var J;if(v.current)return;v.current=!0;const le=g.current;if(!le)return;const se=le.querySelector('input:not([disabled]):not([type="hidden"]), select:not([disabled]), textarea:not([disabled]), button:not([disabled])')||null;(J=se==null?void 0:se.focus)==null||J.call(se)}),K=le=>{const se=g.current;if(!se)return;if(le.key==="Escape"){le.preventDefault(),W();return}if(le.key!=="Tab")return;const J=Array.from(se.querySelectorAll('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(q=>q.offsetParent!==null);if(!J.length)return;const ie=J[0],te=J[J.length-1],ne=document.activeElement;le.shiftKey?(ne===ie||!se.contains(ne))&&(le.preventDefault(),te.focus()):ne===te&&(le.preventDefault(),ie.focus())};return document.addEventListener("keydown",K,!0),()=>{var le,se;cancelAnimationFrame($),document.removeEventListener("keydown",K,!0),document.body.style.overflow=H;try{(se=(le=y.current)==null?void 0:le.focus)==null||se.call(le)}catch{}}},[]),n.jsxs("div",{className:"fixed inset-0 z-50",children:[n.jsx("div",{className:"absolute inset-0 bg-slate-900/35 backdrop-blur-sm",onClick:W}),n.jsx("div",{className:"absolute inset-x-0 bottom-0 sm:inset-y-0 sm:right-0 sm:left-auto w-full sm:w-[620px]",children:n.jsxs("div",{ref:g,role:"dialog","aria-modal":"true","aria-label":"New Lab Order",className:["h-[92dvh] sm:h-full","flex flex-col","rounded-t-3xl sm:rounded-none sm:rounded-l-3xl","border border-slate-200 bg-white shadow-2xl overflow-hidden"].join(" "),children:[n.jsxs("div",{className:"relative shrink-0 border-b border-slate-200",children:[n.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(1200px_circle_at_20%_-20%,rgba(15,23,42,0.10),transparent_55%),radial-gradient(900px_circle_at_90%_10%,rgba(2,132,199,0.10),transparent_55%)]"}),n.jsxs("div",{className:"relative px-5 py-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("div",{className:"h-9 w-9 rounded-2xl border border-slate-200 bg-white shadow-sm grid place-items-center",children:n.jsx(tl,{className:"h-4 w-4 text-slate-900"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-base font-semibold text-slate-900",children:"New Lab Order"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Patient  Tests  Review"})]})]}),n.jsx("button",{onClick:W,className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-white hover:bg-slate-50","aria-label":"Close",children:n.jsx(ts,{className:"h-4 w-4 text-slate-600"})})]}),n.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:D8.map((H,$)=>{const K=$===P,le=$<P;return n.jsxs("button",{type:"button",onClick:()=>{a||($<=P?w(H.key):H.key==="tests"&&i?w("tests"):H.key==="review"&&i&&(c!=null&&c.length)&&w("review"))},className:`rounded-2xl border px-3 py-2 text-left transition ${K?"border-slate-900 bg-slate-900 text-white shadow-md shadow-slate-900/15":le?"border-emerald-200 bg-emerald-50 text-emerald-800 hover:bg-emerald-100":"border-slate-200 bg-white text-slate-700 hover:bg-slate-50"}`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-xs font-semibold",children:H.title}),le?n.jsx(Xt,{className:"h-4 w-4"}):null]}),n.jsxs("div",{className:`mt-0.5 text-[11px] ${K?"text-white/75":"text-slate-500"}`,children:["Step ",$+1]})]},H.key)})}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-[11px]",children:[n.jsxs("span",{className:"inline-flex min-w-0 items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1 text-slate-700",children:[n.jsx($n,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsxs("span",{className:"truncate",children:["Patient: ",n.jsx("span",{className:"font-semibold",children:B})]})]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1 text-slate-700",children:["Tests: ",n.jsx("span",{className:"font-semibold",children:(c==null?void 0:c.length)||0})]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1 text-slate-700 capitalize",children:["Priority: ",n.jsx("span",{className:"font-semibold",children:m})]}),n.jsxs("button",{type:"button",onClick:R,disabled:a,className:"ml-auto inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1 text-slate-600 hover:bg-slate-50 disabled:opacity-60",children:[n.jsx(ts,{className:"h-3.5 w-3.5"}),"Clear"]})]})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4",children:[j==="patient"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Select patient"}),n.jsx("div",{className:"mt-1 text-xs text-slate-500",children:"Search by UHID / phone / name."})]}),i?n.jsx("span",{className:"rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-[11px] font-semibold text-emerald-800",children:"Selected"}):null]}),n.jsx("div",{className:"mt-4",children:n.jsx(Tke,{value:i,onChange:k})}),i?n.jsxs("div",{className:"mt-3 rounded-3xl border border-slate-200 bg-slate-50 p-3 text-xs text-slate-700",children:[n.jsx("span",{className:"font-semibold",children:"Chosen:"})," ",B]}):null]}),n.jsx("div",{className:"rounded-3xl border border-slate-200 bg-slate-50 p-4 text-xs text-slate-600",children:"Tip: If patient is new, register first in Patient Management, then come back."})]}),j==="tests"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Add tests"}),n.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Patient: ",n.jsx("span",{className:"font-semibold text-slate-700",children:B})]})]}),n.jsxs("div",{className:"text-xs text-slate-500",children:["Selected: ",n.jsx("span",{className:"font-semibold text-slate-800",children:(c==null?void 0:c.length)||0})]})]}),c!=null&&c.length?n.jsxs("div",{className:"mt-3 rounded-3xl border border-slate-200 bg-slate-50 p-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Selected tests"}),n.jsx("button",{type:"button",onClick:()=>A([]),disabled:a,className:"text-[11px] font-semibold text-slate-600 hover:text-slate-800 underline disabled:opacity-60",children:"Clear all"})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[(d&&Array.isArray(d)&&d.length?d.map(H=>({id:yP(H),label:Eke(H)})):c.map(H=>({id:H,label:`Test #${H}`}))).filter(H=>H.id!==null&&H.id!==void 0).slice(0,12).map(H=>n.jsxs("span",{className:"inline-flex max-w-full items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-[11px] text-slate-700",children:[n.jsx("span",{className:"truncate",children:H.label}),n.jsx("button",{type:"button",onClick:()=>V(H.id),disabled:a,className:"inline-flex h-5 w-5 items-center justify-center rounded-full hover:bg-slate-100 disabled:opacity-60","aria-label":"Remove",children:n.jsx(ts,{className:"h-3.5 w-3.5"})})]},String(H.id))),((c==null?void 0:c.length)||0)>12?n.jsxs("span",{className:"text-[11px] text-slate-500",children:["+",((c==null?void 0:c.length)||0)-12," more"]}):null]})]}):null,n.jsx("div",{className:"mt-4 -mx-2 sm:mx-0",children:n.jsx("div",{className:"px-2 sm:px-0",children:n.jsx(Pke,{value:c,onChange:A})})})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Priority"}),n.jsx("div",{className:"mt-1 text-xs text-slate-500",children:"This influences queue handling in LIS workflow."}),n.jsx("div",{className:"mt-3",children:n.jsx(Dke,{value:m,onChange:I})})]})]}),j==="review"&&n.jsx("div",{className:"space-y-4",children:n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Review & confirm"}),n.jsx("div",{className:"mt-1 text-xs text-slate-500",children:"Verify details before creating the order."}),n.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-slate-50 p-4",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Patient"}),n.jsx("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:B}),n.jsx("button",{type:"button",onClick:()=>w("patient"),disabled:a,className:"mt-3 inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-60",children:"Edit patient"})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-slate-50 p-4",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Tests"}),n.jsxs("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:[(c==null?void 0:c.length)||0," selected"]}),n.jsx("button",{type:"button",onClick:()=>w("tests"),disabled:a,className:"mt-3 inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-60",children:"Edit tests"})]})]}),T?n.jsxs("div",{className:"mt-4 rounded-3xl border border-amber-200 bg-amber-50 p-4 text-xs text-amber-900",children:["Missing: ",n.jsx("span",{className:"font-semibold",children:T})]}):n.jsx("div",{className:"mt-4 rounded-3xl border border-emerald-200 bg-emerald-50 p-4 text-xs text-emerald-900",children:"Looks good. You can create the order now."})]})})]}),n.jsxs("div",{className:"shrink-0 border-t border-slate-200 bg-white px-5 py-4 pb-[calc(env(safe-area-inset-bottom)+16px)]",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsx("button",{type:"button",onClick:W,disabled:a,className:"w-full sm:w-auto inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50 disabled:opacity-60",children:"Cancel"}),n.jsxs("div",{className:"flex w-full sm:w-auto gap-2",children:[n.jsxs("button",{type:"button",onClick:F,disabled:a||j==="patient",className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50 disabled:opacity-50",children:[n.jsx(Hl,{className:"h-4 w-4"}),"Back"]}),n.jsx("button",{type:"button",onClick:G,disabled:a||!O||j==="review"&&!!T,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-900 px-5 py-2.5 text-sm font-semibold text-white shadow-md shadow-slate-900/20 hover:bg-slate-800 disabled:opacity-60",children:a?n.jsxs(n.Fragment,{children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Creating"]}):n.jsxs(n.Fragment,{children:[D,n.jsx(Ki,{className:"h-4 w-4"})]})})]})]}),n.jsxs("div",{className:"mt-2 text-[11px] text-slate-500",children:["Keyboard: ",n.jsx("span",{className:"font-semibold",children:"ESC"})," to close,"," ",n.jsx("span",{className:"font-semibold",children:"Tab"})," to move."]})]})]})})]})}),Ike=p.memo(function({children:s}){return n.jsx("div",{className:"min-h-[calc(100vh-56px)] w-full",children:n.jsx("div",{className:"mx-auto w-full max-w-[1400px] px-3 py-4 sm:px-5 sm:py-6",children:n.jsx("div",{className:"rounded-3xl border border-slate-200/70 bg-white/70 shadow-[0_10px_30px_rgba(15,23,42,0.08)] backdrop-blur-xl",children:n.jsx("div",{className:"p-4 sm:p-6",children:s})})})})});function Oke(){const[t,s]=p.useState(""),r=Ske(t,250),[a,i]=p.useState([]),[l,o]=p.useState(!1),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(null),[j,w]=p.useState([]),[S,E]=p.useState(null),[k,A]=p.useState("routine"),[I,P]=p.useState(!0),[O,D]=p.useState("all"),[T,B]=p.useState("all"),[U,W]=p.useState(""),[V,R]=p.useState(""),F=Qr(),G=p.useRef(null),H=p.useCallback(()=>d(!0),[]),$=p.useCallback(()=>d(!1),[]),K=p.useCallback(async()=>{var X,Z;(Z=(X=G.current)==null?void 0:X.abort)==null||Z.call(X);const ee=new AbortController;G.current=ee,o(!0);try{const{data:Y}=await yK({page_size:200,signal:ee.signal}),Q=Array.isArray(Y)?Y:(Y==null?void 0:Y.items)||[];i(Q)}catch(Y){if((Y==null?void 0:Y.name)==="CanceledError"||(Y==null?void 0:Y.code)==="ERR_CANCELED")return;console.error(Y),ae.error("Failed to load orders")}finally{o(!1)}},[]);p.useEffect(()=>{K()},[K]);const le=p.useCallback(()=>{D("all"),B("all"),W(""),R("")},[]),se=p.useCallback(ee=>{if(ee&&typeof ee=="object"){const X=kke(ee);g(Z=>String(Z)===String(X)?Z:X),v(ee);return}g(X=>String(X)===String(ee)?X:ee),v(null)},[]),J=p.useCallback(ee=>{if(Array.isArray(ee)&&ee.length&&typeof ee[0]=="object"){const Z=ee.map(Y=>yP(Y)).filter(Y=>Y!=null);w(Y=>M8(Y,Z)?Y:Z),E(ee);return}const X=Array.isArray(ee)?ee:[];w(Z=>M8(Z,X)?Z:X),E(null)},[]),ie=p.useMemo(()=>{const ee=(r||"").trim().toLowerCase();return a.filter(X=>{if(ee){const Z=X.patient||{},Y=(Z.full_name||"").trim()||`${(Z.first_name||"").trim()} ${(Z.last_name||"").trim()}`.trim(),Q=Z.uhid||"",oe=X.display_no||YC(X.id);if(!`${Y} ${Q} ${oe}`.toLowerCase().includes(ee))return!1}if(O!=="all"&&(X.status||"").toLowerCase()!==O||T!=="all"&&(X.priority||"").toLowerCase()!==T)return!1;if(U||V){const Z=X.created_at||X.createdAt;if(!Z)return!1;const Y=new Date(Z).setHours(0,0,0,0);if(U){const Q=new Date(U).setHours(0,0,0,0);if(Y<Q)return!1}if(V){const Q=new Date(V).setHours(0,0,0,0);if(Y>Q)return!1}}return!0})},[a,r,O,T,U,V]),te=ie.length,ne=p.useMemo(()=>{const ee={ordered:0,collected:0,in_progress:0,validated:0,reported:0};for(const Z of ie){const Y=(Z.status||"").toLowerCase();ee[Y]!==void 0&&(ee[Y]+=1)}const X=ie.filter(Z=>(Z.priority||"").toLowerCase()!=="routine").length;return{...ee,urgent:X}},[ie]),q=p.useCallback(async()=>{var ee,X;if(!x||j.length===0){ae.error("Select patient and at least one test");return}m(!0);try{const{data:Z}=await bK({patient_id:x,priority:k,test_ids:j});ae.success("Order created"),$(),se(null),J([]),A("routine");const Y=(Z==null?void 0:Z.id)||(Z==null?void 0:Z.order_id);Y?F(`/lab/orders/${Y}`):K()}catch(Z){console.error(Z),ae.error(((X=(ee=Z==null?void 0:Z.response)==null?void 0:ee.data)==null?void 0:X.detail)||"Create failed")}finally{m(!1)}},[x,j,k,F,K,$,se,J]);return n.jsxs(Ike,{children:[n.jsxs("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl border border-slate-200 bg-white shadow-sm grid place-items-center",children:n.jsx(tl,{className:"h-5 w-5 text-slate-900"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg sm:text-xl font-semibold tracking-tight text-slate-900",children:"Lab Orders"}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"Create, track, and finalize LIS orders (NABH aligned)"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:K,className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm hover:bg-slate-50 active:scale-[0.99]",children:[n.jsx(jh,{className:`h-4 w-4 ${l?"animate-spin":""}`}),n.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),n.jsx(Wn,{anyOf:["lab.orders.create","orders.lab.create"],children:n.jsxs("button",{onClick:H,className:"inline-flex items-center gap-2 rounded-2xl bg-slate-900 px-3.5 py-2 text-sm font-semibold text-white shadow-md shadow-slate-900/20 hover:bg-slate-800 active:scale-[0.99]",children:[n.jsx(ds,{className:"h-4 w-4"}),"New Order"]})})]})]}),n.jsxs("section",{className:"mt-4 rounded-3xl border border-slate-200/70 bg-white p-3 sm:p-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"relative w-full sm:max-w-2xl",children:[n.jsx(Yt,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-200 bg-white/80 px-9 py-2.5 text-sm text-slate-900 shadow-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Search UHID / patient / Lab No (LAB-000123)",value:t,onChange:ee=>s(ee.target.value)}),t?n.jsx("button",{onClick:()=>s(""),className:"absolute right-2 top-2 inline-flex h-8 w-8 items-center justify-center rounded-xl hover:bg-slate-100","aria-label":"Clear search",children:n.jsx(ts,{className:"h-4 w-4 text-slate-600"})}):null]}),n.jsxs("div",{className:"flex items-center gap-2 justify-between sm:justify-end",children:[n.jsxs("div",{className:"hidden sm:flex items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-600",children:[n.jsx($n,{className:"h-4 w-4 text-slate-500"}),"Total: ",n.jsx("span",{className:"font-semibold text-slate-800",children:te})]}),n.jsxs("button",{type:"button",onClick:()=>P(ee=>!ee),className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:[n.jsx(jr,{className:"h-4 w-4"}),"Filters",I?n.jsx(el,{className:"h-4 w-4"}):n.jsx(Gn,{className:"h-4 w-4"})]})]})]}),I&&n.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-6",children:[n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:"block text-[11px] font-semibold text-slate-600 mb-1",children:"Status"}),n.jsxs("select",{className:"h-10 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 shadow-sm outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:O,onChange:ee=>D(ee.target.value),children:[n.jsx("option",{value:"all",children:"All"}),n.jsx("option",{value:"ordered",children:"Ordered"}),n.jsx("option",{value:"collected",children:"Collected"}),n.jsx("option",{value:"in_progress",children:"In Progress"}),n.jsx("option",{value:"validated",children:"Validated"}),n.jsx("option",{value:"reported",children:"Reported"})]})]}),n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:"block text-[11px] font-semibold text-slate-600 mb-1",children:"Priority"}),n.jsxs("select",{className:"h-10 w-full rounded-2xl border border-slate-200 bg-white px-3 text-sm text-slate-900 shadow-sm outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:T,onChange:ee=>B(ee.target.value),children:[n.jsx("option",{value:"all",children:"All"}),n.jsx("option",{value:"routine",children:"Routine"}),n.jsx("option",{value:"urgent",children:"Urgent"}),n.jsx("option",{value:"stat",children:"STAT"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-semibold text-slate-600 mb-1",children:"From"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ds,{className:"absolute left-3 top-3 h-4 w-4 text-slate-400"}),n.jsx("input",{type:"date",className:"h-10 w-full rounded-2xl border border-slate-200 bg-white pl-10 pr-3 text-sm text-slate-900 shadow-sm outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:U,onChange:ee=>W(ee.target.value)})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-semibold text-slate-600 mb-1",children:"To"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ds,{className:"absolute left-3 top-3 h-4 w-4 text-slate-400"}),n.jsx("input",{type:"date",className:"h-10 w-full rounded-2xl border border-slate-200 bg-white pl-10 pr-3 text-sm text-slate-900 shadow-sm outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",value:V,onChange:ee=>R(ee.target.value)})]})]}),n.jsxs("div",{className:"flex items-end justify-between sm:justify-end gap-3",children:[n.jsx("button",{type:"button",className:"text-sm font-semibold text-slate-600 hover:text-slate-800 underline",onClick:le,children:"Clear"}),n.jsxs("div",{className:"text-xs text-slate-500",children:["Urgent/STAT: ",n.jsx("span",{className:"font-semibold text-slate-700",children:ne.urgent})]})]})]})]}),n.jsxs("section",{className:"mt-4",children:[n.jsx("div",{className:"grid gap-3 md:hidden",children:l?Array.from({length:6}).map((ee,X)=>n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm",children:[n.jsx("div",{className:"h-4 w-28 rounded bg-slate-100"}),n.jsx("div",{className:"mt-3 h-4 w-64 rounded bg-slate-100"}),n.jsx("div",{className:"mt-3 h-8 w-full rounded-2xl bg-slate-100"})]},X)):ie.length===0?n.jsx("div",{className:"rounded-3xl border border-slate-200 bg-white p-8 text-center text-sm text-slate-500",children:"No lab orders found."}):ie.map(ee=>n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-4 shadow-sm hover:shadow-md transition-shadow",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-xs font-semibold text-slate-800",children:ee.display_no||YC(ee.id)}),n.jsx(jb,{status:ee.status})]}),n.jsx("div",{className:"mt-2 text-sm",children:n.jsx(nf,{patient:ee.patient,patientId:ee.patient_id})}),n.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-slate-600",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:["Priority:"," ",n.jsx("span",{className:"font-semibold capitalize text-slate-800",children:ee.priority||"routine"})]}),n.jsxs("div",{children:["Created: ",P8(ee.created_at||ee.createdAt)]})]}),n.jsx("button",{className:"inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50",onClick:()=>F(`/lab/orders/${ee.id}`),children:"Open"})]})]},ee.id))}),n.jsx("div",{className:"hidden md:block overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-sm",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-600",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Lab No"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Patient"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Priority"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Created"}),n.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Actions"})]})}),n.jsx("tbody",{children:l?Array.from({length:8}).map((ee,X)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-4 py-3",children:n.jsx("div",{className:"h-4 w-28 rounded bg-slate-100"})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx("div",{className:"h-4 w-72 rounded bg-slate-100"})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx("div",{className:"h-4 w-20 rounded bg-slate-100"})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx("div",{className:"h-6 w-28 rounded-full bg-slate-100"})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx("div",{className:"h-4 w-40 rounded bg-slate-100"})}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsx("div",{className:"ml-auto h-9 w-24 rounded-2xl bg-slate-100"})})]},X)):ie.length===0?n.jsx("tr",{className:"border-t",children:n.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-slate-500",children:"No orders"})}):ie.map(ee=>n.jsxs("tr",{className:"border-t hover:bg-slate-50/60",children:[n.jsx("td",{className:"px-4 py-3",children:n.jsx(q2,{order:{...ee,display_no:ee.display_no||YC(ee.id)},to:`/lab/orders/${ee.id}`})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(nf,{patient:ee.patient,patientId:ee.patient_id})}),n.jsx("td",{className:"px-4 py-3 capitalize",children:ee.priority||"routine"}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(jb,{status:ee.status})}),n.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:P8(ee.created_at||ee.createdAt)}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsx(ul,{to:`/lab/orders/${ee.id}`,className:"inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50",children:"View"})})]},ee.id))}),!l&&ie.length>0?n.jsx("tfoot",{children:n.jsx("tr",{className:"border-t bg-slate-50",children:n.jsxs("td",{colSpan:6,className:"px-4 py-3 text-xs text-slate-500",children:["Total: ",n.jsx("span",{className:"font-semibold text-slate-700",children:te})]})})}):null]})})})]}),c?n.jsx(Mke,{onClose:$,onCreate:q,createSaving:u,patientId:x,patientMeta:y,setPatient:se,testIds:j,testMeta:S,setTests:J,priority:k,setPriority:A}):null]})}function Rke({active_only:t=!0}={}){const s={active_only:t};return he.get("/lis/masters/departments",{params:s})}function Lke(t){return he.post("/lis/masters/departments",t)}function Fke(t,s){return he.put(`/lis/masters/departments/${t}`,s)}function Bke(t){return he.delete(`/lis/masters/departments/${t}`)}function $ke({department_id:t,search:s,active_only:r=!0}={}){const a={};return t&&(a.department_id=t),s&&(a.search=s),a.active_only=r,he.get("/lis/masters/services",{params:a})}function zke(t){return he.post("/lis/masters/services/bulk",{items:t})}function Uke(t,s){return he.put(`/lis/masters/services/${t}`,s)}function Vke(t){return he.delete(`/lis/masters/services/${t}`)}const Hke="#2563eb",XC={name:"",code:"",description:"",parent_id:"",is_active:!0,display_order:""},I8={name:"",code:"",unit:"",normal_range:"",comments_template:"",sample_type:"",method:"",display_order:"",__advanced:!1,__rangeOpen:!1,__key:""};function O8(){var t,s;return((s=(t=globalThis.crypto)==null?void 0:t.randomUUID)==null?void 0:s.call(t))||`${Date.now()}-${Math.random().toString(16).slice(2)}`}function P1(t,s=.12){try{const r=(t||"").replace("#","").trim();if(r.length!==6)return`rgba(37,99,235,${s})`;const a=parseInt(r.slice(0,2),16),i=parseInt(r.slice(2,4),16),l=parseInt(r.slice(4,6),16);return`rgba(${a},${i},${l},${s})`}catch{return`rgba(37,99,235,${s})`}}function fY(t){const s=(t||"").trim();return s?/<\/?[a-z][\s\S]*>/i.test(s):!1}function gY(t){var s;try{return(((s=new DOMParser().parseFromString(t||"","text/html").body)==null?void 0:s.innerText)??"").replace(/\r\n/g,`
`).trim()}catch{return(t||"").replace(/\r\n/g,`
`).trim()}}function D1(t){return(t||"").replace(/\r\n/g,`
`).split(`
`).map(s=>s.trimEnd()).filter(s=>s.trim()!=="")}function R8(t,s=90){const r=(t||"").trim();if(!r)return"-";const i=(fY(r)?gY(r):r).replace(/\s+/g," ").trim();return i.length>s?i.slice(0,s)+"":i}function QC(t){try{const s=new Set(["B","STRONG","U","BR","P","DIV","H1","H2","H3","UL","OL","LI","SPAN"]),r=new Set(["style"]),a=new DOMParser().parseFromString(t||"","text/html");return a.body.querySelectorAll("*").forEach(l=>{if(!s.has(l.tagName)){const o=l.parentNode;for(;l.firstChild;)o==null||o.insertBefore(l.firstChild,l);o==null||o.removeChild(l);return}[...l.attributes].forEach(o=>{const c=o.name.toLowerCase();r.has(c)||l.removeAttribute(o.name),c.startsWith("on")&&l.removeAttribute(o.name)})}),a.querySelectorAll("script").forEach(l=>l.remove()),a.body.innerHTML}catch{return(t||"").replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,"")}}function Wke({value:t,onChange:s}){const r=p.useRef(null),a=p.useRef("");p.useEffect(()=>{const l=r.current;if(!l)return;const o=QC(t||"");o!==a.current&&(l.innerHTML=o,a.current=o)},[t]);function i(l,o){try{document.execCommand(l,!1,o)}catch{}const c=r.current;if(c){const d=QC(c.innerHTML);a.current=d,s(d)}}return n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-1 border-b border-slate-100 p-2",children:[n.jsxs("button",{type:"button",onClick:()=>i("formatBlock","H1"),className:"inline-flex items-center gap-1 rounded-2xl border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"H1",children:[n.jsx(Ihe,{className:"h-3.5 w-3.5"})," H1"]}),n.jsxs("button",{type:"button",onClick:()=>i("bold"),className:"inline-flex items-center gap-1 rounded-2xl border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"Bold",children:[n.jsx(_de,{className:"h-3.5 w-3.5"})," B"]}),n.jsxs("button",{type:"button",onClick:()=>i("underline"),className:"inline-flex items-center gap-1 rounded-2xl border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"Underline",children:[n.jsx(Lhe,{className:"h-3.5 w-3.5"})," U"]}),n.jsxs("button",{type:"button",onClick:()=>i("insertUnorderedList"),className:"inline-flex items-center gap-1 rounded-2xl border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"Bullets",children:[n.jsx(hme,{className:"h-3.5 w-3.5"})," "]}),n.jsxs("button",{type:"button",onClick:()=>i("insertOrderedList"),className:"inline-flex items-center gap-1 rounded-2xl border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"Numbered list",children:[n.jsx(ume,{className:"h-3.5 w-3.5"})," 1."]}),n.jsxs("button",{type:"button",onClick:()=>i("removeFormat"),className:"inline-flex items-center gap-1 rounded-2xl border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"Clear formatting",children:[n.jsx(Sue,{className:"h-3.5 w-3.5"})," Clear"]}),n.jsxs("div",{className:"ml-auto text-[11px] text-slate-500",children:["(Saved as HTML inside ",n.jsx("span",{className:"font-semibold",children:"normal_range"}),")"]})]}),n.jsx("div",{ref:r,className:"min-h-[120px] p-3 text-sm text-slate-900 outline-none",contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{const l=r.current;if(!l)return;const o=QC(l.innerHTML);a.current=o,s(o)}})]})}function L8({value:t,onChange:s}){const[r,a]=p.useState("quick"),i=p.useMemo(()=>{const j=(t||"").trim();return j?fY(j)?gY(j):j:""},[t]),[l,o]=p.useState("M"),[c,d]=p.useState(""),[u,m]=p.useState(!1),x=["M","F","Male","Female","Men","Women","Adult","Child","Pediatric","Neonate","Pregnant","Ovulation peak","Follicular phase","Luteal Phase","Menopause"];function g(){const j=(c||"").trim();if(!j)return;const w=(l||"").trim();let S="";w?S=`${w} - ${j}`:S=j,u&&(S=` ${S}`);const E=[...D1(i),S];s(E.join(`
`)),d("")}function y(j){j.key==="Enter"&&(j.preventDefault(),g())}function v(j){const S=D1(i).filter((E,k)=>k!==j);s(S.join(`
`))}return n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-slate-800",children:"Normal Range"}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Enter quick lines like ",n.jsx("span",{className:"font-semibold",children:"M - 27-55"})," or paste full block."]})]}),n.jsx("div",{className:"flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 p-1",children:[{id:"quick",label:"Quick Add"},{id:"text",label:"Free Text"},{id:"rich",label:"Rich Editor"}].map(j=>n.jsx("button",{type:"button",onClick:()=>a(j.id),className:`rounded-full px-3 py-1 text-[11px] font-semibold transition ${r===j.id?"bg-slate-900 text-white":"text-slate-700 hover:bg-white"}`,children:j.label},j.id))})]}),r==="quick"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 md:grid-cols-12",children:[n.jsxs("div",{className:"md:col-span-3",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Prefix"}),n.jsx("input",{className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"M / F / Women / Week 5",value:l,onChange:j=>o(j.target.value),onKeyDown:y}),n.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:x.slice(0,8).map(j=>n.jsx("button",{type:"button",onClick:()=>o(j),className:"rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-700 hover:bg-slate-50",children:j},j))})]}),n.jsxs("div",{className:"md:col-span-7",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Value"}),n.jsx("input",{className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"27-55  OR  Ovulation peak: 6.3-24.0  OR  < 5.00",value:c,onChange:j=>d(j.target.value),onKeyDown:y}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("label",{className:"flex items-center gap-2 text-[11px] font-semibold text-slate-700",children:[n.jsx("input",{type:"checkbox",checked:u,onChange:j=>m(j.target.checked),className:"h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-200"}),"Bullet line"]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Press ",n.jsx("span",{className:"font-semibold",children:"Enter"})," to add"]})]})]}),n.jsx("div",{className:"md:col-span-2 flex items-end",children:n.jsxs("button",{type:"button",onClick:g,disabled:!c.trim(),className:"w-full inline-flex items-center justify-center gap-2 rounded-2xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:opacity-60",children:[n.jsx(ds,{className:"h-4 w-4"}),"Add"]})})]}),n.jsx("div",{className:"mt-3",children:D1(i).length?n.jsx("div",{className:"space-y-2",children:D1(i).map((j,w)=>n.jsxs("div",{className:"flex items-start justify-between gap-2 rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"min-w-0 whitespace-pre-line text-[11px] text-slate-700",children:j}),n.jsx("button",{type:"button",onClick:()=>v(w),className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl border border-slate-200 bg-white text-slate-600 hover:bg-slate-100",title:"Remove line",children:n.jsx(ts,{className:"h-4 w-4"})})]},`${w}-${j}`))}):n.jsx("div",{className:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-3 py-3 text-[11px] text-slate-500",children:"No normal range lines yet."})})]}),r==="text"&&n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Free text (multi-line)"}),n.jsx("textarea",{rows:7,className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:`Example:
Women
Ovulation peak: 6.3-24.0
Follicular phase
1st half: 3.9-12
2nd half: 2.9-9.0
...`,value:i,onChange:j=>s(j.target.value)}),n.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:"Tip: This matches your printed report style (line by line)."})]}),r==="rich"&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"mb-2 rounded-2xl border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-800",children:["Rich editor saves HTML inside ",n.jsx("span",{className:"font-semibold",children:"normal_range"}),". Your PDF/print should render HTML (or convert to text) to avoid showing tags."]}),n.jsx(Wke,{value:t||"",onChange:s})]})]})}function qke(){const{branding:t}=iu()||{},s=(t==null?void 0:t.primary_color)||Hke,r=P1(s,.1),a=P1(s,.06),i=ct("lis.masters.departments.view"),l=ct("lis.masters.departments.create"),o=ct("lis.masters.departments.update"),c=ct("lis.masters.departments.delete"),d=ct("lis.masters.services.view"),u=ct("lis.masters.services.create"),m=ct("lis.masters.services.update"),x=ct("lis.masters.services.delete"),[g,y]=p.useState([]),[v,j]=p.useState(!1),[w,S]=p.useState(""),[E,k]=p.useState(null),[A,I]=p.useState(!1),[P,O]=p.useState(null),[D,T]=p.useState(XC),[B,U]=p.useState(!1),[W,V]=p.useState([]),[R,F]=p.useState([]),[G,H]=p.useState(!1),[$,K]=p.useState(""),[le,se]=p.useState(!1),[J,ie]=p.useState(null),[te,ne]=p.useState(null),[q,ee]=p.useState(null),[X,Z]=p.useState(!1),[Y,Q]=p.useState(null);p.useEffect(()=>{F(ce=>{let Ce=!1;const ze=ce.map(Te=>Te!=null&&Te.__key?Te:(Ce=!0,{...I8,...Te,__key:O8()}));return Ce?ze:ce})},[R.length]);const oe=p.useMemo(()=>g.filter(ce=>!ce.parent_id),[g]),_e=p.useMemo(()=>{const ce={};return g.forEach(Ce=>{Ce.parent_id&&(ce[Ce.parent_id]||(ce[Ce.parent_id]=[]),ce[Ce.parent_id].push(Ce))}),ce},[g]),xe=p.useMemo(()=>{const ce=w.trim().toLowerCase();return ce?oe.filter(Ce=>[Ce.name,Ce.code].some(ze=>(ze||"").toString().toLowerCase().includes(ce))):oe},[w,oe]),me=p.useMemo(()=>g.find(ce=>ce.id===E)||null,[g,E]),Re=p.useMemo(()=>{const ce=$.trim().toLowerCase();return W.filter(Ce=>!le&&!Ce.is_active?!1:ce?[Ce.name,Ce.code,Ce.sample_type,Ce.method].some(ze=>(ze||"").toString().toLowerCase().includes(ce)):!0)},[W,$,le]);p.useEffect(()=>{i&&Ze()},[i]),p.useEffect(()=>{if(!me||!d){V([]),F([]),ie(null),ne(null),Q(null);return}$e(me.id)},[E,d,le]);async function Ze(){var ce;try{j(!0);const Ce=await Rke({active_only:!0});y(Ce.data||[]),!E&&((ce=Ce.data)!=null&&ce.length)&&k(Ce.data[0].id)}catch(Ce){console.error("Failed to load lab departments",Ce),ae.error("Failed to load lab departments")}finally{j(!1)}}async function $e(ce){try{H(!0);const Ce=await $ke({department_id:ce,active_only:!le});V(Ce.data||[]),F([]),ie(null),ne(null),Q(null)}catch(Ce){console.error("Failed to load lab services",Ce),ae.error("Failed to load lab services")}finally{H(!1)}}function fe(ce=null){O(null),T({...XC,parent_id:ce||""}),I(!0)}function Me(ce){O(ce),T({name:ce.name||"",code:ce.code||"",description:ce.description||"",parent_id:ce.parent_id||"",is_active:ce.is_active,display_order:ce.display_order??""}),I(!0)}function Ae(ce){const{name:Ce,value:ze,type:Te,checked:Nt}=ce.target;T(Jt=>({...Jt,[Ce]:Te==="checkbox"?Nt:ze}))}async function Ke(ce){var ze,Te;if(ce==null||ce.preventDefault(),!D.name.trim()){ae.error("Department name is required");return}const Ce={name:D.name.trim(),code:((ze=D.code)==null?void 0:ze.trim())||null,description:((Te=D.description)==null?void 0:Te.trim())||null,parent_id:D.parent_id||null,is_active:D.is_active,display_order:D.display_order!==""?Number(D.display_order):null};try{U(!0),P?(await Fke(P.id,Ce),ae.success("Department updated")):(await Lke(Ce),ae.success("Department created")),I(!1),O(null),T(XC),await Ze()}catch(Nt){console.error("Failed to save department",Nt),ae.error("Failed to save department")}finally{U(!1)}}async function Le(ce){if(window.confirm(`Delete department "${ce.name}"?`))try{await Bke(ce.id),ae.success("Department deleted"),ce.id===E&&k(null),await Ze()}catch(Ce){console.error("Failed to delete department",Ce),ae.error("Failed to delete department")}}const He=p.useCallback(ce=>{ce.stopPropagation()},[]),pt=p.useCallback(()=>{if(!me){ae.error("Select a department first");return}F(ce=>[...ce,{...I8,__key:O8()}])},[me]),Pe=p.useCallback((ce,Ce,ze)=>{F(Te=>Te.map(Nt=>Nt.__key===ce?{...Nt,[Ce]:ze}:Nt))},[]),bt=p.useCallback(ce=>{F(Ce=>Ce.map(ze=>ze.__key===ce?{...ze,__advanced:!ze.__advanced}:ze))},[]),It=p.useCallback(ce=>{F(Ce=>Ce.map(ze=>ze.__key===ce?{...ze,__rangeOpen:!ze.__rangeOpen}:ze))},[]),De=p.useCallback(ce=>{F(Ce=>Ce.filter(ze=>ze.__key!==ce))},[]);async function tt(){if(!me)return;const ce=R.map(Ce=>{var ze;return{name:(Ce.name||"").trim(),department_id:me.id,code:((ze=Ce.code)==null?void 0:ze.trim())||null,unit:(Ce.unit||"").trim()||"-",normal_range:(Ce.normal_range||"").trim()||"-",comments_template:(Ce.comments_template||"").trim()||null,sample_type:(Ce.sample_type||"").trim()||null,method:(Ce.method||"").trim()||null,display_order:Ce.display_order!==""?Number(Ce.display_order):null}}).filter(Ce=>Ce.name);if(!ce.length){ae.error("Add at least one row with Name");return}try{Z(!0),await zke(ce),ae.success("Services saved"),await $e(me.id)}catch(Ce){console.error("Failed to bulk-create services",Ce),ae.error("Failed to save services")}finally{Z(!1)}}function ve(ce){ie(ce.id),Q(null),ne({...ce,display_order:ce.display_order??"",normal_range:ce.normal_range??""})}function Ge(){ie(null),ne(null),Q(null)}function We(ce,Ce){ne(ze=>({...ze,[ce]:Ce}))}function Ve(ce){J===ce&&Q(Ce=>Ce===ce?null:ce)}async function Fe(){var Ce,ze,Te,Nt,Jt,ke;if(!J||!te)return;const ce={name:((Ce=te.name)==null?void 0:Ce.trim())||"",code:((ze=te.code)==null?void 0:ze.trim())||null,unit:((Te=te.unit)==null?void 0:Te.trim())||"-",normal_range:(te.normal_range||"").trim()||"-",sample_type:((Nt=te.sample_type)==null?void 0:Nt.trim())||null,method:((Jt=te.method)==null?void 0:Jt.trim())||null,comments_template:((ke=te.comments_template)==null?void 0:ke.trim())||null,is_active:!!te.is_active,display_order:te.display_order!==""?Number(te.display_order):null};if(!ce.name){ae.error("Service name is required");return}try{ee(J),await Uke(J,ce),ae.success("Service updated"),await $e(me.id),Ge()}catch(je){console.error("Failed to update service",je),ae.error("Failed to update service")}finally{ee(null)}}async function ot(ce){if(window.confirm(`Delete service "${ce.name}"?`))try{await Vke(ce.id),ae.success("Service deleted"),await $e(me.id)}catch(Ce){console.error("Failed to delete service",Ce),ae.error("Failed to delete service")}}function ft(ce){const Ce=_e[ce.id]||[],ze=ce.id===E;return n.jsxs("div",{className:"mb-1",children:[n.jsxs("div",{className:`group flex items-center justify-between rounded-2xl px-3 py-2 text-sm cursor-pointer border transition-all ${ze?"border-transparent":"border-transparent hover:border-slate-200"}`,style:{background:ze?`linear-gradient(180deg, ${P1(s,.12)}, rgba(255,255,255,0.55))`:"transparent"},onClick:()=>k(ce.id),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ti,{className:`h-3 w-3 text-slate-400 transition-transform ${Ce.length?"group-hover:translate-x-0.5":"opacity-0"}`}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-medium text-slate-800 flex items-center gap-2",children:[ce.name,!ce.is_active&&n.jsx("span",{className:"rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-700",children:"Inactive"})]}),ce.code&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Code: ",ce.code]})]})]}),(o||c)&&n.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[o&&n.jsx("button",{type:"button",onClick:Te=>{Te.stopPropagation(),Me(ce)},className:"inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-200 bg-white text-xs text-slate-600 hover:bg-slate-50",title:"Edit department",children:n.jsx(Yr,{className:"h-3 w-3"})}),c&&n.jsx("button",{type:"button",onClick:Te=>{Te.stopPropagation(),Le(ce)},className:"inline-flex h-7 w-7 items-center justify-center rounded-full border border-rose-100 bg-white text-xs text-rose-600 hover:bg-rose-50",title:"Delete department",children:n.jsx(Ms,{className:"h-3 w-3"})})]})]}),Ce.length>0&&n.jsx("div",{className:"ml-4 border-l border-dashed border-slate-200 pl-3",children:Ce.map(Te=>ft(Te))})]},ce.id)}return!i&&!d?n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-800",children:"You do not have permission to view LIS Masters."}):n.jsxs("div",{className:"flex h-full flex-col gap-4",children:[n.jsx("div",{className:"flex items-center justify-between gap-3",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl",style:{backgroundColor:P1(s,.12)},children:n.jsx(tl,{className:"h-5 w-5",style:{color:s}})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold text-slate-900",children:"Laboratory Report Masters"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Configure LIS departments and test master services for NABH-compliant lab reports."})]})]})}),n.jsxs("div",{className:"grid flex-1 gap-4 xl:grid-cols-[340px,1fr] lg:grid-cols-[300px,1fr]",children:[n.jsxs("div",{className:"flex flex-col rounded-3xl border border-slate-200/70 bg-white p-3 shadow-sm",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Departments & Sub-departments"}),l&&n.jsxs("button",{type:"button",onClick:()=>fe(null),className:"inline-flex items-center gap-1 rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-medium text-white shadow-sm hover:bg-slate-800",children:[n.jsx(ds,{className:"h-3 w-3"}),"Add"]})]}),n.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-2.5 top-2.5 h-3.5 w-3.5 text-slate-400"}),n.jsx("input",{type:"text",className:"h-8 w-full rounded-full border border-slate-200 bg-slate-50 pl-8 pr-3 text-xs text-slate-700 placeholder:text-slate-400 focus:border-slate-300 focus:bg-white focus:outline-none focus:ring-2 focus:ring-slate-100",placeholder:"Search departments...",value:w,onChange:ce=>S(ce.target.value)})]}),n.jsx("button",{type:"button",onClick:Ze,className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-500 hover:bg-slate-50",title:"Refresh",children:n.jsx(jh,{className:"h-3.5 w-3.5"})})]}),n.jsx("div",{className:"scrollbar-thin flex-1 overflow-y-auto rounded-3xl bg-slate-50/60 p-2",children:v?n.jsx("div",{className:"flex h-full items-center justify-center text-xs text-slate-500",children:"Loading departments"}):xe.length?xe.map(ce=>ft(ce)):n.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 py-8 text-center text-xs text-slate-500",children:[n.jsx(tl,{className:"h-4 w-4 text-slate-300"}),n.jsx("p",{children:"No departments yet."}),l&&n.jsxs("button",{type:"button",onClick:()=>fe(null),className:"mt-2 inline-flex items-center gap-1 rounded-full bg-slate-900 px-3 py-1.5 text-[11px] font-medium text-white hover:bg-slate-800",children:[n.jsx(ds,{className:"h-3 w-3"}),"Add first department"]})]})}),me&&l&&n.jsxs("button",{type:"button",onClick:()=>fe(me.id),className:"mt-3 inline-flex w-full items-center justify-center gap-1 rounded-3xl border border-dashed border-slate-300 bg-slate-50 px-3 py-2 text-[11px] font-medium text-slate-700 hover:bg-white",children:[n.jsx(ds,{className:"h-3 w-3"}),"Add sub-department under"," ",n.jsx("span",{className:"font-semibold",children:me.name})]})]}),n.jsxs("div",{className:"flex flex-col rounded-3xl border border-slate-200/70 bg-white p-3 shadow-sm",children:[n.jsxs("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:me?`Services for ${me.name}`:"Select a department"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Normal range is stored as a single field (supports multiline / optional rich text)."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(jr,{className:"pointer-events-none absolute left-2.5 top-2 h-3 w-3 text-slate-400"}),n.jsx("input",{type:"text",className:"h-8 w-44 rounded-full border border-slate-200 bg-slate-50 pl-7 pr-3 text-xs text-slate-700 placeholder:text-slate-400 focus:border-slate-300 focus:bg-white focus:outline-none focus:ring-2 focus:ring-slate-100",placeholder:"Filter services",value:$,onChange:ce=>K(ce.target.value),disabled:!me||!d})]}),n.jsxs("button",{type:"button",className:`inline-flex items-center gap-1 rounded-full border px-3 py-1.5 text-[11px] font-medium ${le?"border-slate-800 bg-slate-900 text-white":"border-slate-200 bg-white text-slate-600"}`,onClick:()=>se(ce=>!ce),disabled:!me||!d,children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-amber-400"}),"Inactive"]})]})]}),me&&u&&n.jsxs("div",{className:"mb-3 overflow-hidden rounded-3xl border border-slate-200/70 shadow-sm",style:{backgroundImage:`linear-gradient(180deg, ${r}, rgba(255,255,255,0.92))`},children:[n.jsxs("div",{className:"flex flex-col gap-2 border-b border-slate-200/70 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Bulk Add"}),n.jsx("div",{className:"text-xs text-slate-600",children:"Main: Name / Code / Unit / Normal Range / Comments."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs text-slate-700",style:{backgroundColor:a},children:[" Dept:"," ",n.jsx("span",{className:"font-semibold",children:me.name})]}),n.jsxs("span",{className:"rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs text-slate-700",children:["Rows: ",n.jsx("span",{className:"font-semibold",children:R.length})]}),n.jsxs("button",{type:"button",onClick:pt,className:"inline-flex items-center gap-2 rounded-2xl bg-slate-900 px-3 py-2 text-xs font-semibold text-white hover:bg-slate-800",children:[n.jsx(ds,{className:"h-4 w-4"}),"Add Row"]}),n.jsxs("button",{type:"button",onClick:tt,disabled:!R.length||X,className:"inline-flex items-center gap-2 rounded-2xl bg-emerald-600 px-3 py-2 text-xs font-semibold text-white hover:bg-emerald-700 disabled:opacity-60",children:[X?n.jsx(jh,{className:"h-4 w-4 animate-spin"}):n.jsx(Pi,{className:"h-4 w-4"}),"Save All"]})]})]}),n.jsx("div",{className:"px-4 py-4",children:R.length?n.jsxs("div",{className:"grid gap-3",children:[n.jsxs("div",{className:"hidden xl:grid grid-cols-12 gap-3 px-2 text-[11px] font-semibold text-slate-600",children:[n.jsx("div",{className:"col-span-4",children:"Name *"}),n.jsx("div",{className:"col-span-2",children:"Code"}),n.jsx("div",{className:"col-span-2",children:"Unit"}),n.jsx("div",{className:"col-span-2",children:"Normal Range"}),n.jsx("div",{className:"col-span-2 text-right",children:"Actions"})]}),R.map(ce=>{var ze;const Ce=R8(ce.normal_range);return n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white/75 p-3 shadow-[0_6px_18px_rgba(15,23,42,0.06)]",onKeyDownCapture:He,children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 xl:grid-cols-12 xl:gap-3",children:[n.jsxs("div",{className:"xl:col-span-4",children:[n.jsx("label",{className:"xl:hidden text-[11px] font-semibold text-slate-600",children:"Name *"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Service name (required)",value:ce.name,onChange:Te=>Pe(ce.__key,"name",Te.target.value)})]}),n.jsxs("div",{className:"xl:col-span-2",children:[n.jsx("label",{className:"xl:hidden text-[11px] font-semibold text-slate-600",children:"Code"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Optional",value:ce.code,onChange:Te=>Pe(ce.__key,"code",Te.target.value)})]}),n.jsxs("div",{className:"xl:col-span-2",children:[n.jsx("label",{className:"xl:hidden text-[11px] font-semibold text-slate-600",children:"Unit"}),n.jsx("input",{className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"-",value:ce.unit,onChange:Te=>Pe(ce.__key,"unit",Te.target.value)})]}),n.jsxs("div",{className:"xl:col-span-2",children:[n.jsx("label",{className:"xl:hidden text-[11px] font-semibold text-slate-600",children:"Normal Range"}),n.jsx("button",{type:"button",onClick:()=>It(ce.__key),className:"w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-left hover:bg-slate-50",title:Ce==="-"?"":Ce,children:n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-700",children:(ze=ce.normal_range)!=null&&ze.trim()?"Edit normal range":"Add normal range"}),n.jsx("div",{className:"truncate text-[11px] text-slate-500",children:Ce})]}),ce.__rangeOpen?n.jsx(el,{className:"h-4 w-4 text-slate-500"}):n.jsx(Gn,{className:"h-4 w-4 text-slate-500"})]})})]}),n.jsxs("div",{className:"xl:col-span-2 flex items-center justify-between xl:justify-end gap-2",children:[n.jsx("button",{type:"button",onClick:()=>bt(ce.__key),className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50",children:ce.__advanced?n.jsxs(n.Fragment,{children:[n.jsx(el,{className:"h-4 w-4"})," Details"]}):n.jsxs(n.Fragment,{children:[n.jsx(Gn,{className:"h-4 w-4"})," Details"]})}),n.jsx("button",{type:"button",onClick:()=>De(ce.__key),className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-slate-200 bg-white text-slate-700 hover:bg-slate-50",title:"Remove row",children:n.jsx(ts,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Comments"}),n.jsx("input",{className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Optional default comments for report",value:ce.comments_template,onChange:Te=>Pe(ce.__key,"comments_template",Te.target.value)})]}),ce.__rangeOpen&&n.jsx("div",{className:"mt-3",children:n.jsx(L8,{value:ce.normal_range,onChange:Te=>Pe(ce.__key,"normal_range",Te)})}),ce.__advanced&&n.jsxs("div",{className:"mt-3 rounded-3xl border border-slate-200 bg-slate-50/60 p-3",children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Sample Type"}),n.jsx("input",{className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Serum / Plasma",value:ce.sample_type,onChange:Te=>Pe(ce.__key,"sample_type",Te.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Method"}),n.jsx("input",{className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Analyzer / Manual",value:ce.method,onChange:Te=>Pe(ce.__key,"method",Te.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Display Order"}),n.jsx("input",{className:"mt-1 w-full rounded-2xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none focus:border-slate-300 focus:ring-4 focus:ring-slate-200/60",placeholder:"Optional",inputMode:"numeric",value:ce.display_order,onChange:Te=>{const Nt=Te.target.value;/^[0-9]*$/.test(Nt)&&Pe(ce.__key,"display_order",Nt)}})]})]}),n.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:"Advanced fields are optional  keep default entry fast and clean."})]})]},ce.__key)})]}):n.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white/70 p-6 text-center text-sm text-slate-600",children:["Click ",n.jsx("span",{className:"font-semibold",children:"Add Row"})," to start adding tests."]})})]}),n.jsx("div",{className:"scrollbar-thin flex-1 overflow-auto rounded-3xl border border-slate-100",children:me?G?n.jsx("div",{className:"flex h-full items-center justify-center text-xs text-slate-500",children:"Loading services"}):n.jsxs("table",{className:"min-w-full border-separate border-spacing-0 text-xs",children:[n.jsx("thead",{className:"sticky top-0 z-10 bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"#"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Service Name"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Code"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Unit"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Normal Range"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Sample Type"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Method"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Comments"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-medium text-slate-600",children:"Active"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-right font-medium text-slate-600",children:"Actions"})]})}),n.jsxs("tbody",{children:[Re.map((ce,Ce)=>{const ze=J===ce.id,Te=ze?te:ce,Nt=R8(Te==null?void 0:Te.normal_range),Jt=Y===ce.id;return n.jsxs(p.Fragment,{children:[n.jsxs("tr",{className:Ce%2?"bg-slate-50/40":"bg-white",children:[n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5 text-[11px] text-slate-500",children:Ce+1}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("input",{type:"text",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-1 focus:ring-slate-200 disabled:bg-slate-50",value:(Te==null?void 0:Te.name)||"",onChange:ke=>We("name",ke.target.value),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("input",{type:"text",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-1 focus:ring-slate-200 disabled:bg-slate-50",value:(Te==null?void 0:Te.code)||"",onChange:ke=>We("code",ke.target.value),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("input",{type:"text",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-1 focus:ring-slate-200 disabled:bg-slate-50",placeholder:"-",value:(Te==null?void 0:Te.unit)||"",onChange:ke=>We("unit",ke.target.value),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"min-w-0 flex-1",children:n.jsx("div",{className:"truncate text-[11px] text-slate-700",title:Nt==="-"?"":Nt,children:Nt})}),ze&&m?n.jsx("button",{type:"button",onClick:()=>Ve(ce.id),className:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-1 text-[11px] font-semibold text-slate-700 hover:bg-slate-50",title:"Edit normal range",children:Jt?n.jsxs(n.Fragment,{children:[n.jsx(el,{className:"h-3 w-3"})," Range"]}):n.jsxs(n.Fragment,{children:[n.jsx(Gn,{className:"h-3 w-3"})," Range"]})}):null]})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("input",{type:"text",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-1 focus:ring-slate-200 disabled:bg-slate-50",value:(Te==null?void 0:Te.sample_type)||"",onChange:ke=>We("sample_type",ke.target.value),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("input",{type:"text",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-1 focus:ring-slate-200 disabled:bg-slate-50",value:(Te==null?void 0:Te.method)||"",onChange:ke=>We("method",ke.target.value),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("textarea",{rows:1,className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-1 focus:ring-slate-200 disabled:bg-slate-50",value:(Te==null?void 0:Te.comments_template)||"",onChange:ke=>We("comments_template",ke.target.value),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5",children:n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-slate-900 focus:ring-slate-200",checked:!!(Te!=null&&Te.is_active),onChange:ke=>We("is_active",ke.target.checked),disabled:!m||!ze})}),n.jsx("td",{className:"border-b border-slate-100 px-3 py-1.5 text-right",children:n.jsxs("div",{className:"flex justify-end gap-1",children:[m&&n.jsx(n.Fragment,{children:ze?n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:Fe,disabled:q===ce.id,className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-emerald-600 text-white hover:bg-emerald-700 disabled:cursor-not-allowed disabled:bg-emerald-400",title:"Save",children:n.jsx(Pi,{className:"h-3 w-3"})}),n.jsx("button",{type:"button",onClick:Ge,className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-slate-100 text-slate-500 hover:bg-slate-200",title:"Cancel",children:n.jsx(ts,{className:"h-3 w-3"})})]}):n.jsx("button",{type:"button",onClick:()=>ve(ce),className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200",title:"Edit",children:n.jsx(Yr,{className:"h-3 w-3"})})}),x&&n.jsx("button",{type:"button",onClick:()=>ot(ce),className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-rose-50 text-rose-600 hover:bg-rose-100",title:"Delete",children:n.jsx(Ms,{className:"h-3 w-3"})})]})})]}),ze&&Jt&&n.jsx("tr",{className:Ce%2?"bg-slate-50/40":"bg-white",children:n.jsx("td",{colSpan:10,className:"border-b border-slate-100 px-3 py-3",children:n.jsx(L8,{value:te==null?void 0:te.normal_range,onChange:ke=>{We("normal_range",ke)}})})})]},ce.id)}),!Re.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:10,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"No services found for this department."})})]})]}):n.jsx("div",{className:"flex h-full items-center justify-center text-xs text-slate-500",children:"Select a department on the left to view / add services."})})]})]}),A&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 p-4",children:n.jsxs("div",{className:"w-full max-w-md rounded-3xl bg-white shadow-xl",children:[n.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 px-4 py-3",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:P?"Edit Department":"Add Department"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:D.parent_id?"This will be created as a sub-department.":"Top level department."})]}),n.jsx("button",{type:"button",onClick:()=>{I(!1),O(null)},className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl bg-slate-100 text-slate-500 hover:bg-slate-200",children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("form",{onSubmit:Ke,className:"space-y-3 px-4 py-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-[11px] font-medium text-slate-700",children:["Department name ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{name:"name",type:"text",className:"w-full rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-200/60",value:D.name,onChange:Ae,required:!0})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Code"}),n.jsx("input",{name:"code",type:"text",className:"w-full rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-200/60",value:D.code,onChange:Ae})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Display Order"}),n.jsx("input",{name:"display_order",type:"number",className:"w-full rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-200/60",value:D.display_order||"",onChange:Ae})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Parent Department (for sub-department)"}),n.jsxs("select",{name:"parent_id",className:"w-full rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-200/60",value:D.parent_id||"",onChange:Ae,children:[n.jsx("option",{value:"",children:"None (Top level)"}),oe.map(ce=>n.jsx("option",{value:ce.id,children:ce.name},ce.id))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Description"}),n.jsx("textarea",{name:"description",rows:2,className:"w-full rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-800 focus:border-slate-300 focus:outline-none focus:ring-4 focus:ring-slate-200/60",value:D.description,onChange:Ae})]}),n.jsxs("div",{className:"flex items-center justify-between pt-1",children:[n.jsxs("label",{className:"flex items-center gap-2 text-[12px] text-slate-700",children:[n.jsx("input",{type:"checkbox",name:"is_active",className:"h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-200",checked:D.is_active,onChange:Ae}),"Active department"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{type:"button",onClick:()=>{I(!1),O(null)},className:"inline-flex items-center rounded-2xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Cancel"}),n.jsxs("button",{type:"submit",disabled:B,className:"inline-flex items-center gap-2 rounded-2xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800 disabled:opacity-60",children:[B&&n.jsx(jh,{className:"h-4 w-4 animate-spin"}),P?"Update":"Save"]})]})]})]})]})})]})}const F8=t=>t?new Date(t).toLocaleString():"",Gke=t=>{if(!t)return"";const s=String(t).trim();if(s.toUpperCase().startsWith("LAB-"))return s;const r=Number(s);return Number.isFinite(r)?`LAB-${String(r).padStart(6,"0")}`:s},B8=t=>{const s=(t??"").toString().replace(/\r\n/g,`
`).trim();return!s||s==="-"?"":s.includes(`
`)?s:s.includes(";")?s.split(";").map(r=>r.trim()).filter(Boolean).join(`
`):s};function $8({flag:t}){const s=(t||"").toString().trim().toUpperCase();if(!s)return null;const r=s.startsWith("H")?"border-rose-200 bg-rose-50 text-rose-700":s.startsWith("L")?"border-amber-200 bg-amber-50 text-amber-800":"border-slate-200 bg-slate-50 text-slate-700";return n.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-semibold ${r}`,children:s})}function Kke(){var m;const{id:t}=Cm(),s=Qr(),[r,a]=p.useState(!1),[i,l]=p.useState(null);p.useEffect(()=>{(async()=>{var g,y;a(!0);try{const{data:v}=await Q2e(t);l(v)}catch(v){console.error(v),ae.error(((y=(g=v==null?void 0:v.response)==null?void 0:g.data)==null?void 0:y.detail)||"Failed to load report")}finally{a(!1)}})()},[t]);const o=p.useMemo(()=>{if(!(i!=null&&i.sections))return[];const x=[];return i.sections.forEach(g=>{(g.rows||[]).forEach(y=>{x.push({department_name:g.department_name||"",sub_department_name:g.sub_department_name||"",...y})})}),x},[i]),c=async()=>{var x,g,y;try{const v=await he.get(`/lab/orders/${t}/report-pdf`,{responseType:"blob"}),j=new Blob([v.data],{type:"application/pdf"}),w=URL.createObjectURL(j);window.open(w,"_blank")}catch(v){console.error("PDF download error",v);const j=(x=v==null?void 0:v.response)==null?void 0:x.status;j===401?ae.error("Session expired. Please login again."):j===403?ae.error("You do not have permission to view this report."):ae.error(((y=(g=v==null?void 0:v.response)==null?void 0:g.data)==null?void 0:y.detail)||"Failed to download PDF")}},d=()=>window.print();if(r&&!i)return n.jsx("div",{className:"p-6 text-sm text-slate-600",children:"Loading report"});if(!i)return n.jsx("div",{className:"p-6 text-sm text-slate-600",children:"Report not found"});const u=Gke(i.lab_no||i.order_id);return n.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-900 print:bg-white",children:[n.jsx("div",{className:"sticky top-0 z-20 border-b border-slate-200/70 bg-white/80 backdrop-blur print:hidden",children:n.jsxs("div",{className:"mx-auto max-w-5xl px-3 md:px-6 py-3 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("button",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-white hover:bg-slate-50",onClick:()=>s(-1),title:"Back",children:n.jsx(Hl,{className:"h-4 w-4 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Xn,{className:"h-4 w-4 text-slate-600"}),n.jsx("div",{className:"text-sm font-semibold truncate",children:"Lab Report"}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-semibold text-emerald-700",children:[n.jsx(ny,{className:"h-3 w-3"}),"Print View"]})]}),n.jsxs("div",{className:"text-[11px] text-slate-500 truncate",children:[i.patient_name||"","  ",u]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{className:"inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50",onClick:d,children:[n.jsx(Ll,{className:"h-4 w-4"}),"Print"]}),n.jsxs("button",{className:"inline-flex items-center gap-2 rounded-2xl bg-slate-900 px-3 py-2 text-xs font-semibold text-white hover:bg-slate-800",onClick:c,children:[n.jsx(nn,{className:"h-4 w-4"}),"Download PDF"]})]})]})}),n.jsxs("div",{className:"mx-auto max-w-5xl px-3 md:px-6 py-4 print:p-0",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-200/70 bg-white shadow-sm print:shadow-none print:border-0 overflow-hidden",children:[n.jsx("div",{className:"border-b border-slate-100 px-4 md:px-6 py-4",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"LABORATORY REPORT"}),n.jsx("div",{className:"text-xl font-semibold tracking-tight",children:u}),n.jsxs("div",{className:"mt-1 text-[12px] text-slate-600",children:["Patient: ",n.jsx("span",{className:"font-semibold text-slate-900",children:i.patient_name||""})]})]}),n.jsxs("div",{className:"text-[11px] text-slate-600 space-y-1 md:text-right",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"UHID:"})," ",i.patient_uhid||""]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"Received:"})," ",F8(i.received_on)]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold text-slate-700",children:"Reported:"})," ",F8(i.reported_on)]})]})]})}),n.jsx("div",{className:"px-4 md:px-6 py-4 border-b border-slate-100",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-[12px]",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase",children:"Patient"}),n.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-3 gap-y-1 text-[12px]",children:[n.jsx("div",{className:"text-slate-500",children:"Name"}),n.jsx("div",{className:"font-semibold",children:i.patient_name||""}),n.jsx("div",{className:"text-slate-500",children:"Gender"}),n.jsx("div",{className:"font-semibold",children:i.patient_gender||""}),n.jsx("div",{className:"text-slate-500",children:"Age"}),n.jsx("div",{className:"font-semibold",children:i.patient_age_text||""})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase",children:"Order"}),n.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-3 gap-y-1 text-[12px]",children:[n.jsx("div",{className:"text-slate-500",children:"Type"}),n.jsx("div",{className:"font-semibold",children:i.patient_type||""}),n.jsx("div",{className:"text-slate-500",children:"Referred By"}),n.jsx("div",{className:"font-semibold",children:i.referred_by||""}),n.jsx("div",{className:"text-slate-500",children:"Bill No"}),n.jsx("div",{className:"font-semibold",children:i.bill_no||""})]})]})]})}),n.jsx("div",{className:"px-4 md:px-6 py-5 space-y-5",children:(m=i.sections)!=null&&m.length?i.sections.map((x,g)=>n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-2",children:n.jsxs("div",{className:"text-xs font-semibold text-slate-800",children:[x.department_name||"Department",x.sub_department_name?` / ${x.sub_department_name}`:""]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-[12px] border border-slate-200 rounded-2xl overflow-hidden",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-600",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Test"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Result"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Unit"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Normal Range"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Flag"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Comments"})]})}),n.jsxs("tbody",{children:[(x.rows||[]).map((y,v)=>n.jsxs("tr",{className:"hover:bg-slate-50/60",children:[n.jsx("td",{className:"border-t border-slate-200 px-3 py-2 font-medium",children:y.service_name||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:y.result_value||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2 text-slate-700",children:y.unit||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:n.jsx("div",{className:"whitespace-pre-line leading-4 text-slate-700",children:B8(y.normal_range)})}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:n.jsx($8,{flag:y.flag})}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2 text-slate-700",children:y.comments||""})]},v)),(!x.rows||x.rows.length===0)&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"border-t border-slate-200 px-3 py-6 text-center text-slate-400",children:"No services configured for this panel."})})]})]})})]},`${x.department_id}-${x.sub_department_id}-${g}`)):n.jsx("div",{className:"text-sm text-slate-500",children:"No results available for this order."})}),n.jsxs("div",{className:"px-4 md:px-6 pb-6",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Latest Results Summary"}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-[12px] border border-slate-200 rounded-2xl overflow-hidden",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-600",children:n.jsxs("tr",{children:[n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Department"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Sub-Department"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Test"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Result"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Unit"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Normal Range"}),n.jsx("th",{className:"border-b border-slate-200 px-3 py-2 text-left font-semibold",children:"Flag"})]})}),n.jsx("tbody",{children:o.length?o.map((x,g)=>n.jsxs("tr",{className:"hover:bg-slate-50/60",children:[n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:x.department_name||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:x.sub_department_name||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2 font-medium",children:x.service_name||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:x.result_value||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:x.unit||""}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:n.jsx("div",{className:"whitespace-pre-line leading-4 text-slate-700",children:B8(x.normal_range)})}),n.jsx("td",{className:"border-t border-slate-200 px-3 py-2",children:n.jsx($8,{flag:x.flag})})]},g)):n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"border-t border-slate-200 px-3 py-6 text-center text-slate-400",children:"No results to summarise."})})})]})}),n.jsxs("div",{className:"mt-8 grid grid-cols-2 gap-8 text-[12px] text-slate-700",children:[n.jsx("div",{className:"text-center",children:n.jsx("div",{className:"border-t border-slate-300 pt-3",children:"Technician / Lab In-charge"})}),n.jsx("div",{className:"text-center",children:n.jsx("div",{className:"border-t border-slate-300 pt-3",children:"Pathologist / Authorized Signatory"})})]})]})]}),n.jsx("style",{children:`
          @media print {
            .page-break { page-break-after: always; }
            thead { display: table-header-group; }
            tr { page-break-inside: avoid; }
          }
        `})]})]})}function vP({modality:t}){const s=String(t||"").toUpperCase(),a={XR:"bg-sky-50 text-sky-700 border-sky-200",CT:"bg-purple-50 text-purple-700 border-purple-200",MRI:"bg-indigo-50 text-indigo-700 border-indigo-200",USG:"bg-emerald-50 text-emerald-700 border-emerald-200",MAMMO:"bg-rose-50 text-rose-700 border-rose-200"}[s]||"bg-gray-50 text-gray-700 border-gray-200";return n.jsx("span",{className:`inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-medium ${a}`,children:s||""})}function Yke({onClose:t,onCreated:s}){const[r,a]=p.useState(null),[i,l]=p.useState([]),[o,c]=p.useState(""),[d,u]=p.useState(!1),[m,x]=p.useState("routine"),[g,y]=p.useState("");p.useEffect(()=>{let j=!1;return(async()=>{const{data:S}=await xP({q:o});j||l(Array.isArray(S)?S:(S==null?void 0:S.items)||[])})(),()=>{j=!0}},[o]);const v=async()=>{var j,w;if(!r)return ae.error("Select a patient");if(!g)return ae.error("Select a test");u(!0);try{const{data:S}=await vK({patient_id:r,test_id:Number(g),priority:m});ae.success(`Order #${S==null?void 0:S.id} created`),s==null||s(S),t==null||t()}catch(S){ae.error(((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to create order")}finally{u(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"Create Radiology Order"}),n.jsx(W2,{value:r,onChange:a}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"md:col-span-2 space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Test"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{className:"input",placeholder:"Search tests",value:o,onChange:j=>c(j.target.value)}),n.jsxs("select",{className:"input",value:g,onChange:j=>y(j.target.value),children:[n.jsx("option",{value:"",children:"Select"}),i.map(j=>n.jsxs("option",{value:j.id,children:[j.code,"  ",j.name," ",j.modality?`(${j.modality})`:""]},j.id))]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Priority"}),n.jsxs("select",{className:"input",value:m,onChange:j=>x(j.target.value),children:[n.jsx("option",{value:"routine",children:"Routine"}),n.jsx("option",{value:"urgent",children:"Urgent"}),n.jsx("option",{value:"stat",children:"STAT"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[n.jsx("button",{className:"btn-ghost",onClick:t,children:"Cancel"}),n.jsx("button",{className:"btn",onClick:v,disabled:d,children:d?"Creating":"Create Order"})]})]})}function bo(...t){return t.filter(Boolean).join(" ")}function bY(t){return t==null?"":String(t)}function Xke(t){if(!t)return"";const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const r=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");return`${r}-${a}-${i}`}function yY(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toLocaleString()}function Nl(t){return bY(t).toLowerCase().trim()}function Qke(t,s){const r=c=>`"${String(c??"").replace(/"/g,'""')}"`,a=s.map(c=>c.map(r).join(",")).join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(i),o=document.createElement("a");o.href=l,o.download=t,o.click(),URL.revokeObjectURL(l)}function Zke(t,s=350){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}function vY({open:t,onClose:s,children:r}){return n.jsx(on,{children:t&&n.jsx(mt.div,{className:"fixed inset-0 z-[100] flex items-end justify-center bg-black/40 p-3 backdrop-blur-xl md:items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onMouseDown:a=>{a.target===a.currentTarget&&(s==null||s())},children:r})})}function Jke({open:t,title:s,subtitle:r,onClose:a,children:i,maxWidth:l="max-w-4xl"}){return n.jsx(vY,{open:t,onClose:a,children:n.jsxs(mt.div,{initial:{opacity:0,y:12,scale:.985},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:12,scale:.985},transition:{duration:.16},className:bo("w-full rounded-[28px] border border-white/60 bg-white/75 shadow-2xl ring-1 ring-black/5","supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",l),children:[n.jsxs("div",{className:"flex items-start gap-3 border-b border-black/5 px-4 py-4 md:px-5",children:[n.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-900 text-white shadow-sm",children:n.jsx($n,{className:"h-4 w-4"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-[15px] font-semibold text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:r}):null]}),n.jsx("button",{type:"button",onClick:a,className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-black/50 bg-white/70 text-slate-700 hover:bg-white",children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsx("div",{className:"p-4 md:p-5",children:i})]})})}function e5e({open:t,title:s,subtitle:r,onClose:a,children:i}){return n.jsx(vY,{open:t,onClose:a,children:n.jsxs(mt.div,{initial:{opacity:0,y:18,scale:.99},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:18,scale:.99},transition:{duration:.16},className:bo("w-full rounded-[28px] border border-white/60 bg-white/75 shadow-2xl ring-1 ring-black/5","supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl","max-w-xl"),children:[n.jsxs("div",{className:"flex items-start gap-3 border-b border-black/5 px-4 py-4",children:[n.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-900 text-white shadow-sm",children:n.jsx(ZE,{className:"h-4 w-4"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-[15px] font-semibold text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:r}):null]}),n.jsx("button",{type:"button",onClick:a,className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-black/50 bg-white/70 text-slate-700 hover:bg-white",children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsx("div",{className:"p-4",children:i})]})})}const t5e=["ordered","scheduled","checked_in","in_progress","completed","reported","cancelled"],s5e=["XR","CT","MRI","USG","CR","DX","MAMMO","PET","ECHO"],n5e=["routine","urgent","stat"];function r5e(){const[t,s]=p.useState([]),[r,a]=p.useState(!0),[i,l]=p.useState(""),o=Zke(i,320),[c,d]=p.useState([]),[u,m]=p.useState([]),[x,g]=p.useState("all"),[y,v]=p.useState("all"),[j,w]=p.useState(""),[S,E]=p.useState(""),[k,A]=p.useState("created_at"),[I,P]=p.useState("desc"),[O,D]=p.useState(()=>localStorage.getItem("ris.orders.view")||"table"),[T,B]=p.useState(!1),[U,W]=p.useState(()=>{try{return JSON.parse(localStorage.getItem("ris.orders.savedViews")||"[]")}catch{return[]}}),[V,R]=p.useState(""),[F,G]=p.useState(!1),[H,$]=p.useState(!1),K=p.useRef(null),le=async({silent:Z=!1}={})=>{var Y,Q;Z||a(!0);try{const{data:oe}=await jK({q:o,page_size:500}),_e=Array.isArray(oe)?oe:(oe==null?void 0:oe.items)||[];s(_e)}catch(oe){ae.error(((Q=(Y=oe==null?void 0:oe.response)==null?void 0:Y.data)==null?void 0:Q.detail)||"Failed to load orders")}finally{Z||a(!1)}};p.useEffect(()=>{le()},[o]),p.useEffect(()=>{localStorage.setItem("ris.orders.view",O)},[O]),p.useEffect(()=>{const Z=Y=>{var Q,oe;Y.key==="/"&&!Y.metaKey&&!Y.ctrlKey&&!Y.altKey&&(Y.preventDefault(),(oe=(Q=K.current)==null?void 0:Q.focus)==null||oe.call(Q)),Y.key==="n"&&(Y.metaKey||Y.ctrlKey)&&(Y.preventDefault(),G(!0)),Y.key==="Escape"&&$(!1)};return window.addEventListener("keydown",Z),()=>window.removeEventListener("keydown",Z)},[]),p.useEffect(()=>{if(!T)return;const Z=setInterval(()=>le({silent:!0}),15e3);return()=>clearInterval(Z)},[T,o]);const se=p.useMemo(()=>{const Z=new Set(t5e),Y=new Set(s5e),Q=new Set(n5e);return t.forEach(oe=>{oe!=null&&oe.status&&Z.add(String(oe.status)),oe!=null&&oe.modality&&Y.add(String(oe.modality)),oe!=null&&oe.priority&&Q.add(String(oe.priority))}),{statuses:Array.from(Z),modalities:Array.from(Y),priorities:Array.from(Q)}},[t]),J=p.useMemo(()=>{const Z=new Date,Y=new Date(Z.getFullYear(),Z.getMonth(),Z.getDate()),Q=new Date(Y);Q.setDate(Q.getDate()-(Q.getDay()+6)%7);const oe=new Date(Z.getFullYear(),Z.getMonth(),1),_e=$e=>{if(!$e)return!1;const fe=new Date($e);if(Number.isNaN(fe.getTime()))return!1;if(y==="today")return fe>=Y;if(y==="last24")return fe>=new Date(Date.now()-24*60*60*1e3);if(y==="week")return fe>=Q;if(y==="month")return fe>=oe;if(y==="custom"){const Me=j?new Date(j+"T00:00:00"):null,Ae=S?new Date(S+"T23:59:59"):null;return!(Me&&fe<Me||Ae&&fe>Ae)}return!0},xe=Nl(o);let me=t;if(xe&&(me=me.filter($e=>{const fe=[$e==null?void 0:$e.id,$e==null?void 0:$e.patient_id,$e==null?void 0:$e.uhid,$e==null?void 0:$e.patient_uhid,$e==null?void 0:$e.patient_name,$e==null?void 0:$e.name,$e==null?void 0:$e.test_name,$e==null?void 0:$e.test_code,$e==null?void 0:$e.modality,$e==null?void 0:$e.priority,$e==null?void 0:$e.status].map(Me=>bY(Me)).join("  ");return Nl(fe).includes(xe)})),c.length){const $e=new Set(c.map(fe=>Nl(fe)));me=me.filter(fe=>$e.has(Nl(fe==null?void 0:fe.status)))}if(u.length){const $e=new Set(u.map(fe=>Nl(fe)));me=me.filter(fe=>$e.has(Nl(fe==null?void 0:fe.modality)))}x!=="all"&&(me=me.filter($e=>Nl(($e==null?void 0:$e.priority)||"routine")===Nl(x))),y!=="all"&&(me=me.filter($e=>_e($e==null?void 0:$e.created_at)));const Re=I==="asc"?1:-1,Ze=$e=>k==="created_at"?new Date(($e==null?void 0:$e.created_at)||0).getTime():k==="status"?Nl($e==null?void 0:$e.status):k==="priority"?Nl(($e==null?void 0:$e.priority)||"routine"):k==="modality"?Nl($e==null?void 0:$e.modality):new Date(($e==null?void 0:$e.created_at)||0).getTime();return me=[...me].sort(($e,fe)=>{const Me=Ze($e),Ae=Ze(fe);return Me<Ae?-1*Re:Me>Ae?1*Re:0}),me},[t,o,c,u,x,y,j,S,k,I]),ie=p.useMemo(()=>{const Z=J.length,Y=J.filter(oe=>!["completed","reported","cancelled"].includes(Nl(oe==null?void 0:oe.status))).length,Q=J.filter(oe=>["urgent","stat"].includes(Nl(oe==null?void 0:oe.priority))).length;return{total:Z,pending:Y,urgent:Q}},[J]),te=()=>{d([]),m([]),g("all"),v("all"),w(""),E(""),A("created_at"),P("desc"),R(""),ae.message("Filters cleared")},ne=Z=>{v(Z),Z!=="custom"&&(w(""),E(""))},q=()=>{const Z=prompt("Save view as (example: Pending CT Today)");if(!(Z!=null&&Z.trim()))return;const Y={id:String(Date.now()),name:Z.trim(),filters:{q:i,status:c,modality:u,priority:x,datePreset:y,fromDate:j,toDate:S,sortKey:k,sortDir:I,view:O}},Q=[Y,...U].slice(0,12);W(Q),localStorage.setItem("ris.orders.savedViews",JSON.stringify(Q)),R(Y.id),ae.success("View saved")},ee=Z=>{const Y=U.find(oe=>oe.id===Z);if(!Y)return;const Q=Y.filters||{};l(Q.q??""),d(Q.status??[]),m(Q.modality??[]),g(Q.priority??"all"),v(Q.datePreset??"all"),w(Q.fromDate??""),E(Q.toDate??""),A(Q.sortKey??"created_at"),P(Q.sortDir??"desc"),D(Q.view??"table"),R(Z),ae.message(`Loaded: ${Y.name}`)},X=()=>{const Z=["Order ID","Patient ID","Modality","Priority","Status","Created At"],Y=J.map(Q=>[(Q==null?void 0:Q.id)??"",(Q==null?void 0:Q.patient_id)??"",(Q==null?void 0:Q.modality)??"",(Q==null?void 0:Q.priority)??"routine",(Q==null?void 0:Q.status)??"",(Q==null?void 0:Q.created_at)??""]);Qke(`ris-orders-${Xke(new Date)}.csv`,[Z,...Y]),ae.success("CSV downloaded")};return n.jsx("div",{className:"min-h-[calc(100vh-40px)] text-slate-900",children:n.jsxs("div",{className:"relative overflow-hidden rounded-[28px] border border-slate-500 bg-slate-50 p-3 md:p-5",children:[n.jsx("div",{className:"pointer-events-none absolute -top-24 left-1/2 h-72 w-[820px] -translate-x-1/2 rounded-full bg-sky-200/40 blur-3xl"}),n.jsx("div",{className:"pointer-events-none absolute -bottom-28 left-10 h-72 w-72 rounded-full bg-emerald-200/35 blur-3xl"}),n.jsx("div",{className:"pointer-events-none absolute -bottom-28 right-10 h-72 w-72 rounded-full bg-purple-200/30 blur-3xl"}),n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:bo("rounded-[26px] border border-white/60 bg-white/70 p-4 shadow-sm ring-1 ring-black/5","supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl"),children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(jn,{className:"h-4 w-4"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"truncate text-[16px] font-semibold tracking-tight md:text-[18px]",children:"Radiology Orders"}),n.jsx("p",{className:"mt-0.5 text-[12px] text-slate-600",children:"Book  Track  Scan  Report  with fast filters and saved views."})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-[11px]",children:[n.jsx(ZC,{label:"Total",value:ie.total}),n.jsx(ZC,{label:"Pending",value:ie.pending,tone:"amber"}),n.jsx(ZC,{label:"Urgent/STAT",value:ie.urgent,tone:"rose"}),n.jsxs("div",{className:"ml-1 inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/70 px-3 py-1.5",children:[n.jsx("input",{type:"checkbox",checked:T,onChange:Z=>B(Z.target.checked)}),n.jsx("span",{className:"text-slate-700",children:"Auto refresh"})]})]})]}),n.jsxs("div",{className:"flex w-full flex-col gap-2 md:w-auto md:min-w-[520px]",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-500"}),n.jsx("input",{ref:K,className:bo("h-10 w-full rounded-2xl border border-black/50 bg-white/70 pl-10 pr-3 text-[13px]","outline-none ring-0 focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60"),placeholder:"Search test / UHID / name / order   ( / to focus )",value:i,onChange:Z=>l(Z.target.value)})]}),n.jsx("button",{type:"button",className:"inline-flex h-10 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:()=>le(),title:"Refresh",children:n.jsx(jh,{className:bo("h-4 w-4",r&&"animate-spin")})}),n.jsxs("button",{type:"button",className:"inline-flex h-10 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white md:hidden",onClick:()=>$(!0),children:[n.jsx(jr,{className:"h-4 w-4"}),"Filters"]}),n.jsx(Wn,{anyOf:["orders.ris.create","radiology.orders.create"],children:n.jsxs("button",{className:"inline-flex h-10 items-center gap-2 rounded-2xl bg-slate-900 px-4 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800",onClick:()=>G(!0),title:"New order (Ctrl/Cmd + N)",children:[n.jsx(ds,{className:"h-4 w-4"}),"New Order"]})})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsx(a5e,{onPick:Z=>{Z.status&&d(Z.status),Z.priority&&g(Z.priority),Z.datePreset&&ne(Z.datePreset),Z.modality&&m(Z.modality)}}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("select",{className:"h-9 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",value:V,onChange:Z=>{const Y=Z.target.value;R(Y),Y&&ee(Y)},children:[n.jsx("option",{value:"",children:"Saved views"}),U.map(Z=>n.jsx("option",{value:Z.id,children:Z.name},Z.id))]}),n.jsx("button",{type:"button",className:"h-9 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:q,children:"Save view"}),n.jsx("button",{type:"button",className:"h-9 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:X,children:n.jsxs("span",{className:"inline-flex items-center gap-2",children:[n.jsx(nn,{className:"h-4 w-4"}),"CSV"]})}),n.jsxs("div",{className:"inline-flex h-9 overflow-hidden rounded-2xl border border-black/50 bg-white/70",children:[n.jsxs("button",{type:"button",className:bo("inline-flex items-center gap-2 px-3 text-[12px] font-semibold",O==="table"?"bg-white text-slate-900":"text-slate-700 hover:bg-white/70"),onClick:()=>D("table"),children:[n.jsx(rme,{className:"h-4 w-4"}),"Table"]}),n.jsxs("button",{type:"button",className:bo("inline-flex items-center gap-2 px-3 text-[12px] font-semibold",O==="cards"?"bg-white text-slate-900":"text-slate-700 hover:bg-white/70"),onClick:()=>D("cards"),children:[n.jsx(sme,{className:"h-4 w-4"}),"Cards"]})]})]})]})]})]})}),n.jsxs("div",{className:"mt-4 flex flex-col gap-3 md:flex-row",children:[n.jsx("div",{className:"hidden w-[320px] shrink-0 md:block",children:n.jsx(z8,{statuses:se.statuses,modalities:se.modalities,status:c,setStatus:d,modality:u,setModality:m,priority:x,setPriority:g,datePreset:y,setDatePreset:ne,fromDate:j,setFromDate:w,toDate:S,setToDate:E,sortKey:k,setSortKey:A,sortDir:I,setSortDir:P,onClear:te})}),n.jsx("div",{className:"min-w-0 flex-1",children:n.jsxs("div",{className:bo("rounded-[26px] border border-white/60 bg-white/70 shadow-sm ring-1 ring-black/5","supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl"),children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 border-b border-black/5 px-4 py-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Results"}),n.jsxs("div",{className:"mt-0.5 text-[12px] text-slate-600",children:["Showing ",n.jsx("span",{className:"font-semibold text-slate-900",children:J.length})," order(s)"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{type:"button",className:"hidden h-9 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white md:inline-flex",onClick:()=>$(!0),children:[n.jsx(ZE,{className:"h-4 w-4"}),"Filters"]}),n.jsx("button",{type:"button",className:"h-9 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:()=>te(),children:"Clear"})]})]}),r?n.jsx("div",{className:"p-4",children:n.jsx(o5e,{})}):O==="cards"?n.jsx(l5e,{rows:J}):n.jsx(i5e,{rows:J})]})})]}),n.jsxs(e5e,{open:H,title:"Advanced Filters",subtitle:"Filter by date, status, modality, priority and sort.",onClose:()=>$(!1),children:[n.jsx(z8,{statuses:se.statuses,modalities:se.modalities,status:c,setStatus:d,modality:u,setModality:m,priority:x,setPriority:g,datePreset:y,setDatePreset:ne,fromDate:j,setFromDate:w,toDate:S,setToDate:E,sortKey:k,setSortKey:A,sortDir:I,setSortDir:P,onClear:te}),n.jsx("div",{className:"mt-3 flex justify-end gap-2",children:n.jsx("button",{type:"button",className:"h-10 rounded-2xl border border-black/50 bg-white/70 px-4 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:()=>$(!1),children:"Done"})})]}),n.jsx(Jke,{open:F,title:"New Radiology Order",subtitle:"Create an order, pick patient + test, set modality/priority.",onClose:()=>G(!1),maxWidth:"max-w-3xl",children:n.jsx(Yke,{onClose:()=>G(!1),onCreated:()=>{G(!1),le()}})})]})})}function ZC({label:t,value:s,tone:r="slate"}){const a=r==="amber"?"border-amber-200 bg-amber-50 text-amber-800":r==="rose"?"border-rose-200 bg-rose-50 text-rose-800":"border-slate-500 bg-slate-50 text-slate-800";return n.jsxs("span",{className:bo("inline-flex items-center gap-2 rounded-full border px-3 py-1.5",a),children:[n.jsx("span",{className:"text-[11px]",children:t}),n.jsx("span",{className:"text-[11px] font-semibold",children:s})]})}function a5e({onPick:t}){const s="inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/70 px-3 py-1.5 text-[11px] font-semibold text-slate-800 hover:bg-white";return n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("button",{type:"button",className:s,onClick:()=>t({datePreset:"today"}),children:[n.jsx(Ds,{className:"h-4 w-4"}),"Today"]}),n.jsx("button",{type:"button",className:s,onClick:()=>t({datePreset:"week"}),children:"This week"}),n.jsx("button",{type:"button",className:s,onClick:()=>t({status:["ordered","scheduled","checked_in","in_progress"]}),children:"Pending"}),n.jsx("button",{type:"button",className:s,onClick:()=>t({priority:"urgent"}),children:"Urgent"}),n.jsx("button",{type:"button",className:s,onClick:()=>t({modality:["CT"]}),children:"CT"}),n.jsx("button",{type:"button",className:s,onClick:()=>t({modality:["MRI"]}),children:"MRI"})]})}function z8({statuses:t,modalities:s,status:r,setStatus:a,modality:i,setModality:l,priority:o,setPriority:c,datePreset:d,setDatePreset:u,fromDate:m,setFromDate:x,toDate:g,setToDate:y,sortKey:v,setSortKey:j,sortDir:w,setSortDir:S,onClear:E}){const k="rounded-[22px] border border-black/50 bg-white/70 p-3 shadow-sm ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl";return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:k,children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Date"}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[n.jsx(so,{active:d==="all",onClick:()=>u("all"),children:"All"}),n.jsx(so,{active:d==="today",onClick:()=>u("today"),children:"Today"}),n.jsx(so,{active:d==="last24",onClick:()=>u("last24"),children:"Last 24h"}),n.jsx(so,{active:d==="week",onClick:()=>u("week"),children:"This week"}),n.jsx(so,{active:d==="month",onClick:()=>u("month"),children:"This month"}),n.jsx(so,{active:d==="custom",onClick:()=>u("custom"),children:"Custom"})]}),d==="custom"?n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-14 text-[11px] text-slate-600",children:"From"}),n.jsx("input",{type:"date",className:"h-9 flex-1 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",value:m,onChange:A=>x(A.target.value)})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-14 text-[11px] text-slate-600",children:"To"}),n.jsx("input",{type:"date",className:"h-9 flex-1 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",value:g,onChange:A=>y(A.target.value)})]})]}):null]}),n.jsxs("div",{className:k,children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Status"}),n.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.map(A=>n.jsx(so,{active:r.includes(A),onClick:()=>{a(r.includes(A)?r.filter(I=>I!==A):[...r,A])},children:A},A))})]}),n.jsxs("div",{className:k,children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Modality"}),n.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:s.map(A=>n.jsx(so,{active:i.includes(A),onClick:()=>{l(i.includes(A)?i.filter(I=>I!==A):[...i,A])},children:A},A))})]}),n.jsxs("div",{className:k,children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Priority"}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[n.jsx(so,{active:o==="all",onClick:()=>c("all"),children:"All"}),n.jsx(so,{active:o==="routine",onClick:()=>c("routine"),children:"Routine"}),n.jsx(so,{active:o==="urgent",onClick:()=>c("urgent"),children:"Urgent"}),n.jsx(so,{active:o==="stat",onClick:()=>c("stat"),children:"STAT"})]})]}),n.jsxs("div",{className:k,children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Sort"}),n.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[n.jsxs("select",{className:"h-9 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",value:v,onChange:A=>j(A.target.value),children:[n.jsx("option",{value:"created_at",children:"Created time"}),n.jsx("option",{value:"status",children:"Status"}),n.jsx("option",{value:"priority",children:"Priority"}),n.jsx("option",{value:"modality",children:"Modality"})]}),n.jsxs("div",{className:"inline-flex h-9 overflow-hidden rounded-2xl border border-black/50 bg-white/70",children:[n.jsx("button",{type:"button",className:bo("flex-1 text-[12px] font-semibold",w==="desc"?"bg-white text-slate-900":"text-slate-700 hover:bg-white/70"),onClick:()=>S("desc"),children:"Newest"}),n.jsx("button",{type:"button",className:bo("flex-1 text-[12px] font-semibold",w==="asc"?"bg-white text-slate-900":"text-slate-700 hover:bg-white/70"),onClick:()=>S("asc"),children:"Oldest"})]})]})]}),n.jsx("button",{type:"button",className:"h-10 w-full rounded-2xl border border-black/50 bg-white/70 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:E,children:"Clear all filters"})]})}function so({active:t,children:s,onClick:r}){return n.jsx("button",{type:"button",onClick:r,className:bo("rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",t?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/70 text-slate-800 hover:bg-white"),children:s})}function i5e({rows:t}){return n.jsx("div",{className:"w-full overflow-x-auto",children:n.jsxs("table",{className:"min-w-[980px] w-full text-[13px]",children:[n.jsx("thead",{className:"bg-white/40 text-[12px] text-slate-600",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Order"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Patient"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Modality"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Priority"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"}),n.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Created"}),n.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Actions"})]})}),n.jsx("tbody",{children:t.length?t.map(s=>n.jsxs("tr",{className:"border-t border-black/5 hover:bg-white/40",children:[n.jsx("td",{className:"px-4 py-3",children:n.jsx(q2,{order:s,to:`/ris/orders/${s.id}`,prefix:"RAD"})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(nf,{patientId:s.patient_id})}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(vP,{modality:s.modality})}),n.jsx("td",{className:"px-4 py-3 capitalize",children:s.priority||"routine"}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(jb,{status:s.status})}),n.jsx("td",{className:"px-4 py-3",children:yY(s.created_at)}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsx(ul,{to:`/ris/orders/${s.id}`,className:"inline-flex h-9 items-center justify-center rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",children:"View"})})]},s.id)):n.jsx("tr",{children:n.jsx("td",{className:"px-4 py-10 text-center text-[13px] text-slate-600",colSpan:7,children:"No orders found."})})})]})})}function l5e({rows:t}){return n.jsx("div",{className:"p-3",children:t.length?n.jsx("div",{className:"flex flex-col gap-3",children:t.map(s=>n.jsx("div",{className:"rounded-[22px] border border-black/50 bg-white/70 p-3 shadow-sm ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(q2,{order:s,to:`/ris/orders/${s.id}`,prefix:"RAD"}),n.jsx(vP,{modality:s.modality}),n.jsx("span",{className:"text-[12px] capitalize text-slate-700",children:s.priority||"routine"}),n.jsx(jb,{status:s.status})]}),n.jsxs("div",{className:"mt-2 text-[12px] text-slate-600",children:[n.jsx("span",{className:"font-semibold text-slate-900",children:"Created:"})," ",yY(s.created_at)]}),n.jsx("div",{className:"mt-2",children:n.jsx(nf,{patientId:s.patient_id})})]}),n.jsx(ul,{to:`/ris/orders/${s.id}`,className:"inline-flex h-9 shrink-0 items-center justify-center rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",children:"View"})]})},s.id))}):n.jsx("div",{className:"rounded-2xl border border-dashed border-black/50 bg-white/40 p-8 text-center text-[13px] text-slate-600",children:"No orders found."})})}function o5e(){const t=()=>n.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-black/50 bg-white/60 p-3",children:[n.jsx("div",{className:"h-9 w-24 rounded-xl bg-slate-200/60"}),n.jsx("div",{className:"h-9 w-40 rounded-xl bg-slate-200/60"}),n.jsx("div",{className:"h-9 w-20 rounded-xl bg-slate-200/60"}),n.jsx("div",{className:"h-9 w-24 rounded-xl bg-slate-200/60"}),n.jsx("div",{className:"ml-auto h-9 w-20 rounded-xl bg-slate-200/60"})]});return n.jsxs("div",{className:"space-y-2",children:[n.jsx(t,{}),n.jsx(t,{}),n.jsx(t,{}),n.jsx(t,{})]})}function Ku(...t){return t.filter(Boolean).join(" ")}const c5e={initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.22,ease:"easeOut"}};function d5e(t){const[s,r]=p.useState(!1);return p.useEffect(()=>{var a;try{const i=window.matchMedia(t),l=()=>r(!!i.matches);return l(),(a=i.addEventListener)==null||a.call(i,"change",l),()=>{var o;return(o=i.removeEventListener)==null?void 0:o.call(i,"change",l)}}catch{return}},[t]),s}function u5e(){return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-[radial-gradient(1200px_circle_at_20%_10%,rgba(56,189,248,0.18),transparent_55%),radial-gradient(900px_circle_at_80%_20%,rgba(99,102,241,0.12),transparent_60%),radial-gradient(900px_circle_at_30%_90%,rgba(16,185,129,0.10),transparent_55%)]"}),n.jsx("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-slate-50"})]})}function m5e({message:t}){return t?n.jsxs("div",{className:"flex items-start gap-2 rounded-[22px] border border-rose-200/70 bg-rose-50/70 px-4 py-3 text-xs font-semibold text-rose-700 shadow-sm backdrop-blur-xl",children:[n.jsx(Vs,{className:"mt-0.5 h-4 w-4"}),n.jsx("div",{className:"min-w-0",children:t})]}):null}function JC({children:t,onClick:s,disabled:r,className:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:Ku("inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-4 py-2 text-xs font-semibold text-slate-800 shadow-sm backdrop-blur-xl transition active:scale-[0.99] disabled:opacity-50","hover:bg-white/90 hover:shadow",a),children:t})}function ek({children:t,onClick:s,disabled:r,className:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:Ku("inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white shadow-sm transition active:scale-[0.99] disabled:opacity-50","hover:bg-slate-800 hover:shadow",a),children:t})}function h5e({children:t,onClick:s,disabled:r,className:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:Ku("inline-flex items-center gap-2 rounded-full bg-rose-600 px-4 py-2 text-xs font-semibold text-white shadow-sm transition active:scale-[0.99] disabled:opacity-50","hover:bg-rose-700 hover:shadow",a),children:t})}function x5e({value:t,onChange:s,placeholder:r}){return n.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-3 py-2 shadow-sm backdrop-blur-xl",children:[n.jsx(IV,{className:"h-4 w-4 text-slate-500"}),n.jsx("input",{value:t,onChange:a=>s==null?void 0:s(a.target.value),placeholder:r,className:"w-full bg-transparent text-xs font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none"}),t?n.jsx("button",{type:"button",onClick:()=>s==null?void 0:s(""),className:"inline-flex h-7 w-7 items-center justify-center rounded-full hover:bg-white/70",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})}):null]})}function tk({label:t,value:s,onChange:r,placeholder:a,type:i="text",required:l}){return n.jsxs("label",{className:"space-y-1",children:[n.jsxs("div",{className:"text-[11px] font-semibold text-slate-600",children:[t," ",l?n.jsx("span",{className:"text-rose-600",children:"*"}):null]}),n.jsx("input",{type:i,value:s??"",required:l,placeholder:a,onChange:o=>r==null?void 0:r(o.target.value),className:"w-full rounded-2xl border border-white/60 bg-white/70 px-3 py-2 text-sm font-medium text-slate-900 placeholder:text-slate-400 shadow-sm backdrop-blur-xl focus:outline-none focus:ring-2 focus:ring-sky-400/35"})]})}function p5e({label:t,value:s,onChange:r,options:a=[],placeholder:i="Select",required:l}){return n.jsxs("label",{className:"space-y-1",children:[n.jsxs("div",{className:"text-[11px] font-semibold text-slate-600",children:[t," ",l?n.jsx("span",{className:"text-rose-600",children:"*"}):null]}),n.jsxs("div",{className:"relative",children:[n.jsxs("select",{value:s??"",required:l,onChange:o=>r==null?void 0:r(o.target.value),className:"w-full appearance-none rounded-2xl border border-white/60 bg-white/70 px-3 py-2 pr-9 text-sm font-medium text-slate-900 shadow-sm backdrop-blur-xl focus:outline-none focus:ring-2 focus:ring-sky-400/35",children:[n.jsx("option",{value:"",children:i}),a.map(o=>n.jsx("option",{value:o.value,children:o.label},String(o.value)))]}),n.jsx(Gn,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-500"})]})]})}function f5e({open:t,title:s,subtitle:r,onClose:a,children:i}){const l=d5e("(min-width: 768px)");p.useEffect(()=>{if(!t)return;const c=d=>d.key==="Escape"&&(a==null?void 0:a());return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[t,a]);const o=l?{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.98}}:{initial:{opacity:0,y:18},animate:{opacity:1,y:0},exit:{opacity:0,y:18}};return n.jsx(on,{children:t?n.jsx(mt.div,{className:"fixed inset-0 z-[90] flex items-end justify-center bg-white/65 p-3 backdrop-blur-sm md:items-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onMouseDown:c=>{c.target===c.currentTarget&&(a==null||a())},children:n.jsxs(mt.div,{...o,transition:{duration:.18,ease:"easeOut"},className:"w-full max-w-[680px] rounded-[30px] border border-white/50 bg-white/88 p-4 shadow-2xl backdrop-blur-2xl md:p-5",onMouseDown:c=>c.stopPropagation(),children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-[22px] bg-slate-900 text-white",children:n.jsx(Yr,{className:"h-5 w-5"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[11px] font-medium text-slate-600",children:r}):null]}),n.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-[20px] border border-white/60 bg-white/70 text-slate-700 shadow-sm backdrop-blur-xl hover:bg-white/90",onClick:a,children:n.jsx(ts,{className:"h-5 w-5"})})]}),n.jsx("div",{className:"mt-4",children:i})]})}):null})}function g5e({modality:t}){const s=String(t||"").toUpperCase();let r="border-slate-500/70 bg-slate-100/70 text-slate-700";return s==="XR"||s==="X-RAY"||s==="XRAY"?r="border-sky-200/70 bg-sky-50/70 text-sky-700":s==="CT"?r="border-indigo-200/70 bg-indigo-50/70 text-indigo-700":s==="MRI"?r="border-purple-200/70 bg-purple-50/70 text-purple-700":s==="USG"||s==="US"||s==="ULTRASOUND"?r="border-emerald-200/70 bg-emerald-50/70 text-emerald-700":(s==="MAMMO"||s==="MG")&&(r="border-amber-200/70 bg-amber-50/70 text-amber-700"),n.jsx("span",{className:Ku("inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold",r),children:s})}const sk=[{value:"XR",label:"XR (X-Ray)"},{value:"CT",label:"CT"},{value:"MRI",label:"MRI"},{value:"USG",label:"USG (Ultrasound)"},{value:"MG",label:"MG (Mammogram)"},{value:"FLUORO",label:"FLUORO"},{value:"DEXA",label:"DEXA"},{value:"NUC",label:"NUC (Nuclear)"},{value:"OTHER",label:"Other"}];function b5e(){const[t,s]=p.useState([]),[r,a]=p.useState(!0),[i,l]=p.useState(""),[o,c]=p.useState(""),[d,u]=p.useState("all"),[m,x]=p.useState("name"),[g,y]=p.useState("asc"),[v,j]=p.useState(!1),[w,S]=p.useState(null),[E,k]=p.useState({code:"",name:"",modality:"",price:""}),[A,I]=p.useState(!1),P=async()=>{var F,G;a(!0),l("");try{const{data:H}=await xP({q:(o==null?void 0:o.trim())||void 0,page_size:200}),$=Array.isArray(H)?H:(H==null?void 0:H.items)||[];s($)}catch(H){l(((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to load RIS tests.")}finally{a(!1)}};p.useEffect(()=>{P()},[o]);const O=p.useMemo(()=>{const F=Array.from(new Set((t||[]).map($=>String($.modality||"").trim()).filter(Boolean).map($=>$.toUpperCase()))),G=sk.map($=>$.value);return Array.from(new Set([...G,...F])).filter(Boolean).map($=>{const K=sk.find(le=>le.value===$);return{value:$,label:(K==null?void 0:K.label)||$}})},[t]),D=p.useMemo(()=>{let F=t||[];d!=="all"&&(F=F.filter(H=>String(H.modality||"").toUpperCase()===d));const G=g==="desc"?-1:1;return F=[...F].sort((H,$)=>{if(m==="price")return(Number(H.price||0)-Number($.price||0))*G;const K=String(H[m]||"").toLowerCase(),le=String($[m]||"").toLowerCase();return K.localeCompare(le)*G}),F},[t,d,m,g]),T=p.useMemo(()=>{const F=(t==null?void 0:t.length)||0,G=(D==null?void 0:D.length)||0,H=new Map;for(const K of t||[]){const le=String(K.modality||"").toUpperCase()||"";H.set(le,(H.get(le)||0)+1)}const $=Array.from(H.entries()).sort((K,le)=>le[1]-K[1]).slice(0,5);return{total:F,shown:G,top:$}},[t,D]),B=()=>{S(null),k({code:"",name:"",modality:"",price:""}),j(!0)},U=F=>{S(F),k({code:F.code||"",name:F.name||"",modality:F.modality?String(F.modality).toUpperCase():"",price:F.price??""}),j(!0)},W=()=>{S(null),k({code:"",name:"",modality:"",price:""}),j(!1),I(!1)},V=async()=>{var K,le;const F=String(E.code||"").trim(),G=String(E.name||"").trim(),H=String(E.modality||"").trim(),$=E.price===""||E.price==null?0:Number(E.price);if(!F)return ae.error("Code is required");if(!G)return ae.error("Name is required");if(Number.isNaN($)||$<0)return ae.error("Price must be a valid number (>= 0)");I(!0);try{const se={code:F,name:G,modality:H||void 0,price:$};w!=null&&w.id?(await e_e(w.id,se),ae.success("Updated")):(await J2e(se),ae.success("Created")),W(),await P()}catch(se){ae.error(((le=(K=se==null?void 0:se.response)==null?void 0:K.data)==null?void 0:le.detail)||"Save failed")}finally{I(!1)}},R=async F=>{var G,H;if(window.confirm(`Delete ${F.code}?`))try{await t_e(F.id),ae.success("Deleted"),await P()}catch($){ae.error(((H=(G=$==null?void 0:$.response)==null?void 0:G.data)==null?void 0:H.detail)||"Delete failed")}};return n.jsxs(Wn,{anyOf:["radiology.masters.manage","masters.ris.manage","radiology.masters.view","masters.ris.view"],children:[n.jsx(u5e,{}),n.jsxs("div",{className:"min-h-screen px-3 py-3 text-slate-900 md:px-6 md:py-6",children:[n.jsxs(mt.div,{...c5e,className:"mx-auto w-full max-w-[1600px] rounded-[32px] border border-white/60 bg-white/55 p-4 shadow-[0_30px_120px_-80px_rgba(15,23,42,0.55)] backdrop-blur-2xl md:p-6",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-[24px] bg-slate-900 text-white shadow-sm",children:n.jsx(IV,{className:"h-5 w-5"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("h1",{className:"text-lg font-semibold tracking-tight text-slate-900 md:text-xl",children:["RIS Masters ",n.jsx("span",{className:"text-slate-400",children:""})," Radiology Tests"]}),n.jsx("p",{className:"mt-1 text-[11px] font-medium text-slate-600 md:text-xs",children:"Apple-premium master UI: search, filter by modality, quick stats, create/edit via glass modal."})]})]}),n.jsxs("div",{className:"flex flex-col gap-2 md:items-end",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(x5e,{value:o,onChange:c,placeholder:"Search code / name"}),n.jsx(Wn,{anyOf:["radiology.masters.manage","masters.ris.manage"],children:n.jsxs(ek,{onClick:B,children:[n.jsx(ds,{className:"h-4 w-4"}),"New Test"]})})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"rounded-full border border-white/60 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:["Total: ",n.jsx("span",{className:"text-slate-900",children:T.total})]}),n.jsxs("span",{className:"rounded-full border border-white/60 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:["Showing: ",n.jsx("span",{className:"text-slate-900",children:T.shown})]}),T.top.map(([F,G])=>n.jsxs("span",{className:"rounded-full border border-white/60 bg-white/60 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:[F,": ",n.jsx("span",{className:"text-slate-900",children:G})]},F))]})]})]}),i?n.jsx("div",{className:"mt-4",children:n.jsx(m5e,{message:i})}):null,n.jsxs("div",{className:"mt-5 flex flex-col gap-3 rounded-[26px] border border-white/60 bg-white/45 p-3 shadow-sm backdrop-blur-2xl md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:[n.jsx(jr,{className:"h-4 w-4"}),n.jsx("span",{children:"Modality"}),n.jsx("div",{className:"inline-flex rounded-full bg-white/70 p-1",children:n.jsx("button",{type:"button",onClick:()=>u("all"),className:Ku("rounded-full px-3 py-1.5 text-[11px] font-semibold transition",d==="all"?"bg-slate-900 text-white":"text-slate-700 hover:bg-white"),children:"All"})})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:O.map(F=>n.jsx("button",{type:"button",onClick:()=>u(F.value),className:Ku("rounded-full border px-3 py-2 text-[11px] font-semibold shadow-sm backdrop-blur-xl transition active:scale-[0.99]",d===F.value?"border-slate-900 bg-slate-900 text-white":"border-white/60 bg-white/70 text-slate-800 hover:bg-white/90"),children:F.label},F.value))})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/70 px-3 py-2 text-[11px] font-semibold text-slate-700 shadow-sm backdrop-blur-xl",children:[n.jsx(jn,{className:"h-4 w-4"}),n.jsx("span",{children:"Sort"}),n.jsx("div",{className:"inline-flex rounded-full bg-white/70 p-1",children:[{k:"name",label:"Name"},{k:"code",label:"Code"},{k:"price",label:"Price"}].map(F=>n.jsx("button",{type:"button",onClick:()=>x(F.k),className:Ku("rounded-full px-3 py-1.5 text-[11px] font-semibold transition",m===F.k?"bg-slate-900 text-white":"text-slate-700 hover:bg-white"),children:F.label},F.k))}),n.jsx("button",{type:"button",onClick:()=>y(F=>F==="asc"?"desc":"asc"),className:"rounded-full border border-white/60 bg-white/70 px-3 py-1.5 text-[11px] font-semibold text-slate-800 hover:bg-white/90",title:"Toggle direction",children:g==="asc"?"Asc":"Desc"})]}),n.jsxs(JC,{onClick:P,disabled:r,children:[n.jsx(Rt,{className:Ku("h-4 w-4",r&&"animate-spin")}),"Refresh"]})]})]}),n.jsx("div",{className:"mt-4 overflow-hidden rounded-[28px] border border-white/60 bg-white/55 shadow-sm backdrop-blur-2xl",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-[980px] w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-white/40 text-xs font-semibold text-slate-500",children:[n.jsx("th",{className:"px-4 py-3 text-left",children:"Code"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Name"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Modality"}),n.jsx("th",{className:"px-4 py-3 text-left",children:"Price"}),n.jsx("th",{className:"px-4 py-3 text-right w-[260px]",children:"Actions"})]})}),n.jsxs("tbody",{children:[r?n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-4 py-6",children:n.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-600",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Loading tests"]})})}):null,!r&&D.map(F=>n.jsxs("tr",{className:"border-t border-white/50 hover:bg-white/35",children:[n.jsx("td",{className:"px-4 py-3 font-semibold text-slate-900",children:F.code}),n.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-slate-900",children:F.name}),n.jsx("td",{className:"px-4 py-3",children:n.jsx(g5e,{modality:F.modality})}),n.jsxs("td",{className:"px-4 py-3 font-semibold text-slate-900",children:[" ",Number(F.price||0).toFixed(2)]}),n.jsx("td",{className:"px-4 py-3 text-right",children:n.jsx(Wn,{anyOf:["radiology.masters.manage","masters.ris.manage"],children:n.jsxs("div",{className:"inline-flex items-center justify-end gap-2",children:[n.jsxs(JC,{onClick:()=>U(F),children:[n.jsx(Yr,{className:"h-4 w-4"})," Edit"]}),n.jsxs(h5e,{onClick:()=>R(F),children:[n.jsx(Ms,{className:"h-4 w-4"})," Delete"]})]})})})]},F.id)),!r&&D.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-4 py-10 text-center",children:n.jsxs("div",{className:"mx-auto max-w-md space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No tests found"}),n.jsx("div",{className:"text-xs font-medium text-slate-600",children:"Try clearing search/filter, or create a new test."}),n.jsx(Wn,{anyOf:["radiology.masters.manage","masters.ris.manage"],children:n.jsx("div",{className:"pt-2",children:n.jsxs(ek,{onClick:B,children:[n.jsx(ds,{className:"h-4 w-4"})," New Test"]})})})]})})}):null]})]})})})]}),n.jsxs(f5e,{open:v,title:w?`Edit Test  ${w.code}`:"New RIS Test",subtitle:"Keep code short (e.g., CT_BRAIN), modality standard (XR/CT/MRI/USG). Price used for billing.",onClose:()=>A?null:W(),children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(tk,{label:"Test code",required:!0,value:E.code,onChange:F=>k(G=>({...G,code:F})),placeholder:"e.g. CT_BRAIN"}),n.jsx(tk,{label:"Test name",required:!0,value:E.name,onChange:F=>k(G=>({...G,name:F})),placeholder:"e.g. CT Brain Plain"}),n.jsx(p5e,{label:"Modality",value:E.modality,onChange:F=>k(G=>({...G,modality:F})),options:sk,placeholder:"(Optional) Select modality"}),n.jsx(tk,{label:"Price ()",type:"number",value:E.price,onChange:F=>k(G=>({...G,price:F})),placeholder:"e.g. 1800"})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-semibold text-slate-900",children:[n.jsx(So,{className:"h-4 w-4 text-slate-600"}),"Validations: code + name required, price  0."]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(JC,{onClick:W,disabled:A,children:[n.jsx(ts,{className:"h-4 w-4"})," Cancel"]}),n.jsxs(ek,{onClick:V,disabled:A,children:[n.jsx(Pi,{className:"h-4 w-4"}),A?"Saving":w?"Save changes":"Create test"]})]})]})]})]})]})}const U8=t=>t?new Date(t).toLocaleString():"";function y5e(...t){return t.filter(Boolean).join(" ")}function M1(t=""){try{const r=String(t).split("?")[0].split("/");return decodeURIComponent(r[r.length-1]||"file")}catch{return"file"}}function v5e(t=""){const r=String(t).split("?")[0].toLowerCase().match(/\.([a-z0-9]+)$/i);return r?r[1]:""}function I1(t="",s=""){const r=v5e(s||t);return["png","jpg","jpeg","gif","webp","bmp","svg"].includes(r)?"image":["pdf"].includes(r)?"pdf":["mp4","mov","webm","mkv"].includes(r)?"video":["mp3","wav","ogg","m4a"].includes(r)?"audio":"file"}function j5e({kind:t}){const s="h-4 w-4";return t==="image"?n.jsx(TV,{className:s}):t==="pdf"?n.jsx(Xn,{className:s}):t==="video"?n.jsx(Hhe,{className:s}):t==="audio"?n.jsx(_me,{className:s}):n.jsx(Xn,{className:s})}function N5e({open:t,title:s,subtitle:r,onClose:a,children:i}){return t?n.jsx("div",{className:"fixed inset-0 z-[100] flex items-end justify-center bg-black/40 p-3 backdrop-blur-xl md:items-center",onMouseDown:l=>{l.target===l.currentTarget&&(a==null||a())},children:n.jsxs("div",{className:"w-full max-w-xl rounded-[28px] border border-white/50 bg-white/70 shadow-2xl ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex items-start gap-3 border-b border-black/5 px-4 py-4",children:[n.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(yh,{className:"h-4 w-4"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"text-[15px] font-semibold text-slate-900",children:s}),r?n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:r}):null]}),n.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-black/50 bg-white/70 text-slate-700 hover:bg-white",onClick:a,children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsx("div",{className:"p-4",children:i})]})}):null}function w5e(){const{id:t}=Cm(),[s,r]=p.useState(null),[a,i]=p.useState(!0),[l,o]=p.useState([]),[c,d]=p.useState(!0),u=p.useRef(null),[m,x]=p.useState([]),[g,y]=p.useState(""),[v,j]=p.useState(!1),[w,S]=p.useState(!1),[E,k]=p.useState(""),[A,I]=p.useState(""),[P,O]=p.useState(!1),[D,T]=p.useState(null),[B,U]=p.useState(""),[W,V]=p.useState(!1),[R,F]=p.useState(!1),G=String((s==null?void 0:s.status)||"").toLowerCase()==="finalized",H=(s==null?void 0:s.billing_invoice_id)||(s==null?void 0:s.invoice_id)||null,$=H?`/billing/invoices/${H}`:null,K=async()=>{var Q,oe;i(!0);try{const{data:_e}=await s_e(t);r(xe=>({..._e,billing_invoice_id:(_e==null?void 0:_e.billing_invoice_id)??(xe==null?void 0:xe.billing_invoice_id),billing_status:(_e==null?void 0:_e.billing_status)??(xe==null?void 0:xe.billing_status)})),U((_e==null?void 0:_e.notes)??(_e==null?void 0:_e.report_text)??"")}catch(_e){ae.error(((oe=(Q=_e==null?void 0:_e.response)==null?void 0:Q.data)==null?void 0:oe.detail)||"Failed to load order")}finally{i(!1)}},le=async()=>{var Q,oe;d(!0);try{const{data:_e}=await n_e(t),xe=Array.isArray(_e)?_e:[];o(xe),T(me=>me||xe[0]||null)}catch(_e){ae.error(((oe=(Q=_e==null?void 0:_e.response)==null?void 0:Q.data)==null?void 0:oe.detail)||"Failed to load attachments")}finally{d(!1)}};p.useEffect(()=>{(async()=>await Promise.all([K(),le()]))()},[t]);const se=p.useMemo(()=>{const Q=l.length,oe=l.filter(xe=>{const me=(xe==null?void 0:xe.note)||M1(xe==null?void 0:xe.file_url);return I1(xe==null?void 0:xe.file_url,me)==="image"}).length,_e=l.filter(xe=>{const me=(xe==null?void 0:xe.note)||M1(xe==null?void 0:xe.file_url);return I1(xe==null?void 0:xe.file_url,me)==="pdf"}).length;return{total:Q,imgs:oe,pdfs:_e}},[l]),J=Q=>{const oe=Array.from(Q.target.files||[]);x(oe)},ie=async()=>{var Q,oe;if(G)return ae.error("Order is finalized. Upload disabled.");if(!m.length)return ae.error("Choose file(s) first");if(s!=null&&s.id){j(!0);try{for(const _e of m)await i_e(s.id,_e,g||_e.name);ae.success("Uploaded"),x([]),y(""),u.current&&(u.current.value=""),await le()}catch(_e){console.error("RIS upload error:",_e),ae.error(((oe=(Q=_e==null?void 0:_e.response)==null?void 0:Q.data)==null?void 0:oe.detail)||(_e==null?void 0:_e.message)||"Upload failed")}finally{j(!1)}}},te=async()=>{var oe,_e;if(G)return ae.error("Order is finalized. Add link disabled.");const Q=String(E||"").trim();if(!Q)return ae.error("Paste a file URL");if(s!=null&&s.id){O(!0);try{await l_e(s.id,Q,A||"Link"),ae.success("Linked"),S(!1),k(""),I(""),await le()}catch(xe){ae.error(((_e=(oe=xe==null?void 0:xe.response)==null?void 0:oe.data)==null?void 0:_e.detail)||"Link failed")}finally{O(!1)}}},ne=async Q=>{var oe,_e;if(G)return ae.error("Order is finalized. Delete disabled.");if(Q!=null&&Q.id&&window.confirm("Delete this attachment?"))try{await r_e(Q.id),ae.success("Deleted"),T(xe=>(xe==null?void 0:xe.id)===Q.id?null:xe),await le()}catch(xe){ae.error(((_e=(oe=xe==null?void 0:xe.response)==null?void 0:oe.data)==null?void 0:_e.detail)||"Delete failed")}},q=async()=>{var Q,oe;if(s!=null&&s.id){V(!0);try{await a_e(s.id,{notes:B}),ae.success("Notes saved"),await K()}catch(_e){ae.error(((oe=(Q=_e==null?void 0:_e.response)==null?void 0:Q.data)==null?void 0:oe.detail)||"Failed to save notes")}finally{V(!1)}}},ee=async()=>{var Q,oe;if(s!=null&&s.id){if(G)return ae.message("Already finalized");if(window.confirm("Finalize this order and auto-create billing invoice?")){F(!0);try{const{data:_e}=await o_e(s.id);r(xe=>({...xe,status:(_e==null?void 0:_e.status)||"finalized",billing_status:(_e==null?void 0:_e.billing_status)??(xe==null?void 0:xe.billing_status),billing_invoice_id:(_e==null?void 0:_e.invoice_id)??(xe==null?void 0:xe.billing_invoice_id)})),ae.success("Finalized + billed")}catch(_e){ae.error(((oe=(Q=_e==null?void 0:_e.response)==null?void 0:Q.data)==null?void 0:oe.detail)||"Finalize failed")}finally{F(!1)}}}};if(a)return n.jsx("div",{className:"text-sm text-slate-600",children:"Loading"});if(!s)return n.jsx("div",{className:"text-sm text-slate-600",children:"Order not found"});const X=D==null?void 0:D.file_url,Z=(D==null?void 0:D.note)||M1(X),Y=I1(X,Z);return n.jsx("div",{className:"text-slate-900",children:n.jsxs("div",{className:"relative overflow-hidden rounded-[28px] border border-slate-500 bg-slate-50 p-3 md:p-5",children:[n.jsx("div",{className:"pointer-events-none absolute -top-24 left-1/2 h-72 w-[820px] -translate-x-1/2 rounded-full bg-sky-200/40 blur-3xl"}),n.jsx("div",{className:"pointer-events-none absolute -bottom-28 left-10 h-72 w-72 rounded-full bg-emerald-200/35 blur-3xl"}),n.jsx("div",{className:"pointer-events-none absolute -bottom-28 right-10 h-72 w-72 rounded-full bg-purple-200/30 blur-3xl"}),n.jsxs("div",{className:"rounded-[26px] border border-white/60 bg-white/70 p-4 shadow-sm ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("h1",{className:"text-[16px] font-semibold tracking-tight md:text-[18px]",children:["Radiology Order ",n.jsx(q2,{order:s,prefix:"RAD"})]}),n.jsxs("div",{className:"mt-1 text-[12px] text-slate-600",children:["Patient: ",n.jsx(nf,{patientId:s.patient_id}),"  Created: ",U8(s.created_at)]}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[12px] text-slate-600",children:[n.jsxs("span",{children:["Modality: ",n.jsx(vP,{modality:s.modality})]}),n.jsx("span",{children:""}),n.jsxs("span",{children:["Status: ",n.jsx(jb,{status:s.status})]}),G?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-[11px] font-semibold text-emerald-700",children:[n.jsx(rd,{className:"h-3.5 w-3.5"})," Finalized"]}):null]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-[11px]",children:[n.jsxs("span",{className:"rounded-full border border-slate-500 bg-slate-50 px-3 py-1.5",children:["Files: ",n.jsx("b",{children:se.total})]}),n.jsxs("span",{className:"rounded-full border border-slate-500 bg-slate-50 px-3 py-1.5",children:["Images: ",n.jsx("b",{children:se.imgs})]}),n.jsxs("span",{className:"rounded-full border border-slate-500 bg-slate-50 px-3 py-1.5",children:["PDFs: ",n.jsx("b",{children:se.pdfs})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[$?n.jsxs(ul,{to:$,className:"inline-flex h-10 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-4 text-[12px] font-semibold text-slate-800 hover:bg-white",title:"Open invoice",children:[n.jsx(Ume,{className:"h-4 w-4"}),"View Invoice"]}):null,n.jsx(Wn,{anyOf:["orders.ris.finalize","radiology.orders.finalize","billing.invoices.create","radiology.orders.update","orders.ris.update"],children:!G&&n.jsxs("button",{type:"button",onClick:ee,disabled:R,className:"inline-flex h-10 items-center gap-2 rounded-2xl bg-emerald-600 px-4 text-[12px] font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:opacity-60",title:"Finalize order and create invoice",children:[n.jsx(Xt,{className:"h-4 w-4"}),R?"Finalizing":"Finalize"]})}),n.jsx(Wn,{anyOf:["radiology.report.create","radiology.orders.update","orders.ris.update"],children:n.jsxs("button",{type:"button",onClick:q,disabled:W,className:"inline-flex h-10 items-center gap-2 rounded-2xl bg-slate-900 px-4 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:[n.jsx(Pi,{className:"h-4 w-4"}),W?"Saving":"Save notes"]})})]})]}),G?n.jsxs("div",{className:"mt-3 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-800",children:["This order is ",n.jsx("b",{children:"finalized"}),". Attachments are locked."]}):null]}),n.jsxs("div",{className:"mt-4 flex flex-col gap-3 md:flex-row",children:[n.jsx("div",{className:"w-full md:w-[420px] md:shrink-0",children:n.jsxs("div",{className:"rounded-[26px] border border-white/60 bg-white/70 p-4 shadow-sm ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-[14px] font-semibold",children:"Attachments"}),G?null:n.jsx(Wn,{anyOf:["radiology.attachments.add"],children:n.jsxs("button",{type:"button",className:"inline-flex h-9 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:()=>S(!0),children:[n.jsx(yh,{className:"h-4 w-4"}),"Add link"]})})]}),G?null:n.jsx(Wn,{anyOf:["radiology.attachments.add"],children:n.jsxs("div",{className:"mt-3 rounded-[22px] border border-black/50 bg-white/60 p-3",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-800",children:"Upload any file"}),n.jsx("p",{className:"mt-0.5 text-[11px] text-slate-600",children:"Images / PDF / DOCX / ZIP / DICOM export  anything. You can preview images & PDFs."}),n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsx("input",{ref:u,type:"file",multiple:!0,onChange:J,className:"w-full text-[12px]"}),n.jsx("input",{className:"h-10 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",placeholder:"Note (optional)  e.g., CT brain images, Referral letter",value:g,onChange:Q=>y(Q.target.value)}),n.jsxs("button",{type:"button",onClick:ie,disabled:v||!m.length,className:"inline-flex h-10 items-center justify-center gap-2 rounded-2xl bg-slate-900 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:[n.jsx(Nh,{className:"h-4 w-4"}),v?"Uploading":`Upload ${m.length?`(${m.length})`:""}`]}),!!m.length&&n.jsxs("div",{className:"text-[11px] text-slate-600",children:["Selected:"," ",n.jsx("span",{className:"font-semibold text-slate-900",children:m.map(Q=>Q.name).join(", ")})]})]})]})}),n.jsx("div",{className:"mt-3",children:c?n.jsx("div",{className:"text-[12px] text-slate-600",children:"Loading attachments"}):l.length===0?n.jsx("div",{className:"rounded-[22px] border border-dashed border-black/50 bg-white/40 p-6 text-center text-[12px] text-slate-600",children:"No attachments yet."}):n.jsx("div",{className:"flex flex-col gap-2",children:l.map(Q=>{const oe=(Q==null?void 0:Q.note)||M1(Q==null?void 0:Q.file_url),_e=I1(Q==null?void 0:Q.file_url,oe),xe=(D==null?void 0:D.id)===(Q==null?void 0:Q.id);return n.jsxs("div",{role:"button",tabIndex:0,onClick:()=>T(Q),onKeyDown:me=>{(me.key==="Enter"||me.key===" ")&&T(Q)},className:y5e("flex w-full items-start gap-3 rounded-[22px] border p-3 text-left transition outline-none",xe?"border-slate-900 bg-white shadow-sm":"border-black/50 bg-white/60 hover:bg-white/80"),children:[n.jsx("div",{className:"mt-0.5 flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(j5e,{kind:_e})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"truncate text-[12px] font-semibold text-slate-900",children:oe}),n.jsx("div",{className:"mt-0.5 text-[11px] text-slate-600",children:Q!=null&&Q.created_at?U8(Q.created_at):""})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("a",{href:Q.file_url,target:"_blank",rel:"noreferrer",className:"inline-flex h-9 items-center justify-center rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:me=>me.stopPropagation(),title:"Open",children:n.jsx(iC,{className:"h-4 w-4"})}),n.jsx("a",{href:Q.file_url,className:"inline-flex h-9 items-center justify-center rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:me=>me.stopPropagation(),download:!0,title:"Download",children:n.jsx(nn,{className:"h-4 w-4"})}),G?null:n.jsx(Wn,{anyOf:["radiology.attachments.add"],children:n.jsx("button",{type:"button",className:"inline-flex h-9 items-center justify-center rounded-2xl border border-rose-200 bg-rose-50 px-3 text-[12px] font-semibold text-rose-700 hover:bg-rose-100",onClick:me=>{me.stopPropagation(),ne(Q)},title:"Delete",children:n.jsx(Ms,{className:"h-4 w-4"})})})]})]},Q.id)})})})]})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsxs("div",{className:"rounded-[26px] border border-white/60 bg-white/70 p-4 shadow-sm ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[14px] font-semibold",children:"Preview"}),n.jsx("div",{className:"mt-0.5 truncate text-[12px] text-slate-600",children:D?Z||"Selected file":"Select a file from the left"})]}),X?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("a",{href:X,target:"_blank",rel:"noreferrer",className:"inline-flex h-9 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",children:[n.jsx(iC,{className:"h-4 w-4"}),"Open"]}),n.jsxs("a",{href:X,download:!0,className:"inline-flex h-9 items-center gap-2 rounded-2xl bg-slate-900 px-3 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800",children:[n.jsx(nn,{className:"h-4 w-4"}),"Download"]})]}):null]}),n.jsx("div",{className:"mt-3 overflow-hidden rounded-[22px] border border-black/50 bg-white/50",children:X?Y==="image"?n.jsx("div",{className:"p-3",children:n.jsx("img",{src:X,alt:Z,className:"max-h-[520px] w-full rounded-2xl object-contain"})}):Y==="pdf"?n.jsx("iframe",{title:"PDF Preview",src:X,className:"h-[520px] w-full"}):Y==="video"?n.jsx("div",{className:"p-3",children:n.jsx("video",{src:X,controls:!0,className:"max-h-[520px] w-full rounded-2xl"})}):Y==="audio"?n.jsx("div",{className:"p-4",children:n.jsx("audio",{src:X,controls:!0,className:"w-full"})}):n.jsxs("div",{className:"p-10 text-center text-[12px] text-slate-600",children:["Preview not available for this file type.",n.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[n.jsxs("a",{href:X,target:"_blank",rel:"noreferrer",className:"inline-flex h-9 items-center gap-2 rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] font-semibold text-slate-800 hover:bg-white",children:[n.jsx(iC,{className:"h-4 w-4"}),"Open"]}),n.jsxs("a",{href:X,download:!0,className:"inline-flex h-9 items-center gap-2 rounded-2xl bg-slate-900 px-3 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800",children:[n.jsx(nn,{className:"h-4 w-4"}),"Download"]})]})]}):n.jsx("div",{className:"p-10 text-center text-[12px] text-slate-600",children:"Choose an attachment to preview."})})]}),n.jsxs("div",{className:"mt-3 rounded-[26px] border border-white/60 bg-white/70 p-4 shadow-sm ring-1 ring-black/5 supports-[backdrop-filter]:bg-white/55 supports-[backdrop-filter]:backdrop-blur-2xl",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[14px] font-semibold",children:"Notes (optional)"}),n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:"Store extra instructions / remarks for this order."})]}),n.jsx("textarea",{className:"mt-3 min-h-[140px] w-full rounded-[22px] border border-black/50 bg-white/70 p-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",placeholder:"Type notes (optional)",value:B,onChange:Q=>U(Q.target.value)}),n.jsx(Wn,{anyOf:["radiology.report.create","radiology.orders.update","orders.ris.update"],children:n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsxs("button",{type:"button",onClick:q,disabled:W,className:"inline-flex h-10 items-center gap-2 rounded-2xl bg-slate-900 px-4 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",children:[n.jsx(Pi,{className:"h-4 w-4"}),W?"Saving":"Save notes"]})})})]})]})]}),n.jsx(N5e,{open:w,title:"Add attachment link",subtitle:"Paste a public file URL (S3 / Drive / PACS export link, etc.)",onClose:()=>S(!1),children:n.jsxs("div",{className:"space-y-3",children:[n.jsx("input",{className:"h-10 w-full rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",placeholder:"https://",value:E,onChange:Q=>k(Q.target.value)}),n.jsx("input",{className:"h-10 w-full rounded-2xl border border-black/50 bg-white/70 px-3 text-[12px] outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-200/60",placeholder:"Note (optional)  e.g., Old report PDF",value:A,onChange:Q=>I(Q.target.value)}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{type:"button",className:"h-10 rounded-2xl border border-black/50 bg-white/70 px-4 text-[12px] font-semibold text-slate-800 hover:bg-white",onClick:()=>S(!1),children:"Cancel"}),n.jsx("button",{type:"button",disabled:P,className:"h-10 rounded-2xl bg-slate-900 px-4 text-[12px] font-semibold text-white shadow-sm hover:bg-slate-800 disabled:opacity-60",onClick:te,children:P?"Saving":"Add link"})]})]})})]})})}function _5e({value:t,onChange:s,label:r="Patient",initialPatient:a=null,disabled:i=!1}){const[l,o]=p.useState(""),[c,d]=p.useState([]),[u,m]=p.useState(!1),[x,g]=p.useState(a||null);p.useEffect(()=>{a&&g(a)},[a]),p.useEffect(()=>{let j=!0;if(!l){d([]);return}return m(!0),sP(l).then(w=>{j&&d(w.data||[])}).catch(()=>{j&&d([])}).finally(()=>{j&&m(!1)}),()=>{j=!1}},[l]),p.useEffect(()=>{if(!t){g(null);return}const j=c.find(w=>w.id===t);j&&g(j)},[t,c]);const y=j=>{g(j),o(""),d([]),s==null||s(j.id,j)},v=()=>{g(null),s==null||s(null,null)};return n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:r}),!x&&n.jsxs(n.Fragment,{children:[n.jsx("input",{className:"input",placeholder:"Search by name / UHID / phone",value:l,disabled:i,onChange:j=>o(j.target.value)}),u&&n.jsx("div",{className:"text-xs text-slate-500",children:"Searching"}),c.length>0&&n.jsx("div",{className:"max-h-48 overflow-auto rounded-xl border bg-white text-sm",children:c.map(j=>n.jsx("button",{type:"button",onClick:()=>y(j),className:"flex w-full items-center justify-between px-3 py-2 text-left hover:bg-slate-50",children:n.jsxs("div",{children:[n.jsxs("div",{className:"font-medium",children:[j.first_name," ",j.last_name]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID: ",j.uhid,"  ",j.phone]})]})},j.id))})]}),x&&n.jsxs("div",{className:"flex items-start justify-between gap-3 rounded-xl border bg-slate-50 px-3 py-2 text-xs text-slate-700",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold",children:[x.first_name," ",x.last_name]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID: ",x.uhid,"  ",x.phone]})]}),!i&&n.jsx("button",{type:"button",onClick:v,className:"text-[11px] font-medium text-sky-700 hover:underline",children:"Change"})]})]})}function V8({value:t,onChange:s,label:r="Department  Doctor",initialDepartmentId:a=null,disabled:i=!1}){const[l,o]=p.useState([]),[c,d]=p.useState(""),[u,m]=p.useState([]),[x,g]=p.useState(!1),[y,v]=p.useState(!1),[j,w]=p.useState("");p.useEffect(()=>{let A=!0;return v(!0),nP().then(I=>{A&&o(I.data||[])}).catch(I=>{A&&(console.error("fetchDepartments error",I),ae.error("Failed to load departments"),o([]))}).finally(()=>{A&&v(!1)}),()=>{A=!1}},[]),p.useEffect(()=>{a&&!c&&d(String(a))},[a]),p.useEffect(()=>{let A=!0;if(w(""),m([]),!c)return;const I=Number(c);return g(!0),rP({departmentId:I,isDoctor:!0}).then(P=>{A&&m(P.data||[])}).catch(P=>{var D,T;if(!A)return;console.error("fetchDepartmentUsers error",P);const O=((T=(D=P==null?void 0:P.response)==null?void 0:D.data)==null?void 0:T.detail)||"Failed to load doctors";w(O),ae.error(O),m([])}).finally(()=>{A&&g(!1)}),()=>{A=!1}},[c]);const S=p.useMemo(()=>u.find(A=>A.id===t)||null,[u,t]),E=A=>{const I=A.target.value;d(I);const P=I?Number(I):null;s==null||s(null,{department_id:P})},k=A=>{const I=A.target.value,P=I?Number(I):null,O=c?Number(c):null;s==null||s(P,{department_id:O})};return n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:r}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("select",{className:"input",value:c,onChange:E,disabled:y||i,children:[n.jsx("option",{value:"",children:y?"Loading departments":"Select department"}),l.map(A=>n.jsx("option",{value:A.id,children:A.name},A.id))]}),n.jsxs("select",{className:"input",value:t||"",onChange:k,disabled:i||!c||x||u.length===0,children:[n.jsx("option",{value:"",children:x?"Loading doctors":c?u.length===0?"No doctors in this department":"Select doctor":"Select department first"}),u.map(A=>n.jsxs("option",{value:A.id,children:[A.name,A.email?` (${A.email})`:""]},A.id))]})]}),S&&n.jsxs("div",{className:"rounded-xl border bg-emerald-50 px-3 py-2 text-sm",children:["Selected:"," ",n.jsx("span",{className:"font-medium",children:S.name})]}),j&&n.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-2 text-sm text-red-700",children:j})]})}const S5e=t=>t?(typeof t=="string"?new Date(t):t).toISOString().slice(0,10):"",H8=t=>t?String(t).slice(0,5):"",C5e={planned:"bg-blue-50 text-blue-700 border-blue-200",in_progress:"bg-amber-50 text-amber-700 border-amber-200",completed:"bg-emerald-50 text-emerald-700 border-emerald-200",cancelled:"bg-rose-50 text-rose-700 border-rose-200"},k5e={Elective:"bg-slate-50 text-slate-700 border-slate-500",Emergency:"bg-red-50 text-red-700 border-red-200"};function A5e({status:t}){if(!t)return null;const s=C5e[t]||"bg-slate-50 text-slate-700 border-slate-500",r=t.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase());return n.jsxs("span",{className:`inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-semibold ${s}`,children:[n.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 rounded-full bg-current"}),r]})}function E5e({priority:t}){if(!t)return null;const s=k5e[t]||"bg-slate-50 text-slate-700 border-slate-500";return n.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide ${s}`,children:t})}function T5e({selectedBedId:t,onSelectBed:s}){return n.jsxs(mt.div,{layout:!0,className:"flex h-full flex-col rounded-2xl border border-slate-500 bg-white/90 p-3 shadow-sm backdrop-blur-sm md:p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 border-b border-slate-100 pb-3",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"OT Location / Bed"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Filter cases by ward & bed, or leave blank to view all."})]}),n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-600",children:n.jsx(cn,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"mt-3 flex-1 space-y-3",children:[n.jsx(fP,{value:t?Number(t):null,onChange:r=>s(r||null)}),n.jsx("div",{className:"rounded-xl border border-dashed border-slate-500 bg-slate-50/80 px-3 py-2.5 text-xs text-slate-600",children:t?n.jsxs(n.Fragment,{children:["Showing OT cases for"," ",n.jsxs("span",{className:"font-semibold text-slate-900",children:["Bed #",t]}),"."]}):n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"font-semibold text-slate-900",children:"All OT beds"})," ","are visible for the selected day."]})})]})]})}function P5e({schedules:t,loading:s,date:r,bedId:a,onEdit:i,onOpenCase:l,onMarkSuccess:o}){const c=a?`Bed #${a}  ${r}`:`All OT locations  ${r}`;return n.jsxs(mt.div,{layout:!0,className:"flex h-full flex-col rounded-2xl border border-slate-500 bg-slate-50/60 shadow-sm backdrop-blur-sm",children:[n.jsx("div",{className:"flex items-center justify-between gap-3 border-b border-slate-100 px-3 py-3 md:px-4",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"OT Day Schedule"}),n.jsx("p",{className:"text-xs text-slate-500",children:c})]})}),n.jsxs("div",{className:"flex-1 space-y-3 overflow-y-auto px-2 py-3 md:px-3 md:py-4",children:[s&&n.jsx(n.Fragment,{children:Array.from({length:4}).map((d,u)=>n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18,delay:u*.05},className:"animate-pulse rounded-2xl border border-slate-100 bg-white/80 p-3 shadow-sm md:p-4",children:n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"h-4 w-24 rounded bg-slate-100"}),n.jsx("div",{className:"h-4 w-20 rounded bg-slate-100"})]}),n.jsx("div",{className:"h-4 w-40 rounded bg-slate-100"}),n.jsx("div",{className:"h-4 w-48 rounded bg-slate-100"}),n.jsxs("div",{className:"mt-2 flex gap-2",children:[n.jsx("div",{className:"h-8 flex-1 rounded-full bg-slate-100"}),n.jsx("div",{className:"h-8 flex-1 rounded-full bg-slate-100"})]})]})},u))}),!s&&t.length===0&&n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"mt-6 flex flex-col items-center justify-center gap-2 rounded-2xl border border-dashed border-slate-500 bg-white/70 px-4 py-8 text-center",children:[n.jsx(Ds,{className:"h-6 w-6 text-slate-400"}),n.jsx("p",{className:"text-sm font-medium text-slate-700",children:"No OT cases scheduled for this day."}),n.jsxs("p",{className:"text-xs text-slate-500",children:["Use ",n.jsx("span",{className:"font-semibold",children:"New Schedule"})," to add an OT booking."]})]}),n.jsx(on,{initial:!1,children:!s&&t.map(d=>{var A,I,P,O,D,T,B,U,W,V,R,F,G;const u=[d.planned_start_time,d.planned_end_time].filter(Boolean).join("  "),m=((A=d.patient)==null?void 0:A.full_name)||[(I=d.patient)==null?void 0:I.first_name,(P=d.patient)==null?void 0:P.last_name].filter(Boolean).join(" "),x=((O=d.patient)==null?void 0:O.uhid)||d.patient_uhid,g=((D=d.surgeon)==null?void 0:D.full_name)||d.surgeon_name||null,y=((T=d.anaesthetist)==null?void 0:T.full_name)||d.anaesthetist_name||null,v=((B=d.primary_procedure)==null?void 0:B.name)||d.procedure_name,j=(d.procedures||[]).filter(H=>!H.is_primary).length,w=(V=(W=(U=d.bed)==null?void 0:U.room)==null?void 0:W.ward)==null?void 0:V.name,S=(F=(R=d.bed)==null?void 0:R.room)==null?void 0:F.number,E=(G=d.bed)==null?void 0:G.code,k=d.bed_id?[w&&`Ward: ${w}`,S&&`Room: ${S}`,E&&`Bed: ${E}`].filter(Boolean).join("  ")||`Bed #${d.bed_id}`:"No bed assigned";return n.jsxs(mt.div,{layout:!0,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.2},className:"group rounded-2xl border border-slate-500 bg-white px-3 py-3 text-sm shadow-sm ring-1 ring-transparent transition hover:border-sky-200 hover:shadow-md hover:ring-sky-100 md:px-4 md:py-4",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-1.5 text-xs font-medium text-slate-700",children:[n.jsx(Na,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{children:u||"Time not set"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[n.jsx(E5e,{priority:d.priority}),n.jsx(A5e,{status:d.status})]})]}),n.jsxs("div",{className:"mt-2 flex flex-col gap-2 md:mt-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-semibold text-slate-900",children:[n.jsx(or,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{children:m||(x?`UHID ${x}`:`UHID #${d.patient_id}`)})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-slate-500",children:[x&&n.jsxs("span",{className:"rounded-full bg-slate-50 px-2 py-0.5",children:["UHID ",x]}),d.admission_id&&n.jsxs("span",{className:"rounded-full bg-slate-50 px-2 py-0.5",children:["IP #",d.admission_id]})]})]}),n.jsxs("div",{className:"space-y-1.5 text-right md:text-left",children:[n.jsxs("div",{className:"flex items-center justify-end gap-1.5 text-sm font-semibold text-slate-900 md:justify-start",children:[n.jsx(Hs,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{children:g||`Dr #${d.surgeon_user_id}`})]}),(y||d.anaesthetist_user_id)&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Anaes"," ",y||`#${d.anaesthetist_user_id}`]})]})]}),n.jsxs("div",{className:"mt-3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Location"}),n.jsx("div",{className:"text-sm font-medium text-slate-900",children:k})]}),n.jsxs("div",{className:"space-y-1 md:max-w-sm",children:[n.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Procedure"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:v||""}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-1",children:[d.side&&n.jsx("span",{className:"rounded-full bg-slate-50 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:d.side}),j>0&&n.jsxs("span",{className:"rounded-full bg-sky-50 px-2 py-0.5 text-[11px] font-semibold text-sky-700",children:["+",j," more"]})]})]})]}),n.jsx("div",{className:"mt-3 flex flex-col gap-2 border-t border-slate-100 pt-3 md:mt-4 md:flex-row md:items-center md:justify-end",children:n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:gap-2",children:[n.jsx("button",{type:"button",className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-slate-500 bg-white px-3 py-1.5 text-xs font-semibold text-slate-800 hover:border-sky-400 hover:text-sky-800",onClick:()=>i(d),children:"Edit"}),n.jsxs("button",{type:"button",onClick:()=>l(d),className:`inline-flex items-center justify-center gap-1.5 rounded-full border px-3.5 py-1.5 text-xs font-semibold transition ${d.case_id?"border-slate-500 bg-white text-slate-900 hover:border-sky-400 hover:text-sky-800":"border-emerald-600 bg-emerald-600 text-white hover:bg-emerald-700"}`,children:[n.jsx(Qs,{className:"h-4 w-4"}),d.case_id?"View Case":"Open Case"]}),o&&d.case_id&&d.status!=="completed"&&n.jsxs("button",{type:"button",onClick:()=>o(d),className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-emerald-600 bg-emerald-50 px-3.5 py-1.5 text-xs font-semibold text-emerald-700 hover:bg-emerald-100",title:"Mark OT as completed (success) for billing",children:[n.jsx(Xt,{className:"h-4 w-4"}),"Success"]})]})})]},d.id)})})]})]})}function D5e({open:t,mode:s,onClose:r,onSaved:a,defaultDate:i,defaultBedId:l,editingSchedule:o}){const c=s==="edit",[d,u]=p.useState({date:i||"",planned_start_time:"",planned_end_time:"",patient_id:"",admission_id:"",bed_id:l||"",surgeon_user_id:"",anaesthetist_user_id:"",procedure_name:"",side:"",priority:"Elective",notes:"",primary_procedure_id:"",additional_procedure_ids:[]}),[m,x]=p.useState(!1),[g,y]=p.useState(null);p.useEffect(()=>{var k,A;t&&(u(c&&o?{date:o.date||i||"",planned_start_time:H8(o.planned_start_time),planned_end_time:H8(o.planned_end_time),patient_id:o.patient_id||"",admission_id:o.admission_id||"",bed_id:o.bed_id||l||"",surgeon_user_id:o.surgeon_user_id||"",anaesthetist_user_id:o.anaesthetist_user_id||"",procedure_name:o.procedure_name||((k=o.primary_procedure)==null?void 0:k.name)||"",side:o.side||"",priority:o.priority||"Elective",notes:o.notes||"",primary_procedure_id:o.primary_procedure_id||"",additional_procedure_ids:((A=o.procedures)==null?void 0:A.filter(I=>!I.is_primary).map(I=>I.procedure_id))||[]}:{date:i||"",planned_start_time:"",planned_end_time:"",patient_id:"",admission_id:"",bed_id:l||"",surgeon_user_id:"",anaesthetist_user_id:"",procedure_name:"",side:"",priority:"Elective",notes:"",primary_procedure_id:"",additional_procedure_ids:[]}),y(null),x(!1))},[t,c,o,l,i]);const v=(k,A)=>{u(I=>({...I,[k]:A}))},j=()=>d.date?d.planned_start_time?d.procedure_name?d.surgeon_user_id?null:"Please select surgeon":"Please enter procedure name":"Please enter start time":"Please select a date",w=async k=>{var I,P,O,D;k.preventDefault();const A=j();if(A){y(A);return}x(!0),y(null);try{const T={date:d.date,planned_start_time:d.planned_start_time,planned_end_time:d.planned_end_time||null,patient_id:d.patient_id?Number(d.patient_id):null,admission_id:d.admission_id?Number(d.admission_id):null,bed_id:d.bed_id?Number(d.bed_id):null,surgeon_user_id:d.surgeon_user_id?Number(d.surgeon_user_id):null,anaesthetist_user_id:d.anaesthetist_user_id?Number(d.anaesthetist_user_id):null,procedure_name:d.procedure_name,side:d.side||null,priority:d.priority||"Elective",notes:d.notes||null,primary_procedure_id:d.primary_procedure_id?Number(d.primary_procedure_id):null,additional_procedure_ids:(d.additional_procedure_ids||[]).map(B=>Number(B))};c&&(o!=null&&o.id)?(await J_e(o.id,T),(I=ae.success)==null||I.call(ae,"OT schedule updated")):(await TK(T),(P=ae.success)==null||P.call(ae,"OT schedule created")),a==null||a(),r()}catch(T){console.error("Failed to save OT schedule",T);const B=((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||(T==null?void 0:T.message)||"Failed to save OT schedule";y(B)}finally{x(!1)}},S=c?"Edit OT Schedule":"New OT Schedule",E=c?"Update timing and details of this OT booking.":"Create a new OT booking for the selected day.";return n.jsx(on,{children:t&&n.jsx(mt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 flex items-end justify-center bg-slate-900/40 backdrop-blur-sm md:items-center",onMouseDown:r,children:n.jsxs(mt.div,{initial:{y:32,opacity:0},animate:{y:0,opacity:1},exit:{y:32,opacity:0},transition:{type:"spring",stiffness:260,damping:22},className:"w-full max-h-[95vh] rounded-t-3xl bg-white shadow-2xl md:max-w-3xl md:rounded-2xl",onMouseDown:k=>k.stopPropagation(),children:[n.jsxs("div",{className:"flex items-start justify-between border-b border-slate-100 px-5 py-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-base font-semibold text-slate-900",children:S}),n.jsx("p",{className:"text-xs text-slate-500",children:E})]}),n.jsx("button",{type:"button",onClick:r,className:"rounded-full p-1.5 text-slate-400 hover:bg-slate-100 hover:text-slate-700",children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("form",{onSubmit:w,className:"flex max-h-[calc(95vh-46px)] flex-col",children:[n.jsxs("div",{className:"grid flex-1 grid-cols-1 gap-4 overflow-y-auto px-5 py-4 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-xs font-semibold text-slate-700",children:["Date ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.date,onChange:k=>v("date",k.target.value)})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Priority"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.priority,onChange:k=>v("priority",k.target.value),children:[n.jsx("option",{value:"Elective",children:"Elective"}),n.jsx("option",{value:"Emergency",children:"Emergency"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-xs font-semibold text-slate-700",children:["Start time"," ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{type:"time",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.planned_start_time,onChange:k=>v("planned_start_time",k.target.value)})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"End time"}),n.jsx("input",{type:"time",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.planned_end_time,onChange:k=>v("planned_end_time",k.target.value)})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(_5e,{label:"Patient",value:d.patient_id?Number(d.patient_id):null,onChange:k=>u(A=>({...A,patient_id:k||""}))}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Admission ID (IP)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.admission_id,onChange:k=>v("admission_id",k.target.value),placeholder:"Optional"})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Ward / Room / Bed"}),n.jsx(fP,{value:d.bed_id?Number(d.bed_id):null,onChange:k=>u(A=>({...A,bed_id:k||""}))})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx(M5e,{primaryId:d.primary_procedure_id?Number(d.primary_procedure_id):null,additionalIds:d.additional_procedure_ids||[],onChange:k=>{u(A=>({...A,primary_procedure_id:k.primary_procedure_id??A.primary_procedure_id,additional_procedure_ids:k.additional_procedure_ids??A.additional_procedure_ids,procedure_name:k.primary_procedure_name&&!A.procedure_name?k.primary_procedure_name:A.procedure_name}))}}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-xs font-semibold text-slate-700",children:["Procedure name (display)"," ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.procedure_name,onChange:k=>v("procedure_name",k.target.value),placeholder:"E.g., Laparoscopic cholecystectomy"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Side"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.side,onChange:k=>v("side",k.target.value),children:[n.jsx("option",{value:"",children:"Not applicable"}),n.jsx("option",{value:"Right",children:"Right"}),n.jsx("option",{value:"Left",children:"Left"}),n.jsx("option",{value:"Bilateral",children:"Bilateral"}),n.jsx("option",{value:"Midline",children:"Midline"})]})]}),n.jsx(V8,{label:"Surgeon",value:d.surgeon_user_id?Number(d.surgeon_user_id):null,onChange:k=>u(A=>({...A,surgeon_user_id:k||""}))})]}),n.jsx(V8,{label:"Anaesthetist",value:d.anaesthetist_user_id?Number(d.anaesthetist_user_id):null,onChange:k=>u(A=>({...A,anaesthetist_user_id:k||""}))}),n.jsxs("div",{className:"space-y-1.5 pb-1",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Notes"}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-lg border border-slate-500 bg-white px-2.5 py-2 text-sm text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:d.notes,onChange:k=>v("notes",k.target.value),placeholder:"Any special requirements / remarks"})]})]})]}),g&&n.jsx("div",{className:"px-5 pb-2",children:n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:g})}),n.jsxs("div",{className:"flex items-center justify-end gap-2 border-t border-slate-100 px-5 py-3",children:[n.jsx("button",{type:"button",onClick:r,className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-slate-500 bg-white px-3.5 py-1.5 text-xs font-semibold text-slate-800 hover:bg-slate-50",disabled:m,children:"Cancel"}),n.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-3.5 py-1.5 text-xs font-semibold text-white hover:bg-sky-700 disabled:opacity-60",disabled:m,children:[m&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),c?"Update Schedule":"Create Schedule"]})]})]})]})},"ot-schedule-modal")})}function M5e({primaryId:t,additionalIds:s,onChange:r}){const[a,i]=p.useState([]),[l,o]=p.useState(!1),[c,d]=p.useState("");p.useEffect(()=>{(async()=>{var y;try{o(!0);const v=await pP({limit:500}),j=Array.isArray((y=v==null?void 0:v.data)==null?void 0:y.items)?v.data.items:Array.isArray(v==null?void 0:v.data)?v.data:[];i(j)}catch(v){console.error("Failed to load OT procedures",v)}finally{o(!1)}})()},[]);const u=p.useMemo(()=>{const g=c.trim().toLowerCase();return g?a.filter(y=>{const v=(y.name||"").toLowerCase(),j=(y.code||"").toLowerCase();return v.includes(g)||j.includes(g)}):a},[a,c]),m=g=>{var v;const y=g?Number(g):null;r({primary_procedure_id:y,additional_procedure_ids:s||[],primary_procedure_name:y&&((v=a.find(j=>j.id===y))==null?void 0:v.name)||""})},x=g=>{const y=new Set(s||[]);y.has(g)?y.delete(g):y.add(g),r({primary_procedure_id:t||null,additional_procedure_ids:Array.from(y)})};return n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Procedures (from master)"}),n.jsxs("div",{className:"relative w-40",children:[n.jsx(Yt,{className:"pointer-events-none absolute left-2 top-1.5 h-3.5 w-3.5 text-slate-400"}),n.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-500 bg-white pl-7 pr-1.5 py-1.5 text-[11px] text-slate-800 placeholder:text-slate-400 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",placeholder:"Search...",value:c,onChange:g=>d(g.target.value)})]})]}),n.jsxs("div",{className:"space-y-2 rounded-xl border border-slate-500 bg-slate-50/80 p-2",children:[l&&n.jsx("div",{className:"text-[11px] text-slate-500",children:"Loading procedures..."}),!l&&u.length===0&&n.jsx("div",{className:"text-[11px] text-slate-500",children:"No procedures found."}),!l&&u.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] font-semibold text-slate-600",children:[n.jsx($n,{className:"h-3 w-3"}),"Primary procedure"]}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-[11px] text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:t||"",onChange:g=>m(g.target.value),children:[n.jsx("option",{value:"",children:"Not selected"}),u.map(g=>n.jsx("option",{value:g.id,children:(g.code?g.code+"  ":"")+g.name},g.id))]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Additional procedures"}),n.jsx("div",{className:"max-h-32 space-y-1 overflow-auto rounded-lg border border-slate-100 bg-white p-1.5 text-[11px]",children:u.map(g=>{const y=(s||[]).includes(g.id);return n.jsxs("label",{className:"flex cursor-pointer items-center gap-1.5 rounded-md px-1 py-0.5 hover:bg-slate-50",children:[n.jsx("input",{type:"checkbox",className:"h-3 w-3 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:y,onChange:()=>x(g.id)}),n.jsx("span",{className:"truncate",children:(g.code?g.code+"  ":"")+g.name})]},g.id)})})]})]})]})]})}function I5e(){const{user:t,permissions:s}=dn();console.log("OT Schedule page user=",t==null?void 0:t.full_name,"perms=",s);const r=ct("ot.schedule.create")||ct("ot.schedules.create")||ct("ot.cases.create")||ct("ipd.view"),a=ct("ot.schedule.update")||ct("ot.schedules.update")||ct("ot.cases.update"),i=ct("ot.cases.close")||ct("ot.cases.update"),[l,o]=p.useState(S5e(new Date)),[c,d]=p.useState(null),[u,m]=p.useState([]),[x,g]=p.useState(!1),[y,v]=p.useState(null),[j,w]=p.useState(!1),[S,E]=p.useState("create"),[k,A]=p.useState(null),I=Qr(),P=async()=>{if(l)try{g(!0),v(null);const U=await EK({date:l,bedId:c||void 0});m(U.data||[])}catch(U){console.error("Failed to load OT schedule",U),v("Failed to load OT schedule")}finally{g(!1)}},O=async U=>{var W,V,R,F;try{if(U.case_id){I(`/ot/cases/${U.case_id}`);return}const G=await FSe(U.id),H=(W=G==null?void 0:G.data)==null?void 0:W.id;await P(),H?I(`/ot/cases/${H}`):console.warn("No case id returned from open-case response",G)}catch(G){console.error("Failed to open OT case",G);const H=((R=(V=G==null?void 0:G.response)==null?void 0:V.data)==null?void 0:R.detail)||(G==null?void 0:G.message)||"Failed to open OT case";(F=ae.error)==null||F.call(ae,H)}},D=async U=>{var W,V,R,F,G;if(!U.case_id){(W=ae.error)==null||W.call(ae,"No OT case opened for this schedule yet.");return}try{await eSe(U.case_id,{outcome:"Completed"}),(V=ae.success)==null||V.call(ae,"OT case marked as Completed"),await P()}catch(H){console.error("Failed to mark OT case as completed",H);const $=((F=(R=H==null?void 0:H.response)==null?void 0:R.data)==null?void 0:F.detail)||(H==null?void 0:H.message)||"Failed to update OT status";(G=ae.error)==null||G.call(ae,$)}},T=()=>{r&&(E("create"),A(null),w(!0))},B=U=>{a&&(E("edit"),A(U),w(!0))};return p.useEffect(()=>{P()},[l,c]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex h-full flex-col gap-3 p-3 pb-4 md:p-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18},className:"flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("h1",{className:"text-base font-semibold text-slate-900 md:text-lg",children:"OT Schedule (Beds)"}),n.jsx("p",{className:"text-xs text-slate-500 md:text-[13px]",children:"View and manage OT bookings by date and OT bed / location in line with NABH OT records."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-slate-500 bg-slate-50/80 px-3 py-1.5",children:[n.jsx(Ds,{className:"h-4 w-4 text-slate-500"}),n.jsx("input",{type:"date",className:"border-none bg-transparent text-xs font-medium text-slate-800 focus:outline-none",value:l,onChange:U=>o(U.target.value)})]}),n.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-slate-500 bg-white px-3 py-1.5 text-xs font-semibold text-slate-800 hover:border-sky-400 hover:text-sky-800",children:[n.jsx(ps,{className:"h-3.5 w-3.5"}),"Refresh"]}),r&&n.jsxs("button",{type:"button",onClick:T,className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-3.5 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-sky-700",children:[n.jsx(ds,{className:"h-3.5 w-3.5"}),"New Schedule"]})]})]}),y&&n.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-700",children:y}),n.jsxs("div",{className:"grid min-h-[calc(100vh-170px)] grid-cols-1 gap-3 md:grid-cols-[minmax(260px,0.34fr)_minmax(0,0.66fr)]",children:[n.jsx(T5e,{selectedBedId:c,onSelectBed:d}),n.jsx(P5e,{schedules:u,loading:x,date:l,bedId:c,onEdit:B,onOpenCase:O,onMarkSuccess:i?D:void 0})]})]}),n.jsx(D5e,{open:j,mode:S,onClose:()=>w(!1),onSaved:P,defaultDate:l,defaultBedId:c,editingSchedule:k})]})}const O5e=t=>t===!0||t==="true"||t===1||t==="1";function jY({open:t,title:s,subtitle:r,onClose:a,children:i}){return t?n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm",children:n.jsxs("div",{className:"relative w-full max-w-2xl rounded-2xl bg-white shadow-xl",children:[n.jsxs("div",{className:"flex items-start justify-between border-b px-5 py-3.5",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:s}),r&&n.jsx("p",{className:"text-xs text-slate-500",children:r})]}),n.jsx("button",{type:"button",onClick:a,className:"rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-600",children:n.jsx(ts,{className:"h-4 w-4"})})]}),i]})}):null}function R5e(){const[t,s]=p.useState([]),[r,a]=p.useState(!1),[i,l]=p.useState(null),[o,c]=p.useState(""),[d,u]=p.useState(!1),[m,x]=p.useState(null),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState({name:"",code:"",description:"",is_active:!0}),E=p.useMemo(()=>{const D=o.trim().toLowerCase();return D?t.filter(T=>(T.name||"").toLowerCase().includes(D)||(T.code||"").toLowerCase().includes(D)):t},[t,o]),k=async()=>{var D,T;try{a(!0),l(null);const B=await AK({});s(B.data||[])}catch(B){console.error("Failed to load OT specialities",B);const U=((T=(D=B==null?void 0:B.response)==null?void 0:D.data)==null?void 0:T.detail)||(B==null?void 0:B.message)||"Failed to load OT specialities";l(U)}finally{a(!1)}};p.useEffect(()=>{k()},[]);const A=()=>{x(null),S({name:"",code:"",description:"",is_active:!0}),j(null),u(!0)},I=D=>{x(D),S({name:D.name||"",code:D.code||"",description:D.description||"",is_active:O5e(D.is_active)}),j(null),u(!0)},P=async D=>{var T,B;if(D.preventDefault(),!w.name){j("Please enter speciality name");return}if(!w.code){j("Please enter code");return}y(!0),j(null);try{const U={name:w.name,code:w.code,description:w.description||null,is_active:!!w.is_active};m?await G_e(m.id,U):await q_e(U),u(!1),x(null),k()}catch(U){console.error("Failed to save OT speciality",U);const W=((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||(U==null?void 0:U.message)||"Failed to save speciality";j(W)}finally{y(!1)}},O=async D=>{if(window.confirm(`Delete speciality "${D.name}"?`))try{await K_e(D.id),k()}catch(T){console.error("Failed to delete OT speciality",T),alert("Failed to delete")}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[n.jsx(a2,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"OT Specialities"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-2 top-2 h-3.5 w-3.5 text-slate-400"}),n.jsx("input",{type:"text",className:"w-44 rounded-lg border border-slate-500 bg-white pl-7 pr-2 py-1.5 text-xs text-slate-800 placeholder:text-slate-400 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",placeholder:"Search...",value:o,onChange:D=>c(D.target.value)})]}),n.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-700",children:[n.jsx(ds,{className:"h-3.5 w-3.5"}),"New"]})]})]}),i&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:i}),n.jsx("div",{className:"overflow-hidden rounded-2xl border bg-white",children:n.jsxs("table",{className:"min-w-full text-left text-xs text-slate-700",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Code"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Name"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Description"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Active"}),n.jsx("th",{className:"px-4 py-2 text-right text-[11px] font-semibold text-slate-500",children:"Actions"})]})}),n.jsxs("tbody",{children:[r&&n.jsx(n.Fragment,{children:Array.from({length:4}).map((D,T)=>n.jsx("tr",{className:"animate-pulse border-t",children:Array.from({length:5}).map((B,U)=>n.jsx("td",{className:"px-4 py-2",children:n.jsx("div",{className:"h-3 w-3/4 rounded bg-slate-100"})},U))},T))}),!r&&E.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-xs text-slate-500",children:n.jsxs("div",{className:"flex flex-col items-center justify-center gap-1",children:[n.jsx(en,{className:"h-4 w-4 text-amber-500"}),n.jsx("span",{children:"No OT specialities found."})]})})}),!r&&E.map(D=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-4 py-2 text-xs font-medium text-slate-800",children:D.code}),n.jsx("td",{className:"px-4 py-2 text-xs text-slate-800",children:D.name}),n.jsx("td",{className:"px-4 py-2 text-xs text-slate-600",children:D.description||""}),n.jsx("td",{className:"px-4 py-2 text-xs",children:n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ${D.is_active?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:D.is_active?"Active":"Inactive"})}),n.jsx("td",{className:"px-4 py-2 text-right text-xs",children:n.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[n.jsxs("button",{type:"button",onClick:()=>I(D),className:"inline-flex items-center gap-1 rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px] text-slate-700 hover:border-sky-400 hover:text-sky-700",children:[n.jsx(Yr,{className:"h-3 w-3"}),"Edit"]}),n.jsxs("button",{type:"button",onClick:()=>O(D),className:"inline-flex items-center gap-1 rounded-lg border border-rose-200 bg-white px-2 py-1 text-[11px] text-rose-600 hover:bg-rose-50",children:[n.jsx(Ms,{className:"h-3 w-3"}),"Delete"]})]})})]},D.id))]})]})})]}),n.jsx(jY,{open:d,title:m?"Edit OT Speciality":"New OT Speciality",subtitle:"Map OT workload by speciality for scheduling and reporting.",onClose:()=>u(!1),children:n.jsxs("form",{onSubmit:P,children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 px-5 py-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-medium text-slate-700",children:["Code ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:w.code,onChange:D=>S(T=>({...T,code:D.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-medium text-slate-700",children:["Name ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:w.name,onChange:D=>S(T=>({...T,name:D.target.value}))})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Description"}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:w.description,onChange:D=>S(T=>({...T,description:D.target.value}))})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{id:"ot_spec_active",type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:!!w.is_active,onChange:D=>S(T=>({...T,is_active:D.target.checked}))}),n.jsx("label",{htmlFor:"ot_spec_active",className:"text-xs text-slate-700",children:"Active"})]}),v&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:v})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 border-t px-5 py-3",children:[n.jsx("button",{type:"button",onClick:()=>u(!1),className:"inline-flex items-center gap-1.5 rounded-xl border border-slate-500 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",disabled:g,children:"Cancel"}),n.jsxs("button",{type:"submit",className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-700 disabled:opacity-60",disabled:g,children:[g&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save"]})]})]})})]})}function L5e(){const[t,s]=p.useState([]),[r,a]=p.useState(!1),[i,l]=p.useState(null),[o,c]=p.useState(""),[d,u]=p.useState([]),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState(!1),[E,k]=p.useState(null),[A,I]=p.useState({code:"",name:"",speciality_id:"",duration_hours:"",duration_minutes:"",rate_per_hour:"",description:"",is_active:!0}),P=p.useMemo(()=>{const V=o.trim().toLowerCase();return V?t.filter(R=>{var $;const F=(R.name||"").toLowerCase(),G=(R.code||"").toLowerCase(),H=((($=R.speciality)==null?void 0:$.name)||"").toLowerCase();return F.includes(V)||G.includes(V)||H.includes(V)}):t},[t,o]),O=async()=>{var V,R;try{a(!0),l(null);const F=await pP({});s(F.data||[])}catch(F){console.error("Failed to load OT procedures",F);const G=((R=(V=F==null?void 0:F.response)==null?void 0:V.data)==null?void 0:R.detail)||(F==null?void 0:F.message)||"Failed to load OT procedures";l(G)}finally{a(!1)}},D=async()=>{try{x(!0);const V=await AK({});u(V.data||[])}catch(V){console.error("Failed to load OT specialities for procedures",V)}finally{x(!1)}};p.useEffect(()=>{O(),D()},[]);const T=()=>{j(null),I({code:"",name:"",speciality_id:"",duration_hours:"",duration_minutes:"",rate_per_hour:"",description:"",is_active:!0}),k(null),y(!0)},B=V=>{const R=V.default_duration_min??null,F=R!=null?Math.floor(R/60):"",G=R!=null?R%60:"";j(V),I({code:V.code||"",name:V.name||"",speciality_id:V.speciality_id||"",duration_hours:F===0&&G===0?"":String(F||""),duration_minutes:G===0&&F===0?"":String(G||""),rate_per_hour:V.rate_per_hour!=null?String(V.rate_per_hour):"",description:V.description||"",is_active:!!V.is_active}),k(null),y(!0)},U=async V=>{var K,le;if(V.preventDefault(),!A.code)return k("Please enter procedure code");if(!A.name)return k("Please enter procedure name");const R=A.duration_hours?Number(A.duration_hours):0,F=A.duration_minutes?Number(A.duration_minutes):0,G=R*60+F,H=G>0?G:null,$=A.rate_per_hour===""||A.rate_per_hour===null?null:Number(A.rate_per_hour);S(!0),k(null);try{const se={code:A.code,name:A.name,speciality_id:A.speciality_id?Number(A.speciality_id):null,default_duration_min:H,rate_per_hour:$,description:A.description||null,is_active:!!A.is_active};v?await X_e(v.id,se):await Y_e(se),y(!1),j(null),O()}catch(se){console.error("Failed to save OT procedure",se);const J=((le=(K=se==null?void 0:se.response)==null?void 0:K.data)==null?void 0:le.detail)||(se==null?void 0:se.message)||"Failed to save procedure";k(J)}finally{S(!1)}},W=async V=>{if(window.confirm(`Delete procedure "${V.name}"?`))try{await Q_e(V.id),O()}catch(R){console.error("Failed to delete OT procedure",R),alert("Failed to delete procedure")}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-700",children:[n.jsx($n,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"OT Procedures"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-2 top-2 h-3.5 w-3.5 text-slate-400"}),n.jsx("input",{type:"text",className:"w-56 rounded-lg border border-slate-500 bg-white pl-7 pr-2 py-1.5 text-xs text-slate-800 placeholder:text-slate-400 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",placeholder:"Search by code, name, speciality...",value:o,onChange:V=>c(V.target.value)})]}),n.jsxs("button",{type:"button",onClick:T,className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-700",children:[n.jsx(ds,{className:"h-3.5 w-3.5"}),"New"]})]})]}),i&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:i}),n.jsx("div",{className:"overflow-x-auto rounded-2xl border bg-white",children:n.jsxs("table",{className:"min-w-full text-left text-xs text-slate-700",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Code"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Name"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Speciality"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Default Duration"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Rate / hour"}),n.jsx("th",{className:"px-4 py-2 text-[11px] font-semibold text-slate-500",children:"Active"}),n.jsx("th",{className:"px-4 py-2 text-right text-[11px] font-semibold text-slate-500",children:"Actions"})]})}),n.jsxs("tbody",{children:[r&&n.jsx(n.Fragment,{children:Array.from({length:4}).map((V,R)=>n.jsx("tr",{className:"animate-pulse border-t",children:Array.from({length:7}).map((F,G)=>n.jsx("td",{className:"px-4 py-2",children:n.jsx("div",{className:"h-3 w-3/4 rounded bg-slate-100"})},G))},R))}),!r&&P.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-xs text-slate-500",children:n.jsxs("div",{className:"flex flex-col items-center justify-center gap-1",children:[n.jsx(en,{className:"h-4 w-4 text-amber-500"}),n.jsx("span",{children:"No OT procedures found."})]})})}),!r&&P.map(V=>{var G;const R=V.default_duration_min??null;let F="";if(R!=null&&R>0){const H=Math.floor(R/60),$=R%60;F=H>0&&$>0?`${H}h ${$}min`:H>0?`${H}h`:`${$}min`}return n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-4 py-2 text-xs font-medium text-slate-800",children:V.code}),n.jsx("td",{className:"px-4 py-2 text-xs text-slate-800",children:V.name}),n.jsx("td",{className:"px-4 py-2 text-xs text-slate-600",children:((G=V.speciality)==null?void 0:G.name)||V.speciality_id&&`#${V.speciality_id}`||""}),n.jsx("td",{className:"px-4 py-2 text-xs text-slate-600",children:F}),n.jsx("td",{className:"px-4 py-2 text-xs text-slate-600",children:V.rate_per_hour!=null?` ${Number(V.rate_per_hour).toFixed(2)}`:""}),n.jsx("td",{className:"px-4 py-2 text-xs",children:n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ${V.is_active?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:V.is_active?"Active":"Inactive"})}),n.jsx("td",{className:"px-4 py-2 text-right text-xs",children:n.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[n.jsxs("button",{type:"button",onClick:()=>B(V),className:"inline-flex items-center gap-1 rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px] text-slate-700 hover:border-sky-400 hover:text-sky-700",children:[n.jsx(Yr,{className:"h-3 w-3"}),"Edit"]}),n.jsxs("button",{type:"button",onClick:()=>W(V),className:"inline-flex items-center gap-1 rounded-lg border border-rose-200 bg-white px-2 py-1 text-[11px] text-rose-600 hover:bg-rose-50",children:[n.jsx(Ms,{className:"h-3 w-3"}),"Delete"]})]})})]},V.id)})]})]})})]}),n.jsx(jY,{open:g,title:v?"Edit OT Procedure":"New OT Procedure",subtitle:"Define procedures with default duration and hour-based rate for billing.",onClose:()=>y(!1),children:n.jsxs("form",{onSubmit:U,children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 px-5 py-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-medium text-slate-700",children:["Code ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.code,onChange:V=>I(R=>({...R,code:V.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-medium text-slate-700",children:["Name ",n.jsx("span",{className:"text-rose-500",children:"*"})]}),n.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.name,onChange:V=>I(R=>({...R,name:V.target.value}))})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Default speciality (optional)"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.speciality_id,onChange:V=>I(R=>({...R,speciality_id:V.target.value})),children:[n.jsx("option",{value:"",children:"Not mapped"}),d.map(V=>n.jsx("option",{value:V.id,children:(V.code?`${V.code}  `:"")+V.name},V.id))]}),m&&n.jsx("p",{className:"mt-0.5 text-[10px] text-slate-400",children:"Loading specialities..."})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Default duration  hours"}),n.jsx("input",{type:"number",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.duration_hours,onChange:V=>I(R=>({...R,duration_hours:V.target.value})),placeholder:"e.g., 2"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Default duration  minutes"}),n.jsx("input",{type:"number",min:"0",max:"59",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.duration_minutes,onChange:V=>I(R=>({...R,duration_minutes:V.target.value})),placeholder:"e.g., 30"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Rate per hour ()"}),n.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.rate_per_hour,onChange:V=>I(R=>({...R,rate_per_hour:V.target.value})),placeholder:"e.g., 5000"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium text-slate-700",children:"Description / notes"}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-lg border border-slate-500 bg-white px-2.5 py-1.5 text-xs text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500",value:A.description,onChange:V=>I(R=>({...R,description:V.target.value})),placeholder:"E.g., Includes surgeon charges only; anaesthesia separate."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{id:"ot_proc_active",type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:!!A.is_active,onChange:V=>I(R=>({...R,is_active:V.target.checked}))}),n.jsx("label",{htmlFor:"ot_proc_active",className:"text-xs text-slate-700",children:"Active"})]}),E&&n.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:E})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 border-t px-5 py-3",children:[n.jsx("button",{type:"button",onClick:()=>y(!1),className:"inline-flex items-center gap-1.5 rounded-xl border border-slate-500 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",disabled:w,children:"Cancel"}),n.jsxs("button",{type:"submit",className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-700 disabled:opacity-60",disabled:w,children:[w&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save"]})]})]})})]})}const F5e=[{id:"specialities",label:"Specialities"},{id:"procedures",label:"Procedures"}];function B5e(){const[t,s]=p.useState("specialities");return n.jsxs("div",{className:"flex h-full flex-col gap-3 p-4",children:[n.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold text-slate-900",children:"OT Masters"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Configure OT specialities and procedures as per NABH."})]})}),n.jsx("div",{className:"flex gap-2 border-b border-slate-500",children:F5e.map(r=>{const a=r.id===t;return n.jsxs("button",{type:"button",onClick:()=>s(r.id),className:`relative px-3 py-1.5 text-xs font-medium transition-colors ${a?"text-sky-700":"text-slate-500 hover:text-slate-800"}`,children:[r.label,a&&n.jsx("span",{className:"absolute inset-x-0 bottom-0 h-0.5 rounded-full bg-sky-600"})]},r.id)})}),n.jsxs("div",{className:"flex-1 overflow-auto pt-2",children:[t==="specialities"&&n.jsx(R5e,{}),t==="procedures"&&n.jsx(L5e,{})]})]})}const hj=[{key:"allergy",label:"Allergy"},{key:"consent_form_signed",label:"Consent form signed"},{key:"written_high_risk_signed",label:"Written high risk form signed"},{key:"identity_bands_checked",label:"Identity bands checked"},{key:"npo",label:"Nill per mouth (NPO)"},{key:"pre_medication_given",label:"Pre-medication given"},{key:"test_dose_given",label:"Test dose given"},{key:"bowel_preparation",label:"Bowel preparation"},{key:"bladder_empty_time",label:"Bladder empty time"},{key:"serology_results",label:"Serology results"},{key:"blood_grouping",label:"Blood grouping"},{key:"blood_reservation",label:"Blood reservation"},{key:"patient_files_with_records",label:"Patient IP/OP files, ECG / X-ray with old records"},{key:"pre_anaesthetic_evaluation",label:"Pre-anaesthetic evaluation"},{key:"jewellery_nailpolish_removed",label:"Jewellery, nail polish, make-up removed"},{key:"prosthesis_dentures_wig_contactlens_removed",label:"Prosthesis / dentures / wig / contact lens removed"},{key:"sterile_preparation_done",label:"Sterile preparation done"}],xj=()=>({checklist:hj.reduce((t,s)=>(t[s.key]={handover:!1,receiving:!1,comments:""},t),{}),investigations:{hb:"",platelet:"",urea:"",creatinine:"",potassium:"",rbs:"",other:""},vitals:{temp:"",pulse:"",resp:"",bp:"",spo2:"",height:"",weight:""},shave_completed:null,nurse_signature:""}),$5e=t=>{const s=xj();if(!t||typeof t!="object")return s;const r={...s};return t.checklist&&typeof t.checklist=="object"&&(r.checklist={...s.checklist,...t.checklist}),"patient_identity_confirmed"in t&&(r.checklist.identity_bands_checked={...r.checklist.identity_bands_checked,handover:!!t.patient_identity_confirmed}),"consent_checked"in t&&(r.checklist.consent_form_signed={...r.checklist.consent_form_signed,handover:!!t.consent_checked}),"investigations_checked"in t&&(r.checklist.patient_files_with_records={...r.checklist.patient_files_with_records,handover:!!t.investigations_checked}),"blood_products_arranged"in t&&(r.checklist.blood_reservation={...r.checklist.blood_reservation,handover:!!t.blood_products_arranged}),"implants_available"in t&&(r.checklist.prosthesis_dentures_wig_contactlens_removed={...r.checklist.prosthesis_dentures_wig_contactlens_removed,handover:!!t.implants_available}),"site_marked"in t&&(r.checklist.pre_anaesthetic_evaluation={...r.checklist.pre_anaesthetic_evaluation,handover:!!t.site_marked}),t.fasting_status&&(r.checklist.npo={...r.checklist.npo,comments:t.fasting_status}),t.device_checks&&(r.checklist.pre_anaesthetic_evaluation={...r.checklist.pre_anaesthetic_evaluation,comments:t.device_checks}),t.notes&&(r.checklist.sterile_preparation_done={...r.checklist.sterile_preparation_done,comments:t.notes}),t.investigations&&(r.investigations={...s.investigations,...t.investigations}),t.vitals&&(r.vitals={...s.vitals,...t.vitals}),"shave_completed"in t&&(r.shave_completed=t.shave_completed),"nurse_signature"in t&&(r.nurse_signature=t.nurse_signature||""),r};function z5e({caseId:t}){const s=ct("ot.preop_checklist.view")||ct("ot.cases.view")||ct("ipd.view"),r=ct("ot.preop_checklist.update")||ct("ot.preop_checklist.create")||ct("ot.cases.update")||ct("ipd.doctor"),[a,i]=p.useState(null),[l,o]=p.useState(()=>xj()),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),y=async()=>{var A;if(s)try{d(!0),g(null);const I=await sSe(t),P=(I==null?void 0:I.data)??I;if(!P){i(null),o(xj());return}i(P),o($5e(P))}catch(I){((A=I==null?void 0:I.response)==null?void 0:A.status)===404?(i(null),o(xj())):(console.error("Failed to load Pre-op checklist",I),g("Failed to load Pre-op checklist"))}finally{d(!1)}};if(p.useEffect(()=>{y()},[t,s]),!s)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view pre-operative checklists."});const v=(A,I,P)=>{o(O=>({...O,checklist:{...O.checklist,[A]:{...O.checklist[A],[I]:P}}}))},j=(A,I)=>{o(P=>({...P,investigations:{...P.investigations,[A]:I}}))},w=(A,I)=>{o(P=>({...P,vitals:{...P.vitals,[A]:I}}))},S=async A=>{var I,P;if(A.preventDefault(),!!r){m(!0),g(null);try{const O={checklist:l.checklist,investigations:{...l.investigations},vitals:{...l.vitals},shave_completed:l.shave_completed,nurse_signature:l.nurse_signature||null,patient_identity_confirmed:!!l.checklist.identity_bands_checked.handover,consent_checked:!!l.checklist.consent_form_signed.handover,investigations_checked:!!l.checklist.patient_files_with_records.handover,blood_products_arranged:!!l.checklist.blood_reservation.handover,implants_available:!!l.checklist.prosthesis_dentures_wig_contactlens_removed.handover,site_marked:!!l.checklist.pre_anaesthetic_evaluation.handover,fasting_status:l.checklist.npo.comments||null,device_checks:l.checklist.pre_anaesthetic_evaluation.comments||null,notes:l.checklist.sterile_preparation_done.comments||null,completed:!1};a?await rSe(t,O):await nSe(t,O),await y()}catch(O){console.error("Failed to save Pre-op checklist",O);const D=((P=(I=O==null?void 0:O.response)==null?void 0:I.data)==null?void 0:P.detail)||(O==null?void 0:O.message)||"Failed to save Pre-op checklist";g(D)}finally{m(!1)}}},E=(a==null?void 0:a.completed_at)||(a==null?void 0:a.updated_at)||(a==null?void 0:a.created_at),k=p.useMemo(()=>{var O;const A=hj.length;let I=0,P=0;for(const D of hj){const T=((O=l.checklist)==null?void 0:O[D.key])||{};T.handover&&(I+=1),T.receiving&&(P+=1)}return{total:A,h:I,r:P}},[l.checklist]);return n.jsxs("form",{onSubmit:S,className:"space-y-4 rounded-3xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"flex flex-wrap items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-start gap-2 text-sky-800",children:[n.jsx("div",{className:"mt-0.5 flex h-9 w-9 items-center justify-center rounded-2xl bg-sky-50 text-sky-700",children:n.jsx(tue,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"Pre-operative checklist"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Checklist  Investigations  Vitals  Body shave  Signature"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"rounded-full bg-slate-100 px-2.5 py-1 text-[11px] font-medium text-slate-700",children:["Handover: ",n.jsx("span",{className:"font-semibold",children:k.h}),"/",k.total]}),n.jsxs("span",{className:"rounded-full bg-slate-100 px-2.5 py-1 text-[11px] font-medium text-slate-700",children:["Receiving: ",n.jsx("span",{className:"font-semibold",children:k.r}),"/",k.total]}),E?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-medium text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Last saved: ",new Date(E).toLocaleString()]}):null]})]}),c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-10 w-full animate-pulse rounded-2xl bg-slate-100"}),n.jsx("div",{className:"h-10 w-full animate-pulse rounded-2xl bg-slate-100"}),n.jsx("div",{className:"h-10 w-full animate-pulse rounded-2xl bg-slate-100"})]}),x&&n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-3.5 w-3.5"}),n.jsx("span",{children:x})]}),!c&&n.jsxs(n.Fragment,{children:[n.jsxs(N0,{title:"Checklist",subtitle:"Aligned handover & receiving with comments (desktop table, mobile cards).",children:[n.jsxs("div",{className:"hidden md:grid md:grid-cols-[minmax(260px,1fr)_120px_120px_minmax(260px,1fr)] md:gap-3 md:rounded-2xl md:border md:border-slate-500 md:bg-white md:px-3 md:py-2",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Item"}),n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Handover"}),n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Receiving"}),n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Comments"})]}),n.jsx(on,{initial:!1,children:hj.map((A,I)=>{const P=l.checklist[A.key],O=!!(P!=null&&P.handover)||!!(P!=null&&P.receiving)||!!(P!=null&&P.comments);return n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14,delay:I*.006},className:"rounded-2xl border px-3 py-3 "+(O?"border-sky-200 bg-sky-50/60":"border-slate-500 bg-slate-50/50"),children:[n.jsxs("div",{className:"hidden md:grid md:grid-cols-[minmax(260px,1fr)_120px_120px_minmax(260px,1fr)] md:items-center md:gap-3",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:A.label}),n.jsx("div",{className:"flex items-center",children:n.jsx(q8,{label:"Handover",checked:!!P.handover,disabled:!r,onChange:D=>v(A.key,"handover",D)})}),n.jsx("div",{className:"flex items-center",children:n.jsx(q8,{label:"Receiving",checked:!!P.receiving,disabled:!r,onChange:D=>v(A.key,"receiving",D)})}),n.jsx("div",{children:n.jsx(W8,{value:P.comments||"",disabled:!r,placeholder:"Comments / remarks",onChange:D=>v(A.key,"comments",D)})})]}),n.jsxs("div",{className:"md:hidden",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:A.label}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-3 text-[11px]",children:[n.jsxs("label",{className:"inline-flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:!!P.handover,disabled:!r,onChange:D=>v(A.key,"handover",D.target.checked)}),n.jsx("span",{className:"font-medium text-slate-700",children:"Handover"})]}),n.jsxs("label",{className:"inline-flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:!!P.receiving,disabled:!r,onChange:D=>v(A.key,"receiving",D.target.checked)}),n.jsx("span",{className:"font-medium text-slate-700",children:"Receiving"})]})]}),n.jsx("div",{className:"mt-2",children:n.jsx(W8,{value:P.comments||"",disabled:!r,placeholder:"Comments / remarks",onChange:D=>v(A.key,"comments",D)})})]})]},A.key)})})]}),n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsx(N0,{title:"Investigations",subtitle:"Enter latest lab values (as available).",children:n.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[n.jsx(yi,{label:"HB",value:l.investigations.hb,disabled:!r,onChange:A=>j("hb",A)}),n.jsx(yi,{label:"Platelet",value:l.investigations.platelet,disabled:!r,onChange:A=>j("platelet",A)}),n.jsx(yi,{label:"Urea",value:l.investigations.urea,disabled:!r,onChange:A=>j("urea",A)}),n.jsx(yi,{label:"Creatinine",value:l.investigations.creatinine,disabled:!r,onChange:A=>j("creatinine",A)}),n.jsx(yi,{label:"Potassium",value:l.investigations.potassium,disabled:!r,onChange:A=>j("potassium",A)}),n.jsx(yi,{label:"RBS",value:l.investigations.rbs,disabled:!r,onChange:A=>j("rbs",A)}),n.jsx("div",{className:"sm:col-span-2",children:n.jsx(yi,{label:"Other",value:l.investigations.other,disabled:!r,onChange:A=>j("other",A)})})]})}),n.jsx(N0,{title:"Vitals",subtitle:"Pre-op vitals summary (as recorded).",children:n.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[n.jsx(yi,{label:"Temp",value:l.vitals.temp,disabled:!r,onChange:A=>w("temp",A)}),n.jsx(yi,{label:"Pulse",value:l.vitals.pulse,disabled:!r,onChange:A=>w("pulse",A)}),n.jsx(yi,{label:"Resp",value:l.vitals.resp,disabled:!r,onChange:A=>w("resp",A)}),n.jsx(yi,{label:"BP",value:l.vitals.bp,disabled:!r,onChange:A=>w("bp",A)}),n.jsx(yi,{label:"SpO",value:l.vitals.spo2,disabled:!r,onChange:A=>w("spo2",A)}),n.jsx(yi,{label:"Height",value:l.vitals.height,disabled:!r,onChange:A=>w("height",A)}),n.jsx(yi,{label:"Weight",value:l.vitals.weight,disabled:!r,onChange:A=>w("weight",A)})]})})]}),n.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[n.jsxs(N0,{title:"Body shave",subtitle:"Record shave completion status (for site preparation).",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(nk,{active:l.shave_completed==="yes",disabled:!r,onClick:()=>o(A=>({...A,shave_completed:"yes"})),children:"Yes"}),n.jsx(nk,{active:l.shave_completed==="no",disabled:!r,onClick:()=>o(A=>({...A,shave_completed:"no"})),children:"No"}),n.jsx(nk,{active:l.shave_completed===null,disabled:!r,onClick:()=>o(A=>({...A,shave_completed:null})),children:"Not recorded"})]}),n.jsx("p",{className:"mt-2 text-[11px] text-slate-500",children:"(Body diagram marking can be handled at PDF / print level.)"})]}),n.jsx(N0,{title:"Nurse signature",subtitle:"Signature with name (handover / receiving nurse).",children:n.jsx(yi,{label:"Name & signature",value:l.nurse_signature,disabled:!r,placeholder:"Enter nurse name / signature",onChange:A=>o(I=>({...I,nurse_signature:A}))})})]}),r&&n.jsx("div",{className:"flex justify-end pt-1",children:n.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center justify-center gap-2 rounded-full border border-sky-600 bg-sky-600 px-4 py-2 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[u&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save Pre-op checklist"]})})]})]})}function N0({title:t,subtitle:s,children:r}){return n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-slate-50/60 p-3 md:p-4",children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:t}),s?n.jsx("div",{className:"text-[12px] text-slate-600",children:s}):null]}),n.jsx("div",{className:"space-y-3",children:r})]})}function W8({value:t,onChange:s,placeholder:r,disabled:a}){return n.jsx("input",{type:"text",className:"w-full rounded-2xl border border-slate-500 bg-white px-3 py-2 text-[11px] text-slate-800 placeholder:text-slate-400 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",value:t??"",placeholder:r,disabled:a,onChange:i=>s(i.target.value)})}function yi({label:t,value:s,onChange:r,placeholder:a,disabled:i}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"text",className:"h-10 w-full rounded-2xl border border-slate-500 bg-white px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",placeholder:a,disabled:i,onChange:l=>r(l.target.value)})]})}function q8({checked:t,onChange:s,disabled:r}){return n.jsx("label",{className:"inline-flex items-center gap-2",children:n.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!t,disabled:r,onChange:a=>s(a.target.checked)})})}function nk({active:t,onClick:s,disabled:r,children:a}){return n.jsx("button",{type:"button",onClick:s,disabled:r,className:"rounded-full px-3 py-1.5 text-[12px] font-semibold transition "+(t?"bg-slate-900 text-white shadow-sm":"bg-white text-slate-700 hover:bg-slate-100")+" disabled:cursor-not-allowed disabled:opacity-60",children:a})}function U5e(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function V5e(t){const s=U5e(t);return s?s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function rk(t){if(!t)return"";if(/^\d{2}:\d{2}$/.test(t))return t;const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toISOString().slice(11,16)}function H5e(){const t=new Date,s=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`${s}:${r}`}const NY={identity_site_procedure_consent_confirmed:!1,site_marked:"",machine_and_medication_check_complete:!1,known_allergy:"",difficult_airway_or_aspiration_risk:"",blood_loss_risk_gt500ml_or_7mlkg:"",equipment_assistance_available:!1,iv_central_access_and_fluids_planned:!1},wY={team_members_introduced:!1,patient_name_procedure_incision_site_confirmed:!1,antibiotic_prophylaxis_given:"",surgeon_critical_steps:"",surgeon_case_duration_estimate:"",surgeon_anticipated_blood_loss:"",anaesthetist_patient_specific_concerns:"",sterility_confirmed:!1,equipment_issues_or_concerns:!1,essential_imaging_displayed:""},_Y={procedure_name_confirmed:!1,counts_complete:!1,specimens_labelled_correctly:!1,equipment_problems_to_be_addressed:"",key_concerns_for_recovery_and_management:""},ak=()=>({sign_in_done:!1,sign_in_time:"",time_out_done:!1,time_out_time:"",sign_out_done:!1,sign_out_time:"",sign_in:{...NY},time_out:{...wY},sign_out:{..._Y}});function W5e({caseId:t}){const s=ct("ot.safety_checklist.view")||ct("ot.cases.view")||ct("ipd.view"),r=ct("ot.safety_checklist.update")||ct("ot.safety_checklist.create")||ct("ot.cases.update")||ct("ipd.doctor"),[a,i]=p.useState(null),[l,o]=p.useState(ak()),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(null),j=p.useMemo(()=>x?n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:[n.jsx(Vs,{className:"mt-0.5 h-3.5 w-3.5"}),n.jsx("span",{children:x})]}):y?n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-700",children:[n.jsx(Xt,{className:"mt-0.5 h-3.5 w-3.5"}),n.jsx("span",{children:y})]}):null,[x,y]),w=async()=>{var P,O,D;if(s)try{d(!0),g(null),v(null);const T=await aSe(t),B=(T==null?void 0:T.data)??T;if(!B){i(null),o(ak());return}i(B),o({sign_in_done:!!B.sign_in_done,sign_in_time:rk(B.sign_in_time),time_out_done:!!B.time_out_done,time_out_time:rk(B.time_out_time),sign_out_done:!!B.sign_out_done,sign_out_time:rk(B.sign_out_time),sign_in:{...NY,...B.sign_in||{}},time_out:{...wY,...B.time_out||{}},sign_out:{..._Y,...B.sign_out||{}}})}catch(T){((P=T==null?void 0:T.response)==null?void 0:P.status)===404?(i(null),o(ak())):(console.error("Failed to load Surgical Safety checklist",T),g(((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||"Failed to load Surgical Safety checklist"))}finally{d(!1)}};if(p.useEffect(()=>{w()},[t,s]),!s)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view Surgical Safety Checklist."});const S=(P,O)=>{o(D=>({...D,[P]:O}))},E=(P,O,D)=>{o(T=>({...T,[P]:{...T[P],[O]:D}}))},k=(P,O)=>D=>{o(T=>{const B={...T,[P]:D};return D&&!T[O]&&(B[O]=H5e()),B})},A=async P=>{var O,D;if(P.preventDefault(),!!r){m(!0),g(null),v(null);try{const T={sign_in_done:!!l.sign_in_done,sign_in_time:l.sign_in_time||null,time_out_done:!!l.time_out_done,time_out_time:l.time_out_time||null,sign_out_done:!!l.sign_out_done,sign_out_time:l.sign_out_time||null,sign_in:l.sign_in,time_out:l.time_out,sign_out:l.sign_out};a?await lSe(t,T):await iSe(t,T),await w(),v("Safety checklist saved.")}catch(T){console.error("Failed to save Surgical Safety checklist",T);const B=((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||(T==null?void 0:T.message)||"Failed to save Surgical Safety checklist";g(B)}finally{m(!1)}}},I=(a==null?void 0:a.updated_at)||(a==null?void 0:a.created_at);return n.jsxs("form",{onSubmit:A,className:"space-y-4 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sky-800",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-700",children:n.jsx(Ka,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"WHO Surgical Safety Checklist"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Sign-in  Time-out  Sign-out"})]})]}),I&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-medium text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Updated: ",V5e(I)]})]}),j,c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-10 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-10 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-10 w-full animate-pulse rounded-xl bg-slate-100"})]}),!c&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsx(ik,{title:"Sign-in",subtitle:"Before induction",done:!!l.sign_in_done,time:l.sign_in_time,disabled:!r,onDoneChange:k("sign_in_done","sign_in_time"),onTimeChange:P=>S("sign_in_time",P)}),n.jsx(ik,{title:"Time-out",subtitle:"Before incision",done:!!l.time_out_done,time:l.time_out_time,disabled:!r,onDoneChange:k("time_out_done","time_out_time"),onTimeChange:P=>S("time_out_time",P)}),n.jsx(ik,{title:"Sign-out",subtitle:"Before leaving OT",done:!!l.sign_out_done,time:l.sign_out_time,disabled:!r,onDoneChange:k("sign_out_done","sign_out_time"),onTimeChange:P=>S("sign_out_time",P)})]}),n.jsx(lk,{title:"Sign-in checklist",children:n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(Vo,{label:"Identity / site / procedure / consent confirmed",checked:!!l.sign_in.identity_site_procedure_consent_confirmed,disabled:!r,onChange:P=>E("sign_in","identity_site_procedure_consent_confirmed",P)}),n.jsx(Vo,{label:"Machine & medication check complete",checked:!!l.sign_in.machine_and_medication_check_complete,disabled:!r,onChange:P=>E("sign_in","machine_and_medication_check_complete",P)}),n.jsx(Ox,{label:"Site marked",value:l.sign_in.site_marked||"",disabled:!r,options:[{value:"",label:""},{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}],onChange:P=>E("sign_in","site_marked",P)}),n.jsx(Ox,{label:"Known allergy",value:l.sign_in.known_allergy||"",disabled:!r,options:[{value:"",label:""},{value:"yes",label:"Yes"},{value:"no",label:"No"}],onChange:P=>E("sign_in","known_allergy",P)}),n.jsx(Ox,{label:"Difficult airway / aspiration risk",value:l.sign_in.difficult_airway_or_aspiration_risk||"",disabled:!r,options:[{value:"",label:""},{value:"yes",label:"Yes"},{value:"no",label:"No"}],onChange:P=>E("sign_in","difficult_airway_or_aspiration_risk",P)}),n.jsx(Ox,{label:"Blood loss risk > 500 ml / 7 ml/kg",value:l.sign_in.blood_loss_risk_gt500ml_or_7mlkg||"",disabled:!r,options:[{value:"",label:""},{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}],onChange:P=>E("sign_in","blood_loss_risk_gt500ml_or_7mlkg",P)}),n.jsx(Vo,{label:"Equipment / assistance available",checked:!!l.sign_in.equipment_assistance_available,disabled:!r,onChange:P=>E("sign_in","equipment_assistance_available",P)}),n.jsx(Vo,{label:"IV / central access & fluids planned",checked:!!l.sign_in.iv_central_access_and_fluids_planned,disabled:!r,onChange:P=>E("sign_in","iv_central_access_and_fluids_planned",P)})]})}),n.jsx(lk,{title:"Time-out checklist",children:n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(Vo,{label:"Team members introduced",checked:!!l.time_out.team_members_introduced,disabled:!r,onChange:P=>E("time_out","team_members_introduced",P)}),n.jsx(Vo,{label:"Patient name / procedure / incision site confirmed",checked:!!l.time_out.patient_name_procedure_incision_site_confirmed,disabled:!r,onChange:P=>E("time_out","patient_name_procedure_incision_site_confirmed",P)}),n.jsx(Ox,{label:"Antibiotic prophylaxis given",value:l.time_out.antibiotic_prophylaxis_given||"",disabled:!r,options:[{value:"",label:""},{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}],onChange:P=>E("time_out","antibiotic_prophylaxis_given",P)}),n.jsx(Ox,{label:"Essential imaging displayed",value:l.time_out.essential_imaging_displayed||"",disabled:!r,options:[{value:"",label:""},{value:"yes",label:"Yes"},{value:"no",label:"No"},{value:"na",label:"N/A"}],onChange:P=>E("time_out","essential_imaging_displayed",P)}),n.jsx(Rx,{label:"Surgeon  critical steps",value:l.time_out.surgeon_critical_steps,disabled:!r,onChange:P=>E("time_out","surgeon_critical_steps",P)}),n.jsx(Rx,{label:"Surgeon  duration estimate",value:l.time_out.surgeon_case_duration_estimate,disabled:!r,onChange:P=>E("time_out","surgeon_case_duration_estimate",P)}),n.jsx(Rx,{label:"Surgeon  anticipated blood loss",value:l.time_out.surgeon_anticipated_blood_loss,disabled:!r,onChange:P=>E("time_out","surgeon_anticipated_blood_loss",P)}),n.jsx(Rx,{label:"Anaesthetist  patient concerns",value:l.time_out.anaesthetist_patient_specific_concerns,disabled:!r,onChange:P=>E("time_out","anaesthetist_patient_specific_concerns",P)}),n.jsx(Vo,{label:"Sterility confirmed",checked:!!l.time_out.sterility_confirmed,disabled:!r,onChange:P=>E("time_out","sterility_confirmed",P)}),n.jsx(Vo,{label:"Equipment issues / concerns",checked:!!l.time_out.equipment_issues_or_concerns,disabled:!r,onChange:P=>E("time_out","equipment_issues_or_concerns",P)})]})}),n.jsx(lk,{title:"Sign-out checklist",children:n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(Vo,{label:"Procedure name confirmed",checked:!!l.sign_out.procedure_name_confirmed,disabled:!r,onChange:P=>E("sign_out","procedure_name_confirmed",P)}),n.jsx(Vo,{label:"Counts complete",checked:!!l.sign_out.counts_complete,disabled:!r,onChange:P=>E("sign_out","counts_complete",P)}),n.jsx(Vo,{label:"Specimens labelled correctly",checked:!!l.sign_out.specimens_labelled_correctly,disabled:!r,onChange:P=>E("sign_out","specimens_labelled_correctly",P)}),n.jsx(Rx,{label:"Equipment problems to be addressed",value:l.sign_out.equipment_problems_to_be_addressed,disabled:!r,onChange:P=>E("sign_out","equipment_problems_to_be_addressed",P)}),n.jsx(Rx,{label:"Key concerns for recovery & management",value:l.sign_out.key_concerns_for_recovery_and_management,disabled:!r,onChange:P=>E("sign_out","key_concerns_for_recovery_and_management",P)})]})}),r&&n.jsx("div",{className:"flex justify-end pt-1",children:n.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-4 py-1.5 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[u&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save safety checklist"]})})]})]})}function ik({title:t,subtitle:s,done:r,time:a,onDoneChange:i,onTimeChange:l,disabled:o}){return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50/80 px-3 py-2.5 text-xs",children:[n.jsxs("div",{className:"mb-1 text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:[t," ",n.jsxs("span",{className:"font-normal normal-case text-slate-500",children:["(",s,")"]})]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!r,disabled:o,onChange:c=>i(c.target.checked)}),n.jsx("span",{className:"text-[11px] text-slate-800",children:"Checklist completed"})]}),n.jsxs("div",{className:"mt-2 space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Time"}),n.jsx("input",{type:"time",className:"w-full rounded-xl border border-slate-500 bg-white px-2.5 py-1.5 text-[11px] text-slate-800 focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",value:a||"",disabled:o,onChange:c=>l(c.target.value)})]})]})}function lk({title:t,children:s}){return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white/90 p-3 md:p-4",children:[n.jsx("div",{className:"mb-2 text-[11px] font-semibold uppercase tracking-wide text-slate-600",children:t}),s]})}function Vo({label:t,checked:s,onChange:r,disabled:a}){return n.jsxs("label",{className:"flex cursor-pointer items-center justify-between gap-3 rounded-xl border border-slate-500 bg-slate-50 px-3 py-2 text-[11px] text-slate-800",children:[n.jsx("span",{className:"font-medium",children:t}),n.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!s,disabled:a,onChange:i=>r(i.target.checked)})]})}function Ox({label:t,value:s,options:r,onChange:a,disabled:i}){return n.jsxs("div",{className:"rounded-xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"mb-1 text-[11px] font-semibold text-slate-700",children:t}),n.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(l=>{const o=(s||"")===l.value;return n.jsx("button",{type:"button",disabled:i,onClick:()=>a(l.value),className:"rounded-full px-3 py-1 text-[11px] font-semibold transition "+(o?"bg-slate-900 text-white shadow-sm":"bg-white text-slate-700 hover:bg-slate-100")+" disabled:cursor-not-allowed disabled:opacity-60",children:l.label},l.value||"empty")})})]})}function Rx({label:t,value:s,onChange:r,disabled:a,rows:i=2}){return n.jsxs("label",{className:"flex flex-col gap-1 rounded-xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("textarea",{rows:i,className:"w-full resize-none rounded-md border border-slate-500 bg-white px-3 py-2 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",disabled:a,onChange:l=>r(l.target.value),placeholder:""})]})}const G8={anaesthesia_type:"",asa_grade:"",airway_assessment:"",comorbidities:"",allergies:"",preop_pulse:"",preop_bp:"",preop_rr:"",preop_temp_c:"",preop_cvs:"",preop_rs:"",preop_cns:"",preop_pa:"",preop_veins:"",preop_spine:"",airway_teeth_status:"",airway_denture:"",airway_neck_movements:"",airway_mallampati_class:"",difficult_airway_anticipated:!1,risk_factors:"",anaesthetic_plan_detail:"",preop_instructions:"",preoxygenation:!1,cricoid_pressure:!1,induction_route:"",intubation_done:!1,intubation_route:"",intubation_state:"",intubation_technique:"",tube_type:"",tube_size:"",tube_fixed_at:"",cuff_used:!1,cuff_medium:"",bilateral_breath_sounds:"",added_sounds:"",laryngoscopy_grade:"",airway_devices:[],ventilation_mode_baseline:"",ventilator_vt:"",ventilator_rate:"",ventilator_peep:"",breathing_system:"",monitors:{},lines:{},tourniquet_used:!1,patient_position:"",eyes_taped:!1,eyes_covered_with_foil:!1,pressure_points_padded:!1,iv_fluids_plan:"",blood_components_plan:"",regional_block_type:"",regional_position:"",regional_approach:"",regional_space_depth:"",regional_needle_type:"",regional_drug_dose:"",regional_level:"",regional_complications:"",block_adequacy:"",sedation_needed:!1,conversion_to_ga:!1,notes:""},K8={time:"",hr:"",bp:"",spo2:"",rr:"",temp_c:"",etco2:"",ventilation_mode:"",peak_airway_pressure:"",cvp_pcwp:"",st_segment:"",urine_output_ml:"",blood_loss_ml:"",comments:""},Y8={time:"",drug_name:"",dose:"",route:"",remarks:""};function ok(t){if(t==null)return null;const s=String(t).trim();if(!s)return null;const r=parseInt(s,10);return Number.isNaN(r)?null:r}function q5e({caseId:t}){const s=ct("ot.anaesthesia.view")||ct("ot.cases.view")||ct("ipd.view"),r=ct("ot.anaesthesia.update")||ct("ot.anaesthesia.create")||ct("ot.cases.update")||ct("ipd.doctor"),[a,i]=p.useState("preop"),[l,o]=p.useState(G8),[c,d]=p.useState({id:null,created_at:null}),[u,m]=p.useState(!0),[x,g]=p.useState(!1),[y,v]=p.useState(null),[j,w]=p.useState(null),[S,E]=p.useState([]),[k,A]=p.useState(K8),[I,P]=p.useState(!1),[O,D]=p.useState([]),[T,B]=p.useState(Y8),[U,W]=p.useState(!1);if(p.useEffect(()=>{let X=!0;return(async()=>{var Y;if(!s){m(!1);return}m(!0),v(null);try{const oe=(await oSe(t)).data;if(!X)return;if(o(_e=>({..._e,...oe,monitors:oe.monitors||{},lines:oe.lines||{},airway_devices:oe.airway_devices||[]})),d({id:oe.id,created_at:oe.created_at}),oe.id){const[_e,xe]=await Promise.all([uSe(oe.id),xSe(oe.id)]);if(!X)return;E(_e.data||[]),D(xe.data||[])}}catch(Q){((Y=Q==null?void 0:Q.response)==null?void 0:Y.status)===404?(o(G8),d({id:null,created_at:null}),E([]),D([])):(console.error("Anaesthesia load error",Q),v("Unable to load anaesthesia record. Please try again."))}finally{X&&m(!1)}})(),()=>{X=!1}},[t,s]),!s)return n.jsx("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-700",children:"You do not have permission to view Anaesthesia records."});const V=p.useMemo(()=>y?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-[13px] text-red-700",children:[n.jsx(Vs,{className:"h-4 w-4"}),n.jsx("span",{children:y})]}):j?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[13px] text-emerald-700",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{children:j})]}):null,[y,j]),R=(X,Z)=>{o(Y=>({...Y,[X]:Z}))},F=X=>{o(Z=>({...Z,[X]:!Z[X]}))},G=X=>{o(Z=>{var Y;return{...Z,monitors:{...Z.monitors||{},[X]:!((Y=Z.monitors)!=null&&Y[X])}}})},H=X=>{o(Z=>{var Y;return{...Z,lines:{...Z.lines||{},[X]:!((Y=Z.lines)!=null&&Y[X])}}})},$=X=>{o(Z=>{const Y=Z.airway_devices||[];return Y.includes(X)?{...Z,airway_devices:Y.filter(Q=>Q!==X)}:{...Z,airway_devices:[...Y,X]}})},K=async()=>{if(!r){v("You do not have permission to edit anaesthesia records.");return}g(!0),v(null),w(null);try{const X={...l,ventilator_vt:ok(l.ventilator_vt),ventilator_rate:ok(l.ventilator_rate),ventilator_peep:ok(l.ventilator_peep)};if(c.id)await dSe(t,X);else{const Z=await cSe(t,X);d({id:Z.data.id,created_at:Z.data.created_at})}w("Anaesthesia record saved.")}catch(X){console.error("Save anaesthesia record error",X),v("Unable to save anaesthesia record.")}finally{g(!1)}},le=async()=>{if(!r){v("You do not have permission to add vitals.");return}if(!c.id){v("Save the anaesthesia record before adding vitals.");return}if(!k.time){v("Time is required for vitals (HH:MM).");return}P(!0),v(null),w(null);try{const X={...k,hr:k.hr?Number(k.hr):null,spo2:k.spo2?Number(k.spo2):null,rr:k.rr?Number(k.rr):null,temp_c:k.temp_c?Number(k.temp_c):null,etco2:k.etco2?Number(k.etco2):null,peak_airway_pressure:k.peak_airway_pressure?Number(k.peak_airway_pressure):null,cvp_pcwp:k.cvp_pcwp?Number(k.cvp_pcwp):null,urine_output_ml:k.urine_output_ml?Number(k.urine_output_ml):null,blood_loss_ml:k.blood_loss_ml?Number(k.blood_loss_ml):null},Z=await mSe(c.id,X);E(Y=>[...Y,Z.data]),A(K8),w("Vitals entry added.")}catch(X){console.error("Add vital error",X),v("Unable to add vitals entry.")}finally{P(!1)}},se=async X=>{if(!r){v("You do not have permission to delete vitals.");return}if(window.confirm("Delete this vitals entry?")){P(!0),v(null),w(null);try{await hSe(X),E(Z=>Z.filter(Y=>Y.id!==X)),w("Vitals entry deleted.")}catch(Z){console.error("Delete vital error",Z),v("Unable to delete vitals entry.")}finally{P(!1)}}},J=async()=>{if(!r){v("You do not have permission to add drug log entries.");return}if(!c.id){v("Save the anaesthesia record before adding drug log.");return}if(!T.time||!T.drug_name){v("Drug time and name are required.");return}W(!0),v(null),w(null);try{const X=await pSe(c.id,T);D(Z=>[...Z,X.data]),B(Y8),w("Drug log entry added.")}catch(X){console.error("Add drug error",X),v("Unable to add drug log entry.")}finally{W(!1)}},ie=async X=>{if(!r){v("You do not have permission to delete drug log entries.");return}if(window.confirm("Delete this drug entry?")){W(!0),v(null),w(null);try{await fSe(X),D(Z=>Z.filter(Y=>Y.id!==X)),w("Drug log entry deleted.")}catch(Z){console.error("Delete drug error",Z),v("Unable to delete drug entry.")}finally{W(!1)}}},te=()=>n.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 shadow-sm",children:[n.jsxs("h3",{className:"mb-1 flex items-center gap-2 text-sm font-semibold text-slate-900",children:[n.jsx(Pr,{className:"h-4 w-4"}),"Pre-anaesthetic assessment"]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 text-[12px] sm:grid-cols-2",children:[n.jsx(rs,{label:"ASA Grade",value:l.asa_grade,onChange:X=>R("asa_grade",X),disabled:!r}),n.jsx(rs,{label:"Anaesthesia type",value:l.anaesthesia_type,onChange:X=>R("anaesthesia_type",X),disabled:!r}),n.jsx(rs,{label:"Co-morbidities",value:l.comorbidities,onChange:X=>R("comorbidities",X),disabled:!r}),n.jsx(rs,{label:"Allergies",value:l.allergies,onChange:X=>R("allergies",X),disabled:!r})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 text-[12px] md:grid-cols-4",children:[n.jsx(rs,{label:"Pulse",value:l.preop_pulse,onChange:X=>R("preop_pulse",X),disabled:!r}),n.jsx(rs,{label:"BP",value:l.preop_bp,onChange:X=>R("preop_bp",X),disabled:!r}),n.jsx(rs,{label:"RR",value:l.preop_rr,onChange:X=>R("preop_rr",X),disabled:!r}),n.jsx(rs,{label:"Temp (C)",value:l.preop_temp_c,onChange:X=>R("preop_temp_c",X),disabled:!r})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 text-[12px] sm:grid-cols-2",children:[n.jsx(rs,{label:"CVS",value:l.preop_cvs,onChange:X=>R("preop_cvs",X),disabled:!r}),n.jsx(rs,{label:"RS",value:l.preop_rs,onChange:X=>R("preop_rs",X),disabled:!r}),n.jsx(rs,{label:"CNS",value:l.preop_cns,onChange:X=>R("preop_cns",X),disabled:!r}),n.jsx(rs,{label:"PA",value:l.preop_pa,onChange:X=>R("preop_pa",X),disabled:!r}),n.jsx(rs,{label:"Veins",value:l.preop_veins,onChange:X=>R("preop_veins",X),disabled:!r}),n.jsx(rs,{label:"Spine",value:l.preop_spine,onChange:X=>R("preop_spine",X),disabled:!r})]})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 shadow-sm",children:[n.jsxs("h3",{className:"mb-1 flex items-center gap-2 text-sm font-semibold text-slate-900",children:[n.jsx(Qs,{className:"h-4 w-4"}),"Airway & risk"]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 text-[12px] sm:grid-cols-2",children:[n.jsx(rs,{label:"Teeth",placeholder:"Intact / Loose",value:l.airway_teeth_status,onChange:X=>R("airway_teeth_status",X),disabled:!r}),n.jsx(rs,{label:"Denture",placeholder:"Present / Absent",value:l.airway_denture,onChange:X=>R("airway_denture",X),disabled:!r}),n.jsx(rs,{label:"Neck movements",value:l.airway_neck_movements,onChange:X=>R("airway_neck_movements",X),disabled:!r}),n.jsx(rs,{label:"Mallampati class",placeholder:"Class 1 / 2 / 3 / 4",value:l.airway_mallampati_class,onChange:X=>R("airway_mallampati_class",X),disabled:!r})]}),n.jsx("div",{className:"flex items-center gap-2 text-[12px]",children:n.jsx(Hi,{label:"Difficult airway anticipated",checked:l.difficult_airway_anticipated||!1,onChange:()=>F("difficult_airway_anticipated"),disabled:!r})}),n.jsx(R1,{label:"Risk factors",value:l.risk_factors,onChange:X=>R("risk_factors",X),disabled:!r}),n.jsx(R1,{label:"Anaesthetic plan",value:l.anaesthetic_plan_detail,onChange:X=>R("anaesthetic_plan_detail",X),disabled:!r}),n.jsx(R1,{label:"Pre-op instructions",value:l.preop_instructions,onChange:X=>R("preop_instructions",X),disabled:!r})]})]}),ne=()=>n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-[12px] shadow-sm",children:[n.jsx("h3",{className:"mb-1 text-sm font-semibold text-slate-900",children:"Induction & intubation"}),n.jsxs("div",{className:"flex flex-wrap gap-3",children:[n.jsx(Hi,{label:"Preoxygenation",checked:l.preoxygenation,onChange:()=>F("preoxygenation"),disabled:!r}),n.jsx(Hi,{label:"Cricoid pressure",checked:l.cricoid_pressure,onChange:()=>F("cricoid_pressure"),disabled:!r})]}),n.jsx(Ic,{label:"Induction",value:l.induction_route,onChange:X=>R("induction_route",X),options:["","Intravenous","Inhalational","Rapid sequence"],disabled:!r}),n.jsx(Hi,{label:"Intubation done",checked:l.intubation_done,onChange:()=>F("intubation_done"),disabled:!r}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[n.jsx(Ic,{label:"Route",value:l.intubation_route,onChange:X=>R("intubation_route",X),options:["","Oral","Nasal"],disabled:!r}),n.jsx(Ic,{label:"State",value:l.intubation_state,onChange:X=>R("intubation_state",X),options:["","Awake","Anaesthetised"],disabled:!r}),n.jsx(Ic,{label:"Technique",value:l.intubation_technique,onChange:X=>R("intubation_technique",X),options:["","Visual","Blind","Fibreoptic","Retrograde"],disabled:!r}),n.jsx(rs,{label:"Laryngoscopy grade",placeholder:"I / II / III / IV",value:l.laryngoscopy_grade,onChange:X=>R("laryngoscopy_grade",X),disabled:!r})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[n.jsx(rs,{label:"Tube type",value:l.tube_type,onChange:X=>R("tube_type",X),disabled:!r}),n.jsx(rs,{label:"Size",value:l.tube_size,onChange:X=>R("tube_size",X),disabled:!r}),n.jsx(rs,{label:"Fixed at",value:l.tube_fixed_at,onChange:X=>R("tube_fixed_at",X),disabled:!r}),n.jsx(Ic,{label:"Cuff medium",value:l.cuff_medium,onChange:X=>R("cuff_medium",X),options:["","Air","Saline","Not inflated"],disabled:!r})]}),n.jsx(Hi,{label:"Cuff used",checked:l.cuff_used,onChange:()=>F("cuff_used"),disabled:!r}),n.jsx(rs,{label:"Bilateral breath sounds",value:l.bilateral_breath_sounds,onChange:X=>R("bilateral_breath_sounds",X),disabled:!r}),n.jsx(rs,{label:"Added sounds",value:l.added_sounds,onChange:X=>R("added_sounds",X),disabled:!r})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-[12px] shadow-sm",children:[n.jsx("h3",{className:"mb-1 text-sm font-semibold text-slate-900",children:"Airway devices & monitors"}),n.jsx("div",{className:"mb-2 text-[11px] font-semibold text-slate-600",children:"Airway devices"}),n.jsx("div",{className:"grid grid-cols-2 gap-1",children:["Face mask","LMA/ILMA","Oral airway","Throat pack","NG tube","Other"].map(X=>n.jsx(Hi,{label:X,checked:(l.airway_devices||[]).includes(X),onChange:()=>$(X),disabled:!r},X))}),n.jsx("div",{className:"mt-3 text-[11px] font-semibold text-slate-600",children:"Monitors"}),n.jsx("div",{className:"grid grid-cols-2 gap-1",children:[["ecg","ECG"],["nibp","NIBP"],["pulse_oximeter","Pulse oximeter"],["capnograph","Capnograph"],["agent_monitor","Agent monitor"],["pns","PNS"],["temperature","Temperature"],["urinary_catheter","Urinary catheter"],["ibp","IBP"],["cvp","CVP"],["precordial_steth","Precordial steth"],["oesophageal_steth","Oesophageal steth"]].map(([X,Z])=>{var Y;return n.jsx(Hi,{label:Z,checked:((Y=l.monitors)==null?void 0:Y[X])||!1,onChange:()=>G(X),disabled:!r},X)})})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-[12px] shadow-sm",children:[n.jsx("h3",{className:"mb-1 text-sm font-semibold text-slate-900",children:"Ventilation & block"}),n.jsx(Ic,{label:"Ventilation mode",value:l.ventilation_mode_baseline,onChange:X=>R("ventilation_mode_baseline",X),options:["","Spontaneous","Controlled","Manual","Ventilator"],disabled:!r}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-3",children:[n.jsx(rs,{label:"Vt (ml)",value:l.ventilator_vt,onChange:X=>R("ventilator_vt",X),disabled:!r}),n.jsx(rs,{label:"Rate (f)",value:l.ventilator_rate,onChange:X=>R("ventilator_rate",X),disabled:!r}),n.jsx(rs,{label:"PEEP (cmHO)",value:l.ventilator_peep,onChange:X=>R("ventilator_peep",X),disabled:!r})]}),n.jsx(Ic,{label:"Breathing system",value:l.breathing_system,onChange:X=>R("breathing_system",X),options:["","Mapleson A","Mapleson D","Mapleson F","Circle system","Other"],disabled:!r}),n.jsx("div",{className:"mt-2 text-[11px] font-semibold text-slate-600",children:"Position & protection"}),n.jsx(Ic,{label:"Patient position",value:l.patient_position,onChange:X=>R("patient_position",X),options:["","Supine","Lateral","Prone","Lithotomy","Other"],disabled:!r}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(Hi,{label:"Eyes taped",checked:l.eyes_taped,onChange:()=>F("eyes_taped"),disabled:!r}),n.jsx(Hi,{label:"Eyes covered with foil",checked:l.eyes_covered_with_foil,onChange:()=>F("eyes_covered_with_foil"),disabled:!r}),n.jsx(Hi,{label:"Pressure points padded",checked:l.pressure_points_padded,onChange:()=>F("pressure_points_padded"),disabled:!r})]}),n.jsx("div",{className:"mt-2 text-[11px] font-semibold text-slate-600",children:"Lines & tourniquet"}),n.jsx("div",{className:"grid grid-cols-2 gap-1",children:[["peripheral_iv","Peripheral IV"],["central_line","Central line"],["arterial_line","Arterial line"]].map(([X,Z])=>{var Y;return n.jsx(Hi,{label:Z,checked:((Y=l.lines)==null?void 0:Y[X])||!1,onChange:()=>H(X),disabled:!r},X)})}),n.jsx(Hi,{label:"Tourniquet used",checked:l.tourniquet_used,onChange:()=>F("tourniquet_used"),disabled:!r}),n.jsx(rs,{label:"IV fluids plan",value:l.iv_fluids_plan,onChange:X=>R("iv_fluids_plan",X),disabled:!r}),n.jsx(rs,{label:"Blood & components plan",value:l.blood_components_plan,onChange:X=>R("blood_components_plan",X),disabled:!r}),n.jsx("div",{className:"mt-2 text-[11px] font-semibold text-slate-600",children:"Regional block"}),n.jsx(Ic,{label:"Type",value:l.regional_block_type,onChange:X=>R("regional_block_type",X),options:["","Spinal","Epidural","Nerve block","Combined","None"],disabled:!r}),n.jsx(rs,{label:"Position",value:l.regional_position,onChange:X=>R("regional_position",X),disabled:!r}),n.jsx(rs,{label:"Approach",value:l.regional_approach,onChange:X=>R("regional_approach",X),disabled:!r}),n.jsx(rs,{label:"Space & depth",value:l.regional_space_depth,onChange:X=>R("regional_space_depth",X),disabled:!r}),n.jsx(rs,{label:"Needle type",value:l.regional_needle_type,onChange:X=>R("regional_needle_type",X),disabled:!r}),n.jsx(rs,{label:"Drug injected / dose",value:l.regional_drug_dose,onChange:X=>R("regional_drug_dose",X),disabled:!r}),n.jsx(rs,{label:"Level of anaesthesia",value:l.regional_level,onChange:X=>R("regional_level",X),disabled:!r}),n.jsx(rs,{label:"Complications",value:l.regional_complications,onChange:X=>R("regional_complications",X),disabled:!r}),n.jsx(Ic,{label:"Adequacy of block",value:l.block_adequacy,onChange:X=>R("block_adequacy",X),options:["","Excellent","Adequate","Poor"],disabled:!r}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(Hi,{label:"Sedation needed",checked:l.sedation_needed,onChange:()=>F("sedation_needed"),disabled:!r}),n.jsx(Hi,{label:"Conversion to GA",checked:l.conversion_to_ga,onChange:()=>F("conversion_to_ga"),disabled:!r})]})]})]}),n.jsx(R1,{label:"Intra-op summary / notes",value:l.notes||"",onChange:X=>R("notes",X),disabled:!r})]}),q=()=>n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-[12px] shadow-sm",children:[n.jsxs("h3",{className:"mb-2 flex items-center gap-2 text-sm font-semibold text-slate-900",children:[n.jsx(Qs,{className:"h-4 w-4"}),"Intra-op vitals log"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-6",children:[n.jsx(rs,{label:"Time (HH:MM)",value:k.time,onChange:X=>A(Z=>({...Z,time:X})),disabled:!r}),n.jsx(rs,{label:"HR",value:k.hr,onChange:X=>A(Z=>({...Z,hr:X})),disabled:!r}),n.jsx(rs,{label:"BP",value:k.bp,onChange:X=>A(Z=>({...Z,bp:X})),disabled:!r}),n.jsx(rs,{label:"SpO",value:k.spo2,onChange:X=>A(Z=>({...Z,spo2:X})),disabled:!r}),n.jsx(rs,{label:"RR",value:k.rr,onChange:X=>A(Z=>({...Z,rr:X})),disabled:!r}),n.jsx(rs,{label:"Temp C",value:k.temp_c,onChange:X=>A(Z=>({...Z,temp_c:X})),disabled:!r})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-6",children:[n.jsx(rs,{label:"ETCO",value:k.etco2,onChange:X=>A(Z=>({...Z,etco2:X})),disabled:!r}),n.jsx(rs,{label:"Vent mode",value:k.ventilation_mode,onChange:X=>A(Z=>({...Z,ventilation_mode:X})),disabled:!r}),n.jsx(rs,{label:"Peak P (cmHO)",value:k.peak_airway_pressure,onChange:X=>A(Z=>({...Z,peak_airway_pressure:X})),disabled:!r}),n.jsx(rs,{label:"CVP / PCWP",value:k.cvp_pcwp,onChange:X=>A(Z=>({...Z,cvp_pcwp:X})),disabled:!r}),n.jsx(rs,{label:"Urine (ml)",value:k.urine_output_ml,onChange:X=>A(Z=>({...Z,urine_output_ml:X})),disabled:!r}),n.jsx(rs,{label:"Blood loss (ml)",value:k.blood_loss_ml,onChange:X=>A(Z=>({...Z,blood_loss_ml:X})),disabled:!r})]}),n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-end",children:[n.jsx("div",{className:"flex-1",children:n.jsx(rs,{label:"ST segment / comments",value:k.st_segment||k.comments,onChange:X=>A(Z=>({...Z,st_segment:X,comments:X})),disabled:!r})}),r&&n.jsx("button",{type:"button",onClick:le,disabled:I,className:"inline-flex items-center justify-center rounded-full bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white shadow hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-60",children:I?"Adding":"Add vitals"})]}),n.jsx("div",{className:"mt-3 overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-600",children:n.jsxs("tr",{children:[n.jsx(Fr,{children:"Time"}),n.jsx(Fr,{children:"HR"}),n.jsx(Fr,{children:"BP"}),n.jsx(Fr,{children:"SpO"}),n.jsx(Fr,{children:"RR"}),n.jsx(Fr,{children:"Temp"}),n.jsx(Fr,{children:"ETCO"}),n.jsx(Fr,{children:"Vent"}),n.jsx(Fr,{children:"Peak P"}),n.jsx(Fr,{children:"CVP/PCWP"}),n.jsx(Fr,{children:"Urine"}),n.jsx(Fr,{children:"Blood loss"}),n.jsx(Fr,{children:"Comments"}),n.jsx(Fr,{})]})}),n.jsx("tbody",{children:S.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:14,className:"py-3 text-center text-slate-500",children:"No vitals logged yet."})}):S.map(X=>n.jsxs("tr",{className:"border-t",children:[n.jsx(Br,{children:X.time}),n.jsx(Br,{children:X.hr}),n.jsx(Br,{children:X.bp}),n.jsx(Br,{children:X.spo2}),n.jsx(Br,{children:X.rr}),n.jsx(Br,{children:X.temp_c}),n.jsx(Br,{children:X.etco2}),n.jsx(Br,{children:X.ventilation_mode}),n.jsx(Br,{children:X.peak_airway_pressure}),n.jsx(Br,{children:X.cvp_pcwp}),n.jsx(Br,{children:X.urine_output_ml}),n.jsx(Br,{children:X.blood_loss_ml}),n.jsx(Br,{children:X.comments}),n.jsx(Br,{children:r&&n.jsx("button",{onClick:()=>se(X.id),className:"text-xs font-semibold text-red-500 hover:underline",children:"Delete"})})]},X.id))})]})})]}),ee=()=>n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-[12px] shadow-sm",children:[n.jsxs("h3",{className:"mb-2 flex items-center gap-2 text-sm font-semibold text-slate-900",children:[n.jsx(oR,{className:"h-4 w-4"}),"Anaesthesia drug log"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-5",children:[n.jsx(rs,{label:"Time (HH:MM)",value:T.time,onChange:X=>B(Z=>({...Z,time:X})),disabled:!r}),n.jsx(rs,{label:"Drug name",value:T.drug_name,onChange:X=>B(Z=>({...Z,drug_name:X})),disabled:!r}),n.jsx(rs,{label:"Dose",value:T.dose,onChange:X=>B(Z=>({...Z,dose:X})),disabled:!r}),n.jsx(rs,{label:"Route",value:T.route,onChange:X=>B(Z=>({...Z,route:X})),disabled:!r}),n.jsx(rs,{label:"Remarks",value:T.remarks,onChange:X=>B(Z=>({...Z,remarks:X})),disabled:!r})]}),r&&n.jsx("button",{type:"button",onClick:J,disabled:U,className:"inline-flex items-center justify-center rounded-full bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white shadow hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-60",children:U?"Adding":"Add drug"}),n.jsx("div",{className:"mt-3 overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-600",children:n.jsxs("tr",{children:[n.jsx(Fr,{children:"Time"}),n.jsx(Fr,{children:"Drug"}),n.jsx(Fr,{children:"Dose"}),n.jsx(Fr,{children:"Route"}),n.jsx(Fr,{children:"Remarks"}),n.jsx(Fr,{})]})}),n.jsx("tbody",{children:O.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"py-3 text-center text-slate-500",children:"No drugs logged yet."})}):O.map(X=>n.jsxs("tr",{className:"border-t",children:[n.jsx(Br,{children:X.time}),n.jsx(Br,{children:X.drug_name}),n.jsx(Br,{children:X.dose}),n.jsx(Br,{children:X.route}),n.jsx(Br,{children:X.remarks}),n.jsx(Br,{children:r&&n.jsx("button",{onClick:()=>ie(X.id),className:"text-xs font-semibold text-red-500 hover:underline",children:"Delete"})})]},X.id))})]})})]});return u?n.jsx("div",{className:"rounded-2xl border bg-white p-6 text-sm text-slate-600",children:"Loading anaesthesia record"}):n.jsxs("div",{className:"space-y-4 text-[13px]",children:[V,n.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-full bg-slate-100 p-1 text-[12px]",children:[n.jsxs("div",{className:"flex flex-1 flex-wrap gap-1 overflow-x-auto",children:[n.jsx(O1,{active:a==="preop",onClick:()=>i("preop"),icon:Pr,children:"Pre-op record"}),n.jsx(O1,{active:a==="intra",onClick:()=>i("intra"),icon:vue,children:"Intra-op setup"}),n.jsx(O1,{active:a==="vitals",onClick:()=>i("vitals"),icon:Qs,children:"Vitals log"}),n.jsx(O1,{active:a==="drugs",onClick:()=>i("drugs"),icon:oR,children:"Drug log"})]}),n.jsx("div",{className:"ml-auto flex items-center text-[11px] font-medium text-slate-500",children:c.id?"Record created":"No record yet"})]}),a==="preop"&&te(),a==="intra"&&ne(),a==="vitals"&&q(),a==="drugs"&&ee(),r&&n.jsx("div",{className:"sticky bottom-0 mt-4 flex justify-end border-t bg-slate-50/90 px-2 py-3 backdrop-blur",children:n.jsx("button",{type:"button",onClick:K,disabled:x,className:"inline-flex items-center rounded-full bg-slate-900 px-5 py-2 text-[13px] font-semibold text-white shadow-md hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-60",children:x?"Saving":"Save anaesthesia record"})})]})}function O1({active:t,onClick:s,children:r,icon:a}){return n.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 text-[12px] font-medium transition "+(t?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:bg-white/70"),children:[a&&n.jsx(a,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:r})]})}function rs({label:t,value:s,onChange:r,placeholder:a,disabled:i=!1}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-600",children:t}),n.jsx("input",{className:"h-9 rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none ring-0 transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",placeholder:a,onChange:l=>r(l.target.value),disabled:i})]})}function R1({label:t,value:s,onChange:r,placeholder:a,disabled:i=!1}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-600",children:t}),n.jsx("textarea",{className:"min-h-[70px] rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none ring-0 transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",placeholder:a,onChange:l=>r(l.target.value),disabled:i})]})}function Hi({label:t,checked:s,onChange:r,disabled:a=!1}){return n.jsxs("label",{className:"inline-flex items-center gap-1.5 text-[11px] text-slate-700",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-slate-900 focus:ring-0 disabled:cursor-not-allowed disabled:opacity-60",checked:!!s,onChange:r,disabled:a}),n.jsx("span",{children:t})]})}function Ic({label:t,value:s,onChange:r,options:a,disabled:i=!1}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-600",children:t}),n.jsx("select",{className:"h-9 rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none ring-0 transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",onChange:l=>r(l.target.value),disabled:i,children:a.map(l=>n.jsx("option",{value:l,children:l||""},l||"empty"))})]})}function Fr({children:t}){return n.jsx("th",{className:"px-2 py-1 text-left text-[11px] font-semibold uppercase tracking-wide",children:t})}function Br({children:t}){return n.jsx("td",{className:"px-2 py-1 align-top text-[11px] text-slate-700",children:t})}function G5e(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function K5e(t){const s=G5e(t);return s?s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Y5e({caseId:t}){const s=ct("ot.cases.view")||ct("ot.operation_notes.view")||ct("ipd.view"),r=ct("ot.operation_notes.create")||ct("ipd.doctor")||ct("ipd.nursing"),a=ct("ot.operation_notes.update")||ct("ipd.doctor")||ct("ipd.nursing"),i=r||a,[l,o]=p.useState(null),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(null),[j,w]=p.useState({diagnosis_pre:"",diagnosis_post:"",procedure_performed:"",findings:"",steps:"",complications:"",drains:"",blood_loss_ml:"",post_op_orders:""}),S=(l==null?void 0:l.updated_at)||(l==null?void 0:l.created_at),E=p.useMemo(()=>x?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:[n.jsx(Vs,{className:"h-4 w-4"}),n.jsx("span",{children:x})]}):y?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-700",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{children:y})]}):null,[x,y]),k=async()=>{var P,O,D;if(s)try{d(!0),g(null),v(null);const T=await jSe(t),B=T==null?void 0:T.data;B?(o(B),w({diagnosis_pre:B.preop_diagnosis||"",diagnosis_post:B.postop_diagnosis||"",procedure_performed:B.indication||"",findings:B.findings||"",steps:B.procedure_steps||"",complications:B.complications||"",drains:B.drains_details||"",blood_loss_ml:B.blood_loss_ml??"",post_op_orders:B.postop_instructions||""})):o(null)}catch(T){((P=T==null?void 0:T.response)==null?void 0:P.status)===404?o(null):(console.error("Failed to load Operation note",T),g(((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||"Failed to load Operation note."))}finally{d(!1)}};if(p.useEffect(()=>{k()},[t,s]),!s)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view Operation notes."});const A=(P,O)=>{w(D=>({...D,[P]:O}))},I=async P=>{var O,D;if(P.preventDefault(),l&&!a){g("You do not have permission to update Operation notes.");return}if(!l&&!r){g("You do not have permission to create Operation notes.");return}m(!0),g(null),v(null);try{const T={surgeon_user_id:null,preop_diagnosis:j.diagnosis_pre||null,postop_diagnosis:j.diagnosis_post||null,indication:j.procedure_performed||null,findings:j.findings||null,procedure_steps:j.steps||null,blood_loss_ml:j.blood_loss_ml===""?null:Number(j.blood_loss_ml),complications:j.complications||null,drains_details:j.drains||null,postop_instructions:j.post_op_orders||null};l?(await wSe(t,T),v("Operation note updated.")):(await NSe(t,T),v("Operation note created.")),await k()}catch(T){console.error("Failed to save Operation note",T),g(((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||(T==null?void 0:T.message)||"Failed to save Operation note.")}finally{m(!1)}};return n.jsxs("form",{onSubmit:I,className:"space-y-3 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sky-800",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-700",children:n.jsx(Xn,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"Operation Notes"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Diagnosis  Findings  Steps  Complications  Post-op orders"})]})]}),S&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-medium text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Updated: ",K5e(S)]})]}),E,c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-20 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-20 w-full animate-pulse rounded-xl bg-slate-100"})]}),!c&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsx(Cu,{label:"Pre-op diagnosis",rows:2,value:j.diagnosis_pre,disabled:!i,onChange:P=>A("diagnosis_pre",P)}),n.jsx(Cu,{label:"Post-op diagnosis",rows:2,value:j.diagnosis_post,disabled:!i,onChange:P=>A("diagnosis_post",P)})]}),n.jsx(Cu,{label:"Procedure performed / indication",rows:2,value:j.procedure_performed,disabled:!i,onChange:P=>A("procedure_performed",P)}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsx(Cu,{label:"Findings",rows:3,value:j.findings,disabled:!i,onChange:P=>A("findings",P)}),n.jsx(Cu,{label:"Steps / technique",rows:3,value:j.steps,disabled:!i,onChange:P=>A("steps",P)})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[n.jsx(Cu,{label:"Complications",rows:2,value:j.complications,disabled:!i,onChange:P=>A("complications",P)}),n.jsx(Cu,{label:"Drains / tubes",rows:2,value:j.drains,disabled:!i,onChange:P=>A("drains",P)}),n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Approx. blood loss (ml)"}),n.jsx("input",{type:"number",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:j.blood_loss_ml,disabled:!i,onChange:P=>A("blood_loss_ml",P.target.value)})]})]}),n.jsx(Cu,{label:"Immediate post-op orders",rows:2,value:j.post_op_orders,disabled:!i,onChange:P=>A("post_op_orders",P)}),i&&n.jsx("div",{className:"flex justify-end pt-1",children:n.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-4 py-1.5 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[u&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save Operation note"]})})]})]})}function Cu({label:t,value:s,onChange:r,rows:a=2,disabled:i}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("textarea",{rows:a,className:"w-full resize-none rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",disabled:i,onChange:l=>r(l.target.value)})]})}function X5e(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function Q5e(t){const s=X5e(t);return s?s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function X8(t){if(!t)return"";if(/^\d{2}:\d{2}$/.test(t))return t;const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toISOString().slice(11,16)}function Z5e({caseId:t}){const s=ct("ot.cases.view")||ct("ot.pacu.view")||ct("ipd.view"),r=ct("ot.pacu.create")||ct("ipd.doctor")||ct("ipd.nursing"),a=ct("ot.pacu.update")||ct("ipd.doctor")||ct("ipd.nursing"),i=r||a,[l,o]=p.useState(null),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(null),[j,w]=p.useState({arrival_time:"",departure_time:"",pain_score:"",nausea_vomiting:"",airway_status:"",vitals_summary:"",complications:"",discharge_criteria_met:!1,notes:""}),S=(l==null?void 0:l.updated_at)||(l==null?void 0:l.created_at),E=p.useMemo(()=>x?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:[n.jsx(Vs,{className:"h-4 w-4"}),n.jsx("span",{children:x})]}):y?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-700",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{children:y})]}):null,[x,y]),k=async()=>{var P,O,D;if(s)try{d(!0),g(null),v(null);const T=await kSe(t),B=T==null?void 0:T.data;B?(o(B),w({arrival_time:X8(B.arrival_time),departure_time:X8(B.departure_time),pain_score:B.pain_score??"",nausea_vomiting:B.nausea_vomiting??"",airway_status:B.airway_status??"",vitals_summary:B.vitals_summary??"",complications:B.complications??"",discharge_criteria_met:!!B.discharge_criteria_met,notes:B.notes??""})):o(null)}catch(T){((P=T==null?void 0:T.response)==null?void 0:P.status)===404?o(null):(console.error("Failed to load PACU record",T),g(((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||"Failed to load PACU record."))}finally{d(!1)}};if(p.useEffect(()=>{k()},[t,s]),!s)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view PACU records."});const A=(P,O)=>{w(D=>({...D,[P]:O}))},I=async P=>{var O,D;if(P.preventDefault(),l&&!a){g("You do not have permission to update PACU records.");return}if(!l&&!r){g("You do not have permission to create PACU records.");return}m(!0),g(null),v(null);try{const T={arrival_time:j.arrival_time||null,departure_time:j.departure_time||null,pain_score:j.pain_score||null,nausea_vomiting:j.nausea_vomiting||null,airway_status:j.airway_status||null,vitals_summary:j.vitals_summary||null,complications:j.complications||null,discharge_criteria_met:!!j.discharge_criteria_met,notes:j.notes||null};l?(await ESe(t,T),v("PACU record updated.")):(await ASe(t,T),v("PACU record created.")),await k()}catch(T){console.error("Failed to save PACU record",T);const B=(D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail;let U="Failed to save PACU record.";Array.isArray(B)?U=B.map(W=>W.msg).join(", "):typeof B=="string"?U=B:T!=null&&T.message&&(U=T.message),g(U)}finally{m(!1)}};return n.jsxs("form",{onSubmit:I,className:"space-y-3 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sky-800",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-700",children:n.jsx(cn,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"PACU / Post-anaesthesia recovery"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Arrival  Pain  Airway  Vitals  Discharge criteria"})]})]}),S&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-medium text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Updated: ",Q5e(S)]})]}),E,c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-20 w-full animate-pulse rounded-xl bg-slate-100"})]}),!c&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[n.jsx(Q8,{label:"Arrival time",value:j.arrival_time,disabled:!i,onChange:P=>A("arrival_time",P)}),n.jsx(Q8,{label:"Departure time",value:j.departure_time,disabled:!i,onChange:P=>A("departure_time",P)}),n.jsx(L1,{label:"Pain score",placeholder:"e.g., 3/10",value:j.pain_score,disabled:!i,onChange:P=>A("pain_score",P)})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[n.jsx(L1,{label:"Nausea / vomiting",value:j.nausea_vomiting,disabled:!i,onChange:P=>A("nausea_vomiting",P)}),n.jsx(L1,{label:"Airway status",value:j.airway_status,disabled:!i,onChange:P=>A("airway_status",P)}),n.jsx(L1,{label:"Vitals summary",value:j.vitals_summary,disabled:!i,onChange:P=>A("vitals_summary",P)})]}),n.jsx(Z8,{label:"PACU complications",rows:2,value:j.complications,disabled:!i,onChange:P=>A("complications",P)}),n.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-xl border border-slate-500 bg-slate-50 px-3 py-2 text-[11px] text-slate-800",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!j.discharge_criteria_met,disabled:!i,onChange:P=>A("discharge_criteria_met",P.target.checked)}),n.jsx("span",{children:"PACU discharge criteria met; patient shifted as per orders"})]}),n.jsx(Z8,{label:"Notes",rows:2,value:j.notes,disabled:!i,onChange:P=>A("notes",P)}),i&&n.jsx("div",{className:"flex justify-end pt-1",children:n.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-4 py-1.5 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[u&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save PACU record"]})})]})]})}function L1({label:t,value:s,onChange:r,placeholder:a,disabled:i}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"text",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",placeholder:a,disabled:i,onChange:l=>r(l.target.value)})]})}function Q8({label:t,value:s,onChange:r,disabled:a}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"time",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",disabled:a,onChange:i=>r(i.target.value)})]})}function Z8({label:t,value:s,onChange:r,rows:a=2,disabled:i}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("textarea",{rows:a,className:"w-full resize-none rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",disabled:i,onChange:l=>r(l.target.value)})]})}function J5e(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function e3e(t){const s=J5e(t);return s?s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function t3e(t){if(!t)return"";if(/^\d{2}:\d{2}$/.test(t))return t;const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toISOString().slice(11,16)}function s3e({caseId:t}){const{user:s,permissions:r}=dn();console.log("NURSING TAB DEBUG"),console.log("User:",s),console.log("Permissions:",r);const a=ct("ot.cases.view")||ct("ot.nursing_record.view")||ct("ipd.view"),i=ct("ot.nursing_record.update")||ct("ot.nursing_record.create")||ct("ot.cases.update")||ct("ipd.nursing"),[l,o]=p.useState(null),[c,d]=p.useState({scrub_nurse_name:"",circulating_nurse_name:"",positioning:"",skin_prep:"",catheterisation:"",diathermy_plate_site:"",counts_initial_done:!1,counts_closure_done:!1,antibiotics_time:"",warming_measures:"",notes:""}),[u,m]=p.useState(!1),[x,g]=p.useState(!1),[y,v]=p.useState(null),[j,w]=p.useState(null),S=(l==null?void 0:l.updated_at)||(l==null?void 0:l.created_at),E=p.useMemo(()=>y?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:[n.jsx(Vs,{className:"h-4 w-4"}),n.jsx("span",{children:y})]}):j?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-700",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{children:j})]}):null,[y,j]),k=async()=>{var P;if(a)try{m(!0),v(null),w(null);const O=await gSe(t);if(O!=null&&O.data){const D=O.data;o(D),d({scrub_nurse_name:D.scrub_nurse_name||"",circulating_nurse_name:D.circulating_nurse_name||"",positioning:D.positioning||"",skin_prep:D.skin_prep||"",catheterisation:D.catheterisation||"",diathermy_plate_site:D.diathermy_plate_site||"",counts_initial_done:!!D.counts_initial_done,counts_closure_done:!!D.counts_closure_done,antibiotics_time:t3e(D.antibiotics_time),warming_measures:D.warming_measures||"",notes:D.notes||""})}else o(null),d(D=>({...D,scrub_nurse_name:"",circulating_nurse_name:"",positioning:"",skin_prep:"",catheterisation:"",diathermy_plate_site:"",counts_initial_done:!1,counts_closure_done:!1,antibiotics_time:"",warming_measures:"",notes:""}))}catch(O){((P=O==null?void 0:O.response)==null?void 0:P.status)===404?o(null):(console.error("Failed to load intra-op nursing record",O),v("Failed to load intra-op nursing record."))}finally{m(!1)}};if(p.useEffect(()=>{k()},[t,a]),!a)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view intra-op nursing records."});const A=(P,O)=>{d(D=>({...D,[P]:O}))},I=async P=>{var D,T,B,U,W;if(P.preventDefault(),!i){v("You do not have permission to edit intra-op nursing records.");return}g(!0),v(null),w(null);const O={primary_nurse_id:null,scrub_nurse_name:c.scrub_nurse_name||null,circulating_nurse_name:c.circulating_nurse_name||null,positioning:c.positioning||null,skin_prep:c.skin_prep||null,catheterisation:c.catheterisation||null,diathermy_plate_site:c.diathermy_plate_site||null,counts_initial_done:!!c.counts_initial_done,counts_closure_done:!!c.counts_closure_done,antibiotics_time:c.antibiotics_time||null,warming_measures:c.warming_measures||null,notes:c.notes||null};try{if(l)await f8(t,O);else try{await bSe(t,O)}catch(V){const R=(D=V==null?void 0:V.response)==null?void 0:D.status,F=(B=(T=V==null?void 0:V.response)==null?void 0:T.data)==null?void 0:B.detail;if(R===400&&typeof F=="string"&&F.toLowerCase().includes("already exists"))await f8(t,O);else throw V}await k(),w("Intra-op nursing record saved.")}catch(V){console.error("Failed to save intra-op nursing record",V);const R=((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||(V==null?void 0:V.message)||"Failed to save intra-op nursing record.";v(R)}finally{g(!1)}};return n.jsxs("form",{onSubmit:I,className:"space-y-3 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sky-800",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-700",children:n.jsx(Pr,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"Intra-op Nursing Record"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Positioning  prep  counts  warming  mapped to OT nursing workflow."})]})]}),S&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-medium text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Updated: ",e3e(S)]})]}),E,u&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"})]}),!u&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsx(Um,{label:"Scrub nurse",value:c.scrub_nurse_name,onChange:P=>A("scrub_nurse_name",P),disabled:!i}),n.jsx(Um,{label:"Circulating nurse",value:c.circulating_nurse_name,onChange:P=>A("circulating_nurse_name",P),disabled:!i})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[n.jsx(Um,{label:"Patient positioning",value:c.positioning,onChange:P=>A("positioning",P),placeholder:"Supine / Lithotomy / Lateral",disabled:!i}),n.jsx(Um,{label:"Skin preparation",value:c.skin_prep,onChange:P=>A("skin_prep",P),placeholder:"Povidone iodine / Chlorhexidine",disabled:!i}),n.jsx(Um,{label:"Catheterisation",value:c.catheterisation,onChange:P=>A("catheterisation",P),placeholder:"Foley 16G / None",disabled:!i})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[n.jsx(Um,{label:"Diathermy plate site",value:c.diathermy_plate_site,onChange:P=>A("diathermy_plate_site",P),placeholder:"Thigh / Buttock",disabled:!i}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Prophylactic antibiotics time"}),n.jsx("input",{type:"time",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none ring-0 transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:c.antibiotics_time,disabled:!i,onChange:P=>A("antibiotics_time",P.target.value)})]}),n.jsx(Um,{label:"Warming measures",value:c.warming_measures,onChange:P=>A("warming_measures",P),placeholder:"Bair Hugger, warm fluids",disabled:!i})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-xl border border-slate-500 bg-slate-50 px-3 py-2 text-[11px] text-slate-800",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!c.counts_initial_done,disabled:!i,onChange:P=>A("counts_initial_done",P.target.checked)}),n.jsx("span",{children:"Initial sponge / instrument counts completed"})]}),n.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-xl border border-slate-500 bg-slate-50 px-3 py-2 text-[11px] text-slate-800",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!c.counts_closure_done,disabled:!i,onChange:P=>A("counts_closure_done",P.target.checked)}),n.jsx("span",{children:"Final counts completed at closure and recorded"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Intra-op nursing notes"}),n.jsx("textarea",{rows:3,className:"w-full resize-none rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none ring-0 transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:c.notes,disabled:!i,onChange:P=>A("notes",P.target.value),placeholder:"Pressure points padded, eye protection, special equipment, positioning changes, events etc."})]})]}),i&&n.jsx("div",{className:"flex justify-end pt-1",children:n.jsxs("button",{type:"submit",disabled:x,className:"inline-flex items-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-4 py-1.5 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[x&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save intra-op nursing record"]})})]})}function Um({label:t,value:s,onChange:r,placeholder:a,disabled:i}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"text",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none ring-0 transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:s??"",placeholder:a,disabled:i,onChange:l=>r(l.target.value)})]})}function n3e(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function r3e(t){const s=n3e(t);return s?s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Vm(t){if(t===""||t===null||t===void 0)return null;const s=Number(t);return Number.isFinite(s)?s:null}function a3e({caseId:t}){const s=ct("ot.cases.view")||ct("ot.counts.view")||ct("ipd.view"),r=ct("ot.counts.create")||ct("ot.counts.update")||ct("ipd.doctor")||ct("ipd.nursing"),[a,i]=p.useState(null),[l,o]=p.useState({sponges_initial:"",sponges_added:"",sponges_final:"",instruments_initial:"",instruments_final:"",needles_initial:"",needles_final:"",discrepancy_text:"",xray_done:!1,resolved_by:"",notes:""}),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(null),j=(a==null?void 0:a.updated_at)||(a==null?void 0:a.created_at),w=p.useMemo(()=>x?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:[n.jsx(Vs,{className:"h-4 w-4"}),n.jsx("span",{children:x})]}):y?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-700",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{children:y})]}):null,[x,y]),S=async()=>{var P;if(s)try{d(!0),g(null),v(null);const O=await ySe(t),D=O==null?void 0:O.data;D?(i(D),o({sponges_initial:D.sponges_initial??"",sponges_added:D.sponges_added??"",sponges_final:D.sponges_final??"",instruments_initial:D.instruments_initial??"",instruments_final:D.instruments_final??"",needles_initial:D.needles_initial??"",needles_final:D.needles_final??"",discrepancy_text:D.discrepancy_text||"",xray_done:!!D.xray_done,resolved_by:D.resolved_by||"",notes:D.notes||""})):i(null)}catch(O){((P=O==null?void 0:O.response)==null?void 0:P.status)===404?i(null):(console.error("Failed to load counts record",O),g("Failed to load counts record."))}finally{d(!1)}};if(p.useEffect(()=>{i(null),S()},[t,s]),!s)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view sponge/instrument counts."});const E=(P,O)=>{o(D=>({...D,[P]:O}))},k=()=>({sponges_initial:Vm(l.sponges_initial),sponges_added:Vm(l.sponges_added),sponges_final:Vm(l.sponges_final),instruments_initial:Vm(l.instruments_initial),instruments_final:Vm(l.instruments_final),needles_initial:Vm(l.needles_initial),needles_final:Vm(l.needles_final),discrepancy_text:l.discrepancy_text||null,xray_done:!!l.xray_done,resolved_by:l.resolved_by||null,notes:l.notes||null}),A=async P=>{var D,T,B,U,W;if(P.preventDefault(),!r){g("You do not have permission to edit counts.");return}m(!0),g(null),v(null);const O=k();try{if(a!=null&&a.id)await g8(t,O);else try{await vSe(t,O)}catch(V){const R=(D=V==null?void 0:V.response)==null?void 0:D.status,F=(B=(T=V==null?void 0:V.response)==null?void 0:T.data)==null?void 0:B.detail;if(R===400&&typeof F=="string"&&F.toLowerCase().includes("already exists"))await g8(t,O);else throw V}await S(),v("Counts record saved.")}catch(V){console.error("Failed to save counts record",V);const R=((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||(V==null?void 0:V.message)||"Failed to save counts record.";g(R)}finally{m(!1)}},I=({field:P,label:O,hint:D})=>n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsxs("span",{className:"text-[11px] font-semibold text-slate-700",children:[O,D?n.jsxs("span",{className:"ml-1 font-normal text-slate-500",children:["(",D,")"]}):null]}),n.jsx("input",{type:"number",inputMode:"numeric",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:l[P],disabled:!r,onChange:T=>E(P,T.target.value)})]});return n.jsxs("form",{onSubmit:A,className:"space-y-3 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sky-800",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-amber-50 text-amber-700",children:n.jsx(en,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"Sponge / Instrument / Needle Counts"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Initial  Added  Final  Discrepancy  X-ray"})]})]}),j&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-medium text-emerald-700",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Updated: ",r3e(j)]})]}),w,c?n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"}),n.jsx("div",{className:"h-9 w-full animate-pulse rounded-xl bg-slate-100"})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50/60 p-3",children:[n.jsx("div",{className:"mb-2 text-[11px] font-semibold text-slate-700",children:"Sponges"}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[n.jsx(I,{field:"sponges_initial",label:"Initial"}),n.jsx(I,{field:"sponges_added",label:"Added during case"}),n.jsx(I,{field:"sponges_final",label:"Final count"})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50/60 p-3",children:[n.jsx("div",{className:"mb-2 text-[11px] font-semibold text-slate-700",children:"Instruments & Needles"}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsx(I,{field:"instruments_initial",label:"Instruments - Initial"}),n.jsx(I,{field:"instruments_final",label:"Instruments - Final"})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsx(I,{field:"needles_initial",label:"Needles - Initial"}),n.jsx(I,{field:"needles_final",label:"Needles - Final"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Discrepancy (if any)"}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:l.discrepancy_text,disabled:!r,onChange:P=>E("discrepancy_text",P.target.value),placeholder:"Describe discrepancy / missing item / reconciliation steps"})]}),n.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-xl border border-slate-500 bg-slate-50 px-3 py-2 text-[11px] text-slate-800",children:[n.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60",checked:!!l.xray_done,disabled:!r,onChange:P=>E("xray_done",P.target.checked)}),n.jsx("span",{children:"X-ray done for suspected retained item (if indicated)"})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Resolved by"}),n.jsx("input",{type:"text",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:l.resolved_by,disabled:!r,onChange:P=>E("resolved_by",P.target.value),placeholder:"Surgeon / Scrub nurse / Circulating nurse"})]}),n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Notes / corrective action"}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:l.notes,disabled:!r,onChange:P=>E("notes",P.target.value),placeholder:"Actions taken, incident documentation, re-check method"})]})]})]}),r&&n.jsx("div",{className:"flex justify-end pt-1",children:n.jsxs("button",{type:"submit",disabled:u,className:"inline-flex items-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-4 py-1.5 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[u&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save counts record"]})})]})}function i3e(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function J8(t){const s=i3e(t);return s?s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function eL(t){if(!t||!/^\d{2}:\d{2}$/.test(t))return null;const[s,r]=t.split(":").map(l=>Number(l)),a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),s,r,0).toISOString()}function l3e({caseId:t}){const s=ct("ot.cases.view")||ct("ot.blood_transfusion.view")||ct("ipd.view"),r=ct("ot.blood_transfusion.create")||ct("ipd.doctor")||ct("ipd.nursing");ct("ot.blood_transfusion.update")||ct("ipd.doctor")||ct("ipd.nursing");const a=ct("ot.blood_transfusion.delete")||ct("ipd.doctor")||ct("ipd.nursing"),[i,l]=p.useState([]),[o,c]=p.useState(!1),[d,u]=p.useState(!1),[m,x]=p.useState(null),[g,y]=p.useState(null),[v,j]=p.useState({component:"",units:"1",blood_group:"",bag_no:"",start_time:"",end_time:"",reaction:"",reaction_action:"",notes:""}),w=p.useMemo(()=>m?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:[n.jsx(Vs,{className:"h-4 w-4"}),n.jsx("span",{children:m})]}):g?n.jsxs("div",{className:"mb-3 flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-700",children:[n.jsx(Xt,{className:"h-4 w-4"}),n.jsx("span",{children:g})]}):null,[m,g]),S=async()=>{var P,O;if(s)try{c(!0),x(null),y(null);const D=await _Se(t);l((D==null?void 0:D.data)||[])}catch(D){console.error("Failed to load blood transfusions",D),x(((O=(P=D==null?void 0:D.response)==null?void 0:P.data)==null?void 0:O.detail)||"Failed to load blood transfusion records.")}finally{c(!1)}};if(p.useEffect(()=>{S()},[t,s]),!s)return n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view OT blood transfusions."});const E=(P,O)=>{j(D=>({...D,[P]:O}))},k=()=>j({component:"",units:"1",blood_group:"",bag_no:"",start_time:"",end_time:"",reaction:"",reaction_action:"",notes:""}),A=async P=>{var O,D;if(P.preventDefault(),!r){x("You do not have permission to add transfusion entries.");return}u(!0),x(null),y(null);try{const T={component:v.component||null,units:v.units===""?null:Number(v.units||1),start_time:eL(v.start_time),end_time:eL(v.end_time),reaction:v.reaction||null,notes:v.notes||null};await SSe(t,T),k(),await S(),y("Transfusion entry added.")}catch(T){console.error("Failed to add transfusion",T),x(((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||"Failed to add transfusion entry.")}finally{u(!1)}},I=async P=>{var O,D;if(!a){x("You do not have permission to delete transfusion entries.");return}if(window.confirm("Delete this transfusion record?"))try{x(null),y(null),await CSe(P),await S(),y("Transfusion entry deleted.")}catch(T){console.error("Failed to delete transfusion",T),x(((D=(O=T==null?void 0:T.response)==null?void 0:O.data)==null?void 0:D.detail)||"Failed to delete transfusion entry.")}};return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"mb-2 flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sky-800",children:[n.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-sky-50 text-sky-700",children:n.jsx(O3,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold md:text-base",children:"Blood & Fluids (Transfusion)"}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Component  Units  Time  Reaction"})]})]}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:["Total: ",n.jsx("span",{className:"font-semibold text-slate-800",children:i.length})]})]}),w,o&&n.jsx("div",{className:"text-xs text-slate-500",children:"Loading transfusion records..."}),n.jsx("div",{className:"max-h-72 overflow-auto rounded-xl border border-slate-500 bg-slate-50",children:n.jsxs("table",{className:"min-w-full text-left text-[11px] text-slate-700",children:[n.jsx("thead",{className:"sticky top-0 bg-slate-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2",children:"Component"}),n.jsx("th",{className:"px-3 py-2",children:"Units"}),n.jsx("th",{className:"px-3 py-2",children:"Start"}),n.jsx("th",{className:"px-3 py-2",children:"End"}),n.jsx("th",{className:"px-3 py-2",children:"Reaction"}),n.jsx("th",{className:"px-3 py-2 text-right",children:"Actions"})]})}),n.jsxs("tbody",{children:[!o&&i.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"No transfusions recorded for this case."})}),!o&&i.map(P=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2",children:P.component||""}),n.jsx("td",{className:"px-3 py-2",children:P.units??""}),n.jsx("td",{className:"px-3 py-2",children:P.start_time?J8(P.start_time):""}),n.jsx("td",{className:"px-3 py-2",children:P.end_time?J8(P.end_time):""}),n.jsx("td",{className:"px-3 py-2",children:P.reaction||"None"}),n.jsx("td",{className:"px-3 py-2 text-right",children:a&&n.jsxs("button",{type:"button",onClick:()=>I(P.id),className:"inline-flex items-center gap-1 rounded-lg border border-rose-200 bg-white px-2 py-1 text-[10px] font-semibold text-rose-600 hover:bg-rose-50",children:[n.jsx(Ms,{className:"h-3.5 w-3.5"}),"Delete"]})})]},P.id))]})]})})]}),r&&n.jsxs("form",{onSubmit:A,className:"space-y-2 rounded-2xl border border-slate-500 bg-white/90 px-3 py-3 shadow-sm md:px-4 md:py-4",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Add transfusion entry"}),n.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-3",children:[n.jsx(w0,{label:"Component *",value:v.component,onChange:P=>E("component",P),placeholder:"PRBC / FFP / Platelets...",required:!0}),n.jsx(o3e,{label:"Units",value:v.units,onChange:P=>E("units",P),min:1}),n.jsx(w0,{label:"Blood group (optional)",value:v.blood_group,onChange:P=>E("blood_group",P),placeholder:"e.g., O+"})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-3",children:[n.jsx(w0,{label:"Bag number (optional)",value:v.bag_no,onChange:P=>E("bag_no",P),placeholder:"Bag/Unit ID"}),n.jsx(tL,{label:"Start time",value:v.start_time,onChange:P=>E("start_time",P)}),n.jsx(tL,{label:"End time",value:v.end_time,onChange:P=>E("end_time",P)})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[n.jsx(w0,{label:"Reaction (optional)",value:v.reaction,onChange:P=>E("reaction",P),placeholder:"None / chills / rash / etc."}),n.jsx(w0,{label:"Action taken (UI-only)",value:v.reaction_action,onChange:P=>E("reaction_action",P),placeholder:"Stopped / antihistamine / etc."})]}),n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:"Notes"}),n.jsx("textarea",{rows:2,className:"w-full resize-none rounded-md border border-slate-500 bg-slate-50 px-3 py-2 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white disabled:cursor-not-allowed disabled:opacity-60",value:v.notes,onChange:P=>E("notes",P.target.value),placeholder:"Any remarks..."})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"submit",disabled:d,className:"inline-flex items-center gap-1.5 rounded-full border border-sky-600 bg-sky-600 px-4 py-1.5 text-[12px] font-semibold text-white shadow-sm hover:bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60",children:[d&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Add transfusion"]})})]})]})}function w0({label:t,value:s,onChange:r,placeholder:a,required:i}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"text",required:i,className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white",value:s??"",placeholder:a,onChange:l=>r(l.target.value)})]})}function o3e({label:t,value:s,onChange:r,min:a}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"number",min:a,className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white",value:s??"",onChange:i=>r(i.target.value)})]})}function tL({label:t,value:s,onChange:r}){return n.jsxs("label",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:t}),n.jsx("input",{type:"time",className:"h-9 w-full rounded-md border border-slate-500 bg-slate-50 px-3 text-[12px] text-slate-900 outline-none transition focus:border-slate-400 focus:bg-white",value:s??"",onChange:a=>r(a.target.value)})]})}const Wa=xK,c3e=pK,SY=p.forwardRef(({className:t,...s},r)=>n.jsx(L2,{ref:r,className:Bt("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));SY.displayName=L2.displayName;const va=p.forwardRef(({className:t,children:s,...r},a)=>n.jsxs(c3e,{children:[n.jsx(SY,{}),n.jsxs(F2,{ref:a,className:Bt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,n.jsxs(fK,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[n.jsx(ts,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));va.displayName=F2.displayName;const ii=({className:t,...s})=>n.jsx("div",{className:Bt("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});ii.displayName="DialogHeader";const Kc=({className:t,...s})=>n.jsx("div",{className:Bt("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Kc.displayName="DialogFooter";const li=p.forwardRef(({className:t,...s},r)=>n.jsx(B2,{ref:r,className:Bt("text-lg font-semibold leading-none tracking-tight",t),...s}));li.displayName=B2.displayName;const ch=p.forwardRef(({className:t,...s},r)=>n.jsx($2,{ref:r,className:Bt("text-sm text-muted-foreground",t),...s}));ch.displayName=$2.displayName;const d3e=[{id:"preop",label:"Pre-op Checklist"},{id:"safety",label:"WHO Safety Checklist"},{id:"anaesthesia",label:"Anaesthesia"},{id:"nursing",label:"Nursing Notes"},{id:"counts",label:"Instrument & Sponge Counts"},{id:"blood",label:"Blood & Fluids"},{id:"notes",label:"Operation Notes"},{id:"pacu",label:"PACU / Recovery"}];function G2(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s.getTime())?null:s}function S4(t){const s=G2(t);return s?s.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):""}function C4(t){if(!t)return"";if(typeof t=="string"){const r=t.match(/^(\d{2}):(\d{2})/);if(r)return`${r[1]}:${r[2]}`}const s=G2(t);return s?s.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}):""}function sL(t){return G2(t)?`${S4(t)}  ${C4(t)}`:""}function u3e(...t){return t.filter(Boolean).join("  ")}function m3e(t){if(!t)return"";const s=t.prefix||t.title,r=t.first_name||t.given_name,a=t.last_name||t.family_name;return[s,r,a].filter(Boolean).join(" ")||t.full_name||t.display_name||""}function h3e(t){if(!t)return null;const s=t.sex||t.gender||t.sex_label||null;let r=t.age_display||t.age||null;if(!r&&(t.age_years!=null||t.age_months!=null)){const a=t.age_years,i=t.age_months;a!=null&&i!=null?r=`${a}y ${i}m`:a!=null?r=`${a}y`:i!=null&&(r=`${i}m`)}if(!r&&t.dob){const a=G2(t.dob);if(a){const i=new Date;let l=i.getFullYear()-a.getFullYear();const o=i.getMonth()-a.getMonth();(o<0||o===0&&i.getDate()<a.getDate())&&l--,r=`${l}y`}}return r&&s?`${r} / ${s}`:r||s||null}function x3e(t,s){const r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=s||"ot_case.pdf",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(r)}function p3e(){var X;const{caseId:t}=Cm(),s=Qr(),{user:r,perms:a}=dn()||{},i=ct("ot.cases.view")||ct("ot.cases.update")||ct("ot.cases.create")||ct("ot.schedule.view")||ct("ot.schedules.view")||ct("ipd.view"),[l,o]=p.useState("preop"),[c,d]=p.useState(null),[u,m]=p.useState(!1),[x,g]=p.useState(null),[y,v]=p.useState(!1),[j,w]=p.useState(!1),[S,E]=p.useState(null),k=async()=>{var Z;if(!(!i||!t))try{m(!0),g(null);const Y=await tSe(t);d(Y.data||null)}catch(Y){console.error("Failed to load OT case",Y);const Q=(Z=Y==null?void 0:Y.response)==null?void 0:Z.status;g(Q===404?"OT case not found.":Q===403?"You do not have permission to view this OT case.":"Failed to load OT case. Please try again.")}finally{m(!1)}};p.useEffect(()=>{k()},[t,i]),p.useEffect(()=>()=>{S&&URL.revokeObjectURL(S)},[]);const A=c==null?void 0:c.schedule,I=A==null?void 0:A.patient,P=(A==null?void 0:A.admission)||null,O=(A==null?void 0:A.ot_bed)||(A==null?void 0:A.bed)||null,D=(P==null?void 0:P.current_bed)||null,T=O||D,B=m3e(I),U=h3e(I),W=(A==null?void 0:A.reg_no)||(A==null?void 0:A.display_number)||(A==null?void 0:A.ot_number)||(A==null?void 0:A.schedule_code)||null,V=(I==null?void 0:I.uhid)||(I==null?void 0:I.uhid_number)||(A==null?void 0:A.patient_uhid)||null,R=(P==null?void 0:P.display_code)||(P==null?void 0:P.admission_code)||null,F=(A==null?void 0:A.op_no)||null,G=(P==null?void 0:P.admitted_at)||(P==null?void 0:P.admission_date)||null,H=T?u3e(T.ward_name,T.room_name,T.code):null,$=(c==null?void 0:c.final_procedure_name)||(A==null?void 0:A.procedure_name)||(A==null?void 0:A.primary_procedure_name)||"",K=(X=A==null?void 0:A.additional_procedures)!=null&&X.length?A.additional_procedures.map(Z=>Z.name||Z.procedure_name).filter(Boolean).join(", "):null,le=(A==null?void 0:A.planned_start_time)||(A==null?void 0:A.planned_start)||null,se=(A==null?void 0:A.planned_end_time)||(A==null?void 0:A.planned_end)||null,J=c==null?void 0:c.actual_start_time,ie=c==null?void 0:c.actual_end_time,te=(A==null?void 0:A.date)||le||se||null,ne=p.useMemo(()=>{if(!c)return null;const Z=(A==null?void 0:A.status)||(c.outcome?"closed":"open"),Y=String(Z).toLowerCase(),Q={planned:"bg-slate-100 text-slate-700",in_progress:"bg-sky-50 text-sky-700",completed:"bg-emerald-50 text-emerald-700",cancelled:"bg-rose-50 text-rose-700",open:"bg-emerald-50 text-emerald-700",closed:"bg-slate-100 text-slate-700"};return n.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-[11px] font-medium ${Q[Y]||"bg-slate-100 text-slate-700"}`,children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-current opacity-70"}),String(Z).toUpperCase()]})},[c,A]),q=async()=>{if(t)try{v(!0);const Z=await b8(t),Y=new Blob([Z.data],{type:"application/pdf"});S&&URL.revokeObjectURL(S);const Q=URL.createObjectURL(Y);E(Q),w(!0)}catch(Z){console.error(Z),ae.error("Failed to load PDF")}finally{v(!1)}},ee=async()=>{if(t)try{v(!0);const Z=await b8(t),Y=new Blob([Z.data],{type:"application/pdf"}),Q=`OT_Case_${V||t}.pdf`;x3e(Y,Q),ae.success("PDF downloaded")}catch(Z){console.error(Z),ae.error("Failed to download PDF")}finally{v(!1)}};return i?n.jsxs("div",{className:"flex h-full flex-col gap-3 p-4",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",onClick:()=>s(-1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-500 bg-white text-slate-600 shadow-sm hover:border-sky-400 hover:text-sky-700",children:n.jsx(Hl,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsxs("div",{className:"mb-0.5 flex flex-wrap items-center gap-2",children:[n.jsx("h1",{className:"text-base font-semibold text-slate-900",children:"OT Case"}),ne,W&&n.jsxs("span",{className:"inline-flex items-center rounded-full border border-slate-500 bg-slate-50 px-2 py-0.5 text-[11px] font-medium text-slate-700",children:[n.jsx(jo,{className:"mr-1 h-3 w-3"}),"OT Reg No: ",W]})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"All OT documentation, checklists and notes for this procedure."})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[te&&n.jsxs("div",{className:"hidden md:inline-flex items-center gap-1.5 rounded-full bg-slate-900 px-3 py-1 text-[11px] font-medium text-slate-50",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"OT Date: ",S4(te)]}),n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsxs(ge,{variant:"outline",className:"rounded-full",disabled:y,children:[n.jsx(Xn,{className:"mr-2 h-4 w-4"}),"Case PDF",y&&n.jsx("span",{className:"ml-2 h-3.5 w-3.5 animate-spin rounded-full border-2 border-slate-400 border-b-transparent"})]})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsxs(kr,{onClick:q,children:[n.jsx(Wr,{className:"mr-2 h-4 w-4"}),"Preview (Apple style)"]}),n.jsxs(kr,{onClick:ee,children:[n.jsx(nn,{className:"mr-2 h-4 w-4"}),"Download"]})]})]})]})]}),x&&n.jsx("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-2 text-xs text-rose-700",children:x}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 text-xs shadow-sm",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-sky-50 text-sky-700",children:n.jsx(or,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Patient"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:B})]})]}),n.jsxs("dl",{className:"space-y-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("dt",{className:"flex items-center gap-1.5 text-slate-500",children:[n.jsx(jo,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"UHID"})]}),n.jsx("dd",{className:"text-[11px] font-medium text-slate-900",children:V||""})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("dt",{className:"flex items-center gap-1.5 text-slate-500",children:[n.jsx(ac,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"Age / Sex"})]}),n.jsx("dd",{className:"text-[11px] text-slate-900",children:U||""})]})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 text-xs shadow-sm",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-emerald-50 text-emerald-700",children:n.jsx(cn,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Admission / Visit"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"IP or OP details"})]})]}),n.jsxs("dl",{className:"space-y-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("dt",{className:"flex items-center gap-1.5 text-slate-500",children:[n.jsx(Pr,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"IP No"})]}),n.jsx("dd",{className:"text-[11px] font-medium text-slate-900",children:R||""})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("dt",{className:"flex items-center gap-1.5 text-slate-500",children:[n.jsx(Pr,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"OP No"})]}),n.jsx("dd",{className:"text-[11px] font-medium text-slate-900",children:F||""})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("dt",{className:"flex items-center gap-1.5 text-slate-500",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"Date of Admission"})]}),n.jsx("dd",{className:"text-[11px] text-slate-900",children:G?S4(G):""})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("dt",{className:"flex items-center gap-1.5 text-slate-500",children:[n.jsx(cn,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"Bed Details"})]}),n.jsx("dd",{className:"text-[11px] text-right text-slate-900",children:H||""})]})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 text-xs shadow-sm",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-indigo-50 text-indigo-700",children:n.jsx(Hs,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Procedure"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:$})]})]}),K&&n.jsxs("div",{className:"mb-1 text-[11px] text-slate-500",children:["Additional: ",K]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 text-xs shadow-sm",children:[n.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-amber-50 text-amber-700",children:n.jsx(Na,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Timings"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:H||""})]})]}),n.jsxs("dl",{className:"space-y-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("dt",{className:"text-slate-500",children:"Planned"}),n.jsx("dd",{className:"text-[11px] text-right text-slate-900",children:le||se?`${C4(le)}  ${C4(se)}`:""})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("dt",{className:"text-slate-500",children:"Actual Start"}),n.jsx("dd",{className:"text-[11px] text-right text-slate-900",children:J?sL(J):""})]}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("dt",{className:"text-slate-500",children:"Actual End"}),n.jsx("dd",{className:"text-[11px] text-right text-slate-900",children:ie?sL(ie):""})]})]})]})]}),n.jsx("div",{className:"mt-1 flex gap-2 border-b border-slate-500 pt-1",children:d3e.map(Z=>{const Y=Z.id===l;return n.jsxs("button",{type:"button",onClick:()=>o(Z.id),className:`relative px-3 py-2 text-xs font-medium transition-colors ${Y?"text-sky-700":"text-slate-500 hover:text-slate-800"}`,children:[Z.label,Y&&n.jsx("span",{className:"absolute inset-x-0 bottom-0 h-0.5 rounded-full bg-sky-600"})]},Z.id)})}),n.jsxs("div",{className:"flex-1 overflow-auto pt-2 pb-4",children:[u&&!c&&n.jsx("div",{className:"rounded-2xl border bg-white px-4 py-4 text-xs text-slate-500",children:"Loading OT case..."}),!u&&!c&&!x&&n.jsx("div",{className:"rounded-2xl border bg-white px-4 py-4 text-xs text-slate-500",children:"OT case not loaded."}),c&&n.jsxs("div",{className:"space-y-3",children:[l==="preop"&&n.jsx(z5e,{caseId:t}),l==="safety"&&n.jsx(W5e,{caseId:t}),l==="anaesthesia"&&n.jsx(q5e,{caseId:t}),l==="nursing"&&n.jsx(s3e,{caseId:t}),l==="counts"&&n.jsx(a3e,{caseId:t}),l==="blood"&&n.jsx(l3e,{caseId:t}),l==="notes"&&n.jsx(Y5e,{caseId:t}),l==="pacu"&&n.jsx(Z5e,{caseId:t})]})]}),n.jsx(Wa,{open:j,onOpenChange:Z=>{w(Z),!Z&&S&&(URL.revokeObjectURL(S),E(null))},children:n.jsxs(va,{className:"max-w-5xl rounded-3xl p-0 overflow-hidden",children:[n.jsxs(ii,{className:"border-b bg-white px-4 py-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx(li,{className:"text-sm font-semibold",children:"Case PDF Preview"}),n.jsx(ge,{variant:"ghost",className:"rounded-full",onClick:()=>w(!1),children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsx("div",{className:"px-0 text-xs text-slate-500",children:"Apple-style PDF (cards + clean typography). Includes FULL Pre-op checklist."})]}),n.jsx("div",{className:"bg-slate-50 p-3",children:S?n.jsx("iframe",{title:"OT Case PDF Preview",src:S,className:"h-[78vh] w-full rounded-2xl border bg-white"}):n.jsx("div",{className:"rounded-2xl border bg-white p-6 text-sm text-slate-600",children:"PDF not loaded."})}),n.jsxs("div",{className:"flex items-center justify-end gap-2 border-t bg-white px-4 py-3",children:[n.jsxs(ge,{variant:"outline",className:"rounded-full",onClick:ee,children:[n.jsx(nn,{className:"mr-2 h-4 w-4"}),"Download"]}),n.jsx(ge,{className:"rounded-full",onClick:()=>w(!1),children:"Close"})]})]})})]}):n.jsx("div",{className:"p-4",children:n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:"You do not have permission to view OT cases."})})}const CY=[{value:"",label:"All sessions"},{value:"pre-list",label:"Pre-list"},{value:"between-cases",label:"Between cases"},{value:"end-of-day",label:"End of day"}],K2=t=>t?t.slice(0,10):"";function f3e(){const[t,s]=p.useState("cleaning"),[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState(null);return p.useEffect(()=>{(async()=>{try{l(!0),c(null);const u=await Z_e({});a(u.data||[])}catch(u){console.error("Failed to load OT theatres for logs",u),c("Failed to load OT theatres (for dropdowns)"),a([])}finally{l(!1)}})()},[]),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-lg font-semibold text-slate-900",children:"OT Logs  Cleaning & Environment"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Statutory OT cleaning / turnover and environment monitoring logs (NABH)."}),o&&n.jsxs("p",{className:"mt-1 text-[11px] text-amber-600",children:[o,"  theatre names may not show."]})]}),n.jsxs("div",{className:"inline-flex rounded-full border border-slate-500 bg-slate-50 p-1 text-xs",children:[n.jsx("button",{type:"button",onClick:()=>s("cleaning"),className:`rounded-full px-3 py-1 font-medium transition ${t==="cleaning"?"bg-white text-sky-700 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Cleaning / Sterility"}),n.jsx("button",{type:"button",onClick:()=>s("environment"),className:`rounded-full px-3 py-1 font-medium transition ${t==="environment"?"bg-white text-sky-700 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Environment (T/H/P)"})]})]}),t==="cleaning"?n.jsx(g3e,{theatreOptions:r,theatresLoading:i}):n.jsx(y3e,{theatreOptions:r,theatresLoading:i})]})}function g3e({theatreOptions:t,theatresLoading:s}){const r=ct("ot.logs.cleaning.view")||ct("ot.logs.view")||ct("ot.case.view"),a=ct("ot.logs.cleaning.manage")||ct("ot.logs.manage"),[i,l]=p.useState({theatreId:"",caseId:"",date:"",fromDate:"",toDate:"",session:""}),[o,c]=p.useState([]),[d,u]=p.useState(!1),[m,x]=p.useState(null),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState(!1),E=p.useCallback(T=>{if(!T)return"";const B=t==null?void 0:t.find(W=>W.id===T);return B?`${B.code||`TH-${B.id}`}  ${B.name||""}`.trim():`#${T}`},[t]),k=p.useCallback(async()=>{if(r)try{u(!0),x(null);const T=await TSe({theatreId:i.theatreId||void 0,caseId:i.caseId||void 0,date:i.date||void 0,fromDate:i.fromDate||void 0,toDate:i.toDate||void 0,session:i.session||void 0});c(T.data||[])}catch(T){console.error("Failed to load cleaning logs",T),x("Failed to load cleaning logs"),c([])}finally{u(!1)}},[r,i]);p.useEffect(()=>{k()},[k]);const A=()=>{j(null),y(!1)},I=T=>{j(T),y(!0)},P=()=>{j(null),y(!0)},O=async T=>{if(a&&window.confirm("Delete this cleaning log entry?"))try{await MSe(T.id),await k()}catch(B){console.error("Failed to delete cleaning log",B),alert("Failed to delete cleaning log entry")}},D=async T=>{var B,U;if(a){S(!0);try{const W={theatre_id:T.theatre_id?Number(T.theatre_id):null,date:T.date||null,session:T.session||null,case_id:T.case_id?Number(T.case_id):null,method:T.method||null,done_by_user_id:T.done_by_user_id?Number(T.done_by_user_id):null,remarks:T.remarks||null};v!=null&&v.id?await DSe(v.id,W):await PSe(W),await k(),A()}catch(W){console.error("Failed to save cleaning log",W),alert(((U=(B=W==null?void 0:W.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to save cleaning log. Please check required fields.")}finally{S(!1)}}};return r?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-xs",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[n.jsx($n,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"OT Cleaning / Sterility Logs"})]}),a&&n.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-700",children:[n.jsx(ds,{className:"h-3 w-3"}),"New cleaning log"]})]}),n.jsxs("div",{className:"mb-3 rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsxs("div",{className:"mb-1 flex items-center gap-2 text-[11px] font-medium text-slate-600",children:[n.jsx(jr,{className:"h-3 w-3"}),"Filters"]}),n.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-5",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Theatre"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.theatreId,onChange:T=>l(B=>({...B,theatreId:T.target.value})),children:[n.jsx("option",{value:"",children:"All theatres"}),t==null?void 0:t.map(T=>n.jsx("option",{value:T.id,children:(T.code||`TH-${T.id}`)+(T.name?`  ${T.name}`:"")},T.id))]}),s&&n.jsx("p",{className:"mt-0.5 text-[10px] text-slate-400",children:"Loading theatres..."})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Case ID"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.caseId,onChange:T=>l(B=>({...B,caseId:T.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Date"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.date,onChange:T=>l(B=>({...B,date:T.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"From"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.fromDate,onChange:T=>l(B=>({...B,fromDate:T.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"To"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.toDate,onChange:T=>l(B=>({...B,toDate:T.target.value}))})]})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsx("select",{className:"w-full max-w-xs rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.session,onChange:T=>l(B=>({...B,session:T.target.value})),children:CY.map(T=>n.jsx("option",{value:T.value,children:T.label},T.value))}),n.jsx("button",{type:"button",onClick:k,className:"rounded-lg border border-slate-300 bg-white px-3 py-1 text-[11px] font-medium text-slate-700 hover:bg-slate-100",children:"Apply"}),n.jsx("button",{type:"button",onClick:()=>l({theatreId:"",caseId:"",date:"",fromDate:"",toDate:"",session:""}),className:"rounded-lg border border-slate-500 bg-slate-50 px-3 py-1 text-[11px] text-slate-500 hover:bg-slate-100",children:"Clear"})]})]}),d&&n.jsx("div",{className:"text-xs text-slate-500",children:"Loading cleaning logs..."}),m&&n.jsx("div",{className:"mb-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:m}),n.jsx("div",{className:"max-h-80 overflow-auto rounded-xl border bg-slate-50",children:n.jsxs("table",{className:"min-w-full text-left text-[11px] text-slate-700",children:[n.jsx("thead",{className:"bg-slate-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-1.5",children:"Date"}),n.jsx("th",{className:"px-3 py-1.5",children:"Theatre"}),n.jsx("th",{className:"px-3 py-1.5",children:"Session"}),n.jsx("th",{className:"px-3 py-1.5",children:"Case ID"}),n.jsx("th",{className:"px-3 py-1.5",children:"Method"}),n.jsx("th",{className:"px-3 py-1.5",children:"Done by (user id)"}),n.jsx("th",{className:"px-3 py-1.5",children:"Remarks"}),a&&n.jsx("th",{className:"px-3 py-1.5 text-right",children:"Actions"})]})}),n.jsxs("tbody",{children:[!d&&o.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:a?8:7,className:"px-3 py-2 text-center text-[11px] text-slate-500",children:"No cleaning logs found for the selected filters."})}),!d&&o.map(T=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-1.5",children:K2(T.date)||""}),n.jsx("td",{className:"px-3 py-1.5",children:E(T.theatre_id)||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.session||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.case_id||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.method||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.done_by_user_id||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.remarks||""}),a&&n.jsx("td",{className:"px-3 py-1.5 text-right",children:n.jsxs("div",{className:"inline-flex gap-1",children:[n.jsxs("button",{type:"button",onClick:()=>I(T),className:"inline-flex items-center gap-1 rounded-lg border border-slate-300 bg-white px-2 py-0.5 text-[10px] text-slate-700 hover:bg-slate-100",children:[n.jsx(MV,{className:"h-3 w-3"}),"Edit"]}),n.jsxs("button",{type:"button",onClick:()=>O(T),className:"inline-flex items-center gap-1 rounded-lg border border-rose-200 bg-white px-2 py-0.5 text-[10px] text-rose-600 hover:bg-rose-50",children:[n.jsx(Ms,{className:"h-3 w-3"}),"Delete"]})]})})]},T.id))]})]})})]}),g&&n.jsx(b3e,{initial:v,onClose:A,onSave:D,saving:w,theatreOptions:t})]}):n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view OT cleaning logs."})}function b3e({initial:t,onClose:s,onSave:r,saving:a,theatreOptions:i}){const[l,o]=p.useState({theatre_id:(t==null?void 0:t.theatre_id)??"",date:t!=null&&t.date?K2(t.date):"",session:(t==null?void 0:t.session)??"",case_id:(t==null?void 0:t.case_id)??"",method:(t==null?void 0:t.method)??"",done_by_user_id:(t==null?void 0:t.done_by_user_id)??"",remarks:(t==null?void 0:t.remarks)??""}),c=(u,m)=>{o(x=>({...x,[u]:m}))},d=u=>{u.preventDefault(),r(l)};return n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 p-2",children:n.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-4 text-xs shadow-xl",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx($n,{className:"h-4 w-4 text-sky-600"}),n.jsx("span",{className:"text-sm font-semibold text-slate-900",children:t?"Edit cleaning log":"New cleaning log"})]}),n.jsx("button",{type:"button",onClick:s,className:"rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-700",children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("form",{onSubmit:d,className:"space-y-2",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Theatre *"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.theatre_id,required:!0,onChange:u=>c("theatre_id",u.target.value),children:[n.jsx("option",{value:"",children:"Select theatre"}),i==null?void 0:i.map(u=>n.jsx("option",{value:u.id,children:(u.code||`TH-${u.id}`)+(u.name?`  ${u.name}`:"")},u.id))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Date *"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.date,required:!0,onChange:u=>c("date",u.target.value)})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Session"}),n.jsx("select",{className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.session,onChange:u=>c("session",u.target.value),children:CY.map(u=>n.jsx("option",{value:u.value,children:u.label||""},u.value))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Case ID (optional)"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.case_id,onChange:u=>c("case_id",u.target.value)})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Method / Type *"}),n.jsx("input",{type:"text",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",placeholder:"Mopping, fumigation, UV, etc.",value:l.method,required:!0,onChange:u=>c("method",u.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Done by (User ID) *"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.done_by_user_id,required:!0,onChange:u=>c("done_by_user_id",u.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Remarks"}),n.jsx("textarea",{rows:2,className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.remarks,onChange:u=>c("remarks",u.target.value)})]}),n.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[n.jsx("button",{type:"button",onClick:s,className:"rounded-xl border border-slate-500 bg-white px-3 py-1.5 text-[11px] text-slate-600 hover:bg-slate-50",children:"Cancel"}),n.jsxs("button",{type:"submit",disabled:a,className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-[11px] font-medium text-white hover:bg-sky-700 disabled:opacity-60",children:[a&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save"]})]})]})]})})}function y3e({theatreOptions:t,theatresLoading:s}){const r=ct("ot.logs.environment.view")||ct("ot.logs.view")||ct("ot.case.view"),a=ct("ot.logs.environment.manage")||ct("ot.logs.manage"),[i,l]=p.useState({theatreId:"",date:"",fromDate:"",toDate:""}),[o,c]=p.useState([]),[d,u]=p.useState(!1),[m,x]=p.useState(null),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState(!1),E=p.useCallback(T=>{if(!T)return"";const B=t==null?void 0:t.find(W=>W.id===T);return B?`${B.code||`TH-${B.id}`}  ${B.name||""}`.trim():`#${T}`},[t]),k=p.useCallback(async()=>{if(r)try{u(!0),x(null);const T=await ISe({theatreId:i.theatreId||void 0,date:i.date||void 0,fromDate:i.fromDate||void 0,toDate:i.toDate||void 0});c(T.data||[])}catch(T){console.error("Failed to load environment logs",T),x("Failed to load environment logs"),c([])}finally{u(!1)}},[r,i]);p.useEffect(()=>{k()},[k]);const A=()=>{j(null),y(!1)},I=()=>{j(null),y(!0)},P=T=>{j(T),y(!0)},O=async T=>{if(a&&window.confirm("Delete this environment log entry?"))try{await LSe(T.id),await k()}catch(B){console.error("Failed to delete environment log",B),alert("Failed to delete environment log entry")}},D=async T=>{var B,U;if(a){S(!0);try{const W={theatre_id:T.theatre_id?Number(T.theatre_id):null,date:T.date||null,time:T.time||null,temperature_c:T.temperature_c===""?null:Number(T.temperature_c),humidity_percent:T.humidity_percent===""?null:Number(T.humidity_percent),pressure_diff_pa:T.pressure_diff_pa===""?null:Number(T.pressure_diff_pa),logged_by_user_id:T.logged_by_user_id?Number(T.logged_by_user_id):null};v!=null&&v.id?await RSe(v.id,W):await OSe(W),await k(),A()}catch(W){console.error("Failed to save environment log",W),alert(((U=(B=W==null?void 0:W.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to save environment log. Please check required fields.")}finally{S(!1)}}};return r?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"space-y-3 rounded-2xl border bg-white p-4 text-xs",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[n.jsx(ab,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"OT Environment Logs (Temperature / Humidity / Pressure)"})]}),a&&n.jsxs("button",{type:"button",onClick:I,className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-700",children:[n.jsx(ds,{className:"h-3 w-3"}),"New environment log"]})]}),n.jsxs("div",{className:"mb-3 rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsxs("div",{className:"mb-1 flex items-center gap-2 text-[11px] font-medium text-slate-600",children:[n.jsx(jr,{className:"h-3 w-3"}),"Filters"]}),n.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-4",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Theatre"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.theatreId,onChange:T=>l(B=>({...B,theatreId:T.target.value})),children:[n.jsx("option",{value:"",children:"All theatres"}),t==null?void 0:t.map(T=>n.jsx("option",{value:T.id,children:(T.code||`TH-${T.id}`)+(T.name?`  ${T.name}`:"")},T.id))]}),s&&n.jsx("p",{className:"mt-0.5 text-[10px] text-slate-400",children:"Loading theatres..."})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Date"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.date,onChange:T=>l(B=>({...B,date:T.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"From"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.fromDate,onChange:T=>l(B=>({...B,fromDate:T.target.value}))})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"To"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 bg-white px-2 py-1 text-[11px]",value:i.toDate,onChange:T=>l(B=>({...B,toDate:T.target.value}))})]})]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsx("button",{type:"button",onClick:k,className:"rounded-lg border border-slate-300 bg-white px-3 py-1 text-[11px] font-medium text-slate-700 hover:bg-slate-100",children:"Apply"}),n.jsx("button",{type:"button",onClick:()=>l({theatreId:"",date:"",fromDate:"",toDate:""}),className:"rounded-lg border border-slate-500 bg-slate-50 px-3 py-1 text-[11px] text-slate-500 hover:bg-slate-100",children:"Clear"})]})]}),d&&n.jsx("div",{className:"text-xs text-slate-500",children:"Loading environment logs..."}),m&&n.jsx("div",{className:"mb-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:m}),n.jsx("div",{className:"max-h-80 overflow-auto rounded-xl border bg-slate-50",children:n.jsxs("table",{className:"min-w-full text-left text-[11px] text-slate-700",children:[n.jsx("thead",{className:"bg-slate-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-1.5",children:"Date"}),n.jsx("th",{className:"px-3 py-1.5",children:"Time"}),n.jsx("th",{className:"px-3 py-1.5",children:"Theatre"}),n.jsx("th",{className:"px-3 py-1.5",children:"Temp (C)"}),n.jsx("th",{className:"px-3 py-1.5",children:"Humidity (%)"}),n.jsx("th",{className:"px-3 py-1.5",children:"Pressure (Pa)"}),n.jsx("th",{className:"px-3 py-1.5",children:"Logged by (user id)"}),a&&n.jsx("th",{className:"px-3 py-1.5 text-right",children:"Actions"})]})}),n.jsxs("tbody",{children:[!d&&o.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:a?8:7,className:"px-3 py-2 text-center text-[11px] text-slate-500",children:"No environment logs found for the selected filters."})}),!d&&o.map(T=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-1.5",children:K2(T.date)||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.time?T.time.slice(0,5):""}),n.jsx("td",{className:"px-3 py-1.5",children:E(T.theatre_id)||""}),n.jsx("td",{className:"px-3 py-1.5",children:T.temperature_c!==null&&T.temperature_c!==void 0?T.temperature_c:""}),n.jsx("td",{className:"px-3 py-1.5",children:T.humidity_percent!==null&&T.humidity_percent!==void 0?T.humidity_percent:""}),n.jsx("td",{className:"px-3 py-1.5",children:T.pressure_diff_pa!==null&&T.pressure_diff_pa!==void 0?T.pressure_diff_pa:""}),n.jsx("td",{className:"px-3 py-1.5",children:T.logged_by_user_id||""}),a&&n.jsx("td",{className:"px-3 py-1.5 text-right",children:n.jsxs("div",{className:"inline-flex gap-1",children:[n.jsxs("button",{type:"button",onClick:()=>P(T),className:"inline-flex items-center gap-1 rounded-lg border border-slate-300 bg-white px-2 py-0.5 text-[10px] text-slate-700 hover:bg-slate-100",children:[n.jsx(MV,{className:"h-3 w-3"}),"Edit"]}),n.jsxs("button",{type:"button",onClick:()=>O(T),className:"inline-flex items-center gap-1 rounded-lg border border-rose-200 bg-white px-2 py-0.5 text-[10px] text-rose-600 hover:bg-rose-50",children:[n.jsx(Ms,{className:"h-3 w-3"}),"Delete"]})]})})]},T.id))]})]})})]}),g&&n.jsx(v3e,{initial:v,onClose:A,onSave:D,saving:w,theatreOptions:t})]}):n.jsx("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-800",children:"You do not have permission to view environment logs."})}function v3e({initial:t,onClose:s,onSave:r,saving:a,theatreOptions:i}){const[l,o]=p.useState({theatre_id:(t==null?void 0:t.theatre_id)??"",date:t!=null&&t.date?K2(t.date):"",time:(t==null?void 0:t.time)??"",temperature_c:(t==null?void 0:t.temperature_c)!==null&&(t==null?void 0:t.temperature_c)!==void 0?String(t.temperature_c):"",humidity_percent:(t==null?void 0:t.humidity_percent)!==null&&(t==null?void 0:t.humidity_percent)!==void 0?String(t.humidity_percent):"",pressure_diff_pa:(t==null?void 0:t.pressure_diff_pa)!==null&&(t==null?void 0:t.pressure_diff_pa)!==void 0?String(t.pressure_diff_pa):"",logged_by_user_id:(t==null?void 0:t.logged_by_user_id)??""}),c=(u,m)=>{o(x=>({...x,[u]:m}))},d=u=>{u.preventDefault(),r(l)};return n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 p-2",children:n.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-white p-4 text-xs shadow-xl",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ab,{className:"h-4 w-4 text-sky-600"}),n.jsx("span",{className:"text-sm font-semibold text-slate-900",children:t?"Edit environment log":"New environment log"})]}),n.jsx("button",{type:"button",onClick:s,className:"rounded-full p-1 text-slate-400 hover:bg-slate-100 hover:text-slate-700",children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("form",{onSubmit:d,className:"space-y-2",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Theatre *"}),n.jsxs("select",{className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.theatre_id,required:!0,onChange:u=>c("theatre_id",u.target.value),children:[n.jsx("option",{value:"",children:"Select theatre"}),i==null?void 0:i.map(u=>n.jsx("option",{value:u.id,children:(u.code||`TH-${u.id}`)+(u.name?`  ${u.name}`:"")},u.id))]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Date *"}),n.jsx("input",{type:"date",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.date,required:!0,onChange:u=>c("date",u.target.value)})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Time *"}),n.jsx("input",{type:"time",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.time,required:!0,onChange:u=>c("time",u.target.value)})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Temp (C)"}),n.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.temperature_c,onChange:u=>c("temperature_c",u.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Humidity (%)"}),n.jsx("input",{type:"number",step:"0.1",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.humidity_percent,onChange:u=>c("humidity_percent",u.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Pressure (Pa)"}),n.jsx("input",{type:"number",step:"0.01",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.pressure_diff_pa,onChange:u=>c("pressure_diff_pa",u.target.value)})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Logged by (User ID) *"}),n.jsx("input",{type:"number",className:"w-full rounded-lg border border-slate-500 px-2 py-1 text-[11px]",value:l.logged_by_user_id,required:!0,onChange:u=>c("logged_by_user_id",u.target.value)})]}),n.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[n.jsx("button",{type:"button",onClick:s,className:"rounded-xl border border-slate-500 bg-white px-3 py-1.5 text-[11px] text-slate-600 hover:bg-slate-50",children:"Cancel"}),n.jsxs("button",{type:"submit",disabled:a,className:"inline-flex items-center gap-1.5 rounded-xl border border-sky-600 bg-sky-600 px-3 py-1.5 text-[11px] font-medium text-white hover:bg-sky-700 disabled:opacity-60",children:[a&&n.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border-[2px] border-white border-b-transparent"}),"Save"]})]})]})]})})}function j3e({kind:t="success",title:s,message:r,onClose:a}){const i={success:{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-900",icon:n.jsx(Xt,{className:"w-4 h-4 text-emerald-600"})},error:{bg:"bg-red-50",border:"border-red-200",text:"text-red-900",icon:n.jsx(ca,{className:"w-4 h-4 text-red-600"})},info:{bg:"bg-sky-50",border:"border-sky-200",text:"text-sky-900",icon:n.jsx(Qs,{className:"w-4 h-4 text-sky-600"})}},l=i[t]??i.info;return n.jsx("div",{className:"fixed top-4 right-4 z-40",children:n.jsxs("div",{className:`flex items-start gap-3 rounded-xl border shadow-sm px-4 py-3 ${l.bg} ${l.border} ${l.text}`,children:[n.jsx("div",{className:"mt-0.5",children:l.icon}),n.jsxs("div",{className:"space-y-0.5",children:[s&&n.jsx("div",{className:"font-semibold text-sm",children:s}),r&&n.jsx("div",{className:"text-xs leading-snug text-slate-700",children:r})]}),n.jsx("button",{onClick:a,className:"ml-2 text-xs text-slate-500 hover:text-slate-700",children:""})]})})}function nL({status:t}){const r={staging:{label:"Staging",className:"bg-amber-50 text-amber-800 border border-amber-200 dark:bg-amber-950/40 dark:text-amber-200"},mapped:{label:"Mapped",className:"bg-sky-50 text-sky-800 border border-sky-200 dark:bg-sky-950/40 dark:text-sky-200"},posted:{label:"Posted",className:"bg-emerald-50 text-emerald-800 border border-emerald-200 dark:bg-emerald-950/40 dark:text-emerald-200"},error:{label:"Error",className:"bg-red-50 text-red-800 border border-red-200 dark:bg-red-950/40 dark:text-red-200"}}[t]??{label:t||"Unknown",className:"bg-slate-50 text-slate-800 border border-slate-500 dark:bg-slate-900 dark:text-slate-200"};return n.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${r.className}`,children:r.label})}function rL({message:t}){return t?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-red-50 text-red-700 border border-red-200 px-2 py-0.5 text-[11px] font-medium",title:t,children:[n.jsx(Ede,{className:"w-3 h-3"}),"Error"]}):null}function N3e(){const[t,s]=p.useState([]),[r,a]=p.useState(null),[i,l]=p.useState([]),[o,c]=p.useState("all"),[d,u]=p.useState(""),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState(!1),[w,S]=p.useState(null),[E,k]=p.useState(null),A=ct("lab.results.map"),I=ct("lab.devices.view"),P=p.useCallback((R,F,G)=>{k({kind:R,title:F,message:G}),setTimeout(()=>k(null),3500)},[]);p.useEffect(()=>{if(!I)return;(async()=>{x(!0),S(null);try{const F=await he.get("/lis/devices");s(F.data||[]),F.data&&F.data.length>0&&a(F.data[0].id)}catch(F){console.error(F),S("Failed to load devices"),P("error","Load failed","Unable to load analyzer devices.")}finally{x(!1)}})()},[I,P]);const O=p.useCallback(async R=>{if(R){y(!0),S(null);try{const F=await he.get(`/lis/devices/${R}/results/staging`,{params:{limit:200}});l(F.data||[])}catch(F){console.error(F),S("Failed to load staging results"),P("error","Load failed","Unable to load staging results for this device.")}finally{y(!1)}}},[P]);p.useEffect(()=>{r&&O(r)},[r,O]);const D=p.useMemo(()=>{let R=i||[];o!=="all"&&(R=R.filter(G=>G.status===o));const F=d.trim();if(F){const G=F.toLowerCase();R=R.filter(H=>(H.sample_id||"").toLowerCase().includes(G))}return R},[i,o,d]),T=p.useMemo(()=>t.find(R=>R.id===r)||null,[t,r]),B=async()=>{if(!(!r||!A)){j(!0);try{await he.post(`/api/lis/mapping/devices/${r}/auto-map`,null,{params:{limit:500}}),P("success","Mapping complete","Auto mapping for this device is completed."),await O(r)}catch(R){console.error(R),P("error","Mapping failed","Something went wrong while mapping results.")}finally{j(!1)}}},U=async()=>{const R=d.trim();if(!(!R||!A)){j(!0);try{await he.post(`/api/lis/mapping/samples/${encodeURIComponent(R)}/auto-map`),P("success","Sample mapped",`Auto mapping completed for sample ${R}.`),r&&await O(r)}catch(F){console.error(F),P("error","Mapping failed","Unable to map this sample. Check if staging rows exist.")}finally{j(!1)}}},W=async R=>{if(A){j(!0);try{const G=(await he.post(`/api/lis/mapping/staging/${R}/map`)).data;l(H=>H.map($=>$.id===R?G:$)),P("success","Row mapped","Result mapped to lab order.")}catch(F){console.error(F),P("error","Mapping failed","Unable to map this result row. Check logs for details.")}finally{j(!1)}}},V=async()=>{r&&(await O(r),P("info","Refreshed","Staging results reloaded."))};return I?n.jsxs("div",{className:"px-4 py-6 sm:px-6 lg:px-8 space-y-4",children:[E&&n.jsx(j3e,{kind:E.kind,title:E.title,message:E.message,onClose:()=>k(null)}),n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-sky-50 px-3 py-1 border border-sky-100 text-xs font-semibold text-sky-700",children:[n.jsx(tl,{className:"w-3.5 h-3.5"}),"Analyzer Integration"]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("h1",{className:"text-xl font-semibold text-slate-900 md:text-2xl",children:"Analyzer Staging Results"})}),n.jsxs("p",{className:"text-xs md:text-sm text-slate-600",children:["Review incoming results from lab analyzers before they are attached to orders. Use ",n.jsx("span",{className:"font-semibold",children:"Auto Map"})," to link results to Lab Orders."]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"gap-1 text-xs font-semibold",onClick:V,disabled:g,children:[n.jsx(jh,{className:"w-3.5 h-3.5"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"gap-1 text-xs font-semibold",onClick:B,disabled:!A||!r||v,children:[n.jsx(Xt,{className:"w-3.5 h-3.5"}),"Auto Map Device"]})]})]}),n.jsxs(dt,{className:"border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(jr,{className:"w-4 h-4 text-slate-500"}),"Filters"]}),n.jsx(gs,{className:"text-xs",children:"Choose analyzer, filter by sample ID and staging status."})]}),T&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end text-xs",children:[n.jsxs(et,{variant:"outline",className:"gap-1 px-2 py-1",children:[n.jsx(a2,{className:"w-3.5 h-3.5"}),"Device: ",n.jsx("span",{className:"font-semibold",children:T.name})]}),n.jsxs(et,{variant:"outline",className:"text-[11px] px-2 py-1 text-slate-600",children:["Code: ",T.code]})]})]})}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Analyzer Device"}),m?n.jsx(Qe,{className:"h-9 w-full rounded-lg"}):n.jsxs("div",{className:"relative",children:[n.jsxs("select",{className:"block w-full rounded-lg border border-slate-500 bg-white px-3 py-2.5 text-xs md:text-sm font-medium text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 appearance-none pr-8",value:r||"",onChange:R=>a(R.target.value?Number(R.target.value):null),children:[t.length===0&&n.jsx("option",{value:"",children:"No devices configured"}),t.length>0&&t.map(R=>n.jsxs("option",{value:R.id,children:[R.name," (",R.code,")"]},R.id))]}),n.jsx(Gn,{className:"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Sample / Barcode"}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx(Ee,{placeholder:"Search by sample ID / barcode",className:"text-xs md:text-sm",value:d,onChange:R=>u(R.target.value)}),n.jsx(ge,{variant:"outline",size:"icon",className:"shrink-0",onClick:U,disabled:!A||!d.trim()||v,title:"Auto map all results for this sample",children:n.jsx(Yt,{className:"w-3.5 h-3.5"})})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Status"}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{id:"all",label:"All"},{id:"staging",label:"Staging"},{id:"mapped",label:"Mapped"},{id:"posted",label:"Posted"},{id:"error",label:"Error"}].map(R=>n.jsx(ge,{type:"button",variant:o===R.id?"default":"outline",size:"xs",className:`text-[11px] font-semibold px-2.5 py-1 ${o===R.id?"bg-sky-600 hover:bg-sky-700":"bg-white"}`,onClick:()=>c(R.id),children:R.label},R.id))})]})]}),w&&n.jsxs(ml,{variant:"destructive",className:"mt-2",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx(hl,{children:"Error"}),n.jsx(xl,{className:"text-xs",children:w})]})]})]}),n.jsxs(dt,{className:"border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"pb-2 flex flex-col gap-1 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(Qs,{className:"w-4 h-4 text-slate-500"}),"Staging Results"]}),n.jsx(gs,{className:"text-xs",children:g?"Loading staging results":`Showing ${D.length} row(s)${i.length!==D.length?` of ${i.length}`:""}`})]}),n.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-amber-400"}),"Staging"]}),n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-emerald-500"}),"Posted"]}),n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-red-500"}),"Error"]})]})]}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-500 bg-slate-50",children:[n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Sample ID"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Test Code"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Result"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Flags / Range"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Status"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Linked To"}),n.jsx("th",{className:"px-3 py-2 text-right font-semibold text-slate-700",children:"Actions"})]})}),n.jsxs("tbody",{children:[g&&Array.from({length:6}).map((R,F)=>n.jsxs("tr",{className:"border-b border-slate-100",children:[n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-24"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-16"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-20"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-28"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-16"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-24"})}),n.jsx("td",{className:"px-3 py-2 text-right",children:n.jsx(Qe,{className:"h-7 w-20 ml-auto"})})]},F)),!g&&D.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-8 text-center text-xs text-slate-500",children:"No staging results found for current filters."})}),!g&&D.map(R=>n.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/80",children:[n.jsxs("td",{className:"px-3 py-2 align-top",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-xs",children:R.sample_id||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Received:"," ",R.received_at?new Date(R.received_at).toLocaleString():""]})]}),n.jsxs("td",{className:"px-3 py-2 align-top",children:[n.jsx("div",{className:"font-semibold text-xs text-slate-800",children:R.external_test_code||""}),n.jsx("div",{className:"text-[11px] text-slate-500",children:R.external_test_name||""})]}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"font-semibold text-xs text-slate-900",children:[R.result_value,R.unit&&n.jsx("span",{className:"ml-1 text-[11px] text-slate-600",children:R.unit})]})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[R.flag&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-red-50 px-2 py-0.5 text-[11px] font-semibold text-red-700 border border-red-100",children:R.flag}),R.reference_range&&n.jsxs("span",{className:"text-[11px] text-slate-600",children:["Range: ",R.reference_range]}),n.jsx(rL,{message:R.error_message})]})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsx(nL,{status:R.status})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"space-y-0.5 text-[11px] text-slate-600",children:[n.jsxs("div",{children:["Order ID:"," ",n.jsx("span",{className:"font-semibold",children:R.lis_order_id||""})]}),n.jsxs("div",{children:["Test ID:"," ",n.jsx("span",{className:"font-semibold",children:R.lis_test_id||""})]}),n.jsxs("div",{children:["Patient:"," ",n.jsx("span",{className:"font-semibold",children:R.patient_id||""})]})]})}),n.jsx("td",{className:"px-3 py-2 align-top text-right",children:n.jsx(ge,{size:"xs",className:"text-[11px] font-semibold",variant:"outline",onClick:()=>W(R.id),disabled:!A||v||R.status==="posted",children:"Map row"})})]},R.id))]})]})}),n.jsxs("div",{className:"md:hidden space-y-3",children:[g&&Array.from({length:4}).map((R,F)=>n.jsx(dt,{className:"border-slate-500 shadow-sm rounded-xl",children:n.jsxs(it,{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-32"}),n.jsx(Qe,{className:"h-4 w-20"}),n.jsx(Qe,{className:"h-5 w-full"})]})},F)),!g&&D.length===0&&n.jsx("div",{className:"py-8 text-center text-xs text-slate-500",children:"No staging results found."}),!g&&D.map(R=>n.jsx(dt,{className:"border-slate-500 shadow-sm rounded-xl",children:n.jsxs(it,{className:"p-3 space-y-2",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"text-xs font-semibold text-slate-900",children:["Sample: ",R.sample_id||""]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:[R.external_test_code," ",R.external_test_name&&n.jsxs(n.Fragment,{children:[" ",R.external_test_name]})]})]}),n.jsx(nL,{status:R.status})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"text-xs font-semibold text-slate-900",children:[R.result_value,R.unit&&n.jsx("span",{className:"ml-1 text-[11px] text-slate-600",children:R.unit})]}),n.jsx(ge,{size:"xs",variant:"outline",className:"text-[11px] font-semibold",onClick:()=>W(R.id),disabled:!A||v||R.status==="posted",children:"Map"})]}),n.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[R.flag&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-red-50 px-2 py-0.5 text-[11px] font-semibold text-red-700 border border-red-100",children:R.flag}),R.reference_range&&n.jsxs("span",{className:"text-[11px] text-slate-600",children:["Range: ",R.reference_range]}),n.jsx(rL,{message:R.error_message})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px] text-slate-500",children:[n.jsxs("span",{children:["Order:"," ",n.jsx("span",{className:"font-semibold",children:R.lis_order_id||""})]}),n.jsxs("span",{children:["Test:"," ",n.jsx("span",{className:"font-semibold",children:R.lis_test_id||""})]}),n.jsxs("span",{children:["Patient:"," ",n.jsx("span",{className:"font-semibold",children:R.patient_id||""})]})]})]})},R.id))]})]})]})]}):n.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8",children:n.jsxs(ml,{variant:"destructive",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx(hl,{children:"Access denied"}),n.jsx(xl,{children:"You dont have permission to view analyzer devices. Contact admin."})]})})}var w3e="Label",kY=p.forwardRef((t,s)=>n.jsx(us.label,{...t,ref:s,onMouseDown:r=>{var i;r.target.closest("button, input, select, textarea")||((i=t.onMouseDown)==null||i.call(t,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));kY.displayName=w3e;var AY=kY;const _3e=h2("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),xt=p.forwardRef(({className:t,...s},r)=>n.jsx(AY,{ref:r,className:Bt(_3e(),t),...s}));xt.displayName=AY.displayName;function S3e({kind:t="success",title:s,message:r,onClose:a}){const i={success:{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-900",icon:n.jsx(Xt,{className:"w-4 h-4 text-emerald-600"})},error:{bg:"bg-red-50",border:"border-red-200",text:"text-red-900",icon:n.jsx(ca,{className:"w-4 h-4 text-red-600"})},info:{bg:"bg-sky-50",border:"border-sky-200",text:"text-sky-900",icon:n.jsx(rN,{className:"w-4 h-4 text-sky-600"})}},l=i[t]??i.info;return n.jsx("div",{className:"fixed top-4 right-4 z-40",children:n.jsxs("div",{className:`flex items-start gap-3 rounded-xl border shadow-sm px-4 py-3 ${l.bg} ${l.border} ${l.text}`,children:[n.jsx("div",{className:"mt-0.5",children:l.icon}),n.jsxs("div",{className:"space-y-0.5",children:[s&&n.jsx("div",{className:"font-semibold text-sm",children:s}),r&&n.jsx("div",{className:"text-xs leading-snug text-slate-700",children:r})]}),n.jsx("button",{onClick:a,className:"ml-2 text-xs text-slate-500 hover:text-slate-700",children:""})]})})}function C3e({checked:t,onChange:s}){return n.jsx("button",{type:"button",onClick:()=>s(!t),className:`relative inline-flex h-6 w-11 items-center rounded-full border transition-colors ${t?"bg-emerald-500 border-emerald-500":"bg-slate-200 border-slate-300"}`,children:n.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white shadow transition-transform ${t?"translate-x-5":"translate-x-1"}`})})}function aL({active:t}){return t?n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200 px-2 py-0.5 text-[11px] font-semibold",children:"Active"}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-50 text-slate-600 border border-slate-500 px-2 py-0.5 text-[11px] font-semibold",children:"Inactive"})}function k3e({value:t,onChange:s}){const[r,a]=p.useState(""),[i,l]=p.useState(!1),[o,c]=p.useState([]),d=p.useCallback(async m=>{if(a(m),!m||m.trim().length<2){c([]);return}l(!0);try{const x=await he.get("/lab/tests",{params:{search:m.trim(),limit:10}});c(x.data||[])}catch(x){console.error("Failed to search tests",x)}finally{l(!1)}},[]),u=p.useMemo(()=>{if(!t)return"Not mapped";const m=o.find(x=>x.id===t);return m?`${m.code||m.id}  ${m.name||""}`:`Test ID: ${t}`},[t,o]);return n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"LIS Test Mapping"}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(Ee,{placeholder:"Search LIS test (code / name)",className:"text-xs",value:r,onChange:m=>d(m.target.value)}),n.jsxs("div",{className:"border border-slate-500 rounded-lg bg-slate-50/60 px-2 py-1 text-[11px] text-slate-600",children:["Current: ",n.jsx("span",{className:"font-semibold",children:u})]})]}),i&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-500",children:"Searching"}),!i&&o.length>0&&n.jsx("div",{className:"mt-1 max-h-40 overflow-auto rounded-lg border border-slate-500 bg-white shadow-sm",children:o.map(m=>n.jsxs("button",{type:"button",className:`w-full text-left px-2 py-1.5 text-[11px] hover:bg-sky-50 ${t===m.id?"bg-sky-50/70":""}`,onClick:()=>s(m.id),children:[n.jsxs("div",{className:"font-semibold text-slate-800",children:[m.code||m.id," ",m.name&&n.jsxs("span",{className:"font-normal text-slate-600",children:[" ",m.name]})]}),m.category&&n.jsx("div",{className:"text-[10px] text-slate-500",children:m.category})]},m.id))}),n.jsxs("div",{className:"pt-2 border-t border-dashed border-slate-500 mt-2",children:[n.jsx(xt,{className:"text-[11px] font-medium text-slate-600",children:"Or manual LIS Test ID"}),n.jsx(Ee,{type:"number",placeholder:"Enter test ID",className:"mt-1 h-8 text-xs",value:t||"",onChange:m=>s(m.target.value?Number(m.target.value):null)})]})]})}function A3e(){const[t,s]=p.useState([]),[r,a]=p.useState(null),[i,l]=p.useState([]),[o,c]=p.useState(""),[d,u]=p.useState("all"),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState(null),[E,k]=p.useState(!1),[A,I]=p.useState(null),[P,O]=p.useState({external_test_code:"",external_test_name:"",lis_test_id:null,default_unit:"",reference_range:"",is_active:!0}),[D,T]=p.useState(!1),[B,U]=p.useState(null),W=ct("lab.devices.view"),V=ct("lab.devices.manage"),R=p.useCallback((ie,te,ne)=>{S({kind:ie,title:te,message:ne}),setTimeout(()=>S(null),3500)},[]);p.useEffect(()=>{if(!W)return;(async()=>{x(!0),j(null);try{const te=await he.get("/lis/devices");s(te.data||[]),te.data&&te.data.length>0?a(te.data[0].id):a(null)}catch(te){console.error(te),j("Failed to load analyzer devices"),R("error","Load failed","Unable to fetch devices. Please try again.")}finally{x(!1)}})()},[W,R]);const F=p.useCallback(async ie=>{if(ie){y(!0),j(null);try{const te=await he.get(`/lis/devices/${ie}/channels`);l(te.data||[])}catch(te){console.error(te),j("Failed to load channel mappings"),R("error","Load failed","Unable to load device channels. Check backend.")}finally{y(!1)}}},[R]);p.useEffect(()=>{r?F(r):l([])},[r,F]);const G=p.useMemo(()=>{let ie=i||[];d==="active"?ie=ie.filter(ne=>ne.is_active):d==="inactive"&&(ie=ie.filter(ne=>!ne.is_active));const te=o.trim().toLowerCase();return te&&(ie=ie.filter(ne=>{const q=(ne.external_test_code||"").toLowerCase(),ee=(ne.external_test_name||"").toLowerCase();return q.includes(te)||ee.includes(te)})),ie},[i,d,o]),H=p.useMemo(()=>t.find(ie=>ie.id===r)||null,[t,r]),$=()=>{if(!r){R("error","No device","Please select an analyzer device first.");return}I(null),O({external_test_code:"",external_test_name:"",lis_test_id:null,default_unit:"",reference_range:"",is_active:!0}),k(!0)},K=ie=>{I(ie),O({external_test_code:ie.external_test_code||"",external_test_name:ie.external_test_name||"",lis_test_id:ie.lis_test_id||null,default_unit:ie.default_unit||"",reference_range:ie.reference_range||"",is_active:ie.is_active??!0}),k(!0)},le=(ie,te)=>{O(ne=>({...ne,[ie]:te}))},se=async()=>{if(!r){R("error","No device","Please select an analyzer device first.");return}if(!P.external_test_code.trim()&&!A){R("error","Validation","External test code is required.");return}T(!0);try{A?(await he.put(`/lis/channels/${A.id}`,{external_test_name:P.external_test_name||null,lis_test_id:P.lis_test_id||null,default_unit:P.default_unit||null,reference_range:P.reference_range||null,is_active:P.is_active}),R("success","Updated","Mapping updated successfully.")):(await he.post(`/lis/devices/${r}/channels`,{device_id:r,external_test_code:P.external_test_code.trim(),external_test_name:P.external_test_name||null,lis_test_id:P.lis_test_id||null,default_unit:P.default_unit||null,reference_range:P.reference_range||null,is_active:P.is_active}),R("success","Created","New mapping added successfully.")),k(!1),await F(r)}catch(ie){console.error(ie),R("error","Save failed","Unable to save mapping. Please check and try again.")}finally{T(!1)}},J=async ie=>{if(window.confirm(`Delete mapping ${ie.external_test_code}?`)){U(ie.id);try{await he.delete(`/lis/channels/${ie.id}`),R("success","Deleted","Mapping removed."),l(te=>te.filter(ne=>ne.id!==ie.id))}catch(te){console.error(te),R("error","Delete failed","Unable to delete mapping. Please try again.")}finally{U(null)}}};return W?n.jsxs("div",{className:"px-4 py-6 sm:px-6 lg:px-8 space-y-4",children:[w&&n.jsx(S3e,{kind:w.kind,title:w.title,message:w.message,onClose:()=>S(null)}),n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-slate-50 px-3 py-1 border border-slate-500 text-xs font-semibold text-slate-700",children:[n.jsx(rN,{className:"w-3.5 h-3.5"}),"Analyzer Device Mapping"]}),n.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-slate-900",children:"Device Test Code Mapping"}),n.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Map analyzer test codes to LIS tests. This ensures incoming results are correctly attached to Lab Orders."})]}),n.jsx("div",{className:"flex flex-wrap items-center gap-2",children:V&&n.jsxs(ge,{size:"sm",className:"gap-1 text-xs font-semibold",onClick:$,disabled:m||t.length===0,children:[n.jsx(ds,{className:"w-3.5 h-3.5"}),"New Mapping"]})})]}),n.jsxs(dt,{className:"border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(jr,{className:"w-4 h-4 text-slate-500"}),"Filters"]}),n.jsx(gs,{className:"text-xs",children:"Choose analyzer device and filter channel mappings by code / name / status."})]}),H&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end text-xs",children:[n.jsxs(et,{variant:"outline",className:"gap-1 px-2 py-1",children:[n.jsx(a2,{className:"w-3.5 h-3.5"}),"Device:"," ",n.jsx("span",{className:"font-semibold",children:H.name})]}),n.jsxs(et,{variant:"outline",className:"text-[11px] px-2 py-1 text-slate-600",children:["Code: ",H.code]})]})]})}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Analyzer Device"}),m?n.jsx(Qe,{className:"h-9 w-full rounded-lg"}):n.jsxs("div",{className:"relative",children:[n.jsxs("select",{className:"block w-full rounded-lg border border-slate-500 bg-white px-3 py-2.5 text-xs md:text-sm font-medium text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 appearance-none pr-8",value:r||"",onChange:ie=>a(ie.target.value?Number(ie.target.value):null),children:[t.length===0&&n.jsx("option",{value:"",children:"No devices configured"}),t.length>0&&t.map(ie=>n.jsxs("option",{value:ie.id,children:[ie.name," (",ie.code,")"]},ie.id))]}),n.jsx(Gn,{className:"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Search Code / Name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-3.5 h-3.5 text-slate-400 absolute left-2.5 top-1/2 -translate-y-1/2"}),n.jsx(Ee,{placeholder:"e.g. WBC, GLU, HB",className:"pl-8 text-xs md:text-sm",value:o,onChange:ie=>c(ie.target.value)})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Status"}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"inactive",label:"Inactive"}].map(ie=>n.jsx(ge,{type:"button",variant:d===ie.id?"default":"outline",size:"xs",className:`text-[11px] font-semibold px-2.5 py-1 ${d===ie.id?"bg-sky-600 hover:bg-sky-700":"bg-white"}`,onClick:()=>u(ie.id),children:ie.label},ie.id))})]})]}),v&&n.jsxs(ml,{variant:"destructive",className:"mt-2",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx(hl,{children:"Error"}),n.jsx(xl,{className:"text-xs",children:v})]})]})]}),n.jsxs(dt,{className:"border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-2 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(yh,{className:"w-4 h-4 text-slate-500"}),"Device Test Code Mapping"]}),n.jsx(gs,{className:"text-xs",children:g?"Loading mappings":`Showing ${G.length} mapping(s)${i.length!==G.length?` of ${i.length}`:""}`})]})}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-500 bg-slate-50",children:[n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Device Test Code"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Device Test Name"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"LIS Test"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Default Unit / Range"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Status"}),n.jsx("th",{className:"px-3 py-2 text-right font-semibold text-slate-700",children:"Actions"})]})}),n.jsxs("tbody",{children:[g&&Array.from({length:6}).map((ie,te)=>n.jsxs("tr",{className:"border-b border-slate-100",children:[n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-24"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-40"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-32"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-32"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-16"})}),n.jsx("td",{className:"px-3 py-2 text-right",children:n.jsx(Qe,{className:"h-7 w-20 ml-auto"})})]},te)),!g&&G.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-8 text-center text-xs text-slate-500",children:"No mappings found for current filters."})}),!g&&G.map(ie=>n.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/70",children:[n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(jo,{className:"w-3.5 h-3.5 text-slate-400"}),n.jsx("span",{className:"font-semibold text-xs text-slate-900",children:ie.external_test_code||""})]})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsx("div",{className:"text-xs text-slate-800",children:ie.external_test_name||""})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"space-y-0.5 text-[11px] text-slate-600",children:[n.jsxs("div",{children:["LIS Test ID:"," ",n.jsx("span",{className:"font-semibold",children:ie.lis_test_id||"Not mapped"})]}),n.jsx("div",{className:"text-[10px] text-slate-500",children:"(Mapping used by auto-mapper)"})]})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"space-y-0.5 text-[11px] text-slate-600",children:[ie.default_unit&&n.jsxs("div",{children:["Unit:"," ",n.jsx("span",{className:"font-semibold",children:ie.default_unit})]}),ie.reference_range&&n.jsxs("div",{children:["Range:"," ",n.jsx("span",{className:"font-semibold",children:ie.reference_range})]})]})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsx(aL,{active:ie.is_active})}),n.jsx("td",{className:"px-3 py-2 align-top text-right",children:n.jsx("div",{className:"inline-flex items-center gap-1",children:V&&n.jsxs(n.Fragment,{children:[n.jsxs(ge,{size:"xs",variant:"outline",className:"text-[11px] font-semibold",onClick:()=>K(ie),children:[n.jsx(Yr,{className:"w-3.5 h-3.5 mr-1"}),"Edit"]}),n.jsxs(ge,{size:"xs",variant:"outline",className:"text-[11px] font-semibold text-red-600 border-red-200 hover:bg-red-50",onClick:()=>J(ie),disabled:B===ie.id,children:[n.jsx(Ms,{className:"w-3.5 h-3.5 mr-1"}),B===ie.id?"Deleting":"Delete"]})]})})})]},ie.id))]})]})}),n.jsxs("div",{className:"md:hidden space-y-3",children:[g&&Array.from({length:4}).map((ie,te)=>n.jsx(dt,{className:"border-slate-500 shadow-sm rounded-xl",children:n.jsxs(it,{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-32"}),n.jsx(Qe,{className:"h-4 w-24"}),n.jsx(Qe,{className:"h-5 w-full"})]})},te)),!g&&G.length===0&&n.jsx("div",{className:"py-8 text-center text-xs text-slate-500",children:"No mappings found."}),!g&&G.map(ie=>n.jsx(dt,{className:"border-slate-500 shadow-sm rounded-xl",children:n.jsxs(it,{className:"p-3 space-y-2",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(jo,{className:"w-3.5 h-3.5 text-slate-400"}),n.jsx("span",{className:"text-xs font-semibold text-slate-900",children:ie.external_test_code||""})]}),ie.external_test_name&&n.jsx("div",{className:"text-[11px] text-slate-600",children:ie.external_test_name})]}),n.jsx(aL,{active:ie.is_active})]}),n.jsxs("div",{className:"text-[11px] text-slate-600 space-y-0.5",children:[n.jsxs("div",{children:["LIS Test:"," ",n.jsx("span",{className:"font-semibold",children:ie.lis_test_id||"Not mapped"})]}),ie.default_unit&&n.jsxs("div",{children:["Unit:"," ",n.jsx("span",{className:"font-semibold",children:ie.default_unit})]}),ie.reference_range&&n.jsxs("div",{children:["Range:"," ",n.jsx("span",{className:"font-semibold",children:ie.reference_range})]})]}),V&&n.jsxs("div",{className:"flex justify-end gap-1 pt-1",children:[n.jsx(ge,{size:"xs",variant:"outline",className:"text-[11px] font-semibold",onClick:()=>K(ie),children:"Edit"}),n.jsx(ge,{size:"xs",variant:"outline",className:"text-[11px] font-semibold text-red-600 border-red-200 hover:bg-red-50",onClick:()=>J(ie),disabled:B===ie.id,children:B===ie.id?"...":"Del"})]})]})},ie.id))]})]})]}),n.jsx(Wa,{open:E,onOpenChange:k,children:n.jsxs(va,{className:"max-w-lg",children:[n.jsxs(ii,{children:[n.jsxs(li,{className:"flex items-center gap-2 text-sm md:text-base",children:[n.jsx(yh,{className:"w-4 h-4 text-sky-600"}),A?"Edit Mapping":"New Mapping"]}),n.jsx(ch,{className:"text-xs",children:"Map analyzer test code to LIS test. Auto-mapper will use this configuration when linking results."})]}),n.jsxs("div",{className:"space-y-3 py-2",children:[!A&&n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Device Test Code *"}),n.jsx(Ee,{placeholder:"e.g. WBC, GLU, HB",className:"text-xs",value:P.external_test_code,onChange:ie=>le("external_test_code",ie.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Device Test Name"}),n.jsx(Ee,{placeholder:"e.g. White Blood Cell Count",className:"text-xs",value:P.external_test_name,onChange:ie=>le("external_test_name",ie.target.value)})]}),n.jsx(k3e,{value:P.lis_test_id,onChange:ie=>le("lis_test_id",ie)}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Default Unit"}),n.jsx(Ee,{placeholder:"e.g. 10^3/uL, mmol/L",className:"text-xs",value:P.default_unit,onChange:ie=>le("default_unit",ie.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Reference Range"}),n.jsx(Ee,{placeholder:"e.g. 4.0-11.0",className:"text-xs",value:P.reference_range,onChange:ie=>le("reference_range",ie.target.value)})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-1",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Active"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Inactive mappings are ignored by auto-mapper."})]}),n.jsx(C3e,{checked:P.is_active,onChange:ie=>le("is_active",ie)})]})]}),n.jsxs(Kc,{className:"gap-2",children:[n.jsx(ge,{variant:"outline",size:"sm",className:"text-xs",onClick:()=>k(!1),children:"Cancel"}),n.jsx(ge,{size:"sm",className:"text-xs font-semibold",onClick:se,disabled:D,children:D?"Saving":"Save"})]})]})})]}):n.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8",children:n.jsxs(ml,{variant:"destructive",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx(hl,{children:"Access denied"}),n.jsx(xl,{className:"text-xs",children:"You dont have permission to view analyzer mapping. Contact admin."})]})})}function E3e({kind:t="success",title:s,message:r,onClose:a}){const i={success:{bg:"bg-emerald-50",border:"border-emerald-200",text:"text-emerald-900",icon:n.jsx(Xt,{className:"w-4 h-4 text-emerald-600"})},error:{bg:"bg-red-50",border:"border-red-200",text:"text-red-900",icon:n.jsx(ca,{className:"w-4 h-4 text-red-600"})},info:{bg:"bg-sky-50",border:"border-sky-200",text:"text-sky-900",icon:n.jsx(gr,{className:"w-4 h-4 text-sky-600"})}},l=i[t]??i.info;return n.jsx("div",{className:"fixed top-4 right-4 z-40",children:n.jsxs("div",{className:`flex items-start gap-3 rounded-xl border shadow-sm px-4 py-3 ${l.bg} ${l.border} ${l.text}`,children:[n.jsx("div",{className:"mt-0.5",children:l.icon}),n.jsxs("div",{className:"space-y-0.5",children:[s&&n.jsx("div",{className:"font-semibold text-sm",children:s}),r&&n.jsx("div",{className:"text-xs leading-snug text-slate-700",children:r})]}),n.jsx("button",{onClick:a,className:"ml-2 text-xs text-slate-500 hover:text-slate-700",children:""})]})})}function iL(t){if(!t)return"";try{const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleString()}catch{return t}}function lL(t){var a,i,l;const s=(a=t==null?void 0:t.response)==null?void 0:a.status,r=(l=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:l.detail;return t.response?s===401?"Unauthorized: check user login, token expiry, or permission interceptor.":s===403?"Forbidden: current user does not have lab.device_logs.view or lab.devices.view permission.":s===404?r||"Not found: for this device / tenant there are no logs or device mapping not created.":s===500?r||"Backend error: check tenant DB (lab_devices / lab_device_message_logs tables) or connector header values.":r||"Unexpected error while fetching analyzer logs.":"Network error from frontend  backend. Check backend is running and CORS / base URL in API client."}function T3e(){const[t,s]=p.useState([]),[r,a]=p.useState(null),[i,l]=p.useState([]),[o,c]=p.useState(!1),[d,u]=p.useState(!1),[m,x]=p.useState(""),[g,y]=p.useState(100),[v,j]=p.useState(null),[w,S]=p.useState(null),E=ct("lab.device_logs.view"),k=ct("lab.devices.view"),A=E||k,I=p.useCallback((T,B,U)=>{S({kind:T,title:B,message:U}),setTimeout(()=>S(null),4e3)},[]);p.useEffect(()=>{if(!A)return;(async()=>{c(!0),j(null);try{const U=(await he.get("/lis/devices")).data||[];s(U),U.length>0&&a(U[0].id)}catch(B){console.error("Analyzer Logs  load devices error",B),j(lL(B)),I("error","Failed to load devices","Could not fetch analyzer devices. Check login / permissions / backend.")}finally{c(!1)}})()},[A,I]);const P=p.useCallback(async T=>{if(T){u(!0),j(null);try{const B=await he.get(`/lis/devices/${T}/logs`,{params:{limit:g||100}});l(B.data||[])}catch(B){console.error("Analyzer Logs  load logs error",B);const U=lL(B);j(U),I("error","Failed to load logs",U)}finally{u(!1)}}},[g,I]);p.useEffect(()=>{r&&P(r)},[r,P]);const O=p.useMemo(()=>{const T=m.trim().toLowerCase();return T?(i||[]).filter(B=>[B.id,B.direction,B.status,B.error_message,B.sample_ids,B.raw_preview,B.source_ip].filter(Boolean).map(W=>String(W).toLowerCase()).some(W=>W.includes(T))):i||[]},[i,m]),D=t.find(T=>T.id===r)||null;return A?n.jsxs("div",{className:"px-4 py-6 sm:px-6 lg:px-8 space-y-4",children:[w&&n.jsx(E3e,{kind:w.kind,title:w.title,message:w.message,onClose:()=>S(null)}),n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-slate-50 px-3 py-1 border border-slate-500 text-xs font-semibold text-slate-700",children:[n.jsx(a2,{className:"w-3.5 h-3.5"}),"Analyzer Logs"]}),n.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-slate-900",children:"Device Communication Logs"}),n.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"View raw messages received from analyzers and connector status. Use this screen to debug header, tenant or API key issues."})]}),n.jsx("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:n.jsxs(ge,{size:"sm",variant:"outline",className:"gap-1 text-xs font-semibold",onClick:()=>r&&P(r),disabled:!r||d,children:[n.jsx(ps,{className:"w-3.5 h-3.5"}),d?"Refreshing":"Refresh"]})})]}),n.jsxs(dt,{className:"border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(jr,{className:"w-4 h-4 text-slate-500"}),"Filters"]}),n.jsx(gs,{className:"text-xs",children:"Choose analyzer device, adjust log limit, and search in raw message / status."})]}),D&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end text-xs",children:[n.jsxs(et,{variant:"outline",className:"gap-1 px-2 py-1",children:[n.jsx(_V,{className:"w-3.5 h-3.5"}),"Device:"," ",n.jsx("span",{className:"font-semibold",children:D.name})]}),n.jsxs(et,{variant:"outline",className:"text-[11px] px-2 py-1 text-slate-600",children:["Code: ",D.code]})]})]})}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Analyzer Device"}),o?n.jsx(Qe,{className:"h-9 w-full rounded-lg"}):n.jsxs("div",{className:"relative",children:[n.jsxs("select",{className:"block w-full rounded-lg border border-slate-500 bg-white px-3 py-2.5 text-xs md:text-sm font-medium text-slate-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 appearance-none pr-8",value:r||"",onChange:T=>a(T.target.value?Number(T.target.value):null),children:[t.length===0&&n.jsx("option",{value:"",children:"No devices configured"}),t.length>0&&t.map(T=>n.jsxs("option",{value:T.id,children:[T.name," (",T.code,")"]},T.id))]}),n.jsx(Gn,{className:"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Number of logs"}),n.jsx(Ee,{type:"number",min:10,max:500,step:10,className:"text-xs md:text-sm",value:g,onChange:T=>y(T.target.value?Math.min(500,Number(T.target.value)):100)}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Higher values are useful for debugging but may load slower."})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs font-semibold text-slate-700",children:"Search in message / error"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-3.5 h-3.5 text-slate-400 absolute left-2.5 top-1/2 -translate-y-1/2"}),n.jsx(Ee,{placeholder:"sample id, error, IP, status",className:"pl-8 text-xs md:text-sm",value:m,onChange:T=>x(T.target.value)})]})]})]}),v&&n.jsxs(ml,{variant:"destructive",className:"mt-2",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx(hl,{children:"Analyzer log error"}),n.jsx(xl,{className:"text-xs whitespace-pre-line",children:v})]})]})]}),n.jsxs(dt,{className:"border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-2 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(tb,{className:"w-4 h-4 text-slate-500"}),"Recent Analyzer Messages"]}),n.jsx(gs,{className:"text-xs",children:d?"Loading logs":`Showing ${O.length} log(s)${i.length!==O.length?` of ${i.length}`:""}`})]})}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-500 bg-slate-50",children:[n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Time"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Direction / Source"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Status"}),n.jsx("th",{className:"px-3 py-2 text-left font-semibold text-slate-700",children:"Message / Error"}),n.jsx("th",{className:"px-3 py-2 text-right font-semibold text-slate-700",children:"Raw Preview"})]})}),n.jsxs("tbody",{children:[d&&Array.from({length:8}).map((T,B)=>n.jsxs("tr",{className:"border-b border-slate-100",children:[n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-32"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-40"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-24"})}),n.jsx("td",{className:"px-3 py-2",children:n.jsx(Qe,{className:"h-4 w-64"})}),n.jsx("td",{className:"px-3 py-2 text-right",children:n.jsx(Qe,{className:"h-4 w-40 ml-auto"})})]},B)),!d&&O.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-8 text-center text-xs text-slate-500",children:"No logs for current filters."})}),!d&&O.map(T=>{var B;return n.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/70",children:[n.jsxs("td",{className:"px-3 py-2 align-top",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(jn,{className:"w-3.5 h-3.5 text-slate-400"}),n.jsx("span",{className:"font-medium text-xs text-slate-900",children:iL(T.created_at)})]}),T.sample_ids&&n.jsxs("div",{className:"text-[10px] text-slate-500 mt-0.5",children:["Samples: ",T.sample_ids]})]}),n.jsxs("td",{className:"px-3 py-2 align-top",children:[n.jsx("div",{className:"text-xs text-slate-800",children:T.direction||"INBOUND"}),T.source_ip&&n.jsxs("div",{className:"text-[10px] text-slate-500",children:[T.source_ip,":",T.source_port??""]})]}),n.jsxs("td",{className:"px-3 py-2 align-top",children:[T.error_message?n.jsx(et,{variant:"outline",className:"text-[10px] border-red-200 text-red-700 bg-red-50",children:"Error"}):n.jsx(et,{variant:"outline",className:"text-[10px] border-emerald-200 text-emerald-700 bg-emerald-50",children:"OK"}),T.status&&n.jsx("div",{className:"text-[10px] text-slate-600 mt-0.5",children:T.status})]}),n.jsx("td",{className:"px-3 py-2 align-top max-w-md",children:T.error_message?n.jsx("div",{className:"text-[11px] text-red-700",children:T.error_message}):n.jsx("div",{className:"text-[11px] text-slate-700",children:T.info_message||"No explicit error."})}),n.jsx("td",{className:"px-3 py-2 align-top text-right max-w-xs",children:n.jsx("div",{className:"text-[11px] text-slate-600 font-mono whitespace-nowrap overflow-hidden text-ellipsis",children:T.raw_preview||((B=T.raw_payload)==null?void 0:B.slice(0,120))||""})})]},T.id)})]})]})}),n.jsxs("div",{className:"md:hidden space-y-3",children:[d&&Array.from({length:4}).map((T,B)=>n.jsx(dt,{className:"border-slate-500 shadow-sm rounded-xl",children:n.jsxs(it,{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-32"}),n.jsx(Qe,{className:"h-4 w-24"}),n.jsx(Qe,{className:"h-5 w-full"})]})},B)),!d&&O.length===0&&n.jsx("div",{className:"py-8 text-center text-xs text-slate-500",children:"No logs for current filters."}),!d&&O.map(T=>{var B;return n.jsx(dt,{className:"border-slate-500 shadow-sm rounded-xl",children:n.jsxs(it,{className:"p-3 space-y-2",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(jn,{className:"w-3.5 h-3.5 text-slate-400"}),n.jsx("span",{className:"text-xs font-semibold text-slate-900",children:iL(T.created_at)})]}),T.source_ip&&n.jsxs("div",{className:"text-[10px] text-slate-500",children:[T.source_ip,":",T.source_port??""]})]}),T.error_message?n.jsx(et,{variant:"outline",className:"text-[10px] border-red-200 text-red-700 bg-red-50",children:"Error"}):n.jsx(et,{variant:"outline",className:"text-[10px] border-emerald-200 text-emerald-700 bg-emerald-50",children:"OK"})]}),n.jsx("div",{className:"text-[11px] text-slate-700 line-clamp-3",children:T.error_message||T.info_message||"No explicit error."}),n.jsx("div",{className:"text-[10px] text-slate-500 font-mono whitespace-nowrap overflow-hidden text-ellipsis border-t border-dashed border-slate-500 pt-1 mt-1",children:T.raw_preview||((B=T.raw_payload)==null?void 0:B.slice(0,80))||""})]})},T.id)})]})]})]})]}):n.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8",children:n.jsxs(ml,{variant:"destructive",children:[n.jsx(en,{className:"w-4 h-4"}),n.jsx(hl,{children:"Access denied"}),n.jsxs(xl,{className:"text-xs",children:["You dont have permission to view analyzer logs. Ask admin to enable ",n.jsx("code",{className:"font-mono text-[11px]",children:"lab.device_logs.view"})," ","or ",n.jsx("code",{className:"font-mono text-[11px]",children:"lab.devices.view"}),"."]})]})})}function P3e(t){return he.post("/billing/invoices",t)}function D3e(t){return he.get(`/billing/invoices/${t}`)}function M3e(t={}){return he.get("/billing/invoices",{params:t})}function I3e(t,s){return he.put(`/billing/invoices/${t}`,s)}function O3e(t){return he.post(`/billing/invoices/${t}/finalize`)}function R3e(t){return he.post(`/billing/invoices/${t}/cancel`)}function oL(t,s){return he.post(`/billing/invoices/${t}/items/manual`,s)}function L3e(t,s,r){return he.put(`/billing/invoices/${t}/items/${s}`,r)}function F3e(t,s,r){return he.post(`/billing/invoices/${t}/items/${s}/void`,r)}async function EY(t,s={}){var r;try{return await he.get(t)}catch(a){if(((r=a==null?void 0:a.response)==null?void 0:r.status)===405)return he.post(t,s);throw a}}function B3e(t){return EY(`/billing/invoices/${t}/unbilled`)}async function $3e(t,s){var r,a;try{return await he.post(`/billing/invoices/${t}/unbilled/bulk-add`,s)}catch(i){if(((r=i==null?void 0:i.response)==null?void 0:r.status)===404||((a=i==null?void 0:i.response)==null?void 0:a.status)===405)return he.post(`/billing/invoices/${t}/unbilled/bulk_add`,s);throw i}}function z3e(t,s){return he.post(`/billing/invoices/${t}/payments`,s)}function U3e(t,s){return he.delete(`/billing/invoices/${t}/payments/${s}`)}function jP(){return he.get("/billing/masters")}function V3e(t){return EY(`/billing/patients/${t}/summary`)}function H3e(t){return he.get(`/billing/invoices/${t}/print`,{responseType:"blob"})}function W3e(t){return he.get(`/billing/patients/${t}/print-summary`,{responseType:"blob"})}function q3e(t){return he.post("/billing/advances",t)}function G3e(t){return he.get(`/billing/advances/patient/${t}`)}function TY(t){return he.get(`/billing/advances/patient/${t}/summary`)}function K3e(t,s){return he.post(`/billing/advances/apply/${t}`,s)}function Ys(t){return Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}function lt(...t){return t.filter(Boolean).join(" ")}function Lx(t){try{return t?new Date(t).toLocaleString():""}catch{return""}}const Ue={page:"bg-[#F0F0F0] text-[#071952]",card:"bg-[#FFFEFB]",soft:"bg-[#F6EFE6]",soft2:"bg-[#FBF7F1]",border:"border-[#D9CBB8]",borderSoft:"border-[#E7DBCD]",muted:"text-[#6B5E55]",text:"text-[#2B2118]",shadowSm:"shadow-[0_6px_14px_rgba(43,33,24,0.10)]",focus:"focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-[#BDAA95]",btnPrimary:"bg-[#0E2954] hover:bg-[#1F1712] text-white",btnSecondary:"bg-[#ECF8F9] hover:bg-[#F6EFE6] text-[#2B2118]",btnDanger:"bg-[#8B2C2C] hover:bg-[#742424] text-white",btnSoftDanger:"bg-[#068DA9] hover:bg-[#F6D7D3] text-[#ECF8F9] border-[#E7B3AE]",btnSoftSuccess:"bg-[#E7F3EC] hover:bg-[#D9EDE3] text-[#1E5A3C] border-[#B9D8C6]",btnSoftAmber:"bg-[#068DA9] hover:bg-[#F7E7C7] text-[#6B3F0A] border-[#E9C997]",th:"text-[11px] font-bold tracking-wide uppercase text-[#6B5E55]",td:"text-[12px] text-[#2B2118]",rowHover:"hover:bg-[#F6EFE6]",zebraA:"bg-[#FFFEFB]",zebraB:"bg-[#FBF7F1]"};function Y3e(t){const s=String(t||"").toLowerCase();return s==="finalized"?"bg-[#E7F3EC] text-[#1E5A3C] border-[#B9D8C6]":s==="cancelled"?"bg-[#FBE9E7] text-[#7A1F1B] border-[#E7B3AE]":"bg-[#FFF3D9] text-[#6B3F0A] border-[#E9C997]"}function X3e(t){const s=String(t||"").toLowerCase();return s==="finalized"?ny:s==="cancelled"?ca:jn}function cL(t){const s=String(t||"").toLowerCase();return s.includes("cash")?I3:s.includes("upi")?EV:s.includes("card")?tN:s.includes("neft")||s.includes("rtgs")||s.includes("bank")?Xa:s.includes("wallet")?Xo:s.includes("refund")?aj:vh}function dL(t){const s=String(t||"").toLowerCase();return s.includes("ipd_bed")?cn:s.includes("ot")?Co:s.includes("pharmacy")?l2:Xn}function no({className:t="",children:s}){return n.jsx("div",{className:lt("rounded-2xl border",Ue.border,Ue.card,Ue.shadowSm,t),children:s})}function Hm({icon:t,title:s,subtitle:r,right:a}){return n.jsxs("div",{className:lt("flex items-center justify-between gap-2 px-4 py-3 border-b",Ue.borderSoft,Ue.soft),children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t?n.jsx("div",{className:lt("h-9 w-9 rounded-xl border bg-white flex items-center justify-center",Ue.borderSoft),children:n.jsx(t,{className:"h-4 w-4 text-[#2B2118]"})}):null,n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] md:text-[14px] font-semibold text-[#2B2118] truncate",children:s}),r?n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:r}):null]})]}),a]})}function ro({icon:t,label:s,value:r,tone:a="slate"}){const i={slate:`border ${Ue.borderSoft} bg-[#FFFEFB] text-[#2B2118]`,emerald:"bg-[#E7F3EC] text-[#1E5A3C] border-[#B9D8C6]",indigo:"bg-[#F6EFE6] text-[#2B2118] border-[#D9CBB8]",rose:"bg-[#FBE9E7] text-[#7A1F1B] border-[#E7B3AE]",amber:"bg-[#FFF3D9] text-[#6B3F0A] border-[#E9C997]"};return n.jsxs("div",{className:lt("inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] font-semibold",i[a]||i.slate),children:[t?n.jsx(t,{className:"h-4 w-4"}):null,n.jsx("span",{className:lt("font-semibold",Ue.muted),children:s}),n.jsx("span",{className:lt("font-bold",Ue.text),children:r})]})}function Fx({icon:t,label:s,value:r,tone:a="slate"}){const i={slate:Ue.card,indigo:"bg-[#F6EFE6]",emerald:"bg-[#E7F3EC]",rose:"bg-[#FBE9E7]",amber:"bg-[#FFF3D9]"},l={slate:Ue.border,indigo:"border-[#D9CBB8]",emerald:"border-[#B9D8C6]",rose:"border-[#E7B3AE]",amber:"border-[#E9C997]"};return n.jsxs("div",{className:lt("rounded-2xl border p-3",l[a]||Ue.border,i[a]||Ue.card,Ue.shadowSm),children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:lt("text-[11px] font-bold tracking-wide uppercase",Ue.muted),children:s}),t?n.jsx("div",{className:lt("h-9 w-9 rounded-xl border bg-white flex items-center justify-center",Ue.borderSoft),children:n.jsx(t,{className:"h-4 w-4 text-[#2B2118]"})}):null]}),n.jsx("div",{className:lt("mt-2 text-[15px] font-semibold",Ue.text),children:r})]})}function sn({variant:t="secondary",icon:s,children:r,className:a="",...i}){const l={primary:lt("border border-[#1F1712]",Ue.btnPrimary),secondary:lt("border",Ue.border,Ue.btnSecondary),danger:lt("border border-[#742424]",Ue.btnDanger),softDanger:lt("border",Ue.btnSoftDanger),softSuccess:lt("border",Ue.btnSoftSuccess),softAmber:lt("border",Ue.btnSoftAmber)};return n.jsxs("button",{...i,className:lt("inline-flex items-center gap-2 rounded-xl px-4 py-2 text-[12px] font-semibold transition shadow-sm whitespace-nowrap",l[t]||l.secondary,"disabled:opacity-60 disabled:cursor-not-allowed",a),children:[s?n.jsx(s,{className:"h-4 w-4"}):null,r]})}function Np({title:t,onClick:s,disabled:r,icon:a,className:i=""}){return n.jsx("button",{type:"button",title:t,onClick:s,disabled:r,className:lt("h-9 w-9 rounded-xl border grid place-items-center shadow-sm transition",Ue.border,Ue.btnSecondary,"disabled:opacity-60 disabled:cursor-not-allowed",i),children:a?n.jsx(a,{className:"h-4 w-4"}):null})}function In({label:t,children:s,hint:r}){return n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:lt("text-[11px] font-bold tracking-wide uppercase",Ue.muted),children:t}),s,r?n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:r}):null]})}function _r({className:t="",...s}){return n.jsx("input",{...s,className:lt("w-full rounded-xl border px-3 py-2 text-xs",Ue.border,"bg-white text-[#2B2118] placeholder:text-[#8A7B70]",Ue.focus,"disabled:bg-[#F6EFE6] disabled:cursor-not-allowed",t)})}function _0({className:t="",children:s,...r}){return n.jsx("select",{...r,className:lt("w-full rounded-xl border px-3 py-2 text-xs",Ue.border,"bg-white text-[#2B2118]",Ue.focus,"disabled:bg-[#F6EFE6] disabled:cursor-not-allowed",t),children:s})}function Q3e({value:t,label:s="Copy"}){return n.jsx(sn,{variant:"secondary",icon:vg,onClick:async()=>{try{await navigator.clipboard.writeText(String(t||"")),ae.success("Copied")}catch{ae.error("Copy failed")}},title:"Copy",children:s})}function S0({open:t,onClick:s}){return n.jsx(sn,{variant:"secondary",icon:t?el:Gn,onClick:s,children:t?"Collapse":"Expand"})}function F1({open:t,title:s,icon:r,onClose:a,children:i,footer:l}){return p.useEffect(()=>{if(!t)return;const o=c=>c.key==="Escape"&&(a==null?void 0:a());return document.addEventListener("keydown",o),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}},[t,a]),n.jsx(on,{children:t?n.jsxs(mt.div,{className:"fixed inset-0 z-[60]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[n.jsx("div",{className:"absolute inset-0 bg-black/45",onClick:a}),n.jsx("div",{className:"absolute inset-0 flex items-end sm:items-center justify-center p-0 sm:p-6",children:n.jsxs(mt.div,{initial:{y:24,opacity:0},animate:{y:0,opacity:1},exit:{y:24,opacity:0},transition:{type:"tween",duration:.16},className:lt("w-full sm:max-w-lg rounded-t-2xl sm:rounded-2xl border shadow-2xl",Ue.border,"bg-[#FFFEFB]"),children:[n.jsxs("div",{className:lt("flex items-center justify-between px-4 sm:px-6 py-3 border-b",Ue.borderSoft,Ue.soft),children:[n.jsxs("div",{className:"flex items-center gap-2",children:[r?n.jsx("div",{className:lt("h-9 w-9 rounded-xl border bg-white flex items-center justify-center",Ue.borderSoft),children:n.jsx(r,{className:"h-4 w-4 text-[#2B2118]"})}):null,n.jsxs("div",{children:[n.jsx("h3",{className:"text-[14px] font-semibold text-[#2B2118]",children:s}),n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:"Press Esc to close"})]})]}),n.jsx(Np,{title:"Close",onClick:a,icon:ts})]}),n.jsx("div",{className:"px-4 sm:px-6 py-4 max-h-[70vh] overflow-auto",children:i}),l?n.jsx("div",{className:lt("px-4 sm:px-6 py-3 border-t",Ue.borderSoft,Ue.soft),children:l}):null]})})]}):null})}function Z3e({open:t,title:s,subtitle:r,onClose:a,children:i,footer:l,width:o="sm:w-[720px]"}){return p.useEffect(()=>{if(!t)return;const c=d=>d.key==="Escape"&&(a==null?void 0:a());return document.addEventListener("keydown",c),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",c),document.body.style.overflow=""}},[t,a]),n.jsx(on,{children:t?n.jsxs(mt.div,{className:"fixed inset-0 z-[55]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[n.jsx("div",{className:"absolute inset-0 bg-black/45",onClick:a}),n.jsxs(mt.div,{className:lt("absolute right-0 top-0 h-full w-full border-l bg-[#FFFEFB] shadow-2xl flex flex-col",o,Ue.border),initial:{x:40,opacity:0},animate:{x:0,opacity:1},exit:{x:40,opacity:0},transition:{type:"tween",duration:.16},children:[n.jsxs("div",{className:lt("p-4 border-b",Ue.borderSoft,Ue.soft,"flex items-center justify-between"),children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-[14px] font-semibold text-[#2B2118]",children:s}),r?n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:r}):null]}),n.jsx(Np,{title:"Close",onClick:a,icon:ts})]}),n.jsx("div",{className:"flex-1 overflow-auto",children:i}),l?n.jsx("div",{className:lt("p-4 border-t",Ue.borderSoft,Ue.soft2),children:l}):null]})]}):null})}function J3e(){var Cs,zn,Rs,gi,wc,$o;const t=Cm(),s=t.invoiceId||t.id,r=Qr(),[a,i]=p.useState(null),[l,o]=p.useState({doctors:[],credit_providers:[],packages:[],payers:[],tpas:[],credit_plans:[]}),[c,d]=p.useState(!0),[u,m]=p.useState(!1),[x,g]=p.useState({}),[y,v]=p.useState(!1),[j,w]=p.useState({description:"",quantity:1,unit_price:"",tax_rate:0,discount_percent:0,discount_amount:""}),[S,E]=p.useState(null),[k,A]=p.useState({description:"",quantity:1,unit_price:"",tax_rate:0,discount_percent:0,discount_amount:""}),[I,P]=p.useState(!1),[O,D]=p.useState("payment"),[T,B]=p.useState({amount:"",mode:"cash",reference_no:"",notes:""}),[U,W]=p.useState(null),[V,R]=p.useState(!1),[F,G]=p.useState(!1),[H,$]=p.useState(""),[K,le]=p.useState(!1),[se,J]=p.useState(""),[ie,te]=p.useState(""),[ne,q]=p.useState(null),[ee,X]=p.useState(!1),[Z,Y]=p.useState(!1),[Q,oe]=p.useState(!1),[_e,xe]=p.useState([]),[me,Re]=p.useState({}),[Ze,$e]=p.useState(!0),[fe,Me]=p.useState(!0),[Ae,Ke]=p.useState(!0),[Le,He]=p.useState(!0),[pt,Pe]=p.useState(!0),[bt,It]=p.useState(""),[De,tt]=p.useState(!1),[ve,Ge]=p.useState(""),[We,Ve]=p.useState({}),[Fe,ot]=p.useState({}),[ft,ce]=p.useState({"#":!0,Description:!0,"Service Ref":!1,Qty:!0,Price:!0,"GST %":!1,Discount:!1,Total:!0,Actions:!0}),[Ce,ze]=p.useState({Mode:!0,Reference:!0,Notes:!1,Time:!0,Amount:!0,Actions:!0}),Te=(a==null?void 0:a.status)==="finalized"||(a==null?void 0:a.status)==="cancelled";p.useEffect(()=>{Nt()},[]),p.useEffect(()=>{s&&je()},[s]);async function Nt(){try{const{data:ye}=await jP();o({doctors:(ye==null?void 0:ye.doctors)||[],credit_providers:(ye==null?void 0:ye.credit_providers)||[],packages:(ye==null?void 0:ye.packages)||[],payers:(ye==null?void 0:ye.payers)||[],tpas:(ye==null?void 0:ye.tpas)||[],credit_plans:(ye==null?void 0:ye.credit_plans)||[]})}catch(ye){console.error("Failed to load masters",ye)}}async function Jt(ye){if(ye){X(!0);try{const{data:at}=await V3e(ye);q(at)}catch(at){console.error("Failed to load patient billing summary",at)}finally{X(!1)}}}async function ke(ye){if(ye){R(!0);try{const{data:at}=await TY(ye);W(at||null)}catch(at){console.error("Failed to load wallet summary",at),W(null)}finally{R(!1)}}}async function je(){d(!0),te("");try{const{data:ye}=await D3e(s);i(ye),g({billing_type:ye.billing_type||"general",consultant_id:ye.consultant_id||"",provider_id:ye.provider_id||"",visit_no:ye.visit_no||"",remarks:ye.remarks||"",header_discount_percent:ye.header_discount_percent??"",header_discount_amount:ye.header_discount_amount??"",discount_remarks:ye.discount_remarks||""}),await Promise.all([Jt(ye.patient_id),ke(ye.patient_id)])}catch(ye){console.error("Failed to load invoice",ye),te("Unable to load invoice. Please go back and try again.")}finally{d(!1)}}async function ht(ye){const at=ye==null?void 0:ye.data;if(at&&typeof at=="object"&&(at.id||at.items||at.payments)){i(at),at.patient_id&&(Jt(at.patient_id),ke(at.patient_id));return}await je()}function At(ye){const{name:at,value:Oe}=ye.target;g(be=>({...be,[at]:Oe}))}async function ms(){if(a){m(!0),te("");try{const ye={billing_type:x.billing_type||null,consultant_id:x.consultant_id?Number(x.consultant_id):null,provider_id:x.provider_id?Number(x.provider_id):null,visit_no:x.visit_no||null,remarks:x.remarks||null,header_discount_percent:x.header_discount_percent!==""&&x.header_discount_percent!==null?Number(x.header_discount_percent):null,header_discount_amount:x.header_discount_amount!==""&&x.header_discount_amount!==null?Number(x.header_discount_amount):null,discount_remarks:x.discount_remarks||null},at=await I3e(a.id,ye);await ht(at);const Oe=at!=null&&at.data&&at.data.id?at.data:null;Oe&&g(be=>({...be,header_discount_percent:Oe.header_discount_percent??"",header_discount_amount:Oe.header_discount_amount??""})),ae.success("Header saved")}catch(ye){console.error("Save header failed",ye),te("Unable to save header details."),ae.error("Header save failed")}finally{m(!1)}}}function Zt(ye){const{name:at,value:Oe}=ye.target;w(be=>({...be,[at]:at==="quantity"||at==="tax_rate"||at==="discount_percent"?Number(Oe):Oe}))}async function hs(ye){if(ye.preventDefault(),!!a){te("");try{const at={description:j.description||"",quantity:j.quantity||1,unit_price:Number(j.unit_price||0),tax_rate:Number(j.tax_rate||0),discount_percent:Number(j.discount_percent||0),discount_amount:j.discount_amount!==""?Number(j.discount_amount||0):void 0},Oe=await oL(a.id,at);await ht(Oe),v(!1),w({description:"",quantity:1,unit_price:"",tax_rate:0,discount_percent:0,discount_amount:""}),ae.success("Item added")}catch(at){console.error("Add manual item failed",at),te("Unable to add manual item. Please check values."),ae.error("Add item failed")}}}function Is(ye){E(ye.id),A({description:ye.description||"",quantity:ye.quantity||1,unit_price:String(ye.unit_price||""),tax_rate:Number(ye.tax_rate||0),discount_percent:Number(ye.discount_percent||0),discount_amount:ye.discount_amount!==null&&ye.discount_amount!==void 0?String(ye.discount_amount):""})}function _s(ye){const{name:at,value:Oe}=ye.target;A(be=>({...be,[at]:at==="quantity"||at==="tax_rate"||at==="discount_percent"?Number(Oe):Oe}))}async function Sn(ye){if(ye.preventDefault(),!(!a||!S)){te("");try{const at={description:k.description||"",quantity:k.quantity||1,unit_price:Number(k.unit_price||0),tax_rate:Number(k.tax_rate||0),discount_percent:Number(k.discount_percent||0),discount_amount:k.discount_amount!==""?Number(k.discount_amount||0):void 0},Oe=await L3e(a.id,S,at);await ht(Oe),E(null),ae.success("Item updated")}catch(at){console.error("Update item failed",at),te("Unable to update item."),ae.error("Update failed")}}}async function tn(ye){if(!a)return;const at=window.prompt("Void reason (required):","Voided from UI");if(!(!at||!at.trim())){te("");try{const Oe=await F3e(a.id,ye.id,{reason:at.trim()});await ht(Oe),ae.success("Item voided")}catch(Oe){console.error("Void item failed",Oe),te("Unable to void item."),ae.error("Void failed")}}}function Ts(ye){const{name:at,value:Oe}=ye.target;B(be=>({...be,[at]:Oe}))}function Cn(ye){D(ye),B(at=>({...at,mode:ye==="refund"?"refund":"cash"})),P(!0)}async function Pt(ye){if(ye.preventDefault(),!!a){te("");try{let at=Number(T.amount||0);if(!at||at<=0){te("Amount must be greater than 0.");return}O==="refund"&&(at=-Math.abs(at));const Oe={amount:at,mode:O==="refund"?T.mode||"refund":T.mode,reference_no:T.reference_no||null,notes:T.notes||null},be=await z3e(a.id,Oe);await ht(be),P(!1),D("payment"),B({amount:"",mode:"cash",reference_no:"",notes:""}),ae.success(O==="refund"?"Refund saved":"Payment saved")}catch(at){console.error("Add payment/refund failed",at),te("Unable to save payment / refund."),ae.error("Save failed")}}}async function Ea(ye){if(!(!a||!window.confirm("Delete this entry?"))){te("");try{await U3e(a.id,ye.id),await je(),ae.success("Deleted")}catch(Oe){console.error("Delete failed",Oe),te("Unable to delete."),ae.error("Delete failed")}}}async function Rr(ye){if(ye.preventDefault(),!a)return;const at=Number((U==null?void 0:U.available_advance)??(U==null?void 0:U.available)??0),Oe=Number(H||0);if(!Oe||Oe<=0)return te("Enter a valid amount to apply.");if(Oe>at)return te("Apply amount cannot exceed available deposit.");if(Oe>Number(a.balance_due||0))return te("Apply amount cannot exceed invoice balance due.");if(window.confirm(`Use  ${Ys(Oe)} from patient Advance/Deposit for this invoice?`)){le(!0),te("");try{const $t=await K3e(a.id,{amount:Oe});G(!1),await ht($t),ae.success("Deposit applied")}catch($t){console.error("Wallet apply failed",$t),te("Unable to apply advance/deposit to this invoice."),ae.error("Apply failed")}finally{le(!1)}}}async function Jn(){if(!(!a||!window.confirm("Finalize this invoice? You cannot edit items later."))){J("finalize"),te("");try{const at=await O3e(a.id);await ht(at),ae.success("Invoice finalized")}catch(at){console.error("Finalize failed",at),te("Unable to finalize invoice."),ae.error("Finalize failed")}finally{J("")}}}async function Zl(){if(!(!a||!window.confirm("Cancel this invoice?"))){J("cancel"),te("");try{await R3e(a.id),await je(),ae.success("Invoice cancelled")}catch(at){console.error("Cancel failed",at),te("Unable to cancel invoice."),ae.error("Cancel failed")}finally{J("")}}}async function Fi(){var ye;if(a)try{const at=await H3e(a.id),Oe=new Blob([at.data],{type:((ye=at.headers)==null?void 0:ye["content-type"])||"application/pdf"}),be=URL.createObjectURL(Oe);window.open(be,"_blank","noopener"),setTimeout(()=>URL.revokeObjectURL(be),5e3)}catch(at){console.error("Print failed",at),te("Unable to open invoice print view."),ae.error("Print failed")}}async function Jl(){var ye;if(a)try{const at=await W3e(a.patient_id),Oe=new Blob([at.data],{type:((ye=at.headers)==null?void 0:ye["content-type"])||"application/pdf"}),be=URL.createObjectURL(Oe);window.open(be,"_blank","noopener"),setTimeout(()=>URL.revokeObjectURL(be),5e3)}catch(at){console.error("Patient summary print failed",at),te("Unable to open patient billing summary."),ae.error("Open failed")}}function Nr(ye){if(!a||!ye)return;const at=l.packages.find(be=>String(be.id)===String(ye));if(!at)return;const Oe={description:`Package: ${at.name}`,quantity:1,unit_price:Number(at.charges||0),tax_rate:0,discount_percent:0};oL(a.id,Oe).then(be=>ht(be)).then(()=>ae.success("Package charge added")).catch(be=>{console.error("Add package charge failed",be),te("Unable to add package charge."),ae.error("Add failed")})}async function xu(){if(a){Y(!0),Re({}),oe(!0),te("");try{const{data:ye}=await B3e(a.id);xe(ye||[])}catch(ye){console.error(ye),te("Unable to load unbilled services."),ae.error("Load failed")}finally{oe(!1)}}}function pu(ye){Re(at=>({...at,[ye]:!at[ye]}))}async function Ta(){if(!a)return;const ye=Object.keys(me).filter(at=>me[at]);if(ye.length!==0){J("unbilled"),te("");try{await $3e(a.id,{uids:ye}),Y(!1),await je(),ae.success("Added unbilled services")}catch(at){console.error(at),te("Unable to add unbilled services."),ae.error("Add failed")}finally{J("")}}}const Pn=(a==null?void 0:a.items)||[],Os=(a==null?void 0:a.payments)||[],bl=p.useMemo(()=>Os.filter(ye=>Number(ye.amount||0)>=0),[Os]),Za=p.useMemo(()=>Os.filter(ye=>Number(ye.amount||0)<0),[Os]),Bo=p.useMemo(()=>Za.reduce((ye,at)=>ye+Math.abs(Number(at.amount||0)),0),[Za]),yt=p.useMemo(()=>bl.reduce((ye,at)=>ye+Number(at.amount||0),0),[bl]),yl=Number((U==null?void 0:U.available_advance)??(U==null?void 0:U.available)??0),ln=Number((a==null?void 0:a.advance_adjusted)||0),wr=Array.isArray(a==null?void 0:a.advance_adjustments)?a.advance_adjustments:null,Nc=l.packages||[],Ss=p.useMemo(()=>{const ye=bt.trim().toLowerCase();return(Pn||[]).filter(at=>!De&&at.is_voided?!1:ye?`${at.description||""} ${at.service_type||""} ${at.service_ref_id||""}`.toLowerCase().includes(ye):!0)},[Pn,bt,De]),bs=p.useMemo(()=>{const ye=ve.trim().toLowerCase();return ye?(Os||[]).filter(at=>`${at.mode||""} ${at.reference_no||""} ${at.notes||""} ${Lx(at.paid_at)}`.toLowerCase().includes(ye)):Os||[]},[Os,ve]),vs=p.useMemo(()=>1+Object.values(ft).filter(Boolean).length,[ft]),Ne=p.useMemo(()=>1+Object.values(Ce).filter(Boolean).length,[Ce]),ut="max-w-[96rem] mx-auto",Ft=`Invoice #${(a==null?void 0:a.invoice_number)||(a==null?void 0:a.id)||""}`;if(c)return n.jsx("div",{className:lt("min-h-[calc(100vh-4rem)] px-3 md:px-6 py-8",Ue.page),children:n.jsxs("div",{className:lt(ut,"flex items-center gap-2 text-xs",Ue.muted),children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Loading invoice"]})});if(!a)return n.jsx("div",{className:lt("min-h-[calc(100vh-4rem)] px-3 md:px-6 py-8",Ue.page),children:n.jsxs("div",{className:ut,children:[n.jsx(no,{className:"p-4 border-[#E7B3AE] bg-[#FBE9E7]",children:n.jsxs("div",{className:"text-xs text-[#7A1F1B] flex items-start gap-2",children:[n.jsx(nb,{className:"h-4 w-4 mt-0.5"}),n.jsx("div",{children:ie||"Invoice not found."})]})}),n.jsx("div",{className:"mt-4",children:n.jsx(sn,{variant:"secondary",icon:Hl,onClick:()=>r("/billing"),children:"Back to Billing Console"})})]})});const Vt=X3e(a.status);return n.jsxs("div",{className:lt("min-h-[calc(100vh-4rem)]",Ue.page),children:[n.jsx("div",{className:lt("sticky top-0 z-40 border-b",Ue.border,"bg-[#FBF7F1]"),children:n.jsxs("div",{className:lt(ut,"px-3 md:px-6 py-3 flex items-center justify-between gap-3"),children:[n.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[n.jsx(sn,{variant:"secondary",icon:Hl,onClick:()=>r("/billing"),children:"Billing"}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("h3",{className:"text-[15px] md:text-[16px] font-semibold text-[#2B2118] truncate",children:Ft}),n.jsxs("span",{className:lt("inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] font-bold",Y3e(a.status)),children:[n.jsx(Vt,{className:"h-4 w-4"}),String(a.status||"").toUpperCase()]})]}),n.jsxs("div",{className:lt("mt-1 flex flex-wrap gap-3 text-[11px]",Ue.muted),children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),Lx(a.created_at)]}),n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(jo,{className:"h-3.5 w-3.5"}),"Patient #",a.patient_id]})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[n.jsx(sn,{variant:"secondary",icon:Co,onClick:xu,children:"Unbilled"}),n.jsx(sn,{variant:"secondary",icon:Ll,onClick:Fi,children:"Print"}),n.jsx(Q3e,{value:a.invoice_number||a.id,label:"Copy ID"})]})]})}),n.jsxs("div",{className:lt(ut,"px-3 md:px-6 py-4 space-y-4"),children:[ie?n.jsx(no,{className:"p-4 border-[#E7B3AE] bg-[#FBE9E7]",children:n.jsxs("div",{className:"text-xs text-[#7A1F1B] flex items-start gap-2",children:[n.jsx(nb,{className:"h-4 w-4 mt-0.5"}),n.jsx("div",{children:ie})]})}):null,n.jsxs(no,{children:[n.jsx(Hm,{icon:vh,title:"Patient & Totals",subtitle:"Billing summary for current invoice",right:n.jsx(S0,{open:Ze,onClick:()=>$e(ye=>!ye)})}),Ze?n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"space-y-2 min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(ro,{icon:jo,label:"Patient ID",value:`#${a.patient_id}`}),(Cs=ne==null?void 0:ne.patient)!=null&&Cs.uhid?n.jsx(ro,{icon:Xn,label:"UHID",value:ne.patient.uhid,tone:"indigo"}):null,(zn=ne==null?void 0:ne.patient)!=null&&zn.phone?n.jsx(ro,{icon:EV,label:"Phone",value:ne.patient.phone}):null]}),(Rs=ne==null?void 0:ne.patient)!=null&&Rs.name?n.jsx("div",{className:"text-[12px] text-[#2B2118] truncate",children:ne.patient.name}):null]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-start lg:justify-end gap-2",children:[n.jsx(ro,{icon:rC,label:"Total Outstanding",value:` ${Ys((ne==null?void 0:ne.total_outstanding)??((gi=ne==null?void 0:ne.totals)==null?void 0:gi.balance_due)??a.balance_due??0)}`,tone:"rose"}),n.jsx(ro,{icon:Xo,label:"Deposit Available",value:` ${V?"":Ys(yl)}`,tone:"emerald"}),n.jsx(sn,{variant:"secondary",icon:aC,onClick:()=>r(`/billing/advance?patient_id=${a.patient_id}`),title:"Open patient deposit page",children:"Add Deposit"}),n.jsx(sn,{variant:"softSuccess",icon:Xo,onClick:()=>G(!0),disabled:yl<=0||Te,title:"Use patient deposit (advance) for this invoice",children:"Use Deposit"}),n.jsx(sn,{variant:"secondary",icon:kV,onClick:Jl,disabled:ee,children:ee?"Loading":"Credit Summary PDF"})]})]}),n.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-3",children:[n.jsx(Fx,{icon:vh,label:"Gross",value:` ${Ys(a.gross_total)}`}),n.jsx(Fx,{icon:Xn,label:"Tax",value:` ${Ys(a.tax_total)}`}),n.jsx(Fx,{icon:Xt,label:"Net",value:` ${Ys(a.net_total)}`,tone:"indigo"}),n.jsx(Fx,{icon:rC,label:"Balance Due",value:` ${Ys(a.balance_due)}`,tone:"rose"})]})]}):n.jsxs("div",{className:lt("p-4 text-xs flex items-start gap-2",Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"Summary is collapsed."]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[n.jsxs("div",{className:"lg:col-span-5 space-y-4",children:[n.jsxs(no,{children:[n.jsx(Hm,{icon:vh,title:"Invoice Header",subtitle:"Billing type, consultant, credit provider, remarks",right:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(S0,{open:fe,onClick:()=>Me(ye=>!ye)}),Te?n.jsx("span",{className:lt("text-[12px] font-semibold",Ue.muted),children:"Locked"}):n.jsx(sn,{variant:"primary",icon:u?Rt:Xt,onClick:ms,disabled:u,children:u?"Saving":"Save"})]})}),fe?n.jsxs("div",{className:"p-4 space-y-3",children:[n.jsx(In,{label:"Billing Type",children:n.jsxs(_0,{name:"billing_type",value:x.billing_type,onChange:At,disabled:Te,children:[n.jsx("option",{value:"op_billing",children:"OP Billing"}),n.jsx("option",{value:"ip_billing",children:"IP Billing"}),n.jsx("option",{value:"ot",children:"OT"}),n.jsx("option",{value:"lab",children:"Lab"}),n.jsx("option",{value:"pharmacy",children:"Pharmacy"}),n.jsx("option",{value:"radiology",children:"Radiology"}),n.jsx("option",{value:"general",children:"General"})]})}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsx(In,{label:"Consultant",children:n.jsxs(_0,{name:"consultant_id",value:x.consultant_id,onChange:At,disabled:Te,children:[n.jsx("option",{value:"",children:"None"}),(wc=l.doctors)==null?void 0:wc.map(ye=>n.jsx("option",{value:ye.id,children:ye.name||`Doctor #${ye.id}`},ye.id))]})}),n.jsx(In,{label:"Credit Provider",children:n.jsxs(_0,{name:"provider_id",value:x.provider_id,onChange:At,disabled:Te,children:[n.jsx("option",{value:"",children:"Self pay"}),($o=l.credit_providers)==null?void 0:$o.map(ye=>n.jsx("option",{value:ye.id,children:ye.display_name||ye.name||ye.code||`Provider #${ye.id}`},ye.id))]})})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsx(In,{label:"Visit No",children:n.jsx(_r,{type:"text",name:"visit_no",value:x.visit_no,onChange:At,disabled:Te})}),n.jsx(In,{label:"Remarks",children:n.jsx(_r,{type:"text",name:"remarks",value:x.remarks,onChange:At,disabled:Te})})]}),n.jsxs(no,{className:"shadow-none",children:[n.jsx(Hm,{icon:Qi,title:"Header Discount",subtitle:"Optional discount at invoice header"}),n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsx(In,{label:"Discount %",children:n.jsx(_r,{type:"number",name:"header_discount_percent",value:x.header_discount_percent,onChange:At,disabled:Te,step:"0.1"})}),n.jsx(In,{label:"Discount Amount",children:n.jsx(_r,{type:"number",name:"header_discount_amount",value:x.header_discount_amount,onChange:At,disabled:Te,step:"0.01"})})]}),n.jsx("div",{className:"mt-3",children:n.jsx(In,{label:"Discount Remarks",children:n.jsx(_r,{type:"text",name:"discount_remarks",value:x.discount_remarks,onChange:At,disabled:Te})})})]})]}),Nc.length>0?n.jsxs(no,{className:"shadow-none",children:[n.jsx(Hm,{icon:l2,title:"Package Billing (IPD)",subtitle:"Quick add a package charge to this invoice"}),n.jsx("div",{className:"p-4",children:n.jsxs(_0,{onChange:ye=>Nr(ye.target.value),disabled:Te,defaultValue:"",children:[n.jsx("option",{value:"",children:"Select package"}),Nc.map(ye=>n.jsxs("option",{value:ye.id,children:[ye.name,"   ",Ys(ye.charges)]},ye.id))]})})]}):null]}):n.jsxs("div",{className:lt("p-4 text-xs flex items-start gap-2",Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"Header collapsed."]})]}),n.jsxs(no,{children:[n.jsx(Hm,{icon:Xo,title:"Deposit Adjustments",subtitle:"Advance / Deposit usage in this invoice",right:n.jsx(S0,{open:Ae,onClick:()=>Ke(ye=>!ye)})}),Ae?n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(Fx,{icon:Xo,label:"Deposit Available",value:` ${V?"":Ys(yl)}`,tone:"emerald"}),n.jsx(Fx,{icon:Xo,label:"Deposit Used",value:` ${Ys(ln)}`,tone:"indigo"})]}),n.jsxs("div",{className:lt("mt-3 rounded-2xl border p-3",Ue.border,Ue.soft2),children:[n.jsxs("div",{className:lt("text-[11px] font-bold tracking-wide uppercase flex items-center gap-2",Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4"}),"Adjustment rows (optional)"]}),n.jsx("div",{className:"mt-2",children:wr?wr.length===0?n.jsx("div",{className:lt("text-[12px]",Ue.muted),children:"No adjustment rows."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:lt("w-full min-w-[520px] text-xs border border-collapse table-fixed",Ue.border),children:[n.jsx("thead",{className:lt(Ue.soft,"border-b",Ue.border),children:n.jsxs("tr",{children:[n.jsx("th",{className:lt("px-3 py-2 text-left w-[140px]",Ue.th),children:"Advance ID"}),n.jsx("th",{className:lt("px-3 py-2 text-left",Ue.th),children:"Applied At"}),n.jsx("th",{className:lt("px-3 py-2 text-right w-[140px]",Ue.th),children:"Amount"})]})}),n.jsx("tbody",{children:wr.map((ye,at)=>n.jsxs("tr",{className:lt(at%2?Ue.zebraB:Ue.zebraA,"border-b",Ue.borderSoft),children:[n.jsxs("td",{className:lt("px-3 py-2",Ue.td),children:["#",ye.advance_id]}),n.jsx("td",{className:lt("px-3 py-2",Ue.td),children:Lx(ye.applied_at)}),n.jsxs("td",{className:lt("px-3 py-2 text-right font-semibold",Ue.text),children:[" ",Ys(ye.amount_applied)]})]},ye.id||`${ye.advance_id}-${ye.applied_at}-${at}`))})]})}):n.jsxs("div",{className:lt("rounded-xl border p-3 text-[12px]",Ue.border,Ue.card),children:["Total adjusted: ",n.jsxs("span",{className:"font-semibold text-[#2B2118]",children:[" ",Ys(ln)]})]})})]})]}):n.jsxs("div",{className:lt("p-4 text-xs flex items-start gap-2",Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"Deposit section collapsed."]})]})]}),n.jsxs("div",{className:"lg:col-span-7 space-y-4",children:[n.jsxs(no,{children:[n.jsx(Hm,{icon:Xn,title:"Items",subtitle:"Services and manual items billed in this invoice",right:n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[n.jsx(S0,{open:Le,onClick:()=>He(ye=>!ye)}),Te?n.jsx("span",{className:lt("text-[12px] font-semibold",Ue.muted),children:"Locked"}):n.jsx(sn,{variant:"primary",icon:ds,onClick:()=>v(!0),children:"Add Manual"})]})}),Le?n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 mb-3",children:[n.jsxs("div",{className:lt("flex-1 rounded-xl border px-3 py-2 flex items-center gap-2",Ue.border,Ue.card),children:[n.jsx(Yt,{className:"h-4 w-4 text-[#6B5E55]"}),n.jsx("input",{value:bt,onChange:ye=>It(ye.target.value),className:"bg-transparent outline-none text-xs w-full text-[#2B2118] placeholder:text-[#8A7B70]",placeholder:"Search items by description / service / ref"})]}),n.jsx(sn,{variant:De?"softDanger":"secondary",onClick:()=>tt(ye=>!ye),title:"Toggle voided",children:De?"Showing Voided":"Hide Voided"})]}),Ss.length===0?n.jsxs("div",{className:lt("rounded-2xl border p-4 text-xs flex items-start gap-2",Ue.border,Ue.soft2,Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),Pn.length===0?"No items added yet.":"No items match your search / filter."]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:lt("w-full min-w-[980px] text-xs border border-collapse table-fixed",Ue.border),children:[n.jsx("thead",{className:lt(Ue.soft,"border-b",Ue.border),children:n.jsxs("tr",{children:[n.jsx("th",{className:"w-[44px] px-2 py-2"}),ft["#"]?n.jsx("th",{className:lt("w-[56px] px-2 py-2 text-left",Ue.th),children:"#"}):null,ft.Description?n.jsx("th",{className:lt("px-2 py-2 text-left w-[42%] min-w-[360px]",Ue.th),children:"Description"}):null,ft["Service Ref"]?n.jsx("th",{className:lt("px-2 py-2 text-left w-[190px]",Ue.th),children:"Service Ref"}):null,ft.Qty?n.jsx("th",{className:lt("w-[70px] px-2 py-2 text-right",Ue.th),children:"Qty"}):null,ft.Price?n.jsx("th",{className:lt("w-[120px] px-2 py-2 text-right",Ue.th),children:"Price"}):null,ft["GST %"]?n.jsx("th",{className:lt("w-[80px] px-2 py-2 text-right",Ue.th),children:"GST %"}):null,ft.Discount?n.jsx("th",{className:lt("w-[150px] px-2 py-2 text-right",Ue.th),children:"Discount"}):null,ft.Total?n.jsx("th",{className:lt("w-[140px] px-2 py-2 text-right",Ue.th),children:"Total"}):null,ft.Actions?n.jsx("th",{className:lt("w-[220px] px-2 py-2 text-right",Ue.th),children:"Actions"}):null]})}),n.jsx("tbody",{children:Ss.map((ye,at)=>{const Oe=dL(ye.service_type),be=!!We[ye.id],$t=at%2?Ue.zebraB:Ue.zebraA;return n.jsxs(p.Fragment,{children:[n.jsxs("tr",{className:lt($t,Ue.rowHover,"border-b",Ue.borderSoft,ye.is_voided&&"opacity-70"),children:[n.jsx("td",{className:"px-2 py-2 align-middle",children:n.jsx(Np,{title:"Expand row",onClick:()=>Ve(bn=>({...bn,[ye.id]:!bn[ye.id]})),icon:be?el:Gn})}),ft["#"]?n.jsx("td",{className:lt("px-2 py-2 align-middle",Ue.muted),children:at+1}):null,ft.Description?n.jsx("td",{className:"px-2 py-2 align-middle",children:n.jsxs("div",{className:"flex items-start gap-2 min-w-0",children:[n.jsx("div",{className:lt("mt-0.5 rounded-xl border bg-white p-1.5",Ue.borderSoft),children:n.jsx(Oe,{className:"h-4 w-4 text-[#2B2118]"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-[#2B2118] truncate",children:ye.description}),n.jsxs("div",{className:lt("text-[11px] flex flex-wrap items-center gap-2",Ue.muted),children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(jo,{className:"h-3 w-3"}),ye.service_type||""," / ",ye.service_ref_id??""]}),ye.is_voided?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] font-bold bg-[#FBE9E7] text-[#7A1F1B] border-[#E7B3AE]",children:[n.jsx(ca,{className:"h-3 w-3"}),"VOID"]}):null]})]})]})}):null,ft["Service Ref"]?n.jsxs("td",{className:lt("px-2 py-2 align-middle",Ue.td),children:[n.jsxs("div",{className:"text-[11px] truncate",children:["Type: ",ye.service_type||""]}),n.jsxs("div",{className:"text-[11px] truncate",children:["Ref: ",ye.service_ref_id??""]})]}):null,ft.Qty?n.jsx("td",{className:lt("px-2 py-2 text-right align-middle",Ue.td),children:ye.quantity}):null,ft.Price?n.jsx("td",{className:lt("px-2 py-2 text-right align-middle tabular-nums",Ue.td),children:Ys(ye.unit_price)}):null,ft["GST %"]?n.jsxs("td",{className:lt("px-2 py-2 text-right align-middle tabular-nums",Ue.td),children:[Number(ye.tax_rate||0),"%"]}):null,ft.Discount?n.jsxs("td",{className:lt("px-2 py-2 text-right align-middle tabular-nums",Ue.td),children:[ye.discount_percent?`${Number(ye.discount_percent)}%`:"",ye.discount_amount?` /  ${Ys(ye.discount_amount)}`:""]}):null,ft.Total?n.jsxs("td",{className:lt("px-2 py-2 text-right align-middle font-bold tabular-nums",Ue.text),children:[" ",Ys(ye.line_total)]}):null,ft.Actions?n.jsx("td",{className:"px-2 py-2 text-right align-middle",children:Te?null:n.jsxs("div",{className:"inline-flex justify-end gap-2",children:[n.jsx(sn,{variant:"secondary",icon:Yr,onClick:()=>Is(ye),children:"Edit"}),n.jsx(sn,{variant:"softDanger",icon:ca,onClick:()=>tn(ye),children:"Void"})]})}):null]}),be?n.jsx("tr",{className:lt(Ue.soft2,"border-b",Ue.borderSoft),children:n.jsxs("td",{colSpan:vs,className:"px-3 py-3",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-2 text-[11px]",children:[n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"Qty"}),n.jsx("div",{className:"font-semibold text-[#2B2118]",children:ye.quantity})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"Unit Price"}),n.jsxs("div",{className:"font-semibold text-[#2B2118]",children:[" ",Ys(ye.unit_price)]})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"GST"}),n.jsxs("div",{className:"font-semibold text-[#2B2118]",children:[Number(ye.tax_rate||0),"%"]})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"Discount"}),n.jsxs("div",{className:"font-semibold text-[#2B2118]",children:[ye.discount_percent?`${Number(ye.discount_percent)}%`:"",ye.discount_amount?` /  ${Ys(ye.discount_amount)}`:""]})]})]}),n.jsxs("div",{className:lt("mt-2 text-[11px]",Ue.muted),children:["Service: ",n.jsx("span",{className:"font-semibold text-[#2B2118]",children:ye.service_type||""})," "," Ref: ",n.jsx("span",{className:"font-semibold text-[#2B2118]",children:ye.service_ref_id??""})," "," Line Total: ",n.jsxs("span",{className:"font-bold text-[#2B2118]",children:[" ",Ys(ye.line_total)]})]})]})}):null]},ye.id)})})]})}),n.jsx("div",{className:"md:hidden space-y-3",children:Ss.map(ye=>{const at=dL(ye.service_type),Oe=!!We[ye.id];return n.jsxs(no,{className:lt("p-3",ye.is_voided&&"opacity-70"),children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-start gap-2 min-w-0",children:[n.jsx("div",{className:lt("mt-0.5 rounded-xl border bg-white p-2",Ue.borderSoft),children:n.jsx(at,{className:"h-4 w-4 text-[#2B2118]"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold text-[#2B2118] truncate",children:ye.description}),n.jsxs("div",{className:lt("mt-1 text-[11px] flex flex-wrap gap-2",Ue.muted),children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(jo,{className:"h-3.5 w-3.5"}),ye.service_type," / ",ye.service_ref_id]}),ye.is_voided?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] font-bold bg-[#FBE9E7] text-[#7A1F1B] border-[#E7B3AE]",children:[n.jsx(ca,{className:"h-3.5 w-3.5"}),"VOID"]}):null]})]})]}),n.jsx(Np,{title:"Expand",onClick:()=>Ve(be=>({...be,[ye.id]:!be[ye.id]})),icon:Oe?el:Gn})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:"Line Total"}),n.jsxs("div",{className:"text-[14px] font-bold text-[#2B2118]",children:[" ",Ys(ye.line_total)]})]}),Oe?n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-[11px]",children:[n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.soft2),children:[n.jsx("div",{className:Ue.muted,children:"Qty"}),n.jsx("div",{className:"font-semibold text-[#2B2118]",children:ye.quantity})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.soft2),children:[n.jsx("div",{className:Ue.muted,children:"Unit Price"}),n.jsxs("div",{className:"font-semibold text-[#2B2118]",children:[" ",Ys(ye.unit_price)]})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.soft2),children:[n.jsx("div",{className:Ue.muted,children:"GST"}),n.jsxs("div",{className:"font-semibold text-[#2B2118]",children:[Number(ye.tax_rate||0),"%"]})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.soft2),children:[n.jsx("div",{className:Ue.muted,children:"Discount"}),n.jsxs("div",{className:"font-semibold text-[#2B2118]",children:[ye.discount_percent?`${Number(ye.discount_percent)}%`:"",ye.discount_amount?` /  ${Ys(ye.discount_amount)}`:""]})]})]}):null,Te?null:n.jsxs("div",{className:"mt-3 flex gap-2 justify-end",children:[n.jsx(sn,{variant:"secondary",icon:Yr,onClick:()=>Is(ye),children:"Edit"}),n.jsx(sn,{variant:"softDanger",icon:ca,onClick:()=>tn(ye),children:"Void"})]})]},ye.id)})})]})]}):n.jsxs("div",{className:lt("p-4 text-xs flex items-start gap-2",Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"Items section collapsed."]})]}),n.jsxs(no,{children:[n.jsx(Hm,{icon:tN,title:"Payments & Refunds",subtitle:"Receipts and refunds recorded for this invoice",right:n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[n.jsx(S0,{open:pt,onClick:()=>Pe(ye=>!ye)}),Te?n.jsx("span",{className:lt("text-[12px] font-semibold",Ue.muted),children:"Locked"}):n.jsxs(n.Fragment,{children:[n.jsx(sn,{variant:"softDanger",icon:aj,onClick:()=>Cn("refund"),children:"Add Refund"}),n.jsx(sn,{variant:"primary",icon:aC,onClick:()=>Cn("payment"),children:"Add Payment"})]})]})}),pt?n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[n.jsx(ro,{icon:I3,label:"Payments",value:` ${Ys(yt)}`,tone:"emerald"}),n.jsx(ro,{icon:aj,label:"Refunds",value:` ${Ys(Bo)}`,tone:"rose"}),n.jsx(ro,{icon:Xo,label:"Deposit Used",value:` ${Ys(ln)}`,tone:"indigo"})]}),n.jsxs("div",{className:lt("rounded-xl border px-3 py-2 flex items-center gap-2 mb-3",Ue.border,Ue.card),children:[n.jsx(Yt,{className:"h-4 w-4 text-[#6B5E55]"}),n.jsx("input",{value:ve,onChange:ye=>Ge(ye.target.value),className:"bg-transparent outline-none text-xs w-full text-[#2B2118] placeholder:text-[#8A7B70]",placeholder:"Search payments by mode / reference / notes"})]}),n.jsx("div",{className:"hidden md:block overflow-x-auto",children:bs.length===0?n.jsxs("div",{className:lt("rounded-2xl border p-4 text-xs flex items-start gap-2",Ue.border,Ue.soft2,Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"No entries (or nothing matches search)."]}):n.jsxs("table",{className:lt("w-full min-w-[860px] text-xs border border-collapse table-fixed",Ue.border),children:[n.jsx("thead",{className:lt(Ue.soft,"border-b",Ue.border),children:n.jsxs("tr",{children:[n.jsx("th",{className:"w-[44px] px-2 py-2"}),Ce.Mode?n.jsx("th",{className:lt("px-2 py-2 text-left w-[190px]",Ue.th),children:"Mode"}):null,Ce.Reference?n.jsx("th",{className:lt("px-2 py-2 text-left w-[190px]",Ue.th),children:"Reference"}):null,Ce.Notes?n.jsx("th",{className:lt("px-2 py-2 text-left",Ue.th),children:"Notes"}):null,Ce.Time?n.jsx("th",{className:lt("px-2 py-2 text-left w-[190px]",Ue.th),children:"Time"}):null,Ce.Amount?n.jsx("th",{className:lt("w-[140px] px-2 py-2 text-right",Ue.th),children:"Amount"}):null,Ce.Actions?n.jsx("th",{className:lt("w-[170px] px-2 py-2 text-right",Ue.th),children:"Actions"}):null]})}),n.jsx("tbody",{children:bs.map((ye,at)=>{const Oe=cL(ye.mode),be=Number(ye.amount||0)<0,$t=!!Fe[ye.id],bn=at%2?Ue.zebraB:Ue.zebraA;return n.jsxs(p.Fragment,{children:[n.jsxs("tr",{className:lt(bn,Ue.rowHover,"border-b",Ue.borderSoft),children:[n.jsx("td",{className:"px-2 py-2 align-middle",children:n.jsx(Np,{title:"Expand row",onClick:()=>ot(er=>({...er,[ye.id]:!er[ye.id]})),icon:$t?el:Gn})}),Ce.Mode?n.jsx("td",{className:lt("px-2 py-2 font-semibold align-middle",Ue.text),children:n.jsxs("span",{className:"inline-flex items-center gap-2 min-w-0",children:[n.jsx("span",{className:lt("rounded-xl border bg-white p-1.5",Ue.borderSoft),children:n.jsx(Oe,{className:"h-4 w-4 text-[#2B2118]"})}),n.jsx("span",{className:"truncate",children:ye.mode||""})]})}):null,Ce.Reference?n.jsx("td",{className:lt("px-2 py-2 align-middle truncate",Ue.td),children:ye.reference_no||""}):null,Ce.Notes?n.jsx("td",{className:lt("px-2 py-2 align-middle truncate",Ue.td),children:ye.notes||""}):null,Ce.Time?n.jsx("td",{className:lt("px-2 py-2 align-middle",Ue.muted),children:n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),Lx(ye.paid_at)]})}):null,Ce.Amount?n.jsxs("td",{className:lt("px-2 py-2 text-right align-middle font-bold tabular-nums",be?"text-[#7A1F1B]":"text-[#1E5A3C]"),children:[" ",Ys(ye.amount)]}):null,Ce.Actions?n.jsx("td",{className:"px-2 py-2 text-right align-middle",children:Te?null:n.jsx(sn,{variant:"softDanger",icon:Ms,onClick:()=>Ea(ye),children:"Delete"})}):null]}),$t?n.jsx("tr",{className:lt(Ue.soft2,"border-b",Ue.borderSoft),children:n.jsx("td",{colSpan:Ne,className:"px-3 py-3",children:n.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[11px]",children:[n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"Reference"}),n.jsx("div",{className:"font-semibold text-[#2B2118] truncate",children:ye.reference_no||""})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"Notes"}),n.jsx("div",{className:"font-semibold text-[#2B2118] truncate",children:ye.notes||""})]}),n.jsxs("div",{className:lt("rounded-xl border p-2",Ue.border,Ue.card),children:[n.jsx("div",{className:Ue.muted,children:"Time"}),n.jsx("div",{className:"font-semibold text-[#2B2118]",children:Lx(ye.paid_at)})]})]})})}):null]},ye.id)})})]})}),n.jsx("div",{className:"md:hidden space-y-3",children:bs.length===0?n.jsxs("div",{className:lt("rounded-2xl border p-4 text-xs flex items-start gap-2",Ue.border,Ue.soft2,Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"No payments recorded (or nothing matches search)."]}):bs.map(ye=>{const at=cL(ye.mode),Oe=Number(ye.amount||0)<0,be=!!Fe[ye.id];return n.jsxs(no,{className:"p-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-start gap-2 min-w-0",children:[n.jsx("div",{className:lt("rounded-xl border bg-white p-2",Ue.borderSoft),children:n.jsx(at,{className:"h-4 w-4 text-[#2B2118]"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold text-[#2B2118] truncate",children:ye.mode||""}),n.jsx("div",{className:lt("mt-1 text-[11px]",Ue.muted),children:Lx(ye.paid_at)}),n.jsxs("div",{className:"mt-1 text-[11px] text-[#2B2118] truncate",children:["Ref: ",ye.reference_no||""]})]})]}),n.jsx(Np,{title:"Expand",onClick:()=>ot($t=>({...$t,[ye.id]:!$t[ye.id]})),icon:be?el:Gn})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:"Amount"}),n.jsxs("div",{className:lt("text-[14px] font-bold tabular-nums",Oe?"text-[#7A1F1B]":"text-[#1E5A3C]"),children:[" ",Ys(ye.amount)]})]}),be?n.jsxs("div",{className:"mt-2 text-[11px] text-[#2B2118]",children:["Notes: ",ye.notes||""]}):null,Te?null:n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx(sn,{variant:"softDanger",icon:Ms,onClick:()=>Ea(ye),children:"Delete"})})]},ye.id)})})]}):n.jsxs("div",{className:lt("p-4 text-xs flex items-start gap-2",Ue.muted),children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5"}),"Payments section collapsed."]})]})]})]}),n.jsx("div",{className:"sticky bottom-0 z-30",children:n.jsxs(no,{className:"mt-3",children:[n.jsx("div",{className:lt("px-3 md:px-5 py-3 border-b",Ue.borderSoft,Ue.soft)}),n.jsxs("div",{className:"px-3 md:px-5 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(ro,{icon:Xt,label:"Net",value:` ${Ys(a.net_total)}`,tone:"indigo"}),n.jsx(ro,{icon:I3,label:"Paid",value:` ${Ys(a.amount_paid)}`,tone:"emerald"}),n.jsx(ro,{icon:Xo,label:"Deposit Used",value:` ${Ys(a.advance_adjusted)}`,tone:"amber"}),n.jsx(ro,{icon:rC,label:"Balance",value:` ${Ys(a.balance_due)}`,tone:"rose"})]}),n.jsx("div",{className:"flex gap-2 justify-end",children:Te?n.jsxs("div",{className:lt("text-[12px] font-semibold",Ue.muted),children:["Invoice locked: ",a.status]}):n.jsxs(n.Fragment,{children:[n.jsx(sn,{variant:"secondary",icon:se==="cancel"?Rt:ca,onClick:Zl,disabled:se==="cancel",children:se==="cancel"?"Cancelling":"Cancel"}),n.jsx(sn,{variant:"primary",icon:se==="finalize"?Rt:ny,onClick:Jn,disabled:se==="finalize",children:se==="finalize"?"Finalizing":"Finalize"})]})})]})]})})]}),Te?null:n.jsx("button",{type:"button",onClick:()=>v(!0),className:lt("md:hidden fixed right-4 bottom-24 z-40 h-12 w-12 rounded-2xl shadow-2xl flex items-center justify-center","bg-[#2A1F18] text-white hover:bg-[#1F1712]"),title:"Add Manual Item",children:n.jsx(ds,{className:"h-5 w-5"})}),n.jsx(F1,{open:y&&!Te,title:"Add Manual Item",icon:aC,onClose:()=>v(!1),footer:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(sn,{variant:"secondary",onClick:()=>v(!1),children:"Cancel"}),n.jsx(sn,{variant:"primary",form:"manual-item-form",type:"submit",children:"Add Item"})]}),children:n.jsxs("form",{id:"manual-item-form",className:"space-y-3",onSubmit:hs,children:[n.jsx(In,{label:"Description",children:n.jsx(_r,{type:"text",name:"description",value:j.description,onChange:Zt,required:!0})}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(In,{label:"Qty",children:n.jsx(_r,{type:"number",name:"quantity",value:j.quantity,min:1,onChange:Zt})}),n.jsx(In,{label:"Unit Price",children:n.jsx(_r,{type:"number",name:"unit_price",value:j.unit_price,step:"0.01",onChange:Zt,required:!0})})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[n.jsx(In,{label:"Tax %",children:n.jsx(_r,{type:"number",name:"tax_rate",value:j.tax_rate,step:"0.1",onChange:Zt})}),n.jsx(In,{label:"Disc %",children:n.jsx(_r,{type:"number",name:"discount_percent",value:j.discount_percent,step:"0.1",onChange:Zt})}),n.jsx(In,{label:"Disc Amt",children:n.jsx(_r,{type:"number",name:"discount_amount",value:j.discount_amount,step:"0.01",onChange:Zt})})]})]})}),n.jsx(F1,{open:!!S&&!Te,title:"Edit Item",icon:Yr,onClose:()=>E(null),footer:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(sn,{variant:"secondary",onClick:()=>E(null),children:"Cancel"}),n.jsx(sn,{variant:"primary",form:"edit-item-form",type:"submit",children:"Save"})]}),children:n.jsxs("form",{id:"edit-item-form",className:"space-y-3",onSubmit:Sn,children:[n.jsx(In,{label:"Description",children:n.jsx(_r,{type:"text",name:"description",value:k.description,onChange:_s,required:!0})}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(In,{label:"Qty",children:n.jsx(_r,{type:"number",name:"quantity",value:k.quantity,min:1,onChange:_s})}),n.jsx(In,{label:"Unit Price",children:n.jsx(_r,{type:"number",name:"unit_price",value:k.unit_price,step:"0.01",onChange:_s,required:!0})})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[n.jsx(In,{label:"Tax %",children:n.jsx(_r,{type:"number",name:"tax_rate",value:k.tax_rate,step:"0.1",onChange:_s})}),n.jsx(In,{label:"Disc %",children:n.jsx(_r,{type:"number",name:"discount_percent",value:k.discount_percent,step:"0.1",onChange:_s})}),n.jsx(In,{label:"Disc Amt",children:n.jsx(_r,{type:"number",name:"discount_amount",value:k.discount_amount,step:"0.01",onChange:_s})})]})]})}),n.jsx(F1,{open:I&&!Te,title:O==="refund"?"Add Refund":"Add Payment",icon:O==="refund"?aj:tN,onClose:()=>{P(!1),D("payment")},footer:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(sn,{variant:"secondary",onClick:()=>{P(!1),D("payment")},children:"Cancel"}),n.jsx(sn,{variant:O==="refund"?"danger":"primary",form:"payment-form",type:"submit",children:O==="refund"?"Save Refund":"Save Payment"})]}),children:n.jsxs("form",{id:"payment-form",className:"space-y-3",onSubmit:Pt,children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsx(In,{label:"Amount",hint:O==="refund"?"Refund will be saved as negative amount.":"Payment is saved as positive amount.",children:n.jsx(_r,{type:"number",name:"amount",value:T.amount,onChange:Ts,step:"0.01",required:!0})}),n.jsx(In,{label:"Mode",children:n.jsxs(_0,{name:"mode",value:T.mode,onChange:Ts,children:[n.jsx("option",{value:"cash",children:"Cash"}),n.jsx("option",{value:"card",children:"Card"}),n.jsx("option",{value:"upi",children:"UPI"}),n.jsx("option",{value:"credit",children:"Credit"}),n.jsx("option",{value:"cheque",children:"Cheque"}),n.jsx("option",{value:"neft/rtgs",children:"NEFT/RTGS"}),n.jsx("option",{value:"wallet",children:"Wallet"}),n.jsx("option",{value:"refund",children:"Refund"}),n.jsx("option",{value:"other",children:"Other"})]})})]}),n.jsx(In,{label:"Reference No",children:n.jsx(_r,{type:"text",name:"reference_no",value:T.reference_no,onChange:Ts})}),n.jsx(In,{label:"Notes",children:n.jsx(_r,{type:"text",name:"notes",value:T.notes,onChange:Ts})})]})}),n.jsxs(F1,{open:F&&!Te,title:"Apply Advance / Deposit",icon:Xo,onClose:()=>G(!1),footer:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(sn,{variant:"secondary",onClick:()=>G(!1),children:"Cancel"}),n.jsx(sn,{variant:"primary",form:"wallet-apply-form",type:"submit",disabled:K,children:K?"Applying":"Apply"})]}),children:[n.jsxs("div",{className:lt("rounded-2xl border p-3 text-xs",Ue.border,Ue.soft2),children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:Ue.muted,children:"Available Deposit"}),n.jsxs("span",{className:"font-bold text-[#1E5A3C]",children:[" ",Ys(yl)]})]}),n.jsxs("div",{className:"flex justify-between mt-1",children:[n.jsx("span",{className:Ue.muted,children:"Invoice Balance Due"}),n.jsxs("span",{className:"font-bold text-[#2B2118]",children:[" ",Ys(a.balance_due)]})]})]}),n.jsx("form",{id:"wallet-apply-form",onSubmit:Rr,className:"space-y-3 mt-3",children:n.jsx(In,{label:"Apply Amount",hint:"Cannot exceed available deposit or balance due.",children:n.jsx(_r,{type:"number",value:H,onChange:ye=>$(ye.target.value),step:"0.01",min:"0",placeholder:"Enter amount to apply",required:!0})})})]}),n.jsx(Z3e,{open:Z,title:"Unbilled Services",subtitle:"Select and bulk add into this invoice",onClose:()=>Y(!1),width:"sm:w-[760px]",footer:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"text-[12px] font-semibold text-[#2B2118]",children:[Object.keys(me).filter(ye=>me[ye]).length," selected"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(sn,{variant:"secondary",onClick:()=>Y(!1),children:"Close"}),n.jsx(sn,{variant:"primary",onClick:Ta,disabled:se==="unbilled",children:se==="unbilled"?"Adding":"Add Selected"})]})]}),children:Q?n.jsxs("div",{className:lt("p-4 text-xs flex items-center gap-2",Ue.muted),children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Loading"]}):(_e||[]).length===0?n.jsx("div",{className:lt("p-4 text-xs",Ue.muted),children:"No unbilled services."}):n.jsx("div",{className:lt("divide-y",Ue.borderSoft),children:(_e||[]).map(ye=>{const at=String(ye.uid||`${ye.service_type||"svc"}-${ye.ref_id||ye.id||"x"}`);return n.jsxs("div",{className:lt("p-4 flex gap-3 transition",Ue.rowHover),children:[n.jsx("input",{type:"checkbox",checked:!!me[at],onChange:()=>pu(at),className:"mt-1"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold text-[#2B2118] truncate",children:ye.title||ye.description||`${ye.service_type} #${ye.ref_id}`}),n.jsxs("div",{className:lt("text-[11px]",Ue.muted),children:[ye.service_type,"  Ref #",ye.ref_id,"   ",Ys(ye.amount||0)]}),ye.meta?n.jsx("div",{className:lt("text-[11px]",Ue.muted),children:String(ye.meta)}):null]})]},at)})})})]})}function PY(t){return he.get("/emr/patients/lookup",{params:{q:t}})}function e4e({patient_id:t,uhid:s,date_from:r,date_to:a,types:i}={}){let l;return Array.isArray(i)?l=i.length?i.join(","):void 0:typeof i=="string"?l=i||void 0:l=void 0,he.get("/emr/timeline",{params:{patient_id:t,uhid:s,date_from:r||void 0,date_to:a||void 0,types:l}})}function t4e(t){return he.post("/emr/export/pdf-json",t,{responseType:"blob"})}function s4e(t,s,r){return he.get(`/emr/fhir/${t}`,{params:{date_from:s,date_to:r}})}function jN({value:t,onChange:s,onSelect:r}){const[a,i]=p.useState(""),[l,o]=p.useState([]),[c,d]=p.useState(!1);p.useEffect(()=>{const x=setTimeout(async()=>{const g=(a||"").trim();if(g.length<2){o([]);return}d(!0);try{const{data:y}=await PY(g),v=(y==null?void 0:y.results)||(y==null?void 0:y.items)||y||[];o(v)}catch(y){console.error("lookupPatients failed",y),o([])}finally{d(!1)}},300);return()=>clearTimeout(x)},[a]);function u(m){const x=s||r;x&&x(m.id,m)}return n.jsxs("div",{className:"space-y-1",children:[n.jsx("input",{value:a,onChange:m=>i(m.target.value),placeholder:"Search patient (UHID / Name / Phone)",className:"w-full rounded-md border border-slate-300 px-2.5 py-1.5 text-xs md:text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"}),n.jsxs("div",{className:"mt-1 max-h-56 overflow-auto rounded-xl border border-slate-500 bg-white shadow-sm",children:[c&&n.jsx("div",{className:"px-3 py-2 text-[11px] text-slate-400",children:"Searching"}),!c&&l.length===0&&n.jsx("div",{className:"px-3 py-2 text-[11px] text-slate-400",children:"Type at least 2 characters to search."}),l.map(m=>{const x=m.uhid||`NH-${String(m.id??"").toString().padStart(6,"0")}`,g=m.name||[m.first_name,m.last_name].filter(Boolean).join(" ")||"Unnamed";return n.jsxs("button",{type:"button",onClick:()=>u(m),className:"w-full text-left px-3 py-2 text-xs md:text-sm hover:bg-indigo-50 flex flex-col gap-0.5",children:[n.jsxs("span",{className:"font-medium text-slate-800",children:[x,"  ",g]}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:[m.gender?`${m.gender}  `:"",m.phone||"No phone"]})]},m.id)})]}),t&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Selected patient ID:"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:t})]})]})}const n4e=[{key:"all",label:"All"},{key:"op_billing",label:"OP Billing"},{key:"ip_billing",label:"IP Billing"},{key:"ot",label:"OT"},{key:"lab",label:"Lab"},{key:"pharmacy",label:"Pharmacy"},{key:"radiology",label:"Radiology"},{key:"general",label:"General"}],B1={draft:"bg-amber-50 text-amber-900 border-amber-200",finalized:"bg-emerald-50 text-emerald-900 border-emerald-200",cancelled:"bg-rose-50 text-rose-900 border-rose-200",reversed:"bg-stone-50 text-stone-800 border-stone-200"},uL=[{key:"created_at_desc",label:"Newest first"},{key:"created_at_asc",label:"Oldest first"},{key:"net_desc",label:"Net: High  Low"},{key:"net_asc",label:"Net: Low  High"},{key:"balance_desc",label:"Balance: High  Low"},{key:"balance_asc",label:"Balance: Low  High"}],r4e=[10,20,50,100],qe={pageBg:"bg-[#FFFF]",text:"text-[#000]",muted:"text-[#555]",border:"border-[#999]",soft:"bg-[#eee]",card:"bg-white",shadow:"shadow-[0_10px_25px_rgba(0,0,0,0.06)]",btnPrimary:"bg-[#017977] text-[#FDF9F3] hover:text-[#017977] hover:bg-[#F2EADF] border border-[#017977]",btnSecondary:"bg-[#F2EADF] text-[#2A1F18] hover:bg-[#F6EFE6] border border-[#E6DCCF]",btnNeutral:"bg-[#F6EFE6] text-[#2A1F18] hover:bg-[#F2EADF] border border-[#017977]",ring:"focus:ring-2 focus:ring-[#017977]/35 focus:outline-none"};function vd(t){return Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}function ck(t){return(t==null?void 0:t.invoice_number)||(t==null?void 0:t.invoice_uid)||""}function $1(t){return t&&(t.uhid||t.uhid_no||t.patient_uid||t.mrn||t.uhidNumber||t.uhidNumberText)||null}function dk(t){return t&&(t.phone||t.mobile||t.contact_no||t.contact)||null}function z1(t){return t&&(t.full_name||t.name||`${t.first_name||""} ${t.last_name||""}`.trim())||"Patient"}function mL(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?"":s.toLocaleString()}function a4e(t,s=250){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}function C0(t,s,r){return Math.max(s,Math.min(r,t))}function i4e({open:t,title:s,onClose:r,children:a,footer:i}){return p.useEffect(()=>{if(!t)return;const l=o=>o.key==="Escape"&&(r==null?void 0:r());return document.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",l),document.body.style.overflow=""}},[t,r]),t?n.jsxs("div",{className:"fixed inset-0 z-[60]",children:[n.jsx("div",{className:"absolute inset-0 bg-black/35",onClick:r,"aria-hidden":"true"}),n.jsx("div",{className:"absolute inset-0 flex items-end sm:items-center justify-center p-0 sm:p-6",children:n.jsxs("div",{className:`w-full sm:max-w-xl rounded-t-3xl sm:rounded-3xl ${qe.card} ${qe.shadow} border ${qe.border}`,children:[n.jsxs("div",{className:`flex items-center justify-between px-4 sm:px-6 py-4 border-b ${qe.border}`,children:[n.jsxs("div",{children:[n.jsx("div",{className:`text-base font-semibold ${qe.text}`,children:s}),n.jsx("div",{className:`text-[11px] ${qe.muted}`,children:"Press Esc to close"})]}),n.jsx("button",{type:"button",onClick:r,className:`h-10 w-10 rounded-2xl border ${qe.border} ${qe.btnSecondary} ${qe.ring}`,"aria-label":"Close",children:""})]}),n.jsx("div",{className:"px-4 sm:px-6 py-4 max-h-[70vh] overflow-auto",children:a}),i?n.jsx("div",{className:`px-4 sm:px-6 py-4 border-t ${qe.border} ${qe.soft} rounded-b-3xl`,children:i}):null]})})]}):null}function l4e({open:t,title:s,onClose:r,children:a}){return p.useEffect(()=>{if(!t)return;const i=l=>l.key==="Escape"&&(r==null?void 0:r());return document.addEventListener("keydown",i),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}},[t,r]),t?n.jsxs("div",{className:"fixed inset-0 z-[55] md:hidden",children:[n.jsx("div",{className:"absolute inset-0 bg-black/35",onClick:r,"aria-hidden":"true"}),n.jsxs("div",{className:`absolute inset-x-0 bottom-0 rounded-t-3xl ${qe.card} border ${qe.border} ${qe.shadow}`,children:[n.jsxs("div",{className:`flex items-center justify-between px-4 py-4 border-b ${qe.border}`,children:[n.jsx("div",{className:`text-sm font-semibold ${qe.text}`,children:s}),n.jsx("button",{type:"button",onClick:r,className:`h-10 w-10 rounded-2xl border ${qe.border} ${qe.btnSecondary} ${qe.ring}`,children:""})]}),n.jsx("div",{className:"px-4 py-4 max-h-[80vh] overflow-auto",children:a})]})]}):null}function o4e(){const t=Qr(),[s,r]=p.useState("all"),[a,i]=p.useState([]),[l,o]=p.useState(!1),[c,d]=p.useState({doctors:[],credit_providers:[]}),[u,m]=p.useState(""),x=a4e(u,250),[g,y]=p.useState("all"),[v,j]=p.useState(null),[w,S]=p.useState(null),[E,k]=p.useState(""),[A,I]=p.useState(""),[P,O]=p.useState(""),[D,T]=p.useState(""),[B,U]=p.useState("created_at_desc"),[W,V]=p.useState(20),[R,F]=p.useState(1),[G,H]=p.useState(!0),[$,K]=p.useState(10),le=p.useRef(null),[se,J]=p.useState(!1),[ie,te]=p.useState(!1),[ne,q]=p.useState({patient_id:null,billing_type:"op_billing",context_type:"opd",context_id:"",remarks:""});p.useEffect(()=>{(async()=>{try{const{data:fe}=await jP();d({doctors:(fe==null?void 0:fe.doctors)||[],credit_providers:(fe==null?void 0:fe.credit_providers)||[]})}catch(fe){console.error(fe)}})()},[]),p.useEffect(()=>{ee(!1)},[s]),p.useEffect(()=>{if(!G){le.current&&clearInterval(le.current),le.current=null;return}le.current&&clearInterval(le.current);const fe=C0(Number($)||10,5,60);return le.current=setInterval(()=>ee(!0),fe*1e3),()=>{le.current&&clearInterval(le.current),le.current=null}},[G,$,s]);async function ee(fe){fe||o(!0);try{const Me={};s!=="all"&&(Me.billing_type=s);const{data:Ae}=await M3e(Me);i(Array.isArray(Ae)?Ae:[]),fe||F(1)}catch(Me){console.error(Me),fe||ae.error("Unable to load invoices")}finally{fe||o(!1)}}function X(){m(""),y("all"),j(null),S(null),k(""),I(""),O(""),T(""),U("created_at_desc"),F(1)}function Z(fe){t(`/billing/invoices/${fe.id}`)}async function Y(fe){var Me,Ae;if(fe.preventDefault(),!ne.patient_id)return ae.error("Please select patient");try{const Ke={patient_id:Number(ne.patient_id),billing_type:ne.billing_type||null,context_type:ne.context_type||null,context_id:ne.context_id?Number(ne.context_id):null,remarks:ne.remarks||null},{data:Le}=await P3e(Ke);ae.success("Invoice created"),te(!1),q({patient_id:null,billing_type:"op_billing",context_type:"opd",context_id:"",remarks:""}),t(`/billing/invoices/${Le.id}`)}catch(Ke){console.error(Ke),ae.error(((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||"Create invoice failed")}}const Q=p.useMemo(()=>{const fe=x.trim().toLowerCase();return(a||[]).filter(Me=>g==="all"?!0:String(Me.status||"").toLowerCase()===g).filter(Me=>v?Me.patient_id===v:!0).filter(Me=>{if(!E&&!A)return!0;const Ae=Me.created_at?new Date(Me.created_at):null;if(!Ae||Number.isNaN(Ae.getTime()))return!0;const Ke=Ae.toISOString().slice(0,10);return!(E&&Ke<E||A&&Ke>A)}).filter(Me=>{const Ae=Number(Me.net_total||0);return!(P&&Ae<Number(P)||D&&Ae>Number(D))}).filter(Me=>{if(!fe)return!0;const Ae=Me.patient||null;return`${ck(Me)} ${Me.billing_type||""} ${Me.status||""} ${z1(Ae)} ${$1(Ae)||""} ${dk(Ae)||""}`.toLowerCase().includes(fe)})},[a,x,g,v,E,A,P,D]),oe=p.useMemo(()=>{const fe=[...Q],Me=Le=>{const He=Le!=null&&Le.created_at?new Date(Le.created_at).getTime():0;return Number.isNaN(He)?0:He},Ae=Le=>Number((Le==null?void 0:Le.net_total)||0),Ke=Le=>Number((Le==null?void 0:Le.balance_due)||0);switch(B){case"created_at_asc":fe.sort((Le,He)=>Me(Le)-Me(He));break;case"created_at_desc":fe.sort((Le,He)=>Me(He)-Me(Le));break;case"net_asc":fe.sort((Le,He)=>Ae(Le)-Ae(He));break;case"net_desc":fe.sort((Le,He)=>Ae(He)-Ae(Le));break;case"balance_asc":fe.sort((Le,He)=>Ke(Le)-Ke(He));break;case"balance_desc":fe.sort((Le,He)=>Ke(He)-Ke(Le));break}return fe},[Q,B]),_e=p.useMemo(()=>Math.max(1,Math.ceil(oe.length/W)),[oe.length,W]),xe=p.useMemo(()=>{const Me=(C0(R,1,_e)-1)*W;return oe.slice(Me,Me+W)},[oe,R,_e,W]);p.useEffect(()=>{F(fe=>C0(fe,1,_e))},[_e]);const me=p.useMemo(()=>{const fe=oe.length,Me=oe.reduce((pt,Pe)=>pt+Number(Pe.net_total||0),0),Ae=oe.reduce((pt,Pe)=>pt+Number(Pe.amount_paid||0),0),Ke=oe.reduce((pt,Pe)=>pt+Number(Pe.balance_due||0),0),Le=oe.filter(pt=>String(pt.status||"").toLowerCase()==="draft").length,He=oe.filter(pt=>String(pt.status||"").toLowerCase()==="finalized").length;return{total:fe,sumNet:Me,sumPaid:Ae,sumBal:Ke,drafts:Le,finalized:He}},[oe]),Re=`mt-1 w-full rounded-2xl border ${qe.border} ${qe.card} px-3 py-2 text-sm ${qe.text} ${qe.ring}`,Ze=`mt-1 w-full rounded-2xl border ${qe.border} ${qe.card} px-3 py-2 text-sm ${qe.text} ${qe.ring}`,$e=({compact:fe=!1})=>n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3",children:[n.jsxs("div",{className:"lg:col-span-4",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Search"}),n.jsx("input",{value:u,onChange:Me=>m(Me.target.value),placeholder:"Invoice no / UHID / name / phone",className:Re})]}),n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Status"}),n.jsxs("select",{value:g,onChange:Me=>y(Me.target.value),className:Ze,children:[n.jsx("option",{value:"all",children:"All"}),n.jsx("option",{value:"draft",children:"Draft"}),n.jsx("option",{value:"finalized",children:"Finalized"}),n.jsx("option",{value:"cancelled",children:"Cancelled"}),n.jsx("option",{value:"reversed",children:"Reversed"})]})]}),n.jsxs("div",{className:"lg:col-span-4",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Patient"}),n.jsx("div",{className:`mt-1 rounded-2xl border ${qe.border} ${qe.card} p-1`,children:n.jsx(jN,{value:v,onChange:(Me,Ae)=>{j(Me),S(Ae||null)}})}),w?n.jsxs("div",{className:`mt-1 text-[11px] ${qe.muted}`,children:["Selected: ",n.jsx("span",{className:`font-semibold ${qe.text}`,children:z1(w)}),"  UHID"," ",n.jsx("span",{className:`font-semibold ${qe.text}`,children:$1(w)||""})]}):null]}),n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Sort"}),n.jsx("select",{value:B,onChange:Me=>U(Me.target.value),className:Ze,children:uL.map(Me=>n.jsx("option",{value:Me.key,children:Me.label},Me.key))})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-12 gap-3",children:[n.jsxs("div",{className:"lg:col-span-3",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"From"}),n.jsx("input",{type:"date",value:E,onChange:Me=>k(Me.target.value),className:Re})]}),n.jsxs("div",{className:"lg:col-span-3",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"To"}),n.jsx("input",{type:"date",value:A,onChange:Me=>I(Me.target.value),className:Re})]}),n.jsxs("div",{className:"lg:col-span-3",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Min Net"}),n.jsx("input",{value:P,onChange:Me=>O(Me.target.value),placeholder:"0",className:Re})]}),n.jsxs("div",{className:"lg:col-span-3",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Max Net"}),n.jsx("input",{value:D,onChange:Me=>T(Me.target.value),placeholder:"0",className:Re})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 pt-1",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:()=>ee(!1),className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnSecondary} ${qe.ring}`,children:"Refresh"}),n.jsxs("div",{className:`flex items-center gap-2 rounded-2xl border ${qe.border} ${qe.soft} px-3 py-2`,children:[n.jsx("span",{className:`text-xs font-semibold ${qe.muted}`,children:"Realtime"}),n.jsx("button",{type:"button",onClick:()=>H(Me=>!Me),className:`rounded-full border px-2 py-0.5 text-[11px] font-bold ${G?"border-emerald-200 bg-emerald-50 text-emerald-900":`border-[#E6DCCF] bg-white ${qe.muted}`}`,children:G?"ON":"OFF"}),n.jsx("span",{className:"mx-1 h-4 w-px bg-[#E6DCCF]"}),n.jsxs("select",{value:String($),onChange:Me=>K(Number(Me.target.value)),disabled:!G,className:`h-8 rounded-xl border ${qe.border} bg-white px-2 text-xs font-semibold ${qe.text} disabled:opacity-50 ${qe.ring}`,children:[n.jsx("option",{value:"5",children:"5s"}),n.jsx("option",{value:"10",children:"10s"}),n.jsx("option",{value:"15",children:"15s"}),n.jsx("option",{value:"30",children:"30s"}),n.jsx("option",{value:"60",children:"60s"})]})]})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("button",{type:"button",onClick:X,className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnSecondary} ${qe.ring}`,children:"Clear"})})]}),fe?n.jsx("button",{type:"button",onClick:()=>J(!1),className:`w-full rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnPrimary} ${qe.ring}`,children:"Apply & Close"}):null]});return n.jsxs("div",{className:`min-h-[calc(100vh-4rem)] ${qe.pageBg}`,children:[n.jsxs("div",{className:"mx-auto max-w-12xl px-3 md:px-6 py-4 md:py-6 space-y-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end lg:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:`text-xl md:text-2xl font-semibold ${qe.text}`,children:"Billing Console"}),n.jsx("p",{className:`text-xs md:text-sm ${qe.muted}`,children:"Professional warm theme  OP / IP / OT / Lab / Pharmacy / Radiology / General."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:()=>t("/billing/advance"),className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnSecondary} ${qe.ring}`,children:"Advances"}),n.jsx("button",{type:"button",onClick:()=>J(!0),className:`md:hidden rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnSecondary} ${qe.ring}`,children:"Filters"}),n.jsx("button",{type:"button",onClick:()=>te(!0),className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnPrimary} ${qe.ring}`,children:"+ New Invoice"})]})]}),n.jsx("div",{className:`rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} p-2`,children:n.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:n4e.map(fe=>{const Me=s===fe.key;return n.jsx("button",{type:"button",onClick:()=>r(fe.key),className:`whitespace-nowrap rounded-full px-3.5 py-2 text-xs md:text-sm font-semibold transition ${Me?`${qe.btnPrimary}`:"bg-[#F6EFE6] text-[#2A1F18] hover:bg-[#F2EADF] border border-[#E6DCCF]"}`,children:fe.label},fe.key)})})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[n.jsxs("div",{className:`rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} p-4`,children:[n.jsx("div",{className:`text-xs font-semibold ${qe.muted}`,children:"Invoices"}),n.jsx("div",{className:`mt-1 text-2xl font-semibold ${qe.text}`,children:me.total}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px]",children:[n.jsxs("span",{className:"rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 font-bold text-amber-900",children:["Draft ",me.drafts]}),n.jsxs("span",{className:"rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 font-bold text-emerald-900",children:["Finalized ",me.finalized]})]})]}),n.jsxs("div",{className:`rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} p-4`,children:[n.jsx("div",{className:`text-xs font-semibold ${qe.muted}`,children:"Net Total"}),n.jsxs("div",{className:`mt-1 text-2xl font-semibold ${qe.text}`,children:[" ",vd(me.sumNet)]}),n.jsx("div",{className:`mt-2 text-[11px] ${qe.muted}`,children:"Across current filters"})]}),n.jsxs("div",{className:`rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} p-4`,children:[n.jsx("div",{className:`text-xs font-semibold ${qe.muted}`,children:"Paid / Balance"}),n.jsxs("div",{className:`mt-1 text-lg font-semibold ${qe.text}`,children:[" ",vd(me.sumPaid)," ",n.jsx("span",{className:"text-[#B6A89C]",children:"/"}),"  ",vd(me.sumBal)]}),n.jsx("div",{className:`mt-2 text-[11px] ${qe.muted}`,children:"Paid vs Due"})]})]}),n.jsx("div",{className:`hidden md:block rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} p-4`,children:n.jsx($e,{})}),n.jsxs("div",{className:`rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} overflow-hidden`,children:[n.jsxs("div",{className:`flex flex-col md:flex-row md:items-center md:justify-between gap-2 px-4 py-3 border-b ${qe.border} ${qe.soft}`,children:[n.jsxs("div",{children:[n.jsx("div",{className:`text-sm font-semibold ${qe.text}`,children:"Invoices"}),n.jsx("div",{className:`text-[11px] ${qe.muted}`,children:l?"Loading":`${oe.length} record(s)`})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("select",{value:String(W),onChange:fe=>V(Number(fe.target.value)),className:`h-9 rounded-2xl border ${qe.border} bg-white px-3 text-sm font-semibold ${qe.text} ${qe.ring}`,children:r4e.map(fe=>n.jsxs("option",{value:String(fe),children:[fe," / page"]},fe))}),n.jsx("select",{value:B,onChange:fe=>U(fe.target.value),className:`h-9 rounded-2xl border ${qe.border} bg-white px-3 text-sm font-semibold ${qe.text} ${qe.ring}`,children:uL.map(fe=>n.jsx("option",{value:fe.key,children:fe.label},fe.key))}),n.jsx("button",{type:"button",onClick:()=>ee(!1),className:`h-9 rounded-2xl px-3 text-sm font-semibold ${qe.btnNeutral} ${qe.ring}`,children:"Refresh"})]})]}),l?n.jsx("div",{className:`px-4 py-10 text-center text-sm ${qe.muted}`,children:"Loading invoices"}):oe.length===0?n.jsxs("div",{className:"px-4 py-12 text-center",children:[n.jsx("div",{className:`text-sm font-semibold ${qe.text}`,children:"No invoices found"}),n.jsx("div",{className:`mt-1 text-xs ${qe.muted}`,children:"Try clearing filters or changing tab."}),n.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[n.jsx("button",{type:"button",onClick:X,className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnSecondary} ${qe.ring}`,children:"Clear Filters"}),n.jsx("button",{type:"button",onClick:()=>te(!0),className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnPrimary} ${qe.ring}`,children:"New Invoice"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"md:hidden p-3 space-y-3",children:xe.map(fe=>{const Me=fe.patient||null,Ae=String(fe.status||"draft").toLowerCase();return n.jsxs("button",{type:"button",onClick:()=>Z(fe),className:`w-full text-left rounded-3xl border ${qe.border} ${qe.card} ${qe.shadow} p-3 hover:bg-[#FFFCF7]`,children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:`text-sm font-semibold ${qe.text}`,children:ck(fe)}),n.jsx("div",{className:`mt-0.5 text-[11px] ${qe.muted}`,children:mL(fe.created_at)})]}),n.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-bold ${B1[Ae]||B1.reversed}`,children:Ae.toUpperCase()})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("div",{className:`text-sm font-semibold ${qe.text}`,children:z1(Me)}),n.jsxs("div",{className:`mt-1 flex flex-wrap items-center gap-2 text-[11px] ${qe.muted}`,children:[n.jsxs("span",{className:`rounded-full border ${qe.border} ${qe.soft} px-2 py-0.5 font-semibold ${qe.text}`,children:["UHID: ",$1(Me)||""]}),n.jsx("span",{className:`rounded-full border ${qe.border} bg-white px-2 py-0.5`,children:fe.billing_type||"general"}),n.jsxs("span",{className:`rounded-full border ${qe.border} bg-white px-2 py-0.5`,children:[" ",dk(Me)||""]})]})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[n.jsxs("div",{className:`rounded-2xl border ${qe.border} ${qe.soft} p-2`,children:[n.jsx("div",{className:`text-[11px] ${qe.muted}`,children:"Net"}),n.jsxs("div",{className:`font-semibold ${qe.text}`,children:[" ",vd(fe.net_total)]})]}),n.jsxs("div",{className:`rounded-2xl border ${qe.border} ${qe.soft} p-2`,children:[n.jsx("div",{className:`text-[11px] ${qe.muted}`,children:"Paid"}),n.jsxs("div",{className:`font-semibold ${qe.text}`,children:[" ",vd(fe.amount_paid)]})]}),n.jsxs("div",{className:`rounded-2xl border ${qe.border} ${qe.soft} p-2`,children:[n.jsx("div",{className:`text-[11px] ${qe.muted}`,children:"Bal"}),n.jsxs("div",{className:`font-semibold ${qe.text}`,children:[" ",vd(fe.balance_due)]})]})]}),n.jsx("div",{className:"mt-3 text-xs font-bold text-[#7A4A2A]",children:"Open "})]},fe.id)})}),n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:qe.soft,children:n.jsxs("tr",{className:`border-b ${qe.border}`,children:[n.jsx("th",{className:`px-4 py-3 text-left text-xs font-bold ${qe.muted}`,children:"Invoice"}),n.jsx("th",{className:`px-4 py-3 text-left text-xs font-bold ${qe.muted}`,children:"Billing"}),n.jsx("th",{className:`px-4 py-3 text-left text-xs font-bold ${qe.muted}`,children:"Patient"}),n.jsx("th",{className:`px-4 py-3 text-right text-xs font-bold ${qe.muted}`,children:"Net"}),n.jsx("th",{className:`px-4 py-3 text-right text-xs font-bold ${qe.muted}`,children:"Paid"}),n.jsx("th",{className:`px-4 py-3 text-right text-xs font-bold ${qe.muted}`,children:"Balance"}),n.jsx("th",{className:`px-4 py-3 text-left text-xs font-bold ${qe.muted}`,children:"Status"}),n.jsx("th",{className:`px-4 py-3 text-right text-xs font-bold ${qe.muted}`})]})}),n.jsx("tbody",{className:"divide-y divide-[#EFE7DD]",children:xe.map(fe=>{const Me=fe.patient||null,Ae=String(fe.status||"draft").toLowerCase();return n.jsxs("tr",{className:"hover:bg-[#FFFCF7] cursor-pointer",onClick:()=>Z(fe),children:[n.jsxs("td",{className:"px-4 py-3 whitespace-nowrap",children:[n.jsx("div",{className:`font-semibold ${qe.text}`,children:ck(fe)}),n.jsx("div",{className:`text-[11px] ${qe.muted}`,children:mL(fe.created_at)})]}),n.jsx("td",{className:`px-4 py-3 whitespace-nowrap font-semibold ${qe.text}`,children:fe.billing_type||"general"}),n.jsx("td",{className:"px-4 py-3",children:n.jsxs("div",{className:"min-w-[260px]",children:[n.jsx("div",{className:`font-semibold ${qe.text}`,children:z1(Me)}),n.jsxs("div",{className:`mt-1 flex flex-wrap gap-2 text-[11px] ${qe.muted}`,children:[n.jsxs("span",{className:`rounded-full border ${qe.border} ${qe.soft} px-2 py-0.5 font-semibold ${qe.text}`,children:["UHID: ",$1(Me)||""]}),n.jsxs("span",{className:`rounded-full border ${qe.border} bg-white px-2 py-0.5`,children:[" ",dk(Me)||""]})]})]})}),n.jsxs("td",{className:`px-4 py-3 text-right whitespace-nowrap font-semibold ${qe.text}`,children:[" ",vd(fe.net_total)]}),n.jsxs("td",{className:`px-4 py-3 text-right whitespace-nowrap ${qe.muted}`,children:[" ",vd(fe.amount_paid)]}),n.jsxs("td",{className:`px-4 py-3 text-right whitespace-nowrap font-semibold ${qe.text}`,children:[" ",vd(fe.balance_due)]}),n.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:n.jsx("span",{className:`inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-bold ${B1[Ae]||B1.reversed}`,children:Ae.toUpperCase()})}),n.jsx("td",{className:"px-4 py-3 text-right whitespace-nowrap",children:n.jsx("span",{className:"text-xs font-bold text-[#7A4A2A]",children:"Open "})})]},fe.id)})})]})}),n.jsxs("div",{className:`flex flex-col md:flex-row md:items-center md:justify-between gap-2 px-4 py-3 border-t ${qe.border}`,children:[n.jsxs("div",{className:`text-xs ${qe.muted}`,children:["Showing ",n.jsx("span",{className:`font-bold ${qe.text}`,children:oe.length===0?0:(R-1)*W+1}),"",n.jsx("span",{className:`font-bold ${qe.text}`,children:Math.min(R*W,oe.length)})," of"," ",n.jsx("span",{className:`font-bold ${qe.text}`,children:oe.length})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{type:"button",disabled:R<=1,onClick:()=>F(fe=>C0(fe-1,1,_e)),className:`rounded-2xl border px-3 py-2 text-xs font-bold ${R<=1?"border-[#E6DCCF] text-[#B6A89C] cursor-not-allowed":`${qe.btnSecondary} ${qe.ring}`}`,children:"Prev"}),n.jsxs("span",{className:`text-xs ${qe.muted}`,children:["Page ",n.jsx("span",{className:`font-bold ${qe.text}`,children:R})," / ",_e]}),n.jsx("button",{type:"button",disabled:R>=_e,onClick:()=>F(fe=>C0(fe+1,1,_e)),className:`rounded-2xl border px-3 py-2 text-xs font-bold ${R>=_e?"border-[#E6DCCF] text-[#B6A89C] cursor-not-allowed":`${qe.btnSecondary} ${qe.ring}`}`,children:"Next"})]})]})]})]})]}),n.jsx(l4e,{open:se,title:"Filters & Options",onClose:()=>J(!1),children:n.jsx($e,{compact:!0})}),n.jsx(i4e,{open:ie,title:"Create New Invoice",onClose:()=>te(!1),footer:n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{type:"button",onClick:()=>te(!1),className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnSecondary} ${qe.ring}`,children:"Cancel"}),n.jsx("button",{form:"new-invoice-form",type:"submit",className:`rounded-2xl px-4 py-2 text-sm font-semibold ${qe.btnPrimary} ${qe.ring}`,children:"Create & Open"})]}),children:n.jsxs("form",{id:"new-invoice-form",className:"space-y-4",onSubmit:Y,children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Patient"}),n.jsx("div",{className:`rounded-2xl border ${qe.border} ${qe.card} p-1`,children:n.jsx(jN,{value:ne.patient_id,onChange:fe=>q(Me=>({...Me,patient_id:fe}))})}),n.jsx("p",{className:`text-[11px] ${qe.muted}`,children:"Search by UHID / Name / Phone and select."})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Billing Type"}),n.jsxs("select",{value:ne.billing_type,onChange:fe=>q(Me=>({...Me,billing_type:fe.target.value})),className:Ze,children:[n.jsx("option",{value:"op_billing",children:"OP Billing"}),n.jsx("option",{value:"ip_billing",children:"IP Billing"}),n.jsx("option",{value:"ot",children:"OT"}),n.jsx("option",{value:"lab",children:"Lab"}),n.jsx("option",{value:"pharmacy",children:"Pharmacy"}),n.jsx("option",{value:"radiology",children:"Radiology"}),n.jsx("option",{value:"general",children:"General"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Context Type (optional)"}),n.jsxs("select",{value:ne.context_type,onChange:fe=>q(Me=>({...Me,context_type:fe.target.value})),className:Ze,children:[n.jsx("option",{value:"",children:"None"}),n.jsx("option",{value:"opd",children:"OPD"}),n.jsx("option",{value:"ipd",children:"IPD"}),n.jsx("option",{value:"ot",children:"OT"}),n.jsx("option",{value:"lab",children:"Lab"}),n.jsx("option",{value:"radiology",children:"Radiology"}),n.jsx("option",{value:"pharmacy",children:"Pharmacy"}),n.jsx("option",{value:"other",children:"Other"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Context ID (optional)"}),n.jsx("input",{type:"number",value:ne.context_id,onChange:fe=>q(Me=>({...Me,context_id:fe.target.value})),className:Re,placeholder:"Visit / Admission / Case / Order"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:`text-xs font-semibold ${qe.muted}`,children:"Remarks (optional)"}),n.jsx("input",{value:ne.remarks,onChange:fe=>q(Me=>({...Me,remarks:fe.target.value})),className:Re,placeholder:"Any note"})]})]})]})})]})}function Ho(t){return Number(t||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}function U1(t){try{return t?new Date(t).toLocaleString():""}catch{return""}}function c4e(...t){return t.filter(Boolean).join(" ")}const hL={initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18}};function d4e(){const t=Qr(),[s]=wle(),r=s.get("patient_id")||"",[a,i]=p.useState(r),[l,o]=p.useState(null),[c,d]=p.useState(null),[u,m]=p.useState([]),[x,g]=p.useState(!1),[y,v]=p.useState(!1),[j,w]=p.useState(!1),[S,E]=p.useState({}),[k,A]=p.useState(""),[I,P]=p.useState("all"),[O,D]=p.useState("all"),[T,B]=p.useState({amount:"",mode:"cash",reference_no:"",remarks:"",context_type:"",context_id:""}),U=p.useMemo(()=>!!Number(a||0),[a]);async function W(se){const J=Number(se||0);if(J){g(!0);try{const[ie,te]=await Promise.all([TY(J),G3e(J)]);d(ie.data||null),m(te.data||[])}catch(ie){console.error(ie),ae.error("Unable to load advance/deposit data")}finally{g(!1)}}}p.useEffect(()=>{U&&W(a)},[U]);function V(se){const{name:J,value:ie}=se.target;B(te=>({...te,[J]:ie}))}async function R(se){var te,ne;se.preventDefault();const J=Number(a||0),ie=Number(T.amount||0);if(!J)return ae.error("Patient is required");if(!ie||ie<=0)return ae.error("Amount must be > 0");w(!0);try{await q3e({patient_id:J,amount:ie,mode:T.mode||"cash",reference_no:T.reference_no||null,remarks:T.remarks||null,context_type:T.context_type||null,context_id:T.context_id?Number(T.context_id):null}),ae.success("Advance/Deposit added"),v(!1),B({amount:"",mode:"cash",reference_no:"",remarks:"",context_type:"",context_id:""}),await W(J)}catch(q){console.error(q),ae.error(((ne=(te=q==null?void 0:q.response)==null?void 0:te.data)==null?void 0:ne.detail)||"Unable to add advance/deposit")}finally{w(!1)}}const F=p.useMemo(()=>{if(!l)return null;const se=l.uhid||`NH-${String(l.id??"").toString().padStart(6,"0")}`,J=l.name||[l.first_name,l.last_name].filter(Boolean).join(" ")||"Unnamed";return{uhid:se,name:J,phone:l.phone||null}},[l]);function G(se){E(J=>({...J,[se]:!J[se]}))}function H(se){se&&t(`/billing/invoices/${se}`)}function $(se){const J=(se==null?void 0:se.used_invoices)||[];if(!Array.isArray(J)||J.length===0)return{count:0,total:0};const ie=J.reduce((te,ne)=>te+Number(ne.amount_applied||0),0);return{count:J.length,total:ie}}const K=p.useMemo(()=>{const se=(k||"").trim().toLowerCase();return(u||[]).filter(J=>{const te=$(J).count>0;if(O==="used"&&!te||O==="unused"&&te||I!=="all"&&String(J.mode||"").toLowerCase()!==I)return!1;if(!se)return!0;const ne=String(J.reference_no||"").toLowerCase(),q=`${J.context_type||""} ${J.context_id||""}`.toLowerCase(),ee=String(J.amount||"").toLowerCase(),X=String(J.balance_remaining||"").toLowerCase(),Y=(Array.isArray(J.used_invoices)?J.used_invoices:[]).map(Q=>`${Q.invoice_number||""} ${Q.invoice_uid||""} ${Q.invoice_id||""}`).join(" ").toLowerCase();return ne.includes(se)||q.includes(se)||ee.includes(se)||X.includes(se)||Y.includes(se)})},[u,k,I,O]),le=p.useMemo(()=>({total:(c==null?void 0:c.total_advance)||0,used:(c==null?void 0:c.used_advance)||0,available:(c==null?void 0:c.available_advance)||0}),[c]);return n.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-gradient-to-b from-slate-50 via-slate-100 to-slate-50",children:n.jsxs("div",{className:"mx-auto max-w-12xl px-3 md:px-6 py-4 md:py-6 space-y-4 md:space-y-5",children:[n.jsx("div",{className:"sticky top-0 z-20 -mx-3 md:-mx-6 px-3 md:px-6 py-3 backdrop-blur bg-white/70 border-b border-slate-500",children:n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"ghost",size:"sm",className:"h-8 px-2 text-slate-700",onClick:()=>t("/billing"),children:[n.jsx(Hl,{className:"h-4 w-4 mr-1"}),"Billing"]}),n.jsx("div",{className:"h-5 w-px bg-slate-200"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm md:text-base font-semibold text-slate-900",children:"Advance / Deposit"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Collect deposits and track which invoices consumed them"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"h-9",disabled:!U||x,onClick:()=>W(a),children:[n.jsx(ps,{className:c4e("h-4 w-4 mr-2",x&&"animate-spin")}),x?"Refreshing":"Refresh"]}),n.jsxs(ge,{size:"sm",className:"h-9",onClick:()=>{if(!Number(a||0)){ae.error("Select a patient first");return}v(!0)},children:[n.jsx(ds,{className:"h-4 w-4 mr-2"}),"Add Deposit"]})]})]})}),n.jsx(mt.div,{...hL,children:n.jsxs(dt,{className:"rounded-3xl shadow-sm border-slate-500",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm flex items-center gap-2",children:[n.jsx(Xo,{className:"h-4 w-4 text-slate-700"}),"Patient & Balance"]})}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[420px_1fr] gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-600",children:"Select Patient"}),n.jsx(jN,{value:a,onChange:(se,J)=>{i(String(se)),o(J||null)},onSelect:(se,J)=>{i(String(se)),o(J||null)}}),F?n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Selected"}),n.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:[F.uhid,"  ",F.name]}),n.jsx("div",{className:"text-[11px] text-slate-600",children:F.phone?` ${F.phone}`:"No phone"})]}):n.jsx("div",{className:"text-[11px] text-slate-500",children:"Search by UHID / Name / Phone"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-500",children:"Total Deposited"}),n.jsx(nj,{className:"h-4 w-4 text-slate-500"})]}),n.jsxs("div",{className:"mt-2 text-xl font-extrabold text-slate-900",children:[" ",Ho(le.total)]}),n.jsx("div",{className:"mt-1 text-[11px] text-slate-500",children:"All deposits received"})]}),n.jsxs("div",{className:"rounded-3xl border border-amber-200 bg-amber-50/60 p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-[11px] font-medium text-amber-700",children:"Used"}),n.jsx(fde,{className:"h-4 w-4 text-amber-700"})]}),n.jsxs("div",{className:"mt-2 text-xl font-extrabold text-amber-900",children:[" ",Ho(le.used)]}),n.jsx("div",{className:"mt-1 text-[11px] text-amber-800/80",children:"Consumed by invoices"})]}),n.jsxs("div",{className:"rounded-3xl border border-emerald-200 bg-emerald-50/60 p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-[11px] font-medium text-emerald-700",children:"Available"}),n.jsx(ny,{className:"h-4 w-4 text-emerald-700"})]}),n.jsxs("div",{className:"mt-2 text-xl font-extrabold text-emerald-900",children:[" ",Ho(le.available)]}),n.jsx("div",{className:"mt-1 text-[11px] text-emerald-800/80",children:"Ready to apply"})]})]})]}),n.jsx(vr,{}),n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[n.jsxs("div",{className:"relative w-full md:max-w-md",children:[n.jsx(Yt,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),n.jsx(Ee,{value:k,onChange:se=>A(se.target.value),placeholder:"Search by ref / context / amount / invoice number",className:"pl-9 rounded-2xl"})]}),(k||I!=="all"||O!=="all")&&n.jsxs(ge,{variant:"ghost",size:"sm",className:"h-9",onClick:()=>{A(""),P("all"),D("all")},children:[n.jsx(ts,{className:"h-4 w-4 mr-2"}),"Clear"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsx(jr,{className:"h-4 w-4"}),"Filters"]}),n.jsxs("select",{className:"h-9 rounded-2xl border border-slate-500 bg-white px-3 text-xs",value:I,onChange:se=>P(se.target.value),children:[n.jsx("option",{value:"all",children:"All modes"}),n.jsx("option",{value:"cash",children:"Cash"}),n.jsx("option",{value:"card",children:"Card"}),n.jsx("option",{value:"upi",children:"UPI"}),n.jsx("option",{value:"cheque",children:"Cheque"}),n.jsx("option",{value:"neft/rtgs",children:"NEFT/RTGS"}),n.jsx("option",{value:"wallet",children:"Wallet"}),n.jsx("option",{value:"other",children:"Other"})]}),n.jsxs("select",{className:"h-9 rounded-2xl border border-slate-500 bg-white px-3 text-xs",value:O,onChange:se=>D(se.target.value),children:[n.jsx("option",{value:"all",children:"All"}),n.jsx("option",{value:"used",children:"Used only"}),n.jsx("option",{value:"unused",children:"Unused only"})]}),n.jsxs(et,{variant:"secondary",className:"rounded-full",children:[K.length," shown"]})]})]})]})]})}),n.jsx(mt.div,{...hL,children:n.jsxs(dt,{className:"rounded-3xl shadow-sm border-slate-500",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm flex items-center gap-2",children:[n.jsx(Xn,{className:"h-4 w-4 text-slate-700"}),"Deposit Entries"]})}),n.jsx(it,{className:"space-y-3",children:U?x?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-10 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-full rounded-2xl"})]}):K.length===0?n.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-500 bg-slate-50 p-6 text-center",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No deposits found"}),n.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:"Try clearing filters or add a new deposit."})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{className:"text-slate-500",children:[n.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:"Date"}),n.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:"Mode"}),n.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:"Ref"}),n.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:"Context"}),n.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:"Used Invoices"}),n.jsx("th",{className:"px-3 py-3 text-right font-semibold",children:"Amount"}),n.jsx("th",{className:"px-3 py-3 text-right font-semibold",children:"Remaining"})]})}),n.jsx("tbody",{className:"divide-y divide-slate-100",children:K.map(se=>{const J=$(se),ie=(se==null?void 0:se.used_invoices)||[];return n.jsxs("tr",{className:"align-top hover:bg-slate-50/60",children:[n.jsxs("td",{className:"px-3 py-3 text-slate-800",children:[n.jsx("div",{className:"font-semibold",children:U1(se.received_at)}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["#",se.id]})]}),n.jsx("td",{className:"px-3 py-3",children:n.jsx(et,{className:"rounded-full",variant:"secondary",children:String(se.mode||"-").toUpperCase()})}),n.jsx("td",{className:"px-3 py-3 text-slate-700",children:se.reference_no||n.jsx("span",{className:"text-slate-400",children:""})}),n.jsx("td",{className:"px-3 py-3 text-slate-700",children:se.context_type?n.jsxs("div",{className:"inline-flex items-center gap-2",children:[n.jsx(et,{variant:"outline",className:"rounded-full",children:se.context_type}),se.context_id?n.jsxs("span",{className:"text-slate-500",children:["#",se.context_id]}):null]}):n.jsx("span",{className:"text-slate-400",children:""})}),n.jsx("td",{className:"px-3 py-3",children:J.count===0?n.jsx("span",{className:"text-slate-400",children:"Not used"}):n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(et,{className:"rounded-full bg-amber-100 text-amber-900 hover:bg-amber-100",children:[J.count," invoices"]}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:[" ",Ho(J.total)]})]}),n.jsxs("div",{className:"space-y-1",children:[ie.slice(0,3).map(te=>n.jsxs("div",{className:"text-[11px]",children:[n.jsx("button",{type:"button",onClick:()=>H(te.invoice_id),className:"font-semibold text-indigo-600 hover:underline",title:"Open invoice",children:te.invoice_number||te.invoice_uid||`Invoice #${te.invoice_id}`}),n.jsxs("span",{className:"text-slate-500",children:[" ","  ",Ho(te.amount_applied)," "," ",U1(te.applied_at)]})]},te.id)),ie.length>3&&n.jsxs("div",{className:"text-[11px] text-slate-400",children:["+",ie.length-3," more"]})]})]})}),n.jsxs("td",{className:"px-3 py-3 text-right font-extrabold text-slate-900",children:[" ",Ho(se.amount)]}),n.jsxs("td",{className:"px-3 py-3 text-right font-extrabold text-emerald-700",children:[" ",Ho(se.balance_remaining)]})]},se.id)})})]})}),n.jsx("div",{className:"md:hidden space-y-3",children:K.map(se=>{const J=$(se),ie=(se==null?void 0:se.used_invoices)||[],te=!!S[se.id];return n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white p-4 shadow-sm",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs text-slate-500",children:U1(se.received_at)}),n.jsxs("div",{className:"mt-1 text-base font-extrabold text-slate-900",children:[" ",Ho(se.amount)]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsx(et,{className:"rounded-full",variant:"secondary",children:String(se.mode||"-").toUpperCase()}),se.context_type?n.jsxs(et,{className:"rounded-full",variant:"outline",children:[se.context_type,se.context_id?` #${se.context_id}`:""]}):null]}),n.jsxs("div",{className:"mt-2 text-[11px] text-slate-500",children:["Ref: ",se.reference_no||""]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Remaining"}),n.jsxs("div",{className:"text-sm font-extrabold text-emerald-700",children:[" ",Ho(se.balance_remaining)]}),J.count>0?n.jsxs("div",{className:"mt-2 space-y-1",children:[n.jsxs(et,{className:"rounded-full bg-amber-100 text-amber-900 hover:bg-amber-100",children:[J.count," used"]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:[" ",Ho(J.total)]})]}):n.jsx("div",{className:"mt-2 text-[11px] text-slate-400",children:"Not used"})]})]}),J.count>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("button",{type:"button",onClick:()=>G(se.id),className:"w-full rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2 text-xs font-semibold text-slate-900 flex items-center justify-between",children:[n.jsx("span",{children:"Used Invoices"}),te?n.jsx(el,{className:"h-4 w-4 text-slate-600"}):n.jsx(Gn,{className:"h-4 w-4 text-slate-600"})]}),n.jsx(on,{children:te&&n.jsx(mt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.18},className:"overflow-hidden",children:n.jsx("div",{className:"mt-2 rounded-2xl border border-slate-500 overflow-hidden",children:ie.map(ne=>n.jsxs("button",{type:"button",onClick:()=>H(ne.invoice_id),className:"w-full text-left px-3 py-2 border-b last:border-b-0 border-slate-100 hover:bg-indigo-50",children:[n.jsx("div",{className:"text-xs font-extrabold text-slate-900",children:ne.invoice_number||ne.invoice_uid||`Invoice #${ne.invoice_id}`}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:[" ",Ho(ne.amount_applied)," "," ",U1(ne.applied_at),ne.billing_type?`  ${ne.billing_type}`:"",ne.status?`  ${ne.status}`:""]})]},ne.id))})})})]})]},se.id)})})]}):n.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-500 bg-slate-50 p-6 text-center",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Select a patient"}),n.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:"Choose a patient to view deposit history and usage."})]})})]})}),n.jsx(on,{children:y&&n.jsx(mt.div,{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 p-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:n.jsxs(mt.div,{className:"w-full sm:max-w-lg bg-white rounded-3xl shadow-xl border border-slate-500",initial:{y:18,opacity:0},animate:{y:0,opacity:1},exit:{y:18,opacity:0},transition:{duration:.18},children:[n.jsxs("div",{className:"p-4 border-b border-slate-100 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Add Advance / Deposit"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Record received amount for the selected patient"})]}),n.jsx(ge,{variant:"ghost",size:"icon",onClick:()=>v(!1),children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"p-4 space-y-3",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Patient"}),n.jsx("div",{className:"text-sm font-bold text-slate-900",children:F?n.jsxs(n.Fragment,{children:[F.uhid,"  ",F.name,F.phone?n.jsxs("span",{className:"text-slate-600",children:[" "," +91 ",F.phone]}):null]}):n.jsxs(n.Fragment,{children:["Patient #",a]})})]}),n.jsxs("form",{onSubmit:R,className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Amount"}),n.jsx(Ee,{type:"number",name:"amount",value:T.amount,onChange:V,step:"0.01",className:"rounded-2xl",required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Mode"}),n.jsxs("select",{name:"mode",value:T.mode,onChange:V,className:"h-10 w-full rounded-2xl border border-slate-500 bg-white px-3 text-sm",children:[n.jsx("option",{value:"cash",children:"Cash"}),n.jsx("option",{value:"card",children:"Card"}),n.jsx("option",{value:"upi",children:"UPI"}),n.jsx("option",{value:"cheque",children:"Cheque"}),n.jsx("option",{value:"neft/rtgs",children:"NEFT/RTGS"}),n.jsx("option",{value:"wallet",children:"Wallet"}),n.jsx("option",{value:"other",children:"Other"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Reference (optional)"}),n.jsx(Ee,{name:"reference_no",value:T.reference_no,onChange:V,className:"rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-700",children:"Remarks (optional)"}),n.jsx(Ee,{name:"remarks",value:T.remarks,onChange:V,className:"rounded-2xl"})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 p-3 space-y-2",children:[n.jsx("div",{className:"text-[11px] font-bold text-slate-800",children:"Optional Context"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Context Type"}),n.jsxs("select",{name:"context_type",value:T.context_type,onChange:V,className:"h-10 w-full rounded-2xl border border-slate-500 bg-white px-3 text-sm",children:[n.jsx("option",{value:"",children:"None"}),n.jsx("option",{value:"opd",children:"OPD"}),n.jsx("option",{value:"ipd",children:"IPD"}),n.jsx("option",{value:"ot",children:"OT"}),n.jsx("option",{value:"pharmacy",children:"Pharmacy"}),n.jsx("option",{value:"lab",children:"Lab"}),n.jsx("option",{value:"radiology",children:"Radiology"}),n.jsx("option",{value:"general",children:"General"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] text-slate-600",children:"Context ID"}),n.jsx(Ee,{name:"context_id",value:T.context_id,onChange:V,className:"rounded-2xl",placeholder:"visit/admission/order id"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-1",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl",onClick:()=>v(!1),children:"Cancel"}),n.jsx(ge,{type:"submit",className:"rounded-2xl",disabled:j,children:j?"Saving":"Save Deposit"})]})]})]})]})})})]})})}function u4e({onPick:t,placeholder:s="UHID, name, phone, email"}){const[r,a]=p.useState(""),[i,l]=p.useState([]),[o,c]=p.useState(!1);p.useEffect(()=>{let u=!0;const x=setTimeout(async()=>{if(!r||!r.trim()){l([]);return}try{c(!0);const{data:g}=await PY(r.trim());if(!u)return;l((g==null?void 0:g.results)||[])}finally{c(!1)}},250);return()=>{u=!1,clearTimeout(x)}},[r]);const d=p.useMemo(()=>i.slice(0,8),[i]);return n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Find Patient"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),n.jsx("input",{className:"w-full rounded-xl border border-gray-200 bg-white px-9 py-2 text-sm outline-none ring-blue-200 focus:ring-2",placeholder:s,value:r,onChange:u=>a(u.target.value)})]}),o&&n.jsx("div",{className:"text-xs text-gray-500",children:"Searching"}),!o&&d.length>0&&n.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:d.map(u=>{var m;return n.jsxs("button",{onClick:()=>t(u),className:"rounded-xl border p-3 text-left transition hover:bg-gray-50",children:[n.jsxs("div",{className:"font-medium",children:[u.uhid,"  ",u.name]}),n.jsxs("div",{className:"text-xs text-gray-500",children:[(m=u.gender)==null?void 0:m.toUpperCase()," ",u.dob?` ${u.dob}`:""," ",u.phone?` ${u.phone}`:""]})]},u.uhid)})}),!o&&r&&d.length===0&&n.jsx("div",{className:"text-xs text-gray-500",children:"No matches."})]})}const k0=[{code:"opd_appointment",label:"OPD Appointment",icon:Pr},{code:"opd_visit",label:"OPD Visit",icon:Hs},{code:"opd_vitals",label:"Vitals",icon:Qs},{code:"rx",label:"Prescription",icon:Xn},{code:"opd_lab_order",label:"OPD Lab Order",icon:tl},{code:"lab",label:"Lab Result",icon:tl},{code:"opd_radiology_order",label:"OPD Radiology Order",icon:Ng},{code:"radiology",label:"Radiology",icon:Ng},{code:"pharmacy_rx",label:"Pharmacy RX",icon:rb},{code:"pharmacy",label:"Pharmacy Sale",icon:rb},{code:"ipd_admission",label:"IPD Admit",icon:cn},{code:"ipd_transfer",label:"IPD Transfer",icon:ode},{code:"ipd_discharge",label:"IPD Discharge",icon:gme},{code:"ot",label:"OT",icon:OV},{code:"billing",label:"Billing",icon:vh},{code:"attachment",label:"Attachment",icon:Eme},{code:"consent",label:"Consent",icon:Ka}];function wp(t){return t<10?"0"+t:""+t}function m4e(t){const s=new Date(t);return isNaN(s)?String(t||""):`${s.getFullYear()}-${wp(s.getMonth()+1)}-${wp(s.getDate())} ${wp(s.getHours())}:${wp(s.getMinutes())}`}function h4e(t){const s=new Date(t);return isNaN(s)?"":`${s.getFullYear()}-${wp(s.getMonth()+1)}-${wp(s.getDate())}`}function x4e(t){const s=new Map;return t.forEach(r=>{const a=h4e(r.ts);s.has(a)||s.set(a,[]),s.get(a).push(r)}),Array.from(s.entries()).sort((r,a)=>r[0]<a[0]?1:-1)}function p4e(t,s){const r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=s,a.click(),URL.revokeObjectURL(r)}function V1(t,s){const r=document.createElement("a");r.href=t,r.download=s||"download",r.target="_blank",r.rel="noopener",r.click()}const f4e="inline-flex items-center gap-1 rounded-full border px-3 py-1 text-[11px] font-medium transition",g4e={new:"border-slate-500 bg-slate-50 text-slate-700",in_progress:"border-slate-500 bg-slate-50 text-slate-700",dispensed:"border-emerald-200 bg-emerald-50 text-emerald-700",completed:"border-emerald-200 bg-emerald-50 text-emerald-700",cancelled:"border-rose-200 bg-rose-50 text-rose-700"};function xL(t){const s=(t.content_type||"").toLowerCase(),r=String(t.url||"").toLowerCase();return s.startsWith("image/")?"image":s==="application/pdf"?"pdf":r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg")||r.endsWith(".webp")||r.endsWith(".gif")?"image":r.endsWith(".pdf")?"pdf":"other"}function b4e(t){const s=(t==null?void 0:t.data)||{},r=s.visit&&typeof s.visit=="object"?s.visit:s;return{chief_complaint:r.chief_complaint,symptoms:r.symptoms,soap_subjective:r.soap_subjective??r.subjective,soap_objective:r.soap_objective??r.objective,soap_assessment:r.soap_assessment??r.assessment,plan:r.plan,episode_id:r.episode_id??s.episode_id,appointment:r.appointment??s.appointment}}function y4e(){const[t,s]=p.useState(null),[r,a]=p.useState({date_from:"",date_to:"",types:k0.map(G=>G.code),consent_required:!1}),[i,l]=p.useState(!1),[o,c]=p.useState([]),[d,u]=p.useState(0),m=p.useMemo(()=>new Set(r.types||[]),[r.types]),[x,g]=p.useState(null),[y,v]=p.useState(!1),[j,w]=p.useState(null);p.useEffect(()=>()=>{x&&URL.revokeObjectURL(x)},[x]);const S=G=>{a(H=>{const $=new Set(H.types);return $.has(G)?$.delete(G):$.add(G),{...H,types:Array.from($)}})},E=()=>a(G=>({...G,types:k0.map(H=>H.code)})),k=()=>a(G=>({...G,types:[]}));p.useEffect(()=>{let G=!0;return(async()=>{var $,K;if(!(!(t!=null&&t.uhid)&&!(t!=null&&t.id)))try{l(!0);const le={uhid:t.uhid,patient_id:t.id,date_from:r.date_from||void 0,date_to:r.date_to||void 0};r.types&&r.types.length&&r.types.length!==k0.length&&(le.types=r.types.join(","));const{data:se}=await e4e(le);if(!G)return;c(se||[])}catch(le){console.error(le),ae.error(((K=($=le==null?void 0:le.response)==null?void 0:$.data)==null?void 0:K.detail)||"Failed to load EMR timeline"),c([])}finally{l(!1)}})(),()=>{G=!1}},[t==null?void 0:t.uhid,t==null?void 0:t.id,r.date_from,r.date_to,JSON.stringify(r.types),d]);const A=p.useMemo(()=>x4e(o),[o]),I=(o==null?void 0:o.length)||0,P=r.date_from||r.date_to?`${r.date_from||""}  ${r.date_to||"Today"}`:"All available records",O=async()=>{var G,H,$;if(!t){ae.info("Select a patient first.");return}try{const le={...t!=null&&t.id?{patient_id:t.id}:{uhid:t==null?void 0:t.uhid},date_from:r.date_from||null,date_to:r.date_to||null,sections:{opd:m.has("opd_visit")||m.has("opd_vitals")||m.has("rx")||m.has("opd_appointment"),ipd:m.has("ipd_admission")||m.has("ipd_transfer")||m.has("ipd_discharge"),vitals:m.has("opd_vitals"),prescriptions:m.has("rx"),lab:m.has("lab")||m.has("opd_lab_order"),radiology:m.has("radiology")||m.has("opd_radiology_order"),pharmacy:m.has("pharmacy")||m.has("pharmacy_rx"),ot:m.has("ot"),billing:m.has("billing"),attachments:m.has("attachment"),consents:m.has("consent")},consent_required:!!r.consent_required},J=(await t4e(le)).data;if(!(J instanceof Blob)){ae.error("PDF export failed: invalid response");return}g(ie=>(ie&&URL.revokeObjectURL(ie),URL.createObjectURL(J))),v(!0),ae.success("EMR PDF ready for preview")}catch(K){((G=K==null?void 0:K.response)==null?void 0:G.status)===412?ae.error("Consent required. Enable consent capture or uncheck the Require consent box."):ae.error((($=(H=K==null?void 0:K.response)==null?void 0:H.data)==null?void 0:$.detail)||"PDF export failed")}},D=async()=>{if(!(t!=null&&t.id)){ae.info("Patient id required; please pick from the search list.");return}try{const{data:G}=await s4e(t.id,r.date_from||void 0,r.date_to||void 0),H=new Blob([JSON.stringify(G,null,2)],{type:"application/json"});p4e(H,`FHIR_${t.uhid||"patient"}.json`),ae.success("FHIR bundle downloaded")}catch{ae.error("FHIR export failed")}};function T({k:G,v:H}){return H==null||H===""?null:n.jsxs("div",{className:"text-xs text-slate-700",children:[n.jsxs("span",{className:"font-medium",children:[G,":"]})," ",String(H)]})}function B({k:G,v:H}){return H==null||H===""?null:n.jsxs("div",{className:"text-xs text-slate-700",children:[n.jsxs("div",{className:"font-medium text-slate-900",children:[G,":"]}),n.jsx("div",{className:"mt-0.5 whitespace-pre-wrap text-slate-700",children:String(H)})]})}function U(G){const H=G.data||{};switch(G.type){case"opd_visit":{const $=b4e(G);return n.jsxs("div",{className:"mt-2 space-y-2 text-sm text-slate-800",children:[n.jsx(T,{k:"Chief Complaint",v:$.chief_complaint}),n.jsx(T,{k:"Symptoms",v:$.symptoms}),n.jsx(B,{k:"Subjective",v:$.soap_subjective}),n.jsx(B,{k:"Objective",v:$.soap_objective}),n.jsx(B,{k:"Assessment",v:$.soap_assessment}),n.jsx(B,{k:"Plan",v:$.plan}),n.jsx(T,{k:"Episode",v:$.episode_id}),$.appointment&&n.jsxs("div",{className:"text-xs text-slate-700",children:[n.jsx("span",{className:"font-medium",children:"Appointment:"})," ",$.appointment.date,"  ",$.appointment.slot_start,"",$.appointment.slot_end," "," ",$.appointment.purpose]})]})}case"opd_vitals":return n.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-slate-800 md:grid-cols-3",children:[n.jsx(T,{k:"Recorded at",v:H.recorded_at}),n.jsx(T,{k:"Height (cm)",v:H.height_cm}),n.jsx(T,{k:"Weight (kg)",v:H.weight_kg}),n.jsx(T,{k:"BMI",v:H.bmi}),n.jsx(T,{k:"BP",v:H.bp_systolic!=null&&H.bp_diastolic!=null?`${H.bp_systolic}/${H.bp_diastolic} mmHg`:""}),n.jsx(T,{k:"Pulse",v:H.pulse}),n.jsx(T,{k:"RR",v:H.rr}),n.jsx(T,{k:"Temp (C)",v:H.temp_c}),n.jsx(T,{k:"SpO (%)",v:H.spo2}),n.jsx("div",{className:"col-span-2 md:col-span-3",children:n.jsx(B,{k:"Notes",v:H.notes})})]});case"rx":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(B,{k:"Notes",v:H.notes}),n.jsx(T,{k:"Signed at",v:H.signed_at}),n.jsx(T,{k:"Signed by",v:H.signed_by}),Array.isArray(H.items)&&H.items.length>0&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[11px] font-medium text-slate-600 uppercase tracking-wide",children:"Items"}),n.jsx("div",{className:"mt-1 divide-y rounded-2xl border border-slate-500 bg-slate-50",children:H.items.map(($,K)=>n.jsxs("div",{className:"grid gap-2 p-2.5 md:grid-cols-5",children:[n.jsxs("div",{className:"md:col-span-2 text-xs",children:[n.jsx("span",{className:"font-medium text-slate-900",children:$.drug_name})," ",$.strength?n.jsxs("span",{className:"text-slate-500",children:[" ",$.strength]}):null]}),n.jsxs("div",{className:"text-xs text-slate-600",children:["Freq: ",$.frequency||""]}),n.jsxs("div",{className:"text-xs text-slate-600",children:["Dur: ",$.duration_days,"d"]}),n.jsxs("div",{className:"text-xs text-slate-600",children:["Qty: ",$.quantity]})]},K))})]})]});case"opd_appointment":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Date",v:H.date}),n.jsx(T,{k:"Slot",v:H.slot?`${H.slot_start}  ${H.slot_end}`:void 0}),n.jsx(T,{k:"Purpose",v:H.purpose}),n.jsx(T,{k:"Status",v:H.status})]});case"lab":{const $=H.item||{};return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Order ID",v:H.order_id}),n.jsx(T,{k:"Collected at",v:H.collected_at}),n.jsx(T,{k:"Reported at",v:H.reported_at}),n.jsx(T,{k:"Test",v:$.test_name?`${$.test_name} (${$.test_code})`:""}),n.jsx(T,{k:"Result",v:$.result_value}),n.jsx(T,{k:"Unit",v:$.unit}),n.jsx(T,{k:"Normal range",v:$.normal_range}),n.jsx(T,{k:"Status",v:$.status})]})}case"radiology":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Test",v:H.test_name?`${H.test_name} (${H.test_code})`:""}),n.jsx(T,{k:"Modality",v:H.modality}),n.jsx(T,{k:"Status",v:H.status}),n.jsx(T,{k:"Reported at",v:H.reported_at}),n.jsx(B,{k:"Report",v:H.report_text})]});case"pharmacy":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Sale ID",v:H.sale_id}),n.jsx(T,{k:"Payment",v:H.payment_mode}),n.jsx(T,{k:"Total",v:H.total_amount})]});case"ipd_admission":return n.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-slate-800 md:grid-cols-3",children:[n.jsx(T,{k:"Admission Code",v:H.admission_code}),n.jsx(T,{k:"Type",v:H.admission_type}),n.jsx(T,{k:"Admitted at",v:H.admitted_at}),n.jsx(T,{k:"Bed",v:H.current_bed_code}),n.jsx("div",{className:"col-span-2 md:col-span-3",children:n.jsx(B,{k:"Preliminary Diagnosis",v:H.preliminary_diagnosis})})]});case"ipd_transfer":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"From Bed",v:H.from_bed_id}),n.jsx(T,{k:"To Bed",v:H.to_bed_id}),n.jsx(B,{k:"Reason",v:H.reason}),n.jsx(T,{k:"Transferred at",v:H.transferred_at})]});case"ipd_discharge":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Finalized",v:H.finalized?"Yes":"No"}),n.jsx(T,{k:"Finalized at",v:H.finalized_at}),n.jsx(B,{k:"Treatment Summary",v:H.treatment_summary})]});case"ot":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Surgery",v:H.surgery_name}),n.jsx(T,{k:"Status",v:H.status}),n.jsx(B,{k:"Pre-op Notes",v:H.preop_notes}),n.jsx(B,{k:"Post-op Notes",v:H.postop_notes})]});case"billing":return n.jsx("div",{className:"mt-2 space-y-2 text-sm text-slate-800",children:n.jsxs("div",{className:"grid grid-cols-2 gap-2 md:grid-cols-4",children:[n.jsx(T,{k:"Invoice ID",v:H.invoice_id}),n.jsx(T,{k:"Status",v:H.status}),n.jsx(T,{k:"Net Total",v:H.net_total}),n.jsx(T,{k:"Balance",v:H.balance_due})]})});case"consent":return n.jsxs("div",{className:"mt-2 space-y-1 text-sm text-slate-800",children:[n.jsx(T,{k:"Type",v:H.type}),n.jsx(T,{k:"Captured at",v:H.captured_at}),n.jsx(B,{k:"Text",v:H.text})]});case"attachment":default:return null}}const W=G=>{const H=xL(G);if(H==="other"){window.open(G.url,"_blank","noopener,noreferrer");return}w({url:G.url,label:G.label||"Attachment",kind:H})},V=()=>w(null),R=()=>{if(!x)return;const G=window.open(x);G&&G.addEventListener("load",()=>{G.focus(),G.print()})},F=()=>{!x||!t||V1(x,`EMR_${t.uhid||"patient"}.pdf`)};return n.jsxs("div",{className:"min-h-screen bg-slate-50",children:[n.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-4 md:px-6 md:py-6 lg:px-8",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-2",children:[n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1 text-[10px] font-medium uppercase tracking-wide text-slate-500",children:[n.jsx("span",{className:"h-1.5 w-1.5 animate-pulse rounded-full bg-emerald-500"}),"EMR  Patient record & timeline"]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-500 bg-white px-3 py-1 text-[10px] font-medium text-slate-500",children:[n.jsx(Zue,{className:"h-3 w-3"}),"Desktop workspace"]})]}),n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.2},children:n.jsxs(dt,{className:"mb-5 rounded-3xl border-slate-500 bg-white shadow-sm",children:[n.jsxs(gt,{className:"flex flex-col gap-4 border-b border-slate-100 pb-4 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-3xl bg-slate-900 text-slate-50",children:n.jsx(Hs,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx(jt,{className:"text-xl font-semibold text-slate-900",children:"Patient EMR Timeline"}),n.jsx(gs,{className:"text-sm text-slate-600",children:"Unified view of OPD, IPD, lab, radiology, pharmacy, billing, attachments and consents  export as EMR PDF."})]})]}),n.jsxs("div",{className:"grid gap-2 text-xs text-slate-600 sm:grid-cols-3 sm:text-right",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"text-[10px] font-medium uppercase tracking-wide text-slate-500",children:"Selected patient"}),n.jsx("div",{className:"mt-1 text-[13px] font-semibold text-slate-900",children:t?t.uhid:"None"}),n.jsx("div",{className:"truncate text-[11px] text-slate-500",children:t?t.name:"Use search to pick a patient"})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"text-[10px] font-medium uppercase tracking-wide text-slate-500",children:"Total events"}),n.jsx("div",{className:"mt-1 text-[13px] font-semibold text-slate-900",children:I}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Across visits, orders & billing"})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"text-[10px] font-medium uppercase tracking-wide text-slate-500",children:"Date range"}),n.jsx("div",{className:"mt-1 text-[13px] font-semibold text-slate-900",children:P}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Filter scope for EMR export"})]})]})]}),n.jsx(it,{className:"pt-4",children:n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-500",children:[n.jsx(et,{variant:"outline",className:"rounded-full border-slate-500 bg-white px-2.5 py-1 text-[10px] font-medium uppercase tracking-wide text-slate-500",children:"EMR Viewer"}),n.jsx("span",{className:"hidden text-[11px] text-slate-500 sm:inline",children:"SOAP fields now render correctly (subjective/objective/assessment)."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"inline-flex items-center gap-1 rounded-full border-slate-500 bg-white text-xs text-slate-700 hover:bg-slate-100",onClick:()=>u(G=>G+1),children:[n.jsx(cl,{className:"h-3.5 w-3.5"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"inline-flex items-center gap-1 rounded-full bg-slate-900 px-3 py-2 text-xs font-medium text-white hover:bg-slate-800",onClick:O,children:[n.jsx(Ll,{className:"h-3.5 w-3.5"}),"Preview / Print EMR PDF"]}),n.jsxs(ge,{variant:"outline",size:"sm",className:"inline-flex items-center gap-1 rounded-full border-slate-500 bg-white text-xs text-slate-700 hover:bg-slate-100",onClick:D,children:[n.jsx(Xn,{className:"h-3.5 w-3.5"}),"Export FHIR (JSON)"]})]})]})})]})}),n.jsxs("div",{className:"mt-4 lg:grid lg:grid-cols-[280px,minmax(0,1fr)] lg:gap-6",children:[n.jsxs("div",{className:"mb-4 space-y-4 lg:mb-0 lg:sticky lg:top-24",children:[n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.2,delay:.05},children:n.jsxs(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm",children:[n.jsxs(gt,{className:"pb-3",children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Patient"}),n.jsx(gs,{className:"text-xs text-slate-500",children:"Search and select a patient to view EMR timeline."})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsx(u4e,{onPick:G=>{s(G),ae.success(`Selected ${G.uhid}  ${G.name}`)}}),t&&n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2 text-xs text-slate-700",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[n.jsx(wa,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-medium text-slate-900",children:t.uhid}),n.jsx(eg,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsx("span",{className:"truncate",children:t.name}),t.gender&&n.jsxs(n.Fragment,{children:[n.jsx(eg,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsx("span",{className:"uppercase text-slate-500",children:t.gender})]}),t.dob&&n.jsxs(n.Fragment,{children:[n.jsx(eg,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsxs("span",{className:"text-slate-500",children:["DOB ",t.dob]})]}),t.phone&&n.jsxs(n.Fragment,{children:[n.jsx(eg,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsx("span",{className:"text-slate-500",children:t.phone})]})]})})]})]})}),n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.2,delay:.1},children:n.jsxs(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm",children:[n.jsxs(gt,{className:"pb-3",children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Filters"}),n.jsx(gs,{className:"text-xs text-slate-500",children:"Date range, types and consent requirement."})]}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"mb-1.5 flex items-center gap-2 text-xs font-semibold text-slate-900",children:[n.jsx(xp,{className:"h-3.5 w-3.5 text-slate-500"}),"Date range"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(xp,{className:"pointer-events-none absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-slate-400"}),n.jsx(Ee,{type:"date",className:"h-8 rounded-2xl border-slate-500 bg-slate-50 pl-8 pr-2 text-xs text-slate-700",value:r.date_from,onChange:G=>a(H=>({...H,date_from:G.target.value}))})]}),n.jsxs("div",{className:"relative",children:[n.jsx(xp,{className:"pointer-events-none absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-slate-400"}),n.jsx(Ee,{type:"date",className:"h-8 rounded-2xl border-slate-500 bg-slate-50 pl-8 pr-2 text-xs text-slate-700",value:r.date_to,onChange:G=>a(H=>({...H,date_to:G.target.value}))})]})]}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:"Leave blank for full EMR history."})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"mb-1.5 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-slate-900",children:[n.jsx(jr,{className:"h-3.5 w-3.5 text-slate-500"}),"Types"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{type:"button",onClick:E,className:"text-[10px] font-medium text-slate-600 hover:text-slate-900",children:"All"}),n.jsx("button",{type:"button",onClick:k,className:"text-[10px] font-medium text-slate-500 hover:text-slate-900",children:"Clear"})]})]}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:k0.map(G=>{const H=G.icon,$=m.has(G.code);return n.jsxs("button",{type:"button",onClick:()=>S(G.code),className:["inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[10px] font-medium transition",$?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-slate-500 bg-white text-slate-600 hover:bg-slate-50"].join(" "),children:[n.jsx(H,{className:"h-3 w-3"}),G.label]},G.code)})})]}),n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("input",{id:"consentReq",type:"checkbox",checked:!!r.consent_required,onChange:G=>a(H=>({...H,consent_required:G.target.checked})),className:"mt-0.5 h-3.5 w-3.5 rounded border-slate-300 text-slate-900"}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("label",{htmlFor:"consentReq",className:"block text-xs font-medium text-slate-900",children:"Require active consent for export"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"When enabled, EMR PDF export is blocked unless a valid patient consent exists."})]})]})]})]})})]}),n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.2,delay:.08},className:"space-y-4",children:n.jsxs(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Hs,{className:"h-4 w-4 text-slate-500"}),n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Timeline"})]}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Sorted newest to oldest"})]})}),n.jsxs(it,{children:[i&&n.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((G,H)=>n.jsx(Qe,{className:"h-16 w-full rounded-2xl bg-slate-100"},H))}),!i&&(!o||o.length===0)&&n.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-300 bg-slate-50 px-6 py-8 text-center",children:[n.jsx("div",{className:"mx-auto mb-2 flex h-8 w-8 items-center justify-center rounded-full border border-slate-500 bg-white text-slate-500",children:n.jsx(Hs,{className:"h-4 w-4"})}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No EMR events to display"}),n.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Pick a patient and adjust filters to load timeline."})]}),!i&&o&&o.length>0&&n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute bottom-0 left-4 top-0 w-px bg-gradient-to-b from-slate-200 via-slate-200/70 to-transparent"}),n.jsx("div",{className:"space-y-6",children:A.map(([G,H])=>n.jsxs("div",{className:"relative pl-10",children:[n.jsxs("div",{className:"mb-2 inline-flex items-center gap-2 rounded-full border border-slate-500 bg-slate-50 px-3 py-1 text-[11px] font-medium text-slate-700",children:[n.jsx(xp,{className:"h-3.5 w-3.5 text-slate-500"}),G]}),n.jsx("div",{className:"space-y-3",children:H.map(($,K)=>{var ie,te;const le=[$.doctor_name?`Dr. ${$.doctor_name}`:null,$.department_name||null,$.location_name||null].filter(Boolean).join("  "),se=((ie=k0.find(ne=>ne.code===$.type))==null?void 0:ie.icon)||Xn,J=$.status&&(g4e[$.status]||"border-slate-500 bg-slate-50 text-slate-600");return n.jsxs(mt.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},transition:{duration:.15},className:"relative",children:[n.jsx("div",{className:"absolute -left-[9px] top-4 h-2.5 w-2.5 rounded-full border border-slate-500 bg-white"}),n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white p-3.5 hover:shadow-[0_4px_12px_rgba(15,23,42,0.06)]",children:n.jsx("div",{className:"flex items-start justify-between gap-3",children:n.jsxs("div",{className:"flex min-w-0 items-start gap-3",children:[n.jsx("div",{className:"mt-0.5 flex h-8 w-8 items-center justify-center rounded-2xl bg-slate-900 text-slate-50",children:n.jsx(se,{className:"h-4 w-4"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"truncate text-sm font-semibold text-slate-900",children:$.title||"Event"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:m4e($.ts)}),$.status&&n.jsx("span",{className:`${f4e} ${J}`,children:$.status})]}),le&&n.jsx("div",{className:"mt-0.5 text-[11px] text-slate-500",children:le}),U($),((te=$.attachments)==null?void 0:te.length)>0&&n.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:$.attachments.map((ne,q)=>{const ee=xL(ne);return n.jsxs("div",{className:"inline-flex items-center gap-1.5 rounded-full border border-slate-500 bg-slate-50 px-2.5 py-1 text-[10px]",children:[n.jsxs("button",{type:"button",onClick:()=>W(ne),className:"inline-flex items-center gap-1 text-slate-700 hover:text-slate-900",children:[n.jsx(Wr,{className:"h-3 w-3"}),ne.label||"attachment"]}),n.jsxs("button",{type:"button",onClick:()=>V1(ne.url,ne.label||"attachment"),className:"inline-flex items-center gap-1 text-slate-400 hover:text-slate-700",children:[n.jsx(nn,{className:"h-3 w-3"}),n.jsx("span",{className:"hidden sm:inline",children:"Download"})]}),n.jsx("span",{className:"text-[9px] uppercase text-slate-400",children:ee})]},q)})})]})]})})})]},`${$.type}-${String($.ts)}-${K}`)})})]},G))})]})]})]})})]})]}),y&&x&&n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/60",children:n.jsxs("div",{className:"relative flex h-[90vh] w-[95vw] max-w-6xl flex-col overflow-hidden rounded-3xl border border-slate-500 bg-white shadow-2xl",children:[n.jsxs("div",{className:"flex items-center justify-between border-b border-slate-500 px-4 py-2.5",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"EMR PDF Preview"}),t&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:[t.uhid,"  ",t.name]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"inline-flex items-center gap-1 rounded-full border-slate-500 bg-white text-[11px] text-slate-700 hover:bg-slate-100",onClick:F,children:[n.jsx(nn,{className:"h-3 w-3"}),"Download"]}),n.jsxs(ge,{size:"sm",className:"inline-flex items-center gap-1 rounded-full bg-slate-900 px-3 py-1.5 text-[11px] text-white hover:bg-slate-800",onClick:R,children:[n.jsx(Ll,{className:"h-3 w-3"}),"Print"]}),n.jsx("button",{type:"button",onClick:()=>v(!1),className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200",children:n.jsx(ts,{className:"h-4 w-4"})})]})]}),n.jsx("div",{className:"flex-1 bg-slate-100",children:n.jsx("iframe",{src:x,title:"EMR PDF",className:"h-full w-full"})})]})}),j&&n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/60",children:n.jsxs("div",{className:"relative flex h-[90vh] w-[95vw] max-w-4xl flex-col overflow-hidden rounded-3xl border border-slate-500 bg-white shadow-2xl",children:[n.jsxs("div",{className:"flex items-center justify-between border-b border-slate-500 px-4 py-2.5",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:j.label}),n.jsxs("div",{className:"text-[11px] uppercase text-slate-400",children:[j.kind," preview"]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"inline-flex items-center gap-1 rounded-full border-slate-500 bg-white text-[11px] text-slate-700 hover:bg-slate-100",onClick:()=>V1(j.url,j.label),children:[n.jsx(nn,{className:"h-3 w-3"}),"Download"]}),n.jsx("button",{type:"button",onClick:V,className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200",children:n.jsx(ts,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"flex-1 bg-slate-100",children:[j.kind==="image"&&n.jsx("div",{className:"flex h-full w-full items-center justify-center overflow-auto bg-black",children:n.jsx("img",{src:j.url,alt:j.label,className:"max-h-full max-w-full object-contain"})}),j.kind==="pdf"&&n.jsx("iframe",{src:j.url,title:j.label,className:"h-full w-full"}),j.kind==="other"&&n.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 p-6 text-center text-sm text-slate-600",children:[n.jsx("p",{children:"This file type cant be previewed here. You can open it in a new tab or download it."}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ge,{size:"sm",className:"rounded-full bg-slate-900 px-4 py-1 text-[11px] text-white hover:bg-slate-800",onClick:()=>window.open(j.url,"_blank","noopener,noreferrer"),children:"Open in new tab"}),n.jsx(ge,{variant:"outline",size:"sm",className:"rounded-full border-slate-500 bg-white px-4 py-1 text-[11px] text-slate-700 hover:bg-slate-100",onClick:()=>V1(j.url,j.label),children:"Download"})]})]})]})]})})]})}const NP=(t={})=>he.get("/templates/templates",{params:t}),v4e=t=>he.get(`/templates/templates/${t}`),j4e=t=>he.post("/templates/templates",t),N4e=(t,s)=>he.patch(`/templates/templates/${t}`,s),w4e=t=>he.delete(`/templates/templates/${t}`),DY=(t,s,r=null)=>he.post(`/templates/templates/${t}/render-html`,r?{data:r}:{},{params:{patient_id:s}}),_4e=async(t,s)=>(await he.get(`/templates/templates/${t}/pdf`,{params:{patient_id:s,inline:!1},responseType:"blob"})).data,S4e=async(t,s)=>(await he.post(`/templates/templates/${t}/pdf`,s,{responseType:"blob"})).data,C4e=(t,s)=>he.post(`/templates/patients/${t}/consents`,s),k4e=t=>he.get(`/templates/patients/${t}/consents`),A4e=async t=>{const s=new FormData;return s.append("file",t),(await he.post("/files/upload",s,{headers:{"Content-Type":"multipart/form-data"}})).data};function E4e(){const[t,s]=p.useState([]),[r,a]=p.useState(""),[i,l]=p.useState(""),[o,c]=p.useState(!1),d=async()=>{c(!0);try{const x=await NP({q:r,category:i||void 0});s(x.data||[])}finally{c(!1)}};p.useEffect(()=>{d()},[]);const u=async x=>{x.preventDefault(),d()},m=async x=>{if(confirm("Delete this template?"))try{await w4e(x),ae.success("Deleted"),d()}catch{}};return n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n.jsx("h1",{className:"text-xl font-semibold",children:"Templates"}),n.jsx(ul,{to:"/templates/new",className:"bg-blue-600 text-white px-3 py-2 rounded-lg text-sm",children:"New Template"})]}),n.jsxs("form",{onSubmit:u,className:"mb-3 flex flex-wrap gap-2",children:[n.jsx("input",{value:r,onChange:x=>a(x.target.value),placeholder:"Search name/code...",className:"border rounded px-3 py-2 text-sm"}),n.jsxs("select",{value:i,onChange:x=>l(x.target.value),className:"border rounded px-3 py-2 text-sm",children:[n.jsx("option",{value:"",children:"All"}),n.jsx("option",{value:"report",children:"Report"}),n.jsx("option",{value:"consent",children:"Consent"})]}),n.jsx("button",{className:"px-3 py-2 border rounded text-sm",children:"Filter"})]}),n.jsx("div",{className:"overflow-x-auto bg-white border rounded-lg",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-left",children:"#"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"Name"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"Code"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"Category"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"Version"}),n.jsx("th",{className:"px-3 py-2 text-right",children:"Actions"})]})}),n.jsxs("tbody",{children:[t.map(x=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-3 py-2",children:x.id}),n.jsx("td",{className:"px-3 py-2",children:x.name}),n.jsx("td",{className:"px-3 py-2",children:x.code}),n.jsx("td",{className:"px-3 py-2 capitalize",children:x.category}),n.jsx("td",{className:"px-3 py-2",children:x.version}),n.jsxs("td",{className:"px-3 py-2 text-right",children:[n.jsx(ul,{to:`/templates/${x.id}/edit`,className:"px-2 py-1 text-blue-700 hover:underline",children:"Edit"}),n.jsx("button",{onClick:()=>m(x.id),className:"px-2 py-1 text-red-600 hover:underline",children:"Delete"})]})]},x.id)),t.length===0&&!o&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-6 text-center text-gray-500",children:"No templates"})})]})]})})]})}const pL=["system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif","Arial, Helvetica, sans-serif","'Times New Roman', Times, serif","'Georgia', serif","'Courier New', Courier, monospace","'Inter', system-ui, -apple-system, sans-serif"],fL=["#000000","#444444","#666666","#999999","#CCCCCC","#EEEEEE","#B80000","#DB3E00","#FCCB00","#008B02","#006B76","#1273DE","#004DCF","#5300EB"];function uk({value:t,onChange:s}){const r=p.useRef(null),a=p.useRef(null),[i,l]=p.useState(pL[0]);p.useEffect(()=>{r.current&&r.current.innerHTML!==(t||"")&&(r.current.innerHTML=t||"")},[t]);const o=()=>{var O;return((O=r.current)==null?void 0:O.innerHTML)||""},c=()=>s&&s(o()),d=O=>{document.execCommand("styleWithCSS",!1,!0);const D=window.getSelection();if(!D||D.rangeCount===0)return;const T=D.getRangeAt(0),B=document.createElement("span");Object.entries(O).forEach(([U,W])=>B.style[U]=W),T.surroundContents(B),c()},u=(O,D=null)=>{document.execCommand("styleWithCSS",!1,!0),document.execCommand(O,!1,D),c()},m=(O,D="",T=null)=>{const B=window.getSelection();if(!B||B.rangeCount===0)return;const U=B.getRangeAt(0),W=document.createElement(O);D&&(W.className=D),T&&Object.entries(T).forEach(([V,R])=>W.style[V]=R),U.surroundContents(W),c()},x=()=>{var O;return(O=a.current)==null?void 0:O.click()},g=async O=>{var T,B;const D=(T=O.target.files)==null?void 0:T[0];if(D)try{const U=await A4e(D),W="".replace(/\/$/,""),V=U.file_url_abs?U.file_url_abs:(B=U.file_url)!=null&&B.startsWith("http")?U.file_url:`${W}${U.file_url}`;y(`<img src="${V}" alt="${U.original_name||""}" style="max-width:100%;">`)}catch{ae.error("Upload failed")}finally{O.target.value=""}},y=O=>{var D;(D=r.current)==null||D.focus(),document.execCommand("insertHTML",!1,O),c()},v=()=>{var W;const O=window.getSelection();if(!O||O.rangeCount===0)return null;const D=O.getRangeAt(0),T=D.commonAncestorContainer.nodeType===1?D.commonAncestorContainer:D.commonAncestorContainer.parentNode;if(!T)return null;const B=T.querySelectorAll?T.querySelectorAll("img"):[],U=(W=O.anchorNode)==null?void 0:W.parentNode;if(U&&U.tagName==="IMG")return U;if(U!=null&&U.closest){const V=U.closest("img");if(V)return V}return B.length?B[0]:null},j=O=>{const D=v();if(!D)return ae.info("Select an image first");D.style.width=O,O==="100%"&&(D.style.maxWidth="100%"),c()},w=O=>{const D=v();if(!D)return ae.info("Select an image first");D.classList.remove("float-left","float-right","img-center"),D.style.removeProperty("float"),D.style.removeProperty("display"),D.style.removeProperty("margin-left"),D.style.removeProperty("margin-right"),O==="left"&&D.classList.add("float-left"),O==="right"&&D.classList.add("float-right"),O==="center"&&D.classList.add("img-center"),c()},S=O=>{var B,U;const D=window.getSelection();if(!D||D.rangeCount===0)return null;let T=((B=D.anchorNode)==null?void 0:B.nodeType)===1?D.anchorNode:(U=D.anchorNode)==null?void 0:U.parentNode;for(;T;){if(T.tagName&&O.includes(T.tagName))return T;T=T.parentNode}return null},E=O=>{var T;const D=S(["TABLE"])||((T=S(["TD","TH"]))==null?void 0:T.closest("TABLE"));if(!D)return ae.info("Place caret inside a table");D.classList.remove("tbl-border-all","tbl-border-h","tbl-border-v","tbl-border-none"),D.removeAttribute("border"),D.style.borderCollapse="collapse",D.querySelectorAll("th,td").forEach(B=>{B.style.border="",B.style.borderTop="",B.style.borderBottom="",B.style.borderLeft="",B.style.borderRight=""}),O==="all"&&D.classList.add("tbl-border-all"),O==="h"&&D.classList.add("tbl-border-h"),O==="v"&&D.classList.add("tbl-border-v"),O==="none"&&D.classList.add("tbl-border-none"),c()},k=()=>{const O=S(["TD","TH"]);if(!O)return ae.info("Place caret inside a row");O.closest("tr").classList.toggle("tr-shade"),c()},A=O=>{m("div",O===2?"cols-2":"cols-3")},I=O=>{O.preventDefault();const D=O.clipboardData.getData("text/plain");document.execCommand("insertText",!1,D),c()},P=O=>{O.preventDefault();const D=O.dataTransfer.getData("text/x-token")||O.dataTransfer.getData("text/plain");if(D){y(D);return}const T=O.dataTransfer.getData("text");T&&document.execCommand("insertText",!1,T),c()};return n.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 border-b bg-gray-50",children:[n.jsx("select",{className:"text-sm border rounded px-2 py-1",value:i,onChange:O=>{l(O.target.value),d({fontFamily:O.target.value})},title:"Font family",children:pL.map(O=>n.jsx("option",{value:O,children:O.split(",")[0].replace(/['"]/g,"")},O))}),n.jsx("select",{className:"text-sm border rounded px-2 py-1",onChange:O=>d({fontSize:O.target.value}),children:["10px","12px","14px","16px","18px","20px","24px"].map(O=>n.jsx("option",{value:O,children:O},O))}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("bold"),children:n.jsx("b",{children:"B"})}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("italic"),children:n.jsx("i",{children:"I"})}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("underline"),children:n.jsx("u",{children:"U"})}),n.jsx("span",{className:"mx-1 w-px h-5 bg-gray-200"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("justifyLeft"),children:"Left"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("justifyCenter"),children:"Center"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("justifyRight"),children:"Right"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>m("span","text-justify"),children:"Justify"}),n.jsx("span",{className:"mx-1 w-px h-5 bg-gray-200"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-xs text-gray-500 mr-1",children:"Text"}),fL.map(O=>n.jsx("button",{className:"w-4 h-4 rounded border",style:{background:O},onClick:()=>u("foreColor",O)},"fg"+O))]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-xs text-gray-500 ml-2 mr-1",children:"Highlight"}),fL.map(O=>n.jsx("button",{className:"w-4 h-4 rounded border",style:{background:O},onClick:()=>u("hiliteColor",O)},"bg"+O))]}),n.jsx("span",{className:"mx-1 w-px h-5 bg-gray-200"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("insertUnorderedList"),children:" List"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>u("insertOrderedList"),children:"1. List"}),n.jsx("span",{className:"mx-1 w-px h-5 bg-gray-200"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:x,children:"Image"}),n.jsx("input",{ref:a,type:"file",accept:"image/*",className:"hidden",onChange:g}),n.jsxs("select",{className:"text-sm border rounded px-2 py-1",onChange:O=>j(O.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"Img Width"}),n.jsx("option",{value:"25%",children:"25%"}),n.jsx("option",{value:"33%",children:"33%"}),n.jsx("option",{value:"50%",children:"50%"}),n.jsx("option",{value:"75%",children:"75%"}),n.jsx("option",{value:"100%",children:"100%"})]}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>w("left"),children:"Img Left"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>w("center"),children:"Img Center"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>w("right"),children:"Img Right"}),n.jsx("span",{className:"mx-1 w-px h-5 bg-gray-200"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>A(2),children:"2 Columns"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>A(3),children:"3 Columns"}),n.jsx("span",{className:"mx-1 w-px h-5 bg-gray-200"}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:()=>y("<table><tr><th>Header</th><th>Header</th></tr><tr><td>Cell</td><td>Cell</td></tr></table>"),children:"Insert Table"}),n.jsxs("select",{className:"text-sm border rounded px-2 py-1",onChange:O=>E(O.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"Borders"}),n.jsx("option",{value:"all",children:"All borders"}),n.jsx("option",{value:"h",children:"Horizontal only"}),n.jsx("option",{value:"v",children:"Vertical only"}),n.jsx("option",{value:"none",children:"No borders"})]}),n.jsx("button",{className:"px-2 py-1 text-sm rounded hover:bg-white",onClick:k,children:"Shade Row"})]}),n.jsx("div",{ref:r,className:"min-h-[320px] p-3 prose max-w-none focus:outline-none",contentEditable:!0,onInput:c,onPaste:I,suppressContentEditableWarning:!0,spellCheck:!1}),n.jsx("div",{ref:r,className:"min-h-[320px] p-3 prose max-w-none focus:outline-none",contentEditable:!0,onInput:c,onPaste:I,onDragOver:O=>O.preventDefault(),onDrop:P,suppressContentEditableWarning:!0,spellCheck:!1}),n.jsx("div",{className:"px-3 py-1 text-[10px] text-gray-500 border-t bg-gray-50",children:"Tip: select an image to resize/align; use columns for magazine-style layouts."})]})}function Fa(t){this.content=t}Fa.prototype={constructor:Fa,find:function(t){for(var s=0;s<this.content.length;s+=2)if(this.content[s]===t)return s;return-1},get:function(t){var s=this.find(t);return s==-1?void 0:this.content[s+1]},update:function(t,s,r){var a=r&&r!=t?this.remove(r):this,i=a.find(t),l=a.content.slice();return i==-1?l.push(r||t,s):(l[i+1]=s,r&&(l[i]=r)),new Fa(l)},remove:function(t){var s=this.find(t);if(s==-1)return this;var r=this.content.slice();return r.splice(s,2),new Fa(r)},addToStart:function(t,s){return new Fa([t,s].concat(this.remove(t).content))},addToEnd:function(t,s){var r=this.remove(t).content.slice();return r.push(t,s),new Fa(r)},addBefore:function(t,s,r){var a=this.remove(s),i=a.content.slice(),l=a.find(t);return i.splice(l==-1?i.length:l,0,s,r),new Fa(i)},forEach:function(t){for(var s=0;s<this.content.length;s+=2)t(this.content[s],this.content[s+1])},prepend:function(t){return t=Fa.from(t),t.size?new Fa(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Fa.from(t),t.size?new Fa(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var s=this;t=Fa.from(t);for(var r=0;r<t.content.length;r+=2)s=s.remove(t.content[r]);return s},toObject:function(){var t={};return this.forEach(function(s,r){t[s]=r}),t},get size(){return this.content.length>>1}};Fa.from=function(t){if(t instanceof Fa)return t;var s=[];if(t)for(var r in t)s.push(r,t[r]);return new Fa(s)};function MY(t,s,r){for(let a=0;;a++){if(a==t.childCount||a==s.childCount)return t.childCount==s.childCount?null:r;let i=t.child(a),l=s.child(a);if(i==l){r+=i.nodeSize;continue}if(!i.sameMarkup(l))return r;if(i.isText&&i.text!=l.text){for(let o=0;i.text[o]==l.text[o];o++)r++;return r}if(i.content.size||l.content.size){let o=MY(i.content,l.content,r+1);if(o!=null)return o}r+=i.nodeSize}}function IY(t,s,r,a){for(let i=t.childCount,l=s.childCount;;){if(i==0||l==0)return i==l?null:{a:r,b:a};let o=t.child(--i),c=s.child(--l),d=o.nodeSize;if(o==c){r-=d,a-=d;continue}if(!o.sameMarkup(c))return{a:r,b:a};if(o.isText&&o.text!=c.text){let u=0,m=Math.min(o.text.length,c.text.length);for(;u<m&&o.text[o.text.length-u-1]==c.text[c.text.length-u-1];)u++,r--,a--;return{a:r,b:a}}if(o.content.size||c.content.size){let u=IY(o.content,c.content,r-1,a-1);if(u)return u}r-=d,a-=d}}class vt{constructor(s,r){if(this.content=s,this.size=r||0,r==null)for(let a=0;a<s.length;a++)this.size+=s[a].nodeSize}nodesBetween(s,r,a,i=0,l){for(let o=0,c=0;c<r;o++){let d=this.content[o],u=c+d.nodeSize;if(u>s&&a(d,i+c,l||null,o)!==!1&&d.content.size){let m=c+1;d.nodesBetween(Math.max(0,s-m),Math.min(d.content.size,r-m),a,i+m)}c=u}}descendants(s){this.nodesBetween(0,this.size,s)}textBetween(s,r,a,i){let l="",o=!0;return this.nodesBetween(s,r,(c,d)=>{let u=c.isText?c.text.slice(Math.max(s,d)-d,r-d):c.isLeaf?i?typeof i=="function"?i(c):i:c.type.spec.leafText?c.type.spec.leafText(c):"":"";c.isBlock&&(c.isLeaf&&u||c.isTextblock)&&a&&(o?o=!1:l+=a),l+=u},0),l}append(s){if(!s.size)return this;if(!this.size)return s;let r=this.lastChild,a=s.firstChild,i=this.content.slice(),l=0;for(r.isText&&r.sameMarkup(a)&&(i[i.length-1]=r.withText(r.text+a.text),l=1);l<s.content.length;l++)i.push(s.content[l]);return new vt(i,this.size+s.size)}cut(s,r=this.size){if(s==0&&r==this.size)return this;let a=[],i=0;if(r>s)for(let l=0,o=0;o<r;l++){let c=this.content[l],d=o+c.nodeSize;d>s&&((o<s||d>r)&&(c.isText?c=c.cut(Math.max(0,s-o),Math.min(c.text.length,r-o)):c=c.cut(Math.max(0,s-o-1),Math.min(c.content.size,r-o-1))),a.push(c),i+=c.nodeSize),o=d}return new vt(a,i)}cutByIndex(s,r){return s==r?vt.empty:s==0&&r==this.content.length?this:new vt(this.content.slice(s,r))}replaceChild(s,r){let a=this.content[s];if(a==r)return this;let i=this.content.slice(),l=this.size+r.nodeSize-a.nodeSize;return i[s]=r,new vt(i,l)}addToStart(s){return new vt([s].concat(this.content),this.size+s.nodeSize)}addToEnd(s){return new vt(this.content.concat(s),this.size+s.nodeSize)}eq(s){if(this.content.length!=s.content.length)return!1;for(let r=0;r<this.content.length;r++)if(!this.content[r].eq(s.content[r]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(s){let r=this.content[s];if(!r)throw new RangeError("Index "+s+" out of range for "+this);return r}maybeChild(s){return this.content[s]||null}forEach(s){for(let r=0,a=0;r<this.content.length;r++){let i=this.content[r];s(i,a,r),a+=i.nodeSize}}findDiffStart(s,r=0){return MY(this,s,r)}findDiffEnd(s,r=this.size,a=s.size){return IY(this,s,r,a)}findIndex(s){if(s==0)return H1(0,s);if(s==this.size)return H1(this.content.length,s);if(s>this.size||s<0)throw new RangeError(`Position ${s} outside of fragment (${this})`);for(let r=0,a=0;;r++){let i=this.child(r),l=a+i.nodeSize;if(l>=s)return l==s?H1(r+1,l):H1(r,a);a=l}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(s=>s.toJSON()):null}static fromJSON(s,r){if(!r)return vt.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new vt(r.map(s.nodeFromJSON))}static fromArray(s){if(!s.length)return vt.empty;let r,a=0;for(let i=0;i<s.length;i++){let l=s[i];a+=l.nodeSize,i&&l.isText&&s[i-1].sameMarkup(l)?(r||(r=s.slice(0,i)),r[r.length-1]=l.withText(r[r.length-1].text+l.text)):r&&r.push(l)}return new vt(r||s,a)}static from(s){if(!s)return vt.empty;if(s instanceof vt)return s;if(Array.isArray(s))return this.fromArray(s);if(s.attrs)return new vt([s],s.nodeSize);throw new RangeError("Can not convert "+s+" to a Fragment"+(s.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}vt.empty=new vt([],0);const mk={index:0,offset:0};function H1(t,s){return mk.index=t,mk.offset=s,mk}function NN(t,s){if(t===s)return!0;if(!(t&&typeof t=="object")||!(s&&typeof s=="object"))return!1;let r=Array.isArray(t);if(Array.isArray(s)!=r)return!1;if(r){if(t.length!=s.length)return!1;for(let a=0;a<t.length;a++)if(!NN(t[a],s[a]))return!1}else{for(let a in t)if(!(a in s)||!NN(t[a],s[a]))return!1;for(let a in s)if(!(a in t))return!1}return!0}let qn=class k4{constructor(s,r){this.type=s,this.attrs=r}addToSet(s){let r,a=!1;for(let i=0;i<s.length;i++){let l=s[i];if(this.eq(l))return s;if(this.type.excludes(l.type))r||(r=s.slice(0,i));else{if(l.type.excludes(this.type))return s;!a&&l.type.rank>this.type.rank&&(r||(r=s.slice(0,i)),r.push(this),a=!0),r&&r.push(l)}}return r||(r=s.slice()),a||r.push(this),r}removeFromSet(s){for(let r=0;r<s.length;r++)if(this.eq(s[r]))return s.slice(0,r).concat(s.slice(r+1));return s}isInSet(s){for(let r=0;r<s.length;r++)if(this.eq(s[r]))return!0;return!1}eq(s){return this==s||this.type==s.type&&NN(this.attrs,s.attrs)}toJSON(){let s={type:this.type.name};for(let r in this.attrs){s.attrs=this.attrs;break}return s}static fromJSON(s,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");let a=s.marks[r.type];if(!a)throw new RangeError(`There is no mark type ${r.type} in this schema`);let i=a.create(r.attrs);return a.checkAttrs(i.attrs),i}static sameSet(s,r){if(s==r)return!0;if(s.length!=r.length)return!1;for(let a=0;a<s.length;a++)if(!s[a].eq(r[a]))return!1;return!0}static setFrom(s){if(!s||Array.isArray(s)&&s.length==0)return k4.none;if(s instanceof k4)return[s];let r=s.slice();return r.sort((a,i)=>a.type.rank-i.type.rank),r}};qn.none=[];class wN extends Error{}class Mt{constructor(s,r,a){this.content=s,this.openStart=r,this.openEnd=a}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(s,r){let a=RY(this.content,s+this.openStart,r);return a&&new Mt(a,this.openStart,this.openEnd)}removeBetween(s,r){return new Mt(OY(this.content,s+this.openStart,r+this.openStart),this.openStart,this.openEnd)}eq(s){return this.content.eq(s.content)&&this.openStart==s.openStart&&this.openEnd==s.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let s={content:this.content.toJSON()};return this.openStart>0&&(s.openStart=this.openStart),this.openEnd>0&&(s.openEnd=this.openEnd),s}static fromJSON(s,r){if(!r)return Mt.empty;let a=r.openStart||0,i=r.openEnd||0;if(typeof a!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Mt(vt.fromJSON(s,r.content),a,i)}static maxOpen(s,r=!0){let a=0,i=0;for(let l=s.firstChild;l&&!l.isLeaf&&(r||!l.type.spec.isolating);l=l.firstChild)a++;for(let l=s.lastChild;l&&!l.isLeaf&&(r||!l.type.spec.isolating);l=l.lastChild)i++;return new Mt(s,a,i)}}Mt.empty=new Mt(vt.empty,0,0);function OY(t,s,r){let{index:a,offset:i}=t.findIndex(s),l=t.maybeChild(a),{index:o,offset:c}=t.findIndex(r);if(i==s||l.isText){if(c!=r&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,s).append(t.cut(r))}if(a!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(a,l.copy(OY(l.content,s-i-1,r-i-1)))}function RY(t,s,r,a){let{index:i,offset:l}=t.findIndex(s),o=t.maybeChild(i);if(l==s||o.isText)return a&&!a.canReplace(i,i,r)?null:t.cut(0,s).append(r).append(t.cut(s));let c=RY(o.content,s-l-1,r,o);return c&&t.replaceChild(i,o.copy(c))}function T4e(t,s,r){if(r.openStart>t.depth)throw new wN("Inserted content deeper than insertion position");if(t.depth-r.openStart!=s.depth-r.openEnd)throw new wN("Inconsistent open depths");return LY(t,s,r,0)}function LY(t,s,r,a){let i=t.index(a),l=t.node(a);if(i==s.index(a)&&a<t.depth-r.openStart){let o=LY(t,s,r,a+1);return l.copy(l.content.replaceChild(i,o))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==a&&s.depth==a){let o=t.parent,c=o.content;return kh(o,c.cut(0,t.parentOffset).append(r.content).append(c.cut(s.parentOffset)))}else{let{start:o,end:c}=P4e(r,t);return kh(l,BY(t,o,c,s,a))}else return kh(l,_N(t,s,a))}function FY(t,s){if(!s.type.compatibleContent(t.type))throw new wN("Cannot join "+s.type.name+" onto "+t.type.name)}function A4(t,s,r){let a=t.node(r);return FY(a,s.node(r)),a}function Ch(t,s){let r=s.length-1;r>=0&&t.isText&&t.sameMarkup(s[r])?s[r]=t.withText(s[r].text+t.text):s.push(t)}function Tg(t,s,r,a){let i=(s||t).node(r),l=0,o=s?s.index(r):i.childCount;t&&(l=t.index(r),t.depth>r?l++:t.textOffset&&(Ch(t.nodeAfter,a),l++));for(let c=l;c<o;c++)Ch(i.child(c),a);s&&s.depth==r&&s.textOffset&&Ch(s.nodeBefore,a)}function kh(t,s){return t.type.checkContent(s),t.copy(s)}function BY(t,s,r,a,i){let l=t.depth>i&&A4(t,s,i+1),o=a.depth>i&&A4(r,a,i+1),c=[];return Tg(null,t,i,c),l&&o&&s.index(i)==r.index(i)?(FY(l,o),Ch(kh(l,BY(t,s,r,a,i+1)),c)):(l&&Ch(kh(l,_N(t,s,i+1)),c),Tg(s,r,i,c),o&&Ch(kh(o,_N(r,a,i+1)),c)),Tg(a,null,i,c),new vt(c)}function _N(t,s,r){let a=[];if(Tg(null,t,r,a),t.depth>r){let i=A4(t,s,r+1);Ch(kh(i,_N(t,s,r+1)),a)}return Tg(s,null,r,a),new vt(a)}function P4e(t,s){let r=s.depth-t.openStart,i=s.node(r).copy(t.content);for(let l=r-1;l>=0;l--)i=s.node(l).copy(vt.from(i));return{start:i.resolveNoCache(t.openStart+r),end:i.resolveNoCache(i.content.size-t.openEnd-r)}}class Nb{constructor(s,r,a){this.pos=s,this.path=r,this.parentOffset=a,this.depth=r.length/3-1}resolveDepth(s){return s==null?this.depth:s<0?this.depth+s:s}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(s){return this.path[this.resolveDepth(s)*3]}index(s){return this.path[this.resolveDepth(s)*3+1]}indexAfter(s){return s=this.resolveDepth(s),this.index(s)+(s==this.depth&&!this.textOffset?0:1)}start(s){return s=this.resolveDepth(s),s==0?0:this.path[s*3-1]+1}end(s){return s=this.resolveDepth(s),this.start(s)+this.node(s).content.size}before(s){if(s=this.resolveDepth(s),!s)throw new RangeError("There is no position before the top-level node");return s==this.depth+1?this.pos:this.path[s*3-1]}after(s){if(s=this.resolveDepth(s),!s)throw new RangeError("There is no position after the top-level node");return s==this.depth+1?this.pos:this.path[s*3-1]+this.path[s*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let s=this.parent,r=this.index(this.depth);if(r==s.childCount)return null;let a=this.pos-this.path[this.path.length-1],i=s.child(r);return a?s.child(r).cut(a):i}get nodeBefore(){let s=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(s).cut(0,r):s==0?null:this.parent.child(s-1)}posAtIndex(s,r){r=this.resolveDepth(r);let a=this.path[r*3],i=r==0?0:this.path[r*3-1]+1;for(let l=0;l<s;l++)i+=a.child(l).nodeSize;return i}marks(){let s=this.parent,r=this.index();if(s.content.size==0)return qn.none;if(this.textOffset)return s.child(r).marks;let a=s.maybeChild(r-1),i=s.maybeChild(r);if(!a){let c=a;a=i,i=c}let l=a.marks;for(var o=0;o<l.length;o++)l[o].type.spec.inclusive===!1&&(!i||!l[o].isInSet(i.marks))&&(l=l[o--].removeFromSet(l));return l}marksAcross(s){let r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;let a=r.marks,i=s.parent.maybeChild(s.index());for(var l=0;l<a.length;l++)a[l].type.spec.inclusive===!1&&(!i||!a[l].isInSet(i.marks))&&(a=a[l--].removeFromSet(a));return a}sharedDepth(s){for(let r=this.depth;r>0;r--)if(this.start(r)<=s&&this.end(r)>=s)return r;return 0}blockRange(s=this,r){if(s.pos<this.pos)return s.blockRange(this);for(let a=this.depth-(this.parent.inlineContent||this.pos==s.pos?1:0);a>=0;a--)if(s.pos<=this.end(a)&&(!r||r(this.node(a))))return new SN(this,s,a);return null}sameParent(s){return this.pos-this.parentOffset==s.pos-s.parentOffset}max(s){return s.pos>this.pos?s:this}min(s){return s.pos<this.pos?s:this}toString(){let s="";for(let r=1;r<=this.depth;r++)s+=(s?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return s+":"+this.parentOffset}static resolve(s,r){if(!(r>=0&&r<=s.content.size))throw new RangeError("Position "+r+" out of range");let a=[],i=0,l=r;for(let o=s;;){let{index:c,offset:d}=o.content.findIndex(l),u=l-d;if(a.push(o,c,i+d),!u||(o=o.child(c),o.isText))break;l=u-1,i+=d+1}return new Nb(r,a,l)}static resolveCached(s,r){let a=gL.get(s);if(a)for(let l=0;l<a.elts.length;l++){let o=a.elts[l];if(o.pos==r)return o}else gL.set(s,a=new D4e);let i=a.elts[a.i]=Nb.resolve(s,r);return a.i=(a.i+1)%M4e,i}}class D4e{constructor(){this.elts=[],this.i=0}}const M4e=12,gL=new WeakMap;class SN{constructor(s,r,a){this.$from=s,this.$to=r,this.depth=a}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const I4e=Object.create(null);let lm=class E4{constructor(s,r,a,i=qn.none){this.type=s,this.attrs=r,this.marks=i,this.content=a||vt.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(s){return this.content.child(s)}maybeChild(s){return this.content.maybeChild(s)}forEach(s){this.content.forEach(s)}nodesBetween(s,r,a,i=0){this.content.nodesBetween(s,r,a,i,this)}descendants(s){this.nodesBetween(0,this.content.size,s)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(s,r,a,i){return this.content.textBetween(s,r,a,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(s){return this==s||this.sameMarkup(s)&&this.content.eq(s.content)}sameMarkup(s){return this.hasMarkup(s.type,s.attrs,s.marks)}hasMarkup(s,r,a){return this.type==s&&NN(this.attrs,r||s.defaultAttrs||I4e)&&qn.sameSet(this.marks,a||qn.none)}copy(s=null){return s==this.content?this:new E4(this.type,this.attrs,s,this.marks)}mark(s){return s==this.marks?this:new E4(this.type,this.attrs,this.content,s)}cut(s,r=this.content.size){return s==0&&r==this.content.size?this:this.copy(this.content.cut(s,r))}slice(s,r=this.content.size,a=!1){if(s==r)return Mt.empty;let i=this.resolve(s),l=this.resolve(r),o=a?0:i.sharedDepth(r),c=i.start(o),u=i.node(o).content.cut(i.pos-c,l.pos-c);return new Mt(u,i.depth-o,l.depth-o)}replace(s,r,a){return T4e(this.resolve(s),this.resolve(r),a)}nodeAt(s){for(let r=this;;){let{index:a,offset:i}=r.content.findIndex(s);if(r=r.maybeChild(a),!r)return null;if(i==s||r.isText)return r;s-=i+1}}childAfter(s){let{index:r,offset:a}=this.content.findIndex(s);return{node:this.content.maybeChild(r),index:r,offset:a}}childBefore(s){if(s==0)return{node:null,index:0,offset:0};let{index:r,offset:a}=this.content.findIndex(s);if(a<s)return{node:this.content.child(r),index:r,offset:a};let i=this.content.child(r-1);return{node:i,index:r-1,offset:a-i.nodeSize}}resolve(s){return Nb.resolveCached(this,s)}resolveNoCache(s){return Nb.resolve(this,s)}rangeHasMark(s,r,a){let i=!1;return r>s&&this.nodesBetween(s,r,l=>(a.isInSet(l.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let s=this.type.name;return this.content.size&&(s+="("+this.content.toStringInner()+")"),$Y(this.marks,s)}contentMatchAt(s){let r=this.type.contentMatch.matchFragment(this.content,0,s);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r}canReplace(s,r,a=vt.empty,i=0,l=a.childCount){let o=this.contentMatchAt(s).matchFragment(a,i,l),c=o&&o.matchFragment(this.content,r);if(!c||!c.validEnd)return!1;for(let d=i;d<l;d++)if(!this.type.allowsMarks(a.child(d).marks))return!1;return!0}canReplaceWith(s,r,a,i){if(i&&!this.type.allowsMarks(i))return!1;let l=this.contentMatchAt(s).matchType(a),o=l&&l.matchFragment(this.content,r);return o?o.validEnd:!1}canAppend(s){return s.content.size?this.canReplace(this.childCount,this.childCount,s.content):this.type.compatibleContent(s.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let s=qn.none;for(let r=0;r<this.marks.length;r++){let a=this.marks[r];a.type.checkAttrs(a.attrs),s=a.addToSet(s)}if(!qn.sameSet(s,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(r=>r.type.name)}`);this.content.forEach(r=>r.check())}toJSON(){let s={type:this.type.name};for(let r in this.attrs){s.attrs=this.attrs;break}return this.content.size&&(s.content=this.content.toJSON()),this.marks.length&&(s.marks=this.marks.map(r=>r.toJSON())),s}static fromJSON(s,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");let a;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=r.marks.map(s.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return s.text(r.text,a)}let i=vt.fromJSON(s,r.content),l=s.nodeType(r.type).create(r.attrs,i,a);return l.type.checkAttrs(l.attrs),l}};lm.prototype.text=void 0;class CN extends lm{constructor(s,r,a,i){if(super(s,r,null,i),!a)throw new RangeError("Empty text nodes are not allowed");this.text=a}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):$Y(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(s,r){return this.text.slice(s,r)}get nodeSize(){return this.text.length}mark(s){return s==this.marks?this:new CN(this.type,this.attrs,this.text,s)}withText(s){return s==this.text?this:new CN(this.type,this.attrs,s,this.marks)}cut(s=0,r=this.text.length){return s==0&&r==this.text.length?this:this.withText(this.text.slice(s,r))}eq(s){return this.sameMarkup(s)&&this.text==s.text}toJSON(){let s=super.toJSON();return s.text=this.text,s}}function $Y(t,s){for(let r=t.length-1;r>=0;r--)s=t[r].type.name+"("+s+")";return s}class Xh{constructor(s){this.validEnd=s,this.next=[],this.wrapCache=[]}static parse(s,r){let a=new O4e(s,r);if(a.next==null)return Xh.empty;let i=zY(a);a.next&&a.err("Unexpected trailing text");let l=U4e(z4e(i));return V4e(l,a),l}matchType(s){for(let r=0;r<this.next.length;r++)if(this.next[r].type==s)return this.next[r].next;return null}matchFragment(s,r=0,a=s.childCount){let i=this;for(let l=r;i&&l<a;l++)i=i.matchType(s.child(l).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let s=0;s<this.next.length;s++){let{type:r}=this.next[s];if(!(r.isText||r.hasRequiredAttrs()))return r}return null}compatible(s){for(let r=0;r<this.next.length;r++)for(let a=0;a<s.next.length;a++)if(this.next[r].type==s.next[a].type)return!0;return!1}fillBefore(s,r=!1,a=0){let i=[this];function l(o,c){let d=o.matchFragment(s,a);if(d&&(!r||d.validEnd))return vt.from(c.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:m,next:x}=o.next[u];if(!(m.isText||m.hasRequiredAttrs())&&i.indexOf(x)==-1){i.push(x);let g=l(x,c.concat(m));if(g)return g}}return null}return l(this,[])}findWrapping(s){for(let a=0;a<this.wrapCache.length;a+=2)if(this.wrapCache[a]==s)return this.wrapCache[a+1];let r=this.computeWrapping(s);return this.wrapCache.push(s,r),r}computeWrapping(s){let r=Object.create(null),a=[{match:this,type:null,via:null}];for(;a.length;){let i=a.shift(),l=i.match;if(l.matchType(s)){let o=[];for(let c=i;c.type;c=c.via)o.push(c.type);return o.reverse()}for(let o=0;o<l.next.length;o++){let{type:c,next:d}=l.next[o];!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in r)&&(!i.type||d.validEnd)&&(a.push({match:c.contentMatch,type:c,via:i}),r[c.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(s){if(s>=this.next.length)throw new RangeError(`There's no ${s}th edge in this content match`);return this.next[s]}toString(){let s=[];function r(a){s.push(a);for(let i=0;i<a.next.length;i++)s.indexOf(a.next[i].next)==-1&&r(a.next[i].next)}return r(this),s.map((a,i)=>{let l=i+(a.validEnd?"*":" ")+" ";for(let o=0;o<a.next.length;o++)l+=(o?", ":"")+a.next[o].type.name+"->"+s.indexOf(a.next[o].next);return l}).join(`
`)}}Xh.empty=new Xh(!0);class O4e{constructor(s,r){this.string=s,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=s.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(s){return this.next==s&&(this.pos++||!0)}err(s){throw new SyntaxError(s+" (in content expression '"+this.string+"')")}}function zY(t){let s=[];do s.push(R4e(t));while(t.eat("|"));return s.length==1?s[0]:{type:"choice",exprs:s}}function R4e(t){let s=[];do s.push(L4e(t));while(t.next&&t.next!=")"&&t.next!="|");return s.length==1?s[0]:{type:"seq",exprs:s}}function L4e(t){let s=$4e(t);for(;;)if(t.eat("+"))s={type:"plus",expr:s};else if(t.eat("*"))s={type:"star",expr:s};else if(t.eat("?"))s={type:"opt",expr:s};else if(t.eat("{"))s=F4e(t,s);else break;return s}function bL(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let s=Number(t.next);return t.pos++,s}function F4e(t,s){let r=bL(t),a=r;return t.eat(",")&&(t.next!="}"?a=bL(t):a=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:a,expr:s}}function B4e(t,s){let r=t.nodeTypes,a=r[s];if(a)return[a];let i=[];for(let l in r){let o=r[l];o.isInGroup(s)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+s+"' found"),i}function $4e(t){if(t.eat("(")){let s=zY(t);return t.eat(")")||t.err("Missing closing paren"),s}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let s=B4e(t,t.next).map(r=>(t.inline==null?t.inline=r.isInline:t.inline!=r.isInline&&t.err("Mixing inline and block content"),{type:"name",value:r}));return t.pos++,s.length==1?s[0]:{type:"choice",exprs:s}}}function z4e(t){let s=[[]];return i(l(t,0),r()),s;function r(){return s.push([])-1}function a(o,c,d){let u={term:d,to:c};return s[o].push(u),u}function i(o,c){o.forEach(d=>d.to=c)}function l(o,c){if(o.type=="choice")return o.exprs.reduce((d,u)=>d.concat(l(u,c)),[]);if(o.type=="seq")for(let d=0;;d++){let u=l(o.exprs[d],c);if(d==o.exprs.length-1)return u;i(u,c=r())}else if(o.type=="star"){let d=r();return a(c,d),i(l(o.expr,d),d),[a(d)]}else if(o.type=="plus"){let d=r();return i(l(o.expr,c),d),i(l(o.expr,d),d),[a(d)]}else{if(o.type=="opt")return[a(c)].concat(l(o.expr,c));if(o.type=="range"){let d=c;for(let u=0;u<o.min;u++){let m=r();i(l(o.expr,d),m),d=m}if(o.max==-1)i(l(o.expr,d),d);else for(let u=o.min;u<o.max;u++){let m=r();a(d,m),i(l(o.expr,d),m),d=m}return[a(d)]}else{if(o.type=="name")return[a(c,void 0,o.value)];throw new Error("Unknown expr type")}}}}function UY(t,s){return s-t}function yL(t,s){let r=[];return a(s),r.sort(UY);function a(i){let l=t[i];if(l.length==1&&!l[0].term)return a(l[0].to);r.push(i);for(let o=0;o<l.length;o++){let{term:c,to:d}=l[o];!c&&r.indexOf(d)==-1&&a(d)}}}function U4e(t){let s=Object.create(null);return r(yL(t,0));function r(a){let i=[];a.forEach(o=>{t[o].forEach(({term:c,to:d})=>{if(!c)return;let u;for(let m=0;m<i.length;m++)i[m][0]==c&&(u=i[m][1]);yL(t,d).forEach(m=>{u||i.push([c,u=[]]),u.indexOf(m)==-1&&u.push(m)})})});let l=s[a.join(",")]=new Xh(a.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let c=i[o][1].sort(UY);l.next.push({type:i[o][0],next:s[c.join(",")]||r(c)})}return l}}function V4e(t,s){for(let r=0,a=[t];r<a.length;r++){let i=a[r],l=!i.validEnd,o=[];for(let c=0;c<i.next.length;c++){let{type:d,next:u}=i.next[c];o.push(d.name),l&&!(d.isText||d.hasRequiredAttrs())&&(l=!1),a.indexOf(u)==-1&&a.push(u)}l&&s.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function VY(t){let s=Object.create(null);for(let r in t){let a=t[r];if(!a.hasDefault)return null;s[r]=a.default}return s}function HY(t,s){let r=Object.create(null);for(let a in t){let i=s&&s[a];if(i===void 0){let l=t[a];if(l.hasDefault)i=l.default;else throw new RangeError("No value supplied for attribute "+a)}r[a]=i}return r}function WY(t,s,r,a){for(let i in s)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${r} of type ${i}`);for(let i in t){let l=t[i];l.validate&&l.validate(s[i])}}function qY(t,s){let r=Object.create(null);if(s)for(let a in s)r[a]=new W4e(t,a,s[a]);return r}let vL=class GY{constructor(s,r,a){this.name=s,this.schema=r,this.spec=a,this.markSet=null,this.groups=a.group?a.group.split(" "):[],this.attrs=qY(s,a.attrs),this.defaultAttrs=VY(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(a.inline||s=="text"),this.isText=s=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Xh.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(s){return this.groups.indexOf(s)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let s in this.attrs)if(this.attrs[s].isRequired)return!0;return!1}compatibleContent(s){return this==s||this.contentMatch.compatible(s.contentMatch)}computeAttrs(s){return!s&&this.defaultAttrs?this.defaultAttrs:HY(this.attrs,s)}create(s=null,r,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new lm(this,this.computeAttrs(s),vt.from(r),qn.setFrom(a))}createChecked(s=null,r,a){return r=vt.from(r),this.checkContent(r),new lm(this,this.computeAttrs(s),r,qn.setFrom(a))}createAndFill(s=null,r,a){if(s=this.computeAttrs(s),r=vt.from(r),r.size){let o=this.contentMatch.fillBefore(r);if(!o)return null;r=o.append(r)}let i=this.contentMatch.matchFragment(r),l=i&&i.fillBefore(vt.empty,!0);return l?new lm(this,s,r.append(l),qn.setFrom(a)):null}validContent(s){let r=this.contentMatch.matchFragment(s);if(!r||!r.validEnd)return!1;for(let a=0;a<s.childCount;a++)if(!this.allowsMarks(s.child(a).marks))return!1;return!0}checkContent(s){if(!this.validContent(s))throw new RangeError(`Invalid content for node ${this.name}: ${s.toString().slice(0,50)}`)}checkAttrs(s){WY(this.attrs,s,"node",this.name)}allowsMarkType(s){return this.markSet==null||this.markSet.indexOf(s)>-1}allowsMarks(s){if(this.markSet==null)return!0;for(let r=0;r<s.length;r++)if(!this.allowsMarkType(s[r].type))return!1;return!0}allowedMarks(s){if(this.markSet==null)return s;let r;for(let a=0;a<s.length;a++)this.allowsMarkType(s[a].type)?r&&r.push(s[a]):r||(r=s.slice(0,a));return r?r.length?r:qn.none:s}static compile(s,r){let a=Object.create(null);s.forEach((l,o)=>a[l]=new GY(l,r,o));let i=r.spec.topNode||"doc";if(!a[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(let l in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a}};function H4e(t,s,r){let a=r.split("|");return i=>{let l=i===null?"null":typeof i;if(a.indexOf(l)<0)throw new RangeError(`Expected value of type ${a} for attribute ${s} on type ${t}, got ${l}`)}}class W4e{constructor(s,r,a){this.hasDefault=Object.prototype.hasOwnProperty.call(a,"default"),this.default=a.default,this.validate=typeof a.validate=="string"?H4e(s,r,a.validate):a.validate}get isRequired(){return!this.hasDefault}}class Y2{constructor(s,r,a,i){this.name=s,this.rank=r,this.schema=a,this.spec=i,this.attrs=qY(s,i.attrs),this.excluded=null;let l=VY(this.attrs);this.instance=l?new qn(this,l):null}create(s=null){return!s&&this.instance?this.instance:new qn(this,HY(this.attrs,s))}static compile(s,r){let a=Object.create(null),i=0;return s.forEach((l,o)=>a[l]=new Y2(l,i++,r,o)),a}removeFromSet(s){for(var r=0;r<s.length;r++)s[r].type==this&&(s=s.slice(0,r).concat(s.slice(r+1)),r--);return s}isInSet(s){for(let r=0;r<s.length;r++)if(s[r].type==this)return s[r]}checkAttrs(s){WY(this.attrs,s,"mark",this.name)}excludes(s){return this.excluded.indexOf(s)>-1}}class KY{constructor(s){this.linebreakReplacement=null,this.cached=Object.create(null);let r=this.spec={};for(let i in s)r[i]=s[i];r.nodes=Fa.from(s.nodes),r.marks=Fa.from(s.marks||{}),this.nodes=vL.compile(this.spec.nodes,this),this.marks=Y2.compile(this.spec.marks,this);let a=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let l=this.nodes[i],o=l.spec.content||"",c=l.spec.marks;if(l.contentMatch=a[o]||(a[o]=Xh.parse(o,this.nodes)),l.inlineContent=l.contentMatch.inlineContent,l.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!l.isInline||!l.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=l}l.markSet=c=="_"?null:c?jL(this,c.split(" ")):c==""||!l.inlineContent?[]:null}for(let i in this.marks){let l=this.marks[i],o=l.spec.excludes;l.excluded=o==null?[l]:o==""?[]:jL(this,o.split(" "))}this.nodeFromJSON=i=>lm.fromJSON(this,i),this.markFromJSON=i=>qn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(s,r=null,a,i){if(typeof s=="string")s=this.nodeType(s);else if(s instanceof vL){if(s.schema!=this)throw new RangeError("Node type from different schema used ("+s.name+")")}else throw new RangeError("Invalid node type: "+s);return s.createChecked(r,a,i)}text(s,r){let a=this.nodes.text;return new CN(a,a.defaultAttrs,s,qn.setFrom(r))}mark(s,r){return typeof s=="string"&&(s=this.marks[s]),s.create(r)}nodeType(s){let r=this.nodes[s];if(!r)throw new RangeError("Unknown node type: "+s);return r}}function jL(t,s){let r=[];for(let a=0;a<s.length;a++){let i=s[a],l=t.marks[i],o=l;if(l)r.push(l);else for(let c in t.marks){let d=t.marks[c];(i=="_"||d.spec.group&&d.spec.group.split(" ").indexOf(i)>-1)&&r.push(o=d)}if(!o)throw new SyntaxError("Unknown mark type: '"+s[a]+"'")}return r}function q4e(t){return t.tag!=null}function G4e(t){return t.style!=null}let Ah=class T4{constructor(s,r){this.schema=s,this.rules=r,this.tags=[],this.styles=[];let a=this.matchedStyles=[];r.forEach(i=>{if(q4e(i))this.tags.push(i);else if(G4e(i)){let l=/[^=]*/.exec(i.style)[0];a.indexOf(l)<0&&a.push(l),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let l=s.nodes[i.node];return l.contentMatch.matchType(l)})}parse(s,r={}){let a=new wL(this,r,!1);return a.addAll(s,qn.none,r.from,r.to),a.finish()}parseSlice(s,r={}){let a=new wL(this,r,!0);return a.addAll(s,qn.none,r.from,r.to),Mt.maxOpen(a.finish())}matchTag(s,r,a){for(let i=a?this.tags.indexOf(a)+1:0;i<this.tags.length;i++){let l=this.tags[i];if(X4e(s,l.tag)&&(l.namespace===void 0||s.namespaceURI==l.namespace)&&(!l.context||r.matchesContext(l.context))){if(l.getAttrs){let o=l.getAttrs(s);if(o===!1)continue;l.attrs=o||void 0}return l}}}matchStyle(s,r,a,i){for(let l=i?this.styles.indexOf(i)+1:0;l<this.styles.length;l++){let o=this.styles[l],c=o.style;if(!(c.indexOf(s)!=0||o.context&&!a.matchesContext(o.context)||c.length>s.length&&(c.charCodeAt(s.length)!=61||c.slice(s.length+1)!=r))){if(o.getAttrs){let d=o.getAttrs(r);if(d===!1)continue;o.attrs=d||void 0}return o}}}static schemaRules(s){let r=[];function a(i){let l=i.priority==null?50:i.priority,o=0;for(;o<r.length;o++){let c=r[o];if((c.priority==null?50:c.priority)<l)break}r.splice(o,0,i)}for(let i in s.marks){let l=s.marks[i].spec.parseDOM;l&&l.forEach(o=>{a(o=_L(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in s.nodes){let l=s.nodes[i].spec.parseDOM;l&&l.forEach(o=>{a(o=_L(o)),o.node||o.ignore||o.mark||(o.node=i)})}return r}static fromSchema(s){return s.cached.domParser||(s.cached.domParser=new T4(s,T4.schemaRules(s)))}};const YY={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},K4e={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},XY={ol:!0,ul:!0},wb=1,P4=2,Pg=4;function NL(t,s,r){return s!=null?(s?wb:0)|(s==="full"?P4:0):t&&t.whitespace=="pre"?wb|P4:r&~Pg}class W1{constructor(s,r,a,i,l,o){this.type=s,this.attrs=r,this.marks=a,this.solid=i,this.options=o,this.content=[],this.activeMarks=qn.none,this.match=l||(o&Pg?null:s.contentMatch)}findWrapping(s){if(!this.match){if(!this.type)return[];let r=this.type.contentMatch.fillBefore(vt.from(s));if(r)this.match=this.type.contentMatch.matchFragment(r);else{let a=this.type.contentMatch,i;return(i=a.findWrapping(s.type))?(this.match=a,i):null}}return this.match.findWrapping(s.type)}finish(s){if(!(this.options&wb)){let a=this.content[this.content.length-1],i;if(a&&a.isText&&(i=/[ \t\r\n\u000c]+$/.exec(a.text))){let l=a;a.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=l.withText(l.text.slice(0,l.text.length-i[0].length))}}let r=vt.from(this.content);return!s&&this.match&&(r=r.append(this.match.fillBefore(vt.empty,!0))),this.type?this.type.create(this.attrs,r,this.marks):r}inlineContext(s){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:s.parentNode&&!YY.hasOwnProperty(s.parentNode.nodeName.toLowerCase())}}class wL{constructor(s,r,a){this.parser=s,this.options=r,this.isOpen=a,this.open=0,this.localPreserveWS=!1;let i=r.topNode,l,o=NL(null,r.preserveWhitespace,0)|(a?Pg:0);i?l=new W1(i.type,i.attrs,qn.none,!0,r.topMatch||i.type.contentMatch,o):a?l=new W1(null,null,qn.none,!0,null,o):l=new W1(s.schema.topNodeType,null,qn.none,!0,null,o),this.nodes=[l],this.find=r.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(s,r){s.nodeType==3?this.addTextNode(s,r):s.nodeType==1&&this.addElement(s,r)}addTextNode(s,r){let a=s.nodeValue,i=this.top,l=i.options&P4?"full":this.localPreserveWS||(i.options&wb)>0,{schema:o}=this.parser;if(l==="full"||i.inlineContext(s)||/[^ \t\r\n\u000c]/.test(a)){if(l)if(l==="full")a=a.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(a)&&this.top.findWrapping(o.linebreakReplacement.create())){let c=a.split(/\r?\n|\r/);for(let d=0;d<c.length;d++)d&&this.insertNode(o.linebreakReplacement.create(),r,!0),c[d]&&this.insertNode(o.text(c[d]),r,!/\S/.test(c[d]));a=""}else a=a.replace(/\r?\n|\r/g," ");else if(a=a.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(a)&&this.open==this.nodes.length-1){let c=i.content[i.content.length-1],d=s.previousSibling;(!c||d&&d.nodeName=="BR"||c.isText&&/[ \t\r\n\u000c]$/.test(c.text))&&(a=a.slice(1))}a&&this.insertNode(o.text(a),r,!/\S/.test(a)),this.findInText(s)}else this.findInside(s)}addElement(s,r,a){let i=this.localPreserveWS,l=this.top;(s.tagName=="PRE"||/pre/.test(s.style&&s.style.whiteSpace))&&(this.localPreserveWS=!0);let o=s.nodeName.toLowerCase(),c;XY.hasOwnProperty(o)&&this.parser.normalizeLists&&Y4e(s);let d=this.options.ruleFromNode&&this.options.ruleFromNode(s)||(c=this.parser.matchTag(s,this,a));e:if(d?d.ignore:K4e.hasOwnProperty(o))this.findInside(s),this.ignoreFallback(s,r);else if(!d||d.skip||d.closeParent){d&&d.closeParent?this.open=Math.max(0,this.open-1):d&&d.skip.nodeType&&(s=d.skip);let u,m=this.needsBlock;if(YY.hasOwnProperty(o))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),u=!0,l.type||(this.needsBlock=!0);else if(!s.firstChild){this.leafFallback(s,r);break e}let x=d&&d.skip?r:this.readStyles(s,r);x&&this.addAll(s,x),u&&this.sync(l),this.needsBlock=m}else{let u=this.readStyles(s,r);u&&this.addElementByRule(s,d,u,d.consuming===!1?c:void 0)}this.localPreserveWS=i}leafFallback(s,r){s.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(s.ownerDocument.createTextNode(`
`),r)}ignoreFallback(s,r){s.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),r,!0)}readStyles(s,r){let a=s.style;if(a&&a.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let l=this.parser.matchedStyles[i],o=a.getPropertyValue(l);if(o)for(let c=void 0;;){let d=this.parser.matchStyle(l,o,this,c);if(!d)break;if(d.ignore)return null;if(d.clearMark?r=r.filter(u=>!d.clearMark(u)):r=r.concat(this.parser.schema.marks[d.mark].create(d.attrs)),d.consuming===!1)c=d;else break}}return r}addElementByRule(s,r,a,i){let l,o;if(r.node)if(o=this.parser.schema.nodes[r.node],o.isLeaf)this.insertNode(o.create(r.attrs),a,s.nodeName=="BR")||this.leafFallback(s,a);else{let d=this.enter(o,r.attrs||null,a,r.preserveWhitespace);d&&(l=!0,a=d)}else{let d=this.parser.schema.marks[r.mark];a=a.concat(d.create(r.attrs))}let c=this.top;if(o&&o.isLeaf)this.findInside(s);else if(i)this.addElement(s,a,i);else if(r.getContent)this.findInside(s),r.getContent(s,this.parser.schema).forEach(d=>this.insertNode(d,a,!1));else{let d=s;typeof r.contentElement=="string"?d=s.querySelector(r.contentElement):typeof r.contentElement=="function"?d=r.contentElement(s):r.contentElement&&(d=r.contentElement),this.findAround(s,d,!0),this.addAll(d,a),this.findAround(s,d,!1)}l&&this.sync(c)&&this.open--}addAll(s,r,a,i){let l=a||0;for(let o=a?s.childNodes[a]:s.firstChild,c=i==null?null:s.childNodes[i];o!=c;o=o.nextSibling,++l)this.findAtPoint(s,l),this.addDOM(o,r);this.findAtPoint(s,l)}findPlace(s,r,a){let i,l;for(let o=this.open,c=0;o>=0;o--){let d=this.nodes[o],u=d.findWrapping(s);if(u&&(!i||i.length>u.length+c)&&(i=u,l=d,!u.length))break;if(d.solid){if(a)break;c+=2}}if(!i)return null;this.sync(l);for(let o=0;o<i.length;o++)r=this.enterInner(i[o],null,r,!1);return r}insertNode(s,r,a){if(s.isInline&&this.needsBlock&&!this.top.type){let l=this.textblockFromContext();l&&(r=this.enterInner(l,null,r))}let i=this.findPlace(s,r,a);if(i){this.closeExtra();let l=this.top;l.match&&(l.match=l.match.matchType(s.type));let o=qn.none;for(let c of i.concat(s.marks))(l.type?l.type.allowsMarkType(c.type):SL(c.type,s.type))&&(o=c.addToSet(o));return l.content.push(s.mark(o)),!0}return!1}enter(s,r,a,i){let l=this.findPlace(s.create(r),a,!1);return l&&(l=this.enterInner(s,r,a,!0,i)),l}enterInner(s,r,a,i=!1,l){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(s);let c=NL(s,l,o.options);o.options&Pg&&o.content.length==0&&(c|=Pg);let d=qn.none;return a=a.filter(u=>(o.type?o.type.allowsMarkType(u.type):SL(u.type,s))?(d=u.addToSet(d),!1):!0),this.nodes.push(new W1(s,r,d,i,null,c)),this.open++,a}closeExtra(s=!1){let r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(s));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(s){for(let r=this.open;r>=0;r--){if(this.nodes[r]==s)return this.open=r,!0;this.localPreserveWS&&(this.nodes[r].options|=wb)}return!1}get currentPos(){this.closeExtra();let s=0;for(let r=this.open;r>=0;r--){let a=this.nodes[r].content;for(let i=a.length-1;i>=0;i--)s+=a[i].nodeSize;r&&s++}return s}findAtPoint(s,r){if(this.find)for(let a=0;a<this.find.length;a++)this.find[a].node==s&&this.find[a].offset==r&&(this.find[a].pos=this.currentPos)}findInside(s){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&s.nodeType==1&&s.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)}findAround(s,r,a){if(s!=r&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&s.nodeType==1&&s.contains(this.find[i].node)&&r.compareDocumentPosition(this.find[i].node)&(a?2:4)&&(this.find[i].pos=this.currentPos)}findInText(s){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==s&&(this.find[r].pos=this.currentPos-(s.nodeValue.length-this.find[r].offset))}matchesContext(s){if(s.indexOf("|")>-1)return s.split(/\s*\|\s*/).some(this.matchesContext,this);let r=s.split("/"),a=this.options.context,i=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),l=-(a?a.depth+1:0)+(i?0:1),o=(c,d)=>{for(;c>=0;c--){let u=r[c];if(u==""){if(c==r.length-1||c==0)continue;for(;d>=l;d--)if(o(c-1,d))return!0;return!1}else{let m=d>0||d==0&&i?this.nodes[d].type:a&&d>=l?a.node(d-l).type:null;if(!m||m.name!=u&&!m.isInGroup(u))return!1;d--}}return!0};return o(r.length-1,this.open)}textblockFromContext(){let s=this.options.context;if(s)for(let r=s.depth;r>=0;r--){let a=s.node(r).contentMatchAt(s.indexAfter(r)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(let r in this.parser.schema.nodes){let a=this.parser.schema.nodes[r];if(a.isTextblock&&a.defaultAttrs)return a}}}function Y4e(t){for(let s=t.firstChild,r=null;s;s=s.nextSibling){let a=s.nodeType==1?s.nodeName.toLowerCase():null;a&&XY.hasOwnProperty(a)&&r?(r.appendChild(s),s=r):a=="li"?r=s:a&&(r=null)}}function X4e(t,s){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,s)}function _L(t){let s={};for(let r in t)s[r]=t[r];return s}function SL(t,s){let r=s.schema.nodes;for(let a in r){let i=r[a];if(!i.allowsMarkType(t))continue;let l=[],o=c=>{l.push(c);for(let d=0;d<c.edgeCount;d++){let{type:u,next:m}=c.edge(d);if(u==s||l.indexOf(m)<0&&o(m))return!0}};if(o(i.contentMatch))return!0}}class X2{constructor(s,r){this.nodes=s,this.marks=r}serializeFragment(s,r={},a){a||(a=hk(r).createDocumentFragment());let i=a,l=[];return s.forEach(o=>{if(l.length||o.marks.length){let c=0,d=0;for(;c<l.length&&d<o.marks.length;){let u=o.marks[d];if(!this.marks[u.type.name]){d++;continue}if(!u.eq(l[c][0])||u.type.spec.spanning===!1)break;c++,d++}for(;c<l.length;)i=l.pop()[1];for(;d<o.marks.length;){let u=o.marks[d++],m=this.serializeMark(u,o.isInline,r);m&&(l.push([u,i]),i.appendChild(m.dom),i=m.contentDOM||m.dom)}}i.appendChild(this.serializeNodeInner(o,r))}),a}serializeNodeInner(s,r){let{dom:a,contentDOM:i}=pj(hk(r),this.nodes[s.type.name](s),null,s.attrs);if(i){if(s.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(s.content,r,i)}return a}serializeNode(s,r={}){let a=this.serializeNodeInner(s,r);for(let i=s.marks.length-1;i>=0;i--){let l=this.serializeMark(s.marks[i],s.isInline,r);l&&((l.contentDOM||l.dom).appendChild(a),a=l.dom)}return a}serializeMark(s,r,a={}){let i=this.marks[s.type.name];return i&&pj(hk(a),i(s,r),null,s.attrs)}static renderSpec(s,r,a=null,i){return pj(s,r,a,i)}static fromSchema(s){return s.cached.domSerializer||(s.cached.domSerializer=new X2(this.nodesFromSchema(s),this.marksFromSchema(s)))}static nodesFromSchema(s){let r=CL(s.nodes);return r.text||(r.text=a=>a.text),r}static marksFromSchema(s){return CL(s.marks)}}function CL(t){let s={};for(let r in t){let a=t[r].spec.toDOM;a&&(s[r]=a)}return s}function hk(t){return t.document||window.document}const kL=new WeakMap;function Q4e(t){let s=kL.get(t);return s===void 0&&kL.set(t,s=Z4e(t)),s}function Z4e(t){let s=null;function r(a){if(a&&typeof a=="object")if(Array.isArray(a))if(typeof a[0]=="string")s||(s=[]),s.push(a);else for(let i=0;i<a.length;i++)r(a[i]);else for(let i in a)r(a[i])}return r(t),s}function pj(t,s,r,a){if(typeof s=="string")return{dom:t.createTextNode(s)};if(s.nodeType!=null)return{dom:s};if(s.dom&&s.dom.nodeType!=null)return s;let i=s[0],l;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(a&&(l=Q4e(a))&&l.indexOf(s)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(r=i.slice(0,o),i=i.slice(o+1));let c,d=r?t.createElementNS(r,i):t.createElement(i),u=s[1],m=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){m=2;for(let x in u)if(u[x]!=null){let g=x.indexOf(" ");g>0?d.setAttributeNS(x.slice(0,g),x.slice(g+1),u[x]):x=="style"&&d.style?d.style.cssText=u[x]:d.setAttribute(x,u[x])}}for(let x=m;x<s.length;x++){let g=s[x];if(g===0){if(x<s.length-1||x>m)throw new RangeError("Content hole must be the only child of its parent node");return{dom:d,contentDOM:d}}else{let{dom:y,contentDOM:v}=pj(t,g,r,a);if(d.appendChild(y),v){if(c)throw new RangeError("Multiple content holes");c=v}}}return{dom:d,contentDOM:c}}const QY=65535,ZY=Math.pow(2,16);function J4e(t,s){return t+s*ZY}function AL(t){return t&QY}function eAe(t){return(t-(t&QY))/ZY}const JY=1,eX=2,fj=4,tX=8;class D4{constructor(s,r,a){this.pos=s,this.delInfo=r,this.recover=a}get deleted(){return(this.delInfo&tX)>0}get deletedBefore(){return(this.delInfo&(JY|fj))>0}get deletedAfter(){return(this.delInfo&(eX|fj))>0}get deletedAcross(){return(this.delInfo&fj)>0}}class Dl{constructor(s,r=!1){if(this.ranges=s,this.inverted=r,!s.length&&Dl.empty)return Dl.empty}recover(s){let r=0,a=AL(s);if(!this.inverted)for(let i=0;i<a;i++)r+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[a*3]+r+eAe(s)}mapResult(s,r=1){return this._map(s,r,!1)}map(s,r=1){return this._map(s,r,!0)}_map(s,r,a){let i=0,l=this.inverted?2:1,o=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let d=this.ranges[c]-(this.inverted?i:0);if(d>s)break;let u=this.ranges[c+l],m=this.ranges[c+o],x=d+u;if(s<=x){let g=u?s==d?-1:s==x?1:r:r,y=d+i+(g<0?0:m);if(a)return y;let v=s==(r<0?d:x)?null:J4e(c/3,s-d),j=s==d?eX:s==x?JY:fj;return(r<0?s!=d:s!=x)&&(j|=tX),new D4(y,j,v)}i+=m-u}return a?s+i:new D4(s+i,0,null)}touches(s,r){let a=0,i=AL(r),l=this.inverted?2:1,o=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let d=this.ranges[c]-(this.inverted?a:0);if(d>s)break;let u=this.ranges[c+l],m=d+u;if(s<=m&&c==i*3)return!0;a+=this.ranges[c+o]-u}return!1}forEach(s){let r=this.inverted?2:1,a=this.inverted?1:2;for(let i=0,l=0;i<this.ranges.length;i+=3){let o=this.ranges[i],c=o-(this.inverted?l:0),d=o+(this.inverted?0:l),u=this.ranges[i+r],m=this.ranges[i+a];s(c,c+u,d,d+m),l+=m-u}}invert(){return new Dl(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(s){return s==0?Dl.empty:new Dl(s<0?[0,-s,0]:[0,0,s])}}Dl.empty=new Dl([]);class _b{constructor(s,r,a=0,i=s?s.length:0){this.mirror=r,this.from=a,this.to=i,this._maps=s||[],this.ownData=!(s||r)}get maps(){return this._maps}slice(s=0,r=this.maps.length){return new _b(this._maps,this.mirror,s,r)}appendMap(s,r){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(s),r!=null&&this.setMirror(this._maps.length-1,r)}appendMapping(s){for(let r=0,a=this._maps.length;r<s._maps.length;r++){let i=s.getMirror(r);this.appendMap(s._maps[r],i!=null&&i<r?a+i:void 0)}}getMirror(s){if(this.mirror){for(let r=0;r<this.mirror.length;r++)if(this.mirror[r]==s)return this.mirror[r+(r%2?-1:1)]}}setMirror(s,r){this.mirror||(this.mirror=[]),this.mirror.push(s,r)}appendMappingInverted(s){for(let r=s.maps.length-1,a=this._maps.length+s._maps.length;r>=0;r--){let i=s.getMirror(r);this.appendMap(s._maps[r].invert(),i!=null&&i>r?a-i-1:void 0)}}invert(){let s=new _b;return s.appendMappingInverted(this),s}map(s,r=1){if(this.mirror)return this._map(s,r,!0);for(let a=this.from;a<this.to;a++)s=this._maps[a].map(s,r);return s}mapResult(s,r=1){return this._map(s,r,!1)}_map(s,r,a){let i=0;for(let l=this.from;l<this.to;l++){let o=this._maps[l],c=o.mapResult(s,r);if(c.recover!=null){let d=this.getMirror(l);if(d!=null&&d>l&&d<this.to){l=d,s=this._maps[d].recover(c.recover);continue}}i|=c.delInfo,s=c.pos}return a?s:new D4(s,i,null)}}const xk=Object.create(null);let fi=class{getMap(){return Dl.empty}merge(s){return null}static fromJSON(s,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");let a=xk[r.stepType];if(!a)throw new RangeError(`No step type ${r.stepType} defined`);return a.fromJSON(s,r)}static jsonID(s,r){if(s in xk)throw new RangeError("Duplicate use of step JSON ID "+s);return xk[s]=r,r.prototype.jsonID=s,r}};class Gr{constructor(s,r){this.doc=s,this.failed=r}static ok(s){return new Gr(s,null)}static fail(s){return new Gr(null,s)}static fromReplace(s,r,a,i){try{return Gr.ok(s.replace(r,a,i))}catch(l){if(l instanceof wN)return Gr.fail(l.message);throw l}}}function wP(t,s,r){let a=[];for(let i=0;i<t.childCount;i++){let l=t.child(i);l.content.size&&(l=l.copy(wP(l.content,s,l))),l.isInline&&(l=s(l,r,i)),a.push(l)}return vt.fromArray(a)}class Yu extends fi{constructor(s,r,a){super(),this.from=s,this.to=r,this.mark=a}apply(s){let r=s.slice(this.from,this.to),a=s.resolve(this.from),i=a.node(a.sharedDepth(this.to)),l=new Mt(wP(r.content,(o,c)=>!o.isAtom||!c.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),r.openStart,r.openEnd);return Gr.fromReplace(s,this.from,this.to,l)}invert(){return new lc(this.from,this.to,this.mark)}map(s){let r=s.mapResult(this.from,1),a=s.mapResult(this.to,-1);return r.deleted&&a.deleted||r.pos>=a.pos?null:new Yu(r.pos,a.pos,this.mark)}merge(s){return s instanceof Yu&&s.mark.eq(this.mark)&&this.from<=s.to&&this.to>=s.from?new Yu(Math.min(this.from,s.from),Math.max(this.to,s.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(s,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Yu(r.from,r.to,s.markFromJSON(r.mark))}}fi.jsonID("addMark",Yu);class lc extends fi{constructor(s,r,a){super(),this.from=s,this.to=r,this.mark=a}apply(s){let r=s.slice(this.from,this.to),a=new Mt(wP(r.content,i=>i.mark(this.mark.removeFromSet(i.marks)),s),r.openStart,r.openEnd);return Gr.fromReplace(s,this.from,this.to,a)}invert(){return new Yu(this.from,this.to,this.mark)}map(s){let r=s.mapResult(this.from,1),a=s.mapResult(this.to,-1);return r.deleted&&a.deleted||r.pos>=a.pos?null:new lc(r.pos,a.pos,this.mark)}merge(s){return s instanceof lc&&s.mark.eq(this.mark)&&this.from<=s.to&&this.to>=s.from?new lc(Math.min(this.from,s.from),Math.max(this.to,s.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(s,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new lc(r.from,r.to,s.markFromJSON(r.mark))}}fi.jsonID("removeMark",lc);class Xu extends fi{constructor(s,r){super(),this.pos=s,this.mark=r}apply(s){let r=s.nodeAt(this.pos);if(!r)return Gr.fail("No node at mark step's position");let a=r.type.create(r.attrs,null,this.mark.addToSet(r.marks));return Gr.fromReplace(s,this.pos,this.pos+1,new Mt(vt.from(a),0,r.isLeaf?0:1))}invert(s){let r=s.nodeAt(this.pos);if(r){let a=this.mark.addToSet(r.marks);if(a.length==r.marks.length){for(let i=0;i<r.marks.length;i++)if(!r.marks[i].isInSet(a))return new Xu(this.pos,r.marks[i]);return new Xu(this.pos,this.mark)}}return new Qh(this.pos,this.mark)}map(s){let r=s.mapResult(this.pos,1);return r.deletedAfter?null:new Xu(r.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(s,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Xu(r.pos,s.markFromJSON(r.mark))}}fi.jsonID("addNodeMark",Xu);class Qh extends fi{constructor(s,r){super(),this.pos=s,this.mark=r}apply(s){let r=s.nodeAt(this.pos);if(!r)return Gr.fail("No node at mark step's position");let a=r.type.create(r.attrs,null,this.mark.removeFromSet(r.marks));return Gr.fromReplace(s,this.pos,this.pos+1,new Mt(vt.from(a),0,r.isLeaf?0:1))}invert(s){let r=s.nodeAt(this.pos);return!r||!this.mark.isInSet(r.marks)?this:new Xu(this.pos,this.mark)}map(s){let r=s.mapResult(this.pos,1);return r.deletedAfter?null:new Qh(r.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(s,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Qh(r.pos,s.markFromJSON(r.mark))}}fi.jsonID("removeNodeMark",Qh);class la extends fi{constructor(s,r,a,i=!1){super(),this.from=s,this.to=r,this.slice=a,this.structure=i}apply(s){return this.structure&&M4(s,this.from,this.to)?Gr.fail("Structure replace would overwrite content"):Gr.fromReplace(s,this.from,this.to,this.slice)}getMap(){return new Dl([this.from,this.to-this.from,this.slice.size])}invert(s){return new la(this.from,this.from+this.slice.size,s.slice(this.from,this.to))}map(s){let r=s.mapResult(this.from,1),a=s.mapResult(this.to,-1);return r.deletedAcross&&a.deletedAcross?null:new la(r.pos,Math.max(r.pos,a.pos),this.slice,this.structure)}merge(s){if(!(s instanceof la)||s.structure||this.structure)return null;if(this.from+this.slice.size==s.from&&!this.slice.openEnd&&!s.slice.openStart){let r=this.slice.size+s.slice.size==0?Mt.empty:new Mt(this.slice.content.append(s.slice.content),this.slice.openStart,s.slice.openEnd);return new la(this.from,this.to+(s.to-s.from),r,this.structure)}else if(s.to==this.from&&!this.slice.openStart&&!s.slice.openEnd){let r=this.slice.size+s.slice.size==0?Mt.empty:new Mt(s.slice.content.append(this.slice.content),s.slice.openStart,this.slice.openEnd);return new la(s.from,this.to,r,this.structure)}else return null}toJSON(){let s={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(s.slice=this.slice.toJSON()),this.structure&&(s.structure=!0),s}static fromJSON(s,r){if(typeof r.from!="number"||typeof r.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new la(r.from,r.to,Mt.fromJSON(s,r.slice),!!r.structure)}}fi.jsonID("replace",la);class ma extends fi{constructor(s,r,a,i,l,o,c=!1){super(),this.from=s,this.to=r,this.gapFrom=a,this.gapTo=i,this.slice=l,this.insert=o,this.structure=c}apply(s){if(this.structure&&(M4(s,this.from,this.gapFrom)||M4(s,this.gapTo,this.to)))return Gr.fail("Structure gap-replace would overwrite content");let r=s.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd)return Gr.fail("Gap is not a flat range");let a=this.slice.insertAt(this.insert,r.content);return a?Gr.fromReplace(s,this.from,this.to,a):Gr.fail("Content does not fit in gap")}getMap(){return new Dl([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(s){let r=this.gapTo-this.gapFrom;return new ma(this.from,this.from+this.slice.size+r,this.from+this.insert,this.from+this.insert+r,s.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(s){let r=s.mapResult(this.from,1),a=s.mapResult(this.to,-1),i=this.from==this.gapFrom?r.pos:s.map(this.gapFrom,-1),l=this.to==this.gapTo?a.pos:s.map(this.gapTo,1);return r.deletedAcross&&a.deletedAcross||i<r.pos||l>a.pos?null:new ma(r.pos,a.pos,i,l,this.slice,this.insert,this.structure)}toJSON(){let s={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(s.slice=this.slice.toJSON()),this.structure&&(s.structure=!0),s}static fromJSON(s,r){if(typeof r.from!="number"||typeof r.to!="number"||typeof r.gapFrom!="number"||typeof r.gapTo!="number"||typeof r.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ma(r.from,r.to,r.gapFrom,r.gapTo,Mt.fromJSON(s,r.slice),r.insert,!!r.structure)}}fi.jsonID("replaceAround",ma);function M4(t,s,r){let a=t.resolve(s),i=r-s,l=a.depth;for(;i>0&&l>0&&a.indexAfter(l)==a.node(l).childCount;)l--,i--;if(i>0){let o=a.node(l).maybeChild(a.indexAfter(l));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function tAe(t,s,r,a){let i=[],l=[],o,c;t.doc.nodesBetween(s,r,(d,u,m)=>{if(!d.isInline)return;let x=d.marks;if(!a.isInSet(x)&&m.type.allowsMarkType(a.type)){let g=Math.max(u,s),y=Math.min(u+d.nodeSize,r),v=a.addToSet(x);for(let j=0;j<x.length;j++)x[j].isInSet(v)||(o&&o.to==g&&o.mark.eq(x[j])?o.to=y:i.push(o=new lc(g,y,x[j])));c&&c.to==g?c.to=y:l.push(c=new Yu(g,y,a))}}),i.forEach(d=>t.step(d)),l.forEach(d=>t.step(d))}function sAe(t,s,r,a){let i=[],l=0;t.doc.nodesBetween(s,r,(o,c)=>{if(!o.isInline)return;l++;let d=null;if(a instanceof Y2){let u=o.marks,m;for(;m=a.isInSet(u);)(d||(d=[])).push(m),u=m.removeFromSet(u)}else a?a.isInSet(o.marks)&&(d=[a]):d=o.marks;if(d&&d.length){let u=Math.min(c+o.nodeSize,r);for(let m=0;m<d.length;m++){let x=d[m],g;for(let y=0;y<i.length;y++){let v=i[y];v.step==l-1&&x.eq(i[y].style)&&(g=v)}g?(g.to=u,g.step=l):i.push({style:x,from:Math.max(c,s),to:u,step:l})}}}),i.forEach(o=>t.step(new lc(o.from,o.to,o.style)))}function _P(t,s,r,a=r.contentMatch,i=!0){let l=t.doc.nodeAt(s),o=[],c=s+1;for(let d=0;d<l.childCount;d++){let u=l.child(d),m=c+u.nodeSize,x=a.matchType(u.type);if(!x)o.push(new la(c,m,Mt.empty));else{a=x;for(let g=0;g<u.marks.length;g++)r.allowsMarkType(u.marks[g].type)||t.step(new lc(c,m,u.marks[g]));if(i&&u.isText&&r.whitespace!="pre"){let g,y=/\r?\n|\r/g,v;for(;g=y.exec(u.text);)v||(v=new Mt(vt.from(r.schema.text(" ",r.allowedMarks(u.marks))),0,0)),o.push(new la(c+g.index,c+g.index+g[0].length,v))}}c=m}if(!a.validEnd){let d=a.fillBefore(vt.empty,!0);t.replace(c,c,new Mt(d,0,0))}for(let d=o.length-1;d>=0;d--)t.step(o[d])}function nAe(t,s,r){return(s==0||t.canReplace(s,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function fx(t){let r=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let a=t.depth;;--a){let i=t.$from.node(a),l=t.$from.index(a),o=t.$to.indexAfter(a);if(a<t.depth&&i.canReplace(l,o,r))return a;if(a==0||i.type.spec.isolating||!nAe(i,l,o))break}return null}function rAe(t,s,r){let{$from:a,$to:i,depth:l}=s,o=a.before(l+1),c=i.after(l+1),d=o,u=c,m=vt.empty,x=0;for(let v=l,j=!1;v>r;v--)j||a.index(v)>0?(j=!0,m=vt.from(a.node(v).copy(m)),x++):d--;let g=vt.empty,y=0;for(let v=l,j=!1;v>r;v--)j||i.after(v+1)<i.end(v)?(j=!0,g=vt.from(i.node(v).copy(g)),y++):u++;t.step(new ma(d,u,o,c,new Mt(m.append(g),x,y),m.size-x,!0))}function SP(t,s,r=null,a=t){let i=aAe(t,s),l=i&&iAe(a,s);return l?i.map(EL).concat({type:s,attrs:r}).concat(l.map(EL)):null}function EL(t){return{type:t,attrs:null}}function aAe(t,s){let{parent:r,startIndex:a,endIndex:i}=t,l=r.contentMatchAt(a).findWrapping(s);if(!l)return null;let o=l.length?l[0]:s;return r.canReplaceWith(a,i,o)?l:null}function iAe(t,s){let{parent:r,startIndex:a,endIndex:i}=t,l=r.child(a),o=s.contentMatch.findWrapping(l.type);if(!o)return null;let d=(o.length?o[o.length-1]:s).contentMatch;for(let u=a;d&&u<i;u++)d=d.matchType(r.child(u).type);return!d||!d.validEnd?null:o}function lAe(t,s,r){let a=vt.empty;for(let o=r.length-1;o>=0;o--){if(a.size){let c=r[o].type.contentMatch.matchFragment(a);if(!c||!c.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}a=vt.from(r[o].type.create(r[o].attrs,a))}let i=s.start,l=s.end;t.step(new ma(i,l,i,l,new Mt(a,0,0),r.length,!0))}function oAe(t,s,r,a,i){if(!a.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let l=t.steps.length;t.doc.nodesBetween(s,r,(o,c)=>{let d=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(a,d)&&cAe(t.doc,t.mapping.slice(l).map(c),a)){let u=null;if(a.schema.linebreakReplacement){let y=a.whitespace=="pre",v=!!a.contentMatch.matchType(a.schema.linebreakReplacement);y&&!v?u=!1:!y&&v&&(u=!0)}u===!1&&nX(t,o,c,l),_P(t,t.mapping.slice(l).map(c,1),a,void 0,u===null);let m=t.mapping.slice(l),x=m.map(c,1),g=m.map(c+o.nodeSize,1);return t.step(new ma(x,g,x+1,g-1,new Mt(vt.from(a.create(d,null,o.marks)),0,0),1,!0)),u===!0&&sX(t,o,c,l),!1}})}function sX(t,s,r,a){s.forEach((i,l)=>{if(i.isText){let o,c=/\r?\n|\r/g;for(;o=c.exec(i.text);){let d=t.mapping.slice(a).map(r+1+l+o.index);t.replaceWith(d,d+1,s.type.schema.linebreakReplacement.create())}}})}function nX(t,s,r,a){s.forEach((i,l)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(a).map(r+1+l);t.replaceWith(o,o+1,s.type.schema.text(`
`))}})}function cAe(t,s,r){let a=t.resolve(s),i=a.index();return a.parent.canReplaceWith(i,i+1,r)}function dAe(t,s,r,a,i){let l=t.doc.nodeAt(s);if(!l)throw new RangeError("No node at given position");r||(r=l.type);let o=r.create(a,null,i||l.marks);if(l.isLeaf)return t.replaceWith(s,s+l.nodeSize,o);if(!r.validContent(l.content))throw new RangeError("Invalid content for node type "+r.name);t.step(new ma(s,s+l.nodeSize,s+1,s+l.nodeSize-1,new Mt(vt.from(o),0,0),1,!0))}function zl(t,s,r=1,a){let i=t.resolve(s),l=i.depth-r,o=a&&a[a.length-1]||i.parent;if(l<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,m=r-2;u>l;u--,m--){let x=i.node(u),g=i.index(u);if(x.type.spec.isolating)return!1;let y=x.content.cutByIndex(g,x.childCount),v=a&&a[m+1];v&&(y=y.replaceChild(0,v.type.create(v.attrs)));let j=a&&a[m]||x;if(!x.canReplace(g+1,x.childCount)||!j.type.validContent(y))return!1}let c=i.indexAfter(l),d=a&&a[0];return i.node(l).canReplaceWith(c,c,d?d.type:i.node(l+1).type)}function uAe(t,s,r=1,a){let i=t.doc.resolve(s),l=vt.empty,o=vt.empty;for(let c=i.depth,d=i.depth-r,u=r-1;c>d;c--,u--){l=vt.from(i.node(c).copy(l));let m=a&&a[u];o=vt.from(m?m.type.create(m.attrs,o):i.node(c).copy(o))}t.step(new la(s,s,new Mt(l.append(o),r,r),!0))}function pd(t,s){let r=t.resolve(s),a=r.index();return rX(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(a,a+1)}function mAe(t,s){s.content.size||t.type.compatibleContent(s.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:a}=t.type.schema;for(let i=0;i<s.childCount;i++){let l=s.child(i),o=l.type==a?t.type.schema.nodes.text:l.type;if(r=r.matchType(o),!r||!t.type.allowsMarks(l.marks))return!1}return r.validEnd}function rX(t,s){return!!(t&&s&&!t.isLeaf&&mAe(t,s))}function Of(t,s,r=-1){let a=t.resolve(s);for(let i=a.depth;;i--){let l,o,c=a.index(i);if(i==a.depth?(l=a.nodeBefore,o=a.nodeAfter):r>0?(l=a.node(i+1),c++,o=a.node(i).maybeChild(c)):(l=a.node(i).maybeChild(c-1),o=a.node(i+1)),l&&!l.isTextblock&&rX(l,o)&&a.node(i).canReplace(c,c+1))return s;if(i==0)break;s=r<0?a.before(i):a.after(i)}}function hAe(t,s,r){let a=null,{linebreakReplacement:i}=t.doc.type.schema,l=t.doc.resolve(s-r),o=l.node().type;if(i&&o.inlineContent){let m=o.whitespace=="pre",x=!!o.contentMatch.matchType(i);m&&!x?a=!1:!m&&x&&(a=!0)}let c=t.steps.length;if(a===!1){let m=t.doc.resolve(s+r);nX(t,m.node(),m.before(),c)}o.inlineContent&&_P(t,s+r-1,o,l.node().contentMatchAt(l.index()),a==null);let d=t.mapping.slice(c),u=d.map(s-r);if(t.step(new la(u,d.map(s+r,-1),Mt.empty,!0)),a===!0){let m=t.doc.resolve(u);sX(t,m.node(),m.before(),t.steps.length)}return t}function xAe(t,s,r){let a=t.resolve(s);if(a.parent.canReplaceWith(a.index(),a.index(),r))return s;if(a.parentOffset==0)for(let i=a.depth-1;i>=0;i--){let l=a.index(i);if(a.node(i).canReplaceWith(l,l,r))return a.before(i+1);if(l>0)return null}if(a.parentOffset==a.parent.content.size)for(let i=a.depth-1;i>=0;i--){let l=a.indexAfter(i);if(a.node(i).canReplaceWith(l,l,r))return a.after(i+1);if(l<a.node(i).childCount)return null}return null}function aX(t,s,r){let a=t.resolve(s);if(!r.content.size)return s;let i=r.content;for(let l=0;l<r.openStart;l++)i=i.firstChild.content;for(let l=1;l<=(r.openStart==0&&r.size?2:1);l++)for(let o=a.depth;o>=0;o--){let c=o==a.depth?0:a.pos<=(a.start(o+1)+a.end(o+1))/2?-1:1,d=a.index(o)+(c>0?1:0),u=a.node(o),m=!1;if(l==1)m=u.canReplace(d,d,i);else{let x=u.contentMatchAt(d).findWrapping(i.firstChild.type);m=x&&u.canReplaceWith(d,d,x[0])}if(m)return c==0?a.pos:c<0?a.before(o+1):a.after(o+1)}return null}function Q2(t,s,r=s,a=Mt.empty){if(s==r&&!a.size)return null;let i=t.resolve(s),l=t.resolve(r);return iX(i,l,a)?new la(s,r,a):new pAe(i,l,a).fit()}function iX(t,s,r){return!r.openStart&&!r.openEnd&&t.start()==s.start()&&t.parent.canReplace(t.index(),s.index(),r.content)}class pAe{constructor(s,r,a){this.$from=s,this.$to=r,this.unplaced=a,this.frontier=[],this.placed=vt.empty;for(let i=0;i<=s.depth;i++){let l=s.node(i);this.frontier.push({type:l.type,match:l.contentMatchAt(s.indexAfter(i))})}for(let i=s.depth;i>0;i--)this.placed=vt.from(s.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let s=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,a=this.$from,i=this.close(s<0?this.$to:a.doc.resolve(s));if(!i)return null;let l=this.placed,o=a.depth,c=i.depth;for(;o&&c&&l.childCount==1;)l=l.firstChild.content,o--,c--;let d=new Mt(l,o,c);return s>-1?new ma(a.pos,s,this.$to.pos,this.$to.end(),d,r):d.size||a.pos!=this.$to.pos?new la(a.pos,i.pos,d):null}findFittable(){let s=this.unplaced.openStart;for(let r=this.unplaced.content,a=0,i=this.unplaced.openEnd;a<s;a++){let l=r.firstChild;if(r.childCount>1&&(i=0),l.type.spec.isolating&&i<=a){s=a;break}r=l.content}for(let r=1;r<=2;r++)for(let a=r==1?s:this.unplaced.openStart;a>=0;a--){let i,l=null;a?(l=pk(this.unplaced.content,a-1).firstChild,i=l.content):i=this.unplaced.content;let o=i.firstChild;for(let c=this.depth;c>=0;c--){let{type:d,match:u}=this.frontier[c],m,x=null;if(r==1&&(o?u.matchType(o.type)||(x=u.fillBefore(vt.from(o),!1)):l&&d.compatibleContent(l.type)))return{sliceDepth:a,frontierDepth:c,parent:l,inject:x};if(r==2&&o&&(m=u.findWrapping(o.type)))return{sliceDepth:a,frontierDepth:c,parent:l,wrap:m};if(l&&u.matchType(l.type))break}}}openMore(){let{content:s,openStart:r,openEnd:a}=this.unplaced,i=pk(s,r);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Mt(s,r+1,Math.max(a,i.size+r>=s.size-a?r+1:0)),!0)}dropNode(){let{content:s,openStart:r,openEnd:a}=this.unplaced,i=pk(s,r);if(i.childCount<=1&&r>0){let l=s.size-r<=r+i.size;this.unplaced=new Mt(ag(s,r-1,1),r-1,l?r-1:a)}else this.unplaced=new Mt(ag(s,r,1),r,a)}placeNodes({sliceDepth:s,frontierDepth:r,parent:a,inject:i,wrap:l}){for(;this.depth>r;)this.closeFrontierNode();if(l)for(let j=0;j<l.length;j++)this.openFrontierNode(l[j]);let o=this.unplaced,c=a?a.content:o.content,d=o.openStart-s,u=0,m=[],{match:x,type:g}=this.frontier[r];if(i){for(let j=0;j<i.childCount;j++)m.push(i.child(j));x=x.matchFragment(i)}let y=c.size+s-(o.content.size-o.openEnd);for(;u<c.childCount;){let j=c.child(u),w=x.matchType(j.type);if(!w)break;u++,(u>1||d==0||j.content.size)&&(x=w,m.push(lX(j.mark(g.allowedMarks(j.marks)),u==1?d:0,u==c.childCount?y:-1)))}let v=u==c.childCount;v||(y=-1),this.placed=ig(this.placed,r,vt.from(m)),this.frontier[r].match=x,v&&y<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let j=0,w=c;j<y;j++){let S=w.lastChild;this.frontier.push({type:S.type,match:S.contentMatchAt(S.childCount)}),w=S.content}this.unplaced=v?s==0?Mt.empty:new Mt(ag(o.content,s-1,1),s-1,y<0?o.openEnd:s-1):new Mt(ag(o.content,s,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let s=this.frontier[this.depth],r;if(!s.type.isTextblock||!fk(this.$to,this.$to.depth,s.type,s.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;let{depth:a}=this.$to,i=this.$to.after(a);for(;a>1&&i==this.$to.end(--a);)++i;return i}findCloseLevel(s){e:for(let r=Math.min(this.depth,s.depth);r>=0;r--){let{match:a,type:i}=this.frontier[r],l=r<s.depth&&s.end(r+1)==s.pos+(s.depth-(r+1)),o=fk(s,r,i,a,l);if(o){for(let c=r-1;c>=0;c--){let{match:d,type:u}=this.frontier[c],m=fk(s,c,u,d,!0);if(!m||m.childCount)continue e}return{depth:r,fit:o,move:l?s.doc.resolve(s.after(r+1)):s}}}}close(s){let r=this.findCloseLevel(s);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=ig(this.placed,r.depth,r.fit)),s=r.move;for(let a=r.depth+1;a<=s.depth;a++){let i=s.node(a),l=i.type.contentMatch.fillBefore(i.content,!0,s.index(a));this.openFrontierNode(i.type,i.attrs,l)}return s}openFrontierNode(s,r=null,a){let i=this.frontier[this.depth];i.match=i.match.matchType(s),this.placed=ig(this.placed,this.depth,vt.from(s.create(r,a))),this.frontier.push({type:s,match:s.contentMatch})}closeFrontierNode(){let r=this.frontier.pop().match.fillBefore(vt.empty,!0);r.childCount&&(this.placed=ig(this.placed,this.frontier.length,r))}}function ag(t,s,r){return s==0?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(ag(t.firstChild.content,s-1,r)))}function ig(t,s,r){return s==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(ig(t.lastChild.content,s-1,r)))}function pk(t,s){for(let r=0;r<s;r++)t=t.firstChild.content;return t}function lX(t,s,r){if(s<=0)return t;let a=t.content;return s>1&&(a=a.replaceChild(0,lX(a.firstChild,s-1,a.childCount==1?r-1:0))),s>0&&(a=t.type.contentMatch.fillBefore(a).append(a),r<=0&&(a=a.append(t.type.contentMatch.matchFragment(a).fillBefore(vt.empty,!0)))),t.copy(a)}function fk(t,s,r,a,i){let l=t.node(s),o=i?t.indexAfter(s):t.index(s);if(o==l.childCount&&!r.compatibleContent(l.type))return null;let c=a.fillBefore(l.content,!0,o);return c&&!fAe(r,l.content,o)?c:null}function fAe(t,s,r){for(let a=r;a<s.childCount;a++)if(!t.allowsMarks(s.child(a).marks))return!0;return!1}function gAe(t){return t.spec.defining||t.spec.definingForContent}function bAe(t,s,r,a){if(!a.size)return t.deleteRange(s,r);let i=t.doc.resolve(s),l=t.doc.resolve(r);if(iX(i,l,a))return t.step(new la(s,r,a));let o=cX(i,t.doc.resolve(r));o[o.length-1]==0&&o.pop();let c=-(i.depth+1);o.unshift(c);for(let g=i.depth,y=i.pos-1;g>0;g--,y--){let v=i.node(g).type.spec;if(v.defining||v.definingAsContext||v.isolating)break;o.indexOf(g)>-1?c=g:i.before(g)==y&&o.splice(1,0,-g)}let d=o.indexOf(c),u=[],m=a.openStart;for(let g=a.content,y=0;;y++){let v=g.firstChild;if(u.push(v),y==a.openStart)break;g=v.content}for(let g=m-1;g>=0;g--){let y=u[g],v=gAe(y.type);if(v&&!y.sameMarkup(i.node(Math.abs(c)-1)))m=g;else if(v||!y.type.isTextblock)break}for(let g=a.openStart;g>=0;g--){let y=(g+m+1)%(a.openStart+1),v=u[y];if(v)for(let j=0;j<o.length;j++){let w=o[(j+d)%o.length],S=!0;w<0&&(S=!1,w=-w);let E=i.node(w-1),k=i.index(w-1);if(E.canReplaceWith(k,k,v.type,v.marks))return t.replace(i.before(w),S?l.after(w):r,new Mt(oX(a.content,0,a.openStart,y),y,a.openEnd))}}let x=t.steps.length;for(let g=o.length-1;g>=0&&(t.replace(s,r,a),!(t.steps.length>x));g--){let y=o[g];y<0||(s=i.before(y),r=l.after(y))}}function oX(t,s,r,a,i){if(s<r){let l=t.firstChild;t=t.replaceChild(0,l.copy(oX(l.content,s+1,r,a,l)))}if(s>a){let l=i.contentMatchAt(0),o=l.fillBefore(t).append(t);t=o.append(l.matchFragment(o).fillBefore(vt.empty,!0))}return t}function yAe(t,s,r,a){if(!a.isInline&&s==r&&t.doc.resolve(s).parent.content.size){let i=xAe(t.doc,s,a.type);i!=null&&(s=r=i)}t.replaceRange(s,r,new Mt(vt.from(a),0,0))}function vAe(t,s,r){let a=t.doc.resolve(s),i=t.doc.resolve(r),l=cX(a,i);for(let o=0;o<l.length;o++){let c=l[o],d=o==l.length-1;if(d&&c==0||a.node(c).type.contentMatch.validEnd)return t.delete(a.start(c),i.end(c));if(c>0&&(d||a.node(c-1).canReplace(a.index(c-1),i.indexAfter(c-1))))return t.delete(a.before(c),i.after(c))}for(let o=1;o<=a.depth&&o<=i.depth;o++)if(s-a.start(o)==a.depth-o&&r>a.end(o)&&i.end(o)-r!=i.depth-o&&a.start(o-1)==i.start(o-1)&&a.node(o-1).canReplace(a.index(o-1),i.index(o-1)))return t.delete(a.before(o),r);t.delete(s,r)}function cX(t,s){let r=[],a=Math.min(t.depth,s.depth);for(let i=a;i>=0;i--){let l=t.start(i);if(l<t.pos-(t.depth-i)||s.end(i)>s.pos+(s.depth-i)||t.node(i).type.spec.isolating||s.node(i).type.spec.isolating)break;(l==s.start(i)||i==t.depth&&i==s.depth&&t.parent.inlineContent&&s.parent.inlineContent&&i&&s.start(i-1)==l-1)&&r.push(i)}return r}class Lp extends fi{constructor(s,r,a){super(),this.pos=s,this.attr=r,this.value=a}apply(s){let r=s.nodeAt(this.pos);if(!r)return Gr.fail("No node at attribute step's position");let a=Object.create(null);for(let l in r.attrs)a[l]=r.attrs[l];a[this.attr]=this.value;let i=r.type.create(a,null,r.marks);return Gr.fromReplace(s,this.pos,this.pos+1,new Mt(vt.from(i),0,r.isLeaf?0:1))}getMap(){return Dl.empty}invert(s){return new Lp(this.pos,this.attr,s.nodeAt(this.pos).attrs[this.attr])}map(s){let r=s.mapResult(this.pos,1);return r.deletedAfter?null:new Lp(r.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(s,r){if(typeof r.pos!="number"||typeof r.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Lp(r.pos,r.attr,r.value)}}fi.jsonID("attr",Lp);class Sb extends fi{constructor(s,r){super(),this.attr=s,this.value=r}apply(s){let r=Object.create(null);for(let i in s.attrs)r[i]=s.attrs[i];r[this.attr]=this.value;let a=s.type.create(r,s.content,s.marks);return Gr.ok(a)}getMap(){return Dl.empty}invert(s){return new Sb(this.attr,s.attrs[this.attr])}map(s){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(s,r){if(typeof r.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Sb(r.attr,r.value)}}fi.jsonID("docAttr",Sb);let rf=class extends Error{};rf=function t(s){let r=Error.call(this,s);return r.__proto__=t.prototype,r};rf.prototype=Object.create(Error.prototype);rf.prototype.constructor=rf;rf.prototype.name="TransformError";class dX{constructor(s){this.doc=s,this.steps=[],this.docs=[],this.mapping=new _b}get before(){return this.docs.length?this.docs[0]:this.doc}step(s){let r=this.maybeStep(s);if(r.failed)throw new rf(r.failed);return this}maybeStep(s){let r=s.apply(this.doc);return r.failed||this.addStep(s,r.doc),r}get docChanged(){return this.steps.length>0}addStep(s,r){this.docs.push(this.doc),this.steps.push(s),this.mapping.appendMap(s.getMap()),this.doc=r}replace(s,r=s,a=Mt.empty){let i=Q2(this.doc,s,r,a);return i&&this.step(i),this}replaceWith(s,r,a){return this.replace(s,r,new Mt(vt.from(a),0,0))}delete(s,r){return this.replace(s,r,Mt.empty)}insert(s,r){return this.replaceWith(s,s,r)}replaceRange(s,r,a){return bAe(this,s,r,a),this}replaceRangeWith(s,r,a){return yAe(this,s,r,a),this}deleteRange(s,r){return vAe(this,s,r),this}lift(s,r){return rAe(this,s,r),this}join(s,r=1){return hAe(this,s,r),this}wrap(s,r){return lAe(this,s,r),this}setBlockType(s,r=s,a,i=null){return oAe(this,s,r,a,i),this}setNodeMarkup(s,r,a=null,i){return dAe(this,s,r,a,i),this}setNodeAttribute(s,r,a){return this.step(new Lp(s,r,a)),this}setDocAttribute(s,r){return this.step(new Sb(s,r)),this}addNodeMark(s,r){return this.step(new Xu(s,r)),this}removeNodeMark(s,r){let a=this.doc.nodeAt(s);if(!a)throw new RangeError("No node at position "+s);if(r instanceof qn)r.isInSet(a.marks)&&this.step(new Qh(s,r));else{let i=a.marks,l,o=[];for(;l=r.isInSet(i);)o.push(new Qh(s,l)),i=l.removeFromSet(i);for(let c=o.length-1;c>=0;c--)this.step(o[c])}return this}split(s,r=1,a){return uAe(this,s,r,a),this}addMark(s,r,a){return tAe(this,s,r,a),this}removeMark(s,r,a){return sAe(this,s,r,a),this}clearIncompatible(s,r,a){return _P(this,s,r,a),this}}const gk=Object.create(null);class is{constructor(s,r,a){this.$anchor=s,this.$head=r,this.ranges=a||[new uX(s.min(r),s.max(r))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let s=this.ranges;for(let r=0;r<s.length;r++)if(s[r].$from.pos!=s[r].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(s,r=Mt.empty){let a=r.content.lastChild,i=null;for(let c=0;c<r.openEnd;c++)i=a,a=a.lastChild;let l=s.steps.length,o=this.ranges;for(let c=0;c<o.length;c++){let{$from:d,$to:u}=o[c],m=s.mapping.slice(l);s.replaceRange(m.map(d.pos),m.map(u.pos),c?Mt.empty:r),c==0&&DL(s,l,(a?a.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(s,r){let a=s.steps.length,i=this.ranges;for(let l=0;l<i.length;l++){let{$from:o,$to:c}=i[l],d=s.mapping.slice(a),u=d.map(o.pos),m=d.map(c.pos);l?s.deleteRange(u,m):(s.replaceRangeWith(u,m,r),DL(s,a,r.isInline?-1:1))}}static findFrom(s,r,a=!1){let i=s.parent.inlineContent?new Qt(s):Qx(s.node(0),s.parent,s.pos,s.index(),r,a);if(i)return i;for(let l=s.depth-1;l>=0;l--){let o=r<0?Qx(s.node(0),s.node(l),s.before(l+1),s.index(l),r,a):Qx(s.node(0),s.node(l),s.after(l+1),s.index(l)+1,r,a);if(o)return o}return null}static near(s,r=1){return this.findFrom(s,r)||this.findFrom(s,-r)||new dl(s.node(0))}static atStart(s){return Qx(s,s,0,0,1)||new dl(s)}static atEnd(s){return Qx(s,s,s.content.size,s.childCount,-1)||new dl(s)}static fromJSON(s,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");let a=gk[r.type];if(!a)throw new RangeError(`No selection type ${r.type} defined`);return a.fromJSON(s,r)}static jsonID(s,r){if(s in gk)throw new RangeError("Duplicate use of selection JSON ID "+s);return gk[s]=r,r.prototype.jsonID=s,r}getBookmark(){return Qt.between(this.$anchor,this.$head).getBookmark()}}is.prototype.visible=!0;class uX{constructor(s,r){this.$from=s,this.$to=r}}let TL=!1;function PL(t){!TL&&!t.parent.inlineContent&&(TL=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Qt extends is{constructor(s,r=s){PL(s),PL(r),super(s,r)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(s,r){let a=s.resolve(r.map(this.head));if(!a.parent.inlineContent)return is.near(a);let i=s.resolve(r.map(this.anchor));return new Qt(i.parent.inlineContent?i:a,a)}replace(s,r=Mt.empty){if(super.replace(s,r),r==Mt.empty){let a=this.$from.marksAcross(this.$to);a&&s.ensureMarks(a)}}eq(s){return s instanceof Qt&&s.anchor==this.anchor&&s.head==this.head}getBookmark(){return new Z2(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(s,r){if(typeof r.anchor!="number"||typeof r.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Qt(s.resolve(r.anchor),s.resolve(r.head))}static create(s,r,a=r){let i=s.resolve(r);return new this(i,a==r?i:s.resolve(a))}static between(s,r,a){let i=s.pos-r.pos;if((!a||i)&&(a=i>=0?1:-1),!r.parent.inlineContent){let l=is.findFrom(r,a,!0)||is.findFrom(r,-a,!0);if(l)r=l.$head;else return is.near(r,a)}return s.parent.inlineContent||(i==0?s=r:(s=(is.findFrom(s,-a,!0)||is.findFrom(s,a,!0)).$anchor,s.pos<r.pos!=i<0&&(s=r))),new Qt(s,r)}}is.jsonID("text",Qt);class Z2{constructor(s,r){this.anchor=s,this.head=r}map(s){return new Z2(s.map(this.anchor),s.map(this.head))}resolve(s){return Qt.between(s.resolve(this.anchor),s.resolve(this.head))}}class ns extends is{constructor(s){let r=s.nodeAfter,a=s.node(0).resolve(s.pos+r.nodeSize);super(s,a),this.node=r}map(s,r){let{deleted:a,pos:i}=r.mapResult(this.anchor),l=s.resolve(i);return a?is.near(l):new ns(l)}content(){return new Mt(vt.from(this.node),0,0)}eq(s){return s instanceof ns&&s.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new CP(this.anchor)}static fromJSON(s,r){if(typeof r.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ns(s.resolve(r.anchor))}static create(s,r){return new ns(s.resolve(r))}static isSelectable(s){return!s.isText&&s.type.spec.selectable!==!1}}ns.prototype.visible=!1;is.jsonID("node",ns);class CP{constructor(s){this.anchor=s}map(s){let{deleted:r,pos:a}=s.mapResult(this.anchor);return r?new Z2(a,a):new CP(a)}resolve(s){let r=s.resolve(this.anchor),a=r.nodeAfter;return a&&ns.isSelectable(a)?new ns(r):is.near(r)}}class dl extends is{constructor(s){super(s.resolve(0),s.resolve(s.content.size))}replace(s,r=Mt.empty){if(r==Mt.empty){s.delete(0,s.doc.content.size);let a=is.atStart(s.doc);a.eq(s.selection)||s.setSelection(a)}else super.replace(s,r)}toJSON(){return{type:"all"}}static fromJSON(s){return new dl(s)}map(s){return new dl(s)}eq(s){return s instanceof dl}getBookmark(){return jAe}}is.jsonID("all",dl);const jAe={map(){return this},resolve(t){return new dl(t)}};function Qx(t,s,r,a,i,l=!1){if(s.inlineContent)return Qt.create(t,r);for(let o=a-(i>0?0:1);i>0?o<s.childCount:o>=0;o+=i){let c=s.child(o);if(c.isAtom){if(!l&&ns.isSelectable(c))return ns.create(t,r-(i<0?c.nodeSize:0))}else{let d=Qx(t,c,r+i,i<0?c.childCount:0,i,l);if(d)return d}r+=c.nodeSize*i}return null}function DL(t,s,r){let a=t.steps.length-1;if(a<s)return;let i=t.steps[a];if(!(i instanceof la||i instanceof ma))return;let l=t.mapping.maps[a],o;l.forEach((c,d,u,m)=>{o==null&&(o=m)}),t.setSelection(is.near(t.doc.resolve(o),r))}function ML(t,s){return!s||!t?t:t.bind(s)}class q1{constructor(s,r,a){this.name=s,this.init=ML(r.init,a),this.apply=ML(r.apply,a)}}new q1("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new q1("selection",{init(t,s){return t.selection||is.atStart(s.doc)},apply(t){return t.selection}}),new q1("storedMarks",{init(t){return t.storedMarks||null},apply(t,s,r,a){return a.selection.$cursor?t.storedMarks:null}}),new q1("scrollToSelection",{init(){return 0},apply(t,s){return t.scrolledIntoView?s+1:s}});function mX(t,s,r){for(let a in t){let i=t[a];i instanceof Function?i=i.bind(s):a=="handleDOMEvents"&&(i=mX(i,s,{})),r[a]=i}return r}class Ir{constructor(s){this.spec=s,this.props={},s.props&&mX(s.props,this,this.props),this.key=s.key?s.key.key:hX("plugin")}getState(s){return s[this.key]}}const bk=Object.create(null);function hX(t){return t in bk?t+"$"+ ++bk[t]:(bk[t]=0,t+"$")}class Or{constructor(s="key"){this.key=hX(s)}get(s){return s.config.pluginsByKey[this.key]}getState(s){return s[this.key]}}const J2=(t,s)=>t.selection.empty?!1:(s&&s(t.tr.deleteSelection().scrollIntoView()),!0);function xX(t,s){let{$cursor:r}=t.selection;return!r||(s?!s.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const kP=(t,s,r)=>{let a=xX(t,r);if(!a)return!1;let i=EP(a);if(!i){let o=a.blockRange(),c=o&&fx(o);return c==null?!1:(s&&s(t.tr.lift(o,c).scrollIntoView()),!0)}let l=i.nodeBefore;if(_X(t,i,s,-1))return!0;if(a.parent.content.size==0&&(af(l,"end")||ns.isSelectable(l)))for(let o=a.depth;;o--){let c=Q2(t.doc,a.before(o),a.after(o),Mt.empty);if(c&&c.slice.size<c.to-c.from){if(s){let d=t.tr.step(c);d.setSelection(af(l,"end")?is.findFrom(d.doc.resolve(d.mapping.map(i.pos,-1)),-1):ns.create(d.doc,i.pos-l.nodeSize)),s(d.scrollIntoView())}return!0}if(o==1||a.node(o-1).childCount>1)break}return l.isAtom&&i.depth==a.depth-1?(s&&s(t.tr.delete(i.pos-l.nodeSize,i.pos).scrollIntoView()),!0):!1},pX=(t,s,r)=>{let a=xX(t,r);if(!a)return!1;let i=EP(a);return i?gX(t,i,s):!1},fX=(t,s,r)=>{let a=bX(t,r);if(!a)return!1;let i=DP(a);return i?gX(t,i,s):!1};function gX(t,s,r){let a=s.nodeBefore,i=a,l=s.pos-1;for(;!i.isTextblock;l--){if(i.type.spec.isolating)return!1;let m=i.lastChild;if(!m)return!1;i=m}let o=s.nodeAfter,c=o,d=s.pos+1;for(;!c.isTextblock;d++){if(c.type.spec.isolating)return!1;let m=c.firstChild;if(!m)return!1;c=m}let u=Q2(t.doc,l,d,Mt.empty);if(!u||u.from!=l||u instanceof la&&u.slice.size>=d-l)return!1;if(r){let m=t.tr.step(u);m.setSelection(Qt.create(m.doc,l)),r(m.scrollIntoView())}return!0}function af(t,s,r=!1){for(let a=t;a;a=s=="start"?a.firstChild:a.lastChild){if(a.isTextblock)return!0;if(r&&a.childCount!=1)return!1}return!1}const AP=(t,s,r)=>{let{$head:a,empty:i}=t.selection,l=a;if(!i)return!1;if(a.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):a.parentOffset>0)return!1;l=EP(a)}let o=l&&l.nodeBefore;return!o||!ns.isSelectable(o)?!1:(s&&s(t.tr.setSelection(ns.create(t.doc,l.pos-o.nodeSize)).scrollIntoView()),!0)};function EP(t){if(!t.parent.type.spec.isolating)for(let s=t.depth-1;s>=0;s--){if(t.index(s)>0)return t.doc.resolve(t.before(s+1));if(t.node(s).type.spec.isolating)break}return null}function bX(t,s){let{$cursor:r}=t.selection;return!r||(s?!s.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const TP=(t,s,r)=>{let a=bX(t,r);if(!a)return!1;let i=DP(a);if(!i)return!1;let l=i.nodeAfter;if(_X(t,i,s,1))return!0;if(a.parent.content.size==0&&(af(l,"start")||ns.isSelectable(l))){let o=Q2(t.doc,a.before(),a.after(),Mt.empty);if(o&&o.slice.size<o.to-o.from){if(s){let c=t.tr.step(o);c.setSelection(af(l,"start")?is.findFrom(c.doc.resolve(c.mapping.map(i.pos)),1):ns.create(c.doc,c.mapping.map(i.pos))),s(c.scrollIntoView())}return!0}}return l.isAtom&&i.depth==a.depth-1?(s&&s(t.tr.delete(i.pos,i.pos+l.nodeSize).scrollIntoView()),!0):!1},PP=(t,s,r)=>{let{$head:a,empty:i}=t.selection,l=a;if(!i)return!1;if(a.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):a.parentOffset<a.parent.content.size)return!1;l=DP(a)}let o=l&&l.nodeAfter;return!o||!ns.isSelectable(o)?!1:(s&&s(t.tr.setSelection(ns.create(t.doc,l.pos)).scrollIntoView()),!0)};function DP(t){if(!t.parent.type.spec.isolating)for(let s=t.depth-1;s>=0;s--){let r=t.node(s);if(t.index(s)+1<r.childCount)return t.doc.resolve(t.after(s+1));if(r.type.spec.isolating)break}return null}const yX=(t,s)=>{let r=t.selection,a=r instanceof ns,i;if(a){if(r.node.isTextblock||!pd(t.doc,r.from))return!1;i=r.from}else if(i=Of(t.doc,r.from,-1),i==null)return!1;if(s){let l=t.tr.join(i);a&&l.setSelection(ns.create(l.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),s(l.scrollIntoView())}return!0},vX=(t,s)=>{let r=t.selection,a;if(r instanceof ns){if(r.node.isTextblock||!pd(t.doc,r.to))return!1;a=r.to}else if(a=Of(t.doc,r.to,1),a==null)return!1;return s&&s(t.tr.join(a).scrollIntoView()),!0},jX=(t,s)=>{let{$from:r,$to:a}=t.selection,i=r.blockRange(a),l=i&&fx(i);return l==null?!1:(s&&s(t.tr.lift(i,l).scrollIntoView()),!0)},MP=(t,s)=>{let{$head:r,$anchor:a}=t.selection;return!r.parent.type.spec.code||!r.sameParent(a)?!1:(s&&s(t.tr.insertText(`
`).scrollIntoView()),!0)};function IP(t){for(let s=0;s<t.edgeCount;s++){let{type:r}=t.edge(s);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const NX=(t,s)=>{let{$head:r,$anchor:a}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(a))return!1;let i=r.node(-1),l=r.indexAfter(-1),o=IP(i.contentMatchAt(l));if(!o||!i.canReplaceWith(l,l,o))return!1;if(s){let c=r.after(),d=t.tr.replaceWith(c,c,o.createAndFill());d.setSelection(is.near(d.doc.resolve(c),1)),s(d.scrollIntoView())}return!0},OP=(t,s)=>{let r=t.selection,{$from:a,$to:i}=r;if(r instanceof dl||a.parent.inlineContent||i.parent.inlineContent)return!1;let l=IP(i.parent.contentMatchAt(i.indexAfter()));if(!l||!l.isTextblock)return!1;if(s){let o=(!a.parentOffset&&i.index()<i.parent.childCount?a:i).pos,c=t.tr.insert(o,l.createAndFill());c.setSelection(Qt.create(c.doc,o+1)),s(c.scrollIntoView())}return!0},RP=(t,s)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let l=r.before();if(zl(t.doc,l))return s&&s(t.tr.split(l).scrollIntoView()),!0}let a=r.blockRange(),i=a&&fx(a);return i==null?!1:(s&&s(t.tr.lift(a,i).scrollIntoView()),!0)};function NAe(t){return(s,r)=>{let{$from:a,$to:i}=s.selection;if(s.selection instanceof ns&&s.selection.node.isBlock)return!a.parentOffset||!zl(s.doc,a.pos)?!1:(r&&r(s.tr.split(a.pos).scrollIntoView()),!0);if(!a.depth)return!1;let l=[],o,c,d=!1,u=!1;for(let y=a.depth;;y--)if(a.node(y).isBlock){d=a.end(y)==a.pos+(a.depth-y),u=a.start(y)==a.pos-(a.depth-y),c=IP(a.node(y-1).contentMatchAt(a.indexAfter(y-1))),l.unshift(d&&c?{type:c}:null),o=y;break}else{if(y==1)return!1;l.unshift(null)}let m=s.tr;(s.selection instanceof Qt||s.selection instanceof dl)&&m.deleteSelection();let x=m.mapping.map(a.pos),g=zl(m.doc,x,l.length,l);if(g||(l[0]=c?{type:c}:null,g=zl(m.doc,x,l.length,l)),!g)return!1;if(m.split(x,l.length,l),!d&&u&&a.node(o).type!=c){let y=m.mapping.map(a.before(o)),v=m.doc.resolve(y);c&&a.node(o-1).canReplaceWith(v.index(),v.index()+1,c)&&m.setNodeMarkup(m.mapping.map(a.before(o)),c)}return r&&r(m.scrollIntoView()),!0}}const wAe=NAe(),wX=(t,s)=>{let{$from:r,to:a}=t.selection,i,l=r.sharedDepth(a);return l==0?!1:(i=r.before(l),s&&s(t.tr.setSelection(ns.create(t.doc,i))),!0)};function _Ae(t,s,r){let a=s.nodeBefore,i=s.nodeAfter,l=s.index();return!a||!i||!a.type.compatibleContent(i.type)?!1:!a.content.size&&s.parent.canReplace(l-1,l)?(r&&r(t.tr.delete(s.pos-a.nodeSize,s.pos).scrollIntoView()),!0):!s.parent.canReplace(l,l+1)||!(i.isTextblock||pd(t.doc,s.pos))?!1:(r&&r(t.tr.join(s.pos).scrollIntoView()),!0)}function _X(t,s,r,a){let i=s.nodeBefore,l=s.nodeAfter,o,c,d=i.type.spec.isolating||l.type.spec.isolating;if(!d&&_Ae(t,s,r))return!0;let u=!d&&s.parent.canReplace(s.index(),s.index()+1);if(u&&(o=(c=i.contentMatchAt(i.childCount)).findWrapping(l.type))&&c.matchType(o[0]||l.type).validEnd){if(r){let y=s.pos+l.nodeSize,v=vt.empty;for(let S=o.length-1;S>=0;S--)v=vt.from(o[S].create(null,v));v=vt.from(i.copy(v));let j=t.tr.step(new ma(s.pos-1,y,s.pos,y,new Mt(v,1,0),o.length,!0)),w=j.doc.resolve(y+2*o.length);w.nodeAfter&&w.nodeAfter.type==i.type&&pd(j.doc,w.pos)&&j.join(w.pos),r(j.scrollIntoView())}return!0}let m=l.type.spec.isolating||a>0&&d?null:is.findFrom(s,1),x=m&&m.$from.blockRange(m.$to),g=x&&fx(x);if(g!=null&&g>=s.depth)return r&&r(t.tr.lift(x,g).scrollIntoView()),!0;if(u&&af(l,"start",!0)&&af(i,"end")){let y=i,v=[];for(;v.push(y),!y.isTextblock;)y=y.lastChild;let j=l,w=1;for(;!j.isTextblock;j=j.firstChild)w++;if(y.canReplace(y.childCount,y.childCount,j.content)){if(r){let S=vt.empty;for(let k=v.length-1;k>=0;k--)S=vt.from(v[k].copy(S));let E=t.tr.step(new ma(s.pos-v.length,s.pos+l.nodeSize,s.pos+w,s.pos+l.nodeSize-w,new Mt(S,v.length,0),0,!0));r(E.scrollIntoView())}return!0}}return!1}function SX(t){return function(s,r){let a=s.selection,i=t<0?a.$from:a.$to,l=i.depth;for(;i.node(l).isInline;){if(!l)return!1;l--}return i.node(l).isTextblock?(r&&r(s.tr.setSelection(Qt.create(s.doc,t<0?i.start(l):i.end(l)))),!0):!1}}const CX=SX(-1),kX=SX(1);function AX(t,s=null){return function(r,a){let{$from:i,$to:l}=r.selection,o=i.blockRange(l),c=o&&SP(o,t,s);return c?(a&&a(r.tr.wrap(o,c).scrollIntoView()),!0):!1}}function kN(t,s=null){return function(r,a){let i=!1;for(let l=0;l<r.selection.ranges.length&&!i;l++){let{$from:{pos:o},$to:{pos:c}}=r.selection.ranges[l];r.doc.nodesBetween(o,c,(d,u)=>{if(i)return!1;if(!(!d.isTextblock||d.hasMarkup(t,s)))if(d.type==t)i=!0;else{let m=r.doc.resolve(u),x=m.index();i=m.parent.canReplaceWith(x,x+1,t)}})}if(!i)return!1;if(a){let l=r.tr;for(let o=0;o<r.selection.ranges.length;o++){let{$from:{pos:c},$to:{pos:d}}=r.selection.ranges[o];l.setBlockType(c,d,t,s)}a(l.scrollIntoView())}return!0}}function LP(...t){return function(s,r,a){for(let i=0;i<t.length;i++)if(t[i](s,r,a))return!0;return!1}}LP(J2,kP,AP);LP(J2,TP,PP);LP(MP,OP,RP,wAe);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function EX(t,s=null){return function(r,a){let{$from:i,$to:l}=r.selection,o=i.blockRange(l);if(!o)return!1;let c=a?r.tr:null;return SAe(c,o,t,s)?(a&&a(c.scrollIntoView()),!0):!1}}function SAe(t,s,r,a=null){let i=!1,l=s,o=s.$from.doc;if(s.depth>=2&&s.$from.node(s.depth-1).type.compatibleContent(r)&&s.startIndex==0){if(s.$from.index(s.depth-1)==0)return!1;let d=o.resolve(s.start-2);l=new SN(d,d,s.depth),s.endIndex<s.parent.childCount&&(s=new SN(s.$from,o.resolve(s.$to.end(s.depth)),s.depth)),i=!0}let c=SP(l,r,a,s);return c?(t&&CAe(t,s,c,i,r),!0):!1}function CAe(t,s,r,a,i){let l=vt.empty;for(let m=r.length-1;m>=0;m--)l=vt.from(r[m].type.create(r[m].attrs,l));t.step(new ma(s.start-(a?2:0),s.end,s.start,s.end,new Mt(l,0,0),r.length,!0));let o=0;for(let m=0;m<r.length;m++)r[m].type==i&&(o=m+1);let c=r.length-o,d=s.start+r.length-(a?2:0),u=s.parent;for(let m=s.startIndex,x=s.endIndex,g=!0;m<x;m++,g=!1)!g&&zl(t.doc,d,c)&&(t.split(d,c),d+=2*c),d+=u.child(m).nodeSize;return t}function TX(t){return function(s,r){let{$from:a,$to:i}=s.selection,l=a.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return l?r?a.node(l.depth-1).type==t?kAe(s,r,t,l):AAe(s,r,l):!0:!1}}function kAe(t,s,r,a){let i=t.tr,l=a.end,o=a.$to.end(a.depth);l<o&&(i.step(new ma(l-1,o,l,o,new Mt(vt.from(r.create(null,a.parent.copy())),1,0),1,!0)),a=new SN(i.doc.resolve(a.$from.pos),i.doc.resolve(o),a.depth));const c=fx(a);if(c==null)return!1;i.lift(a,c);let d=i.doc.resolve(i.mapping.map(l,-1)-1);return pd(i.doc,d.pos)&&d.nodeBefore.type==d.nodeAfter.type&&i.join(d.pos),s(i.scrollIntoView()),!0}function AAe(t,s,r){let a=t.tr,i=r.parent;for(let y=r.end,v=r.endIndex-1,j=r.startIndex;v>j;v--)y-=i.child(v).nodeSize,a.delete(y-1,y+1);let l=a.doc.resolve(r.start),o=l.nodeAfter;if(a.mapping.map(r.end)!=r.start+l.nodeAfter.nodeSize)return!1;let c=r.startIndex==0,d=r.endIndex==i.childCount,u=l.node(-1),m=l.index(-1);if(!u.canReplace(m+(c?0:1),m+1,o.content.append(d?vt.empty:vt.from(i))))return!1;let x=l.pos,g=x+o.nodeSize;return a.step(new ma(x-(c?1:0),g+(d?1:0),x+1,g-1,new Mt((c?vt.empty:vt.from(i.copy(vt.empty))).append(d?vt.empty:vt.from(i.copy(vt.empty))),c?0:1,d?0:1),c?0:1)),s(a.scrollIntoView()),!0}function PX(t){return function(s,r){let{$from:a,$to:i}=s.selection,l=a.blockRange(i,u=>u.childCount>0&&u.firstChild.type==t);if(!l)return!1;let o=l.startIndex;if(o==0)return!1;let c=l.parent,d=c.child(o-1);if(d.type!=t)return!1;if(r){let u=d.lastChild&&d.lastChild.type==c.type,m=vt.from(u?t.create():null),x=new Mt(vt.from(t.create(null,vt.from(c.type.create(null,m)))),u?3:1,0),g=l.start,y=l.end;r(s.tr.step(new ma(g-(u?3:1),y,g,y,x,1,!0)).scrollIntoView())}return!0}}const gx=function(t){for(var s=0;;s++)if(t=t.previousSibling,!t)return s},DX=function(t,s,r,a){return r&&(IL(t,s,r,a,-1)||IL(t,s,r,a,1))},EAe=/^(img|br|input|textarea|hr)$/i;function IL(t,s,r,a,i){for(var l;;){if(t==r&&s==a)return!0;if(s==(i<0?0:AN(t))){let o=t.parentNode;if(!o||o.nodeType!=1||FP(t)||EAe.test(t.nodeName)||t.contentEditable=="false")return!1;s=gx(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[s+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((l=o.pmViewDesc)===null||l===void 0)&&l.ignoreForSelection)s+=i;else return!1;else t=o,s=i<0?AN(t):0}else return!1}}function AN(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function TAe(t,s,r){for(let a=s==0,i=s==AN(t);a||i;){if(t==r)return!0;let l=gx(t);if(t=t.parentNode,!t)return!1;a=a&&l==0,i=i&&l==AN(t)}}function FP(t){let s;for(let r=t;r&&!(s=r.pmViewDesc);r=r.parentNode);return s&&s.node&&s.node.isBlock&&(s.dom==t||s.contentDOM==t)}const MX=function(t){return t.focusNode&&DX(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function IX(t,s){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=s,r}const ld=typeof navigator<"u"?navigator:null,OL=typeof document<"u"?document:null,Tm=ld&&ld.userAgent||"",I4=/Edge\/(\d+)/.exec(Tm),OX=/MSIE \d/.exec(Tm),O4=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Tm),fy=!!(OX||O4||I4),RX=OX?document.documentMode:O4?+O4[1]:I4?+I4[1]:0,e_=!fy&&/gecko\/(\d+)/i.test(Tm);e_&&+(/Firefox\/(\d+)/.exec(Tm)||[0,0])[1];const R4=!fy&&/Chrome\/(\d+)/.exec(Tm),Pm=!!R4,LX=R4?+R4[1]:0,bx=!fy&&!!ld&&/Apple Computer/.test(ld.vendor),BP=bx&&(/Mobile\/\w+/.test(Tm)||!!ld&&ld.maxTouchPoints>2),po=BP||(ld?/Mac/.test(ld.platform):!1),PAe=ld?/Win/.test(ld.platform):!1,gy=/Android \d/.test(Tm),$P=!!OL&&"webkitFontSmoothing"in OL.documentElement.style,DAe=$P?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function MAe(t,s=null){let r=t.domSelectionRange(),a=t.state.doc;if(!r.focusNode)return null;let i=t.docView.nearestDesc(r.focusNode),l=i&&i.size==0,o=t.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(o<0)return null;let c=a.resolve(o),d,u;if(MX(r)){for(d=o;i&&!i.node;)i=i.parent;let x=i.node;if(i&&x.isAtom&&ns.isSelectable(x)&&i.parent&&!(x.isInline&&TAe(r.focusNode,r.focusOffset,i.dom))){let g=i.posBefore;u=new ns(o==g?c:a.resolve(g))}}else{if(r instanceof t.dom.ownerDocument.defaultView.Selection&&r.rangeCount>1){let x=o,g=o;for(let y=0;y<r.rangeCount;y++){let v=r.getRangeAt(y);x=Math.min(x,t.docView.posFromDOM(v.startContainer,v.startOffset,1)),g=Math.max(g,t.docView.posFromDOM(v.endContainer,v.endOffset,-1))}if(x<0)return null;[d,o]=g==t.state.selection.anchor?[g,x]:[x,g],c=a.resolve(o)}else d=t.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(d<0)return null}let m=a.resolve(d);if(!u){let x=s=="pointer"||t.state.selection.head<c.pos&&!l?1:-1;u=BX(t,m,c,x)}return u}function FX(t){return t.editable?t.hasFocus():LAe(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function zP(t,s=!1){let r=t.state.selection;if(RAe(t,r),!!FX(t)){if(!s&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Pm){let a=t.domSelectionRange(),i=t.domObserver.currentSelection;if(a.anchorNode&&i.anchorNode&&DX(a.anchorNode,a.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)OAe(t);else{let{anchor:a,head:i}=r,l,o;RL&&!(r instanceof Qt)&&(r.$from.parent.inlineContent||(l=LL(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(o=LL(t,r.to))),t.docView.setSelection(a,i,t,s),RL&&(l&&FL(l),o&&FL(o)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&IAe(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const RL=bx||Pm&&LX<63;function LL(t,s){let{node:r,offset:a}=t.docView.domFromPos(s,0),i=a<r.childNodes.length?r.childNodes[a]:null,l=a?r.childNodes[a-1]:null;if(bx&&i&&i.contentEditable=="false")return yk(i);if((!i||i.contentEditable=="false")&&(!l||l.contentEditable=="false")){if(i)return yk(i);if(l)return yk(l)}}function yk(t){return t.contentEditable="true",bx&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function FL(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function IAe(t){let s=t.dom.ownerDocument;s.removeEventListener("selectionchange",t.input.hideSelectionGuard);let r=t.domSelectionRange(),a=r.anchorNode,i=r.anchorOffset;s.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(r.anchorNode!=a||r.anchorOffset!=i)&&(s.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!FX(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function OAe(t){let s=t.domSelection();if(!s)return;let r=t.cursorWrapper.dom,a=r.nodeName=="IMG";a?s.collapse(r.parentNode,gx(r)+1):s.collapse(r,0),!a&&!t.state.selection.visible&&fy&&RX<=11&&(r.disabled=!0,r.disabled=!1)}function RAe(t,s){if(s instanceof ns){let r=t.docView.descAt(s.from);r!=t.lastSelectedViewDesc&&(BL(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else BL(t)}function BL(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function BX(t,s,r,a){return t.someProp("createSelectionBetween",i=>i(t,s,r))||Qt.between(s,r,a)}function LAe(t){let s=t.domSelectionRange();if(!s.anchorNode)return!1;try{return t.dom.contains(s.anchorNode.nodeType==3?s.anchorNode.parentNode:s.anchorNode)&&(t.editable||t.dom.contains(s.focusNode.nodeType==3?s.focusNode.parentNode:s.focusNode))}catch{return!1}}function L4(t,s){let{$anchor:r,$head:a}=t.selection,i=s>0?r.max(a):r.min(a),l=i.parent.inlineContent?i.depth?t.doc.resolve(s>0?i.after():i.before()):null:i;return l&&is.findFrom(l,s)}function Lu(t,s){return t.dispatch(t.state.tr.setSelection(s).scrollIntoView()),!0}function $L(t,s,r){let a=t.state.selection;if(a instanceof Qt)if(r.indexOf("s")>-1){let{$head:i}=a,l=i.textOffset?null:s<0?i.nodeBefore:i.nodeAfter;if(!l||l.isText||!l.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+l.nodeSize*(s<0?-1:1));return Lu(t,new Qt(a.$anchor,o))}else if(a.empty){if(t.endOfTextblock(s>0?"forward":"backward")){let i=L4(t.state,s);return i&&i instanceof ns?Lu(t,i):!1}else if(!(po&&r.indexOf("m")>-1)){let i=a.$head,l=i.textOffset?null:s<0?i.nodeBefore:i.nodeAfter,o;if(!l||l.isText)return!1;let c=s<0?i.pos-l.nodeSize:i.pos;return l.isAtom||(o=t.docView.descAt(c))&&!o.contentDOM?ns.isSelectable(l)?Lu(t,new ns(s<0?t.state.doc.resolve(i.pos-l.nodeSize):i)):$P?Lu(t,new Qt(t.state.doc.resolve(s<0?c:c+l.nodeSize))):!1:!1}}else return!1;else{if(a instanceof ns&&a.node.isInline)return Lu(t,new Qt(s>0?a.$to:a.$from));{let i=L4(t.state,s);return i?Lu(t,i):!1}}}function EN(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Dg(t,s){let r=t.pmViewDesc;return r&&r.size==0&&(s<0||t.nextSibling||t.nodeName!="BR")}function Bx(t,s){return s<0?FAe(t):BAe(t)}function FAe(t){let s=t.domSelectionRange(),r=s.focusNode,a=s.focusOffset;if(!r)return;let i,l,o=!1;for(e_&&r.nodeType==1&&a<EN(r)&&Dg(r.childNodes[a],-1)&&(o=!0);;)if(a>0){if(r.nodeType!=1)break;{let c=r.childNodes[a-1];if(Dg(c,-1))i=r,l=--a;else if(c.nodeType==3)r=c,a=r.nodeValue.length;else break}}else{if($X(r))break;{let c=r.previousSibling;for(;c&&Dg(c,-1);)i=r.parentNode,l=gx(c),c=c.previousSibling;if(c)r=c,a=EN(r);else{if(r=r.parentNode,r==t.dom)break;a=0}}}o?F4(t,r,a):i&&F4(t,i,l)}function BAe(t){let s=t.domSelectionRange(),r=s.focusNode,a=s.focusOffset;if(!r)return;let i=EN(r),l,o;for(;;)if(a<i){if(r.nodeType!=1)break;let c=r.childNodes[a];if(Dg(c,1))l=r,o=++a;else break}else{if($X(r))break;{let c=r.nextSibling;for(;c&&Dg(c,1);)l=c.parentNode,o=gx(c)+1,c=c.nextSibling;if(c)r=c,a=0,i=EN(r);else{if(r=r.parentNode,r==t.dom)break;a=i=0}}}l&&F4(t,l,o)}function $X(t){let s=t.pmViewDesc;return s&&s.node&&s.node.isBlock}function $Ae(t,s){for(;t&&s==t.childNodes.length&&!FP(t);)s=gx(t)+1,t=t.parentNode;for(;t&&s<t.childNodes.length;){let r=t.childNodes[s];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,s=0}}function zAe(t,s){for(;t&&!s&&!FP(t);)s=gx(t),t=t.parentNode;for(;t&&s;){let r=t.childNodes[s-1];if(r.nodeType==3)return r;if(r.nodeType==1&&r.contentEditable=="false")break;t=r,s=t.childNodes.length}}function F4(t,s,r){if(s.nodeType!=3){let l,o;(o=$Ae(s,r))?(s=o,r=0):(l=zAe(s,r))&&(s=l,r=l.nodeValue.length)}let a=t.domSelection();if(!a)return;if(MX(a)){let l=document.createRange();l.setEnd(s,r),l.setStart(s,r),a.removeAllRanges(),a.addRange(l)}else a.extend&&a.extend(s,r);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&zP(t)},50)}function zL(t,s){let r=t.state.doc.resolve(s);if(!(Pm||PAe)&&r.parent.inlineContent){let i=t.coordsAtPos(s);if(s>r.start()){let l=t.coordsAtPos(s-1),o=(l.top+l.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(l.left-i.left)>1)return l.left<i.left?"ltr":"rtl"}if(s<r.end()){let l=t.coordsAtPos(s+1),o=(l.top+l.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(l.left-i.left)>1)return l.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function UL(t,s,r){let a=t.state.selection;if(a instanceof Qt&&!a.empty||r.indexOf("s")>-1||po&&r.indexOf("m")>-1)return!1;let{$from:i,$to:l}=a;if(!i.parent.inlineContent||t.endOfTextblock(s<0?"up":"down")){let o=L4(t.state,s);if(o&&o instanceof ns)return Lu(t,o)}if(!i.parent.inlineContent){let o=s<0?i:l,c=a instanceof dl?is.near(o,s):is.findFrom(o,s);return c?Lu(t,c):!1}return!1}function VL(t,s){if(!(t.state.selection instanceof Qt))return!0;let{$head:r,$anchor:a,empty:i}=t.state.selection;if(!r.sameParent(a))return!0;if(!i)return!1;if(t.endOfTextblock(s>0?"forward":"backward"))return!0;let l=!r.textOffset&&(s<0?r.nodeBefore:r.nodeAfter);if(l&&!l.isText){let o=t.state.tr;return s<0?o.delete(r.pos-l.nodeSize,r.pos):o.delete(r.pos,r.pos+l.nodeSize),t.dispatch(o),!0}return!1}function HL(t,s,r){t.domObserver.stop(),s.contentEditable=r,t.domObserver.start()}function UAe(t){if(!bx||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:s,focusOffset:r}=t.domSelectionRange();if(s&&s.nodeType==1&&r==0&&s.firstChild&&s.firstChild.contentEditable=="false"){let a=s.firstChild;HL(t,a,"true"),setTimeout(()=>HL(t,a,"false"),20)}return!1}function VAe(t){let s="";return t.ctrlKey&&(s+="c"),t.metaKey&&(s+="m"),t.altKey&&(s+="a"),t.shiftKey&&(s+="s"),s}function HAe(t,s){let r=s.keyCode,a=VAe(s);if(r==8||po&&r==72&&a=="c")return VL(t,-1)||Bx(t,-1);if(r==46&&!s.shiftKey||po&&r==68&&a=="c")return VL(t,1)||Bx(t,1);if(r==13||r==27)return!0;if(r==37||po&&r==66&&a=="c"){let i=r==37?zL(t,t.state.selection.from)=="ltr"?-1:1:-1;return $L(t,i,a)||Bx(t,i)}else if(r==39||po&&r==70&&a=="c"){let i=r==39?zL(t,t.state.selection.from)=="ltr"?1:-1:1;return $L(t,i,a)||Bx(t,i)}else{if(r==38||po&&r==80&&a=="c")return UL(t,-1,a)||Bx(t,-1);if(r==40||po&&r==78&&a=="c")return UAe(t)||UL(t,1,a)||Bx(t,1);if(a==(po?"m":"c")&&(r==66||r==73||r==89||r==90))return!0}return!1}function zX(t,s){t.someProp("transformCopied",y=>{s=y(s,t)});let r=[],{content:a,openStart:i,openEnd:l}=s;for(;i>1&&l>1&&a.childCount==1&&a.firstChild.childCount==1;){i--,l--;let y=a.firstChild;r.push(y.type.name,y.attrs!=y.type.defaultAttrs?y.attrs:null),a=y.content}let o=t.someProp("clipboardSerializer")||X2.fromSchema(t.state.schema),c=GX(),d=c.createElement("div");d.appendChild(o.serializeFragment(a,{document:c}));let u=d.firstChild,m,x=0;for(;u&&u.nodeType==1&&(m=qX[u.nodeName.toLowerCase()]);){for(let y=m.length-1;y>=0;y--){let v=c.createElement(m[y]);for(;d.firstChild;)v.appendChild(d.firstChild);d.appendChild(v),x++}u=d.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${l}${x?` -${x}`:""} ${JSON.stringify(r)}`);let g=t.someProp("clipboardTextSerializer",y=>y(s,t))||s.content.textBetween(0,s.content.size,`

`);return{dom:d,text:g,slice:s}}function UX(t,s,r,a,i){let l=i.parent.type.spec.code,o,c;if(!r&&!s)return null;let d=!!s&&(a||l||!r);if(d){if(t.someProp("transformPastedText",g=>{s=g(s,l||a,t)}),l)return c=new Mt(vt.from(t.state.schema.text(s.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",g=>{c=g(c,t,!0)}),c;let x=t.someProp("clipboardTextParser",g=>g(s,i,a,t));if(x)c=x;else{let g=i.marks(),{schema:y}=t.state,v=X2.fromSchema(y);o=document.createElement("div"),s.split(/(?:\r\n?|\n)+/).forEach(j=>{let w=o.appendChild(document.createElement("p"));j&&w.appendChild(v.serializeNode(y.text(j,g)))})}}else t.someProp("transformPastedHTML",x=>{r=x(r,t)}),o=KAe(r),$P&&YAe(o);let u=o&&o.querySelector("[data-pm-slice]"),m=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(m&&m[3])for(let x=+m[3];x>0;x--){let g=o.firstChild;for(;g&&g.nodeType!=1;)g=g.nextSibling;if(!g)break;o=g}if(c||(c=(t.someProp("clipboardParser")||t.someProp("domParser")||Ah.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(d||m),context:i,ruleFromNode(g){return g.nodeName=="BR"&&!g.nextSibling&&g.parentNode&&!WAe.test(g.parentNode.nodeName)?{ignore:!0}:null}})),m)c=XAe(WL(c,+m[1],+m[2]),m[4]);else if(c=Mt.maxOpen(qAe(c.content,i),!0),c.openStart||c.openEnd){let x=0,g=0;for(let y=c.content.firstChild;x<c.openStart&&!y.type.spec.isolating;x++,y=y.firstChild);for(let y=c.content.lastChild;g<c.openEnd&&!y.type.spec.isolating;g++,y=y.lastChild);c=WL(c,x,g)}return t.someProp("transformPasted",x=>{c=x(c,t,d)}),c}const WAe=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function qAe(t,s){if(t.childCount<2)return t;for(let r=s.depth;r>=0;r--){let i=s.node(r).contentMatchAt(s.index(r)),l,o=[];if(t.forEach(c=>{if(!o)return;let d=i.findWrapping(c.type),u;if(!d)return o=null;if(u=o.length&&l.length&&HX(d,l,c,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=WX(o[o.length-1],l.length));let m=VX(c,d);o.push(m),i=i.matchType(m.type),l=d}}),o)return vt.from(o)}return t}function VX(t,s,r=0){for(let a=s.length-1;a>=r;a--)t=s[a].create(null,vt.from(t));return t}function HX(t,s,r,a,i){if(i<t.length&&i<s.length&&t[i]==s[i]){let l=HX(t,s,r,a.lastChild,i+1);if(l)return a.copy(a.content.replaceChild(a.childCount-1,l));if(a.contentMatchAt(a.childCount).matchType(i==t.length-1?r.type:t[i+1]))return a.copy(a.content.append(vt.from(VX(r,t,i+1))))}}function WX(t,s){if(s==0)return t;let r=t.content.replaceChild(t.childCount-1,WX(t.lastChild,s-1)),a=t.contentMatchAt(t.childCount).fillBefore(vt.empty,!0);return t.copy(r.append(a))}function B4(t,s,r,a,i,l){let o=s<0?t.firstChild:t.lastChild,c=o.content;return t.childCount>1&&(l=0),i<a-1&&(c=B4(c,s,r,a,i+1,l)),i>=r&&(c=s<0?o.contentMatchAt(0).fillBefore(c,l<=i).append(c):c.append(o.contentMatchAt(o.childCount).fillBefore(vt.empty,!0))),t.replaceChild(s<0?0:t.childCount-1,o.copy(c))}function WL(t,s,r){return s<t.openStart&&(t=new Mt(B4(t.content,-1,s,t.openStart,0,t.openEnd),s,t.openEnd)),r<t.openEnd&&(t=new Mt(B4(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}const qX={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let qL=null;function GX(){return qL||(qL=document.implementation.createHTMLDocument("title"))}let vk=null;function GAe(t){let s=window.trustedTypes;return s?(vk||(vk=s.defaultPolicy||s.createPolicy("ProseMirrorClipboard",{createHTML:r=>r})),vk.createHTML(t)):t}function KAe(t){let s=/^(\s*<meta [^>]*>)*/.exec(t);s&&(t=t.slice(s[0].length));let r=GX().createElement("div"),a=/<([a-z][^>\s]+)/i.exec(t),i;if((i=a&&qX[a[1].toLowerCase()])&&(t=i.map(l=>"<"+l+">").join("")+t+i.map(l=>"</"+l+">").reverse().join("")),r.innerHTML=GAe(t),i)for(let l=0;l<i.length;l++)r=r.querySelector(i[l])||r;return r}function YAe(t){let s=t.querySelectorAll(Pm?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<s.length;r++){let a=s[r];a.childNodes.length==1&&a.textContent==""&&a.parentNode&&a.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),a)}}function XAe(t,s){if(!t.size)return t;let r=t.content.firstChild.type.schema,a;try{a=JSON.parse(s)}catch{return t}let{content:i,openStart:l,openEnd:o}=t;for(let c=a.length-2;c>=0;c-=2){let d=r.nodes[a[c]];if(!d||d.hasRequiredAttrs())break;i=vt.from(d.create(a[c+1],i)),l++,o++}return new Mt(i,l,o)}const bc={},ql={};function Qu(t,s){t.input.lastSelectionOrigin=s,t.input.lastSelectionTime=Date.now()}ql.keydown=(t,s)=>{let r=s;if(t.input.shiftKey=r.keyCode==16||r.shiftKey,!YX(t,r)&&(t.input.lastKeyCode=r.keyCode,t.input.lastKeyCodeTime=Date.now(),!(gy&&Pm&&r.keyCode==13)))if(r.keyCode!=229&&t.domObserver.forceFlush(),BP&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){let a=Date.now();t.input.lastIOSEnter=a,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==a&&(t.someProp("handleKeyDown",i=>i(t,IX(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",a=>a(t,r))||HAe(t,r)?r.preventDefault():Qu(t,"key")};ql.keyup=(t,s)=>{s.keyCode==16&&(t.input.shiftKey=!1)};ql.keypress=(t,s)=>{let r=s;if(YX(t,r)||!r.charCode||r.ctrlKey&&!r.altKey||po&&r.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,r))){r.preventDefault();return}let a=t.state.selection;if(!(a instanceof Qt)||!a.$from.sameParent(a.$to)){let i=String.fromCharCode(r.charCode),l=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,a.$from.pos,a.$to.pos,i,l))&&t.dispatch(l()),r.preventDefault()}};function t_(t){return{left:t.clientX,top:t.clientY}}function QAe(t,s){let r=s.x-t.clientX,a=s.y-t.clientY;return r*r+a*a<100}function UP(t,s,r,a,i){if(a==-1)return!1;let l=t.state.doc.resolve(a);for(let o=l.depth+1;o>0;o--)if(t.someProp(s,c=>o>l.depth?c(t,r,l.nodeAfter,l.before(o),i,!0):c(t,r,l.node(o),l.before(o),i,!1)))return!0;return!1}function Fp(t,s,r){if(t.focused||t.focus(),t.state.selection.eq(s))return;let a=t.state.tr.setSelection(s);a.setMeta("pointer",!0),t.dispatch(a)}function ZAe(t,s){if(s==-1)return!1;let r=t.state.doc.resolve(s),a=r.nodeAfter;return a&&a.isAtom&&ns.isSelectable(a)?(Fp(t,new ns(r)),!0):!1}function JAe(t,s){if(s==-1)return!1;let r=t.state.selection,a,i;r instanceof ns&&(a=r.node);let l=t.state.doc.resolve(s);for(let o=l.depth+1;o>0;o--){let c=o>l.depth?l.nodeAfter:l.node(o);if(ns.isSelectable(c)){a&&r.$from.depth>0&&o>=r.$from.depth&&l.before(r.$from.depth+1)==r.$from.pos?i=l.before(r.$from.depth):i=l.before(o);break}}return i!=null?(Fp(t,ns.create(t.state.doc,i)),!0):!1}function eEe(t,s,r,a,i){return UP(t,"handleClickOn",s,r,a)||t.someProp("handleClick",l=>l(t,s,a))||(i?JAe(t,r):ZAe(t,r))}function tEe(t,s,r,a){return UP(t,"handleDoubleClickOn",s,r,a)||t.someProp("handleDoubleClick",i=>i(t,s,a))}function sEe(t,s,r,a){return UP(t,"handleTripleClickOn",s,r,a)||t.someProp("handleTripleClick",i=>i(t,s,a))||nEe(t,r,a)}function nEe(t,s,r){if(r.button!=0)return!1;let a=t.state.doc;if(s==-1)return a.inlineContent?(Fp(t,Qt.create(a,0,a.content.size)),!0):!1;let i=a.resolve(s);for(let l=i.depth+1;l>0;l--){let o=l>i.depth?i.nodeAfter:i.node(l),c=i.before(l);if(o.inlineContent)Fp(t,Qt.create(a,c+1,c+1+o.content.size));else if(ns.isSelectable(o))Fp(t,ns.create(a,c));else continue;return!0}}function VP(t){return TN(t)}const KX=po?"metaKey":"ctrlKey";bc.mousedown=(t,s)=>{let r=s;t.input.shiftKey=r.shiftKey;let a=VP(t),i=Date.now(),l="singleClick";i-t.input.lastClick.time<500&&QAe(r,t.input.lastClick)&&!r[KX]&&t.input.lastClick.button==r.button&&(t.input.lastClick.type=="singleClick"?l="doubleClick":t.input.lastClick.type=="doubleClick"&&(l="tripleClick")),t.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:l,button:r.button};let o=t.posAtCoords(t_(r));o&&(l=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new rEe(t,o,r,!!a)):(l=="doubleClick"?tEe:sEe)(t,o.pos,o.inside,r)?r.preventDefault():Qu(t,"pointer"))};class rEe{constructor(s,r,a,i){this.view=s,this.pos=r,this.event=a,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=s.state.doc,this.selectNode=!!a[KX],this.allowDefault=a.shiftKey;let l,o;if(r.inside>-1)l=s.state.doc.nodeAt(r.inside),o=r.inside;else{let m=s.state.doc.resolve(r.pos);l=m.parent,o=m.depth?m.before():0}const c=i?null:a.target,d=c?s.docView.nearestDesc(c,!0):null;this.target=d&&d.nodeDOM.nodeType==1?d.nodeDOM:null;let{selection:u}=s.state;(a.button==0&&l.type.spec.draggable&&l.type.spec.selectable!==!1||u instanceof ns&&u.from<=o&&u.to>o)&&(this.mightDrag={node:l,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&e_&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),s.root.addEventListener("mouseup",this.up=this.up.bind(this)),s.root.addEventListener("mousemove",this.move=this.move.bind(this)),Qu(s,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>zP(this.view)),this.view.input.mouseDown=null}up(s){if(this.done(),!this.view.dom.contains(s.target))return;let r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(t_(s))),this.updateAllowDefault(s),this.allowDefault||!r?Qu(this.view,"pointer"):eEe(this.view,r.pos,r.inside,s,this.selectNode)?s.preventDefault():s.button==0&&(this.flushed||bx&&this.mightDrag&&!this.mightDrag.node.isAtom||Pm&&!this.view.state.selection.visible&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Fp(this.view,is.near(this.view.state.doc.resolve(r.pos))),s.preventDefault()):Qu(this.view,"pointer")}move(s){this.updateAllowDefault(s),Qu(this.view,"pointer"),s.buttons==0&&this.done()}updateAllowDefault(s){!this.allowDefault&&(Math.abs(this.event.x-s.clientX)>4||Math.abs(this.event.y-s.clientY)>4)&&(this.allowDefault=!0)}}bc.touchstart=t=>{t.input.lastTouch=Date.now(),VP(t),Qu(t,"pointer")};bc.touchmove=t=>{t.input.lastTouch=Date.now(),Qu(t,"pointer")};bc.contextmenu=t=>VP(t);function YX(t,s){return t.composing?!0:bx&&Math.abs(s.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const aEe=gy?5e3:-1;ql.compositionstart=ql.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:s}=t,r=s.selection.$to;if(s.selection instanceof Qt&&(s.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(a=>a.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||r.marks(),TN(t,!0),t.markCursor=null;else if(TN(t,!s.selection.empty),e_&&s.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let a=t.domSelectionRange();for(let i=a.focusNode,l=a.focusOffset;i&&i.nodeType==1&&l!=0;){let o=l<0?i.lastChild:i.childNodes[l-1];if(!o)break;if(o.nodeType==3){let c=t.domSelection();c&&c.collapse(o,o.nodeValue.length);break}else i=o,l=-1}}t.input.composing=!0}XX(t,aEe)};ql.compositionend=(t,s)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=s.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,XX(t,20))};function XX(t,s){clearTimeout(t.input.composingTimeout),s>-1&&(t.input.composingTimeout=setTimeout(()=>TN(t),s))}function iEe(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=lEe());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function lEe(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function TN(t,s=!1){if(!(gy&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),iEe(t),s||t.docView&&t.docView.dirty){let r=MAe(t),a=t.state.selection;return r&&!r.eq(a)?t.dispatch(t.state.tr.setSelection(r)):(t.markCursor||s)&&!a.$from.node(a.$from.sharedDepth(a.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function oEe(t,s){if(!t.dom.parentNode)return;let r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(s),r.style.cssText="position: fixed; left: -10000px; top: 10px";let a=getSelection(),i=document.createRange();i.selectNodeContents(s),t.dom.blur(),a.removeAllRanges(),a.addRange(i),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}const Cb=fy&&RX<15||BP&&DAe<604;bc.copy=ql.cut=(t,s)=>{let r=s,a=t.state.selection,i=r.type=="cut";if(a.empty)return;let l=Cb?null:r.clipboardData,o=a.content(),{dom:c,text:d}=zX(t,o);l?(r.preventDefault(),l.clearData(),l.setData("text/html",c.innerHTML),l.setData("text/plain",d)):oEe(t,c),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function cEe(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function dEe(t,s){if(!t.dom.parentNode)return;let r=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,a=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(a.contentEditable="true"),a.style.cssText="position: fixed; left: -10000px; top: 10px",a.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),a.parentNode&&a.parentNode.removeChild(a),r?$4(t,a.value,null,i,s):$4(t,a.textContent,a.innerHTML,i,s)},50)}function $4(t,s,r,a,i){let l=UX(t,s,r,a,t.state.selection.$from);if(t.someProp("handlePaste",d=>d(t,i,l||Mt.empty)))return!0;if(!l)return!1;let o=cEe(l),c=o?t.state.tr.replaceSelectionWith(o,a):t.state.tr.replaceSelection(l);return t.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function QX(t){let s=t.getData("text/plain")||t.getData("Text");if(s)return s;let r=t.getData("text/uri-list");return r?r.replace(/\r?\n/g," "):""}ql.paste=(t,s)=>{let r=s;if(t.composing&&!gy)return;let a=Cb?null:r.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;a&&$4(t,QX(a),a.getData("text/html"),i,r)?r.preventDefault():dEe(t,r)};class uEe{constructor(s,r,a){this.slice=s,this.move=r,this.node=a}}const mEe=po?"altKey":"ctrlKey";function ZX(t,s){let r=t.someProp("dragCopies",a=>!a(s));return r??!s[mEe]}bc.dragstart=(t,s)=>{let r=s,a=t.input.mouseDown;if(a&&a.done(),!r.dataTransfer)return;let i=t.state.selection,l=i.empty?null:t.posAtCoords(t_(r)),o;if(!(l&&l.pos>=i.from&&l.pos<=(i instanceof ns?i.to-1:i.to))){if(a&&a.mightDrag)o=ns.create(t.state.doc,a.mightDrag.pos);else if(r.target&&r.target.nodeType==1){let x=t.docView.nearestDesc(r.target,!0);x&&x.node.type.spec.draggable&&x!=t.docView&&(o=ns.create(t.state.doc,x.posBefore))}}let c=(o||t.state.selection).content(),{dom:d,text:u,slice:m}=zX(t,c);(!r.dataTransfer.files.length||!Pm||LX>120)&&r.dataTransfer.clearData(),r.dataTransfer.setData(Cb?"Text":"text/html",d.innerHTML),r.dataTransfer.effectAllowed="copyMove",Cb||r.dataTransfer.setData("text/plain",u),t.dragging=new uEe(m,ZX(t,r),o)};bc.dragend=t=>{let s=t.dragging;window.setTimeout(()=>{t.dragging==s&&(t.dragging=null)},50)};ql.dragover=ql.dragenter=(t,s)=>s.preventDefault();ql.drop=(t,s)=>{let r=s,a=t.dragging;if(t.dragging=null,!r.dataTransfer)return;let i=t.posAtCoords(t_(r));if(!i)return;let l=t.state.doc.resolve(i.pos),o=a&&a.slice;o?t.someProp("transformPasted",v=>{o=v(o,t,!1)}):o=UX(t,QX(r.dataTransfer),Cb?null:r.dataTransfer.getData("text/html"),!1,l);let c=!!(a&&ZX(t,r));if(t.someProp("handleDrop",v=>v(t,r,o||Mt.empty,c))){r.preventDefault();return}if(!o)return;r.preventDefault();let d=o?aX(t.state.doc,l.pos,o):l.pos;d==null&&(d=l.pos);let u=t.state.tr;if(c){let{node:v}=a;v?v.replace(u):u.deleteSelection()}let m=u.mapping.map(d),x=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,g=u.doc;if(x?u.replaceRangeWith(m,m,o.content.firstChild):u.replaceRange(m,m,o),u.doc.eq(g))return;let y=u.doc.resolve(m);if(x&&ns.isSelectable(o.content.firstChild)&&y.nodeAfter&&y.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new ns(y));else{let v=u.mapping.map(d);u.mapping.maps[u.mapping.maps.length-1].forEach((j,w,S,E)=>v=E),u.setSelection(BX(t,y,u.doc.resolve(v)))}t.focus(),t.dispatch(u.setMeta("uiEvent","drop"))};bc.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&zP(t)},20))};bc.blur=(t,s)=>{let r=s;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),r.relatedTarget&&t.dom.contains(r.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};bc.beforeinput=(t,s)=>{if(Pm&&gy&&s.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:a}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=a||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",l=>l(t,IX(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in ql)bc[t]=ql[t];function kb(t,s){if(t==s)return!0;for(let r in t)if(t[r]!==s[r])return!1;for(let r in s)if(!(r in t))return!1;return!0}class PN{constructor(s,r){this.toDOM=s,this.spec=r||Eh,this.side=this.spec.side||0}map(s,r,a,i){let{pos:l,deleted:o}=s.mapResult(r.from+i,this.side<0?-1:1);return o?null:new Fl(l-a,l-a,this)}valid(){return!0}eq(s){return this==s||s instanceof PN&&(this.spec.key&&this.spec.key==s.spec.key||this.toDOM==s.toDOM&&kb(this.spec,s.spec))}destroy(s){this.spec.destroy&&this.spec.destroy(s)}}class om{constructor(s,r){this.attrs=s,this.spec=r||Eh}map(s,r,a,i){let l=s.map(r.from+i,this.spec.inclusiveStart?-1:1)-a,o=s.map(r.to+i,this.spec.inclusiveEnd?1:-1)-a;return l>=o?null:new Fl(l,o,this)}valid(s,r){return r.from<r.to}eq(s){return this==s||s instanceof om&&kb(this.attrs,s.attrs)&&kb(this.spec,s.spec)}static is(s){return s.type instanceof om}destroy(){}}class HP{constructor(s,r){this.attrs=s,this.spec=r||Eh}map(s,r,a,i){let l=s.mapResult(r.from+i,1);if(l.deleted)return null;let o=s.mapResult(r.to+i,-1);return o.deleted||o.pos<=l.pos?null:new Fl(l.pos-a,o.pos-a,this)}valid(s,r){let{index:a,offset:i}=s.content.findIndex(r.from),l;return i==r.from&&!(l=s.child(a)).isText&&i+l.nodeSize==r.to}eq(s){return this==s||s instanceof HP&&kb(this.attrs,s.attrs)&&kb(this.spec,s.spec)}destroy(){}}class Fl{constructor(s,r,a){this.from=s,this.to=r,this.type=a}copy(s,r){return new Fl(s,r,this.type)}eq(s,r=0){return this.type.eq(s.type)&&this.from+r==s.from&&this.to+r==s.to}map(s,r,a){return this.type.map(s,this,r,a)}static widget(s,r,a){return new Fl(s,s,new PN(r,a))}static inline(s,r,a,i){return new Fl(s,r,new om(a,i))}static node(s,r,a,i){return new Fl(s,r,new HP(a,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof om}get widget(){return this.type instanceof PN}}const Zx=[],Eh={};class Er{constructor(s,r){this.local=s.length?s:Zx,this.children=r.length?r:Zx}static create(s,r){return r.length?DN(r,s,0,Eh):_i}find(s,r,a){let i=[];return this.findInner(s??0,r??1e9,i,0,a),i}findInner(s,r,a,i,l){for(let o=0;o<this.local.length;o++){let c=this.local[o];c.from<=r&&c.to>=s&&(!l||l(c.spec))&&a.push(c.copy(c.from+i,c.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<r&&this.children[o+1]>s){let c=this.children[o]+1;this.children[o+2].findInner(s-c,r-c,a,i+c,l)}}map(s,r,a){return this==_i||s.maps.length==0?this:this.mapInner(s,r,0,0,a||Eh)}mapInner(s,r,a,i,l){let o;for(let c=0;c<this.local.length;c++){let d=this.local[c].map(s,a,i);d&&d.type.valid(r,d)?(o||(o=[])).push(d):l.onRemove&&l.onRemove(this.local[c].spec)}return this.children.length?hEe(this.children,o||[],s,r,a,i,l):o?new Er(o.sort(Th),Zx):_i}add(s,r){return r.length?this==_i?Er.create(s,r):this.addInner(s,r,0):this}addInner(s,r,a){let i,l=0;s.forEach((c,d)=>{let u=d+a,m;if(m=eQ(r,c,u)){for(i||(i=this.children.slice());l<i.length&&i[l]<d;)l+=3;i[l]==d?i[l+2]=i[l+2].addInner(c,m,u+1):i.splice(l,0,d,d+c.nodeSize,DN(m,c,u+1,Eh)),l+=3}});let o=JX(l?tQ(r):r,-a);for(let c=0;c<o.length;c++)o[c].type.valid(s,o[c])||o.splice(c--,1);return new Er(o.length?this.local.concat(o).sort(Th):this.local,i||this.children)}remove(s){return s.length==0||this==_i?this:this.removeInner(s,0)}removeInner(s,r){let a=this.children,i=this.local;for(let l=0;l<a.length;l+=3){let o,c=a[l]+r,d=a[l+1]+r;for(let m=0,x;m<s.length;m++)(x=s[m])&&x.from>c&&x.to<d&&(s[m]=null,(o||(o=[])).push(x));if(!o)continue;a==this.children&&(a=this.children.slice());let u=a[l+2].removeInner(o,c+1);u!=_i?a[l+2]=u:(a.splice(l,3),l-=3)}if(i.length){for(let l=0,o;l<s.length;l++)if(o=s[l])for(let c=0;c<i.length;c++)i[c].eq(o,r)&&(i==this.local&&(i=this.local.slice()),i.splice(c--,1))}return a==this.children&&i==this.local?this:i.length||a.length?new Er(i,a):_i}forChild(s,r){if(this==_i)return this;if(r.isLeaf)return Er.empty;let a,i;for(let c=0;c<this.children.length;c+=3)if(this.children[c]>=s){this.children[c]==s&&(a=this.children[c+2]);break}let l=s+1,o=l+r.content.size;for(let c=0;c<this.local.length;c++){let d=this.local[c];if(d.from<o&&d.to>l&&d.type instanceof om){let u=Math.max(l,d.from)-l,m=Math.min(o,d.to)-l;u<m&&(i||(i=[])).push(d.copy(u,m))}}if(i){let c=new Er(i.sort(Th),Zx);return a?new th([c,a]):c}return a||_i}eq(s){if(this==s)return!0;if(!(s instanceof Er)||this.local.length!=s.local.length||this.children.length!=s.children.length)return!1;for(let r=0;r<this.local.length;r++)if(!this.local[r].eq(s.local[r]))return!1;for(let r=0;r<this.children.length;r+=3)if(this.children[r]!=s.children[r]||this.children[r+1]!=s.children[r+1]||!this.children[r+2].eq(s.children[r+2]))return!1;return!0}locals(s){return WP(this.localsInner(s))}localsInner(s){if(this==_i)return Zx;if(s.inlineContent||!this.local.some(om.is))return this.local;let r=[];for(let a=0;a<this.local.length;a++)this.local[a].type instanceof om||r.push(this.local[a]);return r}forEachSet(s){s(this)}}Er.empty=new Er([],[]);Er.removeOverlap=WP;const _i=Er.empty;class th{constructor(s){this.members=s}map(s,r){const a=this.members.map(i=>i.map(s,r,Eh));return th.from(a)}forChild(s,r){if(r.isLeaf)return Er.empty;let a=[];for(let i=0;i<this.members.length;i++){let l=this.members[i].forChild(s,r);l!=_i&&(l instanceof th?a=a.concat(l.members):a.push(l))}return th.from(a)}eq(s){if(!(s instanceof th)||s.members.length!=this.members.length)return!1;for(let r=0;r<this.members.length;r++)if(!this.members[r].eq(s.members[r]))return!1;return!0}locals(s){let r,a=!0;for(let i=0;i<this.members.length;i++){let l=this.members[i].localsInner(s);if(l.length)if(!r)r=l;else{a&&(r=r.slice(),a=!1);for(let o=0;o<l.length;o++)r.push(l[o])}}return r?WP(a?r:r.sort(Th)):Zx}static from(s){switch(s.length){case 0:return _i;case 1:return s[0];default:return new th(s.every(r=>r instanceof Er)?s:s.reduce((r,a)=>r.concat(a instanceof Er?a:a.members),[]))}}forEachSet(s){for(let r=0;r<this.members.length;r++)this.members[r].forEachSet(s)}}function hEe(t,s,r,a,i,l,o){let c=t.slice();for(let u=0,m=l;u<r.maps.length;u++){let x=0;r.maps[u].forEach((g,y,v,j)=>{let w=j-v-(y-g);for(let S=0;S<c.length;S+=3){let E=c[S+1];if(E<0||g>E+m-x)continue;let k=c[S]+m-x;y>=k?c[S+1]=g<=k?-2:-1:g>=m&&w&&(c[S]+=w,c[S+1]+=w)}x+=w}),m=r.maps[u].map(m,-1)}let d=!1;for(let u=0;u<c.length;u+=3)if(c[u+1]<0){if(c[u+1]==-2){d=!0,c[u+1]=-1;continue}let m=r.map(t[u]+l),x=m-i;if(x<0||x>=a.content.size){d=!0;continue}let g=r.map(t[u+1]+l,-1),y=g-i,{index:v,offset:j}=a.content.findIndex(x),w=a.maybeChild(v);if(w&&j==x&&j+w.nodeSize==y){let S=c[u+2].mapInner(r,w,m+1,t[u]+l+1,o);S!=_i?(c[u]=x,c[u+1]=y,c[u+2]=S):(c[u+1]=-2,d=!0)}else d=!0}if(d){let u=xEe(c,t,s,r,i,l,o),m=DN(u,a,0,o);s=m.local;for(let x=0;x<c.length;x+=3)c[x+1]<0&&(c.splice(x,3),x-=3);for(let x=0,g=0;x<m.children.length;x+=3){let y=m.children[x];for(;g<c.length&&c[g]<y;)g+=3;c.splice(g,0,m.children[x],m.children[x+1],m.children[x+2])}}return new Er(s.sort(Th),c)}function JX(t,s){if(!s||!t.length)return t;let r=[];for(let a=0;a<t.length;a++){let i=t[a];r.push(new Fl(i.from+s,i.to+s,i.type))}return r}function xEe(t,s,r,a,i,l,o){function c(d,u){for(let m=0;m<d.local.length;m++){let x=d.local[m].map(a,i,u);x?r.push(x):o.onRemove&&o.onRemove(d.local[m].spec)}for(let m=0;m<d.children.length;m+=3)c(d.children[m+2],d.children[m]+u+1)}for(let d=0;d<t.length;d+=3)t[d+1]==-1&&c(t[d+2],s[d]+l+1);return r}function eQ(t,s,r){if(s.isLeaf)return null;let a=r+s.nodeSize,i=null;for(let l=0,o;l<t.length;l++)(o=t[l])&&o.from>r&&o.to<a&&((i||(i=[])).push(o),t[l]=null);return i}function tQ(t){let s=[];for(let r=0;r<t.length;r++)t[r]!=null&&s.push(t[r]);return s}function DN(t,s,r,a){let i=[],l=!1;s.forEach((c,d)=>{let u=eQ(t,c,d+r);if(u){l=!0;let m=DN(u,c,r+d+1,a);m!=_i&&i.push(d,d+c.nodeSize,m)}});let o=JX(l?tQ(t):t,-r).sort(Th);for(let c=0;c<o.length;c++)o[c].type.valid(s,o[c])||(a.onRemove&&a.onRemove(o[c].spec),o.splice(c--,1));return o.length||i.length?new Er(o,i):_i}function Th(t,s){return t.from-s.from||t.to-s.to}function WP(t){let s=t;for(let r=0;r<s.length-1;r++){let a=s[r];if(a.from!=a.to)for(let i=r+1;i<s.length;i++){let l=s[i];if(l.from==a.from){l.to!=a.to&&(s==t&&(s=t.slice()),s[i]=l.copy(l.from,a.to),GL(s,i+1,l.copy(a.to,l.to)));continue}else{l.from<a.to&&(s==t&&(s=t.slice()),s[r]=a.copy(a.from,l.from),GL(s,i,a.copy(l.from,a.to)));break}}}return s}function GL(t,s,r){for(;s<t.length&&Th(r,t[s])>0;)s++;t.splice(s,0,r)}var bm={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},MN={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},pEe=typeof navigator<"u"&&/Mac/.test(navigator.platform),fEe=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Va=0;Va<10;Va++)bm[48+Va]=bm[96+Va]=String(Va);for(var Va=1;Va<=24;Va++)bm[Va+111]="F"+Va;for(var Va=65;Va<=90;Va++)bm[Va]=String.fromCharCode(Va+32),MN[Va]=String.fromCharCode(Va);for(var jk in bm)MN.hasOwnProperty(jk)||(MN[jk]=bm[jk]);function gEe(t){var s=pEe&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||fEe&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",r=!s&&t.key||(t.shiftKey?MN:bm)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}const bEe=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),yEe=typeof navigator<"u"&&/Win/.test(navigator.platform);function vEe(t){let s=t.split(/-(?!$)/),r=s[s.length-1];r=="Space"&&(r=" ");let a,i,l,o;for(let c=0;c<s.length-1;c++){let d=s[c];if(/^(cmd|meta|m)$/i.test(d))o=!0;else if(/^a(lt)?$/i.test(d))a=!0;else if(/^(c|ctrl|control)$/i.test(d))i=!0;else if(/^s(hift)?$/i.test(d))l=!0;else if(/^mod$/i.test(d))bEe?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+d)}return a&&(r="Alt-"+r),i&&(r="Ctrl-"+r),o&&(r="Meta-"+r),l&&(r="Shift-"+r),r}function jEe(t){let s=Object.create(null);for(let r in t)s[vEe(r)]=t[r];return s}function Nk(t,s,r=!0){return s.altKey&&(t="Alt-"+t),s.ctrlKey&&(t="Ctrl-"+t),s.metaKey&&(t="Meta-"+t),r&&s.shiftKey&&(t="Shift-"+t),t}function sQ(t){let s=jEe(t);return function(r,a){let i=gEe(a),l,o=s[Nk(i,a)];if(o&&o(r.state,r.dispatch,r))return!0;if(i.length==1&&i!=" "){if(a.shiftKey){let c=s[Nk(i,a,!1)];if(c&&c(r.state,r.dispatch,r))return!0}if((a.altKey||a.metaKey||a.ctrlKey)&&!(yEe&&a.ctrlKey&&a.altKey)&&(l=bm[a.keyCode])&&l!=i){let c=s[Nk(l,a)];if(c&&c(r.state,r.dispatch,r))return!0}}return!1}}var NEe=Object.defineProperty,qP=(t,s)=>{for(var r in s)NEe(t,r,{get:s[r],enumerable:!0})};function nQ(t){const{state:s,transaction:r}=t;let{selection:a}=r,{doc:i}=r,{storedMarks:l}=r;return{...s,apply:s.apply.bind(s),applyTransaction:s.applyTransaction.bind(s),plugins:s.plugins,schema:s.schema,reconfigure:s.reconfigure.bind(s),toJSON:s.toJSON.bind(s),get storedMarks(){return l},get selection(){return a},get doc(){return i},get tr(){return a=r.selection,i=r.doc,l=r.storedMarks,r}}}var wEe=class{constructor(s){this.editor=s.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=s.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:s,editor:r,state:a}=this,{view:i}=r,{tr:l}=a,o=this.buildProps(l);return Object.fromEntries(Object.entries(s).map(([c,d])=>[c,(...m)=>{const x=d(...m)(o);return!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),x}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(s,r=!0){const{rawCommands:a,editor:i,state:l}=this,{view:o}=i,c=[],d=!!s,u=s||l.tr,m=()=>(!d&&r&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),c.every(g=>g===!0)),x={...Object.fromEntries(Object.entries(a).map(([g,y])=>[g,(...j)=>{const w=this.buildProps(u,r),S=y(...j)(w);return c.push(S),x}])),run:m};return x}createCan(s){const{rawCommands:r,state:a}=this,i=!1,l=s||a.tr,o=this.buildProps(l,i);return{...Object.fromEntries(Object.entries(r).map(([d,u])=>[d,(...m)=>u(...m)({...o,dispatch:void 0})])),chain:()=>this.createChain(l,i)}}buildProps(s,r=!0){const{rawCommands:a,editor:i,state:l}=this,{view:o}=i,c={tr:s,editor:i,view:o,state:nQ({state:l,transaction:s}),dispatch:r?()=>{}:void 0,chain:()=>this.createChain(s,r),can:()=>this.createCan(s),get commands(){return Object.fromEntries(Object.entries(a).map(([d,u])=>[d,(...m)=>u(...m)(c)]))}};return c}},rQ={};qP(rQ,{blur:()=>_Ee,clearContent:()=>SEe,clearNodes:()=>CEe,command:()=>kEe,createParagraphNear:()=>AEe,cut:()=>EEe,deleteCurrentNode:()=>TEe,deleteNode:()=>PEe,deleteRange:()=>DEe,deleteSelection:()=>MEe,enter:()=>IEe,exitCode:()=>OEe,extendMarkRange:()=>LEe,first:()=>FEe,focus:()=>zEe,forEach:()=>UEe,insertContent:()=>VEe,insertContentAt:()=>qEe,joinBackward:()=>YEe,joinDown:()=>KEe,joinForward:()=>XEe,joinItemBackward:()=>QEe,joinItemForward:()=>ZEe,joinTextblockBackward:()=>JEe,joinTextblockForward:()=>eTe,joinUp:()=>GEe,keyboardShortcut:()=>sTe,lift:()=>nTe,liftEmptyBlock:()=>rTe,liftListItem:()=>aTe,newlineInCode:()=>iTe,resetAttributes:()=>lTe,scrollIntoView:()=>oTe,selectAll:()=>cTe,selectNodeBackward:()=>dTe,selectNodeForward:()=>uTe,selectParentNode:()=>mTe,selectTextblockEnd:()=>hTe,selectTextblockStart:()=>xTe,setContent:()=>fTe,setMark:()=>ATe,setMeta:()=>ETe,setNode:()=>TTe,setNodeSelection:()=>PTe,setTextDirection:()=>DTe,setTextSelection:()=>MTe,sinkListItem:()=>ITe,splitBlock:()=>OTe,splitListItem:()=>RTe,toggleList:()=>LTe,toggleMark:()=>FTe,toggleNode:()=>BTe,toggleWrap:()=>$Te,undoInputRule:()=>zTe,unsetAllMarks:()=>UTe,unsetMark:()=>VTe,unsetTextDirection:()=>HTe,updateAttributes:()=>WTe,wrapIn:()=>qTe,wrapInList:()=>GTe});var _Ee=()=>({editor:t,view:s})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(s.dom.blur(),(r=window==null?void 0:window.getSelection())==null||r.removeAllRanges())}),!0),SEe=(t=!0)=>({commands:s})=>s.setContent("",{emitUpdate:t}),CEe=()=>({state:t,tr:s,dispatch:r})=>{const{selection:a}=s,{ranges:i}=a;return r&&i.forEach(({$from:l,$to:o})=>{t.doc.nodesBetween(l.pos,o.pos,(c,d)=>{if(c.type.isText)return;const{doc:u,mapping:m}=s,x=u.resolve(m.map(d)),g=u.resolve(m.map(d+c.nodeSize)),y=x.blockRange(g);if(!y)return;const v=fx(y);if(c.type.isTextblock){const{defaultType:j}=x.parent.contentMatchAt(x.index());s.setNodeMarkup(y.start,j)}(v||v===0)&&s.lift(y,v)})}),!0},kEe=t=>s=>t(s),AEe=()=>({state:t,dispatch:s})=>OP(t,s),EEe=(t,s)=>({editor:r,tr:a})=>{const{state:i}=r,l=i.doc.slice(t.from,t.to);a.deleteRange(t.from,t.to);const o=a.mapping.map(s);return a.insert(o,l.content),a.setSelection(new Qt(a.doc.resolve(Math.max(o-1,0)))),!0},TEe=()=>({tr:t,dispatch:s})=>{const{selection:r}=t,a=r.$anchor.node();if(a.content.size>0)return!1;const i=t.selection.$anchor;for(let l=i.depth;l>0;l-=1)if(i.node(l).type===a.type){if(s){const c=i.before(l),d=i.after(l);t.delete(c,d).scrollIntoView()}return!0}return!1};function mi(t,s){if(typeof t=="string"){if(!s.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return s.nodes[t]}return t}var PEe=t=>({tr:s,state:r,dispatch:a})=>{const i=mi(t,r.schema),l=s.selection.$anchor;for(let o=l.depth;o>0;o-=1)if(l.node(o).type===i){if(a){const d=l.before(o),u=l.after(o);s.delete(d,u).scrollIntoView()}return!0}return!1},DEe=t=>({tr:s,dispatch:r})=>{const{from:a,to:i}=t;return r&&s.delete(a,i),!0},MEe=()=>({state:t,dispatch:s})=>J2(t,s),IEe=()=>({commands:t})=>t.keyboardShortcut("Enter"),OEe=()=>({state:t,dispatch:s})=>NX(t,s);function REe(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function IN(t,s,r={strict:!0}){const a=Object.keys(s);return a.length?a.every(i=>r.strict?s[i]===t[i]:REe(s[i])?s[i].test(t[i]):s[i]===t[i]):!0}function aQ(t,s,r={}){return t.find(a=>a.type===s&&IN(Object.fromEntries(Object.keys(r).map(i=>[i,a.attrs[i]])),r))}function KL(t,s,r={}){return!!aQ(t,s,r)}function GP(t,s,r){var a;if(!t||!s)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(m=>m.type===s))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(m=>m.type===s)||(r=r||((a=i.node.marks[0])==null?void 0:a.attrs),!aQ([...i.node.marks],s,r)))return;let o=i.index,c=t.start()+i.offset,d=o+1,u=c+i.node.nodeSize;for(;o>0&&KL([...t.parent.child(o-1).marks],s,r);)o-=1,c-=t.parent.child(o).nodeSize;for(;d<t.parent.childCount&&KL([...t.parent.child(d).marks],s,r);)u+=t.parent.child(d).nodeSize,d+=1;return{from:c,to:u}}function Dm(t,s){if(typeof t=="string"){if(!s.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return s.marks[t]}return t}var LEe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{const l=Dm(t,a.schema),{doc:o,selection:c}=r,{$from:d,from:u,to:m}=c;if(i){const x=GP(d,l,s);if(x&&x.from<=u&&x.to>=m){const g=Qt.create(o,x.from,x.to);r.setSelection(g)}}return!0},FEe=t=>s=>{const r=typeof t=="function"?t(s):t;for(let a=0;a<r.length;a+=1)if(r[a](s))return!0;return!1};function iQ(t){return t instanceof Qt}function dh(t=0,s=0,r=0){return Math.min(Math.max(t,s),r)}function BEe(t,s=null){if(!s)return null;const r=is.atStart(t),a=is.atEnd(t);if(s==="start"||s===!0)return r;if(s==="end")return a;const i=r.from,l=a.to;return s==="all"?Qt.create(t,dh(0,i,l),dh(t.content.size,i,l)):Qt.create(t,dh(s,i,l),dh(s,i,l))}function $Ee(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function KP(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var zEe=(t=null,s={})=>({editor:r,view:a,tr:i,dispatch:l})=>{s={scrollIntoView:!0,...s};const o=()=>{(KP()||$Ee())&&a.dom.focus(),requestAnimationFrame(()=>{r.isDestroyed||(a.focus(),s!=null&&s.scrollIntoView&&r.commands.scrollIntoView())})};if(a.hasFocus()&&t===null||t===!1)return!0;if(l&&t===null&&!iQ(r.state.selection))return o(),!0;const c=BEe(i.doc,t)||r.state.selection,d=r.state.selection.eq(c);return l&&(d||i.setSelection(c),d&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},UEe=(t,s)=>r=>t.every((a,i)=>s(a,{...r,index:i})),VEe=(t,s)=>({tr:r,commands:a})=>a.insertContentAt({from:r.selection.from,to:r.selection.to},t,s),lQ=t=>{const s=t.childNodes;for(let r=s.length-1;r>=0;r-=1){const a=s[r];a.nodeType===3&&a.nodeValue&&/^(\n\s\s|\n)$/.test(a.nodeValue)?t.removeChild(a):a.nodeType===1&&lQ(a)}return t};function G1(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const s=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(s,"text/html").body;return lQ(r)}function Ab(t,s,r){if(t instanceof lm||t instanceof vt)return t;r={slice:!0,parseOptions:{},...r};const a=typeof t=="object"&&t!==null,i=typeof t=="string";if(a)try{if(Array.isArray(t)&&t.length>0)return vt.fromArray(t.map(c=>s.nodeFromJSON(c)));const o=s.nodeFromJSON(t);return r.errorOnInvalidContent&&o.check(),o}catch(l){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:l});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",l),Ab("",s,r)}if(i){if(r.errorOnInvalidContent){let o=!1,c="";const d=new KY({topNode:s.spec.topNode,marks:s.spec.marks,nodes:s.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,c=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?Ah.fromSchema(d).parseSlice(G1(t),r.parseOptions):Ah.fromSchema(d).parse(G1(t),r.parseOptions),r.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const l=Ah.fromSchema(s);return r.slice?l.parseSlice(G1(t),r.parseOptions).content:l.parse(G1(t),r.parseOptions)}return Ab("",s,r)}function HEe(t,s,r){const a=t.steps.length-1;if(a<s)return;const i=t.steps[a];if(!(i instanceof la||i instanceof ma))return;const l=t.mapping.maps[a];let o=0;l.forEach((c,d,u,m)=>{o===0&&(o=m)}),t.setSelection(is.near(t.doc.resolve(o),r))}var WEe=t=>!("type"in t),qEe=(t,s,r)=>({tr:a,dispatch:i,editor:l})=>{var o;if(i){r={parseOptions:l.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let c;const d=w=>{l.emit("contentError",{editor:l,error:w,disableCollaboration:()=>{"collaboration"in l.storage&&typeof l.storage.collaboration=="object"&&l.storage.collaboration&&(l.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!l.options.enableContentCheck&&l.options.emitContentError)try{Ab(s,l.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){d(w)}try{c=Ab(s,l.schema,{parseOptions:u,errorOnInvalidContent:(o=r.errorOnInvalidContent)!=null?o:l.options.enableContentCheck})}catch(w){return d(w),!1}let{from:m,to:x}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},g=!0,y=!0;if((WEe(c)?c:[c]).forEach(w=>{w.check(),g=g?w.isText&&w.marks.length===0:!1,y=y?w.isBlock:!1}),m===x&&y){const{parent:w}=a.doc.resolve(m);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(m-=1,x+=1)}let j;if(g){if(Array.isArray(s))j=s.map(w=>w.text||"").join("");else if(s instanceof vt){let w="";s.forEach(S=>{S.text&&(w+=S.text)}),j=w}else typeof s=="object"&&s&&s.text?j=s.text:j=s;a.insertText(j,m,x)}else{j=c;const w=a.doc.resolve(m),S=w.node(),E=w.parentOffset===0,k=S.isText||S.isTextblock,A=S.content.size>0;E&&k&&A&&(m=Math.max(0,m-1)),a.replaceWith(m,x,j)}r.updateSelection&&HEe(a,a.steps.length-1,-1),r.applyInputRules&&a.setMeta("applyInputRules",{from:m,text:j}),r.applyPasteRules&&a.setMeta("applyPasteRules",{from:m,text:j})}return!0},GEe=()=>({state:t,dispatch:s})=>yX(t,s),KEe=()=>({state:t,dispatch:s})=>vX(t,s),YEe=()=>({state:t,dispatch:s})=>kP(t,s),XEe=()=>({state:t,dispatch:s})=>TP(t,s),QEe=()=>({state:t,dispatch:s,tr:r})=>{try{const a=Of(t.doc,t.selection.$from.pos,-1);return a==null?!1:(r.join(a,2),s&&s(r),!0)}catch{return!1}},ZEe=()=>({state:t,dispatch:s,tr:r})=>{try{const a=Of(t.doc,t.selection.$from.pos,1);return a==null?!1:(r.join(a,2),s&&s(r),!0)}catch{return!1}},JEe=()=>({state:t,dispatch:s})=>pX(t,s),eTe=()=>({state:t,dispatch:s})=>fX(t,s);function oQ(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function tTe(t){const s=t.split(/-(?!$)/);let r=s[s.length-1];r==="Space"&&(r=" ");let a,i,l,o;for(let c=0;c<s.length-1;c+=1){const d=s[c];if(/^(cmd|meta|m)$/i.test(d))o=!0;else if(/^a(lt)?$/i.test(d))a=!0;else if(/^(c|ctrl|control)$/i.test(d))i=!0;else if(/^s(hift)?$/i.test(d))l=!0;else if(/^mod$/i.test(d))KP()||oQ()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${d}`)}return a&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),o&&(r=`Meta-${r}`),l&&(r=`Shift-${r}`),r}var sTe=t=>({editor:s,view:r,tr:a,dispatch:i})=>{const l=tTe(t).split(/-(?!$)/),o=l.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),c=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:l.includes("Alt"),ctrlKey:l.includes("Ctrl"),metaKey:l.includes("Meta"),shiftKey:l.includes("Shift"),bubbles:!0,cancelable:!0}),d=s.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,c))});return d==null||d.steps.forEach(u=>{const m=u.map(a.mapping);m&&i&&a.maybeStep(m)}),!0};function YP(t,s,r={}){const{from:a,to:i,empty:l}=t.selection,o=s?mi(s,t.schema):null,c=[];t.doc.nodesBetween(a,i,(x,g)=>{if(x.isText)return;const y=Math.max(a,g),v=Math.min(i,g+x.nodeSize);c.push({node:x,from:y,to:v})});const d=i-a,u=c.filter(x=>o?o.name===x.node.type.name:!0).filter(x=>IN(x.node.attrs,r,{strict:!1}));return l?!!u.length:u.reduce((x,g)=>x+g.to-g.from,0)>=d}var nTe=(t,s={})=>({state:r,dispatch:a})=>{const i=mi(t,r.schema);return YP(r,i,s)?jX(r,a):!1},rTe=()=>({state:t,dispatch:s})=>RP(t,s),aTe=t=>({state:s,dispatch:r})=>{const a=mi(t,s.schema);return TX(a)(s,r)},iTe=()=>({state:t,dispatch:s})=>MP(t,s);function cQ(t,s){return s.nodes[t]?"node":s.marks[t]?"mark":null}function YL(t,s){const r=typeof s=="string"?[s]:s;return Object.keys(t).reduce((a,i)=>(r.includes(i)||(a[i]=t[i]),a),{})}var lTe=(t,s)=>({tr:r,state:a,dispatch:i})=>{let l=null,o=null;const c=cQ(typeof t=="string"?t:t.name,a.schema);if(!c)return!1;c==="node"&&(l=mi(t,a.schema)),c==="mark"&&(o=Dm(t,a.schema));let d=!1;return r.selection.ranges.forEach(u=>{a.doc.nodesBetween(u.$from.pos,u.$to.pos,(m,x)=>{l&&l===m.type&&(d=!0,i&&r.setNodeMarkup(x,void 0,YL(m.attrs,s))),o&&m.marks.length&&m.marks.forEach(g=>{o===g.type&&(d=!0,i&&r.addMark(x,x+m.nodeSize,o.create(YL(g.attrs,s))))})})}),d},oTe=()=>({tr:t,dispatch:s})=>(s&&t.scrollIntoView(),!0),cTe=()=>({tr:t,dispatch:s})=>{if(s){const r=new dl(t.doc);t.setSelection(r)}return!0},dTe=()=>({state:t,dispatch:s})=>AP(t,s),uTe=()=>({state:t,dispatch:s})=>PP(t,s),mTe=()=>({state:t,dispatch:s})=>wX(t,s),hTe=()=>({state:t,dispatch:s})=>kX(t,s),xTe=()=>({state:t,dispatch:s})=>CX(t,s);function pTe(t,s,r={},a={}){return Ab(t,s,{slice:!1,parseOptions:r,errorOnInvalidContent:a.errorOnInvalidContent})}var fTe=(t,{errorOnInvalidContent:s,emitUpdate:r=!0,parseOptions:a={}}={})=>({editor:i,tr:l,dispatch:o,commands:c})=>{const{doc:d}=l;if(a.preserveWhitespace!=="full"){const u=pTe(t,i.schema,a,{errorOnInvalidContent:s??i.options.enableContentCheck});return o&&l.replaceWith(0,d.content.size,u).setMeta("preventUpdate",!r),!0}return o&&l.setMeta("preventUpdate",!r),c.insertContentAt({from:0,to:d.content.size},t,{parseOptions:a,errorOnInvalidContent:s??i.options.enableContentCheck})};function gTe(t,s){const r=Dm(s,t.schema),{from:a,to:i,empty:l}=t.selection,o=[];l?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(a,i,d=>{o.push(...d.marks)});const c=o.find(d=>d.type.name===r.name);return c?{...c.attrs}:{}}function bTe(t,s){const r=new dX(t);return s.forEach(a=>{a.steps.forEach(i=>{r.step(i)})}),r}function yTe(t){for(let s=0;s<t.edgeCount;s+=1){const{type:r}=t.edge(s);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function dQ(t,s){for(let r=t.depth;r>0;r-=1){const a=t.node(r);if(s(a))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:a}}}function XP(t){return s=>dQ(s.$from,t)}function lf(t,s,r){return t.config[s]===void 0&&t.parent?lf(t.parent,s,r):typeof t.config[s]=="function"?t.config[s].bind({...r,parent:t.parent?lf(t.parent,s,r):null}):t.config[s]}function vTe(t){return typeof t=="function"}function Zh(t,s=void 0,...r){return vTe(t)?s?t.bind(s)(...r):t(...r):t}function uQ(t){const s=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),a=t.filter(i=>i.type==="mark");return{baseExtensions:s,nodeExtensions:r,markExtensions:a}}function Mm(...t){return t.filter(s=>!!s).reduce((s,r)=>{const a={...s};return Object.entries(r).forEach(([i,l])=>{if(!a[i]){a[i]=l;return}if(i==="class"){const c=l?String(l).split(" "):[],d=a[i]?a[i].split(" "):[],u=c.filter(m=>!d.includes(m));a[i]=[...d,...u].join(" ")}else if(i==="style"){const c=l?l.split(";").map(m=>m.trim()).filter(Boolean):[],d=a[i]?a[i].split(";").map(m=>m.trim()).filter(Boolean):[],u=new Map;d.forEach(m=>{const[x,g]=m.split(":").map(y=>y.trim());u.set(x,g)}),c.forEach(m=>{const[x,g]=m.split(":").map(y=>y.trim());u.set(x,g)}),a[i]=Array.from(u.entries()).map(([m,x])=>`${m}: ${x}`).join("; ")}else a[i]=l}),a},{})}function jTe(t,s,r){const{from:a,to:i}=s,{blockSeparator:l=`

`,textSerializers:o={}}=r||{};let c="";return t.nodesBetween(a,i,(d,u,m,x)=>{var g;d.isBlock&&u>a&&(c+=l);const y=o==null?void 0:o[d.type.name];if(y)return m&&(c+=y({node:d,pos:u,parent:m,index:x,range:s})),!1;d.isText&&(c+=(g=d==null?void 0:d.text)==null?void 0:g.slice(Math.max(a,u)-u,i-u))}),c}function NTe(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,s])=>s.spec.toText).map(([s,r])=>[s,r.spec.toText]))}function wTe(t,s=JSON.stringify){const r={};return t.filter(a=>{const i=s(a);return Object.prototype.hasOwnProperty.call(r,i)?!1:r[i]=!0})}function _Te(t){const s=wTe(t);return s.length===1?s:s.filter((r,a)=>!s.filter((l,o)=>o!==a).some(l=>r.oldRange.from>=l.oldRange.from&&r.oldRange.to<=l.oldRange.to&&r.newRange.from>=l.newRange.from&&r.newRange.to<=l.newRange.to))}function STe(t){const{mapping:s,steps:r}=t,a=[];return s.maps.forEach((i,l)=>{const o=[];if(i.ranges.length)i.forEach((c,d)=>{o.push({from:c,to:d})});else{const{from:c,to:d}=r[l];if(c===void 0||d===void 0)return;o.push({from:c,to:d})}o.forEach(({from:c,to:d})=>{const u=s.slice(l).map(c,-1),m=s.slice(l).map(d),x=s.invert().map(u,-1),g=s.invert().map(m);a.push({oldRange:{from:x,to:g},newRange:{from:u,to:m}})})}),_Te(a)}function mQ(t,s,r){const a=[];return t===s?r.resolve(t).marks().forEach(i=>{const l=r.resolve(t),o=GP(l,i.type);o&&a.push({mark:i,...o})}):r.nodesBetween(t,s,(i,l)=>{!i||(i==null?void 0:i.nodeSize)===void 0||a.push(...i.marks.map(o=>({from:l,to:l+i.nodeSize,mark:o})))}),a}function gj(t,s,r){return Object.fromEntries(Object.entries(r).filter(([a])=>{const i=t.find(l=>l.type===s&&l.name===a);return i?i.attribute.keepOnSplit:!1}))}function CTe(t,s,r={}){const{empty:a,ranges:i}=t.selection,l=s?Dm(s,t.schema):null;if(a)return!!(t.storedMarks||t.selection.$from.marks()).filter(x=>l?l.name===x.type.name:!0).find(x=>IN(x.attrs,r,{strict:!1}));let o=0;const c=[];if(i.forEach(({$from:x,$to:g})=>{const y=x.pos,v=g.pos;t.doc.nodesBetween(y,v,(j,w)=>{if(!j.isText&&!j.marks.length)return;const S=Math.max(y,w),E=Math.min(v,w+j.nodeSize),k=E-S;o+=k,c.push(...j.marks.map(A=>({mark:A,from:S,to:E})))})}),o===0)return!1;const d=c.filter(x=>l?l.name===x.mark.type.name:!0).filter(x=>IN(x.mark.attrs,r,{strict:!1})).reduce((x,g)=>x+g.to-g.from,0),u=c.filter(x=>l?x.mark.type!==l&&x.mark.type.excludes(l):!0).reduce((x,g)=>x+g.to-g.from,0);return(d>0?d+u:d)>=o}function XL(t,s){const{nodeExtensions:r}=uQ(s),a=r.find(o=>o.name===t);if(!a)return!1;const i={name:a.name,options:a.options,storage:a.storage},l=Zh(lf(a,"group",i));return typeof l!="string"?!1:l.split(" ").includes("list")}function hQ(t,{checkChildren:s=!0,ignoreWhitespace:r=!1}={}){var a;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((a=t.text)!=null?a:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(s){let i=!0;return t.content.forEach(l=>{i!==!1&&(hQ(l,{ignoreWhitespace:r,checkChildren:s})||(i=!1))}),i}return!1}function kTe(t,s,r){var a;const{selection:i}=s;let l=null;if(iQ(i)&&(l=i.$cursor),l){const c=(a=t.storedMarks)!=null?a:l.marks();return l.parent.type.allowsMarkType(r)&&(!!r.isInSet(c)||!c.some(u=>u.type.excludes(r)))}const{ranges:o}=i;return o.some(({$from:c,$to:d})=>{let u=c.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(c.pos,d.pos,(m,x,g)=>{if(u)return!1;if(m.isInline){const y=!g||g.type.allowsMarkType(r),v=!!r.isInSet(m.marks)||!m.marks.some(j=>j.type.excludes(r));u=y&&v}return!u}),u})}var ATe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{const{selection:l}=r,{empty:o,ranges:c}=l,d=Dm(t,a.schema);if(i)if(o){const u=gTe(a,d);r.addStoredMark(d.create({...u,...s}))}else c.forEach(u=>{const m=u.$from.pos,x=u.$to.pos;a.doc.nodesBetween(m,x,(g,y)=>{const v=Math.max(y,m),j=Math.min(y+g.nodeSize,x);g.marks.find(S=>S.type===d)?g.marks.forEach(S=>{d===S.type&&r.addMark(v,j,d.create({...S.attrs,...s}))}):r.addMark(v,j,d.create(s))})});return kTe(a,r,d)},ETe=(t,s)=>({tr:r})=>(r.setMeta(t,s),!0),TTe=(t,s={})=>({state:r,dispatch:a,chain:i})=>{const l=mi(t,r.schema);let o;return r.selection.$anchor.sameParent(r.selection.$head)&&(o=r.selection.$anchor.parent.attrs),l.isTextblock?i().command(({commands:c})=>kN(l,{...o,...s})(r)?!0:c.clearNodes()).command(({state:c})=>kN(l,{...o,...s})(c,a)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},PTe=t=>({tr:s,dispatch:r})=>{if(r){const{doc:a}=s,i=dh(t,0,a.content.size),l=ns.create(a,i);s.setSelection(l)}return!0},DTe=(t,s)=>({tr:r,state:a,dispatch:i})=>{const{selection:l}=a;let o,c;return typeof s=="number"?(o=s,c=s):s&&"from"in s&&"to"in s?(o=s.from,c=s.to):(o=l.from,c=l.to),i&&r.doc.nodesBetween(o,c,(d,u)=>{d.isText||r.setNodeMarkup(u,void 0,{...d.attrs,dir:t})}),!0},MTe=t=>({tr:s,dispatch:r})=>{if(r){const{doc:a}=s,{from:i,to:l}=typeof t=="number"?{from:t,to:t}:t,o=Qt.atStart(a).from,c=Qt.atEnd(a).to,d=dh(i,o,c),u=dh(l,o,c),m=Qt.create(a,d,u);s.setSelection(m)}return!0},ITe=t=>({state:s,dispatch:r})=>{const a=mi(t,s.schema);return PX(a)(s,r)};function QL(t,s){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const a=r.filter(i=>s==null?void 0:s.includes(i.type.name));t.tr.ensureMarks(a)}}var OTe=({keepMarks:t=!0}={})=>({tr:s,state:r,dispatch:a,editor:i})=>{const{selection:l,doc:o}=s,{$from:c,$to:d}=l,u=i.extensionManager.attributes,m=gj(u,c.node().type.name,c.node().attrs);if(l instanceof ns&&l.node.isBlock)return!c.parentOffset||!zl(o,c.pos)?!1:(a&&(t&&QL(r,i.extensionManager.splittableMarks),s.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const x=d.parentOffset===d.parent.content.size,g=c.depth===0?void 0:yTe(c.node(-1).contentMatchAt(c.indexAfter(-1)));let y=x&&g?[{type:g,attrs:m}]:void 0,v=zl(s.doc,s.mapping.map(c.pos),1,y);if(!y&&!v&&zl(s.doc,s.mapping.map(c.pos),1,g?[{type:g}]:void 0)&&(v=!0,y=g?[{type:g,attrs:m}]:void 0),a){if(v&&(l instanceof Qt&&s.deleteSelection(),s.split(s.mapping.map(c.pos),1,y),g&&!x&&!c.parentOffset&&c.parent.type!==g)){const j=s.mapping.map(c.before()),w=s.doc.resolve(j);c.node(-1).canReplaceWith(w.index(),w.index()+1,g)&&s.setNodeMarkup(s.mapping.map(c.before()),g)}t&&QL(r,i.extensionManager.splittableMarks),s.scrollIntoView()}return v},RTe=(t,s={})=>({tr:r,state:a,dispatch:i,editor:l})=>{var o;const c=mi(t,a.schema),{$from:d,$to:u}=a.selection,m=a.selection.node;if(m&&m.isBlock||d.depth<2||!d.sameParent(u))return!1;const x=d.node(-1);if(x.type!==c)return!1;const g=l.extensionManager.attributes;if(d.parent.content.size===0&&d.node(-1).childCount===d.indexAfter(-1)){if(d.depth===2||d.node(-3).type!==c||d.index(-2)!==d.node(-2).childCount-1)return!1;if(i){let S=vt.empty;const E=d.index(-1)?1:d.index(-2)?2:3;for(let D=d.depth-E;D>=d.depth-3;D-=1)S=vt.from(d.node(D).copy(S));const k=d.indexAfter(-1)<d.node(-2).childCount?1:d.indexAfter(-2)<d.node(-3).childCount?2:3,A={...gj(g,d.node().type.name,d.node().attrs),...s},I=((o=c.contentMatch.defaultType)==null?void 0:o.createAndFill(A))||void 0;S=S.append(vt.from(c.createAndFill(null,I)||void 0));const P=d.before(d.depth-(E-1));r.replace(P,d.after(-k),new Mt(S,4-E,0));let O=-1;r.doc.nodesBetween(P,r.doc.content.size,(D,T)=>{if(O>-1)return!1;D.isTextblock&&D.content.size===0&&(O=T+1)}),O>-1&&r.setSelection(Qt.near(r.doc.resolve(O))),r.scrollIntoView()}return!0}const y=u.pos===d.end()?x.contentMatchAt(0).defaultType:null,v={...gj(g,x.type.name,x.attrs),...s},j={...gj(g,d.node().type.name,d.node().attrs),...s};r.delete(d.pos,u.pos);const w=y?[{type:c,attrs:v},{type:y,attrs:j}]:[{type:c,attrs:v}];if(!zl(r.doc,d.pos,2))return!1;if(i){const{selection:S,storedMarks:E}=a,{splittableMarks:k}=l.extensionManager,A=E||S.$to.parentOffset&&S.$from.marks();if(r.split(d.pos,2,w).scrollIntoView(),!A||!i)return!0;const I=A.filter(P=>k.includes(P.type.name));r.ensureMarks(I)}return!0},wk=(t,s)=>{const r=XP(o=>o.type===s)(t.selection);if(!r)return!0;const a=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(a===void 0)return!0;const i=t.doc.nodeAt(a);return r.node.type===(i==null?void 0:i.type)&&pd(t.doc,r.pos)&&t.join(r.pos),!0},_k=(t,s)=>{const r=XP(o=>o.type===s)(t.selection);if(!r)return!0;const a=t.doc.resolve(r.start).after(r.depth);if(a===void 0)return!0;const i=t.doc.nodeAt(a);return r.node.type===(i==null?void 0:i.type)&&pd(t.doc,a)&&t.join(a),!0},LTe=(t,s,r,a={})=>({editor:i,tr:l,state:o,dispatch:c,chain:d,commands:u,can:m})=>{const{extensions:x,splittableMarks:g}=i.extensionManager,y=mi(t,o.schema),v=mi(s,o.schema),{selection:j,storedMarks:w}=o,{$from:S,$to:E}=j,k=S.blockRange(E),A=w||j.$to.parentOffset&&j.$from.marks();if(!k)return!1;const I=XP(P=>XL(P.type.name,x))(j);if(k.depth>=1&&I&&k.depth-I.depth<=1){if(I.node.type===y)return u.liftListItem(v);if(XL(I.node.type.name,x)&&y.validContent(I.node.content)&&c)return d().command(()=>(l.setNodeMarkup(I.pos,y),!0)).command(()=>wk(l,y)).command(()=>_k(l,y)).run()}return!r||!A||!c?d().command(()=>m().wrapInList(y,a)?!0:u.clearNodes()).wrapInList(y,a).command(()=>wk(l,y)).command(()=>_k(l,y)).run():d().command(()=>{const P=m().wrapInList(y,a),O=A.filter(D=>g.includes(D.type.name));return l.ensureMarks(O),P?!0:u.clearNodes()}).wrapInList(y,a).command(()=>wk(l,y)).command(()=>_k(l,y)).run()},FTe=(t,s={},r={})=>({state:a,commands:i})=>{const{extendEmptyMarkRange:l=!1}=r,o=Dm(t,a.schema);return CTe(a,o,s)?i.unsetMark(o,{extendEmptyMarkRange:l}):i.setMark(o,s)},BTe=(t,s,r={})=>({state:a,commands:i})=>{const l=mi(t,a.schema),o=mi(s,a.schema),c=YP(a,l,r);let d;return a.selection.$anchor.sameParent(a.selection.$head)&&(d=a.selection.$anchor.parent.attrs),c?i.setNode(o,d):i.setNode(l,{...d,...r})},$Te=(t,s={})=>({state:r,commands:a})=>{const i=mi(t,r.schema);return YP(r,i,s)?a.lift(i):a.wrapIn(i,s)},zTe=()=>({state:t,dispatch:s})=>{const r=t.plugins;for(let a=0;a<r.length;a+=1){const i=r[a];let l;if(i.spec.isInputRules&&(l=i.getState(t))){if(s){const o=t.tr,c=l.transform;for(let d=c.steps.length-1;d>=0;d-=1)o.step(c.steps[d].invert(c.docs[d]));if(l.text){const d=o.doc.resolve(l.from).marks();o.replaceWith(l.from,l.to,t.schema.text(l.text,d))}else o.delete(l.from,l.to)}return!0}}return!1},UTe=()=>({tr:t,dispatch:s})=>{const{selection:r}=t,{empty:a,ranges:i}=r;return a||s&&i.forEach(l=>{t.removeMark(l.$from.pos,l.$to.pos)}),!0},VTe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{var l;const{extendEmptyMarkRange:o=!1}=s,{selection:c}=r,d=Dm(t,a.schema),{$from:u,empty:m,ranges:x}=c;if(!i)return!0;if(m&&o){let{from:g,to:y}=c;const v=(l=u.marks().find(w=>w.type===d))==null?void 0:l.attrs,j=GP(u,d,v);j&&(g=j.from,y=j.to),r.removeMark(g,y,d)}else x.forEach(g=>{r.removeMark(g.$from.pos,g.$to.pos,d)});return r.removeStoredMark(d),!0},HTe=t=>({tr:s,state:r,dispatch:a})=>{const{selection:i}=r;let l,o;return typeof t=="number"?(l=t,o=t):t&&"from"in t&&"to"in t?(l=t.from,o=t.to):(l=i.from,o=i.to),a&&s.doc.nodesBetween(l,o,(c,d)=>{if(c.isText)return;const u={...c.attrs};delete u.dir,s.setNodeMarkup(d,void 0,u)}),!0},WTe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{let l=null,o=null;const c=cQ(typeof t=="string"?t:t.name,a.schema);if(!c)return!1;c==="node"&&(l=mi(t,a.schema)),c==="mark"&&(o=Dm(t,a.schema));let d=!1;return r.selection.ranges.forEach(u=>{const m=u.$from.pos,x=u.$to.pos;let g,y,v,j;r.selection.empty?a.doc.nodesBetween(m,x,(w,S)=>{l&&l===w.type&&(d=!0,v=Math.max(S,m),j=Math.min(S+w.nodeSize,x),g=S,y=w)}):a.doc.nodesBetween(m,x,(w,S)=>{S<m&&l&&l===w.type&&(d=!0,v=Math.max(S,m),j=Math.min(S+w.nodeSize,x),g=S,y=w),S>=m&&S<=x&&(l&&l===w.type&&(d=!0,i&&r.setNodeMarkup(S,void 0,{...w.attrs,...s})),o&&w.marks.length&&w.marks.forEach(E=>{if(o===E.type&&(d=!0,i)){const k=Math.max(S,m),A=Math.min(S+w.nodeSize,x);r.addMark(k,A,o.create({...E.attrs,...s}))}}))}),y&&(g!==void 0&&i&&r.setNodeMarkup(g,void 0,{...y.attrs,...s}),o&&y.marks.length&&y.marks.forEach(w=>{o===w.type&&i&&r.addMark(v,j,o.create({...w.attrs,...s}))}))}),d},qTe=(t,s={})=>({state:r,dispatch:a})=>{const i=mi(t,r.schema);return AX(i,s)(r,a)},GTe=(t,s={})=>({state:r,dispatch:a})=>{const i=mi(t,r.schema);return EX(i,s)(r,a)},xQ=class{constructor(s){var r;this.find=s.find,this.handler=s.handler,this.undoable=(r=s.undoable)!=null?r:!0}};function KTe(t){return Object.prototype.toString.call(t).slice(8,-1)}function K1(t){return KTe(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function pQ(t,s){const r={...t};return K1(t)&&K1(s)&&Object.keys(s).forEach(a=>{K1(s[a])&&K1(t[a])?r[a]=pQ(t[a],s[a]):r[a]=s[a]}),r}var QP=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Zh(lf(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Zh(lf(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const s=this.extend({...this.config,addOptions:()=>pQ(this.options,t)});return s.name=this.name,s.parent=this.parent,s}extend(t={}){const s=new this.constructor({...this.config,...t});return s.parent=this,this.child=s,s.name="name"in t?t.name:s.parent.name,s}},ZP=class fQ extends QP{constructor(){super(...arguments),this.type="mark"}static create(s={}){const r=typeof s=="function"?s():s;return new fQ(r)}static handleExit({editor:s,mark:r}){const{tr:a}=s.state,i=s.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===r.name))return!1;const d=o.find(u=>(u==null?void 0:u.type.name)===r.name);return d&&a.removeStoredMark(d),a.insertText(" ",i.pos),s.view.dispatch(a),!0}return!1}configure(s){return super.configure(s)}extend(s){const r=typeof s=="function"?s():s;return super.extend(r)}},YTe=class{constructor(s){this.find=s.find,this.handler=s.handler}},XTe={};qP(XTe,{ClipboardTextSerializer:()=>QTe,Commands:()=>ZTe,Delete:()=>JTe,Drop:()=>ePe,Editable:()=>tPe,FocusEvents:()=>sPe,Keymap:()=>nPe,Paste:()=>rPe,Tabindex:()=>aPe,TextDirection:()=>iPe,focusEventsPluginKey:()=>bQ});var Ca=class gQ extends QP{constructor(){super(...arguments),this.type="extension"}static create(s={}){const r=typeof s=="function"?s():s;return new gQ(r)}configure(s){return super.configure(s)}extend(s){const r=typeof s=="function"?s():s;return super.extend(r)}},QTe=Ca.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Ir({key:new Or("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:s,schema:r}=t,{doc:a,selection:i}=s,{ranges:l}=i,o=Math.min(...l.map(m=>m.$from.pos)),c=Math.max(...l.map(m=>m.$to.pos)),d=NTe(r);return jTe(a,{from:o,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:d})}}})]}}),ZTe=Ca.create({name:"commands",addCommands(){return{...rQ}}}),JTe=Ca.create({name:"delete",onUpdate({transaction:t,appendedTransactions:s}){var r,a,i;const l=()=>{var o,c,d,u;if((u=(d=(c=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:c.filterTransaction)==null?void 0:d.call(c,t))!=null?u:t.getMeta("y-sync$"))return;const m=bTe(t.before,[t,...s]);STe(m).forEach(y=>{m.mapping.mapResult(y.oldRange.from).deletedAfter&&m.mapping.mapResult(y.oldRange.to).deletedBefore&&m.before.nodesBetween(y.oldRange.from,y.oldRange.to,(v,j)=>{const w=j+v.nodeSize-2,S=y.oldRange.from<=j&&w<=y.oldRange.to;this.editor.emit("delete",{type:"node",node:v,from:j,to:w,newFrom:m.mapping.map(j),newTo:m.mapping.map(w),deletedRange:y.oldRange,newRange:y.newRange,partial:!S,editor:this.editor,transaction:t,combinedTransform:m})})});const g=m.mapping;m.steps.forEach((y,v)=>{var j,w;if(y instanceof lc){const S=g.slice(v).map(y.from,-1),E=g.slice(v).map(y.to),k=g.invert().map(S,-1),A=g.invert().map(E),I=(j=m.doc.nodeAt(S-1))==null?void 0:j.marks.some(O=>O.eq(y.mark)),P=(w=m.doc.nodeAt(E))==null?void 0:w.marks.some(O=>O.eq(y.mark));this.editor.emit("delete",{type:"mark",mark:y.mark,from:y.from,to:y.to,deletedRange:{from:k,to:A},newRange:{from:S,to:E},partial:!!(P||I),editor:this.editor,transaction:t,combinedTransform:m})}})};(i=(a=(r=this.editor.options.coreExtensionOptions)==null?void 0:r.delete)==null?void 0:a.async)==null||i?setTimeout(l,0):l()}}),ePe=Ca.create({name:"drop",addProseMirrorPlugins(){return[new Ir({key:new Or("tiptapDrop"),props:{handleDrop:(t,s,r,a)=>{this.editor.emit("drop",{editor:this.editor,event:s,slice:r,moved:a})}}})]}}),tPe=Ca.create({name:"editable",addProseMirrorPlugins(){return[new Ir({key:new Or("editable"),props:{editable:()=>this.editor.options.editable}})]}}),bQ=new Or("focusEvents"),sPe=Ca.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Ir({key:bQ,props:{handleDOMEvents:{focus:(s,r)=>{t.isFocused=!0;const a=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return s.dispatch(a),!1},blur:(s,r)=>{t.isFocused=!1;const a=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return s.dispatch(a),!1}}}})]}}),nPe=Ca.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:c})=>{const{selection:d,doc:u}=c,{empty:m,$anchor:x}=d,{pos:g,parent:y}=x,v=x.parent.isTextblock&&g>0?c.doc.resolve(g-1):x,j=v.parent.type.spec.isolating,w=x.pos-x.parentOffset,S=j&&v.parent.childCount===1?w===x.pos:is.atStart(u).from===g;return!m||!y.type.isTextblock||y.textContent.length||!S||S&&x.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),s=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),a={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:s,"Mod-Delete":s,"Mod-a":()=>this.editor.commands.selectAll()},i={...a},l={...a,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":s,"Ctrl-Alt-Backspace":s,"Alt-Delete":s,"Alt-d":s,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return KP()||oQ()?l:i},addProseMirrorPlugins(){return[new Ir({key:new Or("clearDocument"),appendTransaction:(t,s,r)=>{if(t.some(j=>j.getMeta("composition")))return;const a=t.some(j=>j.docChanged)&&!s.doc.eq(r.doc),i=t.some(j=>j.getMeta("preventClearDocument"));if(!a||i)return;const{empty:l,from:o,to:c}=s.selection,d=is.atStart(s.doc).from,u=is.atEnd(s.doc).to;if(l||!(o===d&&c===u)||!hQ(r.doc))return;const g=r.tr,y=nQ({state:r,transaction:g}),{commands:v}=new wEe({editor:this.editor,state:y});if(v.clearNodes(),!!g.steps.length)return g}})]}}),rPe=Ca.create({name:"paste",addProseMirrorPlugins(){return[new Ir({key:new Or("tiptapPaste"),props:{handlePaste:(t,s,r)=>{this.editor.emit("paste",{editor:this.editor,event:s,slice:r})}}})]}}),aPe=Ca.create({name:"tabindex",addProseMirrorPlugins(){return[new Ir({key:new Or("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),iPe=Ca.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=uQ(this.extensions);return[{types:t.filter(s=>s.name!=="text").map(s=>s.name),attributes:{dir:{default:this.options.direction,parseHTML:s=>{const r=s.getAttribute("dir");return r&&(r==="ltr"||r==="rtl"||r==="auto")?r:this.options.direction},renderHTML:s=>s.dir?{dir:s.dir}:{}}}}]},addProseMirrorPlugins(){return[new Ir({key:new Or("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}});function lPe(t){return new xQ({find:t.find,handler:({state:s,range:r,match:a})=>{const i=Zh(t.getAttributes,void 0,a);if(i===!1||i===null)return null;const{tr:l}=s,o=a[a.length-1],c=a[0];if(o){const d=c.search(/\S/),u=r.from+c.indexOf(o),m=u+o.length;if(mQ(r.from,r.to,s.doc).filter(y=>y.mark.type.excluded.find(j=>j===t.type&&j!==y.mark.type)).filter(y=>y.to>u).length)return null;m<r.to&&l.delete(m,r.to),u>r.from&&l.delete(r.from+d,u);const g=r.from+d+o.length;l.addMark(r.from+d,g,t.type.create(i||{})),l.removeStoredMark(t.type)}},undoable:t.undoable})}function oPe(t){return new xQ({find:t.find,handler:({state:s,range:r,match:a})=>{const i=Zh(t.getAttributes,void 0,a)||{},{tr:l}=s,o=r.from;let c=r.to;const d=t.type.create(i);if(a[1]){const u=a[0].lastIndexOf(a[1]);let m=o+u;m>c?m=c:c=m+a[1].length;const x=a[0][a[0].length-1];l.insertText(x,o+a[0].length-1),l.replaceWith(m,c,d)}else if(a[0]){const u=t.type.isInline?o:o-1;l.insert(u,t.type.create(i)).delete(l.mapping.map(o),l.mapping.map(c))}l.scrollIntoView()},undoable:t.undoable})}var cPe=t=>"touches"in t,dPe=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=c=>{if(!this.isResizing||!this.activeHandle)return;const d=c.clientX-this.startX,u=c.clientY-this.startY;this.handleResize(d,u)},this.handleTouchMove=c=>{if(!this.isResizing||!this.activeHandle)return;const d=c.touches[0];if(!d)return;const u=d.clientX-this.startX,m=d.clientY-this.startY;this.handleResize(u,m)},this.handleMouseUp=()=>{if(!this.isResizing)return;const c=this.element.offsetWidth,d=this.element.offsetHeight;this.onCommit(c,d),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=c=>{c.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=c=>{c.key==="Shift"&&(this.isShiftKeyPressed=!1)};var s,r,a,i,l,o;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(s=t.options)!=null&&s.min&&(this.minSize={...this.minSize,...t.options.min}),(r=t.options)!=null&&r.max&&(this.maxSize=t.options.max),(a=t==null?void 0:t.options)!=null&&a.directions&&(this.directions=t.options.directions),(i=t.options)!=null&&i.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(l=t.options)!=null&&l.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(o=t.options)!=null&&o.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){return this.contentElement}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,s,r){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,s,r):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const s=document.createElement("div");return s.dataset.resizeHandle=t,s.style.position="absolute",this.classNames.handle&&(s.className=this.classNames.handle),s}positionHandle(t,s){const r=s.includes("top"),a=s.includes("bottom"),i=s.includes("left"),l=s.includes("right");r&&(t.style.top="0"),a&&(t.style.bottom="0"),i&&(t.style.left="0"),l&&(t.style.right="0"),(s==="top"||s==="bottom")&&(t.style.left="0",t.style.right="0"),(s==="left"||s==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let s;this.createCustomHandle?s=this.createCustomHandle(t):s=this.createHandle(t),s instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),s=this.createHandle(t)),this.createCustomHandle||this.positionHandle(s,t),s.addEventListener("mousedown",r=>this.handleResizeStart(r,t)),s.addEventListener("touchstart",r=>this.handleResizeStart(r,t)),this.handleMap.set(t,s),this.wrapper.appendChild(s)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,s=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,s?(this.element.style.height=`${s}px`,this.initialHeight=s):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,s){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=s,cPe(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,s){if(!this.activeHandle)return;const r=this.preserveAspectRatio||this.isShiftKeyPressed,{width:a,height:i}=this.calculateNewDimensions(this.activeHandle,t,s),l=this.applyConstraints(a,i,r);this.element.style.width=`${l.width}px`,this.element.style.height=`${l.height}px`,this.onResize&&this.onResize(l.width,l.height)}calculateNewDimensions(t,s,r){let a=this.startWidth,i=this.startHeight;const l=t.includes("right"),o=t.includes("left"),c=t.includes("bottom"),d=t.includes("top");return l?a=this.startWidth+s:o&&(a=this.startWidth-s),c?i=this.startHeight+r:d&&(i=this.startHeight-r),(t==="right"||t==="left")&&(a=this.startWidth+(l?s:-s)),(t==="top"||t==="bottom")&&(i=this.startHeight+(c?r:-r)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(a,i,t):{width:a,height:i}}applyConstraints(t,s,r){var a,i,l,o;if(!r){let u=Math.max(this.minSize.width,t),m=Math.max(this.minSize.height,s);return(a=this.maxSize)!=null&&a.width&&(u=Math.min(this.maxSize.width,u)),(i=this.maxSize)!=null&&i.height&&(m=Math.min(this.maxSize.height,m)),{width:u,height:m}}let c=t,d=s;return c<this.minSize.width&&(c=this.minSize.width,d=c/this.aspectRatio),d<this.minSize.height&&(d=this.minSize.height,c=d*this.aspectRatio),(l=this.maxSize)!=null&&l.width&&c>this.maxSize.width&&(c=this.maxSize.width,d=c/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&d>this.maxSize.height&&(d=this.maxSize.height,c=d*this.aspectRatio),{width:c,height:d}}applyAspectRatio(t,s,r){const a=r==="left"||r==="right",i=r==="top"||r==="bottom";return a?{width:t,height:t/this.aspectRatio}:i?{width:s*this.aspectRatio,height:s}:{width:t,height:t/this.aspectRatio}}},uPe={};qP(uPe,{createAtomBlockMarkdownSpec:()=>mPe,createBlockMarkdownSpec:()=>hPe,createInlineMarkdownSpec:()=>fPe,parseAttributes:()=>JP,parseIndentedBlocks:()=>gPe,renderNestedMarkdownContent:()=>bPe,serializeAttributes:()=>eD});function JP(t){if(!(t!=null&&t.trim()))return{};const s={},r=[],a=t.replace(/["']([^"']*)["']/g,u=>(r.push(u),`__QUOTED_${r.length-1}__`)),i=a.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const u=i.map(m=>m.trim().slice(1));s.class=u.join(" ")}const l=a.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);l&&(s.id=l[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(a.matchAll(o)).forEach(([,u,m])=>{var x;const g=parseInt(((x=m.match(/__QUOTED_(\d+)__/))==null?void 0:x[1])||"0",10),y=r[g];y&&(s[u]=y.slice(1,-1))});const d=a.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return d&&d.split(/\s+/).filter(Boolean).forEach(m=>{m.match(/^[a-zA-Z][\w-]*$/)&&(s[m]=!0)}),s}function eD(t){if(!t||Object.keys(t).length===0)return"";const s=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(a=>s.push(`.${a}`)),t.id&&s.push(`#${t.id}`),Object.entries(t).forEach(([r,a])=>{r==="class"||r==="id"||(a===!0?s.push(r):a!==!1&&a!=null&&s.push(`${r}="${String(a)}"`))}),s.join(" ")}function mPe(t){const{nodeName:s,name:r,parseAttributes:a=JP,serializeAttributes:i=eD,defaultAttributes:l={},requiredAttributes:o=[],allowedAttributes:c}=t,d=r||s,u=m=>{if(!c)return m;const x={};return c.forEach(g=>{g in m&&(x[g]=m[g])}),x};return{parseMarkdown:(m,x)=>{const g={...l,...m.attributes};return x.createNode(s,g,[])},markdownTokenizer:{name:s,level:"block",start(m){var x;const g=new RegExp(`^:::${d}(?:\\s|$)`,"m"),y=(x=m.match(g))==null?void 0:x.index;return y!==void 0?y:-1},tokenize(m,x,g){const y=new RegExp(`^:::${d}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),v=m.match(y);if(!v)return;const j=v[1]||"",w=a(j);if(!o.find(E=>!(E in w)))return{type:s,raw:v[0],attributes:w}}},renderMarkdown:m=>{const x=u(m.attrs||{}),g=i(x),y=g?` {${g}}`:"";return`:::${d}${y} :::`}}}function hPe(t){const{nodeName:s,name:r,getContent:a,parseAttributes:i=JP,serializeAttributes:l=eD,defaultAttributes:o={},content:c="block",allowedAttributes:d}=t,u=r||s,m=x=>{if(!d)return x;const g={};return d.forEach(y=>{y in x&&(g[y]=x[y])}),g};return{parseMarkdown:(x,g)=>{let y;if(a){const j=a(x);y=typeof j=="string"?[{type:"text",text:j}]:j}else c==="block"?y=g.parseChildren(x.tokens||[]):y=g.parseInline(x.tokens||[]);const v={...o,...x.attributes};return g.createNode(s,v,y)},markdownTokenizer:{name:s,level:"block",start(x){var g;const y=new RegExp(`^:::${u}`,"m"),v=(g=x.match(y))==null?void 0:g.index;return v!==void 0?v:-1},tokenize(x,g,y){var v;const j=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),w=x.match(j);if(!w)return;const[S,E=""]=w,k=i(E);let A=1;const I=S.length;let P="";const O=/^:::([\w-]*)(\s.*)?/gm,D=x.slice(I);for(O.lastIndex=0;;){const T=O.exec(D);if(T===null)break;const B=T.index,U=T[1];if(!((v=T[2])!=null&&v.endsWith(":::"))){if(U)A+=1;else if(A-=1,A===0){const W=D.slice(0,B);P=W.trim();const V=x.slice(0,I+B+T[0].length);let R=[];if(P)if(c==="block")for(R=y.blockTokens(W),R.forEach(F=>{F.text&&(!F.tokens||F.tokens.length===0)&&(F.tokens=y.inlineTokens(F.text))});R.length>0;){const F=R[R.length-1];if(F.type==="paragraph"&&(!F.text||F.text.trim()===""))R.pop();else break}else R=y.inlineTokens(P);return{type:s,raw:V,attributes:k,content:P,tokens:R}}}}}},renderMarkdown:(x,g)=>{const y=m(x.attrs||{}),v=l(y),j=v?` {${v}}`:"",w=g.renderChildren(x.content||[],`

`);return`:::${u}${j}

${w}

:::`}}}function xPe(t){if(!t.trim())return{};const s={},r=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let a=r.exec(t);for(;a!==null;){const[,i,l,o]=a;s[i]=l||o,a=r.exec(t)}return s}function pPe(t){return Object.entries(t).filter(([,s])=>s!=null).map(([s,r])=>`${s}="${r}"`).join(" ")}function fPe(t){const{nodeName:s,name:r,getContent:a,parseAttributes:i=xPe,serializeAttributes:l=pPe,defaultAttributes:o={},selfClosing:c=!1,allowedAttributes:d}=t,u=r||s,m=g=>{if(!d)return g;const y={};return d.forEach(v=>{const j=typeof v=="string"?v:v.name,w=typeof v=="string"?void 0:v.skipIfDefault;if(j in g){const S=g[j];if(w!==void 0&&S===w)return;y[j]=S}}),y},x=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(g,y)=>{const v={...o,...g.attributes};if(c)return y.createNode(s,v);const j=a?a(g):g.content||"";return j?y.createNode(s,v,[y.createTextNode(j)]):y.createNode(s,v,[])},markdownTokenizer:{name:s,level:"inline",start(g){const y=c?new RegExp(`\\[${x}\\s*[^\\]]*\\]`):new RegExp(`\\[${x}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${x}\\]`),v=g.match(y),j=v==null?void 0:v.index;return j!==void 0?j:-1},tokenize(g,y,v){const j=c?new RegExp(`^\\[${x}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${x}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${x}\\]`),w=g.match(j);if(!w)return;let S="",E="";if(c){const[,A]=w;E=A}else{const[,A,I]=w;E=A,S=I||""}const k=i(E.trim());return{type:s,raw:w[0],content:S.trim(),attributes:k}}},renderMarkdown:g=>{let y="";a?y=a(g):g.content&&g.content.length>0&&(y=g.content.filter(S=>S.type==="text").map(S=>S.text).join(""));const v=m(g.attrs||{}),j=l(v),w=j?` ${j}`:"";return c?`[${u}${w}]`:`[${u}${w}]${y}[/${u}]`}}}function gPe(t,s,r){var a,i,l,o;const c=t.split(`
`),d=[];let u="",m=0;const x=s.baseIndentSize||2;for(;m<c.length;){const g=c[m],y=g.match(s.itemPattern);if(!y){if(d.length>0)break;if(g.trim()===""){m+=1,u=`${u}${g}
`;continue}else return}const v=s.extractItemData(y),{indentLevel:j,mainContent:w}=v;u=`${u}${g}
`;const S=[w];for(m+=1;m<c.length;){const I=c[m];if(I.trim()===""){const O=c.slice(m+1).findIndex(B=>B.trim()!=="");if(O===-1)break;if((((i=(a=c[m+1+O].match(/^(\s*)/))==null?void 0:a[1])==null?void 0:i.length)||0)>j){S.push(I),u=`${u}${I}
`,m+=1;continue}else break}if((((o=(l=I.match(/^(\s*)/))==null?void 0:l[1])==null?void 0:o.length)||0)>j)S.push(I),u=`${u}${I}
`,m+=1;else break}let E;const k=S.slice(1);if(k.length>0){const I=k.map(P=>P.slice(j+x)).join(`
`);I.trim()&&(s.customNestedParser?E=s.customNestedParser(I):E=r.blockTokens(I))}const A=s.createToken(v,E);d.push(A)}if(d.length!==0)return{items:d,raw:u}}function bPe(t,s,r,a){if(!t||!Array.isArray(t.content))return"";const i=typeof r=="function"?r(a):r,[l,...o]=t.content,c=s.renderChildren([l]),d=[`${i}${c}`];return o&&o.length>0&&o.forEach(u=>{const m=s.renderChildren([u]);if(m){const x=m.split(`
`).map(g=>g?s.indent(g):"").join(`
`);d.push(x)}}),d.join(`
`)}var by=class yQ extends QP{constructor(){super(...arguments),this.type="node"}static create(s={}){const r=typeof s=="function"?s():s;return new yQ(r)}configure(s){return super.configure(s)}extend(s){const r=typeof s=="function"?s():s;return super.extend(r)}};function yPe(t){return new YTe({find:t.find,handler:({state:s,range:r,match:a,pasteEvent:i})=>{const l=Zh(t.getAttributes,void 0,a,i);if(l===!1||l===null)return null;const{tr:o}=s,c=a[a.length-1],d=a[0];let u=r.to;if(c){const m=d.search(/\S/),x=r.from+d.indexOf(c),g=x+c.length;if(mQ(r.from,r.to,s.doc).filter(v=>v.mark.type.excluded.find(w=>w===t.type&&w!==v.mark.type)).filter(v=>v.to>x).length)return null;g<r.to&&o.delete(g,r.to),x>r.from&&o.delete(r.from+m,x),u=r.from+m+c.length,o.addMark(r.from+m,u,t.type.create(l||{})),o.removeStoredMark(t.type)}}})}function vQ(t){const{state:s,transaction:r}=t;let{selection:a}=r,{doc:i}=r,{storedMarks:l}=r;return{...s,apply:s.apply.bind(s),applyTransaction:s.applyTransaction.bind(s),plugins:s.plugins,schema:s.schema,reconfigure:s.reconfigure.bind(s),toJSON:s.toJSON.bind(s),get storedMarks(){return l},get selection(){return a},get doc(){return i},get tr(){return a=r.selection,i=r.doc,l=r.storedMarks,r}}}class vPe{constructor(s){this.editor=s.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=s.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:s,editor:r,state:a}=this,{view:i}=r,{tr:l}=a,o=this.buildProps(l);return Object.fromEntries(Object.entries(s).map(([c,d])=>[c,(...m)=>{const x=d(...m)(o);return!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),x}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(s,r=!0){const{rawCommands:a,editor:i,state:l}=this,{view:o}=i,c=[],d=!!s,u=s||l.tr,m=()=>(!d&&r&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),c.every(g=>g===!0)),x={...Object.fromEntries(Object.entries(a).map(([g,y])=>[g,(...j)=>{const w=this.buildProps(u,r),S=y(...j)(w);return c.push(S),x}])),run:m};return x}createCan(s){const{rawCommands:r,state:a}=this,i=!1,l=s||a.tr,o=this.buildProps(l,i);return{...Object.fromEntries(Object.entries(r).map(([d,u])=>[d,(...m)=>u(...m)({...o,dispatch:void 0})])),chain:()=>this.createChain(l,i)}}buildProps(s,r=!0){const{rawCommands:a,editor:i,state:l}=this,{view:o}=i,c={tr:s,editor:i,view:o,state:vQ({state:l,transaction:s}),dispatch:r?()=>{}:void 0,chain:()=>this.createChain(s,r),can:()=>this.createCan(s),get commands(){return Object.fromEntries(Object.entries(a).map(([d,u])=>[d,(...m)=>u(...m)(c)]))}};return c}}function oi(t,s,r){return t.config[s]===void 0&&t.parent?oi(t.parent,s,r):typeof t.config[s]=="function"?t.config[s].bind({...r,parent:t.parent?oi(t.parent,s,r):null}):t.config[s]}function jPe(t){const s=t.filter(i=>i.type==="extension"),r=t.filter(i=>i.type==="node"),a=t.filter(i=>i.type==="mark");return{baseExtensions:s,nodeExtensions:r,markExtensions:a}}function hi(t,s){if(typeof t=="string"){if(!s.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return s.nodes[t]}return t}function pl(...t){return t.filter(s=>!!s).reduce((s,r)=>{const a={...s};return Object.entries(r).forEach(([i,l])=>{if(!a[i]){a[i]=l;return}if(i==="class"){const c=l?String(l).split(" "):[],d=a[i]?a[i].split(" "):[],u=c.filter(m=>!d.includes(m));a[i]=[...d,...u].join(" ")}else if(i==="style"){const c=l?l.split(";").map(m=>m.trim()).filter(Boolean):[],d=a[i]?a[i].split(";").map(m=>m.trim()).filter(Boolean):[],u=new Map;d.forEach(m=>{const[x,g]=m.split(":").map(y=>y.trim());u.set(x,g)}),c.forEach(m=>{const[x,g]=m.split(":").map(y=>y.trim());u.set(x,g)}),a[i]=Array.from(u.entries()).map(([m,x])=>`${m}: ${x}`).join("; ")}else a[i]=l}),a},{})}function NPe(t){return typeof t=="function"}function ua(t,s=void 0,...r){return NPe(t)?s?t.bind(s)(...r):t(...r):t}function wPe(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class s_{constructor(s){this.find=s.find,this.handler=s.handler}}function _Pe(t){return Object.prototype.toString.call(t).slice(8,-1)}function Y1(t){return _Pe(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function n_(t,s){const r={...t};return Y1(t)&&Y1(s)&&Object.keys(s).forEach(a=>{Y1(s[a])&&Y1(t[a])?r[a]=n_(t[a],s[a]):r[a]=s[a]}),r}class Jh{constructor(s={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...s},this.name=this.config.name,s.defaultOptions&&Object.keys(s.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ua(oi(this,"addOptions",{name:this.name}))),this.storage=ua(oi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(s={}){return new Jh(s)}configure(s={}){const r=this.extend({...this.config,addOptions:()=>n_(this.options,s)});return r.name=this.name,r.parent=this.parent,r}extend(s={}){const r=new Jh(s);return r.parent=this,this.child=r,r.name=s.name?s.name:r.parent.name,s.defaultOptions&&Object.keys(s.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=ua(oi(r,"addOptions",{name:r.name})),r.storage=ua(oi(r,"addStorage",{name:r.name,options:r.options})),r}static handleExit({editor:s,mark:r}){const{tr:a}=s.state,i=s.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===r.name))return!1;const d=o.find(u=>(u==null?void 0:u.type.name)===r.name);return d&&a.removeStoredMark(d),a.insertText(" ",i.pos),s.view.dispatch(a),!0}return!1}}class SPe{constructor(s){this.find=s.find,this.handler=s.handler}}class Di{constructor(s={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...s},this.name=this.config.name,s.defaultOptions&&Object.keys(s.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ua(oi(this,"addOptions",{name:this.name}))),this.storage=ua(oi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(s={}){return new Di(s)}configure(s={}){const r=this.extend({...this.config,addOptions:()=>n_(this.options,s)});return r.name=this.name,r.parent=this.parent,r}extend(s={}){const r=new Di({...this.config,...s});return r.parent=this,this.child=r,r.name=s.name?s.name:r.parent.name,s.defaultOptions&&Object.keys(s.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=ua(oi(r,"addOptions",{name:r.name})),r.storage=ua(oi(r,"addStorage",{name:r.name,options:r.options})),r}}function CPe(t,s,r){const{from:a,to:i}=s,{blockSeparator:l=`

`,textSerializers:o={}}=r||{};let c="";return t.nodesBetween(a,i,(d,u,m,x)=>{var g;d.isBlock&&u>a&&(c+=l);const y=o==null?void 0:o[d.type.name];if(y)return m&&(c+=y({node:d,pos:u,parent:m,index:x,range:s})),!1;d.isText&&(c+=(g=d==null?void 0:d.text)===null||g===void 0?void 0:g.slice(Math.max(a,u)-u,i-u))}),c}function kPe(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,s])=>s.spec.toText).map(([s,r])=>[s,r.spec.toText]))}Di.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Ir({key:new Or("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:s,schema:r}=t,{doc:a,selection:i}=s,{ranges:l}=i,o=Math.min(...l.map(m=>m.$from.pos)),c=Math.max(...l.map(m=>m.$to.pos)),d=kPe(r);return CPe(a,{from:o,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:d})}}})]}});const APe=()=>({editor:t,view:s})=>(requestAnimationFrame(()=>{var r;t.isDestroyed||(s.dom.blur(),(r=window==null?void 0:window.getSelection())===null||r===void 0||r.removeAllRanges())}),!0),EPe=(t=!1)=>({commands:s})=>s.setContent("",t),TPe=()=>({state:t,tr:s,dispatch:r})=>{const{selection:a}=s,{ranges:i}=a;return r&&i.forEach(({$from:l,$to:o})=>{t.doc.nodesBetween(l.pos,o.pos,(c,d)=>{if(c.type.isText)return;const{doc:u,mapping:m}=s,x=u.resolve(m.map(d)),g=u.resolve(m.map(d+c.nodeSize)),y=x.blockRange(g);if(!y)return;const v=fx(y);if(c.type.isTextblock){const{defaultType:j}=x.parent.contentMatchAt(x.index());s.setNodeMarkup(y.start,j)}(v||v===0)&&s.lift(y,v)})}),!0},PPe=t=>s=>t(s),DPe=()=>({state:t,dispatch:s})=>OP(t,s),MPe=(t,s)=>({editor:r,tr:a})=>{const{state:i}=r,l=i.doc.slice(t.from,t.to);a.deleteRange(t.from,t.to);const o=a.mapping.map(s);return a.insert(o,l.content),a.setSelection(new Qt(a.doc.resolve(Math.max(o-1,0)))),!0},IPe=()=>({tr:t,dispatch:s})=>{const{selection:r}=t,a=r.$anchor.node();if(a.content.size>0)return!1;const i=t.selection.$anchor;for(let l=i.depth;l>0;l-=1)if(i.node(l).type===a.type){if(s){const c=i.before(l),d=i.after(l);t.delete(c,d).scrollIntoView()}return!0}return!1},OPe=t=>({tr:s,state:r,dispatch:a})=>{const i=hi(t,r.schema),l=s.selection.$anchor;for(let o=l.depth;o>0;o-=1)if(l.node(o).type===i){if(a){const d=l.before(o),u=l.after(o);s.delete(d,u).scrollIntoView()}return!0}return!1},RPe=t=>({tr:s,dispatch:r})=>{const{from:a,to:i}=t;return r&&s.delete(a,i),!0},LPe=()=>({state:t,dispatch:s})=>J2(t,s),FPe=()=>({commands:t})=>t.keyboardShortcut("Enter"),BPe=()=>({state:t,dispatch:s})=>NX(t,s);function ON(t,s,r={strict:!0}){const a=Object.keys(s);return a.length?a.every(i=>r.strict?s[i]===t[i]:wPe(s[i])?s[i].test(t[i]):s[i]===t[i]):!0}function jQ(t,s,r={}){return t.find(a=>a.type===s&&ON(Object.fromEntries(Object.keys(r).map(i=>[i,a.attrs[i]])),r))}function ZL(t,s,r={}){return!!jQ(t,s,r)}function tD(t,s,r){var a;if(!t||!s)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(m=>m.type===s))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(m=>m.type===s)||(r=r||((a=i.node.marks[0])===null||a===void 0?void 0:a.attrs),!jQ([...i.node.marks],s,r)))return;let o=i.index,c=t.start()+i.offset,d=o+1,u=c+i.node.nodeSize;for(;o>0&&ZL([...t.parent.child(o-1).marks],s,r);)o-=1,c-=t.parent.child(o).nodeSize;for(;d<t.parent.childCount&&ZL([...t.parent.child(d).marks],s,r);)u+=t.parent.child(d).nodeSize,d+=1;return{from:c,to:u}}function Im(t,s){if(typeof t=="string"){if(!s.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return s.marks[t]}return t}const $Pe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{const l=Im(t,a.schema),{doc:o,selection:c}=r,{$from:d,from:u,to:m}=c;if(i){const x=tD(d,l,s);if(x&&x.from<=u&&x.to>=m){const g=Qt.create(o,x.from,x.to);r.setSelection(g)}}return!0},zPe=t=>s=>{const r=typeof t=="function"?t(s):t;for(let a=0;a<r.length;a+=1)if(r[a](s))return!0;return!1};function NQ(t){return t instanceof Qt}function uh(t=0,s=0,r=0){return Math.min(Math.max(t,s),r)}function UPe(t,s=null){if(!s)return null;const r=is.atStart(t),a=is.atEnd(t);if(s==="start"||s===!0)return r;if(s==="end")return a;const i=r.from,l=a.to;return s==="all"?Qt.create(t,uh(0,i,l),uh(t.content.size,i,l)):Qt.create(t,uh(s,i,l),uh(s,i,l))}function VPe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function sD(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const HPe=(t=null,s={})=>({editor:r,view:a,tr:i,dispatch:l})=>{s={scrollIntoView:!0,...s};const o=()=>{(sD()||VPe())&&a.dom.focus(),requestAnimationFrame(()=>{r.isDestroyed||(a.focus(),s!=null&&s.scrollIntoView&&r.commands.scrollIntoView())})};if(a.hasFocus()&&t===null||t===!1)return!0;if(l&&t===null&&!NQ(r.state.selection))return o(),!0;const c=UPe(i.doc,t)||r.state.selection,d=r.state.selection.eq(c);return l&&(d||i.setSelection(c),d&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},WPe=(t,s)=>r=>t.every((a,i)=>s(a,{...r,index:i})),qPe=(t,s)=>({tr:r,commands:a})=>a.insertContentAt({from:r.selection.from,to:r.selection.to},t,s),wQ=t=>{const s=t.childNodes;for(let r=s.length-1;r>=0;r-=1){const a=s[r];a.nodeType===3&&a.nodeValue&&/^(\n\s\s|\n)$/.test(a.nodeValue)?t.removeChild(a):a.nodeType===1&&wQ(a)}return t};function X1(t){const s=`<body>${t}</body>`,r=new window.DOMParser().parseFromString(s,"text/html").body;return wQ(r)}function Eb(t,s,r){if(t instanceof lm||t instanceof vt)return t;r={slice:!0,parseOptions:{},...r};const a=typeof t=="object"&&t!==null,i=typeof t=="string";if(a)try{if(Array.isArray(t)&&t.length>0)return vt.fromArray(t.map(c=>s.nodeFromJSON(c)));const o=s.nodeFromJSON(t);return r.errorOnInvalidContent&&o.check(),o}catch(l){if(r.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:l});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",l),Eb("",s,r)}if(i){if(r.errorOnInvalidContent){let o=!1,c="";const d=new KY({topNode:s.spec.topNode,marks:s.spec.marks,nodes:s.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,c=typeof u=="string"?u:u.outerHTML,null)}]}})});if(r.slice?Ah.fromSchema(d).parseSlice(X1(t),r.parseOptions):Ah.fromSchema(d).parse(X1(t),r.parseOptions),r.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const l=Ah.fromSchema(s);return r.slice?l.parseSlice(X1(t),r.parseOptions).content:l.parse(X1(t),r.parseOptions)}return Eb("",s,r)}function GPe(t,s,r){const a=t.steps.length-1;if(a<s)return;const i=t.steps[a];if(!(i instanceof la||i instanceof ma))return;const l=t.mapping.maps[a];let o=0;l.forEach((c,d,u,m)=>{o===0&&(o=m)}),t.setSelection(is.near(t.doc.resolve(o),r))}const KPe=t=>!("type"in t),YPe=(t,s,r)=>({tr:a,dispatch:i,editor:l})=>{var o;if(i){r={parseOptions:l.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...r};let c;const d=w=>{l.emit("contentError",{editor:l,error:w,disableCollaboration:()=>{l.storage.collaboration&&(l.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...r.parseOptions};if(!r.errorOnInvalidContent&&!l.options.enableContentCheck&&l.options.emitContentError)try{Eb(s,l.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(w){d(w)}try{c=Eb(s,l.schema,{parseOptions:u,errorOnInvalidContent:(o=r.errorOnInvalidContent)!==null&&o!==void 0?o:l.options.enableContentCheck})}catch(w){return d(w),!1}let{from:m,to:x}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},g=!0,y=!0;if((KPe(c)?c:[c]).forEach(w=>{w.check(),g=g?w.isText&&w.marks.length===0:!1,y=y?w.isBlock:!1}),m===x&&y){const{parent:w}=a.doc.resolve(m);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(m-=1,x+=1)}let j;if(g){if(Array.isArray(s))j=s.map(w=>w.text||"").join("");else if(s instanceof vt){let w="";s.forEach(S=>{S.text&&(w+=S.text)}),j=w}else typeof s=="object"&&s&&s.text?j=s.text:j=s;a.insertText(j,m,x)}else j=c,a.replaceWith(m,x,j);r.updateSelection&&GPe(a,a.steps.length-1,-1),r.applyInputRules&&a.setMeta("applyInputRules",{from:m,text:j}),r.applyPasteRules&&a.setMeta("applyPasteRules",{from:m,text:j})}return!0},XPe=()=>({state:t,dispatch:s})=>yX(t,s),QPe=()=>({state:t,dispatch:s})=>vX(t,s),ZPe=()=>({state:t,dispatch:s})=>kP(t,s),JPe=()=>({state:t,dispatch:s})=>TP(t,s),eDe=()=>({state:t,dispatch:s,tr:r})=>{try{const a=Of(t.doc,t.selection.$from.pos,-1);return a==null?!1:(r.join(a,2),s&&s(r),!0)}catch{return!1}},tDe=()=>({state:t,dispatch:s,tr:r})=>{try{const a=Of(t.doc,t.selection.$from.pos,1);return a==null?!1:(r.join(a,2),s&&s(r),!0)}catch{return!1}},sDe=()=>({state:t,dispatch:s})=>pX(t,s),nDe=()=>({state:t,dispatch:s})=>fX(t,s);function _Q(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function rDe(t){const s=t.split(/-(?!$)/);let r=s[s.length-1];r==="Space"&&(r=" ");let a,i,l,o;for(let c=0;c<s.length-1;c+=1){const d=s[c];if(/^(cmd|meta|m)$/i.test(d))o=!0;else if(/^a(lt)?$/i.test(d))a=!0;else if(/^(c|ctrl|control)$/i.test(d))i=!0;else if(/^s(hift)?$/i.test(d))l=!0;else if(/^mod$/i.test(d))sD()||_Q()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${d}`)}return a&&(r=`Alt-${r}`),i&&(r=`Ctrl-${r}`),o&&(r=`Meta-${r}`),l&&(r=`Shift-${r}`),r}const aDe=t=>({editor:s,view:r,tr:a,dispatch:i})=>{const l=rDe(t).split(/-(?!$)/),o=l.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),c=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:l.includes("Alt"),ctrlKey:l.includes("Ctrl"),metaKey:l.includes("Meta"),shiftKey:l.includes("Shift"),bubbles:!0,cancelable:!0}),d=s.captureTransaction(()=>{r.someProp("handleKeyDown",u=>u(r,c))});return d==null||d.steps.forEach(u=>{const m=u.map(a.mapping);m&&i&&a.maybeStep(m)}),!0};function nD(t,s,r={}){const{from:a,to:i,empty:l}=t.selection,o=s?hi(s,t.schema):null,c=[];t.doc.nodesBetween(a,i,(x,g)=>{if(x.isText)return;const y=Math.max(a,g),v=Math.min(i,g+x.nodeSize);c.push({node:x,from:y,to:v})});const d=i-a,u=c.filter(x=>o?o.name===x.node.type.name:!0).filter(x=>ON(x.node.attrs,r,{strict:!1}));return l?!!u.length:u.reduce((x,g)=>x+g.to-g.from,0)>=d}const iDe=(t,s={})=>({state:r,dispatch:a})=>{const i=hi(t,r.schema);return nD(r,i,s)?jX(r,a):!1},lDe=()=>({state:t,dispatch:s})=>RP(t,s),oDe=t=>({state:s,dispatch:r})=>{const a=hi(t,s.schema);return TX(a)(s,r)},cDe=()=>({state:t,dispatch:s})=>MP(t,s);function SQ(t,s){return s.nodes[t]?"node":s.marks[t]?"mark":null}function JL(t,s){const r=typeof s=="string"?[s]:s;return Object.keys(t).reduce((a,i)=>(r.includes(i)||(a[i]=t[i]),a),{})}const dDe=(t,s)=>({tr:r,state:a,dispatch:i})=>{let l=null,o=null;const c=SQ(typeof t=="string"?t:t.name,a.schema);return c?(c==="node"&&(l=hi(t,a.schema)),c==="mark"&&(o=Im(t,a.schema)),i&&r.selection.ranges.forEach(d=>{a.doc.nodesBetween(d.$from.pos,d.$to.pos,(u,m)=>{l&&l===u.type&&r.setNodeMarkup(m,void 0,JL(u.attrs,s)),o&&u.marks.length&&u.marks.forEach(x=>{o===x.type&&r.addMark(m,m+u.nodeSize,o.create(JL(x.attrs,s)))})})}),!0):!1},uDe=()=>({tr:t,dispatch:s})=>(s&&t.scrollIntoView(),!0),mDe=()=>({tr:t,dispatch:s})=>{if(s){const r=new dl(t.doc);t.setSelection(r)}return!0},hDe=()=>({state:t,dispatch:s})=>AP(t,s),xDe=()=>({state:t,dispatch:s})=>PP(t,s),pDe=()=>({state:t,dispatch:s})=>wX(t,s),fDe=()=>({state:t,dispatch:s})=>kX(t,s),gDe=()=>({state:t,dispatch:s})=>CX(t,s);function bDe(t,s,r={},a={}){return Eb(t,s,{slice:!1,parseOptions:r,errorOnInvalidContent:a.errorOnInvalidContent})}const yDe=(t,s=!1,r={},a={})=>({editor:i,tr:l,dispatch:o,commands:c})=>{var d,u;const{doc:m}=l;if(r.preserveWhitespace!=="full"){const x=bDe(t,i.schema,r,{errorOnInvalidContent:(d=a.errorOnInvalidContent)!==null&&d!==void 0?d:i.options.enableContentCheck});return o&&l.replaceWith(0,m.content.size,x).setMeta("preventUpdate",!s),!0}return o&&l.setMeta("preventUpdate",!s),c.insertContentAt({from:0,to:m.content.size},t,{parseOptions:r,errorOnInvalidContent:(u=a.errorOnInvalidContent)!==null&&u!==void 0?u:i.options.enableContentCheck})};function vDe(t,s){const r=Im(s,t.schema),{from:a,to:i,empty:l}=t.selection,o=[];l?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(a,i,d=>{o.push(...d.marks)});const c=o.find(d=>d.type.name===r.name);return c?{...c.attrs}:{}}function jDe(t){for(let s=0;s<t.edgeCount;s+=1){const{type:r}=t.edge(s);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function NDe(t,s){for(let r=t.depth;r>0;r-=1){const a=t.node(r);if(s(a))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:a}}}function rD(t){return s=>NDe(s.$from,t)}function CQ(t,s,r){const a=[];return t===s?r.resolve(t).marks().forEach(i=>{const l=r.resolve(t),o=tD(l,i.type);o&&a.push({mark:i,...o})}):r.nodesBetween(t,s,(i,l)=>{!i||(i==null?void 0:i.nodeSize)===void 0||a.push(...i.marks.map(o=>({from:l,to:l+i.nodeSize,mark:o})))}),a}function bj(t,s,r){return Object.fromEntries(Object.entries(r).filter(([a])=>{const i=t.find(l=>l.type===s&&l.name===a);return i?i.attribute.keepOnSplit:!1}))}function wDe(t,s,r={}){const{empty:a,ranges:i}=t.selection,l=s?Im(s,t.schema):null;if(a)return!!(t.storedMarks||t.selection.$from.marks()).filter(x=>l?l.name===x.type.name:!0).find(x=>ON(x.attrs,r,{strict:!1}));let o=0;const c=[];if(i.forEach(({$from:x,$to:g})=>{const y=x.pos,v=g.pos;t.doc.nodesBetween(y,v,(j,w)=>{if(!j.isText&&!j.marks.length)return;const S=Math.max(y,w),E=Math.min(v,w+j.nodeSize),k=E-S;o+=k,c.push(...j.marks.map(A=>({mark:A,from:S,to:E})))})}),o===0)return!1;const d=c.filter(x=>l?l.name===x.mark.type.name:!0).filter(x=>ON(x.mark.attrs,r,{strict:!1})).reduce((x,g)=>x+g.to-g.from,0),u=c.filter(x=>l?x.mark.type!==l&&x.mark.type.excludes(l):!0).reduce((x,g)=>x+g.to-g.from,0);return(d>0?d+u:d)>=o}function e7(t,s){const{nodeExtensions:r}=jPe(s),a=r.find(o=>o.name===t);if(!a)return!1;const i={name:a.name,options:a.options,storage:a.storage},l=ua(oi(a,"group",i));return typeof l!="string"?!1:l.split(" ").includes("list")}function kQ(t,{checkChildren:s=!0,ignoreWhitespace:r=!1}={}){var a;if(r){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((a=t.text)!==null&&a!==void 0?a:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(s){let i=!0;return t.content.forEach(l=>{i!==!1&&(kQ(l,{ignoreWhitespace:r,checkChildren:s})||(i=!1))}),i}return!1}function _De(t){return t instanceof ns}function SDe(t,s,r){var a;const{selection:i}=s;let l=null;if(NQ(i)&&(l=i.$cursor),l){const c=(a=t.storedMarks)!==null&&a!==void 0?a:l.marks();return!!r.isInSet(c)||!c.some(d=>d.type.excludes(r))}const{ranges:o}=i;return o.some(({$from:c,$to:d})=>{let u=c.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(r):!1;return t.doc.nodesBetween(c.pos,d.pos,(m,x,g)=>{if(u)return!1;if(m.isInline){const y=!g||g.type.allowsMarkType(r),v=!!r.isInSet(m.marks)||!m.marks.some(j=>j.type.excludes(r));u=y&&v}return!u}),u})}const CDe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{const{selection:l}=r,{empty:o,ranges:c}=l,d=Im(t,a.schema);if(i)if(o){const u=vDe(a,d);r.addStoredMark(d.create({...u,...s}))}else c.forEach(u=>{const m=u.$from.pos,x=u.$to.pos;a.doc.nodesBetween(m,x,(g,y)=>{const v=Math.max(y,m),j=Math.min(y+g.nodeSize,x);g.marks.find(S=>S.type===d)?g.marks.forEach(S=>{d===S.type&&r.addMark(v,j,d.create({...S.attrs,...s}))}):r.addMark(v,j,d.create(s))})});return SDe(a,r,d)},kDe=(t,s)=>({tr:r})=>(r.setMeta(t,s),!0),ADe=(t,s={})=>({state:r,dispatch:a,chain:i})=>{const l=hi(t,r.schema);let o;return r.selection.$anchor.sameParent(r.selection.$head)&&(o=r.selection.$anchor.parent.attrs),l.isTextblock?i().command(({commands:c})=>kN(l,{...o,...s})(r)?!0:c.clearNodes()).command(({state:c})=>kN(l,{...o,...s})(c,a)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},EDe=t=>({tr:s,dispatch:r})=>{if(r){const{doc:a}=s,i=uh(t,0,a.content.size),l=ns.create(a,i);s.setSelection(l)}return!0},TDe=t=>({tr:s,dispatch:r})=>{if(r){const{doc:a}=s,{from:i,to:l}=typeof t=="number"?{from:t,to:t}:t,o=Qt.atStart(a).from,c=Qt.atEnd(a).to,d=uh(i,o,c),u=uh(l,o,c),m=Qt.create(a,d,u);s.setSelection(m)}return!0},PDe=t=>({state:s,dispatch:r})=>{const a=hi(t,s.schema);return PX(a)(s,r)};function t7(t,s){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const a=r.filter(i=>s==null?void 0:s.includes(i.type.name));t.tr.ensureMarks(a)}}const DDe=({keepMarks:t=!0}={})=>({tr:s,state:r,dispatch:a,editor:i})=>{const{selection:l,doc:o}=s,{$from:c,$to:d}=l,u=i.extensionManager.attributes,m=bj(u,c.node().type.name,c.node().attrs);if(l instanceof ns&&l.node.isBlock)return!c.parentOffset||!zl(o,c.pos)?!1:(a&&(t&&t7(r,i.extensionManager.splittableMarks),s.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const x=d.parentOffset===d.parent.content.size,g=c.depth===0?void 0:jDe(c.node(-1).contentMatchAt(c.indexAfter(-1)));let y=x&&g?[{type:g,attrs:m}]:void 0,v=zl(s.doc,s.mapping.map(c.pos),1,y);if(!y&&!v&&zl(s.doc,s.mapping.map(c.pos),1,g?[{type:g}]:void 0)&&(v=!0,y=g?[{type:g,attrs:m}]:void 0),a){if(v&&(l instanceof Qt&&s.deleteSelection(),s.split(s.mapping.map(c.pos),1,y),g&&!x&&!c.parentOffset&&c.parent.type!==g)){const j=s.mapping.map(c.before()),w=s.doc.resolve(j);c.node(-1).canReplaceWith(w.index(),w.index()+1,g)&&s.setNodeMarkup(s.mapping.map(c.before()),g)}t&&t7(r,i.extensionManager.splittableMarks),s.scrollIntoView()}return v},MDe=(t,s={})=>({tr:r,state:a,dispatch:i,editor:l})=>{var o;const c=hi(t,a.schema),{$from:d,$to:u}=a.selection,m=a.selection.node;if(m&&m.isBlock||d.depth<2||!d.sameParent(u))return!1;const x=d.node(-1);if(x.type!==c)return!1;const g=l.extensionManager.attributes;if(d.parent.content.size===0&&d.node(-1).childCount===d.indexAfter(-1)){if(d.depth===2||d.node(-3).type!==c||d.index(-2)!==d.node(-2).childCount-1)return!1;if(i){let S=vt.empty;const E=d.index(-1)?1:d.index(-2)?2:3;for(let D=d.depth-E;D>=d.depth-3;D-=1)S=vt.from(d.node(D).copy(S));const k=d.indexAfter(-1)<d.node(-2).childCount?1:d.indexAfter(-2)<d.node(-3).childCount?2:3,A={...bj(g,d.node().type.name,d.node().attrs),...s},I=((o=c.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(A))||void 0;S=S.append(vt.from(c.createAndFill(null,I)||void 0));const P=d.before(d.depth-(E-1));r.replace(P,d.after(-k),new Mt(S,4-E,0));let O=-1;r.doc.nodesBetween(P,r.doc.content.size,(D,T)=>{if(O>-1)return!1;D.isTextblock&&D.content.size===0&&(O=T+1)}),O>-1&&r.setSelection(Qt.near(r.doc.resolve(O))),r.scrollIntoView()}return!0}const y=u.pos===d.end()?x.contentMatchAt(0).defaultType:null,v={...bj(g,x.type.name,x.attrs),...s},j={...bj(g,d.node().type.name,d.node().attrs),...s};r.delete(d.pos,u.pos);const w=y?[{type:c,attrs:v},{type:y,attrs:j}]:[{type:c,attrs:v}];if(!zl(r.doc,d.pos,2))return!1;if(i){const{selection:S,storedMarks:E}=a,{splittableMarks:k}=l.extensionManager,A=E||S.$to.parentOffset&&S.$from.marks();if(r.split(d.pos,2,w).scrollIntoView(),!A||!i)return!0;const I=A.filter(P=>k.includes(P.type.name));r.ensureMarks(I)}return!0},Sk=(t,s)=>{const r=rD(o=>o.type===s)(t.selection);if(!r)return!0;const a=t.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(a===void 0)return!0;const i=t.doc.nodeAt(a);return r.node.type===(i==null?void 0:i.type)&&pd(t.doc,r.pos)&&t.join(r.pos),!0},Ck=(t,s)=>{const r=rD(o=>o.type===s)(t.selection);if(!r)return!0;const a=t.doc.resolve(r.start).after(r.depth);if(a===void 0)return!0;const i=t.doc.nodeAt(a);return r.node.type===(i==null?void 0:i.type)&&pd(t.doc,a)&&t.join(a),!0},IDe=(t,s,r,a={})=>({editor:i,tr:l,state:o,dispatch:c,chain:d,commands:u,can:m})=>{const{extensions:x,splittableMarks:g}=i.extensionManager,y=hi(t,o.schema),v=hi(s,o.schema),{selection:j,storedMarks:w}=o,{$from:S,$to:E}=j,k=S.blockRange(E),A=w||j.$to.parentOffset&&j.$from.marks();if(!k)return!1;const I=rD(P=>e7(P.type.name,x))(j);if(k.depth>=1&&I&&k.depth-I.depth<=1){if(I.node.type===y)return u.liftListItem(v);if(e7(I.node.type.name,x)&&y.validContent(I.node.content)&&c)return d().command(()=>(l.setNodeMarkup(I.pos,y),!0)).command(()=>Sk(l,y)).command(()=>Ck(l,y)).run()}return!r||!A||!c?d().command(()=>m().wrapInList(y,a)?!0:u.clearNodes()).wrapInList(y,a).command(()=>Sk(l,y)).command(()=>Ck(l,y)).run():d().command(()=>{const P=m().wrapInList(y,a),O=A.filter(D=>g.includes(D.type.name));return l.ensureMarks(O),P?!0:u.clearNodes()}).wrapInList(y,a).command(()=>Sk(l,y)).command(()=>Ck(l,y)).run()},ODe=(t,s={},r={})=>({state:a,commands:i})=>{const{extendEmptyMarkRange:l=!1}=r,o=Im(t,a.schema);return wDe(a,o,s)?i.unsetMark(o,{extendEmptyMarkRange:l}):i.setMark(o,s)},RDe=(t,s,r={})=>({state:a,commands:i})=>{const l=hi(t,a.schema),o=hi(s,a.schema),c=nD(a,l,r);let d;return a.selection.$anchor.sameParent(a.selection.$head)&&(d=a.selection.$anchor.parent.attrs),c?i.setNode(o,d):i.setNode(l,{...d,...r})},LDe=(t,s={})=>({state:r,commands:a})=>{const i=hi(t,r.schema);return nD(r,i,s)?a.lift(i):a.wrapIn(i,s)},FDe=()=>({state:t,dispatch:s})=>{const r=t.plugins;for(let a=0;a<r.length;a+=1){const i=r[a];let l;if(i.spec.isInputRules&&(l=i.getState(t))){if(s){const o=t.tr,c=l.transform;for(let d=c.steps.length-1;d>=0;d-=1)o.step(c.steps[d].invert(c.docs[d]));if(l.text){const d=o.doc.resolve(l.from).marks();o.replaceWith(l.from,l.to,t.schema.text(l.text,d))}else o.delete(l.from,l.to)}return!0}}return!1},BDe=()=>({tr:t,dispatch:s})=>{const{selection:r}=t,{empty:a,ranges:i}=r;return a||s&&i.forEach(l=>{t.removeMark(l.$from.pos,l.$to.pos)}),!0},$De=(t,s={})=>({tr:r,state:a,dispatch:i})=>{var l;const{extendEmptyMarkRange:o=!1}=s,{selection:c}=r,d=Im(t,a.schema),{$from:u,empty:m,ranges:x}=c;if(!i)return!0;if(m&&o){let{from:g,to:y}=c;const v=(l=u.marks().find(w=>w.type===d))===null||l===void 0?void 0:l.attrs,j=tD(u,d,v);j&&(g=j.from,y=j.to),r.removeMark(g,y,d)}else x.forEach(g=>{r.removeMark(g.$from.pos,g.$to.pos,d)});return r.removeStoredMark(d),!0},zDe=(t,s={})=>({tr:r,state:a,dispatch:i})=>{let l=null,o=null;const c=SQ(typeof t=="string"?t:t.name,a.schema);return c?(c==="node"&&(l=hi(t,a.schema)),c==="mark"&&(o=Im(t,a.schema)),i&&r.selection.ranges.forEach(d=>{const u=d.$from.pos,m=d.$to.pos;let x,g,y,v;r.selection.empty?a.doc.nodesBetween(u,m,(j,w)=>{l&&l===j.type&&(y=Math.max(w,u),v=Math.min(w+j.nodeSize,m),x=w,g=j)}):a.doc.nodesBetween(u,m,(j,w)=>{w<u&&l&&l===j.type&&(y=Math.max(w,u),v=Math.min(w+j.nodeSize,m),x=w,g=j),w>=u&&w<=m&&(l&&l===j.type&&r.setNodeMarkup(w,void 0,{...j.attrs,...s}),o&&j.marks.length&&j.marks.forEach(S=>{if(o===S.type){const E=Math.max(w,u),k=Math.min(w+j.nodeSize,m);r.addMark(E,k,o.create({...S.attrs,...s}))}}))}),g&&(x!==void 0&&r.setNodeMarkup(x,void 0,{...g.attrs,...s}),o&&g.marks.length&&g.marks.forEach(j=>{o===j.type&&r.addMark(y,v,o.create({...j.attrs,...s}))}))}),!0):!1},UDe=(t,s={})=>({state:r,dispatch:a})=>{const i=hi(t,r.schema);return AX(i,s)(r,a)},VDe=(t,s={})=>({state:r,dispatch:a})=>{const i=hi(t,r.schema);return EX(i,s)(r,a)};var HDe=Object.freeze({__proto__:null,blur:APe,clearContent:EPe,clearNodes:TPe,command:PPe,createParagraphNear:DPe,cut:MPe,deleteCurrentNode:IPe,deleteNode:OPe,deleteRange:RPe,deleteSelection:LPe,enter:FPe,exitCode:BPe,extendMarkRange:$Pe,first:zPe,focus:HPe,forEach:WPe,insertContent:qPe,insertContentAt:YPe,joinBackward:ZPe,joinDown:QPe,joinForward:JPe,joinItemBackward:eDe,joinItemForward:tDe,joinTextblockBackward:sDe,joinTextblockForward:nDe,joinUp:XPe,keyboardShortcut:aDe,lift:iDe,liftEmptyBlock:lDe,liftListItem:oDe,newlineInCode:cDe,resetAttributes:dDe,scrollIntoView:uDe,selectAll:mDe,selectNodeBackward:hDe,selectNodeForward:xDe,selectParentNode:pDe,selectTextblockEnd:fDe,selectTextblockStart:gDe,setContent:yDe,setMark:CDe,setMeta:kDe,setNode:ADe,setNodeSelection:EDe,setTextSelection:TDe,sinkListItem:PDe,splitBlock:DDe,splitListItem:MDe,toggleList:IDe,toggleMark:ODe,toggleNode:RDe,toggleWrap:LDe,undoInputRule:FDe,unsetAllMarks:BDe,unsetMark:$De,updateAttributes:zDe,wrapIn:UDe,wrapInList:VDe});Di.create({name:"commands",addCommands(){return{...HDe}}});Di.create({name:"drop",addProseMirrorPlugins(){return[new Ir({key:new Or("tiptapDrop"),props:{handleDrop:(t,s,r,a)=>{this.editor.emit("drop",{editor:this.editor,event:s,slice:r,moved:a})}}})]}});Di.create({name:"editable",addProseMirrorPlugins(){return[new Ir({key:new Or("editable"),props:{editable:()=>this.editor.options.editable}})]}});const WDe=new Or("focusEvents");Di.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Ir({key:WDe,props:{handleDOMEvents:{focus:(s,r)=>{t.isFocused=!0;const a=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return s.dispatch(a),!1},blur:(s,r)=>{t.isFocused=!1;const a=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return s.dispatch(a),!1}}}})]}});Di.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:c})=>{const{selection:d,doc:u}=c,{empty:m,$anchor:x}=d,{pos:g,parent:y}=x,v=x.parent.isTextblock&&g>0?c.doc.resolve(g-1):x,j=v.parent.type.spec.isolating,w=x.pos-x.parentOffset,S=j&&v.parent.childCount===1?w===x.pos:is.atStart(u).from===g;return!m||!y.type.isTextblock||y.textContent.length||!S||S&&x.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),s=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),a={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:s,"Mod-Delete":s,"Mod-a":()=>this.editor.commands.selectAll()},i={...a},l={...a,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":s,"Ctrl-Alt-Backspace":s,"Alt-Delete":s,"Alt-d":s,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return sD()||_Q()?l:i},addProseMirrorPlugins(){return[new Ir({key:new Or("clearDocument"),appendTransaction:(t,s,r)=>{if(t.some(j=>j.getMeta("composition")))return;const a=t.some(j=>j.docChanged)&&!s.doc.eq(r.doc),i=t.some(j=>j.getMeta("preventClearDocument"));if(!a||i)return;const{empty:l,from:o,to:c}=s.selection,d=is.atStart(s.doc).from,u=is.atEnd(s.doc).to;if(l||!(o===d&&c===u)||!kQ(r.doc))return;const g=r.tr,y=vQ({state:r,transaction:g}),{commands:v}=new vPe({editor:this.editor,state:y});if(v.clearNodes(),!!g.steps.length)return g}})]}});Di.create({name:"paste",addProseMirrorPlugins(){return[new Ir({key:new Or("tiptapPaste"),props:{handlePaste:(t,s,r)=>{this.editor.emit("paste",{editor:this.editor,event:s,slice:r})}}})]}});Di.create({name:"tabindex",addProseMirrorPlugins(){return[new Ir({key:new Or("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});function of(t){return new s_({find:t.find,handler:({state:s,range:r,match:a})=>{const i=ua(t.getAttributes,void 0,a);if(i===!1||i===null)return null;const{tr:l}=s,o=a[a.length-1],c=a[0];if(o){const d=c.search(/\S/),u=r.from+c.indexOf(o),m=u+o.length;if(CQ(r.from,r.to,s.doc).filter(y=>y.mark.type.excluded.find(j=>j===t.type&&j!==y.mark.type)).filter(y=>y.to>u).length)return null;m<r.to&&l.delete(m,r.to),u>r.from&&l.delete(r.from+d,u);const g=r.from+d+o.length;l.addMark(r.from+d,g,t.type.create(i||{})),l.removeStoredMark(t.type)}}})}function qDe(t){return new s_({find:t.find,handler:({state:s,range:r,match:a})=>{const i=ua(t.getAttributes,void 0,a)||{},{tr:l}=s,o=r.from;let c=r.to;const d=t.type.create(i);if(a[1]){const u=a[0].lastIndexOf(a[1]);let m=o+u;m>c?m=c:c=m+a[1].length;const x=a[0][a[0].length-1];l.insertText(x,o+a[0].length-1),l.replaceWith(m,c,d)}else if(a[0]){const u=t.type.isInline?o:o-1;l.insert(u,t.type.create(i)).delete(l.mapping.map(o),l.mapping.map(c))}l.scrollIntoView()}})}function z4(t){return new s_({find:t.find,handler:({state:s,range:r,match:a})=>{const i=s.doc.resolve(r.from),l=ua(t.getAttributes,void 0,a)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;s.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,l)}})}function Tb(t){return new s_({find:t.find,handler:({state:s,range:r,match:a,chain:i})=>{const l=ua(t.getAttributes,void 0,a)||{},o=s.tr.delete(r.from,r.to),d=o.doc.resolve(r.from).blockRange(),u=d&&SP(d,t.type,l);if(!u)return null;if(o.wrap(d,u),t.keepMarks&&t.editor){const{selection:x,storedMarks:g}=s,{splittableMarks:y}=t.editor.extensionManager,v=g||x.$to.parentOffset&&x.$from.marks();if(v){const j=v.filter(w=>y.includes(w.type.name));o.ensureMarks(j)}}if(t.keepAttributes){const x=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(x,l).run()}const m=o.doc.resolve(r.from-1).nodeBefore;m&&m.type===t.type&&pd(o.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(a,m))&&o.join(r.from-1)}})}let yc=class U4{constructor(s={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...s},this.name=this.config.name,s.defaultOptions&&Object.keys(s.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ua(oi(this,"addOptions",{name:this.name}))),this.storage=ua(oi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(s={}){return new U4(s)}configure(s={}){const r=this.extend({...this.config,addOptions:()=>n_(this.options,s)});return r.name=this.name,r.parent=this.parent,r}extend(s={}){const r=new U4(s);return r.parent=this,this.child=r,r.name=s.name?s.name:r.parent.name,s.defaultOptions&&Object.keys(s.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=ua(oi(r,"addOptions",{name:r.name})),r.storage=ua(oi(r,"addStorage",{name:r.name,options:r.options})),r}};function cf(t){return new SPe({find:t.find,handler:({state:s,range:r,match:a,pasteEvent:i})=>{const l=ua(t.getAttributes,void 0,a,i);if(l===!1||l===null)return null;const{tr:o}=s,c=a[a.length-1],d=a[0];let u=r.to;if(c){const m=d.search(/\S/),x=r.from+d.indexOf(c),g=x+c.length;if(CQ(r.from,r.to,s.doc).filter(v=>v.mark.type.excluded.find(w=>w===t.type&&w!==v.mark.type)).filter(v=>v.to>x).length)return null;g<r.to&&o.delete(g,r.to),x>r.from&&o.delete(r.from+m,x),u=r.from+m+c.length,o.addMark(r.from+m,u,t.type.create(l||{})),o.removeStoredMark(t.type)}}})}function GDe(t,s){const{selection:r}=t,{$from:a}=r;if(r instanceof ns){const l=a.index();return a.parent.canReplaceWith(l,l+1,s)}let i=a.depth;for(;i>=0;){const l=a.index(i);if(a.node(i).contentMatchAt(l).matchType(s))return!0;i-=1}return!1}const KDe=/^\s*>\s$/,YDe=yc.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Tb({find:KDe,type:this.type})]}}),XDe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,QDe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,ZDe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,JDe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,eMe=Jh.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[of({find:XDe,type:this.type}),of({find:ZDe,type:this.type})]},addPasteRules(){return[cf({find:QDe,type:this.type}),cf({find:JDe,type:this.type})]}}),tMe="listItem",s7="textStyle",n7=/^\s*([-+*])\s$/,sMe=yc.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:s})=>this.options.keepAttributes?s().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(tMe,this.editor.getAttributes(s7)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Tb({find:n7,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Tb({find:n7,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(s7),editor:this.editor})),[t]}}),nMe=/(^|[^`])`([^`]+)`(?!`)/,rMe=/(^|[^`])`([^`]+)`(?!`)/g,aMe=Jh.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[of({find:nMe,type:this.type})]},addPasteRules(){return[cf({find:rMe,type:this.type})]}}),iMe=/^```([a-z]+)?[\s\n]$/,lMe=/^~~~([a-z]+)?[\s\n]$/,oMe=yc.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var s;const{languageClassPrefix:r}=this.options,l=[...((s=t.firstElementChild)===null||s===void 0?void 0:s.classList)||[]].filter(o=>o.startsWith(r)).map(o=>o.replace(r,""))[0];return l||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:s}){return["pre",pl(this.options.HTMLAttributes,s),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:s})=>s.setNode(this.name,t),toggleCodeBlock:t=>({commands:s})=>s.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:s}=this.editor.state.selection,r=s.pos===1;return!t||s.parent.type.name!==this.name?!1:r||!s.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:s}=t,{selection:r}=s,{$from:a,empty:i}=r;if(!i||a.parent.type!==this.type)return!1;const l=a.parentOffset===a.parent.nodeSize-2,o=a.parent.textContent.endsWith(`

`);return!l||!o?!1:t.chain().command(({tr:c})=>(c.delete(a.pos-2,a.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:s}=t,{selection:r,doc:a}=s,{$from:i,empty:l}=r;if(!l||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const c=i.after();return c===void 0?!1:a.nodeAt(c)?t.commands.command(({tr:u})=>(u.setSelection(is.near(a.resolve(c))),!0)):t.commands.exitCode()}}},addInputRules(){return[z4({find:iMe,type:this.type,getAttributes:t=>({language:t[1]})}),z4({find:lMe,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Ir({key:new Or("codeBlockVSCodeHandler"),props:{handlePaste:(t,s)=>{if(!s.clipboardData||this.editor.isActive(this.type.name))return!1;const r=s.clipboardData.getData("text/plain"),a=s.clipboardData.getData("vscode-editor-data"),i=a?JSON.parse(a):void 0,l=i==null?void 0:i.mode;if(!r||!l)return!1;const{tr:o,schema:c}=t.state,d=c.text(r.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:l},d)),o.selection.$from.parent.type!==this.type&&o.setSelection(Qt.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),cMe=yc.create({name:"doc",topNode:!0,content:"block+"});function dMe(t={}){return new Ir({view(s){return new uMe(s,t)}})}class uMe{constructor(s,r){var a;this.editorView=s,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(a=r.width)!==null&&a!==void 0?a:1,this.color=r.color===!1?void 0:r.color||"black",this.class=r.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let l=o=>{this[i](o)};return s.dom.addEventListener(i,l),{name:i,handler:l}})}destroy(){this.handlers.forEach(({name:s,handler:r})=>this.editorView.dom.removeEventListener(s,r))}update(s,r){this.cursorPos!=null&&r.doc!=s.state.doc&&(this.cursorPos>s.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(s){s!=this.cursorPos&&(this.cursorPos=s,s==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let s=this.editorView.state.doc.resolve(this.cursorPos),r=!s.parent.inlineContent,a,i=this.editorView.dom,l=i.getBoundingClientRect(),o=l.width/i.offsetWidth,c=l.height/i.offsetHeight;if(r){let x=s.nodeBefore,g=s.nodeAfter;if(x||g){let y=this.editorView.nodeDOM(this.cursorPos-(x?x.nodeSize:0));if(y){let v=y.getBoundingClientRect(),j=x?v.bottom:v.top;x&&g&&(j=(j+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let w=this.width/2*c;a={left:v.left,right:v.right,top:j-w,bottom:j+w}}}}if(!a){let x=this.editorView.coordsAtPos(this.cursorPos),g=this.width/2*o;a={left:x.left-g,right:x.left+g,top:x.top,bottom:x.bottom}}let d=this.editorView.dom.offsetParent;this.element||(this.element=d.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r);let u,m;if(!d||d==document.body&&getComputedStyle(d).position=="static")u=-pageXOffset,m=-pageYOffset;else{let x=d.getBoundingClientRect(),g=x.width/d.offsetWidth,y=x.height/d.offsetHeight;u=x.left-d.scrollLeft*g,m=x.top-d.scrollTop*y}this.element.style.left=(a.left-u)/o+"px",this.element.style.top=(a.top-m)/c+"px",this.element.style.width=(a.right-a.left)/o+"px",this.element.style.height=(a.bottom-a.top)/c+"px"}scheduleRemoval(s){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),s)}dragover(s){if(!this.editorView.editable)return;let r=this.editorView.posAtCoords({left:s.clientX,top:s.clientY}),a=r&&r.inside>=0&&this.editorView.state.doc.nodeAt(r.inside),i=a&&a.type.spec.disableDropCursor,l=typeof i=="function"?i(this.editorView,r,s):i;if(r&&!l){let o=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let c=aX(this.editorView.state.doc,o,this.editorView.dragging.slice);c!=null&&(o=c)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(s){this.editorView.dom.contains(s.relatedTarget)||this.setCursor(null)}}const mMe=Di.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[dMe(this.options)]}});class br extends is{constructor(s){super(s,s)}map(s,r){let a=s.resolve(r.map(this.head));return br.valid(a)?new br(a):is.near(a)}content(){return Mt.empty}eq(s){return s instanceof br&&s.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(s,r){if(typeof r.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new br(s.resolve(r.pos))}getBookmark(){return new aD(this.anchor)}static valid(s){let r=s.parent;if(r.isTextblock||!hMe(s)||!xMe(s))return!1;let a=r.type.spec.allowGapCursor;if(a!=null)return a;let i=r.contentMatchAt(s.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(s,r,a=!1){e:for(;;){if(!a&&br.valid(s))return s;let i=s.pos,l=null;for(let o=s.depth;;o--){let c=s.node(o);if(r>0?s.indexAfter(o)<c.childCount:s.index(o)>0){l=c.child(r>0?s.indexAfter(o):s.index(o)-1);break}else if(o==0)return null;i+=r;let d=s.doc.resolve(i);if(br.valid(d))return d}for(;;){let o=r>0?l.firstChild:l.lastChild;if(!o){if(l.isAtom&&!l.isText&&!ns.isSelectable(l)){s=s.doc.resolve(i+l.nodeSize*r),a=!1;continue e}break}l=o,i+=r;let c=s.doc.resolve(i);if(br.valid(c))return c}return null}}}br.prototype.visible=!1;br.findFrom=br.findGapCursorFrom;is.jsonID("gapcursor",br);class aD{constructor(s){this.pos=s}map(s){return new aD(s.map(this.pos))}resolve(s){let r=s.resolve(this.pos);return br.valid(r)?new br(r):is.near(r)}}function AQ(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function hMe(t){for(let s=t.depth;s>=0;s--){let r=t.index(s),a=t.node(s);if(r==0){if(a.type.spec.isolating)return!0;continue}for(let i=a.child(r-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||AQ(i.type))return!0;if(i.inlineContent)return!1}}return!0}function xMe(t){for(let s=t.depth;s>=0;s--){let r=t.indexAfter(s),a=t.node(s);if(r==a.childCount){if(a.type.spec.isolating)return!0;continue}for(let i=a.child(r);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||AQ(i.type))return!0;if(i.inlineContent)return!1}}return!0}function pMe(){return new Ir({props:{decorations:yMe,createSelectionBetween(t,s,r){return s.pos==r.pos&&br.valid(r)?new br(r):null},handleClick:gMe,handleKeyDown:fMe,handleDOMEvents:{beforeinput:bMe}}})}const fMe=sQ({ArrowLeft:Q1("horiz",-1),ArrowRight:Q1("horiz",1),ArrowUp:Q1("vert",-1),ArrowDown:Q1("vert",1)});function Q1(t,s){const r=t=="vert"?s>0?"down":"up":s>0?"right":"left";return function(a,i,l){let o=a.selection,c=s>0?o.$to:o.$from,d=o.empty;if(o instanceof Qt){if(!l.endOfTextblock(r)||c.depth==0)return!1;d=!1,c=a.doc.resolve(s>0?c.after():c.before())}let u=br.findGapCursorFrom(c,s,d);return u?(i&&i(a.tr.setSelection(new br(u))),!0):!1}}function gMe(t,s,r){if(!t||!t.editable)return!1;let a=t.state.doc.resolve(s);if(!br.valid(a))return!1;let i=t.posAtCoords({left:r.clientX,top:r.clientY});return i&&i.inside>-1&&ns.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new br(a))),!0)}function bMe(t,s){if(s.inputType!="insertCompositionText"||!(t.state.selection instanceof br))return!1;let{$from:r}=t.state.selection,a=r.parent.contentMatchAt(r.index()).findWrapping(t.state.schema.nodes.text);if(!a)return!1;let i=vt.empty;for(let o=a.length-1;o>=0;o--)i=vt.from(a[o].createAndFill(null,i));let l=t.state.tr.replace(r.pos,r.pos,new Mt(i,0,0));return l.setSelection(Qt.near(l.doc.resolve(r.pos+1))),t.dispatch(l),!1}function yMe(t){if(!(t.selection instanceof br))return null;let s=document.createElement("div");return s.className="ProseMirror-gapcursor",Er.create(t.doc,[Fl.widget(t.selection.head,s,{key:"gapcursor"})])}const vMe=Di.create({name:"gapCursor",addProseMirrorPlugins(){return[pMe()]},extendNodeSchema(t){var s;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(s=ua(oi(t,"allowGapCursor",r)))!==null&&s!==void 0?s:null}}}),jMe=yc.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",pl(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:s,state:r,editor:a})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:l}=r;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:c}=a.extensionManager,d=l||i.$to.parentOffset&&i.$from.marks();return s().insertContent({type:this.name}).command(({tr:u,dispatch:m})=>{if(m&&d&&o){const x=d.filter(g=>c.includes(g.type.name));u.ensureMarks(x)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),NMe=yc.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:s}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,pl(this.options.HTMLAttributes,s),0]},addCommands(){return{setHeading:t=>({commands:s})=>this.options.levels.includes(t.level)?s.setNode(this.name,t):!1,toggleHeading:t=>({commands:s})=>this.options.levels.includes(t.level)?s.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,s)=>({...t,[`Mod-Alt-${s}`]:()=>this.editor.commands.toggleHeading({level:s})}),{})},addInputRules(){return this.options.levels.map(t=>z4({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var RN=200,_a=function(){};_a.prototype.append=function(s){return s.length?(s=_a.from(s),!this.length&&s||s.length<RN&&this.leafAppend(s)||this.length<RN&&s.leafPrepend(this)||this.appendInner(s)):this};_a.prototype.prepend=function(s){return s.length?_a.from(s).append(this):this};_a.prototype.appendInner=function(s){return new wMe(this,s)};_a.prototype.slice=function(s,r){return s===void 0&&(s=0),r===void 0&&(r=this.length),s>=r?_a.empty:this.sliceInner(Math.max(0,s),Math.min(this.length,r))};_a.prototype.get=function(s){if(!(s<0||s>=this.length))return this.getInner(s)};_a.prototype.forEach=function(s,r,a){r===void 0&&(r=0),a===void 0&&(a=this.length),r<=a?this.forEachInner(s,r,a,0):this.forEachInvertedInner(s,r,a,0)};_a.prototype.map=function(s,r,a){r===void 0&&(r=0),a===void 0&&(a=this.length);var i=[];return this.forEach(function(l,o){return i.push(s(l,o))},r,a),i};_a.from=function(s){return s instanceof _a?s:s&&s.length?new EQ(s):_a.empty};var EQ=function(t){function s(a){t.call(this),this.values=a}t&&(s.__proto__=t),s.prototype=Object.create(t&&t.prototype),s.prototype.constructor=s;var r={length:{configurable:!0},depth:{configurable:!0}};return s.prototype.flatten=function(){return this.values},s.prototype.sliceInner=function(i,l){return i==0&&l==this.length?this:new s(this.values.slice(i,l))},s.prototype.getInner=function(i){return this.values[i]},s.prototype.forEachInner=function(i,l,o,c){for(var d=l;d<o;d++)if(i(this.values[d],c+d)===!1)return!1},s.prototype.forEachInvertedInner=function(i,l,o,c){for(var d=l-1;d>=o;d--)if(i(this.values[d],c+d)===!1)return!1},s.prototype.leafAppend=function(i){if(this.length+i.length<=RN)return new s(this.values.concat(i.flatten()))},s.prototype.leafPrepend=function(i){if(this.length+i.length<=RN)return new s(i.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(s.prototype,r),s}(_a);_a.empty=new EQ([]);var wMe=function(t){function s(r,a){t.call(this),this.left=r,this.right=a,this.length=r.length+a.length,this.depth=Math.max(r.depth,a.depth)+1}return t&&(s.__proto__=t),s.prototype=Object.create(t&&t.prototype),s.prototype.constructor=s,s.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},s.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},s.prototype.forEachInner=function(a,i,l,o){var c=this.left.length;if(i<c&&this.left.forEachInner(a,i,Math.min(l,c),o)===!1||l>c&&this.right.forEachInner(a,Math.max(i-c,0),Math.min(this.length,l)-c,o+c)===!1)return!1},s.prototype.forEachInvertedInner=function(a,i,l,o){var c=this.left.length;if(i>c&&this.right.forEachInvertedInner(a,i-c,Math.max(l,c)-c,o+c)===!1||l<c&&this.left.forEachInvertedInner(a,Math.min(i,c),l,o)===!1)return!1},s.prototype.sliceInner=function(a,i){if(a==0&&i==this.length)return this;var l=this.left.length;return i<=l?this.left.slice(a,i):a>=l?this.right.slice(a-l,i-l):this.left.slice(a,l).append(this.right.slice(0,i-l))},s.prototype.leafAppend=function(a){var i=this.right.leafAppend(a);if(i)return new s(this.left,i)},s.prototype.leafPrepend=function(a){var i=this.left.leafPrepend(a);if(i)return new s(i,this.right)},s.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new s(this.left,new s(this.right,a)):new s(this,a)},s}(_a);const _Me=500;class sc{constructor(s,r){this.items=s,this.eventCount=r}popEvent(s,r){if(this.eventCount==0)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}let i,l;r&&(i=this.remapping(a,this.items.length),l=i.maps.length);let o=s.tr,c,d,u=[],m=[];return this.items.forEach((x,g)=>{if(!x.step){i||(i=this.remapping(a,g+1),l=i.maps.length),l--,m.push(x);return}if(i){m.push(new Bc(x.map));let y=x.step.map(i.slice(l)),v;y&&o.maybeStep(y).doc&&(v=o.mapping.maps[o.mapping.maps.length-1],u.push(new Bc(v,void 0,void 0,u.length+m.length))),l--,v&&i.appendMap(v,l)}else o.maybeStep(x.step);if(x.selection)return c=i?x.selection.map(i.slice(l)):x.selection,d=new sc(this.items.slice(0,a).append(m.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:d,transform:o,selection:c}}addTransform(s,r,a,i){let l=[],o=this.eventCount,c=this.items,d=!i&&c.length?c.get(c.length-1):null;for(let m=0;m<s.steps.length;m++){let x=s.steps[m].invert(s.docs[m]),g=new Bc(s.mapping.maps[m],x,r),y;(y=d&&d.merge(g))&&(g=y,m?l.pop():c=c.slice(0,c.length-1)),l.push(g),r&&(o++,r=void 0),i||(d=g)}let u=o-a.depth;return u>CMe&&(c=SMe(c,u),o-=u),new sc(c.append(l),o)}remapping(s,r){let a=new _b;return this.items.forEach((i,l)=>{let o=i.mirrorOffset!=null&&l-i.mirrorOffset>=s?a.maps.length-i.mirrorOffset:void 0;a.appendMap(i.map,o)},s,r),a}addMaps(s){return this.eventCount==0?this:new sc(this.items.append(s.map(r=>new Bc(r))),this.eventCount)}rebased(s,r){if(!this.eventCount)return this;let a=[],i=Math.max(0,this.items.length-r),l=s.mapping,o=s.steps.length,c=this.eventCount;this.items.forEach(g=>{g.selection&&c--},i);let d=r;this.items.forEach(g=>{let y=l.getMirror(--d);if(y==null)return;o=Math.min(o,y);let v=l.maps[y];if(g.step){let j=s.steps[y].invert(s.docs[y]),w=g.selection&&g.selection.map(l.slice(d+1,y));w&&c++,a.push(new Bc(v,j,w))}else a.push(new Bc(v))},i);let u=[];for(let g=r;g<o;g++)u.push(new Bc(l.maps[g]));let m=this.items.slice(0,i).append(u).append(a),x=new sc(m,c);return x.emptyItemCount()>_Me&&(x=x.compress(this.items.length-a.length)),x}emptyItemCount(){let s=0;return this.items.forEach(r=>{r.step||s++}),s}compress(s=this.items.length){let r=this.remapping(0,s),a=r.maps.length,i=[],l=0;return this.items.forEach((o,c)=>{if(c>=s)i.push(o),o.selection&&l++;else if(o.step){let d=o.step.map(r.slice(a)),u=d&&d.getMap();if(a--,u&&r.appendMap(u,a),d){let m=o.selection&&o.selection.map(r.slice(a));m&&l++;let x=new Bc(u.invert(),d,m),g,y=i.length-1;(g=i.length&&i[y].merge(x))?i[y]=g:i.push(x)}}else o.map&&a--},this.items.length,0),new sc(_a.from(i.reverse()),l)}}sc.empty=new sc(_a.empty,0);function SMe(t,s){let r;return t.forEach((a,i)=>{if(a.selection&&s--==0)return r=i,!1}),t.slice(r)}class Bc{constructor(s,r,a,i){this.map=s,this.step=r,this.selection=a,this.mirrorOffset=i}merge(s){if(this.step&&s.step&&!s.selection){let r=s.step.merge(this.step);if(r)return new Bc(r.getMap().invert(),r,this.selection)}}}class Fu{constructor(s,r,a,i,l){this.done=s,this.undone=r,this.prevRanges=a,this.prevTime=i,this.prevComposition=l}}const CMe=20;function kMe(t,s,r,a){let i=r.getMeta(Ph),l;if(i)return i.historyState;r.getMeta(TMe)&&(t=new Fu(t.done,t.undone,null,0,-1));let o=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(o&&o.getMeta(Ph))return o.getMeta(Ph).redo?new Fu(t.done.addTransform(r,void 0,a,yj(s)),t.undone,r7(r.mapping.maps),t.prevTime,t.prevComposition):new Fu(t.done,t.undone.addTransform(r,void 0,a,yj(s)),null,t.prevTime,t.prevComposition);if(r.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let c=r.getMeta("composition"),d=t.prevTime==0||!o&&t.prevComposition!=c&&(t.prevTime<(r.time||0)-a.newGroupDelay||!AMe(r,t.prevRanges)),u=o?kk(t.prevRanges,r.mapping):r7(r.mapping.maps);return new Fu(t.done.addTransform(r,d?s.selection.getBookmark():void 0,a,yj(s)),sc.empty,u,r.time,c??t.prevComposition)}else return(l=r.getMeta("rebased"))?new Fu(t.done.rebased(r,l),t.undone.rebased(r,l),kk(t.prevRanges,r.mapping),t.prevTime,t.prevComposition):new Fu(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),kk(t.prevRanges,r.mapping),t.prevTime,t.prevComposition)}function AMe(t,s){if(!s)return!1;if(!t.docChanged)return!0;let r=!1;return t.mapping.maps[0].forEach((a,i)=>{for(let l=0;l<s.length;l+=2)a<=s[l+1]&&i>=s[l]&&(r=!0)}),r}function r7(t){let s=[];for(let r=t.length-1;r>=0&&s.length==0;r--)t[r].forEach((a,i,l,o)=>s.push(l,o));return s}function kk(t,s){if(!t)return null;let r=[];for(let a=0;a<t.length;a+=2){let i=s.map(t[a],1),l=s.map(t[a+1],-1);i<=l&&r.push(i,l)}return r}function EMe(t,s,r){let a=yj(s),i=Ph.get(s).spec.config,l=(r?t.undone:t.done).popEvent(s,a);if(!l)return null;let o=l.selection.resolve(l.transform.doc),c=(r?t.done:t.undone).addTransform(l.transform,s.selection.getBookmark(),i,a),d=new Fu(r?c:l.remaining,r?l.remaining:c,null,0,-1);return l.transform.setSelection(o).setMeta(Ph,{redo:r,historyState:d})}let Ak=!1,a7=null;function yj(t){let s=t.plugins;if(a7!=s){Ak=!1,a7=s;for(let r=0;r<s.length;r++)if(s[r].spec.historyPreserveItems){Ak=!0;break}}return Ak}const Ph=new Or("history"),TMe=new Or("closeHistory");function PMe(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Ir({key:Ph,state:{init(){return new Fu(sc.empty,sc.empty,null,0,-1)},apply(s,r,a){return kMe(r,a,s,t)}},config:t,props:{handleDOMEvents:{beforeinput(s,r){let a=r.inputType,i=a=="historyUndo"?PQ:a=="historyRedo"?DQ:null;return i?(r.preventDefault(),i(s.state,s.dispatch)):!1}}}})}function TQ(t,s){return(r,a)=>{let i=Ph.getState(r);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(a){let l=EMe(i,r,t);l&&a(s?l.scrollIntoView():l)}return!0}}const PQ=TQ(!1,!0),DQ=TQ(!0,!0),DMe=Di.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:s})=>PQ(t,s),redo:()=>({state:t,dispatch:s})=>DQ(t,s)}},addProseMirrorPlugins(){return[PMe(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),MMe=yc.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",pl(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:s})=>{if(!GDe(s,s.schema.nodes[this.name]))return!1;const{selection:r}=s,{$from:a,$to:i}=r,l=t();return a.parentOffset===0?l.insertContentAt({from:Math.max(a.pos-1,0),to:i.pos},{type:this.name}):_De(r)?l.insertContentAt(i.pos,{type:this.name}):l.insertContent({type:this.name}),l.command(({tr:o,dispatch:c})=>{var d;if(c){const{$to:u}=o.selection,m=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(Qt.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(ns.create(o.doc,u.pos)):o.setSelection(Qt.create(o.doc,u.pos));else{const x=(d=u.parent.type.contentMatch.defaultType)===null||d===void 0?void 0:d.create();x&&(o.insert(m,x),o.setSelection(Qt.create(o.doc,m+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[qDe({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),IMe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,OMe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,RMe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,LMe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,FMe=Jh.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[of({find:IMe,type:this.type}),of({find:RMe,type:this.type})]},addPasteRules(){return[cf({find:OMe,type:this.type}),cf({find:LMe,type:this.type})]}}),BMe=yc.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",pl(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),$Me="listItem",i7="textStyle",l7=/^(\d+)\.\s$/,zMe=yc.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:s,...r}=t;return s===1?["ol",pl(this.options.HTMLAttributes,r),0]:["ol",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:s})=>this.options.keepAttributes?s().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes($Me,this.editor.getAttributes(i7)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Tb({find:l7,type:this.type,getAttributes:s=>({start:+s[1]}),joinPredicate:(s,r)=>r.childCount+r.attrs.start===+s[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Tb({find:l7,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:s=>({start:+s[1],...this.editor.getAttributes(i7)}),joinPredicate:(s,r)=>r.childCount+r.attrs.start===+s[1],editor:this.editor})),[t]}}),UMe=yc.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),VMe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,HMe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,WMe=Jh.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",pl(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[of({find:VMe,type:this.type})]},addPasteRules(){return[cf({find:HMe,type:this.type})]}}),qMe=yc.create({name:"text",group:"inline"});Di.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(eMe.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(YDe.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(sMe.configure(this.options.bulletList)),this.options.code!==!1&&t.push(aMe.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(oMe.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(cMe.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(mMe.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(vMe.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(jMe.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(NMe.configure(this.options.heading)),this.options.history!==!1&&t.push(DMe.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(MMe.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(FMe.configure(this.options.italic)),this.options.listItem!==!1&&t.push(BMe.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(zMe.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(UMe.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(WMe.configure(this.options.strike)),this.options.text!==!1&&t.push(qMe.configure(this.options.text)),t}});var GMe=20,MQ=(t,s=0)=>{const r=[];return!t.children.length||s>GMe||Array.from(t.children).forEach(a=>{a.tagName==="SPAN"?r.push(a):a.children.length&&r.push(...MQ(a,s+1))}),r},KMe=t=>{if(!t.children.length)return;const s=MQ(t);s&&s.forEach(r=>{var a,i;const l=r.getAttribute("style"),o=(i=(a=r.parentElement)==null?void 0:a.closest("span"))==null?void 0:i.getAttribute("style");r.setAttribute("style",`${o};${l}`)})},YMe=ZP.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&KMe(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",Mm(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleTextStyle:t=>({commands:s})=>s.toggleMark(this.name,t),removeEmptyTextStyle:()=>({tr:t})=>{const{selection:s}=t;return t.doc.nodesBetween(s.from,s.to,(r,a)=>{if(r.isTextblock)return!0;r.marks.filter(i=>i.type===this.type).some(i=>Object.values(i.attrs).some(l=>!!l))||t.removeMark(a,a+r.nodeSize,this.type)}),!0}}}}),XMe=Ca.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>{var s;const r=t.getAttribute("style");if(r){const a=r.split(";").map(i=>i.trim()).filter(Boolean);for(let i=a.length-1;i>=0;i-=1){const l=a[i].split(":");if(l.length>=2){const o=l[0].trim().toLowerCase(),c=l.slice(1).join(":").trim();if(o==="background-color")return c.replace(/['"]+/g,"")}}}return(s=t.style.backgroundColor)==null?void 0:s.replace(/['"]+/g,"")},renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:t=>({chain:s})=>s().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),QMe=Ca.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var s;const r=t.getAttribute("style");if(r){const a=r.split(";").map(i=>i.trim()).filter(Boolean);for(let i=a.length-1;i>=0;i-=1){const l=a[i].split(":");if(l.length>=2){const o=l[0].trim().toLowerCase(),c=l.slice(1).join(":").trim();if(o==="color")return c.replace(/['"]+/g,"")}}}return(s=t.style.color)==null?void 0:s.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:s})=>s().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),ZMe=Ca.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:t=>t.style.fontFamily,renderHTML:t=>t.fontFamily?{style:`font-family: ${t.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:t=>({chain:s})=>s().setMark("textStyle",{fontFamily:t}).run(),unsetFontFamily:()=>({chain:t})=>t().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),JMe=Ca.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>t.style.fontSize,renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:t=>({chain:s})=>s().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),eIe=Ca.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:t=>t.style.lineHeight,renderHTML:t=>t.lineHeight?{style:`line-height: ${t.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:t=>({chain:s})=>s().setMark("textStyle",{lineHeight:t}).run(),unsetLineHeight:()=>({chain:t})=>t().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});Ca.create({name:"textStyleKit",addExtensions(){const t=[];return this.options.backgroundColor!==!1&&t.push(XMe.configure(this.options.backgroundColor)),this.options.color!==!1&&t.push(QMe.configure(this.options.color)),this.options.fontFamily!==!1&&t.push(ZMe.configure(this.options.fontFamily)),this.options.fontSize!==!1&&t.push(JMe.configure(this.options.fontSize)),this.options.lineHeight!==!1&&t.push(eIe.configure(this.options.lineHeight)),this.options.textStyle!==!1&&t.push(YMe.configure(this.options.textStyle)),t}});ZP.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Mm(this.options.HTMLAttributes,t),0]},parseMarkdown(t,s){return s.applyMark(this.name||"underline",s.parseInline(t.tokens||[]))},renderMarkdown(t,s){return`++${s.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,s,r){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const l=i[2].trim();return{type:"underline",raw:i[0],text:l,tokens:r.inlineTokens(l)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});var tIe=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,sIe=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g;ZP.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",Mm(this.options.HTMLAttributes,t),0]},renderMarkdown:(t,s)=>`==${s.renderChildren(t)}==`,parseMarkdown:(t,s)=>s.applyMark("highlight",s.parseInline(t.tokens||[])),markdownTokenizer:{name:"highlight",level:"inline",start:t=>t.indexOf("=="),tokenize(t,s,r){const i=/^(==)([^=]+)(==)/.exec(t);if(i){const l=i[2].trim(),o=r.inlineTokens(l);return{type:"highlight",raw:i[0],text:l,tokens:o}}}},addCommands(){return{setHighlight:t=>({commands:s})=>s.setMark(this.name,t),toggleHighlight:t=>({commands:s})=>s.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[lPe({find:tIe,type:this.type})]},addPasteRules(){return[yPe({find:sIe,type:this.type})]}});Ca.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>{const s=t.style.textAlign;return this.options.alignments.includes(s)?s:this.options.defaultAlignment},renderHTML:t=>t.textAlign?{style:`text-align: ${t.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:t=>({commands:s})=>this.options.alignments.includes(t)?this.options.types.map(r=>s.updateAttributes(r,{textAlign:t})).every(r=>r):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.map(s=>t.resetAttributes(s,"textAlign")).every(s=>s),toggleTextAlign:t=>({editor:s,commands:r})=>this.options.alignments.includes(t)?s.isActive({textAlign:t})?r.unsetTextAlign():r.setTextAlign(t):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}});var nIe=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/;by.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",Mm(this.options.HTMLAttributes,t)]},parseMarkdown:(t,s)=>s.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var s,r,a,i,l,o;const c=(r=(s=t.attrs)==null?void 0:s.src)!=null?r:"",d=(i=(a=t.attrs)==null?void 0:a.alt)!=null?i:"",u=(o=(l=t.attrs)==null?void 0:l.title)!=null?o:"";return u?`![${d}](${c} "${u}")`:`![${d}](${c})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:s,minHeight:r,alwaysPreserveAspectRatio:a}=this.options.resize;return({node:i,getPos:l,HTMLAttributes:o,editor:c})=>{const d=document.createElement("img");Object.entries(o).forEach(([x,g])=>{if(g!=null)switch(x){case"width":case"height":break;default:d.setAttribute(x,g);break}}),d.src=o.src;const u=new dPe({element:d,editor:c,node:i,getPos:l,onResize:(x,g)=>{d.style.width=`${x}px`,d.style.height=`${g}px`},onCommit:(x,g)=>{const y=l();y!==void 0&&this.editor.chain().setNodeSelection(y).updateAttributes(this.name,{width:x,height:g}).run()},onUpdate:(x,g,y)=>x.type===i.type,options:{directions:t,min:{width:s,height:r},preserveAspectRatio:a===!0}}),m=u.dom;return m.style.visibility="hidden",m.style.pointerEvents="none",d.onload=()=>{m.style.visibility="",m.style.pointerEvents=""},u}},addCommands(){return{setImage:t=>({commands:s})=>s.insertContent({type:this.name,attrs:t})}},addInputRules(){return[oPe({find:nIe,type:this.type,getAttributes:t=>{const[,,s,r,a]=t;return{src:r,alt:s,title:a}}})]}});var V4,H4;if(typeof WeakMap<"u"){let t=new WeakMap;V4=s=>t.get(s),H4=(s,r)=>(t.set(s,r),r)}else{const t=[];let r=0;V4=a=>{for(let i=0;i<t.length;i+=2)if(t[i]==a)return t[i+1]},H4=(a,i)=>(r==10&&(r=0),t[r++]=a,t[r++]=i)}var yr=class{constructor(t,s,r,a){this.width=t,this.height=s,this.map=r,this.problems=a}findCell(t){for(let s=0;s<this.map.length;s++){const r=this.map[s];if(r!=t)continue;const a=s%this.width,i=s/this.width|0;let l=a+1,o=i+1;for(let c=1;l<this.width&&this.map[s+c]==r;c++)l++;for(let c=1;o<this.height&&this.map[s+this.width*c]==r;c++)o++;return{left:a,top:i,right:l,bottom:o}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let s=0;s<this.map.length;s++)if(this.map[s]==t)return s%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,s,r){const{left:a,right:i,top:l,bottom:o}=this.findCell(t);return s=="horiz"?(r<0?a==0:i==this.width)?null:this.map[l*this.width+(r<0?a-1:i)]:(r<0?l==0:o==this.height)?null:this.map[a+this.width*(r<0?l-1:o)]}rectBetween(t,s){const{left:r,right:a,top:i,bottom:l}=this.findCell(t),{left:o,right:c,top:d,bottom:u}=this.findCell(s);return{left:Math.min(r,o),top:Math.min(i,d),right:Math.max(a,c),bottom:Math.max(l,u)}}cellsInRect(t){const s=[],r={};for(let a=t.top;a<t.bottom;a++)for(let i=t.left;i<t.right;i++){const l=a*this.width+i,o=this.map[l];r[o]||(r[o]=!0,!(i==t.left&&i&&this.map[l-1]==o||a==t.top&&a&&this.map[l-this.width]==o)&&s.push(o))}return s}positionAt(t,s,r){for(let a=0,i=0;;a++){const l=i+r.child(a).nodeSize;if(a==t){let o=s+t*this.width;const c=(t+1)*this.width;for(;o<c&&this.map[o]<i;)o++;return o==c?l-1:this.map[o]}i=l}}static get(t){return V4(t)||H4(t,rIe(t))}};function rIe(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const s=aIe(t),r=t.childCount,a=[];let i=0,l=null;const o=[];for(let u=0,m=s*r;u<m;u++)a[u]=0;for(let u=0,m=0;u<r;u++){const x=t.child(u);m++;for(let v=0;;v++){for(;i<a.length&&a[i]!=0;)i++;if(v==x.childCount)break;const j=x.child(v),{colspan:w,rowspan:S,colwidth:E}=j.attrs;for(let k=0;k<S;k++){if(k+u>=r){(l||(l=[])).push({type:"overlong_rowspan",pos:m,n:S-k});break}const A=i+k*s;for(let I=0;I<w;I++){a[A+I]==0?a[A+I]=m:(l||(l=[])).push({type:"collision",row:u,pos:m,n:w-I});const P=E&&E[I];if(P){const O=(A+I)%s*2,D=o[O];D==null||D!=P&&o[O+1]==1?(o[O]=P,o[O+1]=1):D==P&&o[O+1]++}}}i+=w,m+=j.nodeSize}const g=(u+1)*s;let y=0;for(;i<g;)a[i++]==0&&y++;y&&(l||(l=[])).push({type:"missing",row:u,n:y}),m++}(s===0||r===0)&&(l||(l=[])).push({type:"zero_sized"});const c=new yr(s,r,a,l);let d=!1;for(let u=0;!d&&u<o.length;u+=2)o[u]!=null&&o[u+1]<r&&(d=!0);return d&&iIe(c,o,t),c}function aIe(t){let s=-1,r=!1;for(let a=0;a<t.childCount;a++){const i=t.child(a);let l=0;if(r)for(let o=0;o<a;o++){const c=t.child(o);for(let d=0;d<c.childCount;d++){const u=c.child(d);o+u.attrs.rowspan>a&&(l+=u.attrs.colspan)}}for(let o=0;o<i.childCount;o++){const c=i.child(o);l+=c.attrs.colspan,c.attrs.rowspan>1&&(r=!0)}s==-1?s=l:s!=l&&(s=Math.max(s,l))}return s}function iIe(t,s,r){t.problems||(t.problems=[]);const a={};for(let i=0;i<t.map.length;i++){const l=t.map[i];if(a[l])continue;a[l]=!0;const o=r.nodeAt(l);if(!o)throw new RangeError(`No cell with offset ${l} found`);let c=null;const d=o.attrs;for(let u=0;u<d.colspan;u++){const m=(i+u)%t.width,x=s[m*2];x!=null&&(!d.colwidth||d.colwidth[u]!=x)&&((c||(c=lIe(d)))[u]=x)}c&&t.problems.unshift({type:"colwidth mismatch",pos:l,colwidth:c})}}function lIe(t){if(t.colwidth)return t.colwidth.slice();const s=[];for(let r=0;r<t.colspan;r++)s.push(0);return s}function xi(t){let s=t.cached.tableNodeTypes;if(!s){s=t.cached.tableNodeTypes={};for(const r in t.nodes){const a=t.nodes[r],i=a.spec.tableRole;i&&(s[i]=a)}}return s}var Vu=new Or("selectingCells");function Rf(t){for(let s=t.depth-1;s>0;s--)if(t.node(s).type.spec.tableRole=="row")return t.node(0).resolve(t.before(s+1));return null}function oIe(t){for(let s=t.depth;s>0;s--){const r=t.node(s).type.spec.tableRole;if(r==="cell"||r==="header_cell")return t.node(s)}return null}function vc(t){const s=t.selection.$head;for(let r=s.depth;r>0;r--)if(s.node(r).type.spec.tableRole=="row")return!0;return!1}function r_(t){const s=t.selection;if("$anchorCell"in s&&s.$anchorCell)return s.$anchorCell.pos>s.$headCell.pos?s.$anchorCell:s.$headCell;if("node"in s&&s.node&&s.node.type.spec.tableRole=="cell")return s.$anchor;const r=Rf(s.$head)||cIe(s.$head);if(r)return r;throw new RangeError(`No cell found around position ${s.head}`)}function cIe(t){for(let s=t.nodeAfter,r=t.pos;s;s=s.firstChild,r++){const a=s.type.spec.tableRole;if(a=="cell"||a=="header_cell")return t.doc.resolve(r)}for(let s=t.nodeBefore,r=t.pos;s;s=s.lastChild,r--){const a=s.type.spec.tableRole;if(a=="cell"||a=="header_cell")return t.doc.resolve(r-s.nodeSize)}}function W4(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function dIe(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function iD(t,s){return t.depth==s.depth&&t.pos>=s.start(-1)&&t.pos<=s.end(-1)}function IQ(t,s,r){const a=t.node(-1),i=yr.get(a),l=t.start(-1),o=i.nextCell(t.pos-l,s,r);return o==null?null:t.node(0).resolve(l+o)}function ex(t,s,r=1){const a={...t,colspan:t.colspan-r};return a.colwidth&&(a.colwidth=a.colwidth.slice(),a.colwidth.splice(s,r),a.colwidth.some(i=>i>0)||(a.colwidth=null)),a}function OQ(t,s,r=1){const a={...t,colspan:t.colspan+r};if(a.colwidth){a.colwidth=a.colwidth.slice();for(let i=0;i<r;i++)a.colwidth.splice(s,0,0)}return a}function uIe(t,s,r){const a=xi(s.type.schema).header_cell;for(let i=0;i<t.height;i++)if(s.nodeAt(t.map[r+i*t.width]).type!=a)return!1;return!0}var Tn=class Cd extends is{constructor(s,r=s){const a=s.node(-1),i=yr.get(a),l=s.start(-1),o=i.rectBetween(s.pos-l,r.pos-l),c=s.node(0),d=i.cellsInRect(o).filter(m=>m!=r.pos-l);d.unshift(r.pos-l);const u=d.map(m=>{const x=a.nodeAt(m);if(!x)throw RangeError(`No cell with offset ${m} found`);const g=l+m+1;return new uX(c.resolve(g),c.resolve(g+x.content.size))});super(u[0].$from,u[0].$to,u),this.$anchorCell=s,this.$headCell=r}map(s,r){const a=s.resolve(r.map(this.$anchorCell.pos)),i=s.resolve(r.map(this.$headCell.pos));if(W4(a)&&W4(i)&&iD(a,i)){const l=this.$anchorCell.node(-1)!=a.node(-1);return l&&this.isRowSelection()?Cd.rowSelection(a,i):l&&this.isColSelection()?Cd.colSelection(a,i):new Cd(a,i)}return Qt.between(a,i)}content(){const s=this.$anchorCell.node(-1),r=yr.get(s),a=this.$anchorCell.start(-1),i=r.rectBetween(this.$anchorCell.pos-a,this.$headCell.pos-a),l={},o=[];for(let d=i.top;d<i.bottom;d++){const u=[];for(let m=d*r.width+i.left,x=i.left;x<i.right;x++,m++){const g=r.map[m];if(l[g])continue;l[g]=!0;const y=r.findCell(g);let v=s.nodeAt(g);if(!v)throw RangeError(`No cell with offset ${g} found`);const j=i.left-y.left,w=y.right-i.right;if(j>0||w>0){let S=v.attrs;if(j>0&&(S=ex(S,0,j)),w>0&&(S=ex(S,S.colspan-w,w)),y.left<i.left){if(v=v.type.createAndFill(S),!v)throw RangeError(`Could not create cell with attrs ${JSON.stringify(S)}`)}else v=v.type.create(S,v.content)}if(y.top<i.top||y.bottom>i.bottom){const S={...v.attrs,rowspan:Math.min(y.bottom,i.bottom)-Math.max(y.top,i.top)};y.top<i.top?v=v.type.createAndFill(S):v=v.type.create(S,v.content)}u.push(v)}o.push(s.child(d).copy(vt.from(u)))}const c=this.isColSelection()&&this.isRowSelection()?s:o;return new Mt(vt.from(c),1,1)}replace(s,r=Mt.empty){const a=s.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){const{$from:c,$to:d}=i[o],u=s.mapping.slice(a);s.replace(u.map(c.pos),u.map(d.pos),o?Mt.empty:r)}const l=is.findFrom(s.doc.resolve(s.mapping.slice(a).map(this.to)),-1);l&&s.setSelection(l)}replaceWith(s,r){this.replace(s,new Mt(vt.from(r),0,0))}forEachCell(s){const r=this.$anchorCell.node(-1),a=yr.get(r),i=this.$anchorCell.start(-1),l=a.cellsInRect(a.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i));for(let o=0;o<l.length;o++)s(r.nodeAt(l[o]),i+l[o])}isColSelection(){const s=this.$anchorCell.index(-1),r=this.$headCell.index(-1);if(Math.min(s,r)>0)return!1;const a=s+this.$anchorCell.nodeAfter.attrs.rowspan,i=r+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(a,i)==this.$headCell.node(-1).childCount}static colSelection(s,r=s){const a=s.node(-1),i=yr.get(a),l=s.start(-1),o=i.findCell(s.pos-l),c=i.findCell(r.pos-l),d=s.node(0);return o.top<=c.top?(o.top>0&&(s=d.resolve(l+i.map[o.left])),c.bottom<i.height&&(r=d.resolve(l+i.map[i.width*(i.height-1)+c.right-1]))):(c.top>0&&(r=d.resolve(l+i.map[c.left])),o.bottom<i.height&&(s=d.resolve(l+i.map[i.width*(i.height-1)+o.right-1]))),new Cd(s,r)}isRowSelection(){const s=this.$anchorCell.node(-1),r=yr.get(s),a=this.$anchorCell.start(-1),i=r.colCount(this.$anchorCell.pos-a),l=r.colCount(this.$headCell.pos-a);if(Math.min(i,l)>0)return!1;const o=i+this.$anchorCell.nodeAfter.attrs.colspan,c=l+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,c)==r.width}eq(s){return s instanceof Cd&&s.$anchorCell.pos==this.$anchorCell.pos&&s.$headCell.pos==this.$headCell.pos}static rowSelection(s,r=s){const a=s.node(-1),i=yr.get(a),l=s.start(-1),o=i.findCell(s.pos-l),c=i.findCell(r.pos-l),d=s.node(0);return o.left<=c.left?(o.left>0&&(s=d.resolve(l+i.map[o.top*i.width])),c.right<i.width&&(r=d.resolve(l+i.map[i.width*(c.top+1)-1]))):(c.left>0&&(r=d.resolve(l+i.map[c.top*i.width])),o.right<i.width&&(s=d.resolve(l+i.map[i.width*(o.top+1)-1]))),new Cd(s,r)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(s,r){return new Cd(s.resolve(r.anchor),s.resolve(r.head))}static create(s,r,a=r){return new Cd(s.resolve(r),s.resolve(a))}getBookmark(){return new mIe(this.$anchorCell.pos,this.$headCell.pos)}};Tn.prototype.visible=!1;is.jsonID("cell",Tn);var mIe=class RQ{constructor(s,r){this.anchor=s,this.head=r}map(s){return new RQ(s.map(this.anchor),s.map(this.head))}resolve(s){const r=s.resolve(this.anchor),a=s.resolve(this.head);return r.parent.type.spec.tableRole=="row"&&a.parent.type.spec.tableRole=="row"&&r.index()<r.parent.childCount&&a.index()<a.parent.childCount&&iD(r,a)?new Tn(r,a):is.near(a,1)}};function hIe(t){if(!(t.selection instanceof Tn))return null;const s=[];return t.selection.forEachCell((r,a)=>{s.push(Fl.node(a,a+r.nodeSize,{class:"selectedCell"}))}),Er.create(t.doc,s)}function xIe({$from:t,$to:s}){if(t.pos==s.pos||t.pos<s.pos-6)return!1;let r=t.pos,a=s.pos,i=t.depth;for(;i>=0&&!(t.after(i+1)<t.end(i));i--,r++);for(let l=s.depth;l>=0&&!(s.before(l+1)>s.start(l));l--,a--);return r==a&&/row|table/.test(t.node(i).type.spec.tableRole)}function pIe({$from:t,$to:s}){let r,a;for(let i=t.depth;i>0;i--){const l=t.node(i);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){r=l;break}}for(let i=s.depth;i>0;i--){const l=s.node(i);if(l.type.spec.tableRole==="cell"||l.type.spec.tableRole==="header_cell"){a=l;break}}return r!==a&&s.parentOffset===0}function fIe(t,s,r){const a=(s||t).selection,i=(s||t).doc;let l,o;if(a instanceof ns&&(o=a.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")l=Tn.create(i,a.from);else if(o=="row"){const c=i.resolve(a.from+1);l=Tn.rowSelection(c,c)}else if(!r){const c=yr.get(a.node),d=a.from+1,u=d+c.map[c.width*c.height-1];l=Tn.create(i,d+1,u)}}else a instanceof Qt&&xIe(a)?l=Qt.create(i,a.from):a instanceof Qt&&pIe(a)&&(l=Qt.create(i,a.$from.start(),a.$from.end()));return l&&(s||(s=t.tr)).setSelection(l),s}var gIe=new Or("fix-tables");function LQ(t,s,r,a){const i=t.childCount,l=s.childCount;e:for(let o=0,c=0;o<l;o++){const d=s.child(o);for(let u=c,m=Math.min(i,o+3);u<m;u++)if(t.child(u)==d){c=u+1,r+=d.nodeSize;continue e}a(d,r),c<i&&t.child(c).sameMarkup(d)?LQ(t.child(c),d,r+1,a):d.nodesBetween(0,d.content.size,a,r+1),r+=d.nodeSize}}function FQ(t,s){let r;const a=(i,l)=>{i.type.spec.tableRole=="table"&&(r=bIe(t,i,l,r))};return s?s.doc!=t.doc&&LQ(s.doc,t.doc,0,a):t.doc.descendants(a),r}function bIe(t,s,r,a){const i=yr.get(s);if(!i.problems)return a;a||(a=t.tr);const l=[];for(let d=0;d<i.height;d++)l.push(0);for(let d=0;d<i.problems.length;d++){const u=i.problems[d];if(u.type=="collision"){const m=s.nodeAt(u.pos);if(!m)continue;const x=m.attrs;for(let g=0;g<x.rowspan;g++)l[u.row+g]+=u.n;a.setNodeMarkup(a.mapping.map(r+1+u.pos),null,ex(x,x.colspan-u.n,u.n))}else if(u.type=="missing")l[u.row]+=u.n;else if(u.type=="overlong_rowspan"){const m=s.nodeAt(u.pos);if(!m)continue;a.setNodeMarkup(a.mapping.map(r+1+u.pos),null,{...m.attrs,rowspan:m.attrs.rowspan-u.n})}else if(u.type=="colwidth mismatch"){const m=s.nodeAt(u.pos);if(!m)continue;a.setNodeMarkup(a.mapping.map(r+1+u.pos),null,{...m.attrs,colwidth:u.colwidth})}else if(u.type=="zero_sized"){const m=a.mapping.map(r);a.delete(m,m+s.nodeSize)}}let o,c;for(let d=0;d<l.length;d++)l[d]&&(o==null&&(o=d),c=d);for(let d=0,u=r+1;d<i.height;d++){const m=s.child(d),x=u+m.nodeSize,g=l[d];if(g>0){let y="cell";m.firstChild&&(y=m.firstChild.type.spec.tableRole);const v=[];for(let w=0;w<g;w++){const S=xi(t.schema)[y].createAndFill();S&&v.push(S)}const j=(d==0||o==d-1)&&c==d?u+1:x-1;a.insert(a.mapping.map(j),v)}u=x}return a.setMeta(gIe,{fixTables:!0})}function fd(t){const s=t.selection,r=r_(t),a=r.node(-1),i=r.start(-1),l=yr.get(a);return{...s instanceof Tn?l.rectBetween(s.$anchorCell.pos-i,s.$headCell.pos-i):l.findCell(r.pos-i),tableStart:i,map:l,table:a}}function BQ(t,{map:s,tableStart:r,table:a},i){let l=i>0?-1:0;uIe(s,a,i+l)&&(l=i==0||i==s.width?null:0);for(let o=0;o<s.height;o++){const c=o*s.width+i;if(i>0&&i<s.width&&s.map[c-1]==s.map[c]){const d=s.map[c],u=a.nodeAt(d);t.setNodeMarkup(t.mapping.map(r+d),null,OQ(u.attrs,i-s.colCount(d))),o+=u.attrs.rowspan-1}else{const d=l==null?xi(a.type.schema).cell:a.nodeAt(s.map[c+l]).type,u=s.positionAt(o,i,a);t.insert(t.mapping.map(r+u),d.createAndFill())}}return t}function yIe(t,s){if(!vc(t))return!1;if(s){const r=fd(t);s(BQ(t.tr,r,r.left))}return!0}function vIe(t,s){if(!vc(t))return!1;if(s){const r=fd(t);s(BQ(t.tr,r,r.right))}return!0}function jIe(t,{map:s,table:r,tableStart:a},i){const l=t.mapping.maps.length;for(let o=0;o<s.height;){const c=o*s.width+i,d=s.map[c],u=r.nodeAt(d),m=u.attrs;if(i>0&&s.map[c-1]==d||i<s.width-1&&s.map[c+1]==d)t.setNodeMarkup(t.mapping.slice(l).map(a+d),null,ex(m,i-s.colCount(d)));else{const x=t.mapping.slice(l).map(a+d);t.delete(x,x+u.nodeSize)}o+=m.rowspan}}function NIe(t,s){if(!vc(t))return!1;if(s){const r=fd(t),a=t.tr;if(r.left==0&&r.right==r.map.width)return!1;for(let i=r.right-1;jIe(a,r,i),i!=r.left;i--){const l=r.tableStart?a.doc.nodeAt(r.tableStart-1):a.doc;if(!l)throw RangeError("No table found");r.table=l,r.map=yr.get(l)}s(a)}return!0}function wIe(t,s,r){var a;const i=xi(s.type.schema).header_cell;for(let l=0;l<t.width;l++)if(((a=s.nodeAt(t.map[l+r*t.width]))==null?void 0:a.type)!=i)return!1;return!0}function $Q(t,{map:s,tableStart:r,table:a},i){var l;let o=r;for(let u=0;u<i;u++)o+=a.child(u).nodeSize;const c=[];let d=i>0?-1:0;wIe(s,a,i+d)&&(d=i==0||i==s.height?null:0);for(let u=0,m=s.width*i;u<s.width;u++,m++)if(i>0&&i<s.height&&s.map[m]==s.map[m-s.width]){const x=s.map[m],g=a.nodeAt(x).attrs;t.setNodeMarkup(r+x,null,{...g,rowspan:g.rowspan+1}),u+=g.colspan-1}else{const x=d==null?xi(a.type.schema).cell:(l=a.nodeAt(s.map[m+d*s.width]))==null?void 0:l.type,g=x==null?void 0:x.createAndFill();g&&c.push(g)}return t.insert(o,xi(a.type.schema).row.create(null,c)),t}function _Ie(t,s){if(!vc(t))return!1;if(s){const r=fd(t);s($Q(t.tr,r,r.top))}return!0}function SIe(t,s){if(!vc(t))return!1;if(s){const r=fd(t);s($Q(t.tr,r,r.bottom))}return!0}function CIe(t,{map:s,table:r,tableStart:a},i){let l=0;for(let u=0;u<i;u++)l+=r.child(u).nodeSize;const o=l+r.child(i).nodeSize,c=t.mapping.maps.length;t.delete(l+a,o+a);const d=new Set;for(let u=0,m=i*s.width;u<s.width;u++,m++){const x=s.map[m];if(!d.has(x)){if(d.add(x),i>0&&x==s.map[m-s.width]){const g=r.nodeAt(x).attrs;t.setNodeMarkup(t.mapping.slice(c).map(x+a),null,{...g,rowspan:g.rowspan-1}),u+=g.colspan-1}else if(i<s.height&&x==s.map[m+s.width]){const g=r.nodeAt(x),y=g.attrs,v=g.type.create({...y,rowspan:g.attrs.rowspan-1},g.content),j=s.positionAt(i+1,u,r);t.insert(t.mapping.slice(c).map(a+j),v),u+=y.colspan-1}}}}function kIe(t,s){if(!vc(t))return!1;if(s){const r=fd(t),a=t.tr;if(r.top==0&&r.bottom==r.map.height)return!1;for(let i=r.bottom-1;CIe(a,r,i),i!=r.top;i--){const l=r.tableStart?a.doc.nodeAt(r.tableStart-1):a.doc;if(!l)throw RangeError("No table found");r.table=l,r.map=yr.get(r.table)}s(a)}return!0}function o7(t){const s=t.content;return s.childCount==1&&s.child(0).isTextblock&&s.child(0).childCount==0}function AIe({width:t,height:s,map:r},a){let i=a.top*t+a.left,l=i,o=(a.bottom-1)*t+a.left,c=i+(a.right-a.left-1);for(let d=a.top;d<a.bottom;d++){if(a.left>0&&r[l]==r[l-1]||a.right<t&&r[c]==r[c+1])return!0;l+=t,c+=t}for(let d=a.left;d<a.right;d++){if(a.top>0&&r[i]==r[i-t]||a.bottom<s&&r[o]==r[o+t])return!0;i++,o++}return!1}function c7(t,s){const r=t.selection;if(!(r instanceof Tn)||r.$anchorCell.pos==r.$headCell.pos)return!1;const a=fd(t),{map:i}=a;if(AIe(i,a))return!1;if(s){const l=t.tr,o={};let c=vt.empty,d,u;for(let m=a.top;m<a.bottom;m++)for(let x=a.left;x<a.right;x++){const g=i.map[m*i.width+x],y=a.table.nodeAt(g);if(!(o[g]||!y))if(o[g]=!0,d==null)d=g,u=y;else{o7(y)||(c=c.append(y.content));const v=l.mapping.map(g+a.tableStart);l.delete(v,v+y.nodeSize)}}if(d==null||u==null)return!0;if(l.setNodeMarkup(d+a.tableStart,null,{...OQ(u.attrs,u.attrs.colspan,a.right-a.left-u.attrs.colspan),rowspan:a.bottom-a.top}),c.size){const m=d+1+u.content.size,x=o7(u)?d+1:m;l.replaceWith(x+a.tableStart,m+a.tableStart,c)}l.setSelection(new Tn(l.doc.resolve(d+a.tableStart))),s(l)}return!0}function d7(t,s){const r=xi(t.schema);return EIe(({node:a})=>r[a.type.spec.tableRole])(t,s)}function EIe(t){return(s,r)=>{var a;const i=s.selection;let l,o;if(i instanceof Tn){if(i.$anchorCell.pos!=i.$headCell.pos)return!1;l=i.$anchorCell.nodeAfter,o=i.$anchorCell.pos}else{if(l=oIe(i.$from),!l)return!1;o=(a=Rf(i.$from))==null?void 0:a.pos}if(l==null||o==null||l.attrs.colspan==1&&l.attrs.rowspan==1)return!1;if(r){let c=l.attrs;const d=[],u=c.colwidth;c.rowspan>1&&(c={...c,rowspan:1}),c.colspan>1&&(c={...c,colspan:1});const m=fd(s),x=s.tr;for(let y=0;y<m.right-m.left;y++)d.push(u?{...c,colwidth:u&&u[y]?[u[y]]:null}:c);let g;for(let y=m.top;y<m.bottom;y++){let v=m.map.positionAt(y,m.left,m.table);y==m.top&&(v+=l.nodeSize);for(let j=m.left,w=0;j<m.right;j++,w++)j==m.left&&y==m.top||x.insert(g=x.mapping.map(v+m.tableStart,1),t({node:l,row:y,col:j}).createAndFill(d[w]))}x.setNodeMarkup(o,t({node:l,row:m.top,col:m.left}),d[0]),i instanceof Tn&&x.setSelection(new Tn(x.doc.resolve(i.$anchorCell.pos),g?x.doc.resolve(g):void 0)),r(x)}return!0}}function TIe(t,s){return function(r,a){if(!vc(r))return!1;const i=r_(r);if(i.nodeAfter.attrs[t]===s)return!1;if(a){const l=r.tr;r.selection instanceof Tn?r.selection.forEachCell((o,c)=>{o.attrs[t]!==s&&l.setNodeMarkup(c,null,{...o.attrs,[t]:s})}):l.setNodeMarkup(i.pos,null,{...i.nodeAfter.attrs,[t]:s}),a(l)}return!0}}function PIe(t){return function(s,r){if(!vc(s))return!1;if(r){const a=xi(s.schema),i=fd(s),l=s.tr,o=i.map.cellsInRect(t=="column"?{left:i.left,top:0,right:i.right,bottom:i.map.height}:t=="row"?{left:0,top:i.top,right:i.map.width,bottom:i.bottom}:i),c=o.map(d=>i.table.nodeAt(d));for(let d=0;d<o.length;d++)c[d].type==a.header_cell&&l.setNodeMarkup(i.tableStart+o[d],a.cell,c[d].attrs);if(l.steps.length==0)for(let d=0;d<o.length;d++)l.setNodeMarkup(i.tableStart+o[d],a.header_cell,c[d].attrs);r(l)}return!0}}function u7(t,s,r){const a=s.map.cellsInRect({left:0,top:0,right:t=="row"?s.map.width:1,bottom:t=="column"?s.map.height:1});for(let i=0;i<a.length;i++){const l=s.table.nodeAt(a[i]);if(l&&l.type!==r.header_cell)return!1}return!0}function Pb(t,s){return s=s||{useDeprecatedLogic:!1},s.useDeprecatedLogic?PIe(t):function(r,a){if(!vc(r))return!1;if(a){const i=xi(r.schema),l=fd(r),o=r.tr,c=u7("row",l,i),d=u7("column",l,i),m=(t==="column"?c:t==="row"?d:!1)?1:0,x=t=="column"?{left:0,top:m,right:1,bottom:l.map.height}:t=="row"?{left:m,top:0,right:l.map.width,bottom:1}:l,g=t=="column"?d?i.cell:i.header_cell:t=="row"?c?i.cell:i.header_cell:i.cell;l.map.cellsInRect(x).forEach(y=>{const v=y+l.tableStart,j=o.doc.nodeAt(v);j&&o.setNodeMarkup(v,g,j.attrs)}),a(o)}return!0}}Pb("row",{useDeprecatedLogic:!0});Pb("column",{useDeprecatedLogic:!0});var DIe=Pb("cell",{useDeprecatedLogic:!0});function MIe(t,s){if(s<0){const r=t.nodeBefore;if(r)return t.pos-r.nodeSize;for(let a=t.index(-1)-1,i=t.before();a>=0;a--){const l=t.node(-1).child(a),o=l.lastChild;if(o)return i-1-o.nodeSize;i-=l.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const r=t.node(-1);for(let a=t.indexAfter(-1),i=t.after();a<r.childCount;a++){const l=r.child(a);if(l.childCount)return i+1;i+=l.nodeSize}}return null}function m7(t){return function(s,r){if(!vc(s))return!1;const a=MIe(r_(s),t);if(a==null)return!1;if(r){const i=s.doc.resolve(a);r(s.tr.setSelection(Qt.between(i,dIe(i))).scrollIntoView())}return!0}}function IIe(t,s){const r=t.selection.$anchor;for(let a=r.depth;a>0;a--)if(r.node(a).type.spec.tableRole=="table")return s&&s(t.tr.delete(r.before(a),r.after(a)).scrollIntoView()),!0;return!1}function Z1(t,s){const r=t.selection;if(!(r instanceof Tn))return!1;if(s){const a=t.tr,i=xi(t.schema).cell.createAndFill().content;r.forEachCell((l,o)=>{l.content.eq(i)||a.replace(a.mapping.map(o+1),a.mapping.map(o+l.nodeSize-1),new Mt(i,0,0))}),a.docChanged&&s(a)}return!0}function OIe(t){if(!t.size)return null;let{content:s,openStart:r,openEnd:a}=t;for(;s.childCount==1&&(r>0&&a>0||s.child(0).type.spec.tableRole=="table");)r--,a--,s=s.child(0).content;const i=s.child(0),l=i.type.spec.tableRole,o=i.type.schema,c=[];if(l=="row")for(let d=0;d<s.childCount;d++){let u=s.child(d).content;const m=d?0:Math.max(0,r-1),x=d<s.childCount-1?0:Math.max(0,a-1);(m||x)&&(u=q4(xi(o).row,new Mt(u,m,x)).content),c.push(u)}else if(l=="cell"||l=="header_cell")c.push(r||a?q4(xi(o).row,new Mt(s,r,a)).content:s);else return null;return RIe(o,c)}function RIe(t,s){const r=[];for(let i=0;i<s.length;i++){const l=s[i];for(let o=l.childCount-1;o>=0;o--){const{rowspan:c,colspan:d}=l.child(o).attrs;for(let u=i;u<i+c;u++)r[u]=(r[u]||0)+d}}let a=0;for(let i=0;i<r.length;i++)a=Math.max(a,r[i]);for(let i=0;i<r.length;i++)if(i>=s.length&&s.push(vt.empty),r[i]<a){const l=xi(t).cell.createAndFill(),o=[];for(let c=r[i];c<a;c++)o.push(l);s[i]=s[i].append(vt.from(o))}return{height:s.length,width:a,rows:s}}function q4(t,s){const r=t.createAndFill();return new dX(r).replace(0,r.content.size,s).doc}function LIe({width:t,height:s,rows:r},a,i){if(t!=a){const l=[],o=[];for(let c=0;c<r.length;c++){const d=r[c],u=[];for(let m=l[c]||0,x=0;m<a;x++){let g=d.child(x%d.childCount);m+g.attrs.colspan>a&&(g=g.type.createChecked(ex(g.attrs,g.attrs.colspan,m+g.attrs.colspan-a),g.content)),u.push(g),m+=g.attrs.colspan;for(let y=1;y<g.attrs.rowspan;y++)l[c+y]=(l[c+y]||0)+g.attrs.colspan}o.push(vt.from(u))}r=o,t=a}if(s!=i){const l=[];for(let o=0,c=0;o<i;o++,c++){const d=[],u=r[c%s];for(let m=0;m<u.childCount;m++){let x=u.child(m);o+x.attrs.rowspan>i&&(x=x.type.create({...x.attrs,rowspan:Math.max(1,i-x.attrs.rowspan)},x.content)),d.push(x)}l.push(vt.from(d))}r=l,s=i}return{width:t,height:s,rows:r}}function FIe(t,s,r,a,i,l,o){const c=t.doc.type.schema,d=xi(c);let u,m;if(i>s.width)for(let x=0,g=0;x<s.height;x++){const y=r.child(x);g+=y.nodeSize;const v=[];let j;y.lastChild==null||y.lastChild.type==d.cell?j=u||(u=d.cell.createAndFill()):j=m||(m=d.header_cell.createAndFill());for(let w=s.width;w<i;w++)v.push(j);t.insert(t.mapping.slice(o).map(g-1+a),v)}if(l>s.height){const x=[];for(let v=0,j=(s.height-1)*s.width;v<Math.max(s.width,i);v++){const w=v>=s.width?!1:r.nodeAt(s.map[j+v]).type==d.header_cell;x.push(w?m||(m=d.header_cell.createAndFill()):u||(u=d.cell.createAndFill()))}const g=d.row.create(null,vt.from(x)),y=[];for(let v=s.height;v<l;v++)y.push(g);t.insert(t.mapping.slice(o).map(a+r.nodeSize-2),y)}return!!(u||m)}function h7(t,s,r,a,i,l,o,c){if(o==0||o==s.height)return!1;let d=!1;for(let u=i;u<l;u++){const m=o*s.width+u,x=s.map[m];if(s.map[m-s.width]==x){d=!0;const g=r.nodeAt(x),{top:y,left:v}=s.findCell(x);t.setNodeMarkup(t.mapping.slice(c).map(x+a),null,{...g.attrs,rowspan:o-y}),t.insert(t.mapping.slice(c).map(s.positionAt(o,v,r)),g.type.createAndFill({...g.attrs,rowspan:y+g.attrs.rowspan-o})),u+=g.attrs.colspan-1}}return d}function x7(t,s,r,a,i,l,o,c){if(o==0||o==s.width)return!1;let d=!1;for(let u=i;u<l;u++){const m=u*s.width+o,x=s.map[m];if(s.map[m-1]==x){d=!0;const g=r.nodeAt(x),y=s.colCount(x),v=t.mapping.slice(c).map(x+a);t.setNodeMarkup(v,null,ex(g.attrs,o-y,g.attrs.colspan-(o-y))),t.insert(v+g.nodeSize,g.type.createAndFill(ex(g.attrs,0,o-y))),u+=g.attrs.rowspan-1}}return d}function p7(t,s,r,a,i){let l=r?t.doc.nodeAt(r-1):t.doc;if(!l)throw new Error("No table found");let o=yr.get(l);const{top:c,left:d}=a,u=d+i.width,m=c+i.height,x=t.tr;let g=0;function y(){if(l=r?x.doc.nodeAt(r-1):x.doc,!l)throw new Error("No table found");o=yr.get(l),g=x.mapping.maps.length}FIe(x,o,l,r,u,m,g)&&y(),h7(x,o,l,r,d,u,c,g)&&y(),h7(x,o,l,r,d,u,m,g)&&y(),x7(x,o,l,r,c,m,d,g)&&y(),x7(x,o,l,r,c,m,u,g)&&y();for(let v=c;v<m;v++){const j=o.positionAt(v,d,l),w=o.positionAt(v,u,l);x.replace(x.mapping.slice(g).map(j+r),x.mapping.slice(g).map(w+r),new Mt(i.rows[v-c],0,0))}y(),x.setSelection(new Tn(x.doc.resolve(r+o.positionAt(c,d,l)),x.doc.resolve(r+o.positionAt(m-1,u-1,l)))),s(x)}var BIe=sQ({ArrowLeft:J1("horiz",-1),ArrowRight:J1("horiz",1),ArrowUp:J1("vert",-1),ArrowDown:J1("vert",1),"Shift-ArrowLeft":ev("horiz",-1),"Shift-ArrowRight":ev("horiz",1),"Shift-ArrowUp":ev("vert",-1),"Shift-ArrowDown":ev("vert",1),Backspace:Z1,"Mod-Backspace":Z1,Delete:Z1,"Mod-Delete":Z1});function vj(t,s,r){return r.eq(t.selection)?!1:(s&&s(t.tr.setSelection(r).scrollIntoView()),!0)}function J1(t,s){return(r,a,i)=>{if(!i)return!1;const l=r.selection;if(l instanceof Tn)return vj(r,a,is.near(l.$headCell,s));if(t!="horiz"&&!l.empty)return!1;const o=zQ(i,t,s);if(o==null)return!1;if(t=="horiz")return vj(r,a,is.near(r.doc.resolve(l.head+s),s));{const c=r.doc.resolve(o),d=IQ(c,t,s);let u;return d?u=is.near(d,1):s<0?u=is.near(r.doc.resolve(c.before(-1)),-1):u=is.near(r.doc.resolve(c.after(-1)),1),vj(r,a,u)}}}function ev(t,s){return(r,a,i)=>{if(!i)return!1;const l=r.selection;let o;if(l instanceof Tn)o=l;else{const d=zQ(i,t,s);if(d==null)return!1;o=new Tn(r.doc.resolve(d))}const c=IQ(o.$headCell,t,s);return c?vj(r,a,new Tn(o.$anchorCell,c)):!1}}function $Ie(t,s){const r=t.state.doc,a=Rf(r.resolve(s));return a?(t.dispatch(t.state.tr.setSelection(new Tn(a))),!0):!1}function zIe(t,s,r){if(!vc(t.state))return!1;let a=OIe(r);const i=t.state.selection;if(i instanceof Tn){a||(a={width:1,height:1,rows:[vt.from(q4(xi(t.state.schema).cell,r))]});const l=i.$anchorCell.node(-1),o=i.$anchorCell.start(-1),c=yr.get(l).rectBetween(i.$anchorCell.pos-o,i.$headCell.pos-o);return a=LIe(a,c.right-c.left,c.bottom-c.top),p7(t.state,t.dispatch,o,c,a),!0}else if(a){const l=r_(t.state),o=l.start(-1);return p7(t.state,t.dispatch,o,yr.get(l.node(-1)).findCell(l.pos-o),a),!0}else return!1}function UIe(t,s){var r;if(s.ctrlKey||s.metaKey)return;const a=f7(t,s.target);let i;if(s.shiftKey&&t.state.selection instanceof Tn)l(t.state.selection.$anchorCell,s),s.preventDefault();else if(s.shiftKey&&a&&(i=Rf(t.state.selection.$anchor))!=null&&((r=Ek(t,s))==null?void 0:r.pos)!=i.pos)l(i,s),s.preventDefault();else if(!a)return;function l(d,u){let m=Ek(t,u);const x=Vu.getState(t.state)==null;if(!m||!iD(d,m))if(x)m=d;else return;const g=new Tn(d,m);if(x||!t.state.selection.eq(g)){const y=t.state.tr.setSelection(g);x&&y.setMeta(Vu,d.pos),t.dispatch(y)}}function o(){t.root.removeEventListener("mouseup",o),t.root.removeEventListener("dragstart",o),t.root.removeEventListener("mousemove",c),Vu.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(Vu,-1))}function c(d){const u=d,m=Vu.getState(t.state);let x;if(m!=null)x=t.state.doc.resolve(m);else if(f7(t,u.target)!=a&&(x=Ek(t,s),!x))return o();x&&l(x,u)}t.root.addEventListener("mouseup",o),t.root.addEventListener("dragstart",o),t.root.addEventListener("mousemove",c)}function zQ(t,s,r){if(!(t.state.selection instanceof Qt))return null;const{$head:a}=t.state.selection;for(let i=a.depth-1;i>=0;i--){const l=a.node(i);if((r<0?a.index(i):a.indexAfter(i))!=(r<0?0:l.childCount))return null;if(l.type.spec.tableRole=="cell"||l.type.spec.tableRole=="header_cell"){const c=a.before(i),d=s=="vert"?r>0?"down":"up":r>0?"right":"left";return t.endOfTextblock(d)?c:null}}return null}function f7(t,s){for(;s&&s!=t.dom;s=s.parentNode)if(s.nodeName=="TD"||s.nodeName=="TH")return s;return null}function Ek(t,s){const r=t.posAtCoords({left:s.clientX,top:s.clientY});return r&&r?Rf(t.state.doc.resolve(r.pos)):null}var VIe=class{constructor(s,r){this.node=s,this.defaultCellMinWidth=r,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${r}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),G4(s,this.colgroup,this.table,r),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(s){return s.type!=this.node.type?!1:(this.node=s,G4(s,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(s){return s.type=="attributes"&&(s.target==this.table||this.colgroup.contains(s.target))}};function G4(t,s,r,a,i,l){var o;let c=0,d=!0,u=s.firstChild;const m=t.firstChild;if(m){for(let x=0,g=0;x<m.childCount;x++){const{colspan:y,colwidth:v}=m.child(x).attrs;for(let j=0;j<y;j++,g++){const w=i==g?l:v&&v[j],S=w?w+"px":"";if(c+=w||a,w||(d=!1),u)u.style.width!=S&&(u.style.width=S),u=u.nextSibling;else{const E=document.createElement("col");E.style.width=S,s.appendChild(E)}}}for(;u;){const x=u.nextSibling;(o=u.parentNode)==null||o.removeChild(u),u=x}d?(r.style.width=c+"px",r.style.minWidth=""):(r.style.width="",r.style.minWidth=c+"px")}}var Ml=new Or("tableColumnResizing");function HIe({handleWidth:t=5,cellMinWidth:s=25,defaultCellMinWidth:r=100,View:a=VIe,lastColumnResizable:i=!0}={}){const l=new Ir({key:Ml,state:{init(o,c){var d,u;const m=(u=(d=l.spec)==null?void 0:d.props)==null?void 0:u.nodeViews,x=xi(c.schema).table.name;return a&&m&&(m[x]=(g,y)=>new a(g,r,y)),new WIe(-1,!1)},apply(o,c){return c.apply(o)}},props:{attributes:o=>{const c=Ml.getState(o);return c&&c.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(o,c)=>{qIe(o,c,t,i)},mouseleave:o=>{GIe(o)},mousedown:(o,c)=>{KIe(o,c,s,r)}},decorations:o=>{const c=Ml.getState(o);if(c&&c.activeHandle>-1)return JIe(o,c.activeHandle)},nodeViews:{}}});return l}var WIe=class jj{constructor(s,r){this.activeHandle=s,this.dragging=r}apply(s){const r=this,a=s.getMeta(Ml);if(a&&a.setHandle!=null)return new jj(a.setHandle,!1);if(a&&a.setDragging!==void 0)return new jj(r.activeHandle,a.setDragging);if(r.activeHandle>-1&&s.docChanged){let i=s.mapping.map(r.activeHandle,-1);return W4(s.doc.resolve(i))||(i=-1),new jj(i,r.dragging)}return r}};function qIe(t,s,r,a){if(!t.editable)return;const i=Ml.getState(t.state);if(i&&!i.dragging){const l=XIe(s.target);let o=-1;if(l){const{left:c,right:d}=l.getBoundingClientRect();s.clientX-c<=r?o=g7(t,s,"left",r):d-s.clientX<=r&&(o=g7(t,s,"right",r))}if(o!=i.activeHandle){if(!a&&o!==-1){const c=t.state.doc.resolve(o),d=c.node(-1),u=yr.get(d),m=c.start(-1);if(u.colCount(c.pos-m)+c.nodeAfter.attrs.colspan-1==u.width-1)return}UQ(t,o)}}}function GIe(t){if(!t.editable)return;const s=Ml.getState(t.state);s&&s.activeHandle>-1&&!s.dragging&&UQ(t,-1)}function KIe(t,s,r,a){var i;if(!t.editable)return!1;const l=(i=t.dom.ownerDocument.defaultView)!=null?i:window,o=Ml.getState(t.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const c=t.state.doc.nodeAt(o.activeHandle),d=YIe(t,o.activeHandle,c.attrs);t.dispatch(t.state.tr.setMeta(Ml,{setDragging:{startX:s.clientX,startWidth:d}}));function u(x){l.removeEventListener("mouseup",u),l.removeEventListener("mousemove",m);const g=Ml.getState(t.state);g!=null&&g.dragging&&(QIe(t,g.activeHandle,b7(g.dragging,x,r)),t.dispatch(t.state.tr.setMeta(Ml,{setDragging:null})))}function m(x){if(!x.which)return u(x);const g=Ml.getState(t.state);if(g&&g.dragging){const y=b7(g.dragging,x,r);y7(t,g.activeHandle,y,a)}}return y7(t,o.activeHandle,d,a),l.addEventListener("mouseup",u),l.addEventListener("mousemove",m),s.preventDefault(),!0}function YIe(t,s,{colspan:r,colwidth:a}){const i=a&&a[a.length-1];if(i)return i;const l=t.domAtPos(s);let c=l.node.childNodes[l.offset].offsetWidth,d=r;if(a)for(let u=0;u<r;u++)a[u]&&(c-=a[u],d--);return c/d}function XIe(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function g7(t,s,r,a){const i=r=="right"?-a:a,l=t.posAtCoords({left:s.clientX+i,top:s.clientY});if(!l)return-1;const{pos:o}=l,c=Rf(t.state.doc.resolve(o));if(!c)return-1;if(r=="right")return c.pos;const d=yr.get(c.node(-1)),u=c.start(-1),m=d.map.indexOf(c.pos-u);return m%d.width==0?-1:u+d.map[m-1]}function b7(t,s,r){const a=s.clientX-t.startX;return Math.max(r,t.startWidth+a)}function UQ(t,s){t.dispatch(t.state.tr.setMeta(Ml,{setHandle:s}))}function QIe(t,s,r){const a=t.state.doc.resolve(s),i=a.node(-1),l=yr.get(i),o=a.start(-1),c=l.colCount(a.pos-o)+a.nodeAfter.attrs.colspan-1,d=t.state.tr;for(let u=0;u<l.height;u++){const m=u*l.width+c;if(u&&l.map[m]==l.map[m-l.width])continue;const x=l.map[m],g=i.nodeAt(x).attrs,y=g.colspan==1?0:c-l.colCount(x);if(g.colwidth&&g.colwidth[y]==r)continue;const v=g.colwidth?g.colwidth.slice():ZIe(g.colspan);v[y]=r,d.setNodeMarkup(o+x,null,{...g,colwidth:v})}d.docChanged&&t.dispatch(d)}function y7(t,s,r,a){const i=t.state.doc.resolve(s),l=i.node(-1),o=i.start(-1),c=yr.get(l).colCount(i.pos-o)+i.nodeAfter.attrs.colspan-1;let d=t.domAtPos(i.start(-1)).node;for(;d&&d.nodeName!="TABLE";)d=d.parentNode;d&&G4(l,d.firstChild,d,a,c,r)}function ZIe(t){return Array(t).fill(0)}function JIe(t,s){var r;const a=[],i=t.doc.resolve(s),l=i.node(-1);if(!l)return Er.empty;const o=yr.get(l),c=i.start(-1),d=o.colCount(i.pos-c)+i.nodeAfter.attrs.colspan-1;for(let u=0;u<o.height;u++){const m=d+u*o.width;if((d==o.width-1||o.map[m]!=o.map[m+1])&&(u==0||o.map[m]!=o.map[m-o.width])){const x=o.map[m],g=c+x+l.nodeAt(x).nodeSize-1,y=document.createElement("div");y.className="column-resize-handle",(r=Ml.getState(t))!=null&&r.dragging&&a.push(Fl.node(c+x,c+x+l.nodeAt(x).nodeSize,{class:"column-resize-dragging"})),a.push(Fl.widget(g,y))}}return Er.create(t.doc,a)}function eOe({allowTableNodeSelection:t=!1}={}){return new Ir({key:Vu,state:{init(){return null},apply(s,r){const a=s.getMeta(Vu);if(a!=null)return a==-1?null:a;if(r==null||!s.docChanged)return r;const{deleted:i,pos:l}=s.mapping.mapResult(r);return i?null:l}},props:{decorations:hIe,handleDOMEvents:{mousedown:UIe},createSelectionBetween(s){return Vu.getState(s.state)!=null?s.state.selection:null},handleTripleClick:$Ie,handleKeyDown:BIe,handlePaste:zIe},appendTransaction(s,r,a){return fIe(a,FQ(a,r),t)}})}var VQ=by.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var s,r;const a=t.getAttribute("colwidth"),i=a?a.split(",").map(l=>parseInt(l,10)):null;if(!i){const l=(s=t.closest("table"))==null?void 0:s.querySelectorAll("colgroup > col"),o=Array.from(((r=t.parentElement)==null?void 0:r.children)||[]).indexOf(t);if(o&&o>-1&&l&&l[o]){const c=l[o].getAttribute("width");return c?[parseInt(c,10)]:null}}return i}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",Mm(this.options.HTMLAttributes,t),0]}}),tOe=by.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const s=t.getAttribute("colwidth");return s?s.split(",").map(a=>parseInt(a,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",Mm(this.options.HTMLAttributes,t),0]}}),sOe=by.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",Mm(this.options.HTMLAttributes,t),0]}});function K4(t,s){return s?["width",`${Math.max(s,t)}px`]:["min-width",`${t}px`]}function v7(t,s,r,a,i,l){var o;let c=0,d=!0,u=s.firstChild;const m=t.firstChild;if(m!==null)for(let g=0,y=0;g<m.childCount;g+=1){const{colspan:v,colwidth:j}=m.child(g).attrs;for(let w=0;w<v;w+=1,y+=1){const S=i===y?l:j&&j[w],E=S?`${S}px`:"";if(c+=S||a,S||(d=!1),u){if(u.style.width!==E){const[k,A]=K4(a,S);u.style.setProperty(k,A)}u=u.nextSibling}else{const k=document.createElement("col"),[A,I]=K4(a,S);k.style.setProperty(A,I),s.appendChild(k)}}}for(;u;){const g=u.nextSibling;(o=u.parentNode)==null||o.removeChild(u),u=g}const x=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);d&&!x?(r.style.width=`${c}px`,r.style.minWidth=""):(r.style.width="",r.style.minWidth=`${c}px`)}var nOe=class{constructor(t,s){this.node=t,this.cellMinWidth=s,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),v7(t,this.colgroup,this.table,s),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,v7(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const s=t.target,r=this.dom.contains(s),a=this.contentDOM.contains(s);return!!(r&&!a&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function rOe(t,s,r,a){let i=0,l=!0;const o=[],c=t.firstChild;if(!c)return{};for(let x=0,g=0;x<c.childCount;x+=1){const{colspan:y,colwidth:v}=c.child(x).attrs;for(let j=0;j<y;j+=1,g+=1){const w=r===g?a:v&&v[j];i+=w||s,w||(l=!1);const[S,E]=K4(s,w);o.push(["col",{style:`${S}: ${E}`}])}}const d=l?`${i}px`:"",u=l?"":`${i}px`;return{colgroup:["colgroup",{},...o],tableWidth:d,tableMinWidth:u}}function j7(t,s){return t.createAndFill()}function aOe(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const s={};return Object.keys(t.nodes).forEach(r=>{const a=t.nodes[r];a.spec.tableRole&&(s[a.spec.tableRole]=a)}),t.cached.tableNodeTypes=s,s}function iOe(t,s,r,a,i){const l=aOe(t),o=[],c=[];for(let u=0;u<r;u+=1){const m=j7(l.cell);if(m&&c.push(m),a){const x=j7(l.header_cell);x&&o.push(x)}}const d=[];for(let u=0;u<s;u+=1)d.push(l.row.createChecked(null,a&&u===0?o:c));return l.table.createChecked(null,d)}function lOe(t){return t instanceof Tn}var tv=({editor:t})=>{const{selection:s}=t.state;if(!lOe(s))return!1;let r=0;const a=dQ(s.ranges[0].$from,l=>l.type.name==="table");return a==null||a.node.descendants(l=>{if(l.type.name==="table")return!1;["tableCell","tableHeader"].includes(l.type.name)&&(r+=1)}),r===s.ranges.length?(t.commands.deleteTable(),!0):!1},oOe="";function cOe(t){return(t||"").replace(/\s+/g," ").trim()}function dOe(t,s,r={}){var a;const i=(a=r.cellLineSeparator)!=null?a:oOe;if(!t||!t.content||t.content.length===0)return"";const l=[];t.content.forEach(v=>{const j=[];v.content&&v.content.forEach(w=>{let S="";w.content&&Array.isArray(w.content)&&w.content.length>1?S=w.content.map(I=>s.renderChildren(I)).join(i):S=w.content?s.renderChildren(w.content):"";const E=cOe(S),k=w.type==="tableHeader";j.push({text:E,isHeader:k})}),l.push(j)});const o=l.reduce((v,j)=>Math.max(v,j.length),0);if(o===0)return"";const c=new Array(o).fill(0);l.forEach(v=>{var j;for(let w=0;w<o;w+=1){const E=(((j=v[w])==null?void 0:j.text)||"").length;E>c[w]&&(c[w]=E),c[w]<3&&(c[w]=3)}});const d=(v,j)=>v+" ".repeat(Math.max(0,j-v.length)),u=l[0],m=u.some(v=>v.isHeader);let x=`
`;const g=new Array(o).fill(0).map((v,j)=>m&&u[j]&&u[j].text||"");return x+=`| ${g.map((v,j)=>d(v,c[j])).join(" | ")} |
`,x+=`| ${c.map(v=>"-".repeat(Math.max(3,v))).join(" | ")} |
`,(m?l.slice(1):l).forEach(v=>{x+=`| ${new Array(o).fill(0).map((j,w)=>d(v[w]&&v[w].text||"",c[w])).join(" | ")} |
`}),x}var uOe=dOe,HQ=by.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:nOe,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:s}){const{colgroup:r,tableWidth:a,tableMinWidth:i}=rOe(t,this.options.cellMinWidth),l=s.style;function o(){return l||(a?`width: ${a}`:`min-width: ${i}`)}const c=["table",Mm(this.options.HTMLAttributes,s,{style:o()}),r,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},c]:c},parseMarkdown:(t,s)=>{const r=[];if(t.header){const a=[];t.header.forEach(i=>{a.push(s.createNode("tableHeader",{},[{type:"paragraph",content:s.parseInline(i.tokens)}]))}),r.push(s.createNode("tableRow",{},a))}return t.rows&&t.rows.forEach(a=>{const i=[];a.forEach(l=>{i.push(s.createNode("tableCell",{},[{type:"paragraph",content:s.parseInline(l.tokens)}]))}),r.push(s.createNode("tableRow",{},i))}),s.createNode("table",void 0,r)},renderMarkdown:(t,s)=>uOe(t,s),addCommands(){return{insertTable:({rows:t=3,cols:s=3,withHeaderRow:r=!0}={})=>({tr:a,dispatch:i,editor:l})=>{const o=iOe(l.schema,t,s,r);if(i){const c=a.selection.from+1;a.replaceSelectionWith(o).scrollIntoView().setSelection(Qt.near(a.doc.resolve(c)))}return!0},addColumnBefore:()=>({state:t,dispatch:s})=>yIe(t,s),addColumnAfter:()=>({state:t,dispatch:s})=>vIe(t,s),deleteColumn:()=>({state:t,dispatch:s})=>NIe(t,s),addRowBefore:()=>({state:t,dispatch:s})=>_Ie(t,s),addRowAfter:()=>({state:t,dispatch:s})=>SIe(t,s),deleteRow:()=>({state:t,dispatch:s})=>kIe(t,s),deleteTable:()=>({state:t,dispatch:s})=>IIe(t,s),mergeCells:()=>({state:t,dispatch:s})=>c7(t,s),splitCell:()=>({state:t,dispatch:s})=>d7(t,s),toggleHeaderColumn:()=>({state:t,dispatch:s})=>Pb("column")(t,s),toggleHeaderRow:()=>({state:t,dispatch:s})=>Pb("row")(t,s),toggleHeaderCell:()=>({state:t,dispatch:s})=>DIe(t,s),mergeOrSplit:()=>({state:t,dispatch:s})=>c7(t,s)?!0:d7(t,s),setCellAttribute:(t,s)=>({state:r,dispatch:a})=>TIe(t,s)(r,a),goToNextCell:()=>({state:t,dispatch:s})=>m7(1)(t,s),goToPreviousCell:()=>({state:t,dispatch:s})=>m7(-1)(t,s),fixTables:()=>({state:t,dispatch:s})=>(s&&FQ(t),!0),setCellSelection:t=>({tr:s,dispatch:r})=>{if(r){const a=Tn.create(s.doc,t.anchorCell,t.headCell);s.setSelection(a)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:tv,"Mod-Backspace":tv,Delete:tv,"Mod-Delete":tv}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[HIe({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],eOe({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const s={name:t.name,options:t.options,storage:t.storage};return{tableRole:Zh(lf(t,"tableRole",s))}}});Ca.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(HQ.configure(this.options.table)),this.options.tableCell!==!1&&t.push(VQ.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(tOe.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(sOe.configure(this.options.tableRow)),t}});HQ.extend({addAttributes(){var t;return{...(t=this.parent)==null?void 0:t.call(this),borderPreset:{default:null,parseHTML:s=>{const r=s.getAttribute("class")||"";return/\btbl-border-all\b/.test(r)?"all":/\btbl-border-h\b/.test(r)?"h":/\btbl-border-v\b/.test(r)?"v":/\btbl-border-none\b/.test(r)?"none":null},renderHTML:s=>({class:s.borderPreset?`tbl-border-${s.borderPreset}`:null,style:"border-collapse:collapse;"})}}}}).configure({resizable:!0});VQ.extend({addAttributes(){var t;return{...(t=this.parent)==null?void 0:t.call(this),backgroundColor:{default:null,parseHTML:s=>s.style.backgroundColor||s.getAttribute("data-bg")||null,renderHTML:s=>{const r={};return s.backgroundColor&&(r.style=`background-color:${s.backgroundColor}`),{...r,"data-bg":s.backgroundColor||null}}}}}});const Tk={Patient:[{label:"UHID",token:"{{ patient.uhid }}"},{label:"Name",token:"{{ patient.name }}"},{label:"Gender",token:"{{ patient.gender }}"},{label:"DOB",token:'{{ patient.dob | datefmt("%d-%b-%Y") }}'},{label:"Phone",token:"{{ patient.phone }}"},{label:"Email",token:"{{ patient.email }}"},{label:"Address",token:"{{ patient.address }}"}],"Clinical  Last Visit":[{label:"Visit Date",token:'{{ clinical.last_visit.date | datefmt("%d-%b-%Y") }}'},{label:"Doctor",token:"{{ clinical.last_visit.doctor }}"},{label:"Department",token:"{{ clinical.last_visit.department }}"},{label:"Chief Complaints",token:"{{ clinical.last_visit.chief_complaints }}"},{label:"Diagnosis",token:"{{ clinical.last_visit.diagnosis }}"}],"Clinical  Lab Results (loop)":[{label:"Lab Results Table",token:`<table border="1" cellspacing="0" cellpadding="6">
  <tr><th>Test</th><th>Code</th><th>Status</th><th>Result</th><th>Units</th></tr>
  {% for r in clinical.lab_results %}
    <tr>
      <td>{{ r.test }}</td><td>{{ r.code }}</td>
      <td>{{ r.status }}</td><td>{{ r.result }}</td><td>{{ r.units }}</td>
    </tr>
  {% endfor %}
</table>`}],Billing:[{label:"Invoices Count",token:"{{ billing.summary.invoices_count }}"},{label:"Total",token:"{{ billing.summary.total_net }}"},{label:"Paid",token:"{{ billing.summary.total_paid }}"},{label:"Balance",token:"{{ billing.summary.balance }}"}]};function mOe({onInsert:t}){const[s,r]=p.useState(()=>new Set(Object.keys(Tk))),[a,i]=p.useState(""),l=p.useMemo(()=>{const d=a.trim().toLowerCase();return Object.entries(Tk).filter(([m])=>s.has(m)).map(([m,x])=>{const g=d?x.filter(y=>y.label.toLowerCase().includes(d)||y.token.toLowerCase().includes(d)):x;return{group:m,items:g}}).filter(m=>m.items.length>0)},[s,a]),o=d=>{const u=new Set(s);u.has(d)?u.delete(d):u.add(d),r(u)},c=(d,u)=>{d.dataTransfer.setData("text/x-token",u),d.dataTransfer.setData("text/plain",u)};return n.jsxs("div",{className:"border rounded-lg p-3 bg-white space-y-3",children:[n.jsx("div",{className:"text-sm font-semibold",children:"Field Catalog"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(Tk).map(d=>n.jsxs("label",{className:"inline-flex items-center gap-1 text-xs border rounded px-2 py-1 bg-gray-50",children:[n.jsx("input",{type:"checkbox",checked:s.has(d),onChange:()=>o(d)}),d]},d))}),n.jsx("input",{value:a,onChange:d=>i(d.target.value),placeholder:"Search fields",className:"w-full border rounded px-2 py-1 text-sm"}),n.jsx("div",{className:"space-y-4",children:l.map(({group:d,items:u})=>n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold text-gray-600 mb-1",children:d}),n.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((m,x)=>n.jsx("div",{draggable:!0,onDragStart:g=>c(g,m.token),onDoubleClick:()=>t&&t(m.token),className:"cursor-grab active:cursor-grabbing text-[11px] px-2 py-1 rounded-md bg-gray-50 hover:bg-gray-100 border",title:"Drag into editor or double-click to insert",children:m.label},x))})]},d))}),n.jsxs("div",{className:"pt-2 border-t",children:[n.jsx("div",{className:"text-[11px] text-gray-600 mb-1",children:"Custom token"}),n.jsxs("form",{onSubmit:d=>{d.preventDefault();const u=d.target.elements.token.value.trim();u&&(t&&t(u),d.target.reset())},children:[n.jsx("input",{name:"token",placeholder:"e.g. {{ my.custom }}",className:"border rounded px-2 py-1 text-sm w-full"}),n.jsx("button",{className:"mt-2 w-full px-2 py-1 border rounded text-sm",children:"Insert"})]})]})]})}const Nj=`@page {
  size: A4;
  margin: 18mm 16mm 18mm 16mm;
}
header.tpl-header { position: running(doc-header); }
footer.tpl-footer { position: running(doc-footer); }
@page {
  @top-center { content: element(doc-header); }
  @bottom-center { content: element(doc-footer); }
}
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; font-size: 12px; }
h1,h2,h3 { margin: 0 0 8px 0; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 6px; }`,ho={HeaderMinimal:`
<header class="tpl-header" style="font-size:12px;border-bottom:1px solid #ccc;padding-bottom:6px;display:flex;justify-content:space-between;align-items:center;">
  <div>
    <div style="font-weight:700">Hospital Name</div>
    <div style="font-size:11px;">Address line 1, City</div>
  </div>
  <img src="/media/uploads/sample/hospital_logo.png" alt="Logo" style="height:28px"/>
</header>`.trim(),FooterMinimal:`
<footer class="tpl-footer" style="font-size:11px;border-top:1px solid #ccc;padding-top:6px;display:flex;justify-content:space-between;">
  <div>UHID: {{ patient.uhid }} | {{ patient.name }}</div>
  <div>Page: counter(page) / counter(pages)</div>
</footer>`.trim(),SignatureBlock:`
<div style="margin-top:60px;display:flex;gap:40px;">
  <div>Patient/Guardian Signature: __________________</div>
  <div>Doctor: __________________</div>
  <div>Witness: __________________</div>
</div>`.trim(),CoverPage:`
<section style="display:flex;flex-direction:column;min-height:240mm;justify-content:center;align-items:center;text-align:center;gap:8px;">
  <img src="/media/uploads/sample/hospital_logo.png" alt="Logo" style="height:64px;opacity:0.8"/>
  <h1 style="font-size:28px;">Patient Clinical Summary</h1>
  <div style="font-size:14px">UHID: {{ patient.uhid }} &nbsp; | &nbsp; {{ patient.name }}</div>
  <div style="margin-top:40px;font-size:12px;color:#666">Generated on {{ now }}</div>
</section>`.trim()},hOe=[{key:"clinical_summary_v2",title:"Clinical Summary  Header/Footer + Tables",category:"report",html:`
<h1>Clinical Summary</h1>
<p><b>UHID:</b> {{ patient.uhid }}<br/>
<b>Name:</b> {{ patient.name }}<br/>
<b>Gender:</b> {{ patient.gender }}<br/>
<b>DOB:</b> {{ patient.dob | datefmt("%d-%b-%Y") }}</p>

{% if clinical.last_visit.date %}
<h3>Last Visit</h3>
<p><b>Date:</b> {{ clinical.last_visit.date | datefmt("%d-%b-%Y") }}<br/>
<b>Doctor:</b> {{ clinical.last_visit.doctor }}<br/>
<b>Department:</b> {{ clinical.last_visit.department }}<br/>
<b>Chief Complaints:</b> {{ clinical.last_visit.chief_complaints }}<br/>
<b>Diagnosis:</b> {{ clinical.last_visit.diagnosis }}</p>
{% endif %}

{% if clinical.lab_results %}
<h3>Recent Lab Results</h3>
<table border="1" cellspacing="0" cellpadding="6">
  <tr><th>Test</th><th>Code</th><th>Status</th><th>Result</th><th>Units</th></tr>
  {% for r in clinical.lab_results %}
    <tr>
      <td>{{ r.test }}</td><td>{{ r.code }}</td><td>{{ r.status }}</td><td>{{ r.result }}</td><td>{{ r.units }}</td>
    </tr>
  {% endfor %}
</table>
{% endif %}

{% if billing.summary %}
<h3>Billing Summary</h3>
<p>
<b>Invoices:</b> {{ billing.summary.invoices_count }} |
<b>Total:</b> {{ billing.summary.total_net }} |
<b>Paid:</b> {{ billing.summary.total_paid }} |
<b>Balance:</b> {{ billing.summary.balance }}
</p>
{% endif %}
`.trim(),css:Nj,header:ho.HeaderMinimal,footer:ho.FooterMinimal},{key:"general_consent_v2",title:"General Consent  with Signature",category:"consent",html:`
<h2 style="text-align:center;">General Consent for Treatment</h2>
<p><b>UHID:</b> {{ patient.uhid }}<br/>
<b>Patient Name:</b> {{ patient.name }}<br/>
<b>Date:</b> {{ now }}</p>

<p>
I, {{ patient.name }}, hereby give consent for the proposed {{ data.procedure_name }}
under the care of {{ data.doctor_name }}.
</p>

<p><b>Risks explained:</b> {{ data.risks_text }}</p>

${ho.SignatureBlock}
`.trim(),css:Nj,header:ho.HeaderMinimal,footer:ho.FooterMinimal},{key:"cover_plus_clinical",title:"Cover Page + Clinical",category:"report",html:`${ho.CoverPage}
<div style="page-break-before:always;"></div>
<h1>Clinical Details</h1>
<p><b>UHID:</b> {{ patient.uhid }} &nbsp; <b>Name:</b> {{ patient.name }}</p>
{% if clinical.last_visit.date %}
<p><b>Last Visit:</b> {{ clinical.last_visit.date | datefmt("%d-%b-%Y") }}  {{ clinical.last_visit.doctor }}</p>
{% endif %}
`.trim(),css:Nj,header:ho.HeaderMinimal,footer:ho.FooterMinimal}];function xOe({onUseLayout:t,onInsertBlock:s}){const r=p.useMemo(()=>[{key:"HeaderMinimal",title:"Header  Minimal",html:ho.HeaderMinimal},{key:"FooterMinimal",title:"Footer  Minimal",html:ho.FooterMinimal},{key:"SignatureBlock",title:"Signature Block",html:ho.SignatureBlock},{key:"CoverPage",title:"Cover Page",html:ho.CoverPage}],[]);return n.jsxs("div",{className:"border rounded-lg p-3 bg-white space-y-3",children:[n.jsx("div",{className:"text-sm font-semibold",children:"Template Gallery"}),n.jsx("div",{className:"space-y-2",children:hOe.map(a=>n.jsxs("div",{className:"border rounded p-2",children:[n.jsx("div",{className:"text-sm font-medium",children:a.title}),n.jsxs("div",{className:"text-[11px] text-gray-500 mb-2",children:["Category: ",a.category]}),n.jsx("div",{className:"flex gap-2",children:n.jsx("button",{className:"px-2 py-1 rounded text-sm border",onClick:()=>t&&t(a),children:"Use Layout"})})]},a.key))}),n.jsxs("div",{className:"pt-2 border-t",children:[n.jsx("div",{className:"text-sm font-semibold mb-2",children:"Blocks"}),n.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.map(a=>n.jsxs("button",{className:"border rounded p-2 text-left hover:bg-gray-50",onClick:()=>s&&s(a.html),title:"Insert into current editor",children:[n.jsx("div",{className:"text-xs font-medium",children:a.title}),n.jsx("div",{className:"text-[10px] text-gray-500",children:"Click to insert"})]},a.key))})]})]})}const pOe=[{key:"A4",label:"A4 (210297 mm)"},{key:"A5",label:"A5 (148210 mm)"},{key:"Letter",label:"Letter (8.511 in)"},{key:"Legal",label:"Legal (8.514 in)"}];function fOe({css:t="",onApply:s,onClose:r}){const[a,i]=p.useState("A4"),[l,o]=p.useState("portrait"),[c,d]=p.useState(18),[u,m]=p.useState(16),[x,g]=p.useState(18),[y,v]=p.useState(16),[j,w]=p.useState(!0);p.useEffect(()=>{const E=t.match(/@page\s*{([\s\S]*?)}/);if(!E)return;const k=E[1],A=O=>(k.match(O)||[,""])[1],I=A(/size:\s*([^;]+);/i);if(I){const O=I.trim().split(/\s+/);i(O[0]),O[1]&&o(O[1])}const P=(O,D)=>{const T=A(O);return T?parseInt(T,10):D};d(P(/margin-top:\s*([0-9]+)mm/i,c)),m(P(/margin-right:\s*([0-9]+)mm/i,u)),g(P(/margin-bottom:\s*([0-9]+)mm/i,x)),v(P(/margin-left:\s*([0-9]+)mm/i,y))},[]);const S=()=>`@page {
  size: ${a} ${l};
  margin-top: ${c}mm;
  margin-right: ${u}mm;
  margin-bottom: ${x}mm;
  margin-left: ${y}mm;
  ${j?'@bottom-right { content: "Page " counter(page) " of " counter(pages); font-size:10px; }':""}
}`;return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-lg w-full max-w-xl",children:[n.jsx("div",{className:"px-4 py-3 border-b font-semibold",children:"Page Setup"}),n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("label",{className:"text-sm",children:["Size",n.jsx("select",{className:"w-full border rounded px-2 py-1",value:a,onChange:E=>i(E.target.value),children:pOe.map(E=>n.jsx("option",{value:E.key,children:E.label},E.key))})]}),n.jsxs("label",{className:"text-sm",children:["Orientation",n.jsxs("select",{className:"w-full border rounded px-2 py-1",value:l,onChange:E=>o(E.target.value),children:[n.jsx("option",{value:"portrait",children:"Portrait"}),n.jsx("option",{value:"landscape",children:"Landscape"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[n.jsxs("label",{className:"text-sm",children:["Top (mm)",n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1",value:c,onChange:E=>d(+E.target.value)})]}),n.jsxs("label",{className:"text-sm",children:["Right (mm)",n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1",value:u,onChange:E=>m(+E.target.value)})]}),n.jsxs("label",{className:"text-sm",children:["Bottom (mm)",n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1",value:x,onChange:E=>g(+E.target.value)})]}),n.jsxs("label",{className:"text-sm",children:["Left (mm)",n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1",value:y,onChange:E=>v(+E.target.value)})]})]}),n.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[n.jsx("input",{type:"checkbox",checked:j,onChange:E=>w(E.target.checked)}),"Show page numbers (WeasyPrint)"]}),n.jsx("pre",{className:"text-xs bg-gray-50 border rounded p-2 overflow-auto",children:S()})]}),n.jsxs("div",{className:"px-4 py-3 border-t flex justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 border rounded",onClick:r,children:"Cancel"}),n.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 text-white",onClick:()=>s&&s(S()),children:"Apply"})]})]})})}const Pk=Nj;function N7({mode:t="create"}){var D;const{id:s}=Cm(),r=Qr(),i=((D=pi().state)==null?void 0:D.preset)||null,[l,o]=p.useState({name:"",code:"",category:"report",subcategory:"",description:"",css:Pk,is_active:!0}),[c,d]=p.useState(""),[u,m]=p.useState("<h1>New Template</h1><p>Use the Field Catalog or Gallery.</p>"),[x,g]=p.useState(""),[y,v]=p.useState("body"),j=t==="edit";p.useEffect(()=>{!j||!s||(async()=>{const B=(await v4e(s)).data;o({name:B.name,code:B.code,category:B.category,subcategory:B.subcategory||"",description:B.description||"",css:B.css||Pk,is_active:!!B.is_active});const U=B.html||"",W=U.match(/<header[^>]*class="[^"]*tpl-header[^"]*"[^>]*>[\s\S]*?<\/header>/i),V=U.match(/<footer[^>]*class="[^"]*tpl-footer[^"]*"[^>]*>[\s\S]*?<\/footer>/i);d(W?W[0]:""),g(V?V[0]:"");let R=U;W&&(R=R.replace(W[0],"")),V&&(R=R.replace(V[0],"")),m(R.trim()||"")})()},[j,s]),p.useEffect(()=>{!i||j||(o(T=>({...T,category:i.category||"report",name:T.name||i.title||"Untitled",code:T.code||(i.key?`${i.key}-${Date.now()}`:""),css:i.css||Pk})),d(i.header||""),g(i.footer||""),m(i.html||""))},[i,j]);const w=p.useMemo(()=>[c,u,x].filter(Boolean).join(`
`),[c,u,x]),S=async()=>{if(!l.name.trim()||!l.code.trim()){ae.error("Name and unique code are required");return}const T={...l,html:w,placeholders:{header:!!c,footer:!!x}};try{j?(await N4e(s,T),ae.success("Template updated")):(await j4e(T),ae.success("Template created")),r("/templates")}catch{}},E=T=>{o(B=>({...B,category:T.category||B.category,css:T.css||B.css,name:B.name||T.title,code:B.code||(T.key?`${T.key}-${Date.now()}`:"")})),d(T.header||""),g(T.footer||""),m(T.html||""),ae.success("Layout applied")},k=T=>{y==="header"?d(B=>`${B}
${T}`):y==="footer"?g(B=>`${B}
${T}`):m(B=>`${B}
${T}`)},A=T=>{k(T)},[I,P]=p.useState(!1),O=T=>{o(B=>{const U=/@page\s*{[\s\S]*?}/.test(B.css||"");return{...B,css:U?B.css.replace(/@page\s*{[\s\S]*?}/,T):T+`
`+(B.css||"")}}),P(!1)};return n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>P(!0),className:"px-3 py-2 rounded border",children:"Page Setup"}),n.jsx("button",{onClick:S,className:"px-3 py-2 rounded bg-blue-600 text-white",children:"Save"}),I&&n.jsx(fOe,{css:l.css,onApply:O,onClose:()=>P(!1)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h1",{className:"text-xl font-semibold",children:j?"Edit Template":"Create Template"}),n.jsx("div",{className:"flex gap-2",children:n.jsx("button",{onClick:S,className:"px-3 py-2 rounded bg-blue-600 text-white",children:"Save"})})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[n.jsx("input",{value:l.name,onChange:T=>o({...l,name:T.target.value}),className:"border rounded px-3 py-2",placeholder:"Template Name"}),n.jsx("input",{value:l.code,onChange:T=>o({...l,code:T.target.value}),className:"border rounded px-3 py-2",placeholder:"Unique Code (e.g., clinical_summary_v2)",disabled:j}),n.jsxs("select",{value:l.category,onChange:T=>o({...l,category:T.target.value}),className:"border rounded px-3 py-2",children:[n.jsx("option",{value:"report",children:"Report"}),n.jsx("option",{value:"consent",children:"Consent"})]}),n.jsx("input",{value:l.subcategory,onChange:T=>o({...l,subcategory:T.target.value}),className:"border rounded px-3 py-2",placeholder:"Subcategory (optional)"}),n.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[n.jsx("input",{type:"checkbox",checked:l.is_active,onChange:T=>o({...l,is_active:T.target.checked})}),"Active"]})]}),n.jsx("textarea",{value:l.description,onChange:T=>o({...l,description:T.target.value}),placeholder:"Description (optional)",className:"border rounded px-3 py-2 w-full min-h-[80px]"}),n.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[n.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-3",children:[n.jsx("div",{className:"flex gap-2",children:["header","body","footer"].map(T=>n.jsx("button",{onClick:()=>v(T),className:["px-3 py-1 rounded border text-sm",y===T?"bg-blue-600 text-white border-blue-600":"bg-white"].join(" "),children:T.toUpperCase()},T))}),y==="header"&&n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium mb-1",children:"Header (running top)"}),n.jsx(uk,{value:c,onChange:d})]}),y==="body"&&n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium mb-1",children:"Body"}),n.jsx(uk,{value:u,onChange:m})]}),y==="footer"&&n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium mb-1",children:"Footer (running bottom)"}),n.jsx(uk,{value:x,onChange:g})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium mb-1",children:"CSS (print styles)"}),n.jsx("textarea",{value:l.css,onChange:T=>o({...l,css:T.target.value}),className:"border rounded px-3 py-2 w-full min-h-[160px] font-mono text-xs"})]})]}),n.jsxs("div",{className:"col-span-12 lg:col-span-4 space-y-3",children:[n.jsx(mOe,{onInsert:A}),n.jsx(xOe,{onUseLayout:E,onInsertBlock:k}),n.jsxs("div",{className:"text-[11px] text-gray-500",children:[n.jsx("b",{children:"Note:"})," Save the template to use server-side merged preview & PDF."]})]})]})]})}function gOe(t,s){const r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=s||"download",document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(r)}function bOe(){const[t,s]=p.useState("saved"),[r,a]=p.useState(null),[i,l]=p.useState([]),[o,c]=p.useState(""),[d,u]=p.useState(""),[m,x]=p.useState(1),[g,y]=p.useState("");p.useEffect(()=>{(async()=>{const w=await NP({category:"report",active:!0});l(w.data||[])})()},[]);const v=async()=>{if(!r||!o)return ae.info("Select template and patient");try{const w=await DY(Number(o),Number(r));u(w.data.html||"")}catch{}},j=async()=>{if(!r||!o)return ae.info("Select template and patient");try{const w=g?await S4e(Number(o),{patient_id:Number(r),inline:!1,engine:g}):await _4e(Number(o),Number(r));gOe(w,`patient-${r}.pdf`)}catch{}};return n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsx("h1",{className:"text-xl font-semibold",children:"Generate Patient Reports"}),n.jsx("div",{className:"flex gap-2",children:["saved","predefined","customized"].map(w=>n.jsx("button",{onClick:()=>s(w),className:["px-3 py-1 rounded border text-sm",t===w?"bg-blue-600 text-white border-blue-600":"bg-white"].join(" "),children:w==="saved"?"Saved Formats":w==="predefined"?"Predefined":"Customized"},w))}),t==="saved"&&n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"md:col-span-1 border rounded-lg p-3 bg-white space-y-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold mb-2",children:"1) Select Template"}),n.jsxs("select",{value:o,onChange:w=>c(w.target.value),className:"border rounded px-3 py-2 w-full",children:[n.jsx("option",{value:"",children:"-- choose report template --"}),i.map(w=>n.jsxs("option",{value:w.id,children:[w.name," (",w.code,")"]},w.id))]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold mb-2",children:"2) Choose Patient"}),n.jsx(jN,{value:r,onSelect:a})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"text-sm",children:"Engine"}),n.jsxs("select",{value:g,onChange:w=>y(w.target.value),className:"border rounded px-2 py-1 text-sm",children:[n.jsx("option",{value:"",children:"Auto"}),n.jsx("option",{value:"weasyprint",children:"WeasyPrint"}),n.jsx("option",{value:"xhtml2pdf",children:"xhtml2pdf (fallback)"})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:v,className:"px-3 py-2 border rounded",children:"Preview"}),n.jsx("button",{onClick:j,className:"px-3 py-2 rounded bg-blue-600 text-white",children:"Download PDF"})]})]})]}),n.jsxs("div",{className:"md:col-span-2 border rounded-lg overflow-hidden bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("div",{className:"text-sm text-gray-600",children:"Preview"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>x(w=>Math.max(.5,+(w-.1).toFixed(2))),children:""}),n.jsxs("div",{className:"text-xs w-12 text-center",children:[Math.round(m*100),"%"]}),n.jsx("button",{className:"px-2 py-1 border rounded text-sm",onClick:()=>x(w=>Math.min(2,+(w+.1).toFixed(2))),children:"+"})]})]}),n.jsx("div",{className:"w-full",style:{transform:`scale(${m})`,transformOrigin:"0 0"},children:n.jsx("iframe",{title:"report-preview",className:"w-full min-h-[900px]",srcDoc:d||""})})]})]}),t==="predefined"&&n.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[n.jsx("div",{className:"md:col-span-1",children:n.jsx(TemplateGallery,{onUseLayout:w=>window.location.assign("/templates/new"),onInsertBlock:()=>{}})}),n.jsx("div",{className:"md:col-span-2 border rounded-lg p-4 bg-white text-sm text-gray-600",children:'Pick a layout from the left to open the editor pre-filled. Save it, then return to "Saved Formats".'})]}),t==="customized"&&n.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[n.jsx("div",{className:"text-sm mb-2",children:"Create your own template with header/footer, drag-drop fields and blocks."}),n.jsx("a",{href:"/templates/new",className:"px-3 py-2 rounded bg-blue-600 text-white inline-block",children:"Open Template Builder"})]})]})}function yOe(){const[t,s]=p.useState(""),[r,a]=p.useState([]),[i,l]=p.useState(""),[o,c]=p.useState({procedure_name:"",doctor_name:"",risks_text:"",witness_name:""}),[d,u]=p.useState(""),[m,x]=p.useState([]),g=async j=>{if(!j){x([]);return}try{const w=await k4e(Number(j));x(w.data||[])}catch{}};p.useEffect(()=>{(async()=>{const j=await NP({category:"consent",active:!0});a(j.data||[])})()},[]);const y=async()=>{if(!t||!i){ae.info("Select consent template and enter Patient ID");return}const j={data:{...o}},w=await DY(Number(i),Number(t),j);u(w.data.html||"")},v=async()=>{if(!t||!i){ae.info("Select consent template and enter Patient ID");return}try{await C4e(Number(t),{template_id:Number(i),data:{...o},finalize:!0,signed_by:o.doctor_name||void 0,witness_name:o.witness_name||void 0}),ae.success("Consent saved"),g(t)}catch{}};return n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsx("h1",{className:"text-xl font-semibold",children:"Patient Consents"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"md:col-span-1 border rounded-lg p-3 bg-white",children:[n.jsx("div",{className:"text-sm font-semibold mb-2",children:"Consent Template"}),n.jsxs("select",{value:i,onChange:j=>l(j.target.value),className:"border rounded px-3 py-2 w-full",children:[n.jsx("option",{value:"",children:"-- choose consent template --"}),r.map(j=>n.jsxs("option",{value:j.id,children:[j.name," (",j.code,")"]},j.id))]}),n.jsx("div",{className:"mt-3 text-sm font-semibold",children:"Patient"}),n.jsx("input",{value:t,onChange:j=>s(j.target.value),className:"border rounded px-3 py-2 w-full",placeholder:"Patient ID",onBlur:()=>g(e.target.value)}),n.jsx("div",{className:"mt-3 text-sm font-semibold",children:"Extra Fields"}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("input",{value:o.procedure_name,onChange:j=>c({...o,procedure_name:j.target.value}),className:"border rounded px-3 py-2 w-full",placeholder:"Procedure name"}),n.jsx("input",{value:o.doctor_name,onChange:j=>c({...o,doctor_name:j.target.value}),className:"border rounded px-3 py-2 w-full",placeholder:"Doctor name"}),n.jsx("textarea",{value:o.risks_text,onChange:j=>c({...o,risks_text:j.target.value}),className:"border rounded px-3 py-2 w-full min-h-[80px]",placeholder:"Risks explained..."}),n.jsx("input",{value:o.witness_name,onChange:j=>c({...o,witness_name:j.target.value}),className:"border rounded px-3 py-2 w-full",placeholder:"Witness name"})]}),n.jsxs("div",{className:"mt-3 flex gap-2",children:[n.jsx("button",{onClick:y,className:"px-3 py-2 border rounded",children:"Preview"}),n.jsx("button",{onClick:v,className:"px-3 py-2 rounded bg-blue-600 text-white",children:"Save PDF"})]})]}),n.jsxs("div",{className:"md:col-span-2 space-y-3",children:[n.jsx("div",{className:"border rounded-lg overflow-hidden bg-white",children:n.jsx("iframe",{title:"consent-preview",className:"w-full min-h-[400px]",srcDoc:d||""})}),n.jsxs("div",{className:"border rounded-lg bg-white",children:[n.jsxs("div",{className:"px-3 py-2 border-b text-sm font-semibold",children:["Existing Consents (Patient #",t||"-",")"]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-left",children:"#"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"Template"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"Status"}),n.jsx("th",{className:"px-3 py-2 text-left",children:"PDF"})]})}),n.jsxs("tbody",{children:[m.map(j=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"px-3 py-2",children:j.id}),n.jsx("td",{className:"px-3 py-2",children:j.template_id}),n.jsx("td",{className:"px-3 py-2",children:j.status}),n.jsx("td",{className:"px-3 py-2",children:j.pdf_path?n.jsx("a",{href:j.pdf_path,target:"_blank",rel:"noreferrer",className:"text-blue-700 underline",children:"Open"}):n.jsx("span",{className:"text-gray-400",children:"-"})})]},j.id)),m.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-6 text-center text-gray-500",children:"No consents"})})]})]})})]})]})]})]})}function vOe(t={}){return he.get("/dashboard/data",{params:t})}var jOe=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function lD(t){if(typeof t!="string")return!1;var s=jOe;return s.includes(t)}var NOe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"];function WQ(t){if(typeof t!="string")return!1;var s=NOe;return s.includes(t)}function qQ(t){return typeof t=="string"&&t.startsWith("data-")}function od(t){var s=Object.entries(t).filter(r=>{var[a]=r;return WQ(a)||qQ(a)});return Object.fromEntries(s)}function Db(t){if(t==null)return null;if(p.isValidElement(t)&&typeof t.props=="object"&&t.props!==null){var s=t.props;return od(s)}return typeof t=="object"&&!Array.isArray(t)?od(t):null}function Mo(t){var s=Object.entries(t).filter(r=>{var[a]=r;return WQ(a)||qQ(a)||lD(a)});return Object.fromEntries(s)}var wOe=["children","width","height","viewBox","className","style","title","desc"];function Y4(){return Y4=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Y4.apply(null,arguments)}function _Oe(t,s){if(t==null)return{};var r,a,i=SOe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function SOe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var GQ=p.forwardRef((t,s)=>{var{children:r,width:a,height:i,viewBox:l,className:o,style:c,title:d,desc:u}=t,m=_Oe(t,wOe),x=l||{width:a,height:i,x:0,y:0},g=mn("recharts-surface",o);return p.createElement("svg",Y4({},Mo(m),{className:g,width:a,height:i,style:c,viewBox:"".concat(x.x," ").concat(x.y," ").concat(x.width," ").concat(x.height),ref:s}),p.createElement("title",null,d),p.createElement("desc",null,u),r)}),COe=["children","className"];function X4(){return X4=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},X4.apply(null,arguments)}function kOe(t,s){if(t==null)return{};var r,a,i=AOe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function AOe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var Mi=p.forwardRef((t,s)=>{var{children:r,className:a}=t,i=kOe(t,COe),l=mn("recharts-layer",a);return p.createElement("g",X4({className:l},Mo(i),{ref:s}),r)}),EOe=p.createContext(null);function An(t){return function(){return t}}const KQ=Math.cos,LN=Math.sin,jc=Math.sqrt,FN=Math.PI,a_=2*FN,Q4=Math.PI,Z4=2*Q4,Qm=1e-6,TOe=Z4-Qm;function YQ(t){this._+=t[0];for(let s=1,r=t.length;s<r;++s)this._+=arguments[s]+t[s]}function POe(t){let s=Math.floor(t);if(!(s>=0))throw new Error(`invalid digits: ${t}`);if(s>15)return YQ;const r=10**s;return function(a){this._+=a[0];for(let i=1,l=a.length;i<l;++i)this._+=Math.round(arguments[i]*r)/r+a[i]}}class DOe{constructor(s){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=s==null?YQ:POe(s)}moveTo(s,r){this._append`M${this._x0=this._x1=+s},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(s,r){this._append`L${this._x1=+s},${this._y1=+r}`}quadraticCurveTo(s,r,a,i){this._append`Q${+s},${+r},${this._x1=+a},${this._y1=+i}`}bezierCurveTo(s,r,a,i,l,o){this._append`C${+s},${+r},${+a},${+i},${this._x1=+l},${this._y1=+o}`}arcTo(s,r,a,i,l){if(s=+s,r=+r,a=+a,i=+i,l=+l,l<0)throw new Error(`negative radius: ${l}`);let o=this._x1,c=this._y1,d=a-s,u=i-r,m=o-s,x=c-r,g=m*m+x*x;if(this._x1===null)this._append`M${this._x1=s},${this._y1=r}`;else if(g>Qm)if(!(Math.abs(x*d-u*m)>Qm)||!l)this._append`L${this._x1=s},${this._y1=r}`;else{let y=a-o,v=i-c,j=d*d+u*u,w=y*y+v*v,S=Math.sqrt(j),E=Math.sqrt(g),k=l*Math.tan((Q4-Math.acos((j+g-w)/(2*S*E)))/2),A=k/E,I=k/S;Math.abs(A-1)>Qm&&this._append`L${s+A*m},${r+A*x}`,this._append`A${l},${l},0,0,${+(x*y>m*v)},${this._x1=s+I*d},${this._y1=r+I*u}`}}arc(s,r,a,i,l,o){if(s=+s,r=+r,a=+a,o=!!o,a<0)throw new Error(`negative radius: ${a}`);let c=a*Math.cos(i),d=a*Math.sin(i),u=s+c,m=r+d,x=1^o,g=o?i-l:l-i;this._x1===null?this._append`M${u},${m}`:(Math.abs(this._x1-u)>Qm||Math.abs(this._y1-m)>Qm)&&this._append`L${u},${m}`,a&&(g<0&&(g=g%Z4+Z4),g>TOe?this._append`A${a},${a},0,1,${x},${s-c},${r-d}A${a},${a},0,1,${x},${this._x1=u},${this._y1=m}`:g>Qm&&this._append`A${a},${a},0,${+(g>=Q4)},${x},${this._x1=s+a*Math.cos(l)},${this._y1=r+a*Math.sin(l)}`)}rect(s,r,a,i){this._append`M${this._x0=this._x1=+s},${this._y0=this._y1=+r}h${a=+a}v${+i}h${-a}Z`}toString(){return this._}}function oD(t){let s=3;return t.digits=function(r){if(!arguments.length)return s;if(r==null)s=null;else{const a=Math.floor(r);if(!(a>=0))throw new RangeError(`invalid digits: ${r}`);s=a}return t},()=>new DOe(s)}function cD(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function XQ(t){this._context=t}XQ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,s){switch(t=+t,s=+s,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,s):this._context.moveTo(t,s);break;case 1:this._point=2;default:this._context.lineTo(t,s);break}}};function i_(t){return new XQ(t)}function QQ(t){return t[0]}function ZQ(t){return t[1]}function JQ(t,s){var r=An(!0),a=null,i=i_,l=null,o=oD(c);t=typeof t=="function"?t:t===void 0?QQ:An(t),s=typeof s=="function"?s:s===void 0?ZQ:An(s);function c(d){var u,m=(d=cD(d)).length,x,g=!1,y;for(a==null&&(l=i(y=o())),u=0;u<=m;++u)!(u<m&&r(x=d[u],u,d))===g&&((g=!g)?l.lineStart():l.lineEnd()),g&&l.point(+t(x,u,d),+s(x,u,d));if(y)return l=null,y+""||null}return c.x=function(d){return arguments.length?(t=typeof d=="function"?d:An(+d),c):t},c.y=function(d){return arguments.length?(s=typeof d=="function"?d:An(+d),c):s},c.defined=function(d){return arguments.length?(r=typeof d=="function"?d:An(!!d),c):r},c.curve=function(d){return arguments.length?(i=d,a!=null&&(l=i(a)),c):i},c.context=function(d){return arguments.length?(d==null?a=l=null:l=i(a=d),c):a},c}function sv(t,s,r){var a=null,i=An(!0),l=null,o=i_,c=null,d=oD(u);t=typeof t=="function"?t:t===void 0?QQ:An(+t),s=typeof s=="function"?s:An(s===void 0?0:+s),r=typeof r=="function"?r:r===void 0?ZQ:An(+r);function u(x){var g,y,v,j=(x=cD(x)).length,w,S=!1,E,k=new Array(j),A=new Array(j);for(l==null&&(c=o(E=d())),g=0;g<=j;++g){if(!(g<j&&i(w=x[g],g,x))===S)if(S=!S)y=g,c.areaStart(),c.lineStart();else{for(c.lineEnd(),c.lineStart(),v=g-1;v>=y;--v)c.point(k[v],A[v]);c.lineEnd(),c.areaEnd()}S&&(k[g]=+t(w,g,x),A[g]=+s(w,g,x),c.point(a?+a(w,g,x):k[g],r?+r(w,g,x):A[g]))}if(E)return c=null,E+""||null}function m(){return JQ().defined(i).curve(o).context(l)}return u.x=function(x){return arguments.length?(t=typeof x=="function"?x:An(+x),a=null,u):t},u.x0=function(x){return arguments.length?(t=typeof x=="function"?x:An(+x),u):t},u.x1=function(x){return arguments.length?(a=x==null?null:typeof x=="function"?x:An(+x),u):a},u.y=function(x){return arguments.length?(s=typeof x=="function"?x:An(+x),r=null,u):s},u.y0=function(x){return arguments.length?(s=typeof x=="function"?x:An(+x),u):s},u.y1=function(x){return arguments.length?(r=x==null?null:typeof x=="function"?x:An(+x),u):r},u.lineX0=u.lineY0=function(){return m().x(t).y(s)},u.lineY1=function(){return m().x(t).y(r)},u.lineX1=function(){return m().x(a).y(s)},u.defined=function(x){return arguments.length?(i=typeof x=="function"?x:An(!!x),u):i},u.curve=function(x){return arguments.length?(o=x,l!=null&&(c=o(l)),u):o},u.context=function(x){return arguments.length?(x==null?l=c=null:c=o(l=x),u):l},u}class eZ{constructor(s,r){this._context=s,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(s,r){switch(s=+s,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(s,r):this._context.moveTo(s,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+s)/2,this._y0,this._x0,r,s,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,s,this._y0,s,r);break}}this._x0=s,this._y0=r}}function MOe(t){return new eZ(t,!0)}function IOe(t){return new eZ(t,!1)}const dD={draw(t,s){const r=jc(s/FN);t.moveTo(r,0),t.arc(0,0,r,0,a_)}},OOe={draw(t,s){const r=jc(s/5)/2;t.moveTo(-3*r,-r),t.lineTo(-r,-r),t.lineTo(-r,-3*r),t.lineTo(r,-3*r),t.lineTo(r,-r),t.lineTo(3*r,-r),t.lineTo(3*r,r),t.lineTo(r,r),t.lineTo(r,3*r),t.lineTo(-r,3*r),t.lineTo(-r,r),t.lineTo(-3*r,r),t.closePath()}},tZ=jc(1/3),ROe=tZ*2,LOe={draw(t,s){const r=jc(s/ROe),a=r*tZ;t.moveTo(0,-r),t.lineTo(a,0),t.lineTo(0,r),t.lineTo(-a,0),t.closePath()}},FOe={draw(t,s){const r=jc(s),a=-r/2;t.rect(a,a,r,r)}},BOe=.8908130915292852,sZ=LN(FN/10)/LN(7*FN/10),$Oe=LN(a_/10)*sZ,zOe=-KQ(a_/10)*sZ,UOe={draw(t,s){const r=jc(s*BOe),a=$Oe*r,i=zOe*r;t.moveTo(0,-r),t.lineTo(a,i);for(let l=1;l<5;++l){const o=a_*l/5,c=KQ(o),d=LN(o);t.lineTo(d*r,-c*r),t.lineTo(c*a-d*i,d*a+c*i)}t.closePath()}},Dk=jc(3),VOe={draw(t,s){const r=-jc(s/(Dk*3));t.moveTo(0,r*2),t.lineTo(-Dk*r,-r),t.lineTo(Dk*r,-r),t.closePath()}},ao=-.5,io=jc(3)/2,J4=1/jc(12),HOe=(J4/2+1)*3,WOe={draw(t,s){const r=jc(s/HOe),a=r/2,i=r*J4,l=a,o=r*J4+r,c=-l,d=o;t.moveTo(a,i),t.lineTo(l,o),t.lineTo(c,d),t.lineTo(ao*a-io*i,io*a+ao*i),t.lineTo(ao*l-io*o,io*l+ao*o),t.lineTo(ao*c-io*d,io*c+ao*d),t.lineTo(ao*a+io*i,ao*i-io*a),t.lineTo(ao*l+io*o,ao*o-io*l),t.lineTo(ao*c+io*d,ao*d-io*c),t.closePath()}};function qOe(t,s){let r=null,a=oD(i);t=typeof t=="function"?t:An(t||dD),s=typeof s=="function"?s:An(s===void 0?64:+s);function i(){let l;if(r||(r=l=a()),t.apply(this,arguments).draw(r,+s.apply(this,arguments)),l)return r=null,l+""||null}return i.type=function(l){return arguments.length?(t=typeof l=="function"?l:An(l),i):t},i.size=function(l){return arguments.length?(s=typeof l=="function"?l:An(+l),i):s},i.context=function(l){return arguments.length?(r=l??null,i):r},i}function BN(){}function $N(t,s,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+s)/6,(t._y0+4*t._y1+r)/6)}function nZ(t){this._context=t}nZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:$N(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,s){switch(t=+t,s=+s,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,s):this._context.moveTo(t,s);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:$N(this,t,s);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=s}};function GOe(t){return new nZ(t)}function rZ(t){this._context=t}rZ.prototype={areaStart:BN,areaEnd:BN,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,s){switch(t=+t,s=+s,this._point){case 0:this._point=1,this._x2=t,this._y2=s;break;case 1:this._point=2,this._x3=t,this._y3=s;break;case 2:this._point=3,this._x4=t,this._y4=s,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+s)/6);break;default:$N(this,t,s);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=s}};function KOe(t){return new rZ(t)}function aZ(t){this._context=t}aZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,s){switch(t=+t,s=+s,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+t)/6,a=(this._y0+4*this._y1+s)/6;this._line?this._context.lineTo(r,a):this._context.moveTo(r,a);break;case 3:this._point=4;default:$N(this,t,s);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=s}};function YOe(t){return new aZ(t)}function iZ(t){this._context=t}iZ.prototype={areaStart:BN,areaEnd:BN,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,s){t=+t,s=+s,this._point?this._context.lineTo(t,s):(this._point=1,this._context.moveTo(t,s))}};function XOe(t){return new iZ(t)}function w7(t){return t<0?-1:1}function _7(t,s,r){var a=t._x1-t._x0,i=s-t._x1,l=(t._y1-t._y0)/(a||i<0&&-0),o=(r-t._y1)/(i||a<0&&-0),c=(l*i+o*a)/(a+i);return(w7(l)+w7(o))*Math.min(Math.abs(l),Math.abs(o),.5*Math.abs(c))||0}function S7(t,s){var r=t._x1-t._x0;return r?(3*(t._y1-t._y0)/r-s)/2:s}function Mk(t,s,r){var a=t._x0,i=t._y0,l=t._x1,o=t._y1,c=(l-a)/3;t._context.bezierCurveTo(a+c,i+c*s,l-c,o-c*r,l,o)}function zN(t){this._context=t}zN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Mk(this,this._t0,S7(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,s){var r=NaN;if(t=+t,s=+s,!(t===this._x1&&s===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,s):this._context.moveTo(t,s);break;case 1:this._point=2;break;case 2:this._point=3,Mk(this,S7(this,r=_7(this,t,s)),r);break;default:Mk(this,this._t0,r=_7(this,t,s));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=s,this._t0=r}}};function lZ(t){this._context=new oZ(t)}(lZ.prototype=Object.create(zN.prototype)).point=function(t,s){zN.prototype.point.call(this,s,t)};function oZ(t){this._context=t}oZ.prototype={moveTo:function(t,s){this._context.moveTo(s,t)},closePath:function(){this._context.closePath()},lineTo:function(t,s){this._context.lineTo(s,t)},bezierCurveTo:function(t,s,r,a,i,l){this._context.bezierCurveTo(s,t,a,r,l,i)}};function QOe(t){return new zN(t)}function ZOe(t){return new lZ(t)}function cZ(t){this._context=t}cZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,s=this._y,r=t.length;if(r)if(this._line?this._context.lineTo(t[0],s[0]):this._context.moveTo(t[0],s[0]),r===2)this._context.lineTo(t[1],s[1]);else for(var a=C7(t),i=C7(s),l=0,o=1;o<r;++l,++o)this._context.bezierCurveTo(a[0][l],i[0][l],a[1][l],i[1][l],t[o],s[o]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,s){this._x.push(+t),this._y.push(+s)}};function C7(t){var s,r=t.length-1,a,i=new Array(r),l=new Array(r),o=new Array(r);for(i[0]=0,l[0]=2,o[0]=t[0]+2*t[1],s=1;s<r-1;++s)i[s]=1,l[s]=4,o[s]=4*t[s]+2*t[s+1];for(i[r-1]=2,l[r-1]=7,o[r-1]=8*t[r-1]+t[r],s=1;s<r;++s)a=i[s]/l[s-1],l[s]-=a,o[s]-=a*o[s-1];for(i[r-1]=o[r-1]/l[r-1],s=r-2;s>=0;--s)i[s]=(o[s]-i[s+1])/l[s];for(l[r-1]=(t[r]+i[r-1])/2,s=0;s<r-1;++s)l[s]=2*t[s+1]-i[s+1];return[i,l]}function JOe(t){return new cZ(t)}function l_(t,s){this._context=t,this._t=s}l_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,s){switch(t=+t,s=+s,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,s):this._context.moveTo(t,s);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,s),this._context.lineTo(t,s);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,s)}break}}this._x=t,this._y=s}};function eRe(t){return new l_(t,.5)}function tRe(t){return new l_(t,0)}function sRe(t){return new l_(t,1)}function df(t,s){if((o=t.length)>1)for(var r=1,a,i,l=t[s[0]],o,c=l.length;r<o;++r)for(i=l,l=t[s[r]],a=0;a<c;++a)l[a][1]+=l[a][0]=isNaN(i[a][1])?i[a][0]:i[a][1]}function eA(t){for(var s=t.length,r=new Array(s);--s>=0;)r[s]=s;return r}function nRe(t,s){return t[s]}function rRe(t){const s=[];return s.key=t,s}function aRe(){var t=An([]),s=eA,r=df,a=nRe;function i(l){var o=Array.from(t.apply(this,arguments),rRe),c,d=o.length,u=-1,m;for(const x of l)for(c=0,++u;c<d;++c)(o[c][u]=[0,+a(x,o[c].key,u,l)]).data=x;for(c=0,m=cD(s(o));c<d;++c)o[m[c]].index=c;return r(o,m),o}return i.keys=function(l){return arguments.length?(t=typeof l=="function"?l:An(Array.from(l)),i):t},i.value=function(l){return arguments.length?(a=typeof l=="function"?l:An(+l),i):a},i.order=function(l){return arguments.length?(s=l==null?eA:typeof l=="function"?l:An(Array.from(l)),i):s},i.offset=function(l){return arguments.length?(r=l??df,i):r},i}function iRe(t,s){if((a=t.length)>0){for(var r,a,i=0,l=t[0].length,o;i<l;++i){for(o=r=0;r<a;++r)o+=t[r][i][1]||0;if(o)for(r=0;r<a;++r)t[r][i][1]/=o}df(t,s)}}function lRe(t,s){if((i=t.length)>0){for(var r=0,a=t[s[0]],i,l=a.length;r<l;++r){for(var o=0,c=0;o<i;++o)c+=t[o][r][1]||0;a[r][1]+=a[r][0]=-c/2}df(t,s)}}function oRe(t,s){if(!(!((o=t.length)>0)||!((l=(i=t[s[0]]).length)>0))){for(var r=0,a=1,i,l,o;a<l;++a){for(var c=0,d=0,u=0;c<o;++c){for(var m=t[s[c]],x=m[a][1]||0,g=m[a-1][1]||0,y=(x-g)/2,v=0;v<c;++v){var j=t[s[v]],w=j[a][1]||0,S=j[a-1][1]||0;y+=w-S}d+=x,u+=y*x}i[a-1][1]+=i[a-1][0]=r,d&&(r-=u/d)}i[a-1][1]+=i[a-1][0]=r,df(t,s)}}var o_={},dZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return r==="__proto__"}t.isUnsafeProperty=s})(dZ);var uD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){switch(typeof r){case"number":case"symbol":return!1;case"string":return r.includes(".")||r.includes("[")||r.includes("]")}}t.isDeepKey=s})(uD);var c_={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){var a;return typeof r=="string"||typeof r=="symbol"?r:Object.is((a=r==null?void 0:r.valueOf)==null?void 0:a.call(r),-0)?"-0":String(r)}t.toKey=s})(c_);var d_={},uZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){if(r==null)return"";if(typeof r=="string")return r;if(Array.isArray(r))return r.map(s).join(",");const a=String(r);return a==="0"&&Object.is(Number(r),-0)?"-0":a}t.toString=s})(uZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=uZ,r=c_;function a(i){if(Array.isArray(i))return i.map(r.toKey);if(typeof i=="symbol")return[i];i=s.toString(i);const l=[],o=i.length;if(o===0)return l;let c=0,d="",u="",m=!1;for(i.charCodeAt(0)===46&&(l.push(""),c++);c<o;){const x=i[c];u?x==="\\"&&c+1<o?(c++,d+=i[c]):x===u?u="":d+=x:m?x==='"'||x==="'"?u=x:x==="]"?(m=!1,l.push(d),d=""):d+=x:x==="["?(m=!0,d&&(l.push(d),d="")):x==="."?d&&(l.push(d),d=""):d+=x,c++}return d&&l.push(d),l}t.toPath=a})(d_);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=dZ,r=uD,a=c_,i=d_;function l(c,d,u){if(c==null)return u;switch(typeof d){case"string":{if(s.isUnsafeProperty(d))return u;const m=c[d];return m===void 0?r.isDeepKey(d)?l(c,i.toPath(d),u):u:m}case"number":case"symbol":{typeof d=="number"&&(d=a.toKey(d));const m=c[d];return m===void 0?u:m}default:{if(Array.isArray(d))return o(c,d,u);if(Object.is(d==null?void 0:d.valueOf(),-0)?d="-0":d=String(d),s.isUnsafeProperty(d))return u;const m=c[d];return m===void 0?u:m}}}function o(c,d,u){if(d.length===0)return u;let m=c;for(let x=0;x<d.length;x++){if(m==null||s.isUnsafeProperty(d[x]))return u;m=m[d[x]]}return m===void 0?u:m}t.get=l})(o_);var cRe=o_.get;const tx=Ro(cRe);var qa=t=>t===0?0:t>0?1:-1,cd=t=>typeof t=="number"&&t!=+t,Qd=t=>typeof t=="string"&&t.indexOf("%")===t.length-1,as=t=>(typeof t=="number"||t instanceof Number)&&!cd(t),dd=t=>as(t)||typeof t=="string",dRe=0,Mb=t=>{var s=++dRe;return"".concat(t||"").concat(s)},di=function(s,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!as(s)&&typeof s!="string")return a;var l;if(Qd(s)){if(r==null)return a;var o=s.indexOf("%");l=r*parseFloat(s.slice(0,o))/100}else l=+s;return cd(l)&&(l=a),i&&r!=null&&l>r&&(l=r),l},mZ=t=>{if(!Array.isArray(t))return!1;for(var s=t.length,r={},a=0;a<s;a++)if(!r[t[a]])r[t[a]]=!0;else return!0;return!1};function aa(t,s,r){return as(t)&&as(s)?t+r*(s-t):s}function uRe(t,s,r){if(!(!t||!t.length))return t.find(a=>a&&(typeof s=="function"?s(a):tx(a,s))===r)}var Sa=t=>t===null||typeof t>"u",yy=t=>Sa(t)?t:"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));function mRe(t){return t!=null}function yx(){}var hRe=["type","size","sizeType"];function tA(){return tA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},tA.apply(null,arguments)}function k7(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function A7(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?k7(Object(r),!0).forEach(function(a){xRe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):k7(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function xRe(t,s,r){return(s=pRe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function pRe(t){var s=fRe(t,"string");return typeof s=="symbol"?s:s+""}function fRe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function gRe(t,s){if(t==null)return{};var r,a,i=bRe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function bRe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var hZ={symbolCircle:dD,symbolCross:OOe,symbolDiamond:LOe,symbolSquare:FOe,symbolStar:UOe,symbolTriangle:VOe,symbolWye:WOe},yRe=Math.PI/180,vRe=t=>{var s="symbol".concat(yy(t));return hZ[s]||dD},jRe=(t,s,r)=>{if(s==="area")return t;switch(r){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*yRe;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.tan(a)**2)}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},NRe=(t,s)=>{hZ["symbol".concat(yy(t))]=s},xZ=t=>{var{type:s="circle",size:r=64,sizeType:a="area"}=t,i=gRe(t,hRe),l=A7(A7({},i),{},{type:s,size:r,sizeType:a}),o="circle";typeof s=="string"&&(o=s);var c=()=>{var g=vRe(o),y=qOe().type(g).size(jRe(r,a,o)),v=y();if(v!==null)return v},{className:d,cx:u,cy:m}=l,x=Mo(l);return as(u)&&as(m)&&as(r)?p.createElement("path",tA({},x,{className:mn("recharts-symbols",d),transform:"translate(".concat(u,", ").concat(m,")"),d:c()})):null};xZ.registerSymbol=NRe;var pZ=t=>"radius"in t&&"startAngle"in t&&"endAngle"in t,wRe=(t,s)=>{if(!t||typeof t=="function"||typeof t=="boolean")return null;var r=t;if(p.isValidElement(t)&&(r=t.props),typeof r!="object"&&typeof r!="function")return null;var a={};return Object.keys(r).forEach(i=>{lD(i)&&(a[i]=l=>r[i](r,l))}),a},_Re=(t,s,r)=>a=>(t(s,r,a),null),u_=(t,s,r)=>{if(t===null||typeof t!="object"&&typeof t!="function")return null;var a=null;return Object.keys(t).forEach(i=>{var l=t[i];lD(i)&&typeof l=="function"&&(a||(a={}),a[i]=_Re(l,s,r))}),a};function E7(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function SRe(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?E7(Object(r),!0).forEach(function(a){CRe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):E7(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function CRe(t,s,r){return(s=kRe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function kRe(t){var s=ARe(t,"string");return typeof s=="symbol"?s:s+""}function ARe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function Li(t,s){var r=SRe({},t),a=s,i=Object.keys(s),l=i.reduce((o,c)=>(o[c]===void 0&&a[c]!==void 0&&(o[c]=a[c]),o),r);return l}var fZ={},gZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r,a){const i=new Map;for(let l=0;l<r.length;l++){const o=r[l],c=a(o);i.has(c)||i.set(c,o)}return Array.from(i.values())}t.uniqBy=s})(gZ);var mD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return r}t.identity=s})(mD);var bZ={},m_={},yZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return Number.isSafeInteger(r)&&r>=0}t.isLength=s})(yZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=yZ;function r(a){return a!=null&&typeof a!="function"&&s.isLength(a.length)}t.isArrayLike=r})(m_);var vZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return typeof r=="object"&&r!==null}t.isObjectLike=s})(vZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=m_,r=vZ;function a(i){return r.isObjectLike(i)&&s.isArrayLike(i)}t.isArrayLikeObject=a})(bZ);var jZ={},NZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=o_;function r(a){return function(i){return s.get(i,a)}}t.property=r})(NZ);var wZ={},hD={},_Z={},xD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return r!==null&&(typeof r=="object"||typeof r=="function")}t.isObject=s})(xD);var pD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return r==null||typeof r!="object"&&typeof r!="function"}t.isPrimitive=s})(pD);var fD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r,a){return r===a||Number.isNaN(r)&&Number.isNaN(a)}t.eq=s})(fD);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=xD,r=pD,a=fD;function i(m,x,g){return typeof g!="function"?i(m,x,()=>{}):l(m,x,function y(v,j,w,S,E,k){const A=g(v,j,w,S,E,k);return A!==void 0?!!A:l(v,j,y,k)},new Map)}function l(m,x,g,y){if(x===m)return!0;switch(typeof x){case"object":return o(m,x,g,y);case"function":return Object.keys(x).length>0?l(m,{...x},g,y):a.eq(m,x);default:return s.isObject(m)?typeof x=="string"?x==="":!0:a.eq(m,x)}}function o(m,x,g,y){if(x==null)return!0;if(Array.isArray(x))return d(m,x,g,y);if(x instanceof Map)return c(m,x,g,y);if(x instanceof Set)return u(m,x,g,y);const v=Object.keys(x);if(m==null)return v.length===0;if(v.length===0)return!0;if(y!=null&&y.has(x))return y.get(x)===m;y==null||y.set(x,m);try{for(let j=0;j<v.length;j++){const w=v[j];if(!r.isPrimitive(m)&&!(w in m)||x[w]===void 0&&m[w]!==void 0||x[w]===null&&m[w]!==null||!g(m[w],x[w],w,m,x,y))return!1}return!0}finally{y==null||y.delete(x)}}function c(m,x,g,y){if(x.size===0)return!0;if(!(m instanceof Map))return!1;for(const[v,j]of x.entries()){const w=m.get(v);if(g(w,j,v,m,x,y)===!1)return!1}return!0}function d(m,x,g,y){if(x.length===0)return!0;if(!Array.isArray(m))return!1;const v=new Set;for(let j=0;j<x.length;j++){const w=x[j];let S=!1;for(let E=0;E<m.length;E++){if(v.has(E))continue;const k=m[E];let A=!1;if(g(k,w,j,m,x,y)&&(A=!0),A){v.add(E),S=!0;break}}if(!S)return!1}return!0}function u(m,x,g,y){return x.size===0?!0:m instanceof Set?d([...m],[...x],g,y):!1}t.isMatchWith=i,t.isSetMatch=u})(_Z);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=_Z;function r(a,i){return s.isMatchWith(a,i,()=>{})}t.isMatch=r})(hD);var SZ={},gD={},CZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return Object.getOwnPropertySymbols(r).filter(a=>Object.prototype.propertyIsEnumerable.call(r,a))}t.getSymbols=s})(CZ);var bD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}t.getTag=s})(bD);var yD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s="[object RegExp]",r="[object String]",a="[object Number]",i="[object Boolean]",l="[object Arguments]",o="[object Symbol]",c="[object Date]",d="[object Map]",u="[object Set]",m="[object Array]",x="[object Function]",g="[object ArrayBuffer]",y="[object Object]",v="[object Error]",j="[object DataView]",w="[object Uint8Array]",S="[object Uint8ClampedArray]",E="[object Uint16Array]",k="[object Uint32Array]",A="[object BigUint64Array]",I="[object Int8Array]",P="[object Int16Array]",O="[object Int32Array]",D="[object BigInt64Array]",T="[object Float32Array]",B="[object Float64Array]";t.argumentsTag=l,t.arrayBufferTag=g,t.arrayTag=m,t.bigInt64ArrayTag=D,t.bigUint64ArrayTag=A,t.booleanTag=i,t.dataViewTag=j,t.dateTag=c,t.errorTag=v,t.float32ArrayTag=T,t.float64ArrayTag=B,t.functionTag=x,t.int16ArrayTag=P,t.int32ArrayTag=O,t.int8ArrayTag=I,t.mapTag=d,t.numberTag=a,t.objectTag=y,t.regexpTag=s,t.setTag=u,t.stringTag=r,t.symbolTag=o,t.uint16ArrayTag=E,t.uint32ArrayTag=k,t.uint8ArrayTag=w,t.uint8ClampedArrayTag=S})(yD);var kZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}t.isTypedArray=s})(kZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=CZ,r=bD,a=yD,i=pD,l=kZ;function o(m,x){return c(m,void 0,m,new Map,x)}function c(m,x,g,y=new Map,v=void 0){const j=v==null?void 0:v(m,x,g,y);if(j!==void 0)return j;if(i.isPrimitive(m))return m;if(y.has(m))return y.get(m);if(Array.isArray(m)){const w=new Array(m.length);y.set(m,w);for(let S=0;S<m.length;S++)w[S]=c(m[S],S,g,y,v);return Object.hasOwn(m,"index")&&(w.index=m.index),Object.hasOwn(m,"input")&&(w.input=m.input),w}if(m instanceof Date)return new Date(m.getTime());if(m instanceof RegExp){const w=new RegExp(m.source,m.flags);return w.lastIndex=m.lastIndex,w}if(m instanceof Map){const w=new Map;y.set(m,w);for(const[S,E]of m)w.set(S,c(E,S,g,y,v));return w}if(m instanceof Set){const w=new Set;y.set(m,w);for(const S of m)w.add(c(S,void 0,g,y,v));return w}if(typeof Buffer<"u"&&Buffer.isBuffer(m))return m.subarray();if(l.isTypedArray(m)){const w=new(Object.getPrototypeOf(m)).constructor(m.length);y.set(m,w);for(let S=0;S<m.length;S++)w[S]=c(m[S],S,g,y,v);return w}if(m instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&m instanceof SharedArrayBuffer)return m.slice(0);if(m instanceof DataView){const w=new DataView(m.buffer.slice(0),m.byteOffset,m.byteLength);return y.set(m,w),d(w,m,g,y,v),w}if(typeof File<"u"&&m instanceof File){const w=new File([m],m.name,{type:m.type});return y.set(m,w),d(w,m,g,y,v),w}if(typeof Blob<"u"&&m instanceof Blob){const w=new Blob([m],{type:m.type});return y.set(m,w),d(w,m,g,y,v),w}if(m instanceof Error){const w=new m.constructor;return y.set(m,w),w.message=m.message,w.name=m.name,w.stack=m.stack,w.cause=m.cause,d(w,m,g,y,v),w}if(m instanceof Boolean){const w=new Boolean(m.valueOf());return y.set(m,w),d(w,m,g,y,v),w}if(m instanceof Number){const w=new Number(m.valueOf());return y.set(m,w),d(w,m,g,y,v),w}if(m instanceof String){const w=new String(m.valueOf());return y.set(m,w),d(w,m,g,y,v),w}if(typeof m=="object"&&u(m)){const w=Object.create(Object.getPrototypeOf(m));return y.set(m,w),d(w,m,g,y,v),w}return m}function d(m,x,g=m,y,v){const j=[...Object.keys(x),...s.getSymbols(x)];for(let w=0;w<j.length;w++){const S=j[w],E=Object.getOwnPropertyDescriptor(m,S);(E==null||E.writable)&&(m[S]=c(x[S],S,g,y,v))}}function u(m){switch(r.getTag(m)){case a.argumentsTag:case a.arrayTag:case a.arrayBufferTag:case a.dataViewTag:case a.booleanTag:case a.dateTag:case a.float32ArrayTag:case a.float64ArrayTag:case a.int8ArrayTag:case a.int16ArrayTag:case a.int32ArrayTag:case a.mapTag:case a.numberTag:case a.objectTag:case a.regexpTag:case a.setTag:case a.stringTag:case a.symbolTag:case a.uint8ArrayTag:case a.uint8ClampedArrayTag:case a.uint16ArrayTag:case a.uint32ArrayTag:return!0;default:return!1}}t.cloneDeepWith=o,t.cloneDeepWithImpl=c,t.copyProperties=d})(gD);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=gD;function r(a){return s.cloneDeepWithImpl(a,void 0,a,new Map,void 0)}t.cloneDeep=r})(SZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=hD,r=SZ;function a(i){return i=r.cloneDeep(i),l=>s.isMatch(l,i)}t.matches=a})(wZ);var AZ={},EZ={},TZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=gD,r=yD;function a(i,l){return s.cloneDeepWith(i,(o,c,d,u)=>{const m=l==null?void 0:l(o,c,d,u);if(m!==void 0)return m;if(typeof i=="object")switch(Object.prototype.toString.call(i)){case r.numberTag:case r.stringTag:case r.booleanTag:{const x=new i.constructor(i==null?void 0:i.valueOf());return s.copyProperties(x,i),x}case r.argumentsTag:{const x={};return s.copyProperties(x,i),x.length=i.length,x[Symbol.iterator]=i[Symbol.iterator],x}default:return}})}t.cloneDeepWith=a})(TZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=TZ;function r(a){return s.cloneDeepWith(a)}t.cloneDeep=r})(EZ);var PZ={},vD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=/^(?:0|[1-9]\d*)$/;function r(a,i=Number.MAX_SAFE_INTEGER){switch(typeof a){case"number":return Number.isInteger(a)&&a>=0&&a<i;case"symbol":return!1;case"string":return s.test(a)}}t.isIndex=r})(vD);var DZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=bD;function r(a){return a!==null&&typeof a=="object"&&s.getTag(a)==="[object Arguments]"}t.isArguments=r})(DZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=uD,r=vD,a=DZ,i=d_;function l(o,c){let d;if(Array.isArray(c)?d=c:typeof c=="string"&&s.isDeepKey(c)&&(o==null?void 0:o[c])==null?d=i.toPath(c):d=[c],d.length===0)return!1;let u=o;for(let m=0;m<d.length;m++){const x=d[m];if((u==null||!Object.hasOwn(u,x))&&!((Array.isArray(u)||a.isArguments(u))&&r.isIndex(x)&&x<u.length))return!1;u=u[x]}return!0}t.has=l})(PZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=hD,r=c_,a=EZ,i=o_,l=PZ;function o(c,d){switch(typeof c){case"object":{Object.is(c==null?void 0:c.valueOf(),-0)&&(c="-0");break}case"number":{c=r.toKey(c);break}}return d=a.cloneDeep(d),function(u){const m=i.get(u,c);return m===void 0?l.has(u,c):d===void 0?m===void 0:s.isMatch(m,d)}}t.matchesProperty=o})(AZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=mD,r=NZ,a=wZ,i=AZ;function l(o){if(o==null)return s.identity;switch(typeof o){case"function":return o;case"object":return Array.isArray(o)&&o.length===2?i.matchesProperty(o[0],o[1]):a.matches(o);case"string":case"symbol":case"number":return r.property(o)}}t.iteratee=l})(jZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=gZ,r=mD,a=bZ,i=jZ;function l(o,c=r.identity){return a.isArrayLikeObject(o)?s.uniqBy(Array.from(o),i.iteratee(c)):[]}t.uniqBy=l})(fZ);var ERe=fZ.uniqBy;const T7=Ro(ERe);function TRe(t,s,r){return s===!0?T7(t,r):typeof s=="function"?T7(t,s):t}var jD=p.createContext(null),PRe=t=>t,Qn=()=>{var t=p.useContext(jD);return t?t.store.dispatch:PRe},wj=()=>{},DRe=()=>wj,MRe=(t,s)=>t===s;function es(t){var s=p.useContext(jD);return gV.useSyncExternalStoreWithSelector(s?s.subscription.addNestedSub:DRe,s?s.store.getState:wj,s?s.store.getState:wj,s?t:wj,MRe)}function IRe(t,s=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(s)}function ORe(t,s=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(s)}function RRe(t,s="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(a=>typeof a=="function"?`function ${a.name||"unnamed"}()`:typeof a).join(", ");throw new TypeError(`${s}[${r}]`)}}var P7=t=>Array.isArray(t)?t:[t];function LRe(t){const s=Array.isArray(t[0])?t[0]:t;return RRe(s,"createSelector expects all input-selectors to be functions, but received the following types: "),s}function FRe(t,s){const r=[],{length:a}=t;for(let i=0;i<a;i++)r.push(t[i].apply(null,s));return r}var BRe=class{constructor(t){this.value=t}deref(){return this.value}},$Re=typeof WeakRef<"u"?WeakRef:BRe,zRe=0,D7=1;function nv(){return{s:zRe,v:void 0,o:null,p:null}}function MZ(t,s={}){let r=nv();const{resultEqualityCheck:a}=s;let i,l=0;function o(){var x;let c=r;const{length:d}=arguments;for(let g=0,y=d;g<y;g++){const v=arguments[g];if(typeof v=="function"||typeof v=="object"&&v!==null){let j=c.o;j===null&&(c.o=j=new WeakMap);const w=j.get(v);w===void 0?(c=nv(),j.set(v,c)):c=w}else{let j=c.p;j===null&&(c.p=j=new Map);const w=j.get(v);w===void 0?(c=nv(),j.set(v,c)):c=w}}const u=c;let m;if(c.s===D7)m=c.v;else if(m=t.apply(null,arguments),l++,a){const g=((x=i==null?void 0:i.deref)==null?void 0:x.call(i))??i;g!=null&&a(g,m)&&(m=g,l!==0&&l--),i=typeof m=="object"&&m!==null||typeof m=="function"?new $Re(m):m}return u.s=D7,u.v=m,m}return o.clearCache=()=>{r=nv(),o.resetResultsCount()},o.resultsCount=()=>l,o.resetResultsCount=()=>{l=0},o}function URe(t,...s){const r=typeof t=="function"?{memoize:t,memoizeOptions:s}:t,a=(...i)=>{let l=0,o=0,c,d={},u=i.pop();typeof u=="object"&&(d=u,u=i.pop()),IRe(u,`createSelector expects an output function after the inputs, but received: [${typeof u}]`);const m={...r,...d},{memoize:x,memoizeOptions:g=[],argsMemoize:y=MZ,argsMemoizeOptions:v=[]}=m,j=P7(g),w=P7(v),S=LRe(i),E=x(function(){return l++,u.apply(null,arguments)},...j),k=y(function(){o++;const I=FRe(S,arguments);return c=E.apply(null,I),c},...w);return Object.assign(k,{resultFunc:u,memoizedResultFunc:E,dependencies:S,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>c,recomputations:()=>l,resetRecomputations:()=>{l=0},memoize:x,argsMemoize:y})};return Object.assign(a,{withTypes:()=>a}),a}var Je=URe(MZ),VRe=Object.assign((t,s=Je)=>{ORe(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),a=r.map(l=>t[l]);return s(a,(...l)=>l.reduce((o,c,d)=>(o[r[d]]=c,o),{}))},{withTypes:()=>VRe}),IZ={},OZ={},RZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(a){return typeof a=="symbol"?1:a===null?2:a===void 0?3:a!==a?4:0}const r=(a,i,l)=>{if(a!==i){const o=s(a),c=s(i);if(o===c&&o===0){if(a<i)return l==="desc"?1:-1;if(a>i)return l==="desc"?-1:1}return l==="desc"?c-o:o-c}return 0};t.compareValues=r})(RZ);var LZ={},ND={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return typeof r=="symbol"||r instanceof Symbol}t.isSymbol=s})(ND);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=ND,r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;function i(l,o){return Array.isArray(l)?!1:typeof l=="number"||typeof l=="boolean"||l==null||s.isSymbol(l)?!0:typeof l=="string"&&(a.test(l)||!r.test(l))||o!=null&&Object.hasOwn(o,l)}t.isKey=i})(LZ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=RZ,r=LZ,a=d_;function i(l,o,c,d){if(l==null)return[];c=d?void 0:c,Array.isArray(l)||(l=Object.values(l)),Array.isArray(o)||(o=o==null?[null]:[o]),o.length===0&&(o=[null]),Array.isArray(c)||(c=c==null?[]:[c]),c=c.map(y=>String(y));const u=(y,v)=>{let j=y;for(let w=0;w<v.length&&j!=null;++w)j=j[v[w]];return j},m=(y,v)=>v==null||y==null?v:typeof y=="object"&&"key"in y?Object.hasOwn(v,y.key)?v[y.key]:u(v,y.path):typeof y=="function"?y(v):Array.isArray(y)?u(v,y):typeof v=="object"?v[y]:v,x=o.map(y=>(Array.isArray(y)&&y.length===1&&(y=y[0]),y==null||typeof y=="function"||Array.isArray(y)||r.isKey(y)?y:{key:y,path:a.toPath(y)}));return l.map(y=>({original:y,criteria:x.map(v=>m(v,y))})).slice().sort((y,v)=>{for(let j=0;j<x.length;j++){const w=s.compareValues(y.criteria[j],v.criteria[j],c[j]);if(w!==0)return w}return 0}).map(y=>y.original)}t.orderBy=i})(OZ);var FZ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r,a=1){const i=[],l=Math.floor(a),o=(c,d)=>{for(let u=0;u<c.length;u++){const m=c[u];Array.isArray(m)&&d<l?o(m,d+1):i.push(m)}};return o(r,0),i}t.flatten=s})(FZ);var wD={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=vD,r=m_,a=xD,i=fD;function l(o,c,d){return a.isObject(d)&&(typeof c=="number"&&r.isArrayLike(d)&&s.isIndex(c)&&c<d.length||typeof c=="string"&&c in d)?i.eq(d[c],o):!1}t.isIterateeCall=l})(wD);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=OZ,r=FZ,a=wD;function i(l,...o){const c=o.length;return c>1&&a.isIterateeCall(l,o[0],o[1])?o=[]:c>2&&a.isIterateeCall(o[0],o[1],o[2])&&(o=[o[0]]),s.orderBy(l,r.flatten(o),["asc"])}t.sortBy=i})(IZ);var HRe=IZ.sortBy;const h_=Ro(HRe);var BZ=t=>t.legend.settings,WRe=t=>t.legend.size,qRe=t=>t.legend.payload;Je([qRe,BZ],(t,s)=>{var{itemSorter:r}=s,a=t.flat(1);return r?h_(a,r):a});var rv=1;function GRe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[s,r]=p.useState({height:0,left:0,top:0,width:0}),a=p.useCallback(i=>{if(i!=null){var l=i.getBoundingClientRect(),o={height:l.height,left:l.left,top:l.top,width:l.width};(Math.abs(o.height-s.height)>rv||Math.abs(o.left-s.left)>rv||Math.abs(o.top-s.top)>rv||Math.abs(o.width-s.width)>rv)&&r({height:o.height,left:o.left,top:o.top,width:o.width})}},[s.width,s.height,s.top,s.left,...t]);return[s,a]}function Ra(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var KRe=typeof Symbol=="function"&&Symbol.observable||"@@observable",M7=KRe,Ik=()=>Math.random().toString(36).substring(7).split("").join("."),YRe={INIT:`@@redux/INIT${Ik()}`,REPLACE:`@@redux/REPLACE${Ik()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Ik()}`},UN=YRe;function _D(t){if(typeof t!="object"||t===null)return!1;let s=t;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(t)===s||Object.getPrototypeOf(t)===null}function $Z(t,s,r){if(typeof t!="function")throw new Error(Ra(2));if(typeof s=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Ra(0));if(typeof s=="function"&&typeof r>"u"&&(r=s,s=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Ra(1));return r($Z)(t,s)}let a=t,i=s,l=new Map,o=l,c=0,d=!1;function u(){o===l&&(o=new Map,l.forEach((w,S)=>{o.set(S,w)}))}function m(){if(d)throw new Error(Ra(3));return i}function x(w){if(typeof w!="function")throw new Error(Ra(4));if(d)throw new Error(Ra(5));let S=!0;u();const E=c++;return o.set(E,w),function(){if(S){if(d)throw new Error(Ra(6));S=!1,u(),o.delete(E),l=null}}}function g(w){if(!_D(w))throw new Error(Ra(7));if(typeof w.type>"u")throw new Error(Ra(8));if(typeof w.type!="string")throw new Error(Ra(17));if(d)throw new Error(Ra(9));try{d=!0,i=a(i,w)}finally{d=!1}return(l=o).forEach(E=>{E()}),w}function y(w){if(typeof w!="function")throw new Error(Ra(10));a=w,g({type:UN.REPLACE})}function v(){const w=x;return{subscribe(S){if(typeof S!="object"||S===null)throw new Error(Ra(11));function E(){const A=S;A.next&&A.next(m())}return E(),{unsubscribe:w(E)}},[M7](){return this}}}return g({type:UN.INIT}),{dispatch:g,subscribe:x,getState:m,replaceReducer:y,[M7]:v}}function XRe(t){Object.keys(t).forEach(s=>{const r=t[s];if(typeof r(void 0,{type:UN.INIT})>"u")throw new Error(Ra(12));if(typeof r(void 0,{type:UN.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ra(13))})}function zZ(t){const s=Object.keys(t),r={};for(let l=0;l<s.length;l++){const o=s[l];typeof t[o]=="function"&&(r[o]=t[o])}const a=Object.keys(r);let i;try{XRe(r)}catch(l){i=l}return function(o={},c){if(i)throw i;let d=!1;const u={};for(let m=0;m<a.length;m++){const x=a[m],g=r[x],y=o[x],v=g(y,c);if(typeof v>"u")throw c&&c.type,new Error(Ra(14));u[x]=v,d=d||v!==y}return d=d||a.length!==Object.keys(o).length,d?u:o}}function VN(...t){return t.length===0?s=>s:t.length===1?t[0]:t.reduce((s,r)=>(...a)=>s(r(...a)))}function QRe(...t){return s=>(r,a)=>{const i=s(r,a);let l=()=>{throw new Error(Ra(15))};const o={getState:i.getState,dispatch:(d,...u)=>l(d,...u)},c=t.map(d=>d(o));return l=VN(...c)(i.dispatch),{...i,dispatch:l}}}function UZ(t){return _D(t)&&"type"in t&&typeof t.type=="string"}var VZ=Symbol.for("immer-nothing"),I7=Symbol.for("immer-draftable"),Gl=Symbol.for("immer-state");function nc(t,...s){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Ib=Object.getPrototypeOf;function sx(t){return!!t&&!!t[Gl]}function Zd(t){var s;return t?HZ(t)||Array.isArray(t)||!!t[I7]||!!((s=t.constructor)!=null&&s[I7])||vy(t)||p_(t):!1}var ZRe=Object.prototype.constructor.toString(),O7=new WeakMap;function HZ(t){if(!t||typeof t!="object")return!1;const s=Object.getPrototypeOf(t);if(s===null||s===Object.prototype)return!0;const r=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;if(r===Object)return!0;if(typeof r!="function")return!1;let a=O7.get(r);return a===void 0&&(a=Function.toString.call(r),O7.set(r,a)),a===ZRe}function HN(t,s,r=!0){x_(t)===0?(r?Reflect.ownKeys(t):Object.keys(t)).forEach(i=>{s(i,t[i],t)}):t.forEach((a,i)=>s(i,a,t))}function x_(t){const s=t[Gl];return s?s.type_:Array.isArray(t)?1:vy(t)?2:p_(t)?3:0}function sA(t,s){return x_(t)===2?t.has(s):Object.prototype.hasOwnProperty.call(t,s)}function WZ(t,s,r){const a=x_(t);a===2?t.set(s,r):a===3?t.add(r):t[s]=r}function JRe(t,s){return t===s?t!==0||1/t===1/s:t!==t&&s!==s}function vy(t){return t instanceof Map}function p_(t){return t instanceof Set}function Zm(t){return t.copy_||t.base_}function nA(t,s){if(vy(t))return new Map(t);if(p_(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=HZ(t);if(s===!0||s==="class_only"&&!r){const a=Object.getOwnPropertyDescriptors(t);delete a[Gl];let i=Reflect.ownKeys(a);for(let l=0;l<i.length;l++){const o=i[l],c=a[o];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(a[o]={configurable:!0,writable:!0,enumerable:c.enumerable,value:t[o]})}return Object.create(Ib(t),a)}else{const a=Ib(t);if(a!==null&&r)return{...t};const i=Object.create(a);return Object.assign(i,t)}}function SD(t,s=!1){return f_(t)||sx(t)||!Zd(t)||(x_(t)>1&&Object.defineProperties(t,{set:av,add:av,clear:av,delete:av}),Object.freeze(t),s&&Object.values(t).forEach(r=>SD(r,!0))),t}function e6e(){nc(2)}var av={value:e6e};function f_(t){return t===null||typeof t!="object"?!0:Object.isFrozen(t)}var t6e={};function nx(t){const s=t6e[t];return s||nc(0,t),s}var Ob;function qZ(){return Ob}function s6e(t,s){return{drafts_:[],parent_:t,immer_:s,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function R7(t,s){s&&(nx("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=s)}function rA(t){aA(t),t.drafts_.forEach(n6e),t.drafts_=null}function aA(t){t===Ob&&(Ob=t.parent_)}function L7(t){return Ob=s6e(Ob,t)}function n6e(t){const s=t[Gl];s.type_===0||s.type_===1?s.revoke_():s.revoked_=!0}function F7(t,s){s.unfinalizedDrafts_=s.drafts_.length;const r=s.drafts_[0];return t!==void 0&&t!==r?(r[Gl].modified_&&(rA(s),nc(4)),Zd(t)&&(t=WN(s,t),s.parent_||qN(s,t)),s.patches_&&nx("Patches").generateReplacementPatches_(r[Gl].base_,t,s.patches_,s.inversePatches_)):t=WN(s,r,[]),rA(s),s.patches_&&s.patchListener_(s.patches_,s.inversePatches_),t!==VZ?t:void 0}function WN(t,s,r){if(f_(s))return s;const a=t.immer_.shouldUseStrictIteration(),i=s[Gl];if(!i)return HN(s,(l,o)=>B7(t,i,s,l,o,r),a),s;if(i.scope_!==t)return s;if(!i.modified_)return qN(t,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const l=i.copy_;let o=l,c=!1;i.type_===3&&(o=new Set(l),l.clear(),c=!0),HN(o,(d,u)=>B7(t,i,l,d,u,r,c),a),qN(t,l,!1),r&&t.patches_&&nx("Patches").generatePatches_(i,r,t.patches_,t.inversePatches_)}return i.copy_}function B7(t,s,r,a,i,l,o){if(i==null||typeof i!="object"&&!o)return;const c=f_(i);if(!(c&&!o)){if(sx(i)){const d=l&&s&&s.type_!==3&&!sA(s.assigned_,a)?l.concat(a):void 0,u=WN(t,i,d);if(WZ(r,a,u),sx(u))t.canAutoFreeze_=!1;else return}else o&&r.add(i);if(Zd(i)&&!c){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1||s&&s.base_&&s.base_[a]===i&&c)return;WN(t,i),(!s||!s.scope_.parent_)&&typeof a!="symbol"&&(vy(r)?r.has(a):Object.prototype.propertyIsEnumerable.call(r,a))&&qN(t,i)}}}function qN(t,s,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&SD(s,r)}function r6e(t,s){const r=Array.isArray(t),a={type_:r?1:0,scope_:s?s.scope_:qZ(),modified_:!1,finalized_:!1,assigned_:{},parent_:s,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=a,l=CD;r&&(i=[a],l=Rb);const{revoke:o,proxy:c}=Proxy.revocable(i,l);return a.draft_=c,a.revoke_=o,c}var CD={get(t,s){if(s===Gl)return t;const r=Zm(t);if(!sA(r,s))return a6e(t,r,s);const a=r[s];return t.finalized_||!Zd(a)?a:a===Ok(t.base_,s)?(Rk(t),t.copy_[s]=lA(a,t)):a},has(t,s){return s in Zm(t)},ownKeys(t){return Reflect.ownKeys(Zm(t))},set(t,s,r){const a=GZ(Zm(t),s);if(a!=null&&a.set)return a.set.call(t.draft_,r),!0;if(!t.modified_){const i=Ok(Zm(t),s),l=i==null?void 0:i[Gl];if(l&&l.base_===r)return t.copy_[s]=r,t.assigned_[s]=!1,!0;if(JRe(r,i)&&(r!==void 0||sA(t.base_,s)))return!0;Rk(t),iA(t)}return t.copy_[s]===r&&(r!==void 0||s in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[s])||(t.copy_[s]=r,t.assigned_[s]=!0),!0},deleteProperty(t,s){return Ok(t.base_,s)!==void 0||s in t.base_?(t.assigned_[s]=!1,Rk(t),iA(t)):delete t.assigned_[s],t.copy_&&delete t.copy_[s],!0},getOwnPropertyDescriptor(t,s){const r=Zm(t),a=Reflect.getOwnPropertyDescriptor(r,s);return a&&{writable:!0,configurable:t.type_!==1||s!=="length",enumerable:a.enumerable,value:r[s]}},defineProperty(){nc(11)},getPrototypeOf(t){return Ib(t.base_)},setPrototypeOf(){nc(12)}},Rb={};HN(CD,(t,s)=>{Rb[t]=function(){return arguments[0]=arguments[0][0],s.apply(this,arguments)}});Rb.deleteProperty=function(t,s){return Rb.set.call(this,t,s,void 0)};Rb.set=function(t,s,r){return CD.set.call(this,t[0],s,r,t[0])};function Ok(t,s){const r=t[Gl];return(r?Zm(r):t)[s]}function a6e(t,s,r){var i;const a=GZ(s,r);return a?"value"in a?a.value:(i=a.get)==null?void 0:i.call(t.draft_):void 0}function GZ(t,s){if(!(s in t))return;let r=Ib(t);for(;r;){const a=Object.getOwnPropertyDescriptor(r,s);if(a)return a;r=Ib(r)}}function iA(t){t.modified_||(t.modified_=!0,t.parent_&&iA(t.parent_))}function Rk(t){t.copy_||(t.copy_=nA(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var i6e=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(s,r,a)=>{if(typeof s=="function"&&typeof r!="function"){const l=r;r=s;const o=this;return function(d=l,...u){return o.produce(d,m=>r.call(this,m,...u))}}typeof r!="function"&&nc(6),a!==void 0&&typeof a!="function"&&nc(7);let i;if(Zd(s)){const l=L7(this),o=lA(s,void 0);let c=!0;try{i=r(o),c=!1}finally{c?rA(l):aA(l)}return R7(l,a),F7(i,l)}else if(!s||typeof s!="object"){if(i=r(s),i===void 0&&(i=s),i===VZ&&(i=void 0),this.autoFreeze_&&SD(i,!0),a){const l=[],o=[];nx("Patches").generateReplacementPatches_(s,i,l,o),a(l,o)}return i}else nc(1,s)},this.produceWithPatches=(s,r)=>{if(typeof s=="function")return(o,...c)=>this.produceWithPatches(o,d=>s(d,...c));let a,i;return[this.produce(s,r,(o,c)=>{a=o,i=c}),a,i]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy),typeof(t==null?void 0:t.useStrictIteration)=="boolean"&&this.setUseStrictIteration(t.useStrictIteration)}createDraft(t){Zd(t)||nc(8),sx(t)&&(t=zd(t));const s=L7(this),r=lA(t,void 0);return r[Gl].isManual_=!0,aA(s),r}finishDraft(t,s){const r=t&&t[Gl];(!r||!r.isManual_)&&nc(9);const{scope_:a}=r;return R7(a,s),F7(void 0,a)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}setUseStrictIteration(t){this.useStrictIteration_=t}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(t,s){let r;for(r=s.length-1;r>=0;r--){const i=s[r];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}r>-1&&(s=s.slice(r+1));const a=nx("Patches").applyPatches_;return sx(t)?a(t,s):this.produce(t,i=>a(i,s))}};function lA(t,s){const r=vy(t)?nx("MapSet").proxyMap_(t,s):p_(t)?nx("MapSet").proxySet_(t,s):r6e(t,s);return(s?s.scope_:qZ()).drafts_.push(r),r}function zd(t){return sx(t)||nc(10,t),KZ(t)}function KZ(t){if(!Zd(t)||f_(t))return t;const s=t[Gl];let r,a=!0;if(s){if(!s.modified_)return s.base_;s.finalized_=!0,r=nA(t,s.scope_.immer_.useStrictShallowCopy_),a=s.scope_.immer_.shouldUseStrictIteration()}else r=nA(t,!0);return HN(r,(i,l)=>{WZ(r,i,KZ(l))},a),s&&(s.finalized_=!1),r}var oA=new i6e,YZ=oA.produce,l6e=oA.setUseStrictIteration.bind(oA);function XZ(t){return({dispatch:r,getState:a})=>i=>l=>typeof l=="function"?l(r,a,t):i(l)}var o6e=XZ(),c6e=XZ,d6e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?VN:VN.apply(null,arguments)};function Io(t,s){function r(...a){if(s){let i=s(...a);if(!i)throw new Error(Ul(0));return{type:t,payload:i.payload,..."meta"in i&&{meta:i.meta},..."error"in i&&{error:i.error}}}return{type:t,payload:a[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=a=>UZ(a)&&a.type===t,r}var QZ=class lg extends Array{constructor(...s){super(...s),Object.setPrototypeOf(this,lg.prototype)}static get[Symbol.species](){return lg}concat(...s){return super.concat.apply(this,s)}prepend(...s){return s.length===1&&Array.isArray(s[0])?new lg(...s[0].concat(this)):new lg(...s.concat(this))}};function $7(t){return Zd(t)?YZ(t,()=>{}):t}function iv(t,s,r){return t.has(s)?t.get(s):t.set(s,r(s)).get(s)}function u6e(t){return typeof t=="boolean"}var m6e=()=>function(s){const{thunk:r=!0,immutableCheck:a=!0,serializableCheck:i=!0,actionCreatorCheck:l=!0}=s??{};let o=new QZ;return r&&(u6e(r)?o.push(o6e):o.push(c6e(r.extraArgument))),o},ZZ="RTK_autoBatch",oa=()=>t=>({payload:t,meta:{[ZZ]:!0}}),z7=t=>s=>{setTimeout(s,t)},JZ=(t={type:"raf"})=>s=>(...r)=>{const a=s(...r);let i=!0,l=!1,o=!1;const c=new Set,d=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:z7(10):t.type==="callback"?t.queueNotification:z7(t.timeout),u=()=>{o=!1,l&&(l=!1,c.forEach(m=>m()))};return Object.assign({},a,{subscribe(m){const x=()=>i&&m(),g=a.subscribe(x);return c.add(m),()=>{g(),c.delete(m)}},dispatch(m){var x;try{return i=!((x=m==null?void 0:m.meta)!=null&&x[ZZ]),l=!i,l&&(o||(o=!0,d(u))),a.dispatch(m)}finally{i=!0}}})},h6e=t=>function(r){const{autoBatch:a=!0}=r??{};let i=new QZ(t);return a&&i.push(JZ(typeof a=="object"?a:void 0)),i};function x6e(t){const s=m6e(),{reducer:r=void 0,middleware:a,devTools:i=!0,preloadedState:l=void 0,enhancers:o=void 0}=t||{};let c;if(typeof r=="function")c=r;else if(_D(r))c=zZ(r);else throw new Error(Ul(1));let d;typeof a=="function"?d=a(s):d=s();let u=VN;i&&(u=d6e({trace:!1,...typeof i=="object"&&i}));const m=QRe(...d),x=h6e(m);let g=typeof o=="function"?o(x):x();const y=u(...g);return $Z(c,l,y)}function eJ(t){const s={},r=[];let a;const i={addCase(l,o){const c=typeof l=="string"?l:l.type;if(!c)throw new Error(Ul(28));if(c in s)throw new Error(Ul(29));return s[c]=o,i},addAsyncThunk(l,o){return o.pending&&(s[l.pending.type]=o.pending),o.rejected&&(s[l.rejected.type]=o.rejected),o.fulfilled&&(s[l.fulfilled.type]=o.fulfilled),o.settled&&r.push({matcher:l.settled,reducer:o.settled}),i},addMatcher(l,o){return r.push({matcher:l,reducer:o}),i},addDefaultCase(l){return a=l,i}};return t(i),[s,r,a]}l6e(!1);function p6e(t){return typeof t=="function"}function f6e(t,s){let[r,a,i]=eJ(s),l;if(p6e(t))l=()=>$7(t());else{const c=$7(t);l=()=>c}function o(c=l(),d){let u=[r[d.type],...a.filter(({matcher:m})=>m(d)).map(({reducer:m})=>m)];return u.filter(m=>!!m).length===0&&(u=[i]),u.reduce((m,x)=>{if(x)if(sx(m)){const y=x(m,d);return y===void 0?m:y}else{if(Zd(m))return YZ(m,g=>x(g,d));{const g=x(m,d);if(g===void 0){if(m===null)return m;throw Error("A case reducer on a non-draftable value must not return undefined")}return g}}return m},c)}return o.getInitialState=l,o}var g6e="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",b6e=(t=21)=>{let s="",r=t;for(;r--;)s+=g6e[Math.random()*64|0];return s},y6e=Symbol.for("rtk-slice-createasyncthunk");function v6e(t,s){return`${t}/${s}`}function j6e({creators:t}={}){var r;const s=(r=t==null?void 0:t.asyncThunk)==null?void 0:r[y6e];return function(i){const{name:l,reducerPath:o=l}=i;if(!l)throw new Error(Ul(11));const c=(typeof i.reducers=="function"?i.reducers(w6e()):i.reducers)||{},d=Object.keys(c),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},m={addCase(A,I){const P=typeof A=="string"?A:A.type;if(!P)throw new Error(Ul(12));if(P in u.sliceCaseReducersByType)throw new Error(Ul(13));return u.sliceCaseReducersByType[P]=I,m},addMatcher(A,I){return u.sliceMatchers.push({matcher:A,reducer:I}),m},exposeAction(A,I){return u.actionCreators[A]=I,m},exposeCaseReducer(A,I){return u.sliceCaseReducersByName[A]=I,m}};d.forEach(A=>{const I=c[A],P={reducerName:A,type:v6e(l,A),createNotation:typeof i.reducers=="function"};S6e(I)?k6e(P,I,m,s):_6e(P,I,m)});function x(){const[A={},I=[],P=void 0]=typeof i.extraReducers=="function"?eJ(i.extraReducers):[i.extraReducers],O={...A,...u.sliceCaseReducersByType};return f6e(i.initialState,D=>{for(let T in O)D.addCase(T,O[T]);for(let T of u.sliceMatchers)D.addMatcher(T.matcher,T.reducer);for(let T of I)D.addMatcher(T.matcher,T.reducer);P&&D.addDefaultCase(P)})}const g=A=>A,y=new Map,v=new WeakMap;let j;function w(A,I){return j||(j=x()),j(A,I)}function S(){return j||(j=x()),j.getInitialState()}function E(A,I=!1){function P(D){let T=D[A];return typeof T>"u"&&I&&(T=iv(v,P,S)),T}function O(D=g){const T=iv(y,I,()=>new WeakMap);return iv(T,D,()=>{const B={};for(const[U,W]of Object.entries(i.selectors??{}))B[U]=N6e(W,D,()=>iv(v,D,S),I);return B})}return{reducerPath:A,getSelectors:O,get selectors(){return O(P)},selectSlice:P}}const k={name:l,reducer:w,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:S,...E(o),injectInto(A,{reducerPath:I,...P}={}){const O=I??o;return A.inject({reducerPath:O,reducer:w},P),{...k,...E(O,!0)}}};return k}}function N6e(t,s,r,a){function i(l,...o){let c=s(l);return typeof c>"u"&&a&&(c=r()),t(c,...o)}return i.unwrapped=t,i}var gl=j6e();function w6e(){function t(s,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:s,...r}}return t.withTypes=()=>t,{reducer(s){return Object.assign({[s.name](...r){return s(...r)}}[s.name],{_reducerDefinitionType:"reducer"})},preparedReducer(s,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:s,reducer:r}},asyncThunk:t}}function _6e({type:t,reducerName:s,createNotation:r},a,i){let l,o;if("reducer"in a){if(r&&!C6e(a))throw new Error(Ul(17));l=a.reducer,o=a.prepare}else l=a;i.addCase(t,l).exposeCaseReducer(s,l).exposeAction(s,o?Io(t,o):Io(t))}function S6e(t){return t._reducerDefinitionType==="asyncThunk"}function C6e(t){return t._reducerDefinitionType==="reducerWithPrepare"}function k6e({type:t,reducerName:s},r,a,i){if(!i)throw new Error(Ul(18));const{payloadCreator:l,fulfilled:o,pending:c,rejected:d,settled:u,options:m}=r,x=i(t,l,m);a.exposeAction(s,x),o&&a.addCase(x.fulfilled,o),c&&a.addCase(x.pending,c),d&&a.addCase(x.rejected,d),u&&a.addMatcher(x.settled,u),a.exposeCaseReducer(s,{fulfilled:o||lv,pending:c||lv,rejected:d||lv,settled:u||lv})}function lv(){}var A6e="task",tJ="listener",sJ="completed",kD="cancelled",E6e=`task-${kD}`,T6e=`task-${sJ}`,cA=`${tJ}-${kD}`,P6e=`${tJ}-${sJ}`,g_=class{constructor(t){SS(this,"name","TaskAbortError");SS(this,"message");this.code=t,this.message=`${A6e} ${kD} (reason: ${t})`}},AD=(t,s)=>{if(typeof t!="function")throw new TypeError(Ul(32))},GN=()=>{},nJ=(t,s=GN)=>(t.catch(s),t),rJ=(t,s)=>(t.addEventListener("abort",s,{once:!0}),()=>t.removeEventListener("abort",s)),Dh=(t,s)=>{const r=t.signal;r.aborted||("reason"in r||Object.defineProperty(r,"reason",{enumerable:!0,value:s,configurable:!0,writable:!0}),t.abort(s))},Mh=t=>{if(t.aborted){const{reason:s}=t;throw new g_(s)}};function aJ(t,s){let r=GN;return new Promise((a,i)=>{const l=()=>i(new g_(t.reason));if(t.aborted){l();return}r=rJ(t,l),s.finally(()=>r()).then(a,i)}).finally(()=>{r=GN})}var D6e=async(t,s)=>{try{return await Promise.resolve(),{status:"ok",value:await t()}}catch(r){return{status:r instanceof g_?"cancelled":"rejected",error:r}}finally{s==null||s()}},KN=t=>s=>nJ(aJ(t,s).then(r=>(Mh(t),r))),iJ=t=>{const s=KN(t);return r=>s(new Promise(a=>setTimeout(a,r)))},{assign:Bp}=Object,U7={},b_="listenerMiddleware",M6e=(t,s)=>{const r=a=>rJ(t,()=>Dh(a,t.reason));return(a,i)=>{AD(a);const l=new AbortController;r(l);const o=D6e(async()=>{Mh(t),Mh(l.signal);const c=await a({pause:KN(l.signal),delay:iJ(l.signal),signal:l.signal});return Mh(l.signal),c},()=>Dh(l,T6e));return i!=null&&i.autoJoin&&s.push(o.catch(GN)),{result:KN(t)(o),cancel(){Dh(l,E6e)}}}},I6e=(t,s)=>{const r=async(a,i)=>{Mh(s);let l=()=>{};const c=[new Promise((d,u)=>{let m=t({predicate:a,effect:(x,g)=>{g.unsubscribe(),d([x,g.getState(),g.getOriginalState()])}});l=()=>{m(),u()}})];i!=null&&c.push(new Promise(d=>setTimeout(d,i,null)));try{const d=await aJ(s,Promise.race(c));return Mh(s),d}finally{l()}};return(a,i)=>nJ(r(a,i))},lJ=t=>{let{type:s,actionCreator:r,matcher:a,predicate:i,effect:l}=t;if(s)i=Io(s).match;else if(r)s=r.type,i=r.match;else if(a)i=a;else if(!i)throw new Error(Ul(21));return AD(l),{predicate:i,type:s,effect:l}},oJ=Bp(t=>{const{type:s,predicate:r,effect:a}=lJ(t);return{id:b6e(),effect:a,type:s,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(Ul(22))}}},{withTypes:()=>oJ}),V7=(t,s)=>{const{type:r,effect:a,predicate:i}=lJ(s);return Array.from(t.values()).find(l=>(typeof r=="string"?l.type===r:l.predicate===i)&&l.effect===a)},dA=t=>{t.pending.forEach(s=>{Dh(s,cA)})},O6e=(t,s)=>()=>{for(const r of s.keys())dA(r);t.clear()},H7=(t,s,r)=>{try{t(s,r)}catch(a){setTimeout(()=>{throw a},0)}},cJ=Bp(Io(`${b_}/add`),{withTypes:()=>cJ}),R6e=Io(`${b_}/removeAll`),dJ=Bp(Io(`${b_}/remove`),{withTypes:()=>dJ}),L6e=(...t)=>{console.error(`${b_}/error`,...t)},jy=(t={})=>{const s=new Map,r=new Map,a=y=>{const v=r.get(y)??0;r.set(y,v+1)},i=y=>{const v=r.get(y)??1;v===1?r.delete(y):r.set(y,v-1)},{extra:l,onError:o=L6e}=t;AD(o);const c=y=>(y.unsubscribe=()=>s.delete(y.id),s.set(y.id,y),v=>{y.unsubscribe(),v!=null&&v.cancelActive&&dA(y)}),d=y=>{const v=V7(s,y)??oJ(y);return c(v)};Bp(d,{withTypes:()=>d});const u=y=>{const v=V7(s,y);return v&&(v.unsubscribe(),y.cancelActive&&dA(v)),!!v};Bp(u,{withTypes:()=>u});const m=async(y,v,j,w)=>{const S=new AbortController,E=I6e(d,S.signal),k=[];try{y.pending.add(S),a(y),await Promise.resolve(y.effect(v,Bp({},j,{getOriginalState:w,condition:(A,I)=>E(A,I).then(Boolean),take:E,delay:iJ(S.signal),pause:KN(S.signal),extra:l,signal:S.signal,fork:M6e(S.signal,k),unsubscribe:y.unsubscribe,subscribe:()=>{s.set(y.id,y)},cancelActiveListeners:()=>{y.pending.forEach((A,I,P)=>{A!==S&&(Dh(A,cA),P.delete(A))})},cancel:()=>{Dh(S,cA),y.pending.delete(S)},throwIfCancelled:()=>{Mh(S.signal)}})))}catch(A){A instanceof g_||H7(o,A,{raisedBy:"effect"})}finally{await Promise.all(k),Dh(S,P6e),i(y),y.pending.delete(S)}},x=O6e(s,r);return{middleware:y=>v=>j=>{if(!UZ(j))return v(j);if(cJ.match(j))return d(j.payload);if(R6e.match(j)){x();return}if(dJ.match(j))return u(j.payload);let w=y.getState();const S=()=>{if(w===U7)throw new Error(Ul(23));return w};let E;try{if(E=v(j),s.size>0){const k=y.getState(),A=Array.from(s.values());for(const I of A){let P=!1;try{P=I.predicate(j,k,w)}catch(O){P=!1,H7(o,O,{raisedBy:"predicate"})}P&&m(I,j,y,S)}}}finally{w=U7}return E},startListening:d,stopListening:u,clearListeners:x}};function Ul(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var F6e={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},uJ=gl({name:"chartLayout",initialState:F6e,reducers:{setLayout(t,s){t.layoutType=s.payload},setChartSize(t,s){t.width=s.payload.width,t.height=s.payload.height},setMargin(t,s){var r,a,i,l;t.margin.top=(r=s.payload.top)!==null&&r!==void 0?r:0,t.margin.right=(a=s.payload.right)!==null&&a!==void 0?a:0,t.margin.bottom=(i=s.payload.bottom)!==null&&i!==void 0?i:0,t.margin.left=(l=s.payload.left)!==null&&l!==void 0?l:0},setScale(t,s){t.scale=s.payload}}}),{setMargin:B6e,setLayout:$6e,setChartSize:z6e,setScale:U6e}=uJ.actions,V6e=uJ.reducer;function mJ(t,s,r){return Array.isArray(t)&&t&&s+r!==0?t.slice(s,r+1):t}function W7(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function _p(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?W7(Object(r),!0).forEach(function(a){H6e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):W7(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function H6e(t,s,r){return(s=W6e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function W6e(t){var s=q6e(t,"string");return typeof s=="symbol"?s:s+""}function q6e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function ar(t,s,r){return Sa(t)||Sa(s)?r:dd(s)?tx(t,s,r):typeof s=="function"?s(t):r}var G6e=(t,s,r)=>{if(s&&r){var{width:a,height:i}=r,{align:l,verticalAlign:o,layout:c}=s;if((c==="vertical"||c==="horizontal"&&o==="middle")&&l!=="center"&&as(t[l]))return _p(_p({},t),{},{[l]:t[l]+(a||0)});if((c==="horizontal"||c==="vertical"&&l==="center")&&o!=="middle"&&as(t[o]))return _p(_p({},t),{},{[o]:t[o]+(i||0)})}return t},vx=(t,s)=>t==="horizontal"&&s==="xAxis"||t==="vertical"&&s==="yAxis"||t==="centric"&&s==="angleAxis"||t==="radial"&&s==="radiusAxis",q7=1e-4,K6e=t=>{var s=t.domain();if(!(!s||s.length<=2)){var r=s.length,a=t.range(),i=Math.min(a[0],a[1])-q7,l=Math.max(a[0],a[1])+q7,o=t(s[0]),c=t(s[r-1]);(o<i||o>l||c<i||c>l)&&t.domain([s[0],s[r-1]])}},Y6e=(t,s)=>{if(!s||s.length!==2||!as(s[0])||!as(s[1]))return t;var r=Math.min(s[0],s[1]),a=Math.max(s[0],s[1]),i=[t[0],t[1]];return(!as(t[0])||t[0]<r)&&(i[0]=r),(!as(t[1])||t[1]>a)&&(i[1]=a),i[0]>a&&(i[0]=a),i[1]<r&&(i[1]=r),i},X6e=t=>{var s=t.length;if(!(s<=0))for(var r=0,a=t[0].length;r<a;++r)for(var i=0,l=0,o=0;o<s;++o){var c=cd(t[o][r][1])?t[o][r][0]:t[o][r][1];c>=0?(t[o][r][0]=i,t[o][r][1]=i+c,i=t[o][r][1]):(t[o][r][0]=l,t[o][r][1]=l+c,l=t[o][r][1])}},Q6e=t=>{var s=t.length;if(!(s<=0))for(var r=0,a=t[0].length;r<a;++r)for(var i=0,l=0;l<s;++l){var o=cd(t[l][r][1])?t[l][r][0]:t[l][r][1];o>=0?(t[l][r][0]=i,t[l][r][1]=i+o,i=t[l][r][1]):(t[l][r][0]=0,t[l][r][1]=0)}},Z6e={sign:X6e,expand:iRe,none:df,silhouette:lRe,wiggle:oRe,positive:Q6e},J6e=(t,s,r)=>{var a=Z6e[r],i=aRe().keys(s).value((l,o)=>Number(ar(l,o,0))).order(eA).offset(a);return i(t)};function e8e(t){return t==null?void 0:String(t)}var G7=t=>{var{axis:s,ticks:r,offset:a,bandSize:i,entry:l,index:o}=t;if(s.type==="category")return r[o]?r[o].coordinate+a:null;var c=ar(l,s.dataKey,s.scale.domain()[o]);return Sa(c)?null:s.scale(c)-i/2+a},t8e=t=>{var{numericAxis:s}=t,r=s.scale.domain();if(s.type==="number"){var a=Math.min(r[0],r[1]),i=Math.max(r[0],r[1]);return a<=0&&i>=0?0:i<0?i:a}return r[0]},s8e=t=>{var s=t.flat(2).filter(as);return[Math.min(...s),Math.max(...s)]},n8e=t=>[t[0]===1/0?0:t[0],t[1]===-1/0?0:t[1]],r8e=(t,s,r)=>{if(t!=null)return n8e(Object.keys(t).reduce((a,i)=>{var l=t[i],{stackedData:o}=l,c=o.reduce((d,u)=>{var m=mJ(u,s,r),x=s8e(m);return[Math.min(d[0],x[0]),Math.max(d[1],x[1])]},[1/0,-1/0]);return[Math.min(c[0],a[0]),Math.max(c[1],a[1])]},[1/0,-1/0]))},K7=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Y7=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,YN=(t,s,r)=>{if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!r||a>0)return a}if(t&&s&&s.length>=2){for(var i=h_(s,m=>m.coordinate),l=1/0,o=1,c=i.length;o<c;o++){var d=i[o],u=i[o-1];l=Math.min((d.coordinate||0)-(u.coordinate||0),l)}return l===1/0?0:l}return r?void 0:0};function X7(t){var{tooltipEntrySettings:s,dataKey:r,payload:a,value:i,name:l}=t;return _p(_p({},s),{},{dataKey:r,payload:a,value:i,name:l})}function y_(t,s){if(t)return String(t);if(typeof s=="string")return s}var a8e=(t,s)=>{if(s==="horizontal")return t.chartX;if(s==="vertical")return t.chartY},i8e=(t,s)=>s==="centric"?t.angle:t.radius,ou=t=>t.layout.width,cu=t=>t.layout.height,l8e=t=>t.layout.scale,hJ=t=>t.layout.margin,v_=Je(t=>t.cartesianAxis.xAxis,t=>Object.values(t)),j_=Je(t=>t.cartesianAxis.yAxis,t=>Object.values(t)),xJ="data-recharts-item-index",pJ="data-recharts-item-data-key",Ny=60;function Q7(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function ov(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?Q7(Object(r),!0).forEach(function(a){o8e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Q7(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function o8e(t,s,r){return(s=c8e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function c8e(t){var s=d8e(t,"string");return typeof s=="symbol"?s:s+""}function d8e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var u8e=t=>t.brush.height;function m8e(t){var s=j_(t);return s.reduce((r,a)=>{if(a.orientation==="left"&&!a.mirror&&!a.hide){var i=typeof a.width=="number"?a.width:Ny;return r+i}return r},0)}function h8e(t){var s=j_(t);return s.reduce((r,a)=>{if(a.orientation==="right"&&!a.mirror&&!a.hide){var i=typeof a.width=="number"?a.width:Ny;return r+i}return r},0)}function x8e(t){var s=v_(t);return s.reduce((r,a)=>a.orientation==="top"&&!a.mirror&&!a.hide?r+a.height:r,0)}function p8e(t){var s=v_(t);return s.reduce((r,a)=>a.orientation==="bottom"&&!a.mirror&&!a.hide?r+a.height:r,0)}var ha=Je([ou,cu,hJ,u8e,m8e,h8e,x8e,p8e,BZ,WRe],(t,s,r,a,i,l,o,c,d,u)=>{var m={left:(r.left||0)+i,right:(r.right||0)+l},x={top:(r.top||0)+o,bottom:(r.bottom||0)+c},g=ov(ov({},x),m),y=g.bottom;g.bottom+=a,g=G6e(g,d,u);var v=t-g.left-g.right,j=s-g.top-g.bottom;return ov(ov({brushBottom:y},g),{},{width:Math.max(v,0),height:Math.max(j,0)})}),f8e=Je(ha,t=>({x:t.left,y:t.top,width:t.width,height:t.height})),ED=Je(ou,cu,(t,s)=>({x:0,y:0,width:t,height:s})),g8e=p.createContext(null),Xl=()=>p.useContext(g8e)!=null,N_=t=>t.brush,w_=Je([N_,ha,hJ],(t,s,r)=>({height:t.height,x:as(t.x)?t.x:s.left,y:as(t.y)?t.y:s.top+s.height+s.brushBottom-((r==null?void 0:r.bottom)||0),width:as(t.width)?t.width:s.width})),fJ={},gJ={},bJ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r,a,{signal:i,edges:l}={}){let o,c=null;const d=l!=null&&l.includes("leading"),u=l==null||l.includes("trailing"),m=()=>{c!==null&&(r.apply(o,c),o=void 0,c=null)},x=()=>{u&&m(),j()};let g=null;const y=()=>{g!=null&&clearTimeout(g),g=setTimeout(()=>{g=null,x()},a)},v=()=>{g!==null&&(clearTimeout(g),g=null)},j=()=>{v(),o=void 0,c=null},w=()=>{m()},S=function(...E){if(i!=null&&i.aborted)return;o=this,c=E;const k=g==null;y(),d&&k&&m()};return S.schedule=y,S.cancel=j,S.flush=w,i==null||i.addEventListener("abort",j,{once:!0}),S}t.debounce=s})(bJ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=bJ;function r(a,i=0,l={}){typeof l!="object"&&(l={});const{leading:o=!1,trailing:c=!0,maxWait:d}=l,u=Array(2);o&&(u[0]="leading"),c&&(u[1]="trailing");let m,x=null;const g=s.debounce(function(...j){m=a.apply(this,j),x=null},i,{edges:u}),y=function(...j){return d!=null&&(x===null&&(x=Date.now()),Date.now()-x>=d)?(m=a.apply(this,j),x=Date.now(),g.cancel(),g.schedule(),m):(g.apply(this,j),m)},v=()=>(g.flush(),m);return y.cancel=g.cancel,y.flush=v,y}t.debounce=r})(gJ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=gJ;function r(a,i=0,l={}){const{leading:o=!0,trailing:c=!0}=l;return s.debounce(a,i,{leading:o,maxWait:i,trailing:c})}t.throttle=r})(fJ);var b8e=fJ.throttle;const y8e=Ro(b8e);var Z7=function(s,r){for(var a=arguments.length,i=new Array(a>2?a-2:0),l=2;l<a;l++)i[l-2]=arguments[l]},yJ=(t,s,r)=>{var{width:a="100%",height:i="100%",aspect:l,maxHeight:o}=r,c=Qd(a)?t:Number(a),d=Qd(i)?s:Number(i);return l&&l>0&&(c?d=c/l:d&&(c=d*l),o&&d!=null&&d>o&&(d=o)),{calculatedWidth:c,calculatedHeight:d}},v8e={width:0,height:0,overflow:"visible"},j8e={width:0,overflowX:"visible"},N8e={height:0,overflowY:"visible"},w8e={},_8e=t=>{var{width:s,height:r}=t,a=Qd(s),i=Qd(r);return a&&i?v8e:a?j8e:i?N8e:w8e};function S8e(t){var{width:s,height:r,aspect:a}=t,i=s,l=r;return i===void 0&&l===void 0?(i="100%",l="100%"):i===void 0?i=a&&a>0?void 0:"100%":l===void 0&&(l=a&&a>0?void 0:"100%"),{width:i,height:l}}function Mr(t){return Number.isFinite(t)}function ym(t){return typeof t=="number"&&t>0&&Number.isFinite(t)}function uA(){return uA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},uA.apply(null,arguments)}function J7(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function e9(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?J7(Object(r),!0).forEach(function(a){C8e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):J7(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function C8e(t,s,r){return(s=k8e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function k8e(t){var s=A8e(t,"string");return typeof s=="symbol"?s:s+""}function A8e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var vJ=p.createContext({width:-1,height:-1});function E8e(t){return ym(t.width)&&ym(t.height)}function jJ(t){var{children:s,width:r,height:a}=t,i=p.useMemo(()=>({width:r,height:a}),[r,a]);return E8e(i)?p.createElement(vJ.Provider,{value:i},s):null}var TD=()=>p.useContext(vJ),T8e=p.forwardRef((t,s)=>{var{aspect:r,initialDimension:a={width:-1,height:-1},width:i,height:l,minWidth:o=0,minHeight:c,maxHeight:d,children:u,debounce:m=0,id:x,className:g,onResize:y,style:v={}}=t,j=p.useRef(null),w=p.useRef();w.current=y,p.useImperativeHandle(s,()=>j.current);var[S,E]=p.useState({containerWidth:a.width,containerHeight:a.height}),k=p.useCallback((D,T)=>{E(B=>{var U=Math.round(D),W=Math.round(T);return B.containerWidth===U&&B.containerHeight===W?B:{containerWidth:U,containerHeight:W}})},[]);p.useEffect(()=>{if(j.current==null||typeof ResizeObserver>"u")return yx;var D=W=>{var V,{width:R,height:F}=W[0].contentRect;k(R,F),(V=w.current)===null||V===void 0||V.call(w,R,F)};m>0&&(D=y8e(D,m,{trailing:!0,leading:!1}));var T=new ResizeObserver(D),{width:B,height:U}=j.current.getBoundingClientRect();return k(B,U),T.observe(j.current),()=>{T.disconnect()}},[k,m]);var{containerWidth:A,containerHeight:I}=S;Z7(!r||r>0,"The aspect(%s) must be greater than zero.",r);var{calculatedWidth:P,calculatedHeight:O}=yJ(A,I,{width:i,height:l,aspect:r,maxHeight:d});return Z7(P!=null&&P>0||O!=null&&O>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,P,O,i,l,o,c,r),p.createElement("div",{id:x?"".concat(x):void 0,className:mn("recharts-responsive-container",g),style:e9(e9({},v),{},{width:i,height:l,minWidth:o,minHeight:c,maxHeight:d}),ref:j},p.createElement("div",{style:_8e({width:i,height:l})},p.createElement(jJ,{width:P,height:O},u)))}),mh=p.forwardRef((t,s)=>{var r=TD();if(ym(r.width)&&ym(r.height))return t.children;var{width:a,height:i}=S8e({width:t.width,height:t.height,aspect:t.aspect}),{calculatedWidth:l,calculatedHeight:o}=yJ(void 0,void 0,{width:a,height:i,aspect:t.aspect,maxHeight:t.maxHeight});return as(l)&&as(o)?p.createElement(jJ,{width:l,height:o},t.children):p.createElement(T8e,uA({},t,{width:a,height:i,ref:s}))});function NJ(t){if(t)return{x:t.x,y:t.y,upperWidth:"upperWidth"in t?t.upperWidth:t.width,lowerWidth:"lowerWidth"in t?t.lowerWidth:t.width,width:t.width,height:t.height}}var __=()=>{var t,s=Xl(),r=es(f8e),a=es(w_),i=(t=es(N_))===null||t===void 0?void 0:t.padding;return!s||!a||!i?r:{width:a.width-i.left-i.right,height:a.height-i.top-i.bottom,x:i.left,y:i.top}},P8e={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},D8e=()=>{var t;return(t=es(ha))!==null&&t!==void 0?t:P8e},M8e=()=>es(ou),I8e=()=>es(cu),an=t=>t.layout.layoutType,S_=()=>es(an),O8e=()=>{var t=S_();return t!==void 0},C_=t=>{var s=Qn(),r=Xl(),{width:a,height:i}=t,l=TD(),o=a,c=i;return l&&(o=l.width>0?l.width:a,c=l.height>0?l.height:i),p.useEffect(()=>{!r&&ym(o)&&ym(c)&&s(z6e({width:o,height:c}))},[s,r,o,c]),null},R8e={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},wJ=gl({name:"legend",initialState:R8e,reducers:{setLegendSize(t,s){t.size.width=s.payload.width,t.size.height=s.payload.height},setLegendSettings(t,s){t.settings.align=s.payload.align,t.settings.layout=s.payload.layout,t.settings.verticalAlign=s.payload.verticalAlign,t.settings.itemSorter=s.payload.itemSorter},addLegendPayload:{reducer(t,s){t.payload.push(s.payload)},prepare:oa()},removeLegendPayload:{reducer(t,s){var r=zd(t).payload.indexOf(s.payload);r>-1&&t.payload.splice(r,1)},prepare:oa()}}}),{setLegendSize:YZe,setLegendSettings:XZe,addLegendPayload:_J,removeLegendPayload:SJ}=wJ.actions,L8e=wJ.reducer;function mA(){return mA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},mA.apply(null,arguments)}function t9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function Lk(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?t9(Object(r),!0).forEach(function(a){F8e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):t9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function F8e(t,s,r){return(s=B8e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function B8e(t){var s=$8e(t,"string");return typeof s=="symbol"?s:s+""}function $8e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function z8e(t){return Array.isArray(t)&&dd(t[0])&&dd(t[1])?t.join(" ~ "):t}var U8e=t=>{var{separator:s=" : ",contentStyle:r={},itemStyle:a={},labelStyle:i={},payload:l,formatter:o,itemSorter:c,wrapperClassName:d,labelClassName:u,label:m,labelFormatter:x,accessibilityLayer:g=!1}=t,y=()=>{if(l&&l.length){var I={padding:0,margin:0},P=(c?h_(l,c):l).map((O,D)=>{if(O.type==="none")return null;var T=O.formatter||o||z8e,{value:B,name:U}=O,W=B,V=U;if(T){var R=T(B,U,O,D,l);if(Array.isArray(R))[W,V]=R;else if(R!=null)W=R;else return null}var F=Lk({display:"block",paddingTop:4,paddingBottom:4,color:O.color||"#000"},a);return p.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(D),style:F},dd(V)?p.createElement("span",{className:"recharts-tooltip-item-name"},V):null,dd(V)?p.createElement("span",{className:"recharts-tooltip-item-separator"},s):null,p.createElement("span",{className:"recharts-tooltip-item-value"},W),p.createElement("span",{className:"recharts-tooltip-item-unit"},O.unit||""))});return p.createElement("ul",{className:"recharts-tooltip-item-list",style:I},P)}return null},v=Lk({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},r),j=Lk({margin:0},i),w=!Sa(m),S=w?m:"",E=mn("recharts-default-tooltip",d),k=mn("recharts-tooltip-label",u);w&&x&&l!==void 0&&l!==null&&(S=x(m,l));var A=g?{role:"status","aria-live":"assertive"}:{};return p.createElement("div",mA({className:E,style:v},A),p.createElement("p",{className:k,style:j},p.isValidElement(S)?S:"".concat(S)),y())},A0="recharts-tooltip-wrapper",V8e={visibility:"hidden"};function H8e(t){var{coordinate:s,translateX:r,translateY:a}=t;return mn(A0,{["".concat(A0,"-right")]:as(r)&&s&&as(s.x)&&r>=s.x,["".concat(A0,"-left")]:as(r)&&s&&as(s.x)&&r<s.x,["".concat(A0,"-bottom")]:as(a)&&s&&as(s.y)&&a>=s.y,["".concat(A0,"-top")]:as(a)&&s&&as(s.y)&&a<s.y})}function s9(t){var{allowEscapeViewBox:s,coordinate:r,key:a,offsetTopLeft:i,position:l,reverseDirection:o,tooltipDimension:c,viewBox:d,viewBoxDimension:u}=t;if(l&&as(l[a]))return l[a];var m=r[a]-c-(i>0?i:0),x=r[a]+i;if(s[a])return o[a]?m:x;var g=d[a];if(g==null)return 0;if(o[a]){var y=m,v=g;return y<v?Math.max(x,g):Math.max(m,g)}if(u==null)return 0;var j=x+c,w=g+u;return j>w?Math.max(m,g):Math.max(x,g)}function W8e(t){var{translateX:s,translateY:r,useTranslate3d:a}=t;return{transform:a?"translate3d(".concat(s,"px, ").concat(r,"px, 0)"):"translate(".concat(s,"px, ").concat(r,"px)")}}function q8e(t){var{allowEscapeViewBox:s,coordinate:r,offsetTopLeft:a,position:i,reverseDirection:l,tooltipBox:o,useTranslate3d:c,viewBox:d}=t,u,m,x;return o.height>0&&o.width>0&&r?(m=s9({allowEscapeViewBox:s,coordinate:r,key:"x",offsetTopLeft:a,position:i,reverseDirection:l,tooltipDimension:o.width,viewBox:d,viewBoxDimension:d.width}),x=s9({allowEscapeViewBox:s,coordinate:r,key:"y",offsetTopLeft:a,position:i,reverseDirection:l,tooltipDimension:o.height,viewBox:d,viewBoxDimension:d.height}),u=W8e({translateX:m,translateY:x,useTranslate3d:c})):u=V8e,{cssProperties:u,cssClasses:H8e({translateX:m,translateY:x,coordinate:r})}}function n9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function cv(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?n9(Object(r),!0).forEach(function(a){hA(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function hA(t,s,r){return(s=G8e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function G8e(t){var s=K8e(t,"string");return typeof s=="symbol"?s:s+""}function K8e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}class Y8e extends p.PureComponent{constructor(){super(...arguments),hA(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),hA(this,"handleKeyDown",s=>{if(s.key==="Escape"){var r,a,i,l;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(r=(a=this.props.coordinate)===null||a===void 0?void 0:a.x)!==null&&r!==void 0?r:0,y:(i=(l=this.props.coordinate)===null||l===void 0?void 0:l.y)!==null&&i!==void 0?i:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var s,r;this.state.dismissed&&(((s=this.props.coordinate)===null||s===void 0?void 0:s.x)!==this.state.dismissedAtCoordinate.x||((r=this.props.coordinate)===null||r===void 0?void 0:r.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:s,allowEscapeViewBox:r,animationDuration:a,animationEasing:i,children:l,coordinate:o,hasPayload:c,isAnimationActive:d,offset:u,position:m,reverseDirection:x,useTranslate3d:g,viewBox:y,wrapperStyle:v,lastBoundingBox:j,innerRef:w,hasPortalFromProps:S}=this.props,{cssClasses:E,cssProperties:k}=q8e({allowEscapeViewBox:r,coordinate:o,offsetTopLeft:u,position:m,reverseDirection:x,tooltipBox:{height:j.height,width:j.width},useTranslate3d:g,viewBox:y}),A=S?{}:cv(cv({transition:d&&s?"transform ".concat(a,"ms ").concat(i):void 0},k),{},{pointerEvents:"none",visibility:!this.state.dismissed&&s&&c?"visible":"hidden",position:"absolute",top:0,left:0}),I=cv(cv({},A),{},{visibility:!this.state.dismissed&&s&&c?"visible":"hidden"},v);return p.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:E,style:I,ref:w},l)}}var X8e=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),jx={devToolsEnabled:!1,isSsr:X8e()},CJ=()=>{var t;return(t=es(s=>s.rootProps.accessibilityLayer))!==null&&t!==void 0?t:!0};function xA(){return xA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},xA.apply(null,arguments)}function r9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function a9(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?r9(Object(r),!0).forEach(function(a){Q8e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):r9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function Q8e(t,s,r){return(s=Z8e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function Z8e(t){var s=J8e(t,"string");return typeof s=="symbol"?s:s+""}function J8e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var i9={curveBasisClosed:KOe,curveBasisOpen:YOe,curveBasis:GOe,curveBumpX:MOe,curveBumpY:IOe,curveLinearClosed:XOe,curveLinear:i_,curveMonotoneX:QOe,curveMonotoneY:ZOe,curveNatural:JOe,curveStep:eRe,curveStepAfter:sRe,curveStepBefore:tRe},XN=t=>Mr(t.x)&&Mr(t.y),l9=t=>t.base!=null&&XN(t.base)&&XN(t),E0=t=>t.x,T0=t=>t.y,eLe=(t,s)=>{if(typeof t=="function")return t;var r="curve".concat(yy(t));return(r==="curveMonotone"||r==="curveBump")&&s?i9["".concat(r).concat(s==="vertical"?"Y":"X")]:i9[r]||i_},tLe=t=>{var{type:s="linear",points:r=[],baseLine:a,layout:i,connectNulls:l=!1}=t,o=eLe(s,i),c=l?r.filter(XN):r,d;if(Array.isArray(a)){var u=r.map((y,v)=>a9(a9({},y),{},{base:a[v]}));i==="vertical"?d=sv().y(T0).x1(E0).x0(y=>y.base.x):d=sv().x(E0).y1(T0).y0(y=>y.base.y);var m=d.defined(l9).curve(o),x=l?u.filter(l9):u;return m(x)}i==="vertical"&&as(a)?d=sv().y(T0).x1(E0).x0(a):as(a)?d=sv().x(E0).y1(T0).y0(a):d=JQ().x(E0).y(T0);var g=d.defined(XN).curve(o);return g(c)},PD=t=>{var{className:s,points:r,path:a,pathRef:i}=t;if((!r||!r.length)&&!a)return null;var l=r&&r.length?tLe(t):a;return p.createElement("path",xA({},od(t),wRe(t),{className:mn("recharts-curve",s),d:l===null?void 0:l,ref:i}))},sLe=["x","y","top","left","width","height","className"];function pA(){return pA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},pA.apply(null,arguments)}function o9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function nLe(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?o9(Object(r),!0).forEach(function(a){rLe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function rLe(t,s,r){return(s=aLe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function aLe(t){var s=iLe(t,"string");return typeof s=="symbol"?s:s+""}function iLe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function lLe(t,s){if(t==null)return{};var r,a,i=oLe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function oLe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var cLe=(t,s,r,a,i,l)=>"M".concat(t,",").concat(i,"v").concat(a,"M").concat(l,",").concat(s,"h").concat(r),dLe=t=>{var{x:s=0,y:r=0,top:a=0,left:i=0,width:l=0,height:o=0,className:c}=t,d=lLe(t,sLe),u=nLe({x:s,y:r,top:a,left:i,width:l,height:o},d);return!as(s)||!as(r)||!as(l)||!as(o)||!as(a)||!as(i)?null:p.createElement("path",pA({},Mo(u),{className:mn("recharts-cross",c),d:cLe(s,r,l,o,a,i)}))};function uLe(t,s,r,a){var i=a/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?s.x-i:r.left+.5,y:t==="horizontal"?r.top+.5:s.y-i,width:t==="horizontal"?a:r.width-1,height:t==="horizontal"?r.height-1:a}}function c9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function d9(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?c9(Object(r),!0).forEach(function(a){mLe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function mLe(t,s,r){return(s=hLe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function hLe(t){var s=xLe(t,"string");return typeof s=="symbol"?s:s+""}function xLe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var pLe=t=>t.replace(/([A-Z])/g,s=>"-".concat(s.toLowerCase())),kJ=(t,s,r)=>t.map(a=>"".concat(pLe(a)," ").concat(s,"ms ").concat(r)).join(","),fLe=(t,s)=>[Object.keys(t),Object.keys(s)].reduce((r,a)=>r.filter(i=>a.includes(i))),Lb=(t,s)=>Object.keys(s).reduce((r,a)=>d9(d9({},r),{},{[a]:t(a,s[a])}),{});function u9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function ia(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?u9(Object(r),!0).forEach(function(a){gLe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function gLe(t,s,r){return(s=bLe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function bLe(t){var s=yLe(t,"string");return typeof s=="symbol"?s:s+""}function yLe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var QN=(t,s,r)=>t+(s-t)*r,fA=t=>{var{from:s,to:r}=t;return s!==r},AJ=(t,s,r)=>{var a=Lb((i,l)=>{if(fA(l)){var[o,c]=t(l.from,l.to,l.velocity);return ia(ia({},l),{},{from:o,velocity:c})}return l},s);return r<1?Lb((i,l)=>fA(l)?ia(ia({},l),{},{velocity:QN(l.velocity,a[i].velocity,r),from:QN(l.from,a[i].from,r)}):l,s):AJ(t,a,r-1)};function vLe(t,s,r,a,i,l){var o,c=a.reduce((g,y)=>ia(ia({},g),{},{[y]:{from:t[y],velocity:0,to:s[y]}}),{}),d=()=>Lb((g,y)=>y.from,c),u=()=>!Object.values(c).filter(fA).length,m=null,x=g=>{o||(o=g);var y=g-o,v=y/r.dt;c=AJ(r,c,v),i(ia(ia(ia({},t),s),d())),o=g,u()||(m=l.setTimeout(x))};return()=>(m=l.setTimeout(x),()=>{var g;(g=m)===null||g===void 0||g()})}function jLe(t,s,r,a,i,l,o){var c=null,d=i.reduce((x,g)=>ia(ia({},x),{},{[g]:[t[g],s[g]]}),{}),u,m=x=>{u||(u=x);var g=(x-u)/a,y=Lb((j,w)=>QN(...w,r(g)),d);if(l(ia(ia(ia({},t),s),y)),g<1)c=o.setTimeout(m);else{var v=Lb((j,w)=>QN(...w,r(1)),d);l(ia(ia(ia({},t),s),v))}};return()=>(c=o.setTimeout(m),()=>{var x;(x=c)===null||x===void 0||x()})}const NLe=(t,s,r,a,i,l)=>{var o=fLe(t,s);return r==null?()=>(i(ia(ia({},t),s)),()=>{}):r.isStepper===!0?vLe(t,s,r,o,i,l):jLe(t,s,r,a,o,i,l)};var ZN=1e-4,EJ=(t,s)=>[0,3*t,3*s-6*t,3*t-3*s+1],TJ=(t,s)=>t.map((r,a)=>r*s**a).reduce((r,a)=>r+a),m9=(t,s)=>r=>{var a=EJ(t,s);return TJ(a,r)},wLe=(t,s)=>r=>{var a=EJ(t,s),i=[...a.map((l,o)=>l*o).slice(1),0];return TJ(i,r)},_Le=function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];if(r.length===1)switch(r[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:{var i,l=r[0].split("(");if(l[0]==="cubic-bezier"&&((i=l[1])===null||i===void 0?void 0:i.split(")")[0].split(",").length)===4){var o=l[1].split(")")[0].split(",").map(c=>parseFloat(c));return[o[0],o[1],o[2],o[3]]}}}return r.length===4?r:[0,0,1,1]},SLe=(t,s,r,a)=>{var i=m9(t,r),l=m9(s,a),o=wLe(t,r),c=u=>u>1?1:u<0?0:u,d=u=>{for(var m=u>1?1:u,x=m,g=0;g<8;++g){var y=i(x)-m,v=o(x);if(Math.abs(y-m)<ZN||v<ZN)return l(x);x=c(x-y/v)}return l(x)};return d.isStepper=!1,d},h9=function(){return SLe(..._Le(...arguments))},CLe=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:r=100,damping:a=8,dt:i=17}=s,l=(o,c,d)=>{var u=-(o-c)*r,m=d*a,x=d+(u-m)*i/1e3,g=d*i/1e3+o;return Math.abs(g-c)<ZN&&Math.abs(x)<ZN?[c,0]:[g,x]};return l.isStepper=!0,l.dt=i,l},kLe=t=>{if(typeof t=="string")switch(t){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return h9(t);case"spring":return CLe();default:if(t.split("(")[0]==="cubic-bezier")return h9(t)}return typeof t=="function"?t:null};function ALe(t){var s,r=()=>null,a=!1,i=null,l=o=>{if(!a){if(Array.isArray(o)){if(!o.length)return;var c=o,[d,...u]=c;if(typeof d=="number"){i=t.setTimeout(l.bind(null,u),d);return}l(d),i=t.setTimeout(l.bind(null,u));return}typeof o=="string"&&(s=o,r(s)),typeof o=="object"&&(s=o,r(s)),typeof o=="function"&&o()}};return{stop:()=>{a=!0},start:o=>{a=!1,i&&(i(),i=null),l(o)},subscribe:o=>(r=o,()=>{r=()=>null}),getTimeoutController:()=>t}}class ELe{setTimeout(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=performance.now(),i=null,l=o=>{o-a>=r?s(o):typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(l))};return i=requestAnimationFrame(l),()=>{i!=null&&cancelAnimationFrame(i)}}}function TLe(){return ALe(new ELe)}var PLe=p.createContext(TLe);function DLe(t,s){var r=p.useContext(PLe);return p.useMemo(()=>s??r(t),[t,s,r])}var MLe={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},x9={t:0},Fk={t:1};function k_(t){var s=Li(t,MLe),{isActive:r,canBegin:a,duration:i,easing:l,begin:o,onAnimationEnd:c,onAnimationStart:d,children:u}=s,m=DLe(s.animationId,s.animationManager),[x,g]=p.useState(r?x9:Fk),y=p.useRef(null);return p.useEffect(()=>{r||g(Fk)},[r]),p.useEffect(()=>{if(!r||!a)return yx;var v=NLe(x9,Fk,kLe(l),i,g,m.getTimeoutController()),j=()=>{y.current=v()};return m.start([d,o,j,i,c]),()=>{m.stop(),y.current&&y.current(),c()}},[r,a,i,l,o,d,c,m]),u(x.t)}function A_(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",r=p.useRef(Mb(s)),a=p.useRef(t);return a.current!==t&&(r.current=Mb(s),a.current=t),r.current}var ILe=["radius"],OLe=["radius"];function p9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function f9(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?p9(Object(r),!0).forEach(function(a){RLe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function RLe(t,s,r){return(s=LLe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function LLe(t){var s=FLe(t,"string");return typeof s=="symbol"?s:s+""}function FLe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function JN(){return JN=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},JN.apply(null,arguments)}function g9(t,s){if(t==null)return{};var r,a,i=BLe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function BLe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var b9=(t,s,r,a,i)=>{var l=Math.min(Math.abs(r)/2,Math.abs(a)/2),o=a>=0?1:-1,c=r>=0?1:-1,d=a>=0&&r>=0||a<0&&r<0?1:0,u;if(l>0&&i instanceof Array){for(var m=[0,0,0,0],x=0,g=4;x<g;x++)m[x]=i[x]>l?l:i[x];u="M".concat(t,",").concat(s+o*m[0]),m[0]>0&&(u+="A ".concat(m[0],",").concat(m[0],",0,0,").concat(d,",").concat(t+c*m[0],",").concat(s)),u+="L ".concat(t+r-c*m[1],",").concat(s),m[1]>0&&(u+="A ".concat(m[1],",").concat(m[1],",0,0,").concat(d,`,
        `).concat(t+r,",").concat(s+o*m[1])),u+="L ".concat(t+r,",").concat(s+a-o*m[2]),m[2]>0&&(u+="A ".concat(m[2],",").concat(m[2],",0,0,").concat(d,`,
        `).concat(t+r-c*m[2],",").concat(s+a)),u+="L ".concat(t+c*m[3],",").concat(s+a),m[3]>0&&(u+="A ".concat(m[3],",").concat(m[3],",0,0,").concat(d,`,
        `).concat(t,",").concat(s+a-o*m[3])),u+="Z"}else if(l>0&&i===+i&&i>0){var y=Math.min(l,i);u="M ".concat(t,",").concat(s+o*y,`
            A `).concat(y,",").concat(y,",0,0,").concat(d,",").concat(t+c*y,",").concat(s,`
            L `).concat(t+r-c*y,",").concat(s,`
            A `).concat(y,",").concat(y,",0,0,").concat(d,",").concat(t+r,",").concat(s+o*y,`
            L `).concat(t+r,",").concat(s+a-o*y,`
            A `).concat(y,",").concat(y,",0,0,").concat(d,",").concat(t+r-c*y,",").concat(s+a,`
            L `).concat(t+c*y,",").concat(s+a,`
            A `).concat(y,",").concat(y,",0,0,").concat(d,",").concat(t,",").concat(s+a-o*y," Z")}else u="M ".concat(t,",").concat(s," h ").concat(r," v ").concat(a," h ").concat(-r," Z");return u},y9={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},PJ=t=>{var s=Li(t,y9),r=p.useRef(null),[a,i]=p.useState(-1);p.useEffect(()=>{if(r.current&&r.current.getTotalLength)try{var H=r.current.getTotalLength();H&&i(H)}catch{}},[]);var{x:l,y:o,width:c,height:d,radius:u,className:m}=s,{animationEasing:x,animationDuration:g,animationBegin:y,isAnimationActive:v,isUpdateAnimationActive:j}=s,w=p.useRef(c),S=p.useRef(d),E=p.useRef(l),k=p.useRef(o),A=p.useMemo(()=>({x:l,y:o,width:c,height:d,radius:u}),[l,o,c,d,u]),I=A_(A,"rectangle-");if(l!==+l||o!==+o||c!==+c||d!==+d||c===0||d===0)return null;var P=mn("recharts-rectangle",m);if(!j){var O=Mo(s),{radius:D}=O,T=g9(O,ILe);return p.createElement("path",JN({},T,{radius:typeof u=="number"?u:void 0,className:P,d:b9(l,o,c,d,u)}))}var B=w.current,U=S.current,W=E.current,V=k.current,R="0px ".concat(a===-1?1:a,"px"),F="".concat(a,"px 0px"),G=kJ(["strokeDasharray"],g,typeof x=="string"?x:y9.animationEasing);return p.createElement(k_,{animationId:I,key:I,canBegin:a>0,duration:g,easing:x,isActive:j,begin:y},H=>{var $=aa(B,c,H),K=aa(U,d,H),le=aa(W,l,H),se=aa(V,o,H);r.current&&(w.current=$,S.current=K,E.current=le,k.current=se);var J;v?H>0?J={transition:G,strokeDasharray:F}:J={strokeDasharray:R}:J={strokeDasharray:F};var ie=Mo(s),{radius:te}=ie,ne=g9(ie,OLe);return p.createElement("path",JN({},ne,{radius:typeof u=="number"?u:void 0,className:P,d:b9(le,se,$,K,u),ref:r,style:f9(f9({},J),s.style)}))})};function v9(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function j9(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?v9(Object(r),!0).forEach(function(a){$Le(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v9(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function $Le(t,s,r){return(s=zLe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function zLe(t){var s=ULe(t,"string");return typeof s=="symbol"?s:s+""}function ULe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var ew=Math.PI/180,VLe=t=>t*180/Math.PI,Kr=(t,s,r,a)=>({x:t+Math.cos(-ew*a)*r,y:s+Math.sin(-ew*a)*r}),DJ=function(s,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(s-(a.left||0)-(a.right||0)),Math.abs(r-(a.top||0)-(a.bottom||0)))/2},HLe=(t,s)=>{var{x:r,y:a}=t,{x:i,y:l}=s;return Math.sqrt((r-i)**2+(a-l)**2)},WLe=(t,s)=>{var{x:r,y:a}=t,{cx:i,cy:l}=s,o=HLe({x:r,y:a},{x:i,y:l});if(o<=0)return{radius:o,angle:0};var c=(r-i)/o,d=Math.acos(c);return a>l&&(d=2*Math.PI-d),{radius:o,angle:VLe(d),angleInRadian:d}},qLe=t=>{var{startAngle:s,endAngle:r}=t,a=Math.floor(s/360),i=Math.floor(r/360),l=Math.min(a,i);return{startAngle:s-l*360,endAngle:r-l*360}},GLe=(t,s)=>{var{startAngle:r,endAngle:a}=s,i=Math.floor(r/360),l=Math.floor(a/360),o=Math.min(i,l);return t+o*360},KLe=(t,s)=>{var{chartX:r,chartY:a}=t,{radius:i,angle:l}=WLe({x:r,y:a},s),{innerRadius:o,outerRadius:c}=s;if(i<o||i>c||i===0)return null;var{startAngle:d,endAngle:u}=qLe(s),m=l,x;if(d<=u){for(;m>u;)m-=360;for(;m<d;)m+=360;x=m>=d&&m<=u}else{for(;m>d;)m-=360;for(;m<u;)m+=360;x=m>=u&&m<=d}return x?j9(j9({},s),{},{radius:i,angle:GLe(m,s)}):null};function MJ(t){var{cx:s,cy:r,radius:a,startAngle:i,endAngle:l}=t,o=Kr(s,r,a,i),c=Kr(s,r,a,l);return{points:[o,c],cx:s,cy:r,radius:a,startAngle:i,endAngle:l}}function gA(){return gA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},gA.apply(null,arguments)}var YLe=(t,s)=>{var r=qa(s-t),a=Math.min(Math.abs(s-t),359.999);return r*a},dv=t=>{var{cx:s,cy:r,radius:a,angle:i,sign:l,isExternal:o,cornerRadius:c,cornerIsExternal:d}=t,u=c*(o?1:-1)+a,m=Math.asin(c/u)/ew,x=d?i:i+l*m,g=Kr(s,r,u,x),y=Kr(s,r,a,x),v=d?i-l*m:i,j=Kr(s,r,u*Math.cos(m*ew),v);return{center:g,circleTangency:y,lineTangency:j,theta:m}},IJ=t=>{var{cx:s,cy:r,innerRadius:a,outerRadius:i,startAngle:l,endAngle:o}=t,c=YLe(l,o),d=l+c,u=Kr(s,r,i,l),m=Kr(s,r,i,d),x="M ".concat(u.x,",").concat(u.y,`
    A `).concat(i,",").concat(i,`,0,
    `).concat(+(Math.abs(c)>180),",").concat(+(l>d),`,
    `).concat(m.x,",").concat(m.y,`
  `);if(a>0){var g=Kr(s,r,a,l),y=Kr(s,r,a,d);x+="L ".concat(y.x,",").concat(y.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(c)>180),",").concat(+(l<=d),`,
            `).concat(g.x,",").concat(g.y," Z")}else x+="L ".concat(s,",").concat(r," Z");return x},XLe=t=>{var{cx:s,cy:r,innerRadius:a,outerRadius:i,cornerRadius:l,forceCornerRadius:o,cornerIsExternal:c,startAngle:d,endAngle:u}=t,m=qa(u-d),{circleTangency:x,lineTangency:g,theta:y}=dv({cx:s,cy:r,radius:i,angle:d,sign:m,cornerRadius:l,cornerIsExternal:c}),{circleTangency:v,lineTangency:j,theta:w}=dv({cx:s,cy:r,radius:i,angle:u,sign:-m,cornerRadius:l,cornerIsExternal:c}),S=c?Math.abs(d-u):Math.abs(d-u)-y-w;if(S<0)return o?"M ".concat(g.x,",").concat(g.y,`
        a`).concat(l,",").concat(l,",0,0,1,").concat(l*2,`,0
        a`).concat(l,",").concat(l,",0,0,1,").concat(-l*2,`,0
      `):IJ({cx:s,cy:r,innerRadius:a,outerRadius:i,startAngle:d,endAngle:u});var E="M ".concat(g.x,",").concat(g.y,`
    A`).concat(l,",").concat(l,",0,0,").concat(+(m<0),",").concat(x.x,",").concat(x.y,`
    A`).concat(i,",").concat(i,",0,").concat(+(S>180),",").concat(+(m<0),",").concat(v.x,",").concat(v.y,`
    A`).concat(l,",").concat(l,",0,0,").concat(+(m<0),",").concat(j.x,",").concat(j.y,`
  `);if(a>0){var{circleTangency:k,lineTangency:A,theta:I}=dv({cx:s,cy:r,radius:a,angle:d,sign:m,isExternal:!0,cornerRadius:l,cornerIsExternal:c}),{circleTangency:P,lineTangency:O,theta:D}=dv({cx:s,cy:r,radius:a,angle:u,sign:-m,isExternal:!0,cornerRadius:l,cornerIsExternal:c}),T=c?Math.abs(d-u):Math.abs(d-u)-I-D;if(T<0&&l===0)return"".concat(E,"L").concat(s,",").concat(r,"Z");E+="L".concat(O.x,",").concat(O.y,`
      A`).concat(l,",").concat(l,",0,0,").concat(+(m<0),",").concat(P.x,",").concat(P.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(T>180),",").concat(+(m>0),",").concat(k.x,",").concat(k.y,`
      A`).concat(l,",").concat(l,",0,0,").concat(+(m<0),",").concat(A.x,",").concat(A.y,"Z")}else E+="L".concat(s,",").concat(r,"Z");return E},QLe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},OJ=t=>{var s=Li(t,QLe),{cx:r,cy:a,innerRadius:i,outerRadius:l,cornerRadius:o,forceCornerRadius:c,cornerIsExternal:d,startAngle:u,endAngle:m,className:x}=s;if(l<i||u===m)return null;var g=mn("recharts-sector",x),y=l-i,v=di(o,y,0,!0),j;return v>0&&Math.abs(u-m)<360?j=XLe({cx:r,cy:a,innerRadius:i,outerRadius:l,cornerRadius:Math.min(v,y/2),forceCornerRadius:c,cornerIsExternal:d,startAngle:u,endAngle:m}):j=IJ({cx:r,cy:a,innerRadius:i,outerRadius:l,startAngle:u,endAngle:m}),p.createElement("path",gA({},Mo(s),{className:g,d:j}))};function ZLe(t,s,r){if(t==="horizontal")return[{x:s.x,y:r.top},{x:s.x,y:r.top+r.height}];if(t==="vertical")return[{x:r.left,y:s.y},{x:r.left+r.width,y:s.y}];if(pZ(s)){if(t==="centric"){var{cx:a,cy:i,innerRadius:l,outerRadius:o,angle:c}=s,d=Kr(a,i,l,c),u=Kr(a,i,o,c);return[{x:d.x,y:d.y},{x:u.x,y:u.y}]}return MJ(s)}}var RJ={},LJ={},FJ={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=ND;function r(a){return s.isSymbol(a)?NaN:Number(a)}t.toNumber=r})(FJ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=FJ;function r(a){return a?(a=s.toNumber(a),a===1/0||a===-1/0?(a<0?-1:1)*Number.MAX_VALUE:a===a?a:0):a===0?a:0}t.toFinite=r})(LJ);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=wD,r=LJ;function a(i,l,o){o&&typeof o!="number"&&s.isIterateeCall(i,l,o)&&(l=o=void 0),i=r.toFinite(i),l===void 0?(l=i,i=0):l=r.toFinite(l),o=o===void 0?i<l?1:-1:r.toFinite(o);const c=Math.max(Math.ceil((l-i)/(o||1)),0),d=new Array(c);for(let u=0;u<c;u++)d[u]=i,i+=o;return d}t.range=a})(RJ);var JLe=RJ.range;const BJ=Ro(JLe);function cm(t,s){return t==null||s==null?NaN:t<s?-1:t>s?1:t>=s?0:NaN}function e7e(t,s){return t==null||s==null?NaN:s<t?-1:s>t?1:s>=t?0:NaN}function DD(t){let s,r,a;t.length!==2?(s=cm,r=(c,d)=>cm(t(c),d),a=(c,d)=>t(c)-d):(s=t===cm||t===e7e?t:t7e,r=t,a=t);function i(c,d,u=0,m=c.length){if(u<m){if(s(d,d)!==0)return m;do{const x=u+m>>>1;r(c[x],d)<0?u=x+1:m=x}while(u<m)}return u}function l(c,d,u=0,m=c.length){if(u<m){if(s(d,d)!==0)return m;do{const x=u+m>>>1;r(c[x],d)<=0?u=x+1:m=x}while(u<m)}return u}function o(c,d,u=0,m=c.length){const x=i(c,d,u,m-1);return x>u&&a(c[x-1],d)>-a(c[x],d)?x-1:x}return{left:i,center:o,right:l}}function t7e(){return 0}function $J(t){return t===null?NaN:+t}function*s7e(t,s){for(let r of t)r!=null&&(r=+r)>=r&&(yield r)}const n7e=DD(cm),wy=n7e.right;DD($J).center;class N9 extends Map{constructor(s,r=i7e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),s!=null)for(const[a,i]of s)this.set(a,i)}get(s){return super.get(w9(this,s))}has(s){return super.has(w9(this,s))}set(s,r){return super.set(r7e(this,s),r)}delete(s){return super.delete(a7e(this,s))}}function w9({_intern:t,_key:s},r){const a=s(r);return t.has(a)?t.get(a):r}function r7e({_intern:t,_key:s},r){const a=s(r);return t.has(a)?t.get(a):(t.set(a,r),r)}function a7e({_intern:t,_key:s},r){const a=s(r);return t.has(a)&&(r=t.get(a),t.delete(a)),r}function i7e(t){return t!==null&&typeof t=="object"?t.valueOf():t}function l7e(t=cm){if(t===cm)return zJ;if(typeof t!="function")throw new TypeError("compare is not a function");return(s,r)=>{const a=t(s,r);return a||a===0?a:(t(r,r)===0)-(t(s,s)===0)}}function zJ(t,s){return(t==null||!(t>=t))-(s==null||!(s>=s))||(t<s?-1:t>s?1:0)}const o7e=Math.sqrt(50),c7e=Math.sqrt(10),d7e=Math.sqrt(2);function tw(t,s,r){const a=(s-t)/Math.max(0,r),i=Math.floor(Math.log10(a)),l=a/Math.pow(10,i),o=l>=o7e?10:l>=c7e?5:l>=d7e?2:1;let c,d,u;return i<0?(u=Math.pow(10,-i)/o,c=Math.round(t*u),d=Math.round(s*u),c/u<t&&++c,d/u>s&&--d,u=-u):(u=Math.pow(10,i)*o,c=Math.round(t/u),d=Math.round(s/u),c*u<t&&++c,d*u>s&&--d),d<c&&.5<=r&&r<2?tw(t,s,r*2):[c,d,u]}function bA(t,s,r){if(s=+s,t=+t,r=+r,!(r>0))return[];if(t===s)return[t];const a=s<t,[i,l,o]=a?tw(s,t,r):tw(t,s,r);if(!(l>=i))return[];const c=l-i+1,d=new Array(c);if(a)if(o<0)for(let u=0;u<c;++u)d[u]=(l-u)/-o;else for(let u=0;u<c;++u)d[u]=(l-u)*o;else if(o<0)for(let u=0;u<c;++u)d[u]=(i+u)/-o;else for(let u=0;u<c;++u)d[u]=(i+u)*o;return d}function yA(t,s,r){return s=+s,t=+t,r=+r,tw(t,s,r)[2]}function vA(t,s,r){s=+s,t=+t,r=+r;const a=s<t,i=a?yA(s,t,r):yA(t,s,r);return(a?-1:1)*(i<0?1/-i:i)}function _9(t,s){let r;for(const a of t)a!=null&&(r<a||r===void 0&&a>=a)&&(r=a);return r}function S9(t,s){let r;for(const a of t)a!=null&&(r>a||r===void 0&&a>=a)&&(r=a);return r}function UJ(t,s,r=0,a=1/0,i){if(s=Math.floor(s),r=Math.floor(Math.max(0,r)),a=Math.floor(Math.min(t.length-1,a)),!(r<=s&&s<=a))return t;for(i=i===void 0?zJ:l7e(i);a>r;){if(a-r>600){const d=a-r+1,u=s-r+1,m=Math.log(d),x=.5*Math.exp(2*m/3),g=.5*Math.sqrt(m*x*(d-x)/d)*(u-d/2<0?-1:1),y=Math.max(r,Math.floor(s-u*x/d+g)),v=Math.min(a,Math.floor(s+(d-u)*x/d+g));UJ(t,s,y,v,i)}const l=t[s];let o=r,c=a;for(P0(t,r,s),i(t[a],l)>0&&P0(t,r,a);o<c;){for(P0(t,o,c),++o,--c;i(t[o],l)<0;)++o;for(;i(t[c],l)>0;)--c}i(t[r],l)===0?P0(t,r,c):(++c,P0(t,c,a)),c<=s&&(r=c+1),s<=c&&(a=c-1)}return t}function P0(t,s,r){const a=t[s];t[s]=t[r],t[r]=a}function u7e(t,s,r){if(t=Float64Array.from(s7e(t)),!(!(a=t.length)||isNaN(s=+s))){if(s<=0||a<2)return S9(t);if(s>=1)return _9(t);var a,i=(a-1)*s,l=Math.floor(i),o=_9(UJ(t,l).subarray(0,l+1)),c=S9(t.subarray(l+1));return o+(c-o)*(i-l)}}function m7e(t,s,r=$J){if(!(!(a=t.length)||isNaN(s=+s))){if(s<=0||a<2)return+r(t[0],0,t);if(s>=1)return+r(t[a-1],a-1,t);var a,i=(a-1)*s,l=Math.floor(i),o=+r(t[l],l,t),c=+r(t[l+1],l+1,t);return o+(c-o)*(i-l)}}function h7e(t,s,r){t=+t,s=+s,r=(i=arguments.length)<2?(s=t,t=0,1):i<3?1:+r;for(var a=-1,i=Math.max(0,Math.ceil((s-t)/r))|0,l=new Array(i);++a<i;)l[a]=t+a*r;return l}function Fo(t,s){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(s).domain(t);break}return this}function du(t,s){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof s=="function"?this.interpolator(s):this.range(s);break}}return this}const jA=Symbol("implicit");function MD(){var t=new N9,s=[],r=[],a=jA;function i(l){let o=t.get(l);if(o===void 0){if(a!==jA)return a;t.set(l,o=s.push(l)-1)}return r[o%r.length]}return i.domain=function(l){if(!arguments.length)return s.slice();s=[],t=new N9;for(const o of l)t.has(o)||t.set(o,s.push(o)-1);return i},i.range=function(l){return arguments.length?(r=Array.from(l),i):r.slice()},i.unknown=function(l){return arguments.length?(a=l,i):a},i.copy=function(){return MD(s,r).unknown(a)},Fo.apply(i,arguments),i}function ID(){var t=MD().unknown(void 0),s=t.domain,r=t.range,a=0,i=1,l,o,c=!1,d=0,u=0,m=.5;delete t.unknown;function x(){var g=s().length,y=i<a,v=y?i:a,j=y?a:i;l=(j-v)/Math.max(1,g-d+u*2),c&&(l=Math.floor(l)),v+=(j-v-l*(g-d))*m,o=l*(1-d),c&&(v=Math.round(v),o=Math.round(o));var w=h7e(g).map(function(S){return v+l*S});return r(y?w.reverse():w)}return t.domain=function(g){return arguments.length?(s(g),x()):s()},t.range=function(g){return arguments.length?([a,i]=g,a=+a,i=+i,x()):[a,i]},t.rangeRound=function(g){return[a,i]=g,a=+a,i=+i,c=!0,x()},t.bandwidth=function(){return o},t.step=function(){return l},t.round=function(g){return arguments.length?(c=!!g,x()):c},t.padding=function(g){return arguments.length?(d=Math.min(1,u=+g),x()):d},t.paddingInner=function(g){return arguments.length?(d=Math.min(1,g),x()):d},t.paddingOuter=function(g){return arguments.length?(u=+g,x()):u},t.align=function(g){return arguments.length?(m=Math.max(0,Math.min(1,g)),x()):m},t.copy=function(){return ID(s(),[a,i]).round(c).paddingInner(d).paddingOuter(u).align(m)},Fo.apply(x(),arguments)}function VJ(t){var s=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return VJ(s())},t}function x7e(){return VJ(ID.apply(null,arguments).paddingInner(1))}function OD(t,s,r){t.prototype=s.prototype=r,r.constructor=t}function HJ(t,s){var r=Object.create(t.prototype);for(var a in s)r[a]=s[a];return r}function _y(){}var Fb=.7,sw=1/Fb,$p="\\s*([+-]?\\d+)\\s*",Bb="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",nd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",p7e=/^#([0-9a-f]{3,8})$/,f7e=new RegExp(`^rgb\\(${$p},${$p},${$p}\\)$`),g7e=new RegExp(`^rgb\\(${nd},${nd},${nd}\\)$`),b7e=new RegExp(`^rgba\\(${$p},${$p},${$p},${Bb}\\)$`),y7e=new RegExp(`^rgba\\(${nd},${nd},${nd},${Bb}\\)$`),v7e=new RegExp(`^hsl\\(${Bb},${nd},${nd}\\)$`),j7e=new RegExp(`^hsla\\(${Bb},${nd},${nd},${Bb}\\)$`),C9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};OD(_y,$b,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:k9,formatHex:k9,formatHex8:N7e,formatHsl:w7e,formatRgb:A9,toString:A9});function k9(){return this.rgb().formatHex()}function N7e(){return this.rgb().formatHex8()}function w7e(){return WJ(this).formatHsl()}function A9(){return this.rgb().formatRgb()}function $b(t){var s,r;return t=(t+"").trim().toLowerCase(),(s=p7e.exec(t))?(r=s[1].length,s=parseInt(s[1],16),r===6?E9(s):r===3?new nl(s>>8&15|s>>4&240,s>>4&15|s&240,(s&15)<<4|s&15,1):r===8?uv(s>>24&255,s>>16&255,s>>8&255,(s&255)/255):r===4?uv(s>>12&15|s>>8&240,s>>8&15|s>>4&240,s>>4&15|s&240,((s&15)<<4|s&15)/255):null):(s=f7e.exec(t))?new nl(s[1],s[2],s[3],1):(s=g7e.exec(t))?new nl(s[1]*255/100,s[2]*255/100,s[3]*255/100,1):(s=b7e.exec(t))?uv(s[1],s[2],s[3],s[4]):(s=y7e.exec(t))?uv(s[1]*255/100,s[2]*255/100,s[3]*255/100,s[4]):(s=v7e.exec(t))?D9(s[1],s[2]/100,s[3]/100,1):(s=j7e.exec(t))?D9(s[1],s[2]/100,s[3]/100,s[4]):C9.hasOwnProperty(t)?E9(C9[t]):t==="transparent"?new nl(NaN,NaN,NaN,0):null}function E9(t){return new nl(t>>16&255,t>>8&255,t&255,1)}function uv(t,s,r,a){return a<=0&&(t=s=r=NaN),new nl(t,s,r,a)}function _7e(t){return t instanceof _y||(t=$b(t)),t?(t=t.rgb(),new nl(t.r,t.g,t.b,t.opacity)):new nl}function NA(t,s,r,a){return arguments.length===1?_7e(t):new nl(t,s,r,a??1)}function nl(t,s,r,a){this.r=+t,this.g=+s,this.b=+r,this.opacity=+a}OD(nl,NA,HJ(_y,{brighter(t){return t=t==null?sw:Math.pow(sw,t),new nl(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Fb:Math.pow(Fb,t),new nl(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new nl(Ih(this.r),Ih(this.g),Ih(this.b),nw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:T9,formatHex:T9,formatHex8:S7e,formatRgb:P9,toString:P9}));function T9(){return`#${hh(this.r)}${hh(this.g)}${hh(this.b)}`}function S7e(){return`#${hh(this.r)}${hh(this.g)}${hh(this.b)}${hh((isNaN(this.opacity)?1:this.opacity)*255)}`}function P9(){const t=nw(this.opacity);return`${t===1?"rgb(":"rgba("}${Ih(this.r)}, ${Ih(this.g)}, ${Ih(this.b)}${t===1?")":`, ${t})`}`}function nw(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ih(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function hh(t){return t=Ih(t),(t<16?"0":"")+t.toString(16)}function D9(t,s,r,a){return a<=0?t=s=r=NaN:r<=0||r>=1?t=s=NaN:s<=0&&(t=NaN),new rc(t,s,r,a)}function WJ(t){if(t instanceof rc)return new rc(t.h,t.s,t.l,t.opacity);if(t instanceof _y||(t=$b(t)),!t)return new rc;if(t instanceof rc)return t;t=t.rgb();var s=t.r/255,r=t.g/255,a=t.b/255,i=Math.min(s,r,a),l=Math.max(s,r,a),o=NaN,c=l-i,d=(l+i)/2;return c?(s===l?o=(r-a)/c+(r<a)*6:r===l?o=(a-s)/c+2:o=(s-r)/c+4,c/=d<.5?l+i:2-l-i,o*=60):c=d>0&&d<1?0:o,new rc(o,c,d,t.opacity)}function C7e(t,s,r,a){return arguments.length===1?WJ(t):new rc(t,s,r,a??1)}function rc(t,s,r,a){this.h=+t,this.s=+s,this.l=+r,this.opacity=+a}OD(rc,C7e,HJ(_y,{brighter(t){return t=t==null?sw:Math.pow(sw,t),new rc(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Fb:Math.pow(Fb,t),new rc(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,s=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,a=r+(r<.5?r:1-r)*s,i=2*r-a;return new nl(Bk(t>=240?t-240:t+120,i,a),Bk(t,i,a),Bk(t<120?t+240:t-120,i,a),this.opacity)},clamp(){return new rc(M9(this.h),mv(this.s),mv(this.l),nw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=nw(this.opacity);return`${t===1?"hsl(":"hsla("}${M9(this.h)}, ${mv(this.s)*100}%, ${mv(this.l)*100}%${t===1?")":`, ${t})`}`}}));function M9(t){return t=(t||0)%360,t<0?t+360:t}function mv(t){return Math.max(0,Math.min(1,t||0))}function Bk(t,s,r){return(t<60?s+(r-s)*t/60:t<180?r:t<240?s+(r-s)*(240-t)/60:s)*255}const RD=t=>()=>t;function k7e(t,s){return function(r){return t+r*s}}function A7e(t,s,r){return t=Math.pow(t,r),s=Math.pow(s,r)-t,r=1/r,function(a){return Math.pow(t+a*s,r)}}function E7e(t){return(t=+t)==1?qJ:function(s,r){return r-s?A7e(s,r,t):RD(isNaN(s)?r:s)}}function qJ(t,s){var r=s-t;return r?k7e(t,r):RD(isNaN(t)?s:t)}const I9=function t(s){var r=E7e(s);function a(i,l){var o=r((i=NA(i)).r,(l=NA(l)).r),c=r(i.g,l.g),d=r(i.b,l.b),u=qJ(i.opacity,l.opacity);return function(m){return i.r=o(m),i.g=c(m),i.b=d(m),i.opacity=u(m),i+""}}return a.gamma=t,a}(1);function T7e(t,s){s||(s=[]);var r=t?Math.min(s.length,t.length):0,a=s.slice(),i;return function(l){for(i=0;i<r;++i)a[i]=t[i]*(1-l)+s[i]*l;return a}}function P7e(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function D7e(t,s){var r=s?s.length:0,a=t?Math.min(r,t.length):0,i=new Array(a),l=new Array(r),o;for(o=0;o<a;++o)i[o]=Lf(t[o],s[o]);for(;o<r;++o)l[o]=s[o];return function(c){for(o=0;o<a;++o)l[o]=i[o](c);return l}}function M7e(t,s){var r=new Date;return t=+t,s=+s,function(a){return r.setTime(t*(1-a)+s*a),r}}function rw(t,s){return t=+t,s=+s,function(r){return t*(1-r)+s*r}}function I7e(t,s){var r={},a={},i;(t===null||typeof t!="object")&&(t={}),(s===null||typeof s!="object")&&(s={});for(i in s)i in t?r[i]=Lf(t[i],s[i]):a[i]=s[i];return function(l){for(i in r)a[i]=r[i](l);return a}}var wA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$k=new RegExp(wA.source,"g");function O7e(t){return function(){return t}}function R7e(t){return function(s){return t(s)+""}}function L7e(t,s){var r=wA.lastIndex=$k.lastIndex=0,a,i,l,o=-1,c=[],d=[];for(t=t+"",s=s+"";(a=wA.exec(t))&&(i=$k.exec(s));)(l=i.index)>r&&(l=s.slice(r,l),c[o]?c[o]+=l:c[++o]=l),(a=a[0])===(i=i[0])?c[o]?c[o]+=i:c[++o]=i:(c[++o]=null,d.push({i:o,x:rw(a,i)})),r=$k.lastIndex;return r<s.length&&(l=s.slice(r),c[o]?c[o]+=l:c[++o]=l),c.length<2?d[0]?R7e(d[0].x):O7e(s):(s=d.length,function(u){for(var m=0,x;m<s;++m)c[(x=d[m]).i]=x.x(u);return c.join("")})}function Lf(t,s){var r=typeof s,a;return s==null||r==="boolean"?RD(s):(r==="number"?rw:r==="string"?(a=$b(s))?(s=a,I9):L7e:s instanceof $b?I9:s instanceof Date?M7e:P7e(s)?T7e:Array.isArray(s)?D7e:typeof s.valueOf!="function"&&typeof s.toString!="function"||isNaN(s)?I7e:rw)(t,s)}function LD(t,s){return t=+t,s=+s,function(r){return Math.round(t*(1-r)+s*r)}}function F7e(t,s){s===void 0&&(s=t,t=Lf);for(var r=0,a=s.length-1,i=s[0],l=new Array(a<0?0:a);r<a;)l[r]=t(i,i=s[++r]);return function(o){var c=Math.max(0,Math.min(a-1,Math.floor(o*=a)));return l[c](o-c)}}function B7e(t){return function(){return t}}function aw(t){return+t}var O9=[0,1];function Ai(t){return t}function _A(t,s){return(s-=t=+t)?function(r){return(r-t)/s}:B7e(isNaN(s)?NaN:.5)}function $7e(t,s){var r;return t>s&&(r=t,t=s,s=r),function(a){return Math.max(t,Math.min(s,a))}}function z7e(t,s,r){var a=t[0],i=t[1],l=s[0],o=s[1];return i<a?(a=_A(i,a),l=r(o,l)):(a=_A(a,i),l=r(l,o)),function(c){return l(a(c))}}function U7e(t,s,r){var a=Math.min(t.length,s.length)-1,i=new Array(a),l=new Array(a),o=-1;for(t[a]<t[0]&&(t=t.slice().reverse(),s=s.slice().reverse());++o<a;)i[o]=_A(t[o],t[o+1]),l[o]=r(s[o],s[o+1]);return function(c){var d=wy(t,c,1,a)-1;return l[d](i[d](c))}}function Sy(t,s){return s.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function E_(){var t=O9,s=O9,r=Lf,a,i,l,o=Ai,c,d,u;function m(){var g=Math.min(t.length,s.length);return o!==Ai&&(o=$7e(t[0],t[g-1])),c=g>2?U7e:z7e,d=u=null,x}function x(g){return g==null||isNaN(g=+g)?l:(d||(d=c(t.map(a),s,r)))(a(o(g)))}return x.invert=function(g){return o(i((u||(u=c(s,t.map(a),rw)))(g)))},x.domain=function(g){return arguments.length?(t=Array.from(g,aw),m()):t.slice()},x.range=function(g){return arguments.length?(s=Array.from(g),m()):s.slice()},x.rangeRound=function(g){return s=Array.from(g),r=LD,m()},x.clamp=function(g){return arguments.length?(o=g?!0:Ai,m()):o!==Ai},x.interpolate=function(g){return arguments.length?(r=g,m()):r},x.unknown=function(g){return arguments.length?(l=g,x):l},function(g,y){return a=g,i=y,m()}}function FD(){return E_()(Ai,Ai)}function V7e(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function iw(t,s){if((r=(t=s?t.toExponential(s-1):t.toExponential()).indexOf("e"))<0)return null;var r,a=t.slice(0,r);return[a.length>1?a[0]+a.slice(2):a,+t.slice(r+1)]}function uf(t){return t=iw(Math.abs(t)),t?t[1]:NaN}function H7e(t,s){return function(r,a){for(var i=r.length,l=[],o=0,c=t[0],d=0;i>0&&c>0&&(d+c+1>a&&(c=Math.max(1,a-d)),l.push(r.substring(i-=c,i+c)),!((d+=c+1)>a));)c=t[o=(o+1)%t.length];return l.reverse().join(s)}}function W7e(t){return function(s){return s.replace(/[0-9]/g,function(r){return t[+r]})}}var q7e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function zb(t){if(!(s=q7e.exec(t)))throw new Error("invalid format: "+t);var s;return new BD({fill:s[1],align:s[2],sign:s[3],symbol:s[4],zero:s[5],width:s[6],comma:s[7],precision:s[8]&&s[8].slice(1),trim:s[9],type:s[10]})}zb.prototype=BD.prototype;function BD(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}BD.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function G7e(t){e:for(var s=t.length,r=1,a=-1,i;r<s;++r)switch(t[r]){case".":a=i=r;break;case"0":a===0&&(a=r),i=r;break;default:if(!+t[r])break e;a>0&&(a=0);break}return a>0?t.slice(0,a)+t.slice(i+1):t}var GJ;function K7e(t,s){var r=iw(t,s);if(!r)return t+"";var a=r[0],i=r[1],l=i-(GJ=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=a.length;return l===o?a:l>o?a+new Array(l-o+1).join("0"):l>0?a.slice(0,l)+"."+a.slice(l):"0."+new Array(1-l).join("0")+iw(t,Math.max(0,s+l-1))[0]}function R9(t,s){var r=iw(t,s);if(!r)return t+"";var a=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+a:a.length>i+1?a.slice(0,i+1)+"."+a.slice(i+1):a+new Array(i-a.length+2).join("0")}const L9={"%":(t,s)=>(t*100).toFixed(s),b:t=>Math.round(t).toString(2),c:t=>t+"",d:V7e,e:(t,s)=>t.toExponential(s),f:(t,s)=>t.toFixed(s),g:(t,s)=>t.toPrecision(s),o:t=>Math.round(t).toString(8),p:(t,s)=>R9(t*100,s),r:R9,s:K7e,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function F9(t){return t}var B9=Array.prototype.map,$9=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Y7e(t){var s=t.grouping===void 0||t.thousands===void 0?F9:H7e(B9.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",a=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",l=t.numerals===void 0?F9:W7e(B9.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",c=t.minus===void 0?"":t.minus+"",d=t.nan===void 0?"NaN":t.nan+"";function u(x){x=zb(x);var g=x.fill,y=x.align,v=x.sign,j=x.symbol,w=x.zero,S=x.width,E=x.comma,k=x.precision,A=x.trim,I=x.type;I==="n"?(E=!0,I="g"):L9[I]||(k===void 0&&(k=12),A=!0,I="g"),(w||g==="0"&&y==="=")&&(w=!0,g="0",y="=");var P=j==="$"?r:j==="#"&&/[boxX]/.test(I)?"0"+I.toLowerCase():"",O=j==="$"?a:/[%p]/.test(I)?o:"",D=L9[I],T=/[defgprs%]/.test(I);k=k===void 0?6:/[gprs]/.test(I)?Math.max(1,Math.min(21,k)):Math.max(0,Math.min(20,k));function B(U){var W=P,V=O,R,F,G;if(I==="c")V=D(U)+V,U="";else{U=+U;var H=U<0||1/U<0;if(U=isNaN(U)?d:D(Math.abs(U),k),A&&(U=G7e(U)),H&&+U==0&&v!=="+"&&(H=!1),W=(H?v==="("?v:c:v==="-"||v==="("?"":v)+W,V=(I==="s"?$9[8+GJ/3]:"")+V+(H&&v==="("?")":""),T){for(R=-1,F=U.length;++R<F;)if(G=U.charCodeAt(R),48>G||G>57){V=(G===46?i+U.slice(R+1):U.slice(R))+V,U=U.slice(0,R);break}}}E&&!w&&(U=s(U,1/0));var $=W.length+U.length+V.length,K=$<S?new Array(S-$+1).join(g):"";switch(E&&w&&(U=s(K+U,K.length?S-V.length:1/0),K=""),y){case"<":U=W+U+V+K;break;case"=":U=W+K+U+V;break;case"^":U=K.slice(0,$=K.length>>1)+W+U+V+K.slice($);break;default:U=K+W+U+V;break}return l(U)}return B.toString=function(){return x+""},B}function m(x,g){var y=u((x=zb(x),x.type="f",x)),v=Math.max(-8,Math.min(8,Math.floor(uf(g)/3)))*3,j=Math.pow(10,-v),w=$9[8+v/3];return function(S){return y(j*S)+w}}return{format:u,formatPrefix:m}}var hv,$D,KJ;X7e({thousands:",",grouping:[3],currency:["$",""]});function X7e(t){return hv=Y7e(t),$D=hv.format,KJ=hv.formatPrefix,hv}function Q7e(t){return Math.max(0,-uf(Math.abs(t)))}function Z7e(t,s){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(uf(s)/3)))*3-uf(Math.abs(t)))}function J7e(t,s){return t=Math.abs(t),s=Math.abs(s)-t,Math.max(0,uf(s)-uf(t))+1}function YJ(t,s,r,a){var i=vA(t,s,r),l;switch(a=zb(a??",f"),a.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(s));return a.precision==null&&!isNaN(l=Z7e(i,o))&&(a.precision=l),KJ(a,o)}case"":case"e":case"g":case"p":case"r":{a.precision==null&&!isNaN(l=J7e(i,Math.max(Math.abs(t),Math.abs(s))))&&(a.precision=l-(a.type==="e"));break}case"f":case"%":{a.precision==null&&!isNaN(l=Q7e(i))&&(a.precision=l-(a.type==="%")*2);break}}return $D(a)}function Om(t){var s=t.domain;return t.ticks=function(r){var a=s();return bA(a[0],a[a.length-1],r??10)},t.tickFormat=function(r,a){var i=s();return YJ(i[0],i[i.length-1],r??10,a)},t.nice=function(r){r==null&&(r=10);var a=s(),i=0,l=a.length-1,o=a[i],c=a[l],d,u,m=10;for(c<o&&(u=o,o=c,c=u,u=i,i=l,l=u);m-- >0;){if(u=yA(o,c,r),u===d)return a[i]=o,a[l]=c,s(a);if(u>0)o=Math.floor(o/u)*u,c=Math.ceil(c/u)*u;else if(u<0)o=Math.ceil(o*u)/u,c=Math.floor(c*u)/u;else break;d=u}return t},t}function XJ(){var t=FD();return t.copy=function(){return Sy(t,XJ())},Fo.apply(t,arguments),Om(t)}function QJ(t){var s;function r(a){return a==null||isNaN(a=+a)?s:a}return r.invert=r,r.domain=r.range=function(a){return arguments.length?(t=Array.from(a,aw),r):t.slice()},r.unknown=function(a){return arguments.length?(s=a,r):s},r.copy=function(){return QJ(t).unknown(s)},t=arguments.length?Array.from(t,aw):[0,1],Om(r)}function ZJ(t,s){t=t.slice();var r=0,a=t.length-1,i=t[r],l=t[a],o;return l<i&&(o=r,r=a,a=o,o=i,i=l,l=o),t[r]=s.floor(i),t[a]=s.ceil(l),t}function z9(t){return Math.log(t)}function U9(t){return Math.exp(t)}function e9e(t){return-Math.log(-t)}function t9e(t){return-Math.exp(-t)}function s9e(t){return isFinite(t)?+("1e"+t):t<0?0:t}function n9e(t){return t===10?s9e:t===Math.E?Math.exp:s=>Math.pow(t,s)}function r9e(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),s=>Math.log(s)/t)}function V9(t){return(s,r)=>-t(-s,r)}function zD(t){const s=t(z9,U9),r=s.domain;let a=10,i,l;function o(){return i=r9e(a),l=n9e(a),r()[0]<0?(i=V9(i),l=V9(l),t(e9e,t9e)):t(z9,U9),s}return s.base=function(c){return arguments.length?(a=+c,o()):a},s.domain=function(c){return arguments.length?(r(c),o()):r()},s.ticks=c=>{const d=r();let u=d[0],m=d[d.length-1];const x=m<u;x&&([u,m]=[m,u]);let g=i(u),y=i(m),v,j;const w=c==null?10:+c;let S=[];if(!(a%1)&&y-g<w){if(g=Math.floor(g),y=Math.ceil(y),u>0){for(;g<=y;++g)for(v=1;v<a;++v)if(j=g<0?v/l(-g):v*l(g),!(j<u)){if(j>m)break;S.push(j)}}else for(;g<=y;++g)for(v=a-1;v>=1;--v)if(j=g>0?v/l(-g):v*l(g),!(j<u)){if(j>m)break;S.push(j)}S.length*2<w&&(S=bA(u,m,w))}else S=bA(g,y,Math.min(y-g,w)).map(l);return x?S.reverse():S},s.tickFormat=(c,d)=>{if(c==null&&(c=10),d==null&&(d=a===10?"s":","),typeof d!="function"&&(!(a%1)&&(d=zb(d)).precision==null&&(d.trim=!0),d=$D(d)),c===1/0)return d;const u=Math.max(1,a*c/s.ticks().length);return m=>{let x=m/l(Math.round(i(m)));return x*a<a-.5&&(x*=a),x<=u?d(m):""}},s.nice=()=>r(ZJ(r(),{floor:c=>l(Math.floor(i(c))),ceil:c=>l(Math.ceil(i(c)))})),s}function JJ(){const t=zD(E_()).domain([1,10]);return t.copy=()=>Sy(t,JJ()).base(t.base()),Fo.apply(t,arguments),t}function H9(t){return function(s){return Math.sign(s)*Math.log1p(Math.abs(s/t))}}function W9(t){return function(s){return Math.sign(s)*Math.expm1(Math.abs(s))*t}}function UD(t){var s=1,r=t(H9(s),W9(s));return r.constant=function(a){return arguments.length?t(H9(s=+a),W9(s)):s},Om(r)}function eee(){var t=UD(E_());return t.copy=function(){return Sy(t,eee()).constant(t.constant())},Fo.apply(t,arguments)}function q9(t){return function(s){return s<0?-Math.pow(-s,t):Math.pow(s,t)}}function a9e(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function i9e(t){return t<0?-t*t:t*t}function VD(t){var s=t(Ai,Ai),r=1;function a(){return r===1?t(Ai,Ai):r===.5?t(a9e,i9e):t(q9(r),q9(1/r))}return s.exponent=function(i){return arguments.length?(r=+i,a()):r},Om(s)}function HD(){var t=VD(E_());return t.copy=function(){return Sy(t,HD()).exponent(t.exponent())},Fo.apply(t,arguments),t}function l9e(){return HD.apply(null,arguments).exponent(.5)}function G9(t){return Math.sign(t)*t*t}function o9e(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function tee(){var t=FD(),s=[0,1],r=!1,a;function i(l){var o=o9e(t(l));return isNaN(o)?a:r?Math.round(o):o}return i.invert=function(l){return t.invert(G9(l))},i.domain=function(l){return arguments.length?(t.domain(l),i):t.domain()},i.range=function(l){return arguments.length?(t.range((s=Array.from(l,aw)).map(G9)),i):s.slice()},i.rangeRound=function(l){return i.range(l).round(!0)},i.round=function(l){return arguments.length?(r=!!l,i):r},i.clamp=function(l){return arguments.length?(t.clamp(l),i):t.clamp()},i.unknown=function(l){return arguments.length?(a=l,i):a},i.copy=function(){return tee(t.domain(),s).round(r).clamp(t.clamp()).unknown(a)},Fo.apply(i,arguments),Om(i)}function see(){var t=[],s=[],r=[],a;function i(){var o=0,c=Math.max(1,s.length);for(r=new Array(c-1);++o<c;)r[o-1]=m7e(t,o/c);return l}function l(o){return o==null||isNaN(o=+o)?a:s[wy(r,o)]}return l.invertExtent=function(o){var c=s.indexOf(o);return c<0?[NaN,NaN]:[c>0?r[c-1]:t[0],c<r.length?r[c]:t[t.length-1]]},l.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let c of o)c!=null&&!isNaN(c=+c)&&t.push(c);return t.sort(cm),i()},l.range=function(o){return arguments.length?(s=Array.from(o),i()):s.slice()},l.unknown=function(o){return arguments.length?(a=o,l):a},l.quantiles=function(){return r.slice()},l.copy=function(){return see().domain(t).range(s).unknown(a)},Fo.apply(l,arguments)}function nee(){var t=0,s=1,r=1,a=[.5],i=[0,1],l;function o(d){return d!=null&&d<=d?i[wy(a,d,0,r)]:l}function c(){var d=-1;for(a=new Array(r);++d<r;)a[d]=((d+1)*s-(d-r)*t)/(r+1);return o}return o.domain=function(d){return arguments.length?([t,s]=d,t=+t,s=+s,c()):[t,s]},o.range=function(d){return arguments.length?(r=(i=Array.from(d)).length-1,c()):i.slice()},o.invertExtent=function(d){var u=i.indexOf(d);return u<0?[NaN,NaN]:u<1?[t,a[0]]:u>=r?[a[r-1],s]:[a[u-1],a[u]]},o.unknown=function(d){return arguments.length&&(l=d),o},o.thresholds=function(){return a.slice()},o.copy=function(){return nee().domain([t,s]).range(i).unknown(l)},Fo.apply(Om(o),arguments)}function ree(){var t=[.5],s=[0,1],r,a=1;function i(l){return l!=null&&l<=l?s[wy(t,l,0,a)]:r}return i.domain=function(l){return arguments.length?(t=Array.from(l),a=Math.min(t.length,s.length-1),i):t.slice()},i.range=function(l){return arguments.length?(s=Array.from(l),a=Math.min(t.length,s.length-1),i):s.slice()},i.invertExtent=function(l){var o=s.indexOf(l);return[t[o-1],t[o]]},i.unknown=function(l){return arguments.length?(r=l,i):r},i.copy=function(){return ree().domain(t).range(s).unknown(r)},Fo.apply(i,arguments)}const zk=new Date,Uk=new Date;function xa(t,s,r,a){function i(l){return t(l=arguments.length===0?new Date:new Date(+l)),l}return i.floor=l=>(t(l=new Date(+l)),l),i.ceil=l=>(t(l=new Date(l-1)),s(l,1),t(l),l),i.round=l=>{const o=i(l),c=i.ceil(l);return l-o<c-l?o:c},i.offset=(l,o)=>(s(l=new Date(+l),o==null?1:Math.floor(o)),l),i.range=(l,o,c)=>{const d=[];if(l=i.ceil(l),c=c==null?1:Math.floor(c),!(l<o)||!(c>0))return d;let u;do d.push(u=new Date(+l)),s(l,c),t(l);while(u<l&&l<o);return d},i.filter=l=>xa(o=>{if(o>=o)for(;t(o),!l(o);)o.setTime(o-1)},(o,c)=>{if(o>=o)if(c<0)for(;++c<=0;)for(;s(o,-1),!l(o););else for(;--c>=0;)for(;s(o,1),!l(o););}),r&&(i.count=(l,o)=>(zk.setTime(+l),Uk.setTime(+o),t(zk),t(Uk),Math.floor(r(zk,Uk))),i.every=l=>(l=Math.floor(l),!isFinite(l)||!(l>0)?null:l>1?i.filter(a?o=>a(o)%l===0:o=>i.count(0,o)%l===0):i)),i}const lw=xa(()=>{},(t,s)=>{t.setTime(+t+s)},(t,s)=>s-t);lw.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?xa(s=>{s.setTime(Math.floor(s/t)*t)},(s,r)=>{s.setTime(+s+r*t)},(s,r)=>(r-s)/t):lw);lw.range;const Ld=1e3,wo=Ld*60,Fd=wo*60,Jd=Fd*24,WD=Jd*7,K9=Jd*30,Vk=Jd*365,xh=xa(t=>{t.setTime(t-t.getMilliseconds())},(t,s)=>{t.setTime(+t+s*Ld)},(t,s)=>(s-t)/Ld,t=>t.getUTCSeconds());xh.range;const qD=xa(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Ld)},(t,s)=>{t.setTime(+t+s*wo)},(t,s)=>(s-t)/wo,t=>t.getMinutes());qD.range;const GD=xa(t=>{t.setUTCSeconds(0,0)},(t,s)=>{t.setTime(+t+s*wo)},(t,s)=>(s-t)/wo,t=>t.getUTCMinutes());GD.range;const KD=xa(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Ld-t.getMinutes()*wo)},(t,s)=>{t.setTime(+t+s*Fd)},(t,s)=>(s-t)/Fd,t=>t.getHours());KD.range;const YD=xa(t=>{t.setUTCMinutes(0,0,0)},(t,s)=>{t.setTime(+t+s*Fd)},(t,s)=>(s-t)/Fd,t=>t.getUTCHours());YD.range;const Cy=xa(t=>t.setHours(0,0,0,0),(t,s)=>t.setDate(t.getDate()+s),(t,s)=>(s-t-(s.getTimezoneOffset()-t.getTimezoneOffset())*wo)/Jd,t=>t.getDate()-1);Cy.range;const T_=xa(t=>{t.setUTCHours(0,0,0,0)},(t,s)=>{t.setUTCDate(t.getUTCDate()+s)},(t,s)=>(s-t)/Jd,t=>t.getUTCDate()-1);T_.range;const aee=xa(t=>{t.setUTCHours(0,0,0,0)},(t,s)=>{t.setUTCDate(t.getUTCDate()+s)},(t,s)=>(s-t)/Jd,t=>Math.floor(t/Jd));aee.range;function Nx(t){return xa(s=>{s.setDate(s.getDate()-(s.getDay()+7-t)%7),s.setHours(0,0,0,0)},(s,r)=>{s.setDate(s.getDate()+r*7)},(s,r)=>(r-s-(r.getTimezoneOffset()-s.getTimezoneOffset())*wo)/WD)}const P_=Nx(0),ow=Nx(1),c9e=Nx(2),d9e=Nx(3),mf=Nx(4),u9e=Nx(5),m9e=Nx(6);P_.range;ow.range;c9e.range;d9e.range;mf.range;u9e.range;m9e.range;function wx(t){return xa(s=>{s.setUTCDate(s.getUTCDate()-(s.getUTCDay()+7-t)%7),s.setUTCHours(0,0,0,0)},(s,r)=>{s.setUTCDate(s.getUTCDate()+r*7)},(s,r)=>(r-s)/WD)}const D_=wx(0),cw=wx(1),h9e=wx(2),x9e=wx(3),hf=wx(4),p9e=wx(5),f9e=wx(6);D_.range;cw.range;h9e.range;x9e.range;hf.range;p9e.range;f9e.range;const XD=xa(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,s)=>{t.setMonth(t.getMonth()+s)},(t,s)=>s.getMonth()-t.getMonth()+(s.getFullYear()-t.getFullYear())*12,t=>t.getMonth());XD.range;const QD=xa(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,s)=>{t.setUTCMonth(t.getUTCMonth()+s)},(t,s)=>s.getUTCMonth()-t.getUTCMonth()+(s.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());QD.range;const eu=xa(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,s)=>{t.setFullYear(t.getFullYear()+s)},(t,s)=>s.getFullYear()-t.getFullYear(),t=>t.getFullYear());eu.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:xa(s=>{s.setFullYear(Math.floor(s.getFullYear()/t)*t),s.setMonth(0,1),s.setHours(0,0,0,0)},(s,r)=>{s.setFullYear(s.getFullYear()+r*t)});eu.range;const tu=xa(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,s)=>{t.setUTCFullYear(t.getUTCFullYear()+s)},(t,s)=>s.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());tu.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:xa(s=>{s.setUTCFullYear(Math.floor(s.getUTCFullYear()/t)*t),s.setUTCMonth(0,1),s.setUTCHours(0,0,0,0)},(s,r)=>{s.setUTCFullYear(s.getUTCFullYear()+r*t)});tu.range;function iee(t,s,r,a,i,l){const o=[[xh,1,Ld],[xh,5,5*Ld],[xh,15,15*Ld],[xh,30,30*Ld],[l,1,wo],[l,5,5*wo],[l,15,15*wo],[l,30,30*wo],[i,1,Fd],[i,3,3*Fd],[i,6,6*Fd],[i,12,12*Fd],[a,1,Jd],[a,2,2*Jd],[r,1,WD],[s,1,K9],[s,3,3*K9],[t,1,Vk]];function c(u,m,x){const g=m<u;g&&([u,m]=[m,u]);const y=x&&typeof x.range=="function"?x:d(u,m,x),v=y?y.range(u,+m+1):[];return g?v.reverse():v}function d(u,m,x){const g=Math.abs(m-u)/x,y=DD(([,,w])=>w).right(o,g);if(y===o.length)return t.every(vA(u/Vk,m/Vk,x));if(y===0)return lw.every(Math.max(vA(u,m,x),1));const[v,j]=o[g/o[y-1][2]<o[y][2]/g?y-1:y];return v.every(j)}return[c,d]}const[g9e,b9e]=iee(tu,QD,D_,aee,YD,GD),[y9e,v9e]=iee(eu,XD,P_,Cy,KD,qD);function Hk(t){if(0<=t.y&&t.y<100){var s=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return s.setFullYear(t.y),s}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Wk(t){if(0<=t.y&&t.y<100){var s=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return s.setUTCFullYear(t.y),s}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function D0(t,s,r){return{y:t,m:s,d:r,H:0,M:0,S:0,L:0}}function j9e(t){var s=t.dateTime,r=t.date,a=t.time,i=t.periods,l=t.days,o=t.shortDays,c=t.months,d=t.shortMonths,u=M0(i),m=I0(i),x=M0(l),g=I0(l),y=M0(o),v=I0(o),j=M0(c),w=I0(c),S=M0(d),E=I0(d),k={a:H,A:$,b:K,B:le,c:null,d:eF,e:eF,f:H9e,g:eFe,G:sFe,H:z9e,I:U9e,j:V9e,L:lee,m:W9e,M:q9e,p:se,q:J,Q:nF,s:rF,S:G9e,u:K9e,U:Y9e,V:X9e,w:Q9e,W:Z9e,x:null,X:null,y:J9e,Y:tFe,Z:nFe,"%":sF},A={a:ie,A:te,b:ne,B:q,c:null,d:tF,e:tF,f:lFe,g:gFe,G:yFe,H:rFe,I:aFe,j:iFe,L:cee,m:oFe,M:cFe,p:ee,q:X,Q:nF,s:rF,S:dFe,u:uFe,U:mFe,V:hFe,w:xFe,W:pFe,x:null,X:null,y:fFe,Y:bFe,Z:vFe,"%":sF},I={a:B,A:U,b:W,B:V,c:R,d:Z9,e:Z9,f:L9e,g:Q9,G:X9,H:J9,I:J9,j:M9e,L:R9e,m:D9e,M:I9e,p:T,q:P9e,Q:B9e,s:$9e,S:O9e,u:C9e,U:k9e,V:A9e,w:S9e,W:E9e,x:F,X:G,y:Q9,Y:X9,Z:T9e,"%":F9e};k.x=P(r,k),k.X=P(a,k),k.c=P(s,k),A.x=P(r,A),A.X=P(a,A),A.c=P(s,A);function P(Z,Y){return function(Q){var oe=[],_e=-1,xe=0,me=Z.length,Re,Ze,$e;for(Q instanceof Date||(Q=new Date(+Q));++_e<me;)Z.charCodeAt(_e)===37&&(oe.push(Z.slice(xe,_e)),(Ze=Y9[Re=Z.charAt(++_e)])!=null?Re=Z.charAt(++_e):Ze=Re==="e"?" ":"0",($e=Y[Re])&&(Re=$e(Q,Ze)),oe.push(Re),xe=_e+1);return oe.push(Z.slice(xe,_e)),oe.join("")}}function O(Z,Y){return function(Q){var oe=D0(1900,void 0,1),_e=D(oe,Z,Q+="",0),xe,me;if(_e!=Q.length)return null;if("Q"in oe)return new Date(oe.Q);if("s"in oe)return new Date(oe.s*1e3+("L"in oe?oe.L:0));if(Y&&!("Z"in oe)&&(oe.Z=0),"p"in oe&&(oe.H=oe.H%12+oe.p*12),oe.m===void 0&&(oe.m="q"in oe?oe.q:0),"V"in oe){if(oe.V<1||oe.V>53)return null;"w"in oe||(oe.w=1),"Z"in oe?(xe=Wk(D0(oe.y,0,1)),me=xe.getUTCDay(),xe=me>4||me===0?cw.ceil(xe):cw(xe),xe=T_.offset(xe,(oe.V-1)*7),oe.y=xe.getUTCFullYear(),oe.m=xe.getUTCMonth(),oe.d=xe.getUTCDate()+(oe.w+6)%7):(xe=Hk(D0(oe.y,0,1)),me=xe.getDay(),xe=me>4||me===0?ow.ceil(xe):ow(xe),xe=Cy.offset(xe,(oe.V-1)*7),oe.y=xe.getFullYear(),oe.m=xe.getMonth(),oe.d=xe.getDate()+(oe.w+6)%7)}else("W"in oe||"U"in oe)&&("w"in oe||(oe.w="u"in oe?oe.u%7:"W"in oe?1:0),me="Z"in oe?Wk(D0(oe.y,0,1)).getUTCDay():Hk(D0(oe.y,0,1)).getDay(),oe.m=0,oe.d="W"in oe?(oe.w+6)%7+oe.W*7-(me+5)%7:oe.w+oe.U*7-(me+6)%7);return"Z"in oe?(oe.H+=oe.Z/100|0,oe.M+=oe.Z%100,Wk(oe)):Hk(oe)}}function D(Z,Y,Q,oe){for(var _e=0,xe=Y.length,me=Q.length,Re,Ze;_e<xe;){if(oe>=me)return-1;if(Re=Y.charCodeAt(_e++),Re===37){if(Re=Y.charAt(_e++),Ze=I[Re in Y9?Y.charAt(_e++):Re],!Ze||(oe=Ze(Z,Q,oe))<0)return-1}else if(Re!=Q.charCodeAt(oe++))return-1}return oe}function T(Z,Y,Q){var oe=u.exec(Y.slice(Q));return oe?(Z.p=m.get(oe[0].toLowerCase()),Q+oe[0].length):-1}function B(Z,Y,Q){var oe=y.exec(Y.slice(Q));return oe?(Z.w=v.get(oe[0].toLowerCase()),Q+oe[0].length):-1}function U(Z,Y,Q){var oe=x.exec(Y.slice(Q));return oe?(Z.w=g.get(oe[0].toLowerCase()),Q+oe[0].length):-1}function W(Z,Y,Q){var oe=S.exec(Y.slice(Q));return oe?(Z.m=E.get(oe[0].toLowerCase()),Q+oe[0].length):-1}function V(Z,Y,Q){var oe=j.exec(Y.slice(Q));return oe?(Z.m=w.get(oe[0].toLowerCase()),Q+oe[0].length):-1}function R(Z,Y,Q){return D(Z,s,Y,Q)}function F(Z,Y,Q){return D(Z,r,Y,Q)}function G(Z,Y,Q){return D(Z,a,Y,Q)}function H(Z){return o[Z.getDay()]}function $(Z){return l[Z.getDay()]}function K(Z){return d[Z.getMonth()]}function le(Z){return c[Z.getMonth()]}function se(Z){return i[+(Z.getHours()>=12)]}function J(Z){return 1+~~(Z.getMonth()/3)}function ie(Z){return o[Z.getUTCDay()]}function te(Z){return l[Z.getUTCDay()]}function ne(Z){return d[Z.getUTCMonth()]}function q(Z){return c[Z.getUTCMonth()]}function ee(Z){return i[+(Z.getUTCHours()>=12)]}function X(Z){return 1+~~(Z.getUTCMonth()/3)}return{format:function(Z){var Y=P(Z+="",k);return Y.toString=function(){return Z},Y},parse:function(Z){var Y=O(Z+="",!1);return Y.toString=function(){return Z},Y},utcFormat:function(Z){var Y=P(Z+="",A);return Y.toString=function(){return Z},Y},utcParse:function(Z){var Y=O(Z+="",!0);return Y.toString=function(){return Z},Y}}}var Y9={"-":"",_:" ",0:"0"},ka=/^\s*\d+/,N9e=/^%/,w9e=/[\\^$*+?|[\]().{}]/g;function rn(t,s,r){var a=t<0?"-":"",i=(a?-t:t)+"",l=i.length;return a+(l<r?new Array(r-l+1).join(s)+i:i)}function _9e(t){return t.replace(w9e,"\\$&")}function M0(t){return new RegExp("^(?:"+t.map(_9e).join("|")+")","i")}function I0(t){return new Map(t.map((s,r)=>[s.toLowerCase(),r]))}function S9e(t,s,r){var a=ka.exec(s.slice(r,r+1));return a?(t.w=+a[0],r+a[0].length):-1}function C9e(t,s,r){var a=ka.exec(s.slice(r,r+1));return a?(t.u=+a[0],r+a[0].length):-1}function k9e(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.U=+a[0],r+a[0].length):-1}function A9e(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.V=+a[0],r+a[0].length):-1}function E9e(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.W=+a[0],r+a[0].length):-1}function X9(t,s,r){var a=ka.exec(s.slice(r,r+4));return a?(t.y=+a[0],r+a[0].length):-1}function Q9(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.y=+a[0]+(+a[0]>68?1900:2e3),r+a[0].length):-1}function T9e(t,s,r){var a=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(s.slice(r,r+6));return a?(t.Z=a[1]?0:-(a[2]+(a[3]||"00")),r+a[0].length):-1}function P9e(t,s,r){var a=ka.exec(s.slice(r,r+1));return a?(t.q=a[0]*3-3,r+a[0].length):-1}function D9e(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.m=a[0]-1,r+a[0].length):-1}function Z9(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.d=+a[0],r+a[0].length):-1}function M9e(t,s,r){var a=ka.exec(s.slice(r,r+3));return a?(t.m=0,t.d=+a[0],r+a[0].length):-1}function J9(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.H=+a[0],r+a[0].length):-1}function I9e(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.M=+a[0],r+a[0].length):-1}function O9e(t,s,r){var a=ka.exec(s.slice(r,r+2));return a?(t.S=+a[0],r+a[0].length):-1}function R9e(t,s,r){var a=ka.exec(s.slice(r,r+3));return a?(t.L=+a[0],r+a[0].length):-1}function L9e(t,s,r){var a=ka.exec(s.slice(r,r+6));return a?(t.L=Math.floor(a[0]/1e3),r+a[0].length):-1}function F9e(t,s,r){var a=N9e.exec(s.slice(r,r+1));return a?r+a[0].length:-1}function B9e(t,s,r){var a=ka.exec(s.slice(r));return a?(t.Q=+a[0],r+a[0].length):-1}function $9e(t,s,r){var a=ka.exec(s.slice(r));return a?(t.s=+a[0],r+a[0].length):-1}function eF(t,s){return rn(t.getDate(),s,2)}function z9e(t,s){return rn(t.getHours(),s,2)}function U9e(t,s){return rn(t.getHours()%12||12,s,2)}function V9e(t,s){return rn(1+Cy.count(eu(t),t),s,3)}function lee(t,s){return rn(t.getMilliseconds(),s,3)}function H9e(t,s){return lee(t,s)+"000"}function W9e(t,s){return rn(t.getMonth()+1,s,2)}function q9e(t,s){return rn(t.getMinutes(),s,2)}function G9e(t,s){return rn(t.getSeconds(),s,2)}function K9e(t){var s=t.getDay();return s===0?7:s}function Y9e(t,s){return rn(P_.count(eu(t)-1,t),s,2)}function oee(t){var s=t.getDay();return s>=4||s===0?mf(t):mf.ceil(t)}function X9e(t,s){return t=oee(t),rn(mf.count(eu(t),t)+(eu(t).getDay()===4),s,2)}function Q9e(t){return t.getDay()}function Z9e(t,s){return rn(ow.count(eu(t)-1,t),s,2)}function J9e(t,s){return rn(t.getFullYear()%100,s,2)}function eFe(t,s){return t=oee(t),rn(t.getFullYear()%100,s,2)}function tFe(t,s){return rn(t.getFullYear()%1e4,s,4)}function sFe(t,s){var r=t.getDay();return t=r>=4||r===0?mf(t):mf.ceil(t),rn(t.getFullYear()%1e4,s,4)}function nFe(t){var s=t.getTimezoneOffset();return(s>0?"-":(s*=-1,"+"))+rn(s/60|0,"0",2)+rn(s%60,"0",2)}function tF(t,s){return rn(t.getUTCDate(),s,2)}function rFe(t,s){return rn(t.getUTCHours(),s,2)}function aFe(t,s){return rn(t.getUTCHours()%12||12,s,2)}function iFe(t,s){return rn(1+T_.count(tu(t),t),s,3)}function cee(t,s){return rn(t.getUTCMilliseconds(),s,3)}function lFe(t,s){return cee(t,s)+"000"}function oFe(t,s){return rn(t.getUTCMonth()+1,s,2)}function cFe(t,s){return rn(t.getUTCMinutes(),s,2)}function dFe(t,s){return rn(t.getUTCSeconds(),s,2)}function uFe(t){var s=t.getUTCDay();return s===0?7:s}function mFe(t,s){return rn(D_.count(tu(t)-1,t),s,2)}function dee(t){var s=t.getUTCDay();return s>=4||s===0?hf(t):hf.ceil(t)}function hFe(t,s){return t=dee(t),rn(hf.count(tu(t),t)+(tu(t).getUTCDay()===4),s,2)}function xFe(t){return t.getUTCDay()}function pFe(t,s){return rn(cw.count(tu(t)-1,t),s,2)}function fFe(t,s){return rn(t.getUTCFullYear()%100,s,2)}function gFe(t,s){return t=dee(t),rn(t.getUTCFullYear()%100,s,2)}function bFe(t,s){return rn(t.getUTCFullYear()%1e4,s,4)}function yFe(t,s){var r=t.getUTCDay();return t=r>=4||r===0?hf(t):hf.ceil(t),rn(t.getUTCFullYear()%1e4,s,4)}function vFe(){return"+0000"}function sF(){return"%"}function nF(t){return+t}function rF(t){return Math.floor(+t/1e3)}var $x,uee,mee;jFe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function jFe(t){return $x=j9e(t),uee=$x.format,$x.parse,mee=$x.utcFormat,$x.utcParse,$x}function NFe(t){return new Date(t)}function wFe(t){return t instanceof Date?+t:+new Date(+t)}function ZD(t,s,r,a,i,l,o,c,d,u){var m=FD(),x=m.invert,g=m.domain,y=u(".%L"),v=u(":%S"),j=u("%I:%M"),w=u("%I %p"),S=u("%a %d"),E=u("%b %d"),k=u("%B"),A=u("%Y");function I(P){return(d(P)<P?y:c(P)<P?v:o(P)<P?j:l(P)<P?w:a(P)<P?i(P)<P?S:E:r(P)<P?k:A)(P)}return m.invert=function(P){return new Date(x(P))},m.domain=function(P){return arguments.length?g(Array.from(P,wFe)):g().map(NFe)},m.ticks=function(P){var O=g();return t(O[0],O[O.length-1],P??10)},m.tickFormat=function(P,O){return O==null?I:u(O)},m.nice=function(P){var O=g();return(!P||typeof P.range!="function")&&(P=s(O[0],O[O.length-1],P??10)),P?g(ZJ(O,P)):m},m.copy=function(){return Sy(m,ZD(t,s,r,a,i,l,o,c,d,u))},m}function _Fe(){return Fo.apply(ZD(y9e,v9e,eu,XD,P_,Cy,KD,qD,xh,uee).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function SFe(){return Fo.apply(ZD(g9e,b9e,tu,QD,D_,T_,YD,GD,xh,mee).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function M_(){var t=0,s=1,r,a,i,l,o=Ai,c=!1,d;function u(x){return x==null||isNaN(x=+x)?d:o(i===0?.5:(x=(l(x)-r)*i,c?Math.max(0,Math.min(1,x)):x))}u.domain=function(x){return arguments.length?([t,s]=x,r=l(t=+t),a=l(s=+s),i=r===a?0:1/(a-r),u):[t,s]},u.clamp=function(x){return arguments.length?(c=!!x,u):c},u.interpolator=function(x){return arguments.length?(o=x,u):o};function m(x){return function(g){var y,v;return arguments.length?([y,v]=g,o=x(y,v),u):[o(0),o(1)]}}return u.range=m(Lf),u.rangeRound=m(LD),u.unknown=function(x){return arguments.length?(d=x,u):d},function(x){return l=x,r=x(t),a=x(s),i=r===a?0:1/(a-r),u}}function Rm(t,s){return s.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function hee(){var t=Om(M_()(Ai));return t.copy=function(){return Rm(t,hee())},du.apply(t,arguments)}function xee(){var t=zD(M_()).domain([1,10]);return t.copy=function(){return Rm(t,xee()).base(t.base())},du.apply(t,arguments)}function pee(){var t=UD(M_());return t.copy=function(){return Rm(t,pee()).constant(t.constant())},du.apply(t,arguments)}function JD(){var t=VD(M_());return t.copy=function(){return Rm(t,JD()).exponent(t.exponent())},du.apply(t,arguments)}function CFe(){return JD.apply(null,arguments).exponent(.5)}function fee(){var t=[],s=Ai;function r(a){if(a!=null&&!isNaN(a=+a))return s((wy(t,a,1)-1)/(t.length-1))}return r.domain=function(a){if(!arguments.length)return t.slice();t=[];for(let i of a)i!=null&&!isNaN(i=+i)&&t.push(i);return t.sort(cm),r},r.interpolator=function(a){return arguments.length?(s=a,r):s},r.range=function(){return t.map((a,i)=>s(i/(t.length-1)))},r.quantiles=function(a){return Array.from({length:a+1},(i,l)=>u7e(t,l/a))},r.copy=function(){return fee(s).domain(t)},du.apply(r,arguments)}function I_(){var t=0,s=.5,r=1,a=1,i,l,o,c,d,u=Ai,m,x=!1,g;function y(j){return isNaN(j=+j)?g:(j=.5+((j=+m(j))-l)*(a*j<a*l?c:d),u(x?Math.max(0,Math.min(1,j)):j))}y.domain=function(j){return arguments.length?([t,s,r]=j,i=m(t=+t),l=m(s=+s),o=m(r=+r),c=i===l?0:.5/(l-i),d=l===o?0:.5/(o-l),a=l<i?-1:1,y):[t,s,r]},y.clamp=function(j){return arguments.length?(x=!!j,y):x},y.interpolator=function(j){return arguments.length?(u=j,y):u};function v(j){return function(w){var S,E,k;return arguments.length?([S,E,k]=w,u=F7e(j,[S,E,k]),y):[u(0),u(.5),u(1)]}}return y.range=v(Lf),y.rangeRound=v(LD),y.unknown=function(j){return arguments.length?(g=j,y):g},function(j){return m=j,i=j(t),l=j(s),o=j(r),c=i===l?0:.5/(l-i),d=l===o?0:.5/(o-l),a=l<i?-1:1,y}}function gee(){var t=Om(I_()(Ai));return t.copy=function(){return Rm(t,gee())},du.apply(t,arguments)}function bee(){var t=zD(I_()).domain([.1,1,10]);return t.copy=function(){return Rm(t,bee()).base(t.base())},du.apply(t,arguments)}function yee(){var t=UD(I_());return t.copy=function(){return Rm(t,yee()).constant(t.constant())},du.apply(t,arguments)}function eM(){var t=VD(I_());return t.copy=function(){return Rm(t,eM()).exponent(t.exponent())},du.apply(t,arguments)}function kFe(){return eM.apply(null,arguments).exponent(.5)}const og=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:ID,scaleDiverging:gee,scaleDivergingLog:bee,scaleDivergingPow:eM,scaleDivergingSqrt:kFe,scaleDivergingSymlog:yee,scaleIdentity:QJ,scaleImplicit:jA,scaleLinear:XJ,scaleLog:JJ,scaleOrdinal:MD,scalePoint:x7e,scalePow:HD,scaleQuantile:see,scaleQuantize:nee,scaleRadial:tee,scaleSequential:hee,scaleSequentialLog:xee,scaleSequentialPow:JD,scaleSequentialQuantile:fee,scaleSequentialSqrt:CFe,scaleSequentialSymlog:pee,scaleSqrt:l9e,scaleSymlog:eee,scaleThreshold:ree,scaleTime:_Fe,scaleUtc:SFe,tickFormat:YJ},Symbol.toStringTag,{value:"Module"}));var Lm=t=>t.chartData,tM=Je([Lm],t=>{var s=t.chartData!=null?t.chartData.length-1:0;return{chartData:t.chartData,computedData:t.computedData,dataEndIndex:s,dataStartIndex:0}}),sM=(t,s,r,a)=>a?tM(t):Lm(t);function rx(t){if(Array.isArray(t)&&t.length===2){var[s,r]=t;if(Mr(s)&&Mr(r))return!0}return!1}function aF(t,s,r){return r?t:[Math.min(t[0],s[0]),Math.max(t[1],s[1])]}function vee(t,s){if(s&&typeof t!="function"&&Array.isArray(t)&&t.length===2){var[r,a]=t,i,l;if(Mr(r))i=r;else if(typeof r=="function")return;if(Mr(a))l=a;else if(typeof a=="function")return;var o=[i,l];if(rx(o))return o}}function AFe(t,s,r){if(!(!r&&s==null)){if(typeof t=="function"&&s!=null)try{var a=t(s,r);if(rx(a))return aF(a,s,r)}catch{}if(Array.isArray(t)&&t.length===2){var[i,l]=t,o,c;if(i==="auto")s!=null&&(o=Math.min(...s));else if(as(i))o=i;else if(typeof i=="function")try{s!=null&&(o=i(s==null?void 0:s[0]))}catch{}else if(typeof i=="string"&&K7.test(i)){var d=K7.exec(i);if(d==null||s==null)o=void 0;else{var u=+d[1];o=s[0]-u}}else o=s==null?void 0:s[0];if(l==="auto")s!=null&&(c=Math.max(...s));else if(as(l))c=l;else if(typeof l=="function")try{s!=null&&(c=l(s==null?void 0:s[1]))}catch{}else if(typeof l=="string"&&Y7.test(l)){var m=Y7.exec(l);if(m==null||s==null)c=void 0;else{var x=+m[1];c=s[1]+x}}else c=s==null?void 0:s[1];var g=[o,c];if(rx(g))return s==null?g:aF(g,s,r)}}}var Ff=1e9,EFe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},rM,Yn=!0,Oo="[DecimalError] ",Oh=Oo+"Invalid argument: ",nM=Oo+"Exponent out of range: ",Bf=Math.floor,Jm=Math.pow,TFe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Il,ba=1e7,Ln=7,jee=9007199254740991,dw=Bf(jee/Ln),qt={};qt.absoluteValue=qt.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};qt.comparedTo=qt.cmp=function(t){var s,r,a,i,l=this;if(t=new l.constructor(t),l.s!==t.s)return l.s||-t.s;if(l.e!==t.e)return l.e>t.e^l.s<0?1:-1;for(a=l.d.length,i=t.d.length,s=0,r=a<i?a:i;s<r;++s)if(l.d[s]!==t.d[s])return l.d[s]>t.d[s]^l.s<0?1:-1;return a===i?0:a>i^l.s<0?1:-1};qt.decimalPlaces=qt.dp=function(){var t=this,s=t.d.length-1,r=(s-t.e)*Ln;if(s=t.d[s],s)for(;s%10==0;s/=10)r--;return r<0?0:r};qt.dividedBy=qt.div=function(t){return Ud(this,new this.constructor(t))};qt.dividedToIntegerBy=qt.idiv=function(t){var s=this,r=s.constructor;return _n(Ud(s,new r(t),0,1),r.precision)};qt.equals=qt.eq=function(t){return!this.cmp(t)};qt.exponent=function(){return Xr(this)};qt.greaterThan=qt.gt=function(t){return this.cmp(t)>0};qt.greaterThanOrEqualTo=qt.gte=function(t){return this.cmp(t)>=0};qt.isInteger=qt.isint=function(){return this.e>this.d.length-2};qt.isNegative=qt.isneg=function(){return this.s<0};qt.isPositive=qt.ispos=function(){return this.s>0};qt.isZero=function(){return this.s===0};qt.lessThan=qt.lt=function(t){return this.cmp(t)<0};qt.lessThanOrEqualTo=qt.lte=function(t){return this.cmp(t)<1};qt.logarithm=qt.log=function(t){var s,r=this,a=r.constructor,i=a.precision,l=i+5;if(t===void 0)t=new a(10);else if(t=new a(t),t.s<1||t.eq(Il))throw Error(Oo+"NaN");if(r.s<1)throw Error(Oo+(r.s?"NaN":"-Infinity"));return r.eq(Il)?new a(0):(Yn=!1,s=Ud(Ub(r,l),Ub(t,l),l),Yn=!0,_n(s,i))};qt.minus=qt.sub=function(t){var s=this;return t=new s.constructor(t),s.s==t.s?_ee(s,t):Nee(s,(t.s=-t.s,t))};qt.modulo=qt.mod=function(t){var s,r=this,a=r.constructor,i=a.precision;if(t=new a(t),!t.s)throw Error(Oo+"NaN");return r.s?(Yn=!1,s=Ud(r,t,0,1).times(t),Yn=!0,r.minus(s)):_n(new a(r),i)};qt.naturalExponential=qt.exp=function(){return wee(this)};qt.naturalLogarithm=qt.ln=function(){return Ub(this)};qt.negated=qt.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};qt.plus=qt.add=function(t){var s=this;return t=new s.constructor(t),s.s==t.s?Nee(s,t):_ee(s,(t.s=-t.s,t))};qt.precision=qt.sd=function(t){var s,r,a,i=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(Oh+t);if(s=Xr(i)+1,a=i.d.length-1,r=a*Ln+1,a=i.d[a],a){for(;a%10==0;a/=10)r--;for(a=i.d[0];a>=10;a/=10)r++}return t&&s>r?s:r};qt.squareRoot=qt.sqrt=function(){var t,s,r,a,i,l,o,c=this,d=c.constructor;if(c.s<1){if(!c.s)return new d(0);throw Error(Oo+"NaN")}for(t=Xr(c),Yn=!1,i=Math.sqrt(+c),i==0||i==1/0?(s=Yc(c.d),(s.length+t)%2==0&&(s+="0"),i=Math.sqrt(s),t=Bf((t+1)/2)-(t<0||t%2),i==1/0?s="5e"+t:(s=i.toExponential(),s=s.slice(0,s.indexOf("e")+1)+t),a=new d(s)):a=new d(i.toString()),r=d.precision,i=o=r+3;;)if(l=a,a=l.plus(Ud(c,l,o+2)).times(.5),Yc(l.d).slice(0,o)===(s=Yc(a.d)).slice(0,o)){if(s=s.slice(o-3,o+1),i==o&&s=="4999"){if(_n(l,r+1,0),l.times(l).eq(c)){a=l;break}}else if(s!="9999")break;o+=4}return Yn=!0,_n(a,r)};qt.times=qt.mul=function(t){var s,r,a,i,l,o,c,d,u,m=this,x=m.constructor,g=m.d,y=(t=new x(t)).d;if(!m.s||!t.s)return new x(0);for(t.s*=m.s,r=m.e+t.e,d=g.length,u=y.length,d<u&&(l=g,g=y,y=l,o=d,d=u,u=o),l=[],o=d+u,a=o;a--;)l.push(0);for(a=u;--a>=0;){for(s=0,i=d+a;i>a;)c=l[i]+y[a]*g[i-a-1]+s,l[i--]=c%ba|0,s=c/ba|0;l[i]=(l[i]+s)%ba|0}for(;!l[--o];)l.pop();return s?++r:l.shift(),t.d=l,t.e=r,Yn?_n(t,x.precision):t};qt.toDecimalPlaces=qt.todp=function(t,s){var r=this,a=r.constructor;return r=new a(r),t===void 0?r:(ud(t,0,Ff),s===void 0?s=a.rounding:ud(s,0,8),_n(r,t+Xr(r)+1,s))};qt.toExponential=function(t,s){var r,a=this,i=a.constructor;return t===void 0?r=ax(a,!0):(ud(t,0,Ff),s===void 0?s=i.rounding:ud(s,0,8),a=_n(new i(a),t+1,s),r=ax(a,!0,t+1)),r};qt.toFixed=function(t,s){var r,a,i=this,l=i.constructor;return t===void 0?ax(i):(ud(t,0,Ff),s===void 0?s=l.rounding:ud(s,0,8),a=_n(new l(i),t+Xr(i)+1,s),r=ax(a.abs(),!1,t+Xr(a)+1),i.isneg()&&!i.isZero()?"-"+r:r)};qt.toInteger=qt.toint=function(){var t=this,s=t.constructor;return _n(new s(t),Xr(t)+1,s.rounding)};qt.toNumber=function(){return+this};qt.toPower=qt.pow=function(t){var s,r,a,i,l,o,c=this,d=c.constructor,u=12,m=+(t=new d(t));if(!t.s)return new d(Il);if(c=new d(c),!c.s){if(t.s<1)throw Error(Oo+"Infinity");return c}if(c.eq(Il))return c;if(a=d.precision,t.eq(Il))return _n(c,a);if(s=t.e,r=t.d.length-1,o=s>=r,l=c.s,o){if((r=m<0?-m:m)<=jee){for(i=new d(Il),s=Math.ceil(a/Ln+4),Yn=!1;r%2&&(i=i.times(c),lF(i.d,s)),r=Bf(r/2),r!==0;)c=c.times(c),lF(c.d,s);return Yn=!0,t.s<0?new d(Il).div(i):_n(i,a)}}else if(l<0)throw Error(Oo+"NaN");return l=l<0&&t.d[Math.max(s,r)]&1?-1:1,c.s=1,Yn=!1,i=t.times(Ub(c,a+u)),Yn=!0,i=wee(i),i.s=l,i};qt.toPrecision=function(t,s){var r,a,i=this,l=i.constructor;return t===void 0?(r=Xr(i),a=ax(i,r<=l.toExpNeg||r>=l.toExpPos)):(ud(t,1,Ff),s===void 0?s=l.rounding:ud(s,0,8),i=_n(new l(i),t,s),r=Xr(i),a=ax(i,t<=r||r<=l.toExpNeg,t)),a};qt.toSignificantDigits=qt.tosd=function(t,s){var r=this,a=r.constructor;return t===void 0?(t=a.precision,s=a.rounding):(ud(t,1,Ff),s===void 0?s=a.rounding:ud(s,0,8)),_n(new a(r),t,s)};qt.toString=qt.valueOf=qt.val=qt.toJSON=qt[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,s=Xr(t),r=t.constructor;return ax(t,s<=r.toExpNeg||s>=r.toExpPos)};function Nee(t,s){var r,a,i,l,o,c,d,u,m=t.constructor,x=m.precision;if(!t.s||!s.s)return s.s||(s=new m(t)),Yn?_n(s,x):s;if(d=t.d,u=s.d,o=t.e,i=s.e,d=d.slice(),l=o-i,l){for(l<0?(a=d,l=-l,c=u.length):(a=u,i=o,c=d.length),o=Math.ceil(x/Ln),c=o>c?o+1:c+1,l>c&&(l=c,a.length=1),a.reverse();l--;)a.push(0);a.reverse()}for(c=d.length,l=u.length,c-l<0&&(l=c,a=u,u=d,d=a),r=0;l;)r=(d[--l]=d[l]+u[l]+r)/ba|0,d[l]%=ba;for(r&&(d.unshift(r),++i),c=d.length;d[--c]==0;)d.pop();return s.d=d,s.e=i,Yn?_n(s,x):s}function ud(t,s,r){if(t!==~~t||t<s||t>r)throw Error(Oh+t)}function Yc(t){var s,r,a,i=t.length-1,l="",o=t[0];if(i>0){for(l+=o,s=1;s<i;s++)a=t[s]+"",r=Ln-a.length,r&&(l+=Bu(r)),l+=a;o=t[s],a=o+"",r=Ln-a.length,r&&(l+=Bu(r))}else if(o===0)return"0";for(;o%10===0;)o/=10;return l+o}var Ud=function(){function t(a,i){var l,o=0,c=a.length;for(a=a.slice();c--;)l=a[c]*i+o,a[c]=l%ba|0,o=l/ba|0;return o&&a.unshift(o),a}function s(a,i,l,o){var c,d;if(l!=o)d=l>o?1:-1;else for(c=d=0;c<l;c++)if(a[c]!=i[c]){d=a[c]>i[c]?1:-1;break}return d}function r(a,i,l){for(var o=0;l--;)a[l]-=o,o=a[l]<i[l]?1:0,a[l]=o*ba+a[l]-i[l];for(;!a[0]&&a.length>1;)a.shift()}return function(a,i,l,o){var c,d,u,m,x,g,y,v,j,w,S,E,k,A,I,P,O,D,T=a.constructor,B=a.s==i.s?1:-1,U=a.d,W=i.d;if(!a.s)return new T(a);if(!i.s)throw Error(Oo+"Division by zero");for(d=a.e-i.e,O=W.length,I=U.length,y=new T(B),v=y.d=[],u=0;W[u]==(U[u]||0);)++u;if(W[u]>(U[u]||0)&&--d,l==null?E=l=T.precision:o?E=l+(Xr(a)-Xr(i))+1:E=l,E<0)return new T(0);if(E=E/Ln+2|0,u=0,O==1)for(m=0,W=W[0],E++;(u<I||m)&&E--;u++)k=m*ba+(U[u]||0),v[u]=k/W|0,m=k%W|0;else{for(m=ba/(W[0]+1)|0,m>1&&(W=t(W,m),U=t(U,m),O=W.length,I=U.length),A=O,j=U.slice(0,O),w=j.length;w<O;)j[w++]=0;D=W.slice(),D.unshift(0),P=W[0],W[1]>=ba/2&&++P;do m=0,c=s(W,j,O,w),c<0?(S=j[0],O!=w&&(S=S*ba+(j[1]||0)),m=S/P|0,m>1?(m>=ba&&(m=ba-1),x=t(W,m),g=x.length,w=j.length,c=s(x,j,g,w),c==1&&(m--,r(x,O<g?D:W,g))):(m==0&&(c=m=1),x=W.slice()),g=x.length,g<w&&x.unshift(0),r(j,x,w),c==-1&&(w=j.length,c=s(W,j,O,w),c<1&&(m++,r(j,O<w?D:W,w))),w=j.length):c===0&&(m++,j=[0]),v[u++]=m,c&&j[0]?j[w++]=U[A]||0:(j=[U[A]],w=1);while((A++<I||j[0]!==void 0)&&E--)}return v[0]||v.shift(),y.e=d,_n(y,o?l+Xr(y)+1:l)}}();function wee(t,s){var r,a,i,l,o,c,d=0,u=0,m=t.constructor,x=m.precision;if(Xr(t)>16)throw Error(nM+Xr(t));if(!t.s)return new m(Il);for(Yn=!1,c=x,o=new m(.03125);t.abs().gte(.1);)t=t.times(o),u+=5;for(a=Math.log(Jm(2,u))/Math.LN10*2+5|0,c+=a,r=i=l=new m(Il),m.precision=c;;){if(i=_n(i.times(t),c),r=r.times(++d),o=l.plus(Ud(i,r,c)),Yc(o.d).slice(0,c)===Yc(l.d).slice(0,c)){for(;u--;)l=_n(l.times(l),c);return m.precision=x,s==null?(Yn=!0,_n(l,x)):l}l=o}}function Xr(t){for(var s=t.e*Ln,r=t.d[0];r>=10;r/=10)s++;return s}function qk(t,s,r){if(s>t.LN10.sd())throw Yn=!0,r&&(t.precision=r),Error(Oo+"LN10 precision limit exceeded");return _n(new t(t.LN10),s)}function Bu(t){for(var s="";t--;)s+="0";return s}function Ub(t,s){var r,a,i,l,o,c,d,u,m,x=1,g=10,y=t,v=y.d,j=y.constructor,w=j.precision;if(y.s<1)throw Error(Oo+(y.s?"NaN":"-Infinity"));if(y.eq(Il))return new j(0);if(s==null?(Yn=!1,u=w):u=s,y.eq(10))return s==null&&(Yn=!0),qk(j,u);if(u+=g,j.precision=u,r=Yc(v),a=r.charAt(0),l=Xr(y),Math.abs(l)<15e14){for(;a<7&&a!=1||a==1&&r.charAt(1)>3;)y=y.times(t),r=Yc(y.d),a=r.charAt(0),x++;l=Xr(y),a>1?(y=new j("0."+r),l++):y=new j(a+"."+r.slice(1))}else return d=qk(j,u+2,w).times(l+""),y=Ub(new j(a+"."+r.slice(1)),u-g).plus(d),j.precision=w,s==null?(Yn=!0,_n(y,w)):y;for(c=o=y=Ud(y.minus(Il),y.plus(Il),u),m=_n(y.times(y),u),i=3;;){if(o=_n(o.times(m),u),d=c.plus(Ud(o,new j(i),u)),Yc(d.d).slice(0,u)===Yc(c.d).slice(0,u))return c=c.times(2),l!==0&&(c=c.plus(qk(j,u+2,w).times(l+""))),c=Ud(c,new j(x),u),j.precision=w,s==null?(Yn=!0,_n(c,w)):c;c=d,i+=2}}function iF(t,s){var r,a,i;for((r=s.indexOf("."))>-1&&(s=s.replace(".","")),(a=s.search(/e/i))>0?(r<0&&(r=a),r+=+s.slice(a+1),s=s.substring(0,a)):r<0&&(r=s.length),a=0;s.charCodeAt(a)===48;)++a;for(i=s.length;s.charCodeAt(i-1)===48;)--i;if(s=s.slice(a,i),s){if(i-=a,r=r-a-1,t.e=Bf(r/Ln),t.d=[],a=(r+1)%Ln,r<0&&(a+=Ln),a<i){for(a&&t.d.push(+s.slice(0,a)),i-=Ln;a<i;)t.d.push(+s.slice(a,a+=Ln));s=s.slice(a),a=Ln-s.length}else a-=i;for(;a--;)s+="0";if(t.d.push(+s),Yn&&(t.e>dw||t.e<-dw))throw Error(nM+r)}else t.s=0,t.e=0,t.d=[0];return t}function _n(t,s,r){var a,i,l,o,c,d,u,m,x=t.d;for(o=1,l=x[0];l>=10;l/=10)o++;if(a=s-o,a<0)a+=Ln,i=s,u=x[m=0];else{if(m=Math.ceil((a+1)/Ln),l=x.length,m>=l)return t;for(u=l=x[m],o=1;l>=10;l/=10)o++;a%=Ln,i=a-Ln+o}if(r!==void 0&&(l=Jm(10,o-i-1),c=u/l%10|0,d=s<0||x[m+1]!==void 0||u%l,d=r<4?(c||d)&&(r==0||r==(t.s<0?3:2)):c>5||c==5&&(r==4||d||r==6&&(a>0?i>0?u/Jm(10,o-i):0:x[m-1])%10&1||r==(t.s<0?8:7))),s<1||!x[0])return d?(l=Xr(t),x.length=1,s=s-l-1,x[0]=Jm(10,(Ln-s%Ln)%Ln),t.e=Bf(-s/Ln)||0):(x.length=1,x[0]=t.e=t.s=0),t;if(a==0?(x.length=m,l=1,m--):(x.length=m+1,l=Jm(10,Ln-a),x[m]=i>0?(u/Jm(10,o-i)%Jm(10,i)|0)*l:0),d)for(;;)if(m==0){(x[0]+=l)==ba&&(x[0]=1,++t.e);break}else{if(x[m]+=l,x[m]!=ba)break;x[m--]=0,l=1}for(a=x.length;x[--a]===0;)x.pop();if(Yn&&(t.e>dw||t.e<-dw))throw Error(nM+Xr(t));return t}function _ee(t,s){var r,a,i,l,o,c,d,u,m,x,g=t.constructor,y=g.precision;if(!t.s||!s.s)return s.s?s.s=-s.s:s=new g(t),Yn?_n(s,y):s;if(d=t.d,x=s.d,a=s.e,u=t.e,d=d.slice(),o=u-a,o){for(m=o<0,m?(r=d,o=-o,c=x.length):(r=x,a=u,c=d.length),i=Math.max(Math.ceil(y/Ln),c)+2,o>i&&(o=i,r.length=1),r.reverse(),i=o;i--;)r.push(0);r.reverse()}else{for(i=d.length,c=x.length,m=i<c,m&&(c=i),i=0;i<c;i++)if(d[i]!=x[i]){m=d[i]<x[i];break}o=0}for(m&&(r=d,d=x,x=r,s.s=-s.s),c=d.length,i=x.length-c;i>0;--i)d[c++]=0;for(i=x.length;i>o;){if(d[--i]<x[i]){for(l=i;l&&d[--l]===0;)d[l]=ba-1;--d[l],d[i]+=ba}d[i]-=x[i]}for(;d[--c]===0;)d.pop();for(;d[0]===0;d.shift())--a;return d[0]?(s.d=d,s.e=a,Yn?_n(s,y):s):new g(0)}function ax(t,s,r){var a,i=Xr(t),l=Yc(t.d),o=l.length;return s?(r&&(a=r-o)>0?l=l.charAt(0)+"."+l.slice(1)+Bu(a):o>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(i<0?"e":"e+")+i):i<0?(l="0."+Bu(-i-1)+l,r&&(a=r-o)>0&&(l+=Bu(a))):i>=o?(l+=Bu(i+1-o),r&&(a=r-i-1)>0&&(l=l+"."+Bu(a))):((a=i+1)<o&&(l=l.slice(0,a)+"."+l.slice(a)),r&&(a=r-o)>0&&(i+1===o&&(l+="."),l+=Bu(a))),t.s<0?"-"+l:l}function lF(t,s){if(t.length>s)return t.length=s,!0}function See(t){var s,r,a;function i(l){var o=this;if(!(o instanceof i))return new i(l);if(o.constructor=i,l instanceof i){o.s=l.s,o.e=l.e,o.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(Oh+l);if(l>0)o.s=1;else if(l<0)l=-l,o.s=-1;else{o.s=0,o.e=0,o.d=[0];return}if(l===~~l&&l<1e7){o.e=0,o.d=[l];return}return iF(o,l.toString())}else if(typeof l!="string")throw Error(Oh+l);if(l.charCodeAt(0)===45?(l=l.slice(1),o.s=-1):o.s=1,TFe.test(l))iF(o,l);else throw Error(Oh+l)}if(i.prototype=qt,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=See,i.config=i.set=PFe,t===void 0&&(t={}),t)for(a=["precision","rounding","toExpNeg","toExpPos","LN10"],s=0;s<a.length;)t.hasOwnProperty(r=a[s++])||(t[r]=this[r]);return i.config(t),i}function PFe(t){if(!t||typeof t!="object")throw Error(Oo+"Object expected");var s,r,a,i=["precision",1,Ff,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(s=0;s<i.length;s+=3)if((a=t[r=i[s]])!==void 0)if(Bf(a)===a&&a>=i[s+1]&&a<=i[s+2])this[r]=a;else throw Error(Oh+r+": "+a);if((a=t[r="LN10"])!==void 0)if(a==Math.LN10)this[r]=new this(a);else throw Error(Oh+r+": "+a);return this}var rM=See(EFe);Il=new rM(1);const pn=rM;var DFe=t=>t,Cee={},kee=t=>t===Cee,oF=t=>function s(){return arguments.length===0||arguments.length===1&&kee(arguments.length<=0?void 0:arguments[0])?s:t(...arguments)},Aee=(t,s)=>t===1?s:oF(function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var l=a.filter(o=>o!==Cee).length;return l>=t?s(...a):Aee(t-l,oF(function(){for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];var u=a.map(m=>kee(m)?c.shift():m);return s(...u,...c)}))}),O_=t=>Aee(t.length,t),SA=(t,s)=>{for(var r=[],a=t;a<s;++a)r[a-t]=a;return r},MFe=O_((t,s)=>Array.isArray(s)?s.map(t):Object.keys(s).map(r=>s[r]).map(t)),IFe=function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];if(!r.length)return DFe;var i=r.reverse(),l=i[0],o=i.slice(1);return function(){return o.reduce((c,d)=>d(c),l(...arguments))}},CA=t=>Array.isArray(t)?t.reverse():t.split("").reverse().join(""),Eee=t=>{var s=null,r=null;return function(){for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return s&&i.every((o,c)=>{var d;return o===((d=s)===null||d===void 0?void 0:d[c])})||(s=i,r=t(...i)),r}};function Tee(t){var s;return t===0?s=1:s=Math.floor(new pn(t).abs().log(10).toNumber())+1,s}function Pee(t,s,r){for(var a=new pn(t),i=0,l=[];a.lt(s)&&i<1e5;)l.push(a.toNumber()),a=a.add(r),i++;return l}O_((t,s,r)=>{var a=+t,i=+s;return a+r*(i-a)});O_((t,s,r)=>{var a=s-+t;return a=a||1/0,(r-t)/a});O_((t,s,r)=>{var a=s-+t;return a=a||1/0,Math.max(0,Math.min(1,(r-t)/a))});var Dee=t=>{var[s,r]=t,[a,i]=[s,r];return s>r&&([a,i]=[r,s]),[a,i]},Mee=(t,s,r)=>{if(t.lte(0))return new pn(0);var a=Tee(t.toNumber()),i=new pn(10).pow(a),l=t.div(i),o=a!==1?.05:.1,c=new pn(Math.ceil(l.div(o).toNumber())).add(r).mul(o),d=c.mul(i);return s?new pn(d.toNumber()):new pn(Math.ceil(d.toNumber()))},OFe=(t,s,r)=>{var a=new pn(1),i=new pn(t);if(!i.isint()&&r){var l=Math.abs(t);l<1?(a=new pn(10).pow(Tee(t)-1),i=new pn(Math.floor(i.div(a).toNumber())).mul(a)):l>1&&(i=new pn(Math.floor(t)))}else t===0?i=new pn(Math.floor((s-1)/2)):r||(i=new pn(Math.floor(t)));var o=Math.floor((s-1)/2),c=IFe(MFe(d=>i.add(new pn(d-o).mul(a)).toNumber()),SA);return c(0,s)},Iee=function(s,r,a,i){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((r-s)/(a-1)))return{step:new pn(0),tickMin:new pn(0),tickMax:new pn(0)};var o=Mee(new pn(r).sub(s).div(a-1),i,l),c;s<=0&&r>=0?c=new pn(0):(c=new pn(s).add(r).div(2),c=c.sub(new pn(c).mod(o)));var d=Math.ceil(c.sub(s).div(o).toNumber()),u=Math.ceil(new pn(r).sub(c).div(o).toNumber()),m=d+u+1;return m>a?Iee(s,r,a,i,l+1):(m<a&&(u=r>0?u+(a-m):u,d=r>0?d:d+(a-m)),{step:o,tickMin:c.sub(new pn(d).mul(o)),tickMax:c.add(new pn(u).mul(o))})};function RFe(t){var[s,r]=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,l=Math.max(a,2),[o,c]=Dee([s,r]);if(o===-1/0||c===1/0){var d=c===1/0?[o,...SA(0,a-1).map(()=>1/0)]:[...SA(0,a-1).map(()=>-1/0),c];return s>r?CA(d):d}if(o===c)return OFe(o,a,i);var{step:u,tickMin:m,tickMax:x}=Iee(o,c,l,i,0),g=Pee(m,x.add(new pn(.1).mul(u)),u);return s>r?CA(g):g}function LFe(t,s){var[r,a]=t,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[l,o]=Dee([r,a]);if(l===-1/0||o===1/0)return[r,a];if(l===o)return[l];var c=Math.max(s,2),d=Mee(new pn(o).sub(l).div(c-1),i,0),u=[...Pee(new pn(l),new pn(o),d),o];return i===!1&&(u=u.map(m=>Math.round(m))),r>a?CA(u):u}var FFe=Eee(RFe),BFe=Eee(LFe),Oee=t=>t.rootProps.maxBarSize,$Fe=t=>t.rootProps.barGap,Ree=t=>t.rootProps.barCategoryGap,zFe=t=>t.rootProps.barSize,ky=t=>t.rootProps.stackOffset,aM=t=>t.options.chartName,iM=t=>t.rootProps.syncId,Lee=t=>t.rootProps.syncMethod,lM=t=>t.options.eventEmitter,ci={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},Md={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},Tl={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},R_=(t,s)=>{if(!(!t||!s))return t!=null&&t.reversed?[s[1],s[0]]:s},UFe={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:Md.angleAxisId,includeHidden:!1,name:void 0,reversed:Md.reversed,scale:Md.scale,tick:Md.tick,tickCount:void 0,ticks:void 0,type:Md.type,unit:void 0},VFe={allowDataOverflow:Tl.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Tl.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Tl.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Tl.scale,tick:Tl.tick,tickCount:Tl.tickCount,ticks:void 0,type:Tl.type,unit:void 0},HFe={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:Md.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Md.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Md.scale,tick:Md.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},WFe={allowDataOverflow:Tl.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Tl.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Tl.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Tl.scale,tick:Tl.tick,tickCount:Tl.tickCount,ticks:void 0,type:"category",unit:void 0},oM=(t,s)=>t.polarAxis.angleAxis[s]!=null?t.polarAxis.angleAxis[s]:t.layout.layoutType==="radial"?HFe:UFe,cM=(t,s)=>t.polarAxis.radiusAxis[s]!=null?t.polarAxis.radiusAxis[s]:t.layout.layoutType==="radial"?WFe:VFe,L_=t=>t.polarOptions,dM=Je([ou,cu,ha],DJ),Fee=Je([L_,dM],(t,s)=>{if(t!=null)return di(t.innerRadius,s,0)}),Bee=Je([L_,dM],(t,s)=>{if(t!=null)return di(t.outerRadius,s,s*.8)}),qFe=t=>{if(t==null)return[0,0];var{startAngle:s,endAngle:r}=t;return[s,r]},$ee=Je([L_],qFe);Je([oM,$ee],R_);var zee=Je([dM,Fee,Bee],(t,s,r)=>{if(!(t==null||s==null||r==null))return[s,r]});Je([cM,zee],R_);var Uee=Je([an,L_,Fee,Bee,ou,cu],(t,s,r,a,i,l)=>{if(!(t!=="centric"&&t!=="radial"||s==null||r==null||a==null)){var{cx:o,cy:c,startAngle:d,endAngle:u}=s;return{cx:di(o,i,i/2),cy:di(c,l,l/2),innerRadius:r,outerRadius:a,startAngle:d,endAngle:u,clockWise:!1}}}),Zn=(t,s)=>s,Ay=(t,s,r)=>r;function uM(t){return t==null?void 0:t.id}function Vee(t,s,r){var{chartData:a=[]}=s,{allowDuplicatedCategory:i,dataKey:l}=r,o=new Map;return t.forEach(c=>{var d,u=(d=c.data)!==null&&d!==void 0?d:a;if(!(u==null||u.length===0)){var m=uM(c);u.forEach((x,g)=>{var y=l==null||i?g:String(ar(x,l,null)),v=ar(x,c.dataKey,0),j;o.has(y)?j=o.get(y):j={},Object.assign(j,{[m]:v}),o.set(y,j)})}}),Array.from(o.values())}function F_(t){return t.stackId!=null&&t.dataKey!=null}var B_=(t,s)=>t===s?!0:t==null||s==null?!1:t[0]===s[0]&&t[1]===s[1];function $_(t,s){return Array.isArray(t)&&Array.isArray(s)&&t.length===0&&s.length===0?!0:t===s}function GFe(t,s){if(t.length===s.length){for(var r=0;r<t.length;r++)if(t[r]!==s[r])return!1;return!0}return!1}var pa=t=>{var s=an(t);return s==="horizontal"?"xAxis":s==="vertical"?"yAxis":s==="centric"?"angleAxis":"radiusAxis"},$f=t=>t.tooltip.settings.axisId;function cF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function uw(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?cF(Object(r),!0).forEach(function(a){KFe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function KFe(t,s,r){return(s=YFe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function YFe(t){var s=XFe(t,"string");return typeof s=="symbol"?s:s+""}function XFe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var kA=[0,"auto"],Sl={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},Hee=(t,s)=>t.cartesianAxis.xAxis[s],uu=(t,s)=>{var r=Hee(t,s);return r??Sl},Cl={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:kA,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:Ny},Wee=(t,s)=>t.cartesianAxis.yAxis[s],mu=(t,s)=>{var r=Wee(t,s);return r??Cl},QFe={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},mM=(t,s)=>{var r=t.cartesianAxis.zAxis[s];return r??QFe},dr=(t,s,r)=>{switch(s){case"xAxis":return uu(t,r);case"yAxis":return mu(t,r);case"zAxis":return mM(t,r);case"angleAxis":return oM(t,r);case"radiusAxis":return cM(t,r);default:throw new Error("Unexpected axis type: ".concat(s))}},ZFe=(t,s,r)=>{switch(s){case"xAxis":return uu(t,r);case"yAxis":return mu(t,r);default:throw new Error("Unexpected axis type: ".concat(s))}},Ey=(t,s,r)=>{switch(s){case"xAxis":return uu(t,r);case"yAxis":return mu(t,r);case"angleAxis":return oM(t,r);case"radiusAxis":return cM(t,r);default:throw new Error("Unexpected axis type: ".concat(s))}},qee=t=>t.graphicalItems.cartesianItems.some(s=>s.type==="bar")||t.graphicalItems.polarItems.some(s=>s.type==="radialBar");function hM(t,s){return r=>{switch(t){case"xAxis":return"xAxisId"in r&&r.xAxisId===s;case"yAxis":return"yAxisId"in r&&r.yAxisId===s;case"zAxis":return"zAxisId"in r&&r.zAxisId===s;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===s;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===s;default:return!1}}}var xM=t=>t.graphicalItems.cartesianItems,JFe=Je([Zn,Ay],hM),pM=(t,s,r)=>t.filter(r).filter(a=>(s==null?void 0:s.includeHidden)===!0?!0:!a.hide),Ty=Je([xM,dr,JFe],pM,{memoizeOptions:{resultEqualityCheck:$_}}),Gee=Je([Ty],t=>t.filter(s=>s.type==="area"||s.type==="bar").filter(F_)),Kee=t=>t.filter(s=>!("stackId"in s)||s.stackId===void 0),eBe=Je([Ty],Kee),fM=t=>t.map(s=>s.data).filter(Boolean).flat(1),tBe=Je([Ty],fM,{memoizeOptions:{resultEqualityCheck:$_}}),gM=(t,s)=>{var{chartData:r=[],dataStartIndex:a,dataEndIndex:i}=s;return t.length>0?t:r.slice(a,i+1)},bM=Je([tBe,sM],gM),yM=(t,s,r)=>(s==null?void 0:s.dataKey)!=null?t.map(a=>({value:ar(a,s.dataKey)})):r.length>0?r.map(a=>a.dataKey).flatMap(a=>t.map(i=>({value:ar(i,a)}))):t.map(a=>({value:a})),z_=Je([bM,dr,Ty],yM);function Yee(t,s){switch(t){case"xAxis":return s.direction==="x";case"yAxis":return s.direction==="y";default:return!1}}function _j(t){if(dd(t)||t instanceof Date){var s=Number(t);if(Mr(s))return s}}function dF(t){if(Array.isArray(t)){var s=[_j(t[0]),_j(t[1])];return rx(s)?s:void 0}var r=_j(t);if(r!=null)return[r,r]}function su(t){return t.map(_j).filter(mRe)}function sBe(t,s,r){return!r||typeof s!="number"||cd(s)?[]:r.length?su(r.flatMap(a=>{var i=ar(t,a.dataKey),l,o;if(Array.isArray(i)?[l,o]=i:l=o=i,!(!Mr(l)||!Mr(o)))return[s-l,s+o]})):[]}var fa=t=>{var s=pa(t),r=$f(t);return Ey(t,s,r)},Xee=Je([fa],t=>t==null?void 0:t.dataKey),nBe=Je([Gee,sM,fa],Vee),Qee=(t,s,r)=>{var a={},i=s.reduce((l,o)=>(o.stackId==null||(l[o.stackId]==null&&(l[o.stackId]=[]),l[o.stackId].push(o)),l),a);return Object.fromEntries(Object.entries(i).map(l=>{var[o,c]=l,d=c.map(uM);return[o,{stackedData:J6e(t,d,r),graphicalItems:c}]}))},AA=Je([nBe,Gee,ky],Qee),Zee=(t,s,r,a)=>{var{dataStartIndex:i,dataEndIndex:l}=s;if(a==null&&r!=="zAxis"){var o=r8e(t,i,l);if(!(o!=null&&o[0]===0&&o[1]===0))return o}},rBe=Je([dr],t=>t.allowDataOverflow),vM=t=>{var s;if(t==null||!("domain"in t))return kA;if(t.domain!=null)return t.domain;if(t.ticks!=null){if(t.type==="number"){var r=su(t.ticks);return[Math.min(...r),Math.max(...r)]}if(t.type==="category")return t.ticks.map(String)}return(s=t==null?void 0:t.domain)!==null&&s!==void 0?s:kA},jM=Je([dr],vM),NM=Je([jM,rBe],vee),aBe=Je([AA,Lm,Zn,NM],Zee,{memoizeOptions:{resultEqualityCheck:B_}}),U_=t=>t.errorBars,iBe=(t,s,r)=>t.flatMap(a=>s[a.id]).filter(Boolean).filter(a=>Yee(r,a)),mw=function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];var i=r.filter(Boolean);if(i.length!==0){var l=i.flat(),o=Math.min(...l),c=Math.max(...l);return[o,c]}},wM=(t,s,r,a,i)=>{var l,o;if(r.length>0&&t.forEach(c=>{r.forEach(d=>{var u,m,x=(u=a[d.id])===null||u===void 0?void 0:u.filter(S=>Yee(i,S)),g=ar(c,(m=s.dataKey)!==null&&m!==void 0?m:d.dataKey),y=sBe(c,g,x);if(y.length>=2){var v=Math.min(...y),j=Math.max(...y);(l==null||v<l)&&(l=v),(o==null||j>o)&&(o=j)}var w=dF(g);w!=null&&(l=l==null?w[0]:Math.min(l,w[0]),o=o==null?w[1]:Math.max(o,w[1]))})}),(s==null?void 0:s.dataKey)!=null&&t.forEach(c=>{var d=dF(ar(c,s.dataKey));d!=null&&(l=l==null?d[0]:Math.min(l,d[0]),o=o==null?d[1]:Math.max(o,d[1]))}),Mr(l)&&Mr(o))return[l,o]},lBe=Je([bM,dr,eBe,U_,Zn],wM,{memoizeOptions:{resultEqualityCheck:B_}});function oBe(t){var{value:s}=t;if(dd(s)||s instanceof Date)return s}var cBe=(t,s,r)=>{var a=t.map(oBe).filter(i=>i!=null);return r&&(s.dataKey==null||s.allowDuplicatedCategory&&mZ(a))?BJ(0,t.length):s.allowDuplicatedCategory?a:Array.from(new Set(a))},Jee=t=>t.referenceElements.dots,zf=(t,s,r)=>t.filter(a=>a.ifOverflow==="extendDomain").filter(a=>s==="xAxis"?a.xAxisId===r:a.yAxisId===r),dBe=Je([Jee,Zn,Ay],zf),ete=t=>t.referenceElements.areas,uBe=Je([ete,Zn,Ay],zf),tte=t=>t.referenceElements.lines,mBe=Je([tte,Zn,Ay],zf),ste=(t,s)=>{var r=su(t.map(a=>s==="xAxis"?a.x:a.y));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},hBe=Je(dBe,Zn,ste),nte=(t,s)=>{var r=su(t.flatMap(a=>[s==="xAxis"?a.x1:a.y1,s==="xAxis"?a.x2:a.y2]));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},xBe=Je([uBe,Zn],nte);function pBe(t){var s;if(t.x!=null)return su([t.x]);var r=(s=t.segment)===null||s===void 0?void 0:s.map(a=>a.x);return r==null||r.length===0?[]:su(r)}function fBe(t){var s;if(t.y!=null)return su([t.y]);var r=(s=t.segment)===null||s===void 0?void 0:s.map(a=>a.y);return r==null||r.length===0?[]:su(r)}var rte=(t,s)=>{var r=t.flatMap(a=>s==="xAxis"?pBe(a):fBe(a));if(r.length!==0)return[Math.min(...r),Math.max(...r)]},gBe=Je([mBe,Zn],rte),bBe=Je(hBe,gBe,xBe,(t,s,r)=>mw(t,r,s)),_M=(t,s,r,a,i,l,o,c)=>{if(r!=null)return r;var d=o==="vertical"&&c==="xAxis"||o==="horizontal"&&c==="yAxis",u=d?mw(a,l,i):mw(l,i);return AFe(s,u,t.allowDataOverflow)},yBe=Je([dr,jM,NM,aBe,lBe,bBe,an,Zn],_M,{memoizeOptions:{resultEqualityCheck:B_}}),vBe=[0,1],SM=(t,s,r,a,i,l,o)=>{if(!((t==null||r==null||r.length===0)&&o===void 0)){var{dataKey:c,type:d}=t,u=vx(s,l);if(u&&c==null){var m;return BJ(0,(m=r==null?void 0:r.length)!==null&&m!==void 0?m:0)}return d==="category"?cBe(a,t,u):i==="expand"?vBe:o}},CM=Je([dr,an,bM,z_,ky,Zn,yBe],SM),ate=(t,s,r,a,i)=>{if(t!=null){var{scale:l,type:o}=t;if(l==="auto")return s==="radial"&&i==="radiusAxis"?"band":s==="radial"&&i==="angleAxis"?"linear":o==="category"&&a&&(a.indexOf("LineChart")>=0||a.indexOf("AreaChart")>=0||a.indexOf("ComposedChart")>=0&&!r)?"point":o==="category"?"band":"linear";if(typeof l=="string"){var c="scale".concat(yy(l));return c in og?c:"point"}}},Uf=Je([dr,an,qee,aM,Zn],ate);function jBe(t){if(t!=null){if(t in og)return og[t]();var s="scale".concat(yy(t));if(s in og)return og[s]()}}function kM(t,s,r,a){if(!(r==null||a==null)){if(typeof t.scale=="function")return t.scale.copy().domain(r).range(a);var i=jBe(s);if(i!=null){var l=i.domain(r).range(a);return K6e(l),l}}}var AM=(t,s,r)=>{var a=vM(s);if(!(r!=="auto"&&r!=="linear")){if(s!=null&&s.tickCount&&Array.isArray(a)&&(a[0]==="auto"||a[1]==="auto")&&rx(t))return FFe(t,s.tickCount,s.allowDecimals);if(s!=null&&s.tickCount&&s.type==="number"&&rx(t))return BFe(t,s.tickCount,s.allowDecimals)}},EM=Je([CM,Ey,Uf],AM),TM=(t,s,r,a)=>{if(a!=="angleAxis"&&(t==null?void 0:t.type)==="number"&&rx(s)&&Array.isArray(r)&&r.length>0){var i=s[0],l=r[0],o=s[1],c=r[r.length-1];return[Math.min(i,l),Math.max(o,c)]}return s},NBe=Je([dr,CM,EM,Zn],TM),wBe=Je(z_,dr,(t,s)=>{if(!(!s||s.type!=="number")){var r=1/0,a=Array.from(su(t.map(c=>c.value))).sort((c,d)=>c-d);if(a.length<2)return 1/0;var i=a[a.length-1]-a[0];if(i===0)return 1/0;for(var l=0;l<a.length-1;l++){var o=a[l+1]-a[l];r=Math.min(r,o)}return r/i}}),ite=Je(wBe,an,Ree,ha,(t,s,r,a)=>a,(t,s,r,a,i)=>{if(!Mr(t))return 0;var l=s==="vertical"?a.height:a.width;if(i==="gap")return t*l/2;if(i==="no-gap"){var o=di(r,t*l),c=t*l/2;return c-o-(c-o)/l*o}return 0}),_Be=(t,s)=>{var r=uu(t,s);return r==null||typeof r.padding!="string"?0:ite(t,"xAxis",s,r.padding)},SBe=(t,s)=>{var r=mu(t,s);return r==null||typeof r.padding!="string"?0:ite(t,"yAxis",s,r.padding)},CBe=Je(uu,_Be,(t,s)=>{var r,a;if(t==null)return{left:0,right:0};var{padding:i}=t;return typeof i=="string"?{left:s,right:s}:{left:((r=i.left)!==null&&r!==void 0?r:0)+s,right:((a=i.right)!==null&&a!==void 0?a:0)+s}}),kBe=Je(mu,SBe,(t,s)=>{var r,a;if(t==null)return{top:0,bottom:0};var{padding:i}=t;return typeof i=="string"?{top:s,bottom:s}:{top:((r=i.top)!==null&&r!==void 0?r:0)+s,bottom:((a=i.bottom)!==null&&a!==void 0?a:0)+s}}),ABe=Je([ha,CBe,w_,N_,(t,s,r)=>r],(t,s,r,a,i)=>{var{padding:l}=a;return i?[l.left,r.width-l.right]:[t.left+s.left,t.left+t.width-s.right]}),EBe=Je([ha,an,kBe,w_,N_,(t,s,r)=>r],(t,s,r,a,i,l)=>{var{padding:o}=i;return l?[a.height-o.bottom,o.top]:s==="horizontal"?[t.top+t.height-r.bottom,t.top+r.top]:[t.top+r.top,t.top+t.height-r.bottom]}),Py=(t,s,r,a)=>{var i;switch(s){case"xAxis":return ABe(t,r,a);case"yAxis":return EBe(t,r,a);case"zAxis":return(i=mM(t,r))===null||i===void 0?void 0:i.range;case"angleAxis":return $ee(t);case"radiusAxis":return zee(t,r);default:return}},lte=Je([dr,Py],R_),Vf=Je([dr,Uf,NBe,lte],kM);Je([Ty,U_,Zn],iBe);function ote(t,s){return t.id<s.id?-1:t.id>s.id?1:0}var V_=(t,s)=>s,H_=(t,s,r)=>r,TBe=Je(v_,V_,H_,(t,s,r)=>t.filter(a=>a.orientation===s).filter(a=>a.mirror===r).sort(ote)),PBe=Je(j_,V_,H_,(t,s,r)=>t.filter(a=>a.orientation===s).filter(a=>a.mirror===r).sort(ote)),cte=(t,s)=>({width:t.width,height:s.height}),DBe=(t,s)=>{var r=typeof s.width=="number"?s.width:Ny;return{width:r,height:t.height}},dte=Je(ha,uu,cte),MBe=(t,s,r)=>{switch(s){case"top":return t.top;case"bottom":return r-t.bottom;default:return 0}},IBe=(t,s,r)=>{switch(s){case"left":return t.left;case"right":return r-t.right;default:return 0}},OBe=Je(cu,ha,TBe,V_,H_,(t,s,r,a,i)=>{var l={},o;return r.forEach(c=>{var d=cte(s,c);o==null&&(o=MBe(s,a,t));var u=a==="top"&&!i||a==="bottom"&&i;l[c.id]=o-Number(u)*d.height,o+=(u?-1:1)*d.height}),l}),RBe=Je(ou,ha,PBe,V_,H_,(t,s,r,a,i)=>{var l={},o;return r.forEach(c=>{var d=DBe(s,c);o==null&&(o=IBe(s,a,t));var u=a==="left"&&!i||a==="right"&&i;l[c.id]=o-Number(u)*d.width,o+=(u?-1:1)*d.width}),l}),LBe=(t,s)=>{var r=uu(t,s);if(r!=null)return OBe(t,r.orientation,r.mirror)},FBe=Je([ha,uu,LBe,(t,s)=>s],(t,s,r,a)=>{if(s!=null){var i=r==null?void 0:r[a];return i==null?{x:t.left,y:0}:{x:t.left,y:i}}}),BBe=(t,s)=>{var r=mu(t,s);if(r!=null)return RBe(t,r.orientation,r.mirror)},$Be=Je([ha,mu,BBe,(t,s)=>s],(t,s,r,a)=>{if(s!=null){var i=r==null?void 0:r[a];return i==null?{x:0,y:t.top}:{x:i,y:t.top}}}),ute=Je(ha,mu,(t,s)=>{var r=typeof s.width=="number"?s.width:Ny;return{width:r,height:t.height}}),uF=(t,s,r)=>{switch(s){case"xAxis":return dte(t,r).width;case"yAxis":return ute(t,r).height;default:return}},mte=(t,s,r,a)=>{if(r!=null){var{allowDuplicatedCategory:i,type:l,dataKey:o}=r,c=vx(t,a),d=s.map(u=>u.value);if(o&&c&&l==="category"&&i&&mZ(d))return d}},PM=Je([an,z_,dr,Zn],mte),hte=(t,s,r,a)=>{if(!(r==null||r.dataKey==null)){var{type:i,scale:l}=r,o=vx(t,a);if(o&&(i==="number"||l!=="auto"))return s.map(c=>c.value)}},DM=Je([an,z_,Ey,Zn],hte);Je([an,ZFe,Uf,Vf,PM,DM,Py,EM,Zn],(t,s,r,a,i,l,o,c,d)=>{if(s!=null){var u=vx(t,d);return{angle:s.angle,interval:s.interval,minTickGap:s.minTickGap,orientation:s.orientation,tick:s.tick,tickCount:s.tickCount,tickFormatter:s.tickFormatter,ticks:s.ticks,type:s.type,unit:s.unit,axisType:d,categoricalDomain:l,duplicateDomain:i,isCategorical:u,niceTicks:c,range:o,realScaleType:r,scale:a}}});var zBe=(t,s,r,a,i,l,o,c,d)=>{if(!(s==null||a==null)){var u=vx(t,d),{type:m,ticks:x,tickCount:g}=s,y=r==="scaleBand"&&typeof a.bandwidth=="function"?a.bandwidth()/2:2,v=m==="category"&&a.bandwidth?a.bandwidth()/y:0;v=d==="angleAxis"&&l!=null&&l.length>=2?qa(l[0]-l[1])*2*v:v;var j=x||i;if(j){var w=j.map((S,E)=>{var k=o?o.indexOf(S):S;return{index:E,coordinate:a(k)+v,value:S,offset:v}});return w.filter(S=>Mr(S.coordinate))}return u&&c?c.map((S,E)=>({coordinate:a(S)+v,value:S,index:E,offset:v})).filter(S=>Mr(S.coordinate)):a.ticks?a.ticks(g).map(S=>({coordinate:a(S)+v,value:S,offset:v})):a.domain().map((S,E)=>({coordinate:a(S)+v,value:o?o[S]:S,index:E,offset:v}))}},xte=Je([an,Ey,Uf,Vf,EM,Py,PM,DM,Zn],zBe),UBe=(t,s,r,a,i,l,o)=>{if(!(s==null||r==null||a==null||a[0]===a[1])){var c=vx(t,o),{tickCount:d}=s,u=0;return u=o==="angleAxis"&&(a==null?void 0:a.length)>=2?qa(a[0]-a[1])*2*u:u,c&&l?l.map((m,x)=>({coordinate:r(m)+u,value:m,index:x,offset:u})):r.ticks?r.ticks(d).map(m=>({coordinate:r(m)+u,value:m,offset:u})):r.domain().map((m,x)=>({coordinate:r(m)+u,value:i?i[m]:m,index:x,offset:u}))}},xf=Je([an,Ey,Vf,Py,PM,DM,Zn],UBe),pf=Je(dr,Vf,(t,s)=>{if(!(t==null||s==null))return uw(uw({},t),{},{scale:s})}),VBe=Je([dr,Uf,CM,lte],kM);Je((t,s,r)=>mM(t,r),VBe,(t,s)=>{if(!(t==null||s==null))return uw(uw({},t),{},{scale:s})});var HBe=Je([an,v_,j_],(t,s,r)=>{switch(t){case"horizontal":return s.some(a=>a.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(a=>a.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),pte=t=>t.options.defaultTooltipEventType,fte=t=>t.options.validateTooltipEventTypes;function gte(t,s,r){if(t==null)return s;var a=t?"axis":"item";return r==null?s:r.includes(a)?a:s}function MM(t,s){var r=pte(t),a=fte(t);return gte(s,r,a)}function WBe(t){return es(s=>MM(s,t))}var bte=(t,s)=>{var r,a=Number(s);if(!(cd(a)||s==null))return a>=0?t==null||(r=t[a])===null||r===void 0?void 0:r.value:void 0},qBe=t=>t.tooltip.settings,Hu={active:!1,index:null,dataKey:void 0,coordinate:void 0},GBe={itemInteraction:{click:Hu,hover:Hu},axisInteraction:{click:Hu,hover:Hu},keyboardInteraction:Hu,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},yte=gl({name:"tooltip",initialState:GBe,reducers:{addTooltipEntrySettings:{reducer(t,s){t.tooltipItemPayloads.push(s.payload)},prepare:oa()},removeTooltipEntrySettings:{reducer(t,s){var r=zd(t).tooltipItemPayloads.indexOf(s.payload);r>-1&&t.tooltipItemPayloads.splice(r,1)},prepare:oa()},setTooltipSettingsState(t,s){t.settings=s.payload},setActiveMouseOverItemIndex(t,s){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.itemInteraction.hover.active=!0,t.itemInteraction.hover.index=s.payload.activeIndex,t.itemInteraction.hover.dataKey=s.payload.activeDataKey,t.itemInteraction.hover.coordinate=s.payload.activeCoordinate},mouseLeaveChart(t){t.itemInteraction.hover.active=!1,t.axisInteraction.hover.active=!1},mouseLeaveItem(t){t.itemInteraction.hover.active=!1},setActiveClickItemIndex(t,s){t.syncInteraction.active=!1,t.itemInteraction.click.active=!0,t.keyboardInteraction.active=!1,t.itemInteraction.click.index=s.payload.activeIndex,t.itemInteraction.click.dataKey=s.payload.activeDataKey,t.itemInteraction.click.coordinate=s.payload.activeCoordinate},setMouseOverAxisIndex(t,s){t.syncInteraction.active=!1,t.axisInteraction.hover.active=!0,t.keyboardInteraction.active=!1,t.axisInteraction.hover.index=s.payload.activeIndex,t.axisInteraction.hover.dataKey=s.payload.activeDataKey,t.axisInteraction.hover.coordinate=s.payload.activeCoordinate},setMouseClickAxisIndex(t,s){t.syncInteraction.active=!1,t.keyboardInteraction.active=!1,t.axisInteraction.click.active=!0,t.axisInteraction.click.index=s.payload.activeIndex,t.axisInteraction.click.dataKey=s.payload.activeDataKey,t.axisInteraction.click.coordinate=s.payload.activeCoordinate},setSyncInteraction(t,s){t.syncInteraction=s.payload},setKeyboardInteraction(t,s){t.keyboardInteraction.active=s.payload.active,t.keyboardInteraction.index=s.payload.activeIndex,t.keyboardInteraction.coordinate=s.payload.activeCoordinate,t.keyboardInteraction.dataKey=s.payload.activeDataKey}}}),{addTooltipEntrySettings:KBe,removeTooltipEntrySettings:YBe,setTooltipSettingsState:XBe,setActiveMouseOverItemIndex:vte,mouseLeaveItem:QBe,mouseLeaveChart:jte,setActiveClickItemIndex:ZBe,setMouseOverAxisIndex:Nte,setMouseClickAxisIndex:JBe,setSyncInteraction:EA,setKeyboardInteraction:TA}=yte.actions,e$e=yte.reducer;function mF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function xv(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?mF(Object(r),!0).forEach(function(a){t$e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function t$e(t,s,r){return(s=s$e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function s$e(t){var s=n$e(t,"string");return typeof s=="symbol"?s:s+""}function n$e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function r$e(t,s,r){return s==="axis"?r==="click"?t.axisInteraction.click:t.axisInteraction.hover:r==="click"?t.itemInteraction.click:t.itemInteraction.hover}function a$e(t){return t.index!=null}var wte=(t,s,r,a)=>{if(s==null)return Hu;var i=r$e(t,s,r);if(i==null)return Hu;if(i.active)return i;if(t.keyboardInteraction.active)return t.keyboardInteraction;if(t.syncInteraction.active&&t.syncInteraction.index!=null)return t.syncInteraction;var l=t.settings.active===!0;if(a$e(i)){if(l)return xv(xv({},i),{},{active:!0})}else if(a!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:a};return xv(xv({},Hu),{},{coordinate:i.coordinate})},IM=(t,s)=>{var r=t==null?void 0:t.index;if(r==null)return null;var a=Number(r);if(!Mr(a))return r;var i=0,l=1/0;return s.length>0&&(l=s.length-1),String(Math.max(i,Math.min(a,l)))},_te=(t,s,r,a,i,l,o,c)=>{if(!(l==null||c==null)){var d=o[0],u=d==null?void 0:c(d.positions,l);if(u!=null)return u;var m=i==null?void 0:i[Number(l)];if(m)switch(r){case"horizontal":return{x:m.coordinate,y:(a.top+s)/2};default:return{x:(a.left+t)/2,y:m.coordinate}}}},Ste=(t,s,r,a)=>{if(s==="axis")return t.tooltipItemPayloads;if(t.tooltipItemPayloads.length===0)return[];var i;return r==="hover"?i=t.itemInteraction.hover.dataKey:i=t.itemInteraction.click.dataKey,i==null&&a!=null?[t.tooltipItemPayloads[0]]:t.tooltipItemPayloads.filter(l=>{var o;return((o=l.settings)===null||o===void 0?void 0:o.dataKey)===i})},Dy=t=>t.options.tooltipPayloadSearcher,Hf=t=>t.tooltip;function hF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function xF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?hF(Object(r),!0).forEach(function(a){i$e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function i$e(t,s,r){return(s=l$e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function l$e(t){var s=o$e(t,"string");return typeof s=="symbol"?s:s+""}function o$e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function c$e(t,s){return t??s}var Cte=(t,s,r,a,i,l,o)=>{if(!(s==null||l==null)){var{chartData:c,computedData:d,dataStartIndex:u,dataEndIndex:m}=r,x=[];return t.reduce((g,y)=>{var v,{dataDefinedOnItem:j,settings:w}=y,S=c$e(j,c),E=Array.isArray(S)?mJ(S,u,m):S,k=(v=w==null?void 0:w.dataKey)!==null&&v!==void 0?v:a,A=w==null?void 0:w.nameKey,I;if(a&&Array.isArray(E)&&!Array.isArray(E[0])&&o==="axis"?I=uRe(E,a,i):I=l(E,s,d,A),Array.isArray(I))I.forEach(O=>{var D=xF(xF({},w),{},{name:O.name,unit:O.unit,color:void 0,fill:void 0});g.push(X7({tooltipEntrySettings:D,dataKey:O.dataKey,payload:O.payload,value:ar(O.payload,O.dataKey),name:O.name}))});else{var P;g.push(X7({tooltipEntrySettings:w,dataKey:k,payload:I,value:ar(I,k),name:(P=ar(I,A))!==null&&P!==void 0?P:w==null?void 0:w.name}))}return g},x)}},OM=Je([fa,an,qee,aM,pa],ate),d$e=Je([t=>t.graphicalItems.cartesianItems,t=>t.graphicalItems.polarItems],(t,s)=>[...t,...s]),u$e=Je([pa,$f],hM),My=Je([d$e,fa,u$e],pM,{memoizeOptions:{resultEqualityCheck:$_}}),m$e=Je([My],t=>t.filter(F_)),h$e=Je([My],fM,{memoizeOptions:{resultEqualityCheck:$_}}),Wf=Je([h$e,Lm],gM),x$e=Je([m$e,Lm,fa],Vee),RM=Je([Wf,fa,My],yM),kte=Je([fa],vM),p$e=Je([fa],t=>t.allowDataOverflow),Ate=Je([kte,p$e],vee),f$e=Je([My],t=>t.filter(F_)),g$e=Je([x$e,f$e,ky],Qee),b$e=Je([g$e,Lm,pa,Ate],Zee),y$e=Je([My],Kee),v$e=Je([Wf,fa,y$e,U_,pa],wM,{memoizeOptions:{resultEqualityCheck:B_}}),j$e=Je([Jee,pa,$f],zf),N$e=Je([j$e,pa],ste),w$e=Je([ete,pa,$f],zf),_$e=Je([w$e,pa],nte),S$e=Je([tte,pa,$f],zf),C$e=Je([S$e,pa],rte),k$e=Je([N$e,C$e,_$e],mw),A$e=Je([fa,kte,Ate,b$e,v$e,k$e,an,pa],_M),Ete=Je([fa,an,Wf,RM,ky,pa,A$e],SM),E$e=Je([Ete,fa,OM],AM),T$e=Je([fa,Ete,E$e,pa],TM),Tte=t=>{var s=pa(t),r=$f(t),a=!1;return Py(t,s,r,a)},Pte=Je([fa,Tte],R_),Dte=Je([fa,OM,T$e,Pte],kM),P$e=Je([an,RM,fa,pa],mte),D$e=Je([an,RM,fa,pa],hte),M$e=(t,s,r,a,i,l,o,c)=>{if(s){var{type:d}=s,u=vx(t,c);if(a){var m=r==="scaleBand"&&a.bandwidth?a.bandwidth()/2:2,x=d==="category"&&a.bandwidth?a.bandwidth()/m:0;return x=c==="angleAxis"&&i!=null&&(i==null?void 0:i.length)>=2?qa(i[0]-i[1])*2*x:x,u&&o?o.map((g,y)=>({coordinate:a(g)+x,value:g,index:y,offset:x})):a.domain().map((g,y)=>({coordinate:a(g)+x,value:l?l[g]:g,index:y,offset:x}))}}},hu=Je([an,fa,OM,Dte,Tte,P$e,D$e,pa],M$e),LM=Je([pte,fte,qBe],(t,s,r)=>gte(r.shared,t,s)),Mte=t=>t.tooltip.settings.trigger,FM=t=>t.tooltip.settings.defaultIndex,W_=Je([Hf,LM,Mte,FM],wte),ix=Je([W_,Wf],IM),Ite=Je([hu,ix],bte),Ote=Je([W_],t=>{if(t)return t.dataKey}),Rte=Je([Hf,LM,Mte,FM],Ste),I$e=Je([ou,cu,an,ha,hu,FM,Rte,Dy],_te),O$e=Je([W_,I$e],(t,s)=>t!=null&&t.coordinate?t.coordinate:s),R$e=Je([W_],t=>t.active),L$e=Je([Rte,ix,Lm,Xee,Ite,Dy,LM],Cte);Je([L$e],t=>{if(t!=null){var s=t.map(r=>r.payload).filter(r=>r!=null);return Array.from(new Set(s))}});function pF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function fF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?pF(Object(r),!0).forEach(function(a){F$e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function F$e(t,s,r){return(s=B$e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function B$e(t){var s=$$e(t,"string");return typeof s=="symbol"?s:s+""}function $$e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var z$e=()=>es(fa),U$e=()=>{var t=z$e(),s=es(hu),r=es(Dte);return YN(!t||!r?void 0:fF(fF({},t),{},{scale:r}),s)};function gF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function zx(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?gF(Object(r),!0).forEach(function(a){V$e(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function V$e(t,s,r){return(s=H$e(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function H$e(t){var s=W$e(t,"string");return typeof s=="symbol"?s:s+""}function W$e(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var q$e=(t,s,r,a)=>{var i=s.find(l=>l&&l.index===r);if(i){if(t==="horizontal")return{x:i.coordinate,y:a.chartY};if(t==="vertical")return{x:a.chartX,y:i.coordinate}}return{x:0,y:0}},G$e=(t,s,r,a)=>{var i=s.find(u=>u&&u.index===r);if(i){if(t==="centric"){var l=i.coordinate,{radius:o}=a;return zx(zx(zx({},a),Kr(a.cx,a.cy,o,l)),{},{angle:l,radius:o})}var c=i.coordinate,{angle:d}=a;return zx(zx(zx({},a),Kr(a.cx,a.cy,c,d)),{},{angle:d,radius:c})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}};function K$e(t,s){var{chartX:r,chartY:a}=t;return r>=s.left&&r<=s.left+s.width&&a>=s.top&&a<=s.top+s.height}var Lte=(t,s,r,a,i)=>{var l,o=-1,c=(l=s==null?void 0:s.length)!==null&&l!==void 0?l:0;if(c<=1||t==null)return 0;if(a==="angleAxis"&&i!=null&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var d=0;d<c;d++){var u=d>0?r[d-1].coordinate:r[c-1].coordinate,m=r[d].coordinate,x=d>=c-1?r[0].coordinate:r[d+1].coordinate,g=void 0;if(qa(m-u)!==qa(x-m)){var y=[];if(qa(x-m)===qa(i[1]-i[0])){g=x;var v=m+i[1]-i[0];y[0]=Math.min(v,(v+u)/2),y[1]=Math.max(v,(v+u)/2)}else{g=u;var j=x+i[1]-i[0];y[0]=Math.min(m,(j+m)/2),y[1]=Math.max(m,(j+m)/2)}var w=[Math.min(m,(g+m)/2),Math.max(m,(g+m)/2)];if(t>w[0]&&t<=w[1]||t>=y[0]&&t<=y[1]){({index:o}=r[d]);break}}else{var S=Math.min(u,x),E=Math.max(u,x);if(t>(S+m)/2&&t<=(E+m)/2){({index:o}=r[d]);break}}}else if(s){for(var k=0;k<c;k++)if(k===0&&t<=(s[k].coordinate+s[k+1].coordinate)/2||k>0&&k<c-1&&t>(s[k].coordinate+s[k-1].coordinate)/2&&t<=(s[k].coordinate+s[k+1].coordinate)/2||k===c-1&&t>(s[k].coordinate+s[k-1].coordinate)/2){({index:o}=s[k]);break}}return o},Y$e=()=>es(aM),BM=(t,s)=>s,Fte=(t,s,r)=>r,$M=(t,s,r,a)=>a,X$e=Je(hu,t=>h_(t,s=>s.coordinate)),zM=Je([Hf,BM,Fte,$M],wte),Bte=Je([zM,Wf],IM),Q$e=(t,s,r)=>{if(s!=null){var a=Hf(t);return s==="axis"?r==="hover"?a.axisInteraction.hover.dataKey:a.axisInteraction.click.dataKey:r==="hover"?a.itemInteraction.hover.dataKey:a.itemInteraction.click.dataKey}},$te=Je([Hf,BM,Fte,$M],Ste),hw=Je([ou,cu,an,ha,hu,$M,$te,Dy],_te),Z$e=Je([zM,hw],(t,s)=>{var r;return(r=t.coordinate)!==null&&r!==void 0?r:s}),zte=Je([hu,Bte],bte),J$e=Je([$te,Bte,Lm,Xee,zte,Dy,BM],Cte),eze=Je([zM],t=>({isActive:t.active,activeIndex:t.index})),tze=(t,s,r,a,i,l,o)=>{if(!(!t||!r||!a||!i)&&K$e(t,o)){var c=a8e(t,s),d=Lte(c,l,i,r,a),u=q$e(s,i,d,t);return{activeIndex:String(d),activeCoordinate:u}}},sze=(t,s,r,a,i,l,o)=>{if(!(!t||!a||!i||!l||!r)){var c=KLe(t,r);if(c){var d=i8e(c,s),u=Lte(d,o,l,a,i),m=G$e(s,l,u,c);return{activeIndex:String(u),activeCoordinate:m}}}},nze=(t,s,r,a,i,l,o,c)=>{if(!(!t||!s||!a||!i||!l))return s==="horizontal"||s==="vertical"?tze(t,s,a,i,l,o,c):sze(t,s,r,a,i,l,o)},rze=Je(t=>t.zIndex.zIndexMap,(t,s)=>s,(t,s,r)=>r,(t,s,r)=>{if(s!=null){var a=t[s];if(a!=null)return r?a.panoramaElementId:a.elementId}}),aze=Je(t=>t.zIndex.zIndexMap,t=>{var s=Object.keys(t).map(a=>parseInt(a,10)).concat(Object.values(ci)),r=Array.from(new Set(s));return r.sort((a,i)=>a-i)},{memoizeOptions:{resultEqualityCheck:GFe}});function bF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function yF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?bF(Object(r),!0).forEach(function(a){ize(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function ize(t,s,r){return(s=lze(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function lze(t){var s=oze(t,"string");return typeof s=="symbol"?s:s+""}function oze(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var cze={},dze={zIndexMap:Object.values(ci).reduce((t,s)=>yF(yF({},t),{},{[s]:{elementId:void 0,panoramaElementId:void 0,consumers:0}}),cze)},uze=new Set(Object.values(ci));function mze(t){return uze.has(t)}var Ute=gl({name:"zIndex",initialState:dze,reducers:{registerZIndexPortal:{reducer:(t,s)=>{var{zIndex:r}=s.payload;t.zIndexMap[r]?t.zIndexMap[r].consumers+=1:t.zIndexMap[r]={consumers:1,elementId:void 0,panoramaElementId:void 0}},prepare:oa()},unregisterZIndexPortal:{reducer:(t,s)=>{var{zIndex:r}=s.payload;t.zIndexMap[r]&&(t.zIndexMap[r].consumers-=1,t.zIndexMap[r].consumers<=0&&!mze(r)&&delete t.zIndexMap[r])},prepare:oa()},registerZIndexPortalId:{reducer:(t,s)=>{var{zIndex:r,elementId:a,isPanorama:i}=s.payload;t.zIndexMap[r]?i?t.zIndexMap[r].panoramaElementId=a:t.zIndexMap[r].elementId=a:t.zIndexMap[r]={consumers:0,elementId:i?void 0:a,panoramaElementId:i?a:void 0}},prepare:oa()},unregisterZIndexPortalId:{reducer:(t,s)=>{var{zIndex:r}=s.payload;t.zIndexMap[r]&&(s.payload.isPanorama?t.zIndexMap[r].panoramaElementId=void 0:t.zIndexMap[r].elementId=void 0)},prepare:oa()}}}),{registerZIndexPortal:hze,unregisterZIndexPortal:xze,registerZIndexPortalId:pze,unregisterZIndexPortalId:fze}=Ute.actions,gze=Ute.reducer;function gd(t){var{zIndex:s,children:r}=t,a=O8e(),i=a&&s!==void 0&&s!==0,l=Xl(),o=Qn();p.useLayoutEffect(()=>i?(o(hze({zIndex:s})),()=>{o(xze({zIndex:s}))}):yx,[o,s,i]);var c=es(u=>rze(u,s,l));if(!i)return r;if(!c)return null;var d=document.getElementById(c);return d?Sm.createPortal(r,d):null}function PA(){return PA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},PA.apply(null,arguments)}function vF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function pv(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?vF(Object(r),!0).forEach(function(a){bze(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function bze(t,s,r){return(s=yze(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function yze(t){var s=vze(t,"string");return typeof s=="symbol"?s:s+""}function vze(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function jze(t){var{cursor:s,cursorComp:r,cursorProps:a}=t;return p.isValidElement(s)?p.cloneElement(s,a):p.createElement(r,a)}function Nze(t){var s,{coordinate:r,payload:a,index:i,offset:l,tooltipAxisBandSize:o,layout:c,cursor:d,tooltipEventType:u,chartName:m}=t,x=r,g=a,y=i;if(!d||!x||m!=="ScatterChart"&&u!=="axis")return null;var v,j,w;if(m==="ScatterChart")v=x,j=dLe,w=ci.cursorLine;else if(m==="BarChart")v=uLe(c,x,l,o),j=PJ,w=ci.cursorRectangle;else if(c==="radial"&&pZ(x)){var{cx:S,cy:E,radius:k,startAngle:A,endAngle:I}=MJ(x);v={cx:S,cy:E,startAngle:A,endAngle:I,innerRadius:k,outerRadius:k},j=OJ,w=ci.cursorLine}else v={points:ZLe(c,x,l)},j=PD,w=ci.cursorLine;var P=typeof d=="object"&&"className"in d?d.className:void 0,O=pv(pv(pv(pv({stroke:"#ccc",pointerEvents:"none"},l),v),Db(d)),{},{payload:g,payloadIndex:y,className:mn("recharts-tooltip-cursor",P)});return p.createElement(gd,{zIndex:(s=t.zIndex)!==null&&s!==void 0?s:w},p.createElement(jze,{cursor:d,cursorComp:j,cursorProps:O}))}function wze(t){var s=U$e(),r=D8e(),a=S_(),i=Y$e();return s==null||r==null||a==null||i==null?null:p.createElement(Nze,PA({},t,{offset:r,layout:a,tooltipAxisBandSize:s,chartName:i}))}var Vte=p.createContext(null),_ze=()=>p.useContext(Vte),Hte={exports:{}};(function(t){var s=Object.prototype.hasOwnProperty,r="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(r=!1));function i(d,u,m){this.fn=d,this.context=u,this.once=m||!1}function l(d,u,m,x,g){if(typeof m!="function")throw new TypeError("The listener must be a function");var y=new i(m,x||d,g),v=r?r+u:u;return d._events[v]?d._events[v].fn?d._events[v]=[d._events[v],y]:d._events[v].push(y):(d._events[v]=y,d._eventsCount++),d}function o(d,u){--d._eventsCount===0?d._events=new a:delete d._events[u]}function c(){this._events=new a,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],m,x;if(this._eventsCount===0)return u;for(x in m=this._events)s.call(m,x)&&u.push(r?x.slice(1):x);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(m)):u},c.prototype.listeners=function(u){var m=r?r+u:u,x=this._events[m];if(!x)return[];if(x.fn)return[x.fn];for(var g=0,y=x.length,v=new Array(y);g<y;g++)v[g]=x[g].fn;return v},c.prototype.listenerCount=function(u){var m=r?r+u:u,x=this._events[m];return x?x.fn?1:x.length:0},c.prototype.emit=function(u,m,x,g,y,v){var j=r?r+u:u;if(!this._events[j])return!1;var w=this._events[j],S=arguments.length,E,k;if(w.fn){switch(w.once&&this.removeListener(u,w.fn,void 0,!0),S){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,m),!0;case 3:return w.fn.call(w.context,m,x),!0;case 4:return w.fn.call(w.context,m,x,g),!0;case 5:return w.fn.call(w.context,m,x,g,y),!0;case 6:return w.fn.call(w.context,m,x,g,y,v),!0}for(k=1,E=new Array(S-1);k<S;k++)E[k-1]=arguments[k];w.fn.apply(w.context,E)}else{var A=w.length,I;for(k=0;k<A;k++)switch(w[k].once&&this.removeListener(u,w[k].fn,void 0,!0),S){case 1:w[k].fn.call(w[k].context);break;case 2:w[k].fn.call(w[k].context,m);break;case 3:w[k].fn.call(w[k].context,m,x);break;case 4:w[k].fn.call(w[k].context,m,x,g);break;default:if(!E)for(I=1,E=new Array(S-1);I<S;I++)E[I-1]=arguments[I];w[k].fn.apply(w[k].context,E)}}return!0},c.prototype.on=function(u,m,x){return l(this,u,m,x,!1)},c.prototype.once=function(u,m,x){return l(this,u,m,x,!0)},c.prototype.removeListener=function(u,m,x,g){var y=r?r+u:u;if(!this._events[y])return this;if(!m)return o(this,y),this;var v=this._events[y];if(v.fn)v.fn===m&&(!g||v.once)&&(!x||v.context===x)&&o(this,y);else{for(var j=0,w=[],S=v.length;j<S;j++)(v[j].fn!==m||g&&!v[j].once||x&&v[j].context!==x)&&w.push(v[j]);w.length?this._events[y]=w.length===1?w[0]:w:o(this,y)}return this},c.prototype.removeAllListeners=function(u){var m;return u?(m=r?r+u:u,this._events[m]&&o(this,m)):(this._events=new a,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,t.exports=c})(Hte);var Sze=Hte.exports;const Cze=Ro(Sze);var Vb=new Cze,DA="recharts.syncEvent.tooltip",jF="recharts.syncEvent.brush";function Wte(t,s){if(s){var r=Number.parseInt(s,10);if(!cd(r))return t==null?void 0:t[r]}}var kze={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},qte=gl({name:"options",initialState:kze,reducers:{createEventEmitter:t=>{t.eventEmitter==null&&(t.eventEmitter=Symbol("rechartsEventEmitter"))}}}),Aze=qte.reducer,{createEventEmitter:Eze}=qte.actions;function Tze(t){return t.tooltip.syncInteraction}var Pze={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},Gte=gl({name:"chartData",initialState:Pze,reducers:{setChartData(t,s){if(t.chartData=s.payload,s.payload==null){t.dataStartIndex=0,t.dataEndIndex=0;return}s.payload.length>0&&t.dataEndIndex!==s.payload.length-1&&(t.dataEndIndex=s.payload.length-1)},setComputedData(t,s){t.computedData=s.payload},setDataStartEndIndexes(t,s){var{startIndex:r,endIndex:a}=s.payload;r!=null&&(t.dataStartIndex=r),a!=null&&(t.dataEndIndex=a)}}}),{setChartData:NF,setDataStartEndIndexes:Dze,setComputedData:QZe}=Gte.actions,Mze=Gte.reducer,Ize=["x","y"];function wF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function Ux(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?wF(Object(r),!0).forEach(function(a){Oze(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function Oze(t,s,r){return(s=Rze(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function Rze(t){var s=Lze(t,"string");return typeof s=="symbol"?s:s+""}function Lze(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function Fze(t,s){if(t==null)return{};var r,a,i=Bze(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Bze(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function $ze(){var t=es(iM),s=es(lM),r=Qn(),a=es(Lee),i=es(hu),l=S_(),o=__(),c=es(d=>d.rootProps.className);p.useEffect(()=>{if(t==null)return yx;var d=(u,m,x)=>{if(s!==x&&t===u){if(a==="index"){var g;if(o&&m!==null&&m!==void 0&&(g=m.payload)!==null&&g!==void 0&&g.coordinate&&m.payload.sourceViewBox){var y=m.payload.coordinate,{x:v,y:j}=y,w=Fze(y,Ize),{x:S,y:E,width:k,height:A}=m.payload.sourceViewBox,I=Ux(Ux({},w),{},{x:o.x+(k?(v-S)/k:0)*o.width,y:o.y+(A?(j-E)/A:0)*o.height});r(Ux(Ux({},m),{},{payload:Ux(Ux({},m.payload),{},{coordinate:I})}))}else r(m);return}if(i!=null){var P;if(typeof a=="function"){var O={activeTooltipIndex:m.payload.index==null?void 0:Number(m.payload.index),isTooltipActive:m.payload.active,activeIndex:m.payload.index==null?void 0:Number(m.payload.index),activeLabel:m.payload.label,activeDataKey:m.payload.dataKey,activeCoordinate:m.payload.coordinate},D=a(i,O);P=i[D]}else a==="value"&&(P=i.find(G=>String(G.value)===m.payload.label));var{coordinate:T}=m.payload;if(P==null||m.payload.active===!1||T==null||o==null){r(EA({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0}));return}var{x:B,y:U}=T,W=Math.min(B,o.x+o.width),V=Math.min(U,o.y+o.height),R={x:l==="horizontal"?P.coordinate:W,y:l==="horizontal"?V:P.coordinate},F=EA({active:m.payload.active,coordinate:R,dataKey:m.payload.dataKey,index:String(P.index),label:m.payload.label,sourceViewBox:m.payload.sourceViewBox});r(F)}}};return Vb.on(DA,d),()=>{Vb.off(DA,d)}},[c,r,s,t,a,i,l,o])}function zze(){var t=es(iM),s=es(lM),r=Qn();p.useEffect(()=>{if(t==null)return yx;var a=(i,l,o)=>{s!==o&&t===i&&r(Dze(l))};return Vb.on(jF,a),()=>{Vb.off(jF,a)}},[r,s,t])}function Uze(){var t=Qn();p.useEffect(()=>{t(Eze())},[t]),$ze(),zze()}function Vze(t,s,r,a,i,l){var o=es(y=>Q$e(y,t,s)),c=es(lM),d=es(iM),u=es(Lee),m=es(Tze),x=m==null?void 0:m.active,g=__();p.useEffect(()=>{if(!x&&d!=null&&c!=null){var y=EA({active:l,coordinate:r,dataKey:o,index:i,label:typeof a=="number"?String(a):a,sourceViewBox:g});Vb.emit(DA,d,y,c)}},[x,r,o,i,a,c,d,u,l,g])}function _F(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function SF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?_F(Object(r),!0).forEach(function(a){Hze(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_F(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function Hze(t,s,r){return(s=Wze(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function Wze(t){var s=qze(t,"string");return typeof s=="symbol"?s:s+""}function qze(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function Gze(t){return t.dataKey}function Kze(t,s){return p.isValidElement(t)?p.cloneElement(t,s):typeof t=="function"?p.createElement(t,s):p.createElement(U8e,s)}var CF=[],Yze={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!jx.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function ph(t){var s,r,a=Li(t,Yze),{active:i,allowEscapeViewBox:l,animationDuration:o,animationEasing:c,content:d,filterNull:u,isAnimationActive:m,offset:x,payloadUniqBy:g,position:y,reverseDirection:v,useTranslate3d:j,wrapperStyle:w,cursor:S,shared:E,trigger:k,defaultIndex:A,portal:I,axisId:P}=a,O=Qn(),D=typeof A=="number"?String(A):A;p.useEffect(()=>{O(XBe({shared:E,trigger:k,axisId:P,active:i,defaultIndex:D}))},[O,E,k,P,i,D]);var T=__(),B=CJ(),U=WBe(E),{activeIndex:W,isActive:V}=(s=es(ee=>eze(ee,U,k,D)))!==null&&s!==void 0?s:{},R=es(ee=>J$e(ee,U,k,D)),F=es(ee=>zte(ee,U,k,D)),G=es(ee=>Z$e(ee,U,k,D)),H=R,$=_ze(),K=(r=i??V)!==null&&r!==void 0?r:!1,[le,se]=GRe([H,K]),J=U==="axis"?F:void 0;Vze(U,k,G,J,W,K);var ie=I??$;if(ie==null||T==null||U==null)return null;var te=H??CF;K||(te=CF),u&&te.length&&(te=TRe(te.filter(ee=>ee.value!=null&&(ee.hide!==!0||a.includeHidden)),g,Gze));var ne=te.length>0,q=p.createElement(Y8e,{allowEscapeViewBox:l,animationDuration:o,animationEasing:c,isAnimationActive:m,active:K,coordinate:G,hasPayload:ne,offset:x,position:y,reverseDirection:v,useTranslate3d:j,viewBox:T,wrapperStyle:w,lastBoundingBox:le,innerRef:se,hasPortalFromProps:!!I},Kze(d,SF(SF({},a),{},{payload:te,label:J,active:K,activeIndex:W,coordinate:G,accessibilityLayer:B})));return p.createElement(p.Fragment,null,Sm.createPortal(q,ie),K&&p.createElement(wze,{cursor:S,tooltipEventType:U,coordinate:G,payload:te,index:W}))}var Xc=t=>null;Xc.displayName="Cell";function Xze(t,s,r){return(s=Qze(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function Qze(t){var s=Zze(t,"string");return typeof s=="symbol"?s:s+""}function Zze(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}class Jze{constructor(s){Xze(this,"cache",new Map),this.maxSize=s}get(s){var r=this.cache.get(s);return r!==void 0&&(this.cache.delete(s),this.cache.set(s,r)),r}set(s,r){if(this.cache.has(s))this.cache.delete(s);else if(this.cache.size>=this.maxSize){var a=this.cache.keys().next().value;this.cache.delete(a)}this.cache.set(s,r)}clear(){this.cache.clear()}size(){return this.cache.size}}function kF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function eUe(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?kF(Object(r),!0).forEach(function(a){tUe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function tUe(t,s,r){return(s=sUe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function sUe(t){var s=nUe(t,"string");return typeof s=="symbol"?s:s+""}function nUe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var rUe={cacheSize:2e3,enableCache:!0},Kte=eUe({},rUe),AF=new Jze(Kte.cacheSize),aUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},EF="recharts_measurement_span";function iUe(t,s){var r=s.fontSize||"",a=s.fontFamily||"",i=s.fontWeight||"",l=s.fontStyle||"",o=s.letterSpacing||"",c=s.textTransform||"";return"".concat(t,"|").concat(r,"|").concat(a,"|").concat(i,"|").concat(l,"|").concat(o,"|").concat(c)}var TF=(t,s)=>{try{var r=document.getElementById(EF);r||(r=document.createElement("span"),r.setAttribute("id",EF),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,aUe,s),r.textContent="".concat(t);var a=r.getBoundingClientRect();return{width:a.width,height:a.height}}catch{return{width:0,height:0}}},Mg=function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(s==null||jx.isSsr)return{width:0,height:0};if(!Kte.enableCache)return TF(s,r);var a=iUe(s,r),i=AF.get(a);if(i)return i;var l=TF(s,r);return AF.set(a,l),l},PF=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,DF=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,lUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,oUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Yte={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},cUe=Object.keys(Yte),Sp="NaN";function dUe(t,s){return t*Yte[s]}class Gi{static parse(s){var r,[,a,i]=(r=oUe.exec(s))!==null&&r!==void 0?r:[];return new Gi(parseFloat(a),i??"")}constructor(s,r){this.num=s,this.unit=r,this.num=s,this.unit=r,cd(s)&&(this.unit=""),r!==""&&!lUe.test(r)&&(this.num=NaN,this.unit=""),cUe.includes(r)&&(this.num=dUe(s,r),this.unit="px")}add(s){return this.unit!==s.unit?new Gi(NaN,""):new Gi(this.num+s.num,this.unit)}subtract(s){return this.unit!==s.unit?new Gi(NaN,""):new Gi(this.num-s.num,this.unit)}multiply(s){return this.unit!==""&&s.unit!==""&&this.unit!==s.unit?new Gi(NaN,""):new Gi(this.num*s.num,this.unit||s.unit)}divide(s){return this.unit!==""&&s.unit!==""&&this.unit!==s.unit?new Gi(NaN,""):new Gi(this.num/s.num,this.unit||s.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return cd(this.num)}}function Xte(t){if(t.includes(Sp))return Sp;for(var s=t;s.includes("*")||s.includes("/");){var r,[,a,i,l]=(r=PF.exec(s))!==null&&r!==void 0?r:[],o=Gi.parse(a??""),c=Gi.parse(l??""),d=i==="*"?o.multiply(c):o.divide(c);if(d.isNaN())return Sp;s=s.replace(PF,d.toString())}for(;s.includes("+")||/.-\d+(?:\.\d+)?/.test(s);){var u,[,m,x,g]=(u=DF.exec(s))!==null&&u!==void 0?u:[],y=Gi.parse(m??""),v=Gi.parse(g??""),j=x==="+"?y.add(v):y.subtract(v);if(j.isNaN())return Sp;s=s.replace(DF,j.toString())}return s}var MF=/\(([^()]*)\)/;function uUe(t){for(var s=t,r;(r=MF.exec(s))!=null;){var[,a]=r;s=s.replace(MF,Xte(a))}return s}function mUe(t){var s=t.replace(/\s+/g,"");return s=uUe(s),s=Xte(s),s}function hUe(t){try{return mUe(t)}catch{return Sp}}function Gk(t){var s=hUe(t.slice(5,-1));return s===Sp?"":s}var xUe=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],pUe=["dx","dy","angle","className","breakAll"];function MA(){return MA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},MA.apply(null,arguments)}function IF(t,s){if(t==null)return{};var r,a,i=fUe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function fUe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var Qte=/[ \f\n\r\t\v\u2028\u2029]+/,Zte=t=>{var{children:s,breakAll:r,style:a}=t;try{var i=[];Sa(s)||(r?i=s.toString().split(""):i=s.toString().split(Qte));var l=i.map(c=>({word:c,width:Mg(c,a).width})),o=r?0:Mg("",a).width;return{wordsWithComputedWidth:l,spaceWidth:o}}catch{return null}};function gUe(t){return t==="start"||t==="middle"||t==="end"||t==="inherit"}var Jte=(t,s,r,a)=>t.reduce((i,l)=>{var{word:o,width:c}=l,d=i[i.length-1];if(d&&c!=null&&(s==null||a||d.width+c+r<Number(s)))d.words.push(o),d.width+=c+r;else{var u={words:[o],width:c};i.push(u)}return i},[]),ese=t=>t.reduce((s,r)=>s.width>r.width?s:r),bUe="",OF=(t,s,r,a,i,l,o,c)=>{var d=t.slice(0,s),u=Zte({breakAll:r,style:a,children:d+bUe});if(!u)return[!1,[]];var m=Jte(u.wordsWithComputedWidth,l,o,c),x=m.length>i||ese(m).width>Number(l);return[x,m]},yUe=(t,s,r,a,i)=>{var{maxLines:l,children:o,style:c,breakAll:d}=t,u=as(l),m=String(o),x=Jte(s,a,r,i);if(!u||i)return x;var g=x.length>l||ese(x).width>Number(a);if(!g)return x;for(var y=0,v=m.length-1,j=0,w;y<=v&&j<=m.length-1;){var S=Math.floor((y+v)/2),E=S-1,[k,A]=OF(m,E,d,c,l,a,r,i),[I]=OF(m,S,d,c,l,a,r,i);if(!k&&!I&&(y=S+1),k&&I&&(v=S-1),!k&&I){w=A;break}j++}return w||x},RF=t=>{var s=Sa(t)?[]:t.toString().split(Qte);return[{words:s,width:void 0}]},vUe=t=>{var{width:s,scaleToFit:r,children:a,style:i,breakAll:l,maxLines:o}=t;if((s||r)&&!jx.isSsr){var c,d,u=Zte({breakAll:l,children:a,style:i});if(u){var{wordsWithComputedWidth:m,spaceWidth:x}=u;c=m,d=x}else return RF(a);return yUe({breakAll:l,children:a,maxLines:o,style:i},c,d,s,!!r)}return RF(a)},tse="#808080",jUe={breakAll:!1,capHeight:"0.71em",fill:tse,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},q_=p.forwardRef((t,s)=>{var r=Li(t,jUe),{x:a,y:i,lineHeight:l,capHeight:o,fill:c,scaleToFit:d,textAnchor:u,verticalAnchor:m}=r,x=IF(r,xUe),g=p.useMemo(()=>vUe({breakAll:x.breakAll,children:x.children,maxLines:x.maxLines,scaleToFit:d,style:x.style,width:x.width}),[x.breakAll,x.children,x.maxLines,d,x.style,x.width]),{dx:y,dy:v,angle:j,className:w,breakAll:S}=x,E=IF(x,pUe);if(!dd(a)||!dd(i)||g.length===0)return null;var k=Number(a)+(as(y)?y:0),A=Number(i)+(as(v)?v:0);if(!Mr(k)||!Mr(A))return null;var I;switch(m){case"start":I=Gk("calc(".concat(o,")"));break;case"middle":I=Gk("calc(".concat((g.length-1)/2," * -").concat(l," + (").concat(o," / 2))"));break;default:I=Gk("calc(".concat(g.length-1," * -").concat(l,")"));break}var P=[];if(d){var O=g[0].width,{width:D}=x;P.push("scale(".concat(as(D)&&as(O)?D/O:1,")"))}return j&&P.push("rotate(".concat(j,", ").concat(k,", ").concat(A,")")),P.length&&(E.transform=P.join(" ")),p.createElement("text",MA({},Mo(E),{ref:s,x:k,y:A,className:mn("recharts-text",w),textAnchor:u,fill:c.includes("url")?tse:c}),g.map((T,B)=>{var U=T.words.join(S?"":" ");return p.createElement("tspan",{x:k,dy:B===0?I:l,key:"".concat(U,"-").concat(B)},U)}))});q_.displayName="Text";var NUe=["labelRef"];function wUe(t,s){if(t==null)return{};var r,a,i=_Ue(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function _Ue(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function LF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function Sr(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?LF(Object(r),!0).forEach(function(a){SUe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):LF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function SUe(t,s,r){return(s=CUe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function CUe(t){var s=kUe(t,"string");return typeof s=="symbol"?s:s+""}function kUe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function Id(){return Id=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Id.apply(null,arguments)}var sse=p.createContext(null),AUe=t=>{var{x:s,y:r,upperWidth:a,lowerWidth:i,width:l,height:o,children:c}=t,d=p.useMemo(()=>({x:s,y:r,upperWidth:a,lowerWidth:i,width:l,height:o}),[s,r,a,i,l,o]);return p.createElement(sse.Provider,{value:d},c)},nse=()=>{var t=p.useContext(sse),s=__();return t||NJ(s)},EUe=p.createContext(null),TUe=()=>{var t=p.useContext(EUe),s=es(Uee);return t||s},PUe=t=>{var{value:s,formatter:r}=t,a=Sa(t.children)?s:t.children;return typeof r=="function"?r(a):a},UM=t=>t!=null&&typeof t=="function",DUe=(t,s)=>{var r=qa(s-t),a=Math.min(Math.abs(s-t),360);return r*a},MUe=(t,s,r,a,i)=>{var{offset:l,className:o}=t,{cx:c,cy:d,innerRadius:u,outerRadius:m,startAngle:x,endAngle:g,clockWise:y}=i,v=(u+m)/2,j=DUe(x,g),w=j>=0?1:-1,S,E;switch(s){case"insideStart":S=x+w*l,E=y;break;case"insideEnd":S=g-w*l,E=!y;break;case"end":S=g+w*l,E=y;break;default:throw new Error("Unsupported position ".concat(s))}E=j<=0?E:!E;var k=Kr(c,d,v,S),A=Kr(c,d,v,S+(E?1:-1)*359),I="M".concat(k.x,",").concat(k.y,`
    A`).concat(v,",").concat(v,",0,1,").concat(E?0:1,`,
    `).concat(A.x,",").concat(A.y),P=Sa(t.id)?Mb("recharts-radial-line-"):t.id;return p.createElement("text",Id({},a,{dominantBaseline:"central",className:mn("recharts-radial-bar-label",o)}),p.createElement("defs",null,p.createElement("path",{id:P,d:I})),p.createElement("textPath",{xlinkHref:"#".concat(P)},r))},IUe=(t,s,r)=>{var{cx:a,cy:i,innerRadius:l,outerRadius:o,startAngle:c,endAngle:d}=t,u=(c+d)/2;if(r==="outside"){var{x:m,y:x}=Kr(a,i,o+s,u);return{x:m,y:x,textAnchor:m>=a?"start":"end",verticalAnchor:"middle"}}if(r==="center")return{x:a,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(r==="centerTop")return{x:a,y:i,textAnchor:"middle",verticalAnchor:"start"};if(r==="centerBottom")return{x:a,y:i,textAnchor:"middle",verticalAnchor:"end"};var g=(l+o)/2,{x:y,y:v}=Kr(a,i,g,u);return{x:y,y:v,textAnchor:"middle",verticalAnchor:"middle"}},IA=t=>"cx"in t&&as(t.cx),OUe=(t,s)=>{var{parentViewBox:r,offset:a,position:i}=t,l;r!=null&&!IA(r)&&(l=r);var{x:o,y:c,upperWidth:d,lowerWidth:u,height:m}=s,x=o,g=o+(d-u)/2,y=(x+g)/2,v=(d+u)/2,j=x+d/2,w=m>=0?1:-1,S=w*a,E=w>0?"end":"start",k=w>0?"start":"end",A=d>=0?1:-1,I=A*a,P=A>0?"end":"start",O=A>0?"start":"end";if(i==="top"){var D={x:x+d/2,y:c-S,textAnchor:"middle",verticalAnchor:E};return Sr(Sr({},D),l?{height:Math.max(c-l.y,0),width:d}:{})}if(i==="bottom"){var T={x:g+u/2,y:c+m+S,textAnchor:"middle",verticalAnchor:k};return Sr(Sr({},T),l?{height:Math.max(l.y+l.height-(c+m),0),width:u}:{})}if(i==="left"){var B={x:y-I,y:c+m/2,textAnchor:P,verticalAnchor:"middle"};return Sr(Sr({},B),l?{width:Math.max(B.x-l.x,0),height:m}:{})}if(i==="right"){var U={x:y+v+I,y:c+m/2,textAnchor:O,verticalAnchor:"middle"};return Sr(Sr({},U),l?{width:Math.max(l.x+l.width-U.x,0),height:m}:{})}var W=l?{width:v,height:m}:{};return i==="insideLeft"?Sr({x:y+I,y:c+m/2,textAnchor:O,verticalAnchor:"middle"},W):i==="insideRight"?Sr({x:y+v-I,y:c+m/2,textAnchor:P,verticalAnchor:"middle"},W):i==="insideTop"?Sr({x:x+d/2,y:c+S,textAnchor:"middle",verticalAnchor:k},W):i==="insideBottom"?Sr({x:g+u/2,y:c+m-S,textAnchor:"middle",verticalAnchor:E},W):i==="insideTopLeft"?Sr({x:x+I,y:c+S,textAnchor:O,verticalAnchor:k},W):i==="insideTopRight"?Sr({x:x+d-I,y:c+S,textAnchor:P,verticalAnchor:k},W):i==="insideBottomLeft"?Sr({x:g+I,y:c+m-S,textAnchor:O,verticalAnchor:E},W):i==="insideBottomRight"?Sr({x:g+u-I,y:c+m-S,textAnchor:P,verticalAnchor:E},W):i&&typeof i=="object"&&(as(i.x)||Qd(i.x))&&(as(i.y)||Qd(i.y))?Sr({x:o+di(i.x,v),y:c+di(i.y,m),textAnchor:"end",verticalAnchor:"end"},W):Sr({x:j,y:c+m/2,textAnchor:"middle",verticalAnchor:"middle"},W)},RUe={offset:5,zIndex:ci.label};function $u(t){var s=Li(t,RUe),{viewBox:r,position:a,value:i,children:l,content:o,className:c="",textBreakAll:d,labelRef:u}=s,m=TUe(),x=nse(),g=a==="center"?x:m??x,y,v,j;if(r==null?y=g:IA(r)?y=r:y=NJ(r),!y||Sa(i)&&Sa(l)&&!p.isValidElement(o)&&typeof o!="function")return null;var w=Sr(Sr({},s),{},{viewBox:y});if(p.isValidElement(o)){var{labelRef:S}=w,E=wUe(w,NUe);return p.cloneElement(o,E)}if(typeof o=="function"){if(v=p.createElement(o,w),p.isValidElement(v))return v}else v=PUe(s);var k=Mo(s);if(IA(y)){if(a==="insideStart"||a==="insideEnd"||a==="end")return MUe(s,a,v,k,y);j=IUe(y,s.offset,s.position)}else j=OUe(s,y);return p.createElement(gd,{zIndex:s.zIndex},p.createElement(q_,Id({ref:u,className:mn("recharts-label",c)},k,j,{textAnchor:gUe(k.textAnchor)?k.textAnchor:j.textAnchor,breakAll:d}),v))}$u.displayName="Label";var LUe=(t,s,r)=>{if(!t)return null;var a={viewBox:s,labelRef:r};return t===!0?p.createElement($u,Id({key:"label-implicit"},a)):dd(t)?p.createElement($u,Id({key:"label-implicit",value:t},a)):p.isValidElement(t)?t.type===$u?p.cloneElement(t,Sr({key:"label-implicit"},a)):p.createElement($u,Id({key:"label-implicit",content:t},a)):UM(t)?p.createElement($u,Id({key:"label-implicit",content:t},a)):t&&typeof t=="object"?p.createElement($u,Id({},t,{key:"label-implicit"},a)):null};function FUe(t){var{label:s,labelRef:r}=t,a=nse();return LUe(s,a,r)||null}var rse={},ase={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return r[r.length-1]}t.last=s})(ase);var ise={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){return Array.isArray(r)?r:Array.from(r)}t.toArray=s})(ise);(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const s=ase,r=ise,a=m_;function i(l){if(a.isArrayLike(l))return s.last(r.toArray(l))}t.last=i})(rse);var BUe=rse.last;const $Ue=Ro(BUe);var zUe=["valueAccessor"],UUe=["dataKey","clockWise","id","textBreakAll","zIndex"];function xw(){return xw=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},xw.apply(null,arguments)}function FF(t,s){if(t==null)return{};var r,a,i=VUe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function VUe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var HUe=t=>Array.isArray(t.value)?$Ue(t.value):t.value,lse=p.createContext(void 0),WUe=lse.Provider,ose=p.createContext(void 0),qUe=ose.Provider;function GUe(){return p.useContext(lse)}function KUe(){return p.useContext(ose)}function Sj(t){var{valueAccessor:s=HUe}=t,r=FF(t,zUe),{dataKey:a,clockWise:i,id:l,textBreakAll:o,zIndex:c}=r,d=FF(r,UUe),u=GUe(),m=KUe(),x=u||m;return!x||!x.length?null:p.createElement(gd,{zIndex:c??ci.label},p.createElement(Mi,{className:"recharts-label-list"},x.map((g,y)=>{var v,j=Sa(a)?s(g,y):ar(g&&g.payload,a),w=Sa(l)?{}:{id:"".concat(l,"-").concat(y)};return p.createElement($u,xw({key:"label-".concat(y)},Mo(g),d,w,{fill:(v=r.fill)!==null&&v!==void 0?v:g.fill,parentViewBox:g.parentViewBox,value:j,textBreakAll:o,viewBox:g.viewBox,index:y,zIndex:0}))})))}Sj.displayName="LabelList";function cse(t){var{label:s}=t;return s?s===!0?p.createElement(Sj,{key:"labelList-implicit"}):p.isValidElement(s)||UM(s)?p.createElement(Sj,{key:"labelList-implicit",content:s}):typeof s=="object"?p.createElement(Sj,xw({key:"labelList-implicit"},s,{type:String(s.type)})):null:null}var dse=t=>t.graphicalItems.polarItems,YUe=Je([Zn,Ay],hM),G_=Je([dse,dr,YUe],pM),XUe=Je([G_],fM),K_=Je([XUe,tM],gM),QUe=Je([K_,dr,G_],yM);Je([K_,dr,G_],(t,s,r)=>r.length>0?t.flatMap(a=>r.flatMap(i=>{var l,o=ar(a,(l=s.dataKey)!==null&&l!==void 0?l:i.dataKey);return{value:o,errorDomain:[]}})).filter(Boolean):(s==null?void 0:s.dataKey)!=null?t.map(a=>({value:ar(a,s.dataKey),errorDomain:[]})):t.map(a=>({value:a,errorDomain:[]})));var BF=()=>{},ZUe=Je([K_,dr,G_,U_,Zn],wM),JUe=Je([dr,jM,NM,BF,ZUe,BF,an,Zn],_M),use=Je([dr,an,K_,QUe,ky,Zn,JUe],SM),eVe=Je([use,dr,Uf],AM);Je([dr,use,eVe,Zn],TM);var tVe={radiusAxis:{},angleAxis:{}},mse=gl({name:"polarAxis",initialState:tVe,reducers:{addRadiusAxis(t,s){t.radiusAxis[s.payload.id]=s.payload},removeRadiusAxis(t,s){delete t.radiusAxis[s.payload.id]},addAngleAxis(t,s){t.angleAxis[s.payload.id]=s.payload},removeAngleAxis(t,s){delete t.angleAxis[s.payload.id]}}}),{addRadiusAxis:ZZe,removeRadiusAxis:JZe,addAngleAxis:eJe,removeAngleAxis:tJe}=mse.actions,sVe=mse.reducer;function $F(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function zF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?$F(Object(r),!0).forEach(function(a){nVe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$F(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function nVe(t,s,r){return(s=rVe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function rVe(t){var s=aVe(t,"string");return typeof s=="symbol"?s:s+""}function aVe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var iVe=(t,s)=>s,VM=Je([dse,iVe],(t,s)=>t.filter(r=>r.type==="pie").find(r=>r.id===s)),lVe=[],HM=(t,s,r)=>(r==null?void 0:r.length)===0?lVe:r,hse=Je([tM,VM,HM],(t,s,r)=>{var{chartData:a}=t;if(s!=null){var i;if((s==null?void 0:s.data)!=null&&s.data.length>0?i=s.data:i=a,(!i||!i.length)&&r!=null&&(i=r.map(l=>zF(zF({},s.presentationProps),l.props))),i!=null)return i}}),oVe=Je([hse,VM,HM],(t,s,r)=>{if(!(t==null||s==null))return t.map((a,i)=>{var l,o=ar(a,s.nameKey,s.name),c;return r!=null&&(l=r[i])!==null&&l!==void 0&&(l=l.props)!==null&&l!==void 0&&l.fill?c=r[i].props.fill:typeof a=="object"&&a!=null&&"fill"in a?c=a.fill:c=s.fill,{value:y_(o,s.dataKey),color:c,payload:a,type:s.legendType}})}),cVe=Je([hse,VM,HM,ha],(t,s,r,a)=>{if(!(s==null||t==null))return uHe({offset:a,pieSettings:s,displayedData:t,cells:r})}),xse={exports:{}},gn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Aa=typeof Symbol=="function"&&Symbol.for,WM=Aa?Symbol.for("react.element"):60103,qM=Aa?Symbol.for("react.portal"):60106,Y_=Aa?Symbol.for("react.fragment"):60107,X_=Aa?Symbol.for("react.strict_mode"):60108,Q_=Aa?Symbol.for("react.profiler"):60114,Z_=Aa?Symbol.for("react.provider"):60109,J_=Aa?Symbol.for("react.context"):60110,GM=Aa?Symbol.for("react.async_mode"):60111,eS=Aa?Symbol.for("react.concurrent_mode"):60111,tS=Aa?Symbol.for("react.forward_ref"):60112,sS=Aa?Symbol.for("react.suspense"):60113,dVe=Aa?Symbol.for("react.suspense_list"):60120,nS=Aa?Symbol.for("react.memo"):60115,rS=Aa?Symbol.for("react.lazy"):60116,uVe=Aa?Symbol.for("react.block"):60121,mVe=Aa?Symbol.for("react.fundamental"):60117,hVe=Aa?Symbol.for("react.responder"):60118,xVe=Aa?Symbol.for("react.scope"):60119;function Ql(t){if(typeof t=="object"&&t!==null){var s=t.$$typeof;switch(s){case WM:switch(t=t.type,t){case GM:case eS:case Y_:case Q_:case X_:case sS:return t;default:switch(t=t&&t.$$typeof,t){case J_:case tS:case rS:case nS:case Z_:return t;default:return s}}case qM:return s}}}function pse(t){return Ql(t)===eS}gn.AsyncMode=GM;gn.ConcurrentMode=eS;gn.ContextConsumer=J_;gn.ContextProvider=Z_;gn.Element=WM;gn.ForwardRef=tS;gn.Fragment=Y_;gn.Lazy=rS;gn.Memo=nS;gn.Portal=qM;gn.Profiler=Q_;gn.StrictMode=X_;gn.Suspense=sS;gn.isAsyncMode=function(t){return pse(t)||Ql(t)===GM};gn.isConcurrentMode=pse;gn.isContextConsumer=function(t){return Ql(t)===J_};gn.isContextProvider=function(t){return Ql(t)===Z_};gn.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===WM};gn.isForwardRef=function(t){return Ql(t)===tS};gn.isFragment=function(t){return Ql(t)===Y_};gn.isLazy=function(t){return Ql(t)===rS};gn.isMemo=function(t){return Ql(t)===nS};gn.isPortal=function(t){return Ql(t)===qM};gn.isProfiler=function(t){return Ql(t)===Q_};gn.isStrictMode=function(t){return Ql(t)===X_};gn.isSuspense=function(t){return Ql(t)===sS};gn.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===Y_||t===eS||t===Q_||t===X_||t===sS||t===dVe||typeof t=="object"&&t!==null&&(t.$$typeof===rS||t.$$typeof===nS||t.$$typeof===Z_||t.$$typeof===J_||t.$$typeof===tS||t.$$typeof===mVe||t.$$typeof===hVe||t.$$typeof===xVe||t.$$typeof===uVe)};gn.typeOf=Ql;xse.exports=gn;var pVe=xse.exports,UF=t=>typeof t=="string"?t:t?t.displayName||t.name||"Component":"",VF=null,Kk=null,fse=t=>{if(t===VF&&Array.isArray(Kk))return Kk;var s=[];return p.Children.forEach(t,r=>{Sa(r)||(pVe.isFragment(r)?s=s.concat(fse(r.props.children)):s.push(r))}),Kk=s,VF=t,s};function KM(t,s){var r=[],a=[];return Array.isArray(s)?a=s.map(i=>UF(i)):a=[UF(s)],fse(t).forEach(i=>{var l=tx(i,"type.displayName")||tx(i,"type.name");l&&a.indexOf(l)!==-1&&r.push(i)}),r}var gse={};(function(t){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});function s(r){var i;if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const l=r[Symbol.toStringTag];return l==null||!((i=Object.getOwnPropertyDescriptor(r,Symbol.toStringTag))!=null&&i.writable)?!1:r.toString()===`[object ${l}]`}let a=r;for(;Object.getPrototypeOf(a)!==null;)a=Object.getPrototypeOf(a);return Object.getPrototypeOf(r)===a}t.isPlainObject=s})(gse);var fVe=gse.isPlainObject;const gVe=Ro(fVe);function HF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function WF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?HF(Object(r),!0).forEach(function(a){bVe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):HF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function bVe(t,s,r){return(s=yVe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function yVe(t){var s=vVe(t,"string");return typeof s=="symbol"?s:s+""}function vVe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function pw(){return pw=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},pw.apply(null,arguments)}var qF=(t,s,r,a,i)=>{var l=r-a,o;return o="M ".concat(t,",").concat(s),o+="L ".concat(t+r,",").concat(s),o+="L ".concat(t+r-l/2,",").concat(s+i),o+="L ".concat(t+r-l/2-a,",").concat(s+i),o+="L ".concat(t,",").concat(s," Z"),o},jVe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},NVe=t=>{var s=Li(t,jVe),{x:r,y:a,upperWidth:i,lowerWidth:l,height:o,className:c}=s,{animationEasing:d,animationDuration:u,animationBegin:m,isUpdateAnimationActive:x}=s,g=p.useRef(null),[y,v]=p.useState(-1),j=p.useRef(i),w=p.useRef(l),S=p.useRef(o),E=p.useRef(r),k=p.useRef(a),A=A_(t,"trapezoid-");if(p.useEffect(()=>{if(g.current&&g.current.getTotalLength)try{var R=g.current.getTotalLength();R&&v(R)}catch{}},[]),r!==+r||a!==+a||i!==+i||l!==+l||o!==+o||i===0&&l===0||o===0)return null;var I=mn("recharts-trapezoid",c);if(!x)return p.createElement("g",null,p.createElement("path",pw({},Mo(s),{className:I,d:qF(r,a,i,l,o)})));var P=j.current,O=w.current,D=S.current,T=E.current,B=k.current,U="0px ".concat(y===-1?1:y,"px"),W="".concat(y,"px 0px"),V=kJ(["strokeDasharray"],u,d);return p.createElement(k_,{animationId:A,key:A,canBegin:y>0,duration:u,easing:d,isActive:x,begin:m},R=>{var F=aa(P,i,R),G=aa(O,l,R),H=aa(D,o,R),$=aa(T,r,R),K=aa(B,a,R);g.current&&(j.current=F,w.current=G,S.current=H,E.current=$,k.current=K);var le=R>0?{transition:V,strokeDasharray:W}:{strokeDasharray:U};return p.createElement("path",pw({},Mo(s),{className:I,d:qF($,K,F,G,H),ref:g,style:WF(WF({},le),s.style)}))})},wVe=["option","shapeType","propTransformer","activeClassName","isActive"];function _Ve(t,s){if(t==null)return{};var r,a,i=SVe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function SVe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function GF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function fw(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?GF(Object(r),!0).forEach(function(a){CVe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):GF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function CVe(t,s,r){return(s=kVe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function kVe(t){var s=AVe(t,"string");return typeof s=="symbol"?s:s+""}function AVe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function EVe(t,s){return fw(fw({},s),t)}function TVe(t,s){return t==="symbols"}function KF(t){var{shapeType:s,elementProps:r}=t;switch(s){case"rectangle":return p.createElement(PJ,r);case"trapezoid":return p.createElement(NVe,r);case"sector":return p.createElement(OJ,r);case"symbols":if(TVe(s))return p.createElement(xZ,r);break;case"curve":return p.createElement(PD,r);default:return null}}function PVe(t){return p.isValidElement(t)?t.props:t}function bse(t){var{option:s,shapeType:r,propTransformer:a=EVe,activeClassName:i="recharts-active-shape",isActive:l}=t,o=_Ve(t,wVe),c;if(p.isValidElement(s))c=p.cloneElement(s,fw(fw({},o),PVe(s)));else if(typeof s=="function")c=s(o);else if(gVe(s)&&typeof s!="boolean"){var d=a(s,o);c=p.createElement(KF,{shapeType:r,elementProps:d})}else{var u=o;c=p.createElement(KF,{shapeType:r,elementProps:u})}return l?p.createElement(Mi,{className:i},c):c}var YM=(t,s)=>{var r=Qn();return(a,i)=>l=>{t==null||t(a,i,l),r(vte({activeIndex:String(i),activeDataKey:s,activeCoordinate:a.tooltipPosition}))}},XM=t=>{var s=Qn();return(r,a)=>i=>{t==null||t(r,a,i),s(QBe())}},QM=(t,s)=>{var r=Qn();return(a,i)=>l=>{t==null||t(a,i,l),r(ZBe({activeIndex:String(i),activeDataKey:s,activeCoordinate:a.tooltipPosition}))}};function yse(t){var{fn:s,args:r}=t,a=Qn(),i=Xl();return p.useLayoutEffect(()=>{if(!i){var l=s(r);return a(KBe(l)),()=>{a(YBe(l))}}},[s,r,a,i]),null}function DVe(t){var{legendPayload:s}=t,r=Qn(),a=Xl();return p.useLayoutEffect(()=>a?yx:(r(_J(s)),()=>{r(SJ(s))}),[r,a,s]),null}function MVe(t){var{legendPayload:s}=t,r=Qn(),a=es(an);return p.useLayoutEffect(()=>a!=="centric"&&a!=="radial"?yx:(r(_J(s)),()=>{r(SJ(s))}),[r,a,s]),null}var Yk,IVe=()=>{var[t]=p.useState(()=>Mb("uid-"));return t},OVe=(Yk=Iw.useId)!==null&&Yk!==void 0?Yk:IVe;function vse(t,s){var r=OVe();return s||(t?"".concat(t,"-").concat(r):r)}var RVe=p.createContext(void 0),jse=t=>{var{id:s,type:r,children:a}=t,i=vse("recharts-".concat(r),s);return p.createElement(RVe.Provider,{value:i},a(i))},LVe={cartesianItems:[],polarItems:[]},Nse=gl({name:"graphicalItems",initialState:LVe,reducers:{addCartesianGraphicalItem:{reducer(t,s){t.cartesianItems.push(s.payload)},prepare:oa()},replaceCartesianGraphicalItem:{reducer(t,s){var{prev:r,next:a}=s.payload,i=zd(t).cartesianItems.indexOf(r);i>-1&&(t.cartesianItems[i]=a)},prepare:oa()},removeCartesianGraphicalItem:{reducer(t,s){var r=zd(t).cartesianItems.indexOf(s.payload);r>-1&&t.cartesianItems.splice(r,1)},prepare:oa()},addPolarGraphicalItem:{reducer(t,s){t.polarItems.push(s.payload)},prepare:oa()},removePolarGraphicalItem:{reducer(t,s){var r=zd(t).polarItems.indexOf(s.payload);r>-1&&t.polarItems.splice(r,1)},prepare:oa()}}}),{addCartesianGraphicalItem:FVe,replaceCartesianGraphicalItem:BVe,removeCartesianGraphicalItem:$Ve,addPolarGraphicalItem:zVe,removePolarGraphicalItem:UVe}=Nse.actions,VVe=Nse.reducer;function HVe(t){var s=Qn(),r=p.useRef(null);return p.useLayoutEffect(()=>{r.current===null?s(FVe(t)):r.current!==t&&s(BVe({prev:r.current,next:t})),r.current=t},[s,t]),p.useLayoutEffect(()=>()=>{r.current&&(s($Ve(r.current)),r.current=null)},[s]),null}function WVe(t){var s=Qn();return p.useLayoutEffect(()=>(s(zVe(t)),()=>{s(UVe(t))}),[s,t]),null}var qVe=["onMouseEnter","onClick","onMouseLeave"],GVe=["id"],KVe=["id"];function ZM(t,s){if(t==null)return{};var r,a,i=YVe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function YVe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function YF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function Vn(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?YF(Object(r),!0).forEach(function(a){XVe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):YF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function XVe(t,s,r){return(s=QVe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function QVe(t){var s=ZVe(t,"string");return typeof s=="symbol"?s:s+""}function ZVe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function vm(){return vm=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},vm.apply(null,arguments)}function JVe(t){var s=p.useMemo(()=>KM(t.children,Xc),[t.children]),r=es(a=>oVe(a,t.id,s));return r==null?null:p.createElement(MVe,{legendPayload:r})}function eHe(t){var{dataKey:s,nameKey:r,sectors:a,stroke:i,strokeWidth:l,fill:o,name:c,hide:d,tooltipType:u}=t;return{dataDefinedOnItem:a.map(m=>m.tooltipPayload),positions:a.map(m=>m.tooltipPosition),settings:{stroke:i,strokeWidth:l,fill:o,dataKey:s,nameKey:r,name:y_(c,s),hide:d,type:u,color:o,unit:""}}}var tHe=(t,s)=>t>s?"start":t<s?"end":"middle",sHe=(t,s,r)=>di(typeof s=="function"?s(t):s,r,r*.8),nHe=(t,s,r)=>{var{top:a,left:i,width:l,height:o}=s,c=DJ(l,o),d=i+di(t.cx,l,l/2),u=a+di(t.cy,o,o/2),m=di(t.innerRadius,c,0),x=sHe(r,t.outerRadius,c),g=t.maxRadius||Math.sqrt(l*l+o*o)/2;return{cx:d,cy:u,innerRadius:m,outerRadius:x,maxRadius:g}},rHe=(t,s)=>{var r=qa(s-t),a=Math.min(Math.abs(s-t),360);return r*a};function aHe(t){return t&&typeof t=="object"&&"className"in t&&typeof t.className=="string"?t.className:""}var iHe=(t,s)=>{if(p.isValidElement(t))return p.cloneElement(t,s);if(typeof t=="function")return t(s);var r=mn("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return p.createElement(PD,vm({},s,{type:"linear",className:r}))},lHe=(t,s,r)=>{if(p.isValidElement(t))return p.cloneElement(t,s);var a=r;if(typeof t=="function"&&(a=t(s),p.isValidElement(a)))return a;var i=mn("recharts-pie-label-text",aHe(t));return p.createElement(q_,vm({},s,{alignmentBaseline:"middle",className:i}),a)};function oHe(t){var{sectors:s,props:r,showLabels:a}=t,{label:i,labelLine:l,dataKey:o}=r;if(!a||!i||!s)return null;var c=od(r),d=Db(i),u=Db(l),m=typeof i=="object"&&"offsetRadius"in i&&typeof i.offsetRadius=="number"&&i.offsetRadius||20,x=s.map((g,y)=>{var v=(g.startAngle+g.endAngle)/2,j=Kr(g.cx,g.cy,g.outerRadius+m,v),w=Vn(Vn(Vn(Vn({},c),g),{},{stroke:"none"},d),{},{index:y,textAnchor:tHe(j.x,g.cx)},j),S=Vn(Vn(Vn(Vn({},c),g),{},{fill:"none",stroke:g.fill},u),{},{index:y,points:[Kr(g.cx,g.cy,g.outerRadius,v),j],key:"line"});return p.createElement(gd,{zIndex:ci.label,key:"label-".concat(g.startAngle,"-").concat(g.endAngle,"-").concat(g.midAngle,"-").concat(y)},p.createElement(Mi,null,l&&iHe(l,S),lHe(i,w,ar(g,o))))});return p.createElement(Mi,{className:"recharts-pie-labels"},x)}function cHe(t){var{sectors:s,props:r,showLabels:a}=t,{label:i}=r;return typeof i=="object"&&i!=null&&"position"in i?p.createElement(cse,{label:i}):p.createElement(oHe,{sectors:s,props:r,showLabels:a})}function dHe(t){var{sectors:s,activeShape:r,inactiveShape:a,allOtherPieProps:i}=t,l=es(ix),{onMouseEnter:o,onClick:c,onMouseLeave:d}=i,u=ZM(i,qVe),m=YM(o,i.dataKey),x=XM(d),g=QM(c,i.dataKey);return s==null||s.length===0?null:p.createElement(p.Fragment,null,s.map((y,v)=>{if((y==null?void 0:y.startAngle)===0&&(y==null?void 0:y.endAngle)===0&&s.length!==1)return null;var j=r&&String(v)===l,w=l?a:null,S=j?r:w,E=Vn(Vn({},y),{},{stroke:y.stroke,tabIndex:-1,[xJ]:v,[pJ]:i.dataKey});return p.createElement(Mi,vm({key:"sector-".concat(y==null?void 0:y.startAngle,"-").concat(y==null?void 0:y.endAngle,"-").concat(y.midAngle,"-").concat(v),tabIndex:-1,className:"recharts-pie-sector"},u_(u,y,v),{onMouseEnter:m(y,v),onMouseLeave:x(y,v),onClick:g(y,v)}),p.createElement(bse,vm({option:S,isActive:j,shapeType:"sector"},E)))}))}function uHe(t){var s,{pieSettings:r,displayedData:a,cells:i,offset:l}=t,{cornerRadius:o,startAngle:c,endAngle:d,dataKey:u,nameKey:m,tooltipType:x}=r,g=Math.abs(r.minAngle),y=rHe(c,d),v=Math.abs(y),j=a.length<=1?0:(s=r.paddingAngle)!==null&&s!==void 0?s:0,w=a.filter(P=>ar(P,u,0)!==0).length,S=(v>=360?w:w-1)*j,E=v-w*g-S,k=a.reduce((P,O)=>{var D=ar(O,u,0);return P+(as(D)?D:0)},0),A;if(k>0){var I;A=a.map((P,O)=>{var D=ar(P,u,0),T=ar(P,m,O),B=nHe(r,l,P),U=(as(D)?D:0)/k,W,V=Vn(Vn({},P),i&&i[O]&&i[O].props);O?W=I.endAngle+qa(y)*j*(D!==0?1:0):W=c;var R=W+qa(y)*((D!==0?g:0)+U*E),F=(W+R)/2,G=(B.innerRadius+B.outerRadius)/2,H=[{name:T,value:D,payload:V,dataKey:u,type:x}],$=Kr(B.cx,B.cy,G,F);return I=Vn(Vn(Vn(Vn({},r.presentationProps),{},{percent:U,cornerRadius:typeof o=="string"?parseFloat(o):o,name:T,tooltipPayload:H,midAngle:F,middleRadius:G,tooltipPosition:$},V),B),{},{value:D,startAngle:W,endAngle:R,payload:V,paddingAngle:qa(y)*j}),I})}return A}function mHe(t){var{showLabels:s,sectors:r,children:a}=t,i=p.useMemo(()=>!s||!r?[]:r.map(l=>({value:l.value,payload:l.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:l.cx,cy:l.cy,innerRadius:l.innerRadius,outerRadius:l.outerRadius,startAngle:l.startAngle,endAngle:l.endAngle,clockWise:!1},fill:l.fill})),[r,s]);return p.createElement(qUe,{value:s?i:void 0},a)}function hHe(t){var{props:s,previousSectorsRef:r}=t,{sectors:a,isAnimationActive:i,animationBegin:l,animationDuration:o,animationEasing:c,activeShape:d,inactiveShape:u,onAnimationStart:m,onAnimationEnd:x}=s,g=A_(s,"recharts-pie-"),y=r.current,[v,j]=p.useState(!1),w=p.useCallback(()=>{typeof x=="function"&&x(),j(!1)},[x]),S=p.useCallback(()=>{typeof m=="function"&&m(),j(!0)},[m]);return p.createElement(mHe,{showLabels:!v,sectors:a},p.createElement(k_,{animationId:g,begin:l,duration:o,isActive:i,easing:c,onAnimationStart:S,onAnimationEnd:w,key:g},E=>{var k=[],A=a&&a[0],I=A==null?void 0:A.startAngle;return a==null||a.forEach((P,O)=>{var D=y&&y[O],T=O>0?tx(P,"paddingAngle",0):0;if(D){var B=aa(D.endAngle-D.startAngle,P.endAngle-P.startAngle,E),U=Vn(Vn({},P),{},{startAngle:I+T,endAngle:I+B+T});k.push(U),I=U.endAngle}else{var{endAngle:W,startAngle:V}=P,R=aa(0,W-V,E),F=Vn(Vn({},P),{},{startAngle:I+T,endAngle:I+R+T});k.push(F),I=F.endAngle}}),r.current=k,p.createElement(Mi,null,p.createElement(dHe,{sectors:k,activeShape:d,inactiveShape:u,allOtherPieProps:s}))}),p.createElement(cHe,{showLabels:!v,sectors:a,props:s}),s.children)}var xHe={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!jx.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:ci.area};function pHe(t){var{id:s}=t,r=ZM(t,GVe),{hide:a,className:i,rootTabIndex:l}=t,o=p.useMemo(()=>KM(t.children,Xc),[t.children]),c=es(m=>cVe(m,s,o)),d=p.useRef(null),u=mn("recharts-pie",i);return a||c==null?(d.current=null,p.createElement(Mi,{tabIndex:l,className:u})):p.createElement(gd,{zIndex:t.zIndex},p.createElement(yse,{fn:eHe,args:Vn(Vn({},t),{},{sectors:c})}),p.createElement(Mi,{tabIndex:l,className:u},p.createElement(hHe,{props:Vn(Vn({},r),{},{sectors:c}),previousSectorsRef:d})))}function gw(t){var s=Li(t,xHe),{id:r}=s,a=ZM(s,KVe),i=od(a);return p.createElement(jse,{id:r,type:"pie"},l=>p.createElement(p.Fragment,null,p.createElement(WVe,{type:"pie",id:l,data:a.data,dataKey:a.dataKey,hide:a.hide,angleAxisId:0,radiusAxisId:0,name:a.name,nameKey:a.nameKey,tooltipType:a.tooltipType,legendType:a.legendType,fill:a.fill,cx:a.cx,cy:a.cy,startAngle:a.startAngle,endAngle:a.endAngle,paddingAngle:a.paddingAngle,minAngle:a.minAngle,innerRadius:a.innerRadius,outerRadius:a.outerRadius,cornerRadius:a.cornerRadius,presentationProps:i,maxRadius:s.maxRadius}),p.createElement(JVe,vm({},a,{id:l})),p.createElement(pHe,vm({},a,{id:l}))))}gw.displayName="Pie";function XF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function QF(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?XF(Object(r),!0).forEach(function(a){fHe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):XF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function fHe(t,s,r){return(s=gHe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function gHe(t){var s=bHe(t,"string");return typeof s=="symbol"?s:s+""}function bHe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var yHe={xAxis:{},yAxis:{},zAxis:{}},wse=gl({name:"cartesianAxis",initialState:yHe,reducers:{addXAxis:{reducer(t,s){t.xAxis[s.payload.id]=s.payload},prepare:oa()},removeXAxis:{reducer(t,s){delete t.xAxis[s.payload.id]},prepare:oa()},addYAxis:{reducer(t,s){t.yAxis[s.payload.id]=s.payload},prepare:oa()},removeYAxis:{reducer(t,s){delete t.yAxis[s.payload.id]},prepare:oa()},addZAxis:{reducer(t,s){t.zAxis[s.payload.id]=s.payload},prepare:oa()},removeZAxis:{reducer(t,s){delete t.zAxis[s.payload.id]},prepare:oa()},updateYAxisWidth(t,s){var{id:r,width:a}=s.payload,i=t.yAxis[r];if(i){var l=i.widthHistory||[];if(l.length===3&&l[0]===l[2]&&a===l[1]&&a!==i.width&&Math.abs(a-l[0])<=1)return;var o=[...l,a].slice(-3);t.yAxis[r]=QF(QF({},t.yAxis[r]),{},{width:a,widthHistory:o})}}}}),{addXAxis:vHe,removeXAxis:jHe,addYAxis:NHe,removeYAxis:wHe,addZAxis:sJe,removeZAxis:nJe,updateYAxisWidth:_He}=wse.actions,SHe=wse.reducer,CHe=Je([ha],t=>({top:t.top,bottom:t.bottom,left:t.left,right:t.right})),kHe=Je([CHe,ou,cu],(t,s,r)=>{if(!(!t||s==null||r==null))return{x:t.left,y:t.top,width:Math.max(0,s-t.left-t.right),height:Math.max(0,r-t.top-t.bottom)}}),_se=()=>es(kHe),AHe="Invariant failed";function EHe(t,s){throw new Error(AHe)}var THe=["x","y"];function OA(){return OA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},OA.apply(null,arguments)}function ZF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function O0(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?ZF(Object(r),!0).forEach(function(a){PHe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ZF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function PHe(t,s,r){return(s=DHe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function DHe(t){var s=MHe(t,"string");return typeof s=="symbol"?s:s+""}function MHe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function IHe(t,s){if(t==null)return{};var r,a,i=OHe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function OHe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function RHe(t,s){var{x:r,y:a}=t,i=IHe(t,THe),l="".concat(r),o=parseInt(l,10),c="".concat(a),d=parseInt(c,10),u="".concat(s.height||i.height),m=parseInt(u,10),x="".concat(s.width||i.width),g=parseInt(x,10);return O0(O0(O0(O0(O0({},s),i),o?{x:o}:{}),d?{y:d}:{}),{},{height:m,width:g,name:s.name,radius:s.radius})}function bw(t){return p.createElement(bse,OA({shapeType:"rectangle",propTransformer:RHe,activeClassName:"recharts-active-bar"},t))}var LHe=function(s){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a,i)=>{if(as(s))return s;var l=as(a)||Sa(a);return l?s(a,i):(l||EHe(),r)}},FHe={},Sse=gl({name:"errorBars",initialState:FHe,reducers:{addErrorBar:(t,s)=>{var{itemId:r,errorBar:a}=s.payload;t[r]||(t[r]=[]),t[r].push(a)},replaceErrorBar:(t,s)=>{var{itemId:r,prev:a,next:i}=s.payload;t[r]&&(t[r]=t[r].map(l=>l.dataKey===a.dataKey&&l.direction===a.direction?i:l))},removeErrorBar:(t,s)=>{var{itemId:r,errorBar:a}=s.payload;t[r]&&(t[r]=t[r].filter(i=>i.dataKey!==a.dataKey||i.direction!==a.direction))}}}),{addErrorBar:rJe,replaceErrorBar:aJe,removeErrorBar:iJe}=Sse.actions,BHe=Sse.reducer,$He=["children"];function zHe(t,s){if(t==null)return{};var r,a,i=UHe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function UHe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var VHe={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},HHe=p.createContext(VHe);function WHe(t){var{children:s}=t,r=zHe(t,$He);return p.createElement(HHe.Provider,{value:r},s)}function Cse(t,s){var r,a,i=es(u=>uu(u,t)),l=es(u=>mu(u,s)),o=(r=i==null?void 0:i.allowDataOverflow)!==null&&r!==void 0?r:Sl.allowDataOverflow,c=(a=l==null?void 0:l.allowDataOverflow)!==null&&a!==void 0?a:Cl.allowDataOverflow,d=o||c;return{needClip:d,needClipX:o,needClipY:c}}function qHe(t){var{xAxisId:s,yAxisId:r,clipPathId:a}=t,i=_se(),{needClipX:l,needClipY:o,needClip:c}=Cse(s,r);if(!c||!i)return null;var{x:d,y:u,width:m,height:x}=i;return p.createElement("clipPath",{id:"clipPath-".concat(a)},p.createElement("rect",{x:l?d:d-m/2,y:o?u:u-x/2,width:l?m:m*2,height:o?x:x*2}))}function GHe(t,s){return t&&typeof t=="object"&&"zIndex"in t&&typeof t.zIndex=="number"&&Mr(t.zIndex)?t.zIndex:s}var KHe=["onMouseEnter","onMouseLeave","onClick"],YHe=["value","background","tooltipPosition"],XHe=["id"],QHe=["onMouseEnter","onClick","onMouseLeave"];function nu(){return nu=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},nu.apply(null,arguments)}function JF(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function Ci(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?JF(Object(r),!0).forEach(function(a){ZHe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):JF(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function ZHe(t,s,r){return(s=JHe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function JHe(t){var s=eWe(t,"string");return typeof s=="symbol"?s:s+""}function eWe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function yw(t,s){if(t==null)return{};var r,a,i=tWe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function tWe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var sWe=t=>{var{dataKey:s,name:r,fill:a,legendType:i,hide:l}=t;return[{inactive:l,dataKey:s,type:i,color:a,value:y_(r,s),payload:t}]};function nWe(t){var{dataKey:s,stroke:r,strokeWidth:a,fill:i,name:l,hide:o,unit:c}=t;return{dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:r,strokeWidth:a,fill:i,dataKey:s,nameKey:void 0,name:y_(l,s),hide:o,type:t.tooltipType,color:t.fill,unit:c}}}function rWe(t){var s=es(ix),{data:r,dataKey:a,background:i,allOtherBarProps:l}=t,{onMouseEnter:o,onMouseLeave:c,onClick:d}=l,u=yw(l,KHe),m=YM(o,a),x=XM(c),g=QM(d,a);if(!i||r==null)return null;var y=Db(i);return p.createElement(gd,{zIndex:GHe(i,ci.barBackground)},r.map((v,j)=>{var{value:w,background:S,tooltipPosition:E}=v,k=yw(v,YHe);if(!S)return null;var A=m(v,j),I=x(v,j),P=g(v,j),O=Ci(Ci(Ci(Ci(Ci({option:i,isActive:String(j)===s},k),{},{fill:"#eee"},S),y),u_(u,v,j)),{},{onMouseEnter:A,onMouseLeave:I,onClick:P,dataKey:a,index:j,className:"recharts-bar-background-rectangle"});return p.createElement(bw,nu({key:"background-bar-".concat(j)},O))}))}function aWe(t){var{showLabels:s,children:r,rects:a}=t,i=a==null?void 0:a.map(l=>{var o={x:l.x,y:l.y,width:l.width,lowerWidth:l.width,upperWidth:l.width,height:l.height};return Ci(Ci({},o),{},{value:l.value,payload:l.payload,parentViewBox:l.parentViewBox,viewBox:o,fill:l.fill})});return p.createElement(WUe,{value:s?i:void 0},r)}function iWe(t){var{shape:s,activeBar:r,baseProps:a,entry:i,index:l,dataKey:o}=t,c=es(ix),d=es(Ote),u=r&&String(l)===c&&(d==null||o===d),m=u?r:s;return u?p.createElement(gd,{zIndex:ci.activeBar},p.createElement(bw,nu({},a,{name:String(a.name)},i,{isActive:u,option:m,index:l,dataKey:o}))):p.createElement(bw,nu({},a,{name:String(a.name)},i,{isActive:u,option:m,index:l,dataKey:o}))}function lWe(t){var{shape:s,baseProps:r,entry:a,index:i,dataKey:l}=t;return p.createElement(bw,nu({},r,{name:String(r.name)},a,{isActive:!1,option:s,index:i,dataKey:l}))}function oWe(t){var s,{data:r,props:a}=t,i=(s=od(a))!==null&&s!==void 0?s:{},{id:l}=i,o=yw(i,XHe),{shape:c,dataKey:d,activeBar:u}=a,{onMouseEnter:m,onClick:x,onMouseLeave:g}=a,y=yw(a,QHe),v=YM(m,d),j=XM(g),w=QM(x,d);return r?p.createElement(p.Fragment,null,r.map((S,E)=>p.createElement(Mi,nu({key:"rectangle-".concat(S==null?void 0:S.x,"-").concat(S==null?void 0:S.y,"-").concat(S==null?void 0:S.value,"-").concat(E),className:"recharts-bar-rectangle"},u_(y,S,E),{onMouseEnter:v(S,E),onMouseLeave:j(S,E),onClick:w(S,E)}),u?p.createElement(iWe,{shape:c,activeBar:u,baseProps:o,entry:S,index:E,dataKey:d}):p.createElement(lWe,{shape:c,baseProps:o,entry:S,index:E,dataKey:d})))):null}function cWe(t){var{props:s,previousRectanglesRef:r}=t,{data:a,layout:i,isAnimationActive:l,animationBegin:o,animationDuration:c,animationEasing:d,onAnimationEnd:u,onAnimationStart:m}=s,x=r.current,g=A_(s,"recharts-bar-"),[y,v]=p.useState(!1),j=!y,w=p.useCallback(()=>{typeof u=="function"&&u(),v(!1)},[u]),S=p.useCallback(()=>{typeof m=="function"&&m(),v(!0)},[m]);return p.createElement(aWe,{showLabels:j,rects:a},p.createElement(k_,{animationId:g,begin:o,duration:c,isActive:l,easing:d,onAnimationEnd:w,onAnimationStart:S,key:g},E=>{var k=E===1?a:a==null?void 0:a.map((A,I)=>{var P=x&&x[I];if(P)return Ci(Ci({},A),{},{x:aa(P.x,A.x,E),y:aa(P.y,A.y,E),width:aa(P.width,A.width,E),height:aa(P.height,A.height,E)});if(i==="horizontal"){var O=aa(0,A.height,E),D=aa(A.stackedBarStart,A.y,E);return Ci(Ci({},A),{},{y:D,height:O})}var T=aa(0,A.width,E),B=aa(A.stackedBarStart,A.x,E);return Ci(Ci({},A),{},{width:T,x:B})});return E>0&&(r.current=k??null),k==null?null:p.createElement(Mi,null,p.createElement(oWe,{props:s,data:k}))}),p.createElement(cse,{label:s.label}),s.children)}function dWe(t){var s=p.useRef(null);return p.createElement(cWe,{previousRectanglesRef:s,props:t})}var kse=0,uWe=(t,s)=>{var r=Array.isArray(t.value)?t.value[1]:t.value;return{x:t.x,y:t.y,value:r,errorVal:ar(t,s)}};class mWe extends p.PureComponent{render(){var{hide:s,data:r,dataKey:a,className:i,xAxisId:l,yAxisId:o,needClip:c,background:d,id:u}=this.props;if(s||r==null)return null;var m=mn("recharts-bar",i),x=u;return p.createElement(Mi,{className:m,id:u},c&&p.createElement("defs",null,p.createElement(qHe,{clipPathId:x,xAxisId:l,yAxisId:o})),p.createElement(Mi,{className:"recharts-bar-rectangles",clipPath:c?"url(#clipPath-".concat(x,")"):void 0},p.createElement(rWe,{data:r,dataKey:a,background:d,allOtherBarProps:this.props}),p.createElement(dWe,this.props)))}}var hWe={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",hide:!1,isAnimationActive:!jx.isSsr,legendType:"rect",minPointSize:kse,xAxisId:0,yAxisId:0,zIndex:ci.bar};function xWe(t){var{xAxisId:s,yAxisId:r,hide:a,legendType:i,minPointSize:l,activeBar:o,animationBegin:c,animationDuration:d,animationEasing:u,isAnimationActive:m}=t,{needClip:x}=Cse(s,r),g=S_(),y=Xl(),v=KM(t.children,Xc),j=es(E=>UWe(E,s,r,y,t.id,v));if(g!=="vertical"&&g!=="horizontal")return null;var w,S=j==null?void 0:j[0];return S==null||S.height==null||S.width==null?w=0:w=g==="vertical"?S.height/2:S.width/2,p.createElement(WHe,{xAxisId:s,yAxisId:r,data:j,dataPointFormatter:uWe,errorBarOffset:w},p.createElement(mWe,nu({},t,{layout:g,needClip:x,data:j,xAxisId:s,yAxisId:r,hide:a,legendType:i,minPointSize:l,activeBar:o,animationBegin:c,animationDuration:d,animationEasing:u,isAnimationActive:m})))}function pWe(t){var{layout:s,barSettings:{dataKey:r,minPointSize:a},pos:i,bandSize:l,xAxis:o,yAxis:c,xAxisTicks:d,yAxisTicks:u,stackedData:m,displayedData:x,offset:g,cells:y,parentViewBox:v,dataStartIndex:j}=t,w=s==="horizontal"?c:o,S=m?w.scale.domain():null,E=t8e({numericAxis:w}),k=w.scale(E);return x.map((A,I)=>{var P,O,D,T,B,U;m?P=Y6e(m[I+j],S):(P=ar(A,r),Array.isArray(P)||(P=[E,P]));var W=LHe(a,kse)(P[1],I);if(s==="horizontal"){var V,[R,F]=[c.scale(P[0]),c.scale(P[1])];O=G7({axis:o,ticks:d,bandSize:l,offset:i.offset,entry:A,index:I}),D=(V=F??R)!==null&&V!==void 0?V:void 0,T=i.size;var G=R-F;if(B=cd(G)?0:G,U={x:O,y:g.top,width:T,height:g.height},Math.abs(W)>0&&Math.abs(B)<Math.abs(W)){var H=qa(B||W)*(Math.abs(W)-Math.abs(B));D-=H,B+=H}}else{var[$,K]=[o.scale(P[0]),o.scale(P[1])];if(O=$,D=G7({axis:c,ticks:u,bandSize:l,offset:i.offset,entry:A,index:I}),T=K-$,B=i.size,U={x:g.left,y:D,width:g.width,height:B},Math.abs(W)>0&&Math.abs(T)<Math.abs(W)){var le=qa(T||W)*(Math.abs(W)-Math.abs(T));T+=le}}if(O==null||D==null||T==null||B==null)return null;var se=Ci(Ci({},A),{},{stackedBarStart:k,x:O,y:D,width:T,height:B,value:m?P:P[1],payload:A,background:U,tooltipPosition:{x:O+T/2,y:D+B/2},parentViewBox:v},y&&y[I]&&y[I].props);return se}).filter(Boolean)}function fWe(t){var s=Li(t,hWe),r=Xl();return p.createElement(jse,{id:s.id,type:"bar"},a=>p.createElement(p.Fragment,null,p.createElement(DVe,{legendPayload:sWe(s)}),p.createElement(yse,{fn:nWe,args:s}),p.createElement(HVe,{type:"bar",id:a,data:void 0,xAxisId:s.xAxisId,yAxisId:s.yAxisId,zAxisId:0,dataKey:s.dataKey,stackId:e8e(s.stackId),hide:s.hide,barSize:s.barSize,minPointSize:s.minPointSize,maxBarSize:s.maxBarSize,isPanorama:r}),p.createElement(gd,{zIndex:s.zIndex},p.createElement(xWe,nu({},s,{id:a})))))}var Hb=p.memo(fWe);Hb.displayName="Bar";function eB(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function fv(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?eB(Object(r),!0).forEach(function(a){gWe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):eB(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function gWe(t,s,r){return(s=bWe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function bWe(t){var s=yWe(t,"string");return typeof s=="symbol"?s:s+""}function yWe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var vWe=(t,s)=>s,jWe=(t,s,r)=>r,NWe=(t,s,r,a)=>a,wWe=(t,s,r,a,i)=>i,Iy=Je([xM,wWe],(t,s)=>t.filter(r=>r.type==="bar").find(r=>r.id===s)),_We=Je([Iy],t=>t==null?void 0:t.maxBarSize),SWe=(t,s,r,a,i,l)=>l,tB=(t,s,r)=>{var a=r??t;if(!Sa(a))return di(a,s,0)},CWe=Je([an,xM,vWe,jWe,NWe],(t,s,r,a,i)=>s.filter(l=>t==="horizontal"?l.xAxisId===r:l.yAxisId===a).filter(l=>l.isPanorama===i).filter(l=>l.hide===!1).filter(l=>l.type==="bar")),kWe=(t,s,r,a)=>{var i=an(t);return i==="horizontal"?AA(t,"yAxis",r,a):AA(t,"xAxis",s,a)},AWe=(t,s,r)=>{var a=an(t);return a==="horizontal"?uF(t,"xAxis",s):uF(t,"yAxis",r)},EWe=(t,s,r)=>{var a={},i=t.filter(F_),l=t.filter(u=>u.stackId==null),o=i.reduce((u,m)=>(u[m.stackId]||(u[m.stackId]=[]),u[m.stackId].push(m),u),a),c=Object.entries(o).map(u=>{var[m,x]=u,g=x.map(v=>v.dataKey),y=tB(s,r,x[0].barSize);return{stackId:m,dataKeys:g,barSize:y}}),d=l.map(u=>{var m=[u.dataKey].filter(g=>g!=null),x=tB(s,r,u.barSize);return{stackId:void 0,dataKeys:m,barSize:x}});return[...c,...d]},TWe=Je([CWe,zFe,AWe],EWe),PWe=(t,s,r,a,i)=>{var l,o,c=Iy(t,s,r,a,i);if(c!=null){var d=an(t),u=Oee(t),{maxBarSize:m}=c,x=Sa(m)?u:m,g,y;return d==="horizontal"?(g=pf(t,"xAxis",s,a),y=xf(t,"xAxis",s,a)):(g=pf(t,"yAxis",r,a),y=xf(t,"yAxis",r,a)),(l=(o=YN(g,y,!0))!==null&&o!==void 0?o:x)!==null&&l!==void 0?l:0}},Ase=(t,s,r,a)=>{var i=an(t),l,o;return i==="horizontal"?(l=pf(t,"xAxis",s,a),o=xf(t,"xAxis",s,a)):(l=pf(t,"yAxis",r,a),o=xf(t,"yAxis",r,a)),YN(l,o)};function DWe(t,s,r,a,i){var l=a.length;if(!(l<1)){var o=di(t,r,0,!0),c,d=[];if(Mr(a[0].barSize)){var u=!1,m=r/l,x=a.reduce((S,E)=>S+(E.barSize||0),0);x+=(l-1)*o,x>=r&&(x-=(l-1)*o,o=0),x>=r&&m>0&&(u=!0,m*=.9,x=l*m);var g=(r-x)/2>>0,y={offset:g-o,size:0};c=a.reduce((S,E)=>{var k,A={stackId:E.stackId,dataKeys:E.dataKeys,position:{offset:y.offset+y.size+o,size:u?m:(k=E.barSize)!==null&&k!==void 0?k:0}},I=[...S,A];return y=I[I.length-1].position,I},d)}else{var v=di(s,r,0,!0);r-2*v-(l-1)*o<=0&&(o=0);var j=(r-2*v-(l-1)*o)/l;j>1&&(j>>=0);var w=Mr(i)?Math.min(j,i):j;c=a.reduce((S,E,k)=>[...S,{stackId:E.stackId,dataKeys:E.dataKeys,position:{offset:v+(j+o)*k+(j-w)/2,size:w}}],d)}return c}}var MWe=(t,s,r,a,i,l,o)=>{var c=Sa(o)?s:o,d=DWe(r,a,i!==l?i:l,t,c);return i!==l&&d!=null&&(d=d.map(u=>fv(fv({},u),{},{position:fv(fv({},u.position),{},{offset:u.position.offset-i/2})}))),d},IWe=Je([TWe,Oee,$Fe,Ree,PWe,Ase,_We],MWe),OWe=(t,s,r,a)=>pf(t,"xAxis",s,a),RWe=(t,s,r,a)=>pf(t,"yAxis",r,a),LWe=(t,s,r,a)=>xf(t,"xAxis",s,a),FWe=(t,s,r,a)=>xf(t,"yAxis",r,a),BWe=Je([IWe,Iy],(t,s)=>{if(!(t==null||s==null)){var r=t.find(a=>a.stackId===s.stackId&&s.dataKey!=null&&a.dataKeys.includes(s.dataKey));if(r!=null)return r.position}}),$We=(t,s)=>{var r=uM(s);if(!(!t||r==null||s==null)){var{stackId:a}=s;if(a!=null){var i=t[a];if(i){var{stackedData:l}=i;if(l)return l.find(o=>o.key===r)}}}},zWe=Je([kWe,Iy],$We),UWe=Je([ha,ED,OWe,RWe,LWe,FWe,BWe,an,sM,Ase,zWe,Iy,SWe],(t,s,r,a,i,l,o,c,d,u,m,x,g)=>{var{chartData:y,dataStartIndex:v,dataEndIndex:j}=d;if(!(x==null||o==null||s==null||c!=="horizontal"&&c!=="vertical"||r==null||a==null||i==null||l==null||u==null)){var{data:w}=x,S;if(w!=null&&w.length>0?S=w:S=y==null?void 0:y.slice(v,j+1),S!=null)return pWe({layout:c,barSettings:x,pos:o,parentViewBox:s,bandSize:u,xAxis:r,yAxis:a,xAxisTicks:i,yAxisTicks:l,stackedData:m,displayedData:S,offset:t,cells:g,dataStartIndex:v})}}),Ese=t=>{var{chartData:s}=t,r=Qn(),a=Xl();return p.useEffect(()=>a?()=>{}:(r(NF(s)),()=>{r(NF(void 0))}),[s,r,a]),null},sB={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},Tse=gl({name:"brush",initialState:sB,reducers:{setBrushSettings(t,s){return s.payload==null?sB:s.payload}}}),{setBrushSettings:lJe}=Tse.actions,VWe=Tse.reducer;function HWe(t,s,r){return(s=WWe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function WWe(t){var s=qWe(t,"string");return typeof s=="symbol"?s:s+""}function qWe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}class JM{static create(s){return new JM(s)}constructor(s){this.scale=s}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(s){var{bandAware:r,position:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(s!==void 0){if(a)switch(a){case"start":return this.scale(s);case"middle":{var i=this.bandwidth?this.bandwidth()/2:0;return this.scale(s)+i}case"end":{var l=this.bandwidth?this.bandwidth():0;return this.scale(s)+l}default:return this.scale(s)}if(r){var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(s)+o}return this.scale(s)}}isInRange(s){var r=this.range(),a=r[0],i=r[r.length-1];return a<=i?s>=a&&s<=i:s>=i&&s<=a}}HWe(JM,"EPS",1e-4);function GWe(t){return(t%180+180)%180}var KWe=function(s){var{width:r,height:a}=s,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=GWe(i),o=l*Math.PI/180,c=Math.atan(a/r),d=o>c&&o<Math.PI-c?a/Math.sin(o):r/Math.cos(o);return Math.abs(d)},YWe={dots:[],areas:[],lines:[]},Pse=gl({name:"referenceElements",initialState:YWe,reducers:{addDot:(t,s)=>{t.dots.push(s.payload)},removeDot:(t,s)=>{var r=zd(t).dots.findIndex(a=>a===s.payload);r!==-1&&t.dots.splice(r,1)},addArea:(t,s)=>{t.areas.push(s.payload)},removeArea:(t,s)=>{var r=zd(t).areas.findIndex(a=>a===s.payload);r!==-1&&t.areas.splice(r,1)},addLine:(t,s)=>{t.lines.push(s.payload)},removeLine:(t,s)=>{var r=zd(t).lines.findIndex(a=>a===s.payload);r!==-1&&t.lines.splice(r,1)}}}),{addDot:oJe,removeDot:cJe,addArea:dJe,removeArea:uJe,addLine:mJe,removeLine:hJe}=Pse.actions,XWe=Pse.reducer,QWe=p.createContext(void 0),ZWe=t=>{var{children:s}=t,[r]=p.useState("".concat(Mb("recharts"),"-clip")),a=_se();if(a==null)return null;var{x:i,y:l,width:o,height:c}=a;return p.createElement(QWe.Provider,{value:r},p.createElement("defs",null,p.createElement("clipPath",{id:r},p.createElement("rect",{x:i,y:l,height:c,width:o}))),s)};function ff(t,s){for(var r in t)if({}.hasOwnProperty.call(t,r)&&(!{}.hasOwnProperty.call(s,r)||t[r]!==s[r]))return!1;for(var a in s)if({}.hasOwnProperty.call(s,a)&&!{}.hasOwnProperty.call(t,a))return!1;return!0}function Dse(t,s){if(s<1)return[];if(s===1)return t;for(var r=[],a=0;a<t.length;a+=s)r.push(t[a]);return r}function JWe(t,s,r){var a={width:t.width+s.width,height:t.height+s.height};return KWe(a,r)}function eqe(t,s,r){var a=r==="width",{x:i,y:l,width:o,height:c}=t;return s===1?{start:a?i:l,end:a?i+o:l+c}:{start:a?i+o:l+c,end:a?i:l}}function vw(t,s,r,a,i){if(t*s<t*a||t*s>t*i)return!1;var l=r();return t*(s-t*l/2-a)>=0&&t*(s+t*l/2-i)<=0}function tqe(t,s){return Dse(t,s+1)}function sqe(t,s,r,a,i){for(var l=(a||[]).slice(),{start:o,end:c}=s,d=0,u=1,m=o,x=function(){var v=a==null?void 0:a[d];if(v===void 0)return{v:Dse(a,u)};var j=d,w,S=()=>(w===void 0&&(w=r(v,j)),w),E=v.coordinate,k=d===0||vw(t,E,S,m,c);k||(d=0,m=o,u+=1),k&&(m=E+t*(S()/2+i),d+=u)},g;u<=l.length;)if(g=x(),g)return g.v;return[]}function nB(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function ti(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?nB(Object(r),!0).forEach(function(a){nqe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nB(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function nqe(t,s,r){return(s=rqe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function rqe(t){var s=aqe(t,"string");return typeof s=="symbol"?s:s+""}function aqe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function iqe(t,s,r,a,i){for(var l=(a||[]).slice(),o=l.length,{start:c}=s,{end:d}=s,u=function(g){var y=l[g],v,j=()=>(v===void 0&&(v=r(y,g)),v);if(g===o-1){var w=t*(y.coordinate+t*j()/2-d);l[g]=y=ti(ti({},y),{},{tickCoord:w>0?y.coordinate-w*t:y.coordinate})}else l[g]=y=ti(ti({},y),{},{tickCoord:y.coordinate});if(y.tickCoord!=null){var S=vw(t,y.tickCoord,j,c,d);S&&(d=y.tickCoord-t*(j()/2+i),l[g]=ti(ti({},y),{},{isShow:!0}))}},m=o-1;m>=0;m--)u(m);return l}function lqe(t,s,r,a,i,l){var o=(a||[]).slice(),c=o.length,{start:d,end:u}=s;if(l){var m=a[c-1],x=r(m,c-1),g=t*(m.coordinate+t*x/2-u);if(o[c-1]=m=ti(ti({},m),{},{tickCoord:g>0?m.coordinate-g*t:m.coordinate}),m.tickCoord!=null){var y=vw(t,m.tickCoord,()=>x,d,u);y&&(u=m.tickCoord-t*(x/2+i),o[c-1]=ti(ti({},m),{},{isShow:!0}))}}for(var v=l?c-1:c,j=function(E){var k=o[E],A,I=()=>(A===void 0&&(A=r(k,E)),A);if(E===0){var P=t*(k.coordinate-t*I()/2-d);o[E]=k=ti(ti({},k),{},{tickCoord:P<0?k.coordinate-P*t:k.coordinate})}else o[E]=k=ti(ti({},k),{},{tickCoord:k.coordinate});if(k.tickCoord!=null){var O=vw(t,k.tickCoord,I,d,u);O&&(d=k.tickCoord+t*(I()/2+i),o[E]=ti(ti({},k),{},{isShow:!0}))}},w=0;w<v;w++)j(w);return o}function oqe(t,s,r){var{tick:a,ticks:i,viewBox:l,minTickGap:o,orientation:c,interval:d,tickFormatter:u,unit:m,angle:x}=t;if(!i||!i.length||!a)return[];if(as(d)||jx.isSsr){var g;return(g=tqe(i,as(d)?d:0))!==null&&g!==void 0?g:[]}var y=[],v=c==="top"||c==="bottom"?"width":"height",j=m&&v==="width"?Mg(m,{fontSize:s,letterSpacing:r}):{width:0,height:0},w=(k,A)=>{var I=typeof u=="function"?u(k.value,A):k.value;return v==="width"?JWe(Mg(I,{fontSize:s,letterSpacing:r}),j,x):Mg(I,{fontSize:s,letterSpacing:r})[v]},S=i.length>=2?qa(i[1].coordinate-i[0].coordinate):1,E=eqe(l,S,v);return d==="equidistantPreserveStart"?sqe(S,E,w,i,o):(d==="preserveStart"||d==="preserveStartEnd"?y=lqe(S,E,w,i,o,d==="preserveStartEnd"):y=iqe(S,E,w,i,o),y.filter(k=>k.isShow))}var cqe=t=>{var{ticks:s,label:r,labelGapWithTick:a=5,tickSize:i=0,tickMargin:l=0}=t,o=0;if(s){Array.from(s).forEach(m=>{if(m){var x=m.getBoundingClientRect();x.width>o&&(o=x.width)}});var c=r?r.getBoundingClientRect().width:0,d=i+l,u=o+d+c+(r?a:0);return Math.round(u)}return 0},dqe=["axisLine","width","height","className","hide","ticks","axisType"],uqe=["viewBox"],mqe=["viewBox"];function RA(t,s){if(t==null)return{};var r,a,i=hqe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function hqe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function lx(){return lx=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},lx.apply(null,arguments)}function rB(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function Hr(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?rB(Object(r),!0).forEach(function(a){xqe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):rB(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function xqe(t,s,r){return(s=pqe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function pqe(t){var s=fqe(t,"string");return typeof s=="symbol"?s:s+""}function fqe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var gqe={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd",zIndex:ci.axis};function bqe(t){var{x:s,y:r,width:a,height:i,orientation:l,mirror:o,axisLine:c,otherSvgProps:d}=t;if(!c)return null;var u=Hr(Hr(Hr({},d),od(c)),{},{fill:"none"});if(l==="top"||l==="bottom"){var m=+(l==="top"&&!o||l==="bottom"&&o);u=Hr(Hr({},u),{},{x1:s,y1:r+m*i,x2:s+a,y2:r+m*i})}else{var x=+(l==="left"&&!o||l==="right"&&o);u=Hr(Hr({},u),{},{x1:s+x*a,y1:r,x2:s+x*a,y2:r+i})}return p.createElement("line",lx({},u,{className:mn("recharts-cartesian-axis-line",tx(c,"className"))}))}function yqe(t,s,r,a,i,l,o,c,d){var u,m,x,g,y,v,j=c?-1:1,w=t.tickSize||o,S=as(t.tickCoord)?t.tickCoord:t.coordinate;switch(l){case"top":u=m=t.coordinate,g=r+ +!c*i,x=g-j*w,v=x-j*d,y=S;break;case"left":x=g=t.coordinate,m=s+ +!c*a,u=m-j*w,y=u-j*d,v=S;break;case"right":x=g=t.coordinate,m=s+ +c*a,u=m+j*w,y=u+j*d,v=S;break;default:u=m=t.coordinate,g=r+ +c*i,x=g+j*w,v=x+j*d,y=S;break}return{line:{x1:u,y1:x,x2:m,y2:g},tick:{x:y,y:v}}}function vqe(t,s){switch(t){case"left":return s?"start":"end";case"right":return s?"end":"start";default:return"middle"}}function jqe(t,s){switch(t){case"left":case"right":return"middle";case"top":return s?"start":"end";default:return s?"end":"start"}}function Nqe(t){var{option:s,tickProps:r,value:a}=t,i,l=mn(r.className,"recharts-cartesian-axis-tick-value");if(p.isValidElement(s))i=p.cloneElement(s,Hr(Hr({},r),{},{className:l}));else if(typeof s=="function")i=s(Hr(Hr({},r),{},{className:l}));else{var o="recharts-cartesian-axis-tick-value";typeof s!="boolean"&&(o=mn(o,s==null?void 0:s.className)),i=p.createElement(q_,lx({},r,{className:o}),a)}return i}var wqe=p.forwardRef((t,s)=>{var{ticks:r=[],tick:a,tickLine:i,stroke:l,tickFormatter:o,unit:c,padding:d,tickTextProps:u,orientation:m,mirror:x,x:g,y,width:v,height:j,tickSize:w,tickMargin:S,fontSize:E,letterSpacing:k,getTicksConfig:A,events:I,axisType:P}=t,O=oqe(Hr(Hr({},A),{},{ticks:r}),E,k),D=vqe(m,x),T=jqe(m,x),B=od(A),U=Db(a),W={};typeof i=="object"&&(W=i);var V=Hr(Hr({},B),{},{fill:"none"},W),R=O.map(H=>Hr({entry:H},yqe(H,g,y,v,j,m,w,x,S))),F=R.map(H=>{var{entry:$,line:K}=H;return p.createElement(Mi,{className:"recharts-cartesian-axis-tick",key:"tick-".concat($.value,"-").concat($.coordinate,"-").concat($.tickCoord)},i&&p.createElement("line",lx({},V,K,{className:mn("recharts-cartesian-axis-tick-line",tx(i,"className"))})))}),G=R.map((H,$)=>{var{entry:K,tick:le}=H,se=Hr(Hr(Hr(Hr({textAnchor:D,verticalAnchor:T},B),{},{stroke:"none",fill:l},U),le),{},{index:$,payload:K,visibleTicksCount:O.length,tickFormatter:o,padding:d},u);return p.createElement(Mi,lx({className:"recharts-cartesian-axis-tick-label",key:"tick-label-".concat(K.value,"-").concat(K.coordinate,"-").concat(K.tickCoord)},u_(I,K,$)),a&&p.createElement(Nqe,{option:a,tickProps:se,value:"".concat(typeof o=="function"?o(K.value,$):K.value).concat(c||"")}))});return p.createElement("g",{className:"recharts-cartesian-axis-ticks recharts-".concat(P,"-ticks")},G.length>0&&p.createElement(gd,{zIndex:ci.label},p.createElement("g",{className:"recharts-cartesian-axis-tick-labels recharts-".concat(P,"-tick-labels"),ref:s},G)),F.length>0&&p.createElement("g",{className:"recharts-cartesian-axis-tick-lines recharts-".concat(P,"-tick-lines")},F))}),_qe=p.forwardRef((t,s)=>{var{axisLine:r,width:a,height:i,className:l,hide:o,ticks:c,axisType:d}=t,u=RA(t,dqe),[m,x]=p.useState(""),[g,y]=p.useState(""),v=p.useRef(null);p.useImperativeHandle(s,()=>({getCalculatedWidth:()=>{var w;return cqe({ticks:v.current,label:(w=t.labelRef)===null||w===void 0?void 0:w.current,labelGapWithTick:5,tickSize:t.tickSize,tickMargin:t.tickMargin})}}));var j=p.useCallback(w=>{if(w){var S=w.getElementsByClassName("recharts-cartesian-axis-tick-value");v.current=S;var E=S[0];if(E){var k=window.getComputedStyle(E),A=k.fontSize,I=k.letterSpacing;(A!==m||I!==g)&&(x(A),y(I))}}},[m,g]);return o||a!=null&&a<=0||i!=null&&i<=0?null:p.createElement(gd,{zIndex:t.zIndex},p.createElement(Mi,{className:mn("recharts-cartesian-axis",l)},p.createElement(bqe,{x:t.x,y:t.y,width:a,height:i,orientation:t.orientation,mirror:t.mirror,axisLine:r,otherSvgProps:od(t)}),p.createElement(wqe,{ref:j,axisType:d,events:u,fontSize:m,getTicksConfig:t,height:t.height,letterSpacing:g,mirror:t.mirror,orientation:t.orientation,padding:t.padding,stroke:t.stroke,tick:t.tick,tickFormatter:t.tickFormatter,tickLine:t.tickLine,tickMargin:t.tickMargin,tickSize:t.tickSize,tickTextProps:t.tickTextProps,ticks:c,unit:t.unit,width:t.width,x:t.x,y:t.y}),p.createElement(AUe,{x:t.x,y:t.y,width:t.width,height:t.height,lowerWidth:t.width,upperWidth:t.width},p.createElement(FUe,{label:t.label,labelRef:t.labelRef}),t.children)))}),Sqe=p.memo(_qe,(t,s)=>{var{viewBox:r}=t,a=RA(t,uqe),{viewBox:i}=s,l=RA(s,mqe);return ff(r,i)&&ff(a,l)}),eI=p.forwardRef((t,s)=>{var r=Li(t,gqe);return p.createElement(Sqe,lx({},r,{ref:s}))});eI.displayName="CartesianAxis";var Cqe=["dangerouslySetInnerHTML","ticks"],kqe=["id"],Aqe=["domain"],Eqe=["domain"];function LA(){return LA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},LA.apply(null,arguments)}function jw(t,s){if(t==null)return{};var r,a,i=Tqe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function Tqe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function Pqe(t){var s=Qn();return p.useLayoutEffect(()=>(s(vHe(t)),()=>{s(jHe(t))}),[t,s]),null}var Dqe=t=>{var{xAxisId:s,className:r}=t,a=es(ED),i=Xl(),l="xAxis",o=es(w=>Vf(w,l,s,i)),c=es(w=>xte(w,l,s,i)),d=es(w=>dte(w,s)),u=es(w=>FBe(w,s)),m=es(w=>Hee(w,s));if(d==null||u==null||m==null)return null;var{dangerouslySetInnerHTML:x,ticks:g}=t,y=jw(t,Cqe),{id:v}=m,j=jw(m,kqe);return p.createElement(eI,LA({},y,j,{scale:o,x:u.x,y:u.y,width:d.width,height:d.height,className:mn("recharts-".concat(l," ").concat(l),r),viewBox:a,ticks:c,axisType:l}))},Mqe={allowDataOverflow:Sl.allowDataOverflow,allowDecimals:Sl.allowDecimals,allowDuplicatedCategory:Sl.allowDuplicatedCategory,height:Sl.height,hide:!1,mirror:Sl.mirror,orientation:Sl.orientation,padding:Sl.padding,reversed:Sl.reversed,scale:Sl.scale,tickCount:Sl.tickCount,type:Sl.type,xAxisId:0},Iqe=t=>{var s,r,a,i,l,o=Li(t,Mqe);return p.createElement(p.Fragment,null,p.createElement(Pqe,{interval:(s=o.interval)!==null&&s!==void 0?s:"preserveEnd",id:o.xAxisId,scale:o.scale,type:o.type,padding:o.padding,allowDataOverflow:o.allowDataOverflow,domain:o.domain,dataKey:o.dataKey,allowDuplicatedCategory:o.allowDuplicatedCategory,allowDecimals:o.allowDecimals,tickCount:o.tickCount,includeHidden:(r=o.includeHidden)!==null&&r!==void 0?r:!1,reversed:o.reversed,ticks:o.ticks,height:o.height,orientation:o.orientation,mirror:o.mirror,hide:o.hide,unit:o.unit,name:o.name,angle:(a=o.angle)!==null&&a!==void 0?a:0,minTickGap:(i=o.minTickGap)!==null&&i!==void 0?i:5,tick:(l=o.tick)!==null&&l!==void 0?l:!0,tickFormatter:o.tickFormatter}),p.createElement(Dqe,o))},Oqe=(t,s)=>{var{domain:r}=t,a=jw(t,Aqe),{domain:i}=s,l=jw(s,Eqe);return ff(a,l)?Array.isArray(r)&&r.length===2&&Array.isArray(i)&&i.length===2?r[0]===i[0]&&r[1]===i[1]:ff({domain:r},{domain:i}):!1},Wb=p.memo(Iqe,Oqe);Wb.displayName="XAxis";var Rqe=["dangerouslySetInnerHTML","ticks"],Lqe=["id"],Fqe=["domain"],Bqe=["domain"];function FA(){return FA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},FA.apply(null,arguments)}function Nw(t,s){if(t==null)return{};var r,a,i=$qe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function $qe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function zqe(t){var s=Qn();return p.useLayoutEffect(()=>(s(NHe(t)),()=>{s(wHe(t))}),[t,s]),null}var Uqe=t=>{var{yAxisId:s,className:r,width:a,label:i}=t,l=p.useRef(null),o=p.useRef(null),c=es(ED),d=Xl(),u=Qn(),m="yAxis",x=es(I=>Vf(I,m,s,d)),g=es(I=>ute(I,s)),y=es(I=>$Be(I,s)),v=es(I=>xte(I,m,s,d)),j=es(I=>Wee(I,s));if(p.useLayoutEffect(()=>{if(!(a!=="auto"||!g||UM(i)||p.isValidElement(i)||j==null)){var I=l.current;if(I){var P=I.getCalculatedWidth();Math.round(g.width)!==Math.round(P)&&u(_He({id:s,width:P}))}}},[v,g,u,i,s,a,j]),g==null||y==null||j==null)return null;var{dangerouslySetInnerHTML:w,ticks:S}=t,E=Nw(t,Rqe),{id:k}=j,A=Nw(j,Lqe);return p.createElement(eI,FA({},E,A,{ref:l,labelRef:o,scale:x,x:y.x,y:y.y,tickTextProps:a==="auto"?{width:void 0}:{width:a},width:g.width,height:g.height,className:mn("recharts-".concat(m," ").concat(m),r),viewBox:c,ticks:v,axisType:m}))},Vqe={allowDataOverflow:Cl.allowDataOverflow,allowDecimals:Cl.allowDecimals,allowDuplicatedCategory:Cl.allowDuplicatedCategory,hide:!1,mirror:Cl.mirror,orientation:Cl.orientation,padding:Cl.padding,reversed:Cl.reversed,scale:Cl.scale,tickCount:Cl.tickCount,type:Cl.type,width:Cl.width,yAxisId:0},Hqe=t=>{var s,r,a,i,l,o=Li(t,Vqe);return p.createElement(p.Fragment,null,p.createElement(zqe,{interval:(s=o.interval)!==null&&s!==void 0?s:"preserveEnd",id:o.yAxisId,scale:o.scale,type:o.type,domain:o.domain,allowDataOverflow:o.allowDataOverflow,dataKey:o.dataKey,allowDuplicatedCategory:o.allowDuplicatedCategory,allowDecimals:o.allowDecimals,tickCount:o.tickCount,padding:o.padding,includeHidden:(r=o.includeHidden)!==null&&r!==void 0?r:!1,reversed:o.reversed,ticks:o.ticks,width:o.width,orientation:o.orientation,mirror:o.mirror,hide:o.hide,unit:o.unit,name:o.name,angle:(a=o.angle)!==null&&a!==void 0?a:0,minTickGap:(i=o.minTickGap)!==null&&i!==void 0?i:5,tick:(l=o.tick)!==null&&l!==void 0?l:!0,tickFormatter:o.tickFormatter}),p.createElement(Uqe,o))},Wqe=(t,s)=>{var{domain:r}=t,a=Nw(t,Fqe),{domain:i}=s,l=Nw(s,Bqe);return ff(a,l)?Array.isArray(r)&&r.length===2&&Array.isArray(i)&&i.length===2?r[0]===i[0]&&r[1]===i[1]:ff({domain:r},{domain:i}):!1},qb=p.memo(Hqe,Wqe);qb.displayName="YAxis";var qqe={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oy=p;function Gqe(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Kqe=typeof Object.is=="function"?Object.is:Gqe,Yqe=Oy.useSyncExternalStore,Xqe=Oy.useRef,Qqe=Oy.useEffect,Zqe=Oy.useMemo,Jqe=Oy.useDebugValue;qqe.useSyncExternalStoreWithSelector=function(t,s,r,a,i){var l=Xqe(null);if(l.current===null){var o={hasValue:!1,value:null};l.current=o}else o=l.current;l=Zqe(function(){function d(y){if(!u){if(u=!0,m=y,y=a(y),i!==void 0&&o.hasValue){var v=o.value;if(i(v,y))return x=v}return x=y}if(v=x,Kqe(m,y))return v;var j=a(y);return i!==void 0&&i(v,j)?(m=y,v):(m=y,x=j)}var u=!1,m,x,g=r===void 0?null:r;return[function(){return d(s())},g===null?void 0:function(){return d(g())}]},[s,r,a,i]);var c=Yqe(t,l[0],l[1]);return Qqe(function(){o.hasValue=!0,o.value=c},[c]),Jqe(c),c};function eGe(t){t()}function tGe(){let t=null,s=null;return{clear(){t=null,s=null},notify(){eGe(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let a=t;for(;a;)r.push(a),a=a.next;return r},subscribe(r){let a=!0;const i=s={callback:r,next:null,prev:s};return i.prev?i.prev.next=i:t=i,function(){!a||t===null||(a=!1,i.next?i.next.prev=i.prev:s=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}var aB={notify(){},get:()=>[]};function sGe(t,s){let r,a=aB,i=0,l=!1;function o(j){m();const w=a.subscribe(j);let S=!1;return()=>{S||(S=!0,w(),x())}}function c(){a.notify()}function d(){v.onStateChange&&v.onStateChange()}function u(){return l}function m(){i++,r||(r=t.subscribe(d),a=tGe())}function x(){i--,r&&i===0&&(r(),r=void 0,a.clear(),a=aB)}function g(){l||(l=!0,m())}function y(){l&&(l=!1,x())}const v={addNestedSub:o,notifyNestedSubs:c,handleChangeWrapper:d,isSubscribed:u,trySubscribe:g,tryUnsubscribe:y,getListeners:()=>a};return v}var nGe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",rGe=nGe(),aGe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",iGe=aGe(),lGe=()=>rGe||iGe?p.useLayoutEffect:p.useEffect,oGe=lGe(),Xk=Symbol.for("react-redux-context"),Qk=typeof globalThis<"u"?globalThis:{};function cGe(){if(!p.createContext)return{};const t=Qk[Xk]??(Qk[Xk]=new Map);let s=t.get(p.createContext);return s||(s=p.createContext(null),t.set(p.createContext,s)),s}var dGe=cGe();function uGe(t){const{children:s,context:r,serverState:a,store:i}=t,l=p.useMemo(()=>{const d=sGe(i);return{store:i,subscription:d,getServerState:a?()=>a:void 0}},[i,a]),o=p.useMemo(()=>i.getState(),[i]);oGe(()=>{const{subscription:d}=l;return d.onStateChange=d.notifyNestedSubs,d.trySubscribe(),o!==i.getState()&&d.notifyNestedSubs(),()=>{d.tryUnsubscribe(),d.onStateChange=void 0}},[l,o]);const c=r||dGe;return p.createElement(c.Provider,{value:l},s)}var mGe=uGe,hGe=(t,s)=>s,tI=Je([hGe,an,Uee,pa,Pte,hu,X$e,ha],nze),sI=t=>{var s=t.currentTarget.getBoundingClientRect(),r=s.width/t.currentTarget.offsetWidth,a=s.height/t.currentTarget.offsetHeight;return{chartX:Math.round((t.clientX-s.left)/r),chartY:Math.round((t.clientY-s.top)/a)}},Mse=Io("mouseClick"),Ise=jy();Ise.startListening({actionCreator:Mse,effect:(t,s)=>{var r=t.payload,a=tI(s.getState(),sI(r));(a==null?void 0:a.activeIndex)!=null&&s.dispatch(JBe({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate}))}});var BA=Io("mouseMove"),Ose=jy();Ose.startListening({actionCreator:BA,effect:(t,s)=>{var r=t.payload,a=s.getState(),i=MM(a,a.tooltip.settings.shared),l=tI(a,sI(r));i==="axis"&&((l==null?void 0:l.activeIndex)!=null?s.dispatch(Nte({activeIndex:l.activeIndex,activeDataKey:void 0,activeCoordinate:l.activeCoordinate})):s.dispatch(jte()))}});var iB={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0},Rse=gl({name:"rootProps",initialState:iB,reducers:{updateOptions:(t,s)=>{var r;t.accessibilityLayer=s.payload.accessibilityLayer,t.barCategoryGap=s.payload.barCategoryGap,t.barGap=(r=s.payload.barGap)!==null&&r!==void 0?r:iB.barGap,t.barSize=s.payload.barSize,t.maxBarSize=s.payload.maxBarSize,t.stackOffset=s.payload.stackOffset,t.syncId=s.payload.syncId,t.syncMethod=s.payload.syncMethod,t.className=s.payload.className,t.baseValue=s.payload.baseValue}}}),xGe=Rse.reducer,{updateOptions:pGe}=Rse.actions,Lse=gl({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(t,s)=>s.payload}}),{updatePolarOptions:fGe}=Lse.actions,gGe=Lse.reducer,Fse=Io("keyDown"),Bse=Io("focus"),nI=jy();nI.startListening({actionCreator:Fse,effect:(t,s)=>{var r=s.getState(),a=r.rootProps.accessibilityLayer!==!1;if(a){var{keyboardInteraction:i}=r.tooltip,l=t.payload;if(!(l!=="ArrowRight"&&l!=="ArrowLeft"&&l!=="Enter")){var o=Number(IM(i,Wf(r))),c=hu(r);if(l==="Enter"){var d=hw(r,"axis","hover",String(i.index));s.dispatch(TA({active:!i.active,activeIndex:i.index,activeDataKey:i.dataKey,activeCoordinate:d}));return}var u=HBe(r),m=u==="left-to-right"?1:-1,x=l==="ArrowRight"?1:-1,g=o+x*m;if(!(c==null||g>=c.length||g<0)){var y=hw(r,"axis","hover",String(g));s.dispatch(TA({active:!0,activeIndex:g.toString(),activeDataKey:void 0,activeCoordinate:y}))}}}}});nI.startListening({actionCreator:Bse,effect:(t,s)=>{var r=s.getState(),a=r.rootProps.accessibilityLayer!==!1;if(a){var{keyboardInteraction:i}=r.tooltip;if(!i.active&&i.index==null){var l="0",o=hw(r,"axis","hover",String(l));s.dispatch(TA({activeDataKey:void 0,active:!0,activeIndex:l,activeCoordinate:o}))}}}});var co=Io("externalEvent"),$se=jy();$se.startListening({actionCreator:co,effect:(t,s)=>{if(t.payload.handler!=null){var r=s.getState(),a={activeCoordinate:O$e(r),activeDataKey:Ote(r),activeIndex:ix(r),activeLabel:Ite(r),activeTooltipIndex:ix(r),isTooltipActive:R$e(r)};t.payload.handler(a,t.payload.reactEvent)}}});var bGe=Je([Hf],t=>t.tooltipItemPayloads),yGe=Je([bGe,Dy,(t,s,r)=>s,(t,s,r)=>r],(t,s,r,a)=>{var i=t.find(c=>c.settings.dataKey===a);if(i!=null){var{positions:l}=i;if(l!=null){var o=s(l,r);return o}}}),zse=Io("touchMove"),Use=jy();Use.startListening({actionCreator:zse,effect:(t,s)=>{var r=t.payload;if(!(r.touches==null||r.touches.length===0)){var a=s.getState(),i=MM(a,a.tooltip.settings.shared);if(i==="axis"){var l=tI(a,sI({clientX:r.touches[0].clientX,clientY:r.touches[0].clientY,currentTarget:r.currentTarget}));(l==null?void 0:l.activeIndex)!=null&&s.dispatch(Nte({activeIndex:l.activeIndex,activeDataKey:void 0,activeCoordinate:l.activeCoordinate}))}else if(i==="item"){var o,c=r.touches[0];if(document.elementFromPoint==null)return;var d=document.elementFromPoint(c.clientX,c.clientY);if(!d||!d.getAttribute)return;var u=d.getAttribute(xJ),m=(o=d.getAttribute(pJ))!==null&&o!==void 0?o:void 0,x=yGe(s.getState(),u,m);s.dispatch(vte({activeDataKey:m,activeIndex:u,activeCoordinate:x}))}}}});var vGe=zZ({brush:VWe,cartesianAxis:SHe,chartData:Mze,errorBars:BHe,graphicalItems:VVe,layout:V6e,legend:L8e,options:Aze,polarAxis:sVe,polarOptions:gGe,referenceElements:XWe,rootProps:xGe,tooltip:e$e,zIndex:gze}),jGe=function(s){return x6e({reducer:vGe,preloadedState:s,middleware:r=>r({serializableCheck:!1}).concat([Ise.middleware,Ose.middleware,nI.middleware,$se.middleware,Use.middleware]),enhancers:r=>{var a=r;return typeof r=="function"&&(a=r()),a.concat(JZ({type:"raf"}))},devTools:jx.devToolsEnabled})};function Vse(t){var{preloadedState:s,children:r,reduxStoreName:a}=t,i=Xl(),l=p.useRef(null);if(i)return r;l.current==null&&(l.current=jGe(s));var o=jD;return p.createElement(mGe,{context:o,store:l.current},r)}function Hse(t){var{layout:s,margin:r}=t,a=Qn(),i=Xl();return p.useEffect(()=>{i||(a($6e(s)),a(B6e(r)))},[a,i,s,r]),null}function Wse(t){var s=Qn();return p.useEffect(()=>{s(pGe(t))},[s,t]),null}function lB(t){var{zIndex:s,isPanorama:r}=t,a=r?"recharts-zindex-panorama-":"recharts-zindex-",i=vse("".concat(a).concat(s)),l=Qn();return p.useLayoutEffect(()=>(l(pze({zIndex:s,elementId:i,isPanorama:r})),()=>{l(fze({zIndex:s,isPanorama:r}))}),[l,s,i,r]),p.createElement("g",{id:i})}function oB(t){var{children:s,isPanorama:r}=t,a=es(aze);if(!a||a.length===0)return s;var i=a.filter(o=>o<0),l=a.filter(o=>o>0);return p.createElement(p.Fragment,null,i.map(o=>p.createElement(lB,{key:o,zIndex:o,isPanorama:r})),s,l.map(o=>p.createElement(lB,{key:o,zIndex:o,isPanorama:r})))}var NGe=["children"];function wGe(t,s){if(t==null)return{};var r,a,i=_Ge(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function _Ge(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}function ww(){return ww=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},ww.apply(null,arguments)}var SGe={width:"100%",height:"100%",display:"block"},CGe=p.forwardRef((t,s)=>{var r=M8e(),a=I8e(),i=CJ();if(!ym(r)||!ym(a))return null;var{children:l,otherAttributes:o,title:c,desc:d}=t,u,m;return o!=null&&(typeof o.tabIndex=="number"?u=o.tabIndex:u=i?0:void 0,typeof o.role=="string"?m=o.role:m=i?"application":void 0),p.createElement(GQ,ww({},o,{title:c,desc:d,role:m,tabIndex:u,width:r,height:a,style:SGe,ref:s}),l)}),kGe=t=>{var{children:s}=t,r=es(w_);if(!r)return null;var{width:a,height:i,y:l,x:o}=r;return p.createElement(GQ,{width:a,height:i,x:o,y:l},s)},cB=p.forwardRef((t,s)=>{var{children:r}=t,a=wGe(t,NGe),i=Xl();return i?p.createElement(kGe,null,p.createElement(oB,{isPanorama:!0},r)):p.createElement(CGe,ww({ref:s},a),p.createElement(oB,{isPanorama:!1},r))});function AGe(){var t=Qn(),[s,r]=p.useState(null),a=es(l8e);return p.useEffect(()=>{if(s!=null){var i=s.getBoundingClientRect(),l=i.width/s.offsetWidth;Mr(l)&&l!==a&&t(U6e(l))}},[s,t,a]),r}function dB(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);s&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,a)}return r}function EGe(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?dB(Object(r),!0).forEach(function(a){TGe(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):dB(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function TGe(t,s,r){return(s=PGe(s))in t?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,t}function PGe(t){var s=DGe(t,"string");return typeof s=="symbol"?s:s+""}function DGe(t,s){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var a=r.call(t,s);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}function ox(){return ox=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},ox.apply(null,arguments)}var MGe=()=>(Uze(),null);function _w(t){if(typeof t=="number")return t;if(typeof t=="string"){var s=parseFloat(t);if(!Number.isNaN(s))return s}return 0}var IGe=p.forwardRef((t,s)=>{var r,a,i=p.useRef(null),[l,o]=p.useState({containerWidth:_w((r=t.style)===null||r===void 0?void 0:r.width),containerHeight:_w((a=t.style)===null||a===void 0?void 0:a.height)}),c=p.useCallback((u,m)=>{o(x=>{var g=Math.round(u),y=Math.round(m);return x.containerWidth===g&&x.containerHeight===y?x:{containerWidth:g,containerHeight:y}})},[]),d=p.useCallback(u=>{if(typeof s=="function"&&s(u),u!=null&&typeof ResizeObserver<"u"){var{width:m,height:x}=u.getBoundingClientRect();c(m,x);var g=v=>{var{width:j,height:w}=v[0].contentRect;c(j,w)},y=new ResizeObserver(g);y.observe(u),i.current=y}},[s,c]);return p.useEffect(()=>()=>{var u=i.current;u!=null&&u.disconnect()},[c]),p.createElement(p.Fragment,null,p.createElement(C_,{width:l.containerWidth,height:l.containerHeight}),p.createElement("div",ox({ref:d},t)))}),OGe=p.forwardRef((t,s)=>{var{width:r,height:a}=t,[i,l]=p.useState({containerWidth:_w(r),containerHeight:_w(a)}),o=p.useCallback((d,u)=>{l(m=>{var x=Math.round(d),g=Math.round(u);return m.containerWidth===x&&m.containerHeight===g?m:{containerWidth:x,containerHeight:g}})},[]),c=p.useCallback(d=>{if(typeof s=="function"&&s(d),d!=null){var{width:u,height:m}=d.getBoundingClientRect();o(u,m)}},[s,o]);return p.createElement(p.Fragment,null,p.createElement(C_,{width:i.containerWidth,height:i.containerHeight}),p.createElement("div",ox({ref:c},t)))}),RGe=p.forwardRef((t,s)=>{var{width:r,height:a}=t;return p.createElement(p.Fragment,null,p.createElement(C_,{width:r,height:a}),p.createElement("div",ox({ref:s},t)))}),LGe=p.forwardRef((t,s)=>{var{width:r,height:a}=t;return Qd(r)||Qd(a)?p.createElement(OGe,ox({},t,{ref:s})):p.createElement(RGe,ox({},t,{ref:s}))});function FGe(t){return t===!0?IGe:LGe}var BGe=p.forwardRef((t,s)=>{var{children:r,className:a,height:i,onClick:l,onContextMenu:o,onDoubleClick:c,onMouseDown:d,onMouseEnter:u,onMouseLeave:m,onMouseMove:x,onMouseUp:g,onTouchEnd:y,onTouchMove:v,onTouchStart:j,style:w,width:S,responsive:E,dispatchTouchEvents:k=!0}=t,A=p.useRef(null),I=Qn(),[P,O]=p.useState(null),[D,T]=p.useState(null),B=AGe(),U=TD(),W=(U==null?void 0:U.width)>0?U.width:S,V=(U==null?void 0:U.height)>0?U.height:i,R=p.useCallback(Z=>{B(Z),typeof s=="function"&&s(Z),O(Z),T(Z),Z!=null&&(A.current=Z)},[B,s,O,T]),F=p.useCallback(Z=>{I(Mse(Z)),I(co({handler:l,reactEvent:Z}))},[I,l]),G=p.useCallback(Z=>{I(BA(Z)),I(co({handler:u,reactEvent:Z}))},[I,u]),H=p.useCallback(Z=>{I(jte()),I(co({handler:m,reactEvent:Z}))},[I,m]),$=p.useCallback(Z=>{I(BA(Z)),I(co({handler:x,reactEvent:Z}))},[I,x]),K=p.useCallback(()=>{I(Bse())},[I]),le=p.useCallback(Z=>{I(Fse(Z.key))},[I]),se=p.useCallback(Z=>{I(co({handler:o,reactEvent:Z}))},[I,o]),J=p.useCallback(Z=>{I(co({handler:c,reactEvent:Z}))},[I,c]),ie=p.useCallback(Z=>{I(co({handler:d,reactEvent:Z}))},[I,d]),te=p.useCallback(Z=>{I(co({handler:g,reactEvent:Z}))},[I,g]),ne=p.useCallback(Z=>{I(co({handler:j,reactEvent:Z}))},[I,j]),q=p.useCallback(Z=>{k&&I(zse(Z)),I(co({handler:v,reactEvent:Z}))},[I,k,v]),ee=p.useCallback(Z=>{I(co({handler:y,reactEvent:Z}))},[I,y]),X=FGe(E);return p.createElement(Vte.Provider,{value:P},p.createElement(EOe.Provider,{value:D},p.createElement(X,{width:W??(w==null?void 0:w.width),height:V??(w==null?void 0:w.height),className:mn("recharts-wrapper",a),style:EGe({position:"relative",cursor:"default",width:W,height:V},w),onClick:F,onContextMenu:se,onDoubleClick:J,onFocus:K,onKeyDown:le,onMouseDown:ie,onMouseEnter:G,onMouseLeave:H,onMouseMove:$,onMouseUp:te,onTouchEnd:ee,onTouchMove:q,onTouchStart:ne,ref:R},p.createElement(MGe,null),r)))}),$Ge=["width","height","responsive","children","className","style","compact","title","desc"];function zGe(t,s){if(t==null)return{};var r,a,i=UGe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function UGe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var qse=p.forwardRef((t,s)=>{var{width:r,height:a,responsive:i,children:l,className:o,style:c,compact:d,title:u,desc:m}=t,x=zGe(t,$Ge),g=od(x);return d?p.createElement(p.Fragment,null,p.createElement(C_,{width:r,height:a}),p.createElement(cB,{otherAttributes:g,title:u,desc:m},l)):p.createElement(BGe,{className:o,style:c,width:r,height:a,responsive:i??!1,onClick:t.onClick,onMouseLeave:t.onMouseLeave,onMouseEnter:t.onMouseEnter,onMouseMove:t.onMouseMove,onMouseDown:t.onMouseDown,onMouseUp:t.onMouseUp,onContextMenu:t.onContextMenu,onDoubleClick:t.onDoubleClick,onTouchStart:t.onTouchStart,onTouchMove:t.onTouchMove,onTouchEnd:t.onTouchEnd},p.createElement(cB,{otherAttributes:g,title:u,desc:m,ref:s},p.createElement(ZWe,null,l)))});function $A(){return $A=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},$A.apply(null,arguments)}var VGe={top:5,right:5,bottom:5,left:5},HGe={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:VGe,reverseStackOrder:!1,syncMethod:"index",responsive:!1},WGe=p.forwardRef(function(s,r){var a,i=Li(s.categoricalChartProps,HGe),{chartName:l,defaultTooltipEventType:o,validateTooltipEventTypes:c,tooltipPayloadSearcher:d,categoricalChartProps:u}=s,m={chartName:l,defaultTooltipEventType:o,validateTooltipEventTypes:c,tooltipPayloadSearcher:d,eventEmitter:void 0};return p.createElement(Vse,{preloadedState:{options:m},reduxStoreName:(a=u.id)!==null&&a!==void 0?a:l},p.createElement(Ese,{chartData:u.data}),p.createElement(Hse,{layout:i.layout,margin:i.margin}),p.createElement(Wse,{baseValue:i.baseValue,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),p.createElement(qse,$A({},i,{ref:r})))}),qGe=["axis","item"],Sw=p.forwardRef((t,s)=>p.createElement(WGe,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:qGe,tooltipPayloadSearcher:Wte,categoricalChartProps:t,ref:s}));function GGe(t){var s=Qn();return p.useEffect(()=>{s(fGe(t))},[s,t]),null}var KGe=["layout"];function zA(){return zA=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)({}).hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},zA.apply(null,arguments)}function YGe(t,s){if(t==null)return{};var r,a,i=XGe(t,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)r=l[a],s.indexOf(r)===-1&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function XGe(t,s){if(t==null)return{};var r={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(s.indexOf(a)!==-1)continue;r[a]=t[a]}return r}var QGe={top:5,right:5,bottom:5,left:5},ZGe={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:QGe,reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1},JGe=p.forwardRef(function(s,r){var a,i=Li(s.categoricalChartProps,ZGe),{layout:l}=i,o=YGe(i,KGe),{chartName:c,defaultTooltipEventType:d,validateTooltipEventTypes:u,tooltipPayloadSearcher:m}=s,x={chartName:c,defaultTooltipEventType:d,validateTooltipEventTypes:u,tooltipPayloadSearcher:m,eventEmitter:void 0};return p.createElement(Vse,{preloadedState:{options:x},reduxStoreName:(a=i.id)!==null&&a!==void 0?a:c},p.createElement(Ese,{chartData:i.data}),p.createElement(Hse,{layout:l,margin:i.margin}),p.createElement(Wse,{baseValue:void 0,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className}),p.createElement(GGe,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),p.createElement(qse,zA({},o,{ref:r})))}),eKe=["item"],tKe={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},UA=p.forwardRef((t,s)=>{var r=Li(t,tKe);return p.createElement(JGe,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:eKe,tooltipPayloadSearcher:Wte,categoricalChartProps:r,ref:s})});const ku={patients:"/patients",opd:"/opd/appointments",ipd:"/ipd/bedboard",lab:"/lab/orders",radiology:"/ris/orders",pharmacy:"/pharmacy/inventory",billing:"/billing",ot:"/ot/schedule"},Au=["#0f172a","#0284c7","#22c55e","#e11d48","#6366f1"];function jd(t){const s=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}-${r}-${a}`}function uB(t,s){const r=new Date(t);return r.setDate(r.getDate()+s),r}const sKe={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.28,ease:"easeOut"}}},mB={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.22,ease:"easeOut"}}},Zk={hidden:{},visible:{transition:{staggerChildren:.07,delayChildren:.04}}},Jk={hidden:{opacity:0,y:10,scale:.985},visible:{opacity:1,y:0,scale:1,transition:{duration:.22,ease:"easeOut"}}};function hB(){var Y;const t=new Date,[s,r]=p.useState(()=>jd(t)),[a,i]=p.useState(()=>jd(t)),[l,o]=p.useState("today"),[c,d]=p.useState("overview"),[u,m]=p.useState(null),[x,g]=p.useState(null),[y,v]=p.useState(!0),[j,w]=p.useState(""),[S,E]=p.useState(0),k=!!(s&&a);p.useEffect(()=>{if(!k){v(!1),w(""),m(null);return}(async()=>{var oe,_e;v(!0),w("");try{const me=await vOe({date_from:s,date_to:a});m(me.data),g(new Date)}catch(xe){console.error(xe),w(((_e=(oe=xe==null?void 0:xe.response)==null?void 0:oe.data)==null?void 0:_e.detail)||"Failed to load dashboard data. Please try again."),m(null)}finally{v(!1)}})()},[s,a,S,k]);const A=((Y=u==null?void 0:u.filters)==null?void 0:Y.caps)||{},I=Object.keys(A).length>0,P=p.useMemo(()=>{var Q;return((Q=u==null?void 0:u.widgets)==null?void 0:Q.filter(oe=>oe.widget_type==="metric"))||[]},[u]),O=p.useMemo(()=>{var Q;return((Q=u==null?void 0:u.widgets)==null?void 0:Q.filter(oe=>oe.widget_type==="table"))||[]},[u]),D=p.useMemo(()=>{var Q;return((Q=u==null?void 0:u.widgets)==null?void 0:Q.filter(oe=>oe.widget_type==="chart"))||[]},[u]),T=D.find(Q=>Q.code==="patient_flow"),B=D.find(Q=>Q.code==="ipd_bed_occupancy"),U=D.find(Q=>Q.code==="revenue_by_stream"),W=D.find(Q=>Q.code==="appointment_status"),V=D.find(Q=>Q.code==="ipd_status"),R=D.find(Q=>Q.code==="payment_modes"),F=D.find(Q=>Q.code==="top_lab_tests"),G=D.find(Q=>Q.code==="top_radiology_tests"),H=D.find(Q=>Q.code==="billing_summary"),$=D.find(Q=>Q.code==="top_medicines"),K=O.find(Q=>Q.code==="recent_ipd_admissions"),le=P.filter(Q=>Q.code.startsWith("revenue_")),se=P.filter(Q=>!Q.code.startsWith("revenue_")),J=()=>E(Q=>Q+1),ie=Q=>{o(Q);const oe=new Date;if(Q==="today"){const _e=jd(oe);r(_e),i(_e)}else if(Q==="7d")r(jd(uB(oe,-6))),i(jd(oe));else if(Q==="30d")r(jd(uB(oe,-29))),i(jd(oe));else if(Q==="month"){const _e=new Date(oe.getFullYear(),oe.getMonth(),1);r(jd(_e)),i(jd(oe))}},te=Q=>oe=>{o("custom"),Q(oe.target.value)},ne=p.useMemo(()=>{if(!I)return[];const Q=[];return A.can_patients&&Q.push({key:"patients",label:"Patients",icon:Qs}),A.can_opd&&Q.push({key:"opd",label:"OPD",icon:Hs}),A.can_ipd&&Q.push({key:"ipd",label:"IPD / Beds",icon:cn}),A.can_lab&&Q.push({key:"lab",label:"Lab",icon:tl}),A.can_radiology&&Q.push({key:"radiology",label:"Radiology",icon:yo}),A.can_pharmacy&&Q.push({key:"pharmacy",label:"Pharmacy",icon:rr}),A.can_billing&&Q.push({key:"billing",label:"Billing",icon:Qi}),A.can_ot&&Q.push({key:"ot",label:"OT",icon:Co}),Q},[I,A]),q=p.useMemo(()=>{if(!u)return[];const Q=Me=>{var Ae;return((Ae=P.find(Ke=>Ke.code===Me))==null?void 0:Ae.data)??0},oe=Number(Q("metric_new_patients"))||0,_e=Number(Q("metric_opd_visits"))||0,xe=Number(Q("metric_ipd_admissions"))||0,Re=((B==null?void 0:B.data)||{}).occupancy_pct??0,Ze=(U==null?void 0:U.data)||[],$e=Array.isArray(Ze)&&Ze.length?[...Ze].sort((Me,Ae)=>(Ae.value||0)-(Me.value||0))[0]:null,fe=[];return A.can_patients&&P.length&&fe.push({key:"patients",label:"New Patients",value:oe,helper:"Registered in period",icon:Qs,tone:"sky"}),A.can_opd&&P.length&&fe.push({key:"opd",label:"OPD Visits",value:_e,helper:"Consults in period",icon:Hs,tone:"emerald"}),A.can_ipd&&P.length&&fe.push({key:"ipd",label:"IPD Admissions",value:xe,helper:"Admitted cases",icon:cn,tone:"violet"}),A.can_ipd&&B&&fe.push({key:"beds",label:"Bed Occupancy",value:Re,suffix:"%",helper:"Across wards",icon:cn,tone:"amber"}),$e&&(A.can_billing||A.can_pharmacy||A.can_lab||A.can_radiology)&&fe.push({key:"revenue",label:"Top Stream",value:$e.value||0,helper:$e.label||"",icon:$e.label==="Pharmacy"?rr:$e.label==="Lab"?tl:$e.label==="Radiology"?yo:Qi,tone:"rose"}),fe.filter(Boolean)},[u,P,B,U,A.can_patients,A.can_opd,A.can_ipd,A.can_billing,A.can_pharmacy,A.can_lab,A.can_radiology]),ee=p.useMemo(()=>{const Q=me=>{var $e;const Re=($e=P.find(fe=>fe.code===me))==null?void 0:$e.data,Ze=typeof Re=="number"?Re:typeof Re=="object"&&Re?Re.value??Re.total??Re.amount??0:Number(Re||0);return Number(Ze||0)},oe=(B==null?void 0:B.data)||{},_e=typeof oe.occupancy_pct=="number"?oe.occupancy_pct:null,xe=[];return A.can_patients&&xe.push({key:"patients",title:"Patients",desc:"Search, register, timeline & EMR",icon:Qs,href:ku.patients,stat:Q("metric_new_patients"),statLabel:"new",tone:"sky"}),A.can_opd&&xe.push({key:"opd",title:"OPD",desc:"Appointments, queue & visits",icon:Hs,href:ku.opd,stat:Q("metric_opd_visits"),statLabel:"visits",tone:"emerald"}),A.can_ipd&&xe.push({key:"ipd",title:"IPD / Beds",desc:"Admissions, bed board & occupancy",icon:cn,href:ku.ipd,stat:_e,statSuffix:_e!=null?"%":"",statLabel:"occupied",tone:"violet"}),A.can_lab&&xe.push({key:"lab",title:"Laboratory",desc:"Orders, sample, results & reports",icon:tl,href:ku.lab,tone:"amber"}),A.can_radiology&&xe.push({key:"radiology",title:"Radiology",desc:"Orders, scheduling & reporting",icon:yo,href:ku.radiology,tone:"sky"}),A.can_pharmacy&&xe.push({key:"pharmacy",title:"Pharmacy",desc:"Billing, GRN & stock movement",icon:rr,href:ku.pharmacy,tone:"emerald"}),A.can_billing&&xe.push({key:"billing",title:"Billing",desc:"Invoices, payments & refunds",icon:Qi,href:ku.billing,tone:"rose"}),A.can_ot&&xe.push({key:"ot",title:"OT",desc:"Cases, checklists & theatre flow",icon:Co,href:ku.ot,tone:"violet"}),xe},[A,P,B]),X=p.useMemo(()=>[{key:"overview",label:"Overview",show:!0},{key:"clinical",label:"Clinical",show:A.can_patients||A.can_opd||A.can_ipd},{key:"revenue",label:"Revenue",show:A.can_billing||A.can_pharmacy||A.can_lab||A.can_radiology},{key:"operations",label:"Operations",show:A.can_ipd||A.can_pharmacy||A.can_lab||A.can_radiology}].filter(oe=>oe.show),[A]);p.useEffect(()=>{X.find(Q=>Q.key===c)||X.length>0&&d(X[0].key)},[X,c]);const Z=p.useMemo(()=>!s||!a?"":s===a?s:`${s}  ${a}`,[s,a]);return n.jsxs(mt.div,{className:"relative min-h-[calc(100vh-4rem)] px-3 py-3 md:px-6 md:py-6",variants:sKe,initial:"hidden",animate:"visible",children:[n.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10 overflow-hidden",children:[n.jsx("div",{className:"absolute -top-24 right-0 h-56 w-56 rounded-full bg-amber-200/35 blur-3xl"}),n.jsx("div",{className:"absolute -bottom-24 left-0 h-56 w-56 rounded-full bg-sky-200/35 blur-3xl"}),n.jsx("div",{className:"absolute top-24 left-1/2 h-44 w-44 -translate-x-1/2 rounded-full bg-emerald-200/25 blur-3xl"})]}),n.jsxs("div",{className:"mx-auto w-full max-w-7xl space-y-4",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs(mt.div,{className:Bt("rounded-3xl border bg-white/80 backdrop-blur-xl","shadow-[0_18px_50px_rgba(15,23,42,0.08)]","border-slate-200/70"),children:[n.jsx("div",{className:"p-3 md:p-5",children:n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-slate-50 px-2.5 py-1 text-[11px] font-medium text-slate-700",children:[n.jsx($n,{className:"h-3.5 w-3.5 text-amber-600"}),"Apple-premium dashboard",n.jsx(eg,{className:"h-4 w-4 text-emerald-500"}),n.jsx("span",{className:"text-slate-600",children:"Live"})]}),n.jsxs("div",{className:"inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-700",children:[n.jsx(yg,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-medium",children:Z})]}),x&&n.jsxs("div",{className:"inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-600",children:[n.jsx(Na,{className:"h-3.5 w-3.5 text-slate-500"}),x.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-slate-200 bg-gradient-to-b from-slate-50 to-white shadow-sm",children:n.jsx(pp,{className:"h-5 w-5 text-slate-800"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl md:text-3xl font-semibold tracking-tight text-slate-900",children:"Dashboard"}),n.jsx("p",{className:"text-xs md:text-sm text-slate-600",children:"Monitor clinical activity, diagnostics, pharmacy and revenue  in one place."})]})]}),I&&ne.length>0&&n.jsx("div",{className:"flex flex-wrap gap-1.5 pt-1",children:ne.map(Q=>n.jsxs("span",{className:Bt("inline-flex items-center gap-1 rounded-full","border border-slate-200 bg-white px-2 py-0.5 text-[11px] text-slate-700","shadow-[0_8px_18px_rgba(15,23,42,0.03)]"),children:[n.jsx("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-slate-50 border border-slate-200",children:n.jsx(Q.icon,{className:"h-3.5 w-3.5 text-slate-700"})}),n.jsx("span",{className:"font-medium",children:Q.label})]},Q.key))})]}),n.jsxs("div",{className:"w-full lg:w-[520px] space-y-2",children:[n.jsx(nKe,{active:l,onChange:ie,items:[{key:"today",label:"Today"},{key:"7d",label:"7D"},{key:"30d",label:"30D"},{key:"month",label:"Month"},{key:"custom",label:"Custom"}]}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[n.jsx("div",{className:"flex-1 rounded-2xl border border-slate-200 bg-white px-3 py-2 shadow-sm",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(yg,{className:"h-4 w-4 text-slate-500"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 w-full",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-[10px] font-medium text-slate-500",children:"From"}),n.jsx("input",{type:"date",value:s,onChange:te(r),className:Bt("w-full rounded-xl border border-slate-200 bg-slate-50 px-2 py-1.5","text-[12px] text-slate-900 outline-none","focus:ring-2 focus:ring-sky-500/30 focus:border-sky-300")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-[10px] font-medium text-slate-500",children:"To"}),n.jsx("input",{type:"date",value:a,onChange:te(i),className:Bt("w-full rounded-xl border border-slate-200 bg-slate-50 px-2 py-1.5","text-[12px] text-slate-900 outline-none","focus:ring-2 focus:ring-sky-500/30 focus:border-sky-300")})]})]})]})}),n.jsxs(mt.button,{onClick:J,whileTap:{scale:.97},className:Bt("inline-flex items-center justify-center gap-2 rounded-2xl","border border-slate-200 bg-slate-900 text-white","px-4 py-2.5 text-sm font-medium shadow-sm","hover:bg-slate-800 transition-colors"),children:[n.jsx(ps,{className:"h-4 w-4"}),"Refresh"]})]})]})]})}),n.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-slate-200/90 to-transparent"}),n.jsxs("div",{className:"p-3 md:p-5 pt-3",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl border border-slate-200 bg-white shadow-sm",children:n.jsx(jV,{className:"h-4 w-4 text-slate-800"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Quick access"}),n.jsx("div",{className:"text-[12px] text-slate-600",children:"Jump into modules you have permission for."})]})]}),y?n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-2.5",children:Array.from({length:8}).map((Q,oe)=>n.jsx(Qe,{className:"h-[84px] rounded-2xl"},oe))}):ee.length===0?n.jsx("div",{className:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600",children:"No module shortcuts available for your role."}):n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-2.5",children:ee.map(Q=>n.jsx(rKe,{action:Q},Q.key))})]})]}),n.jsx(on,{children:j&&n.jsx(mt.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},children:n.jsxs(ml,{variant:"destructive",children:[n.jsx(Vs,{className:"h-4 w-4 mt-0.5"}),n.jsxs("div",{children:[n.jsx(hl,{children:"Dashboard error"}),n.jsx(xl,{children:j})]})]})})}),!y&&u&&q.length>0&&n.jsxs(mt.div,{className:Bt("rounded-3xl border border-slate-200/70 bg-white/85 backdrop-blur-xl","shadow-[0_18px_50px_rgba(15,23,42,0.06)] p-3 md:p-4"),variants:mB,initial:"hidden",animate:"visible",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2 px-1",children:[n.jsx("h2",{className:"text-xs font-semibold text-slate-700",children:"At a glance"}),n.jsx("span",{className:"h-px flex-1 bg-slate-200/80"})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(Q=>n.jsx(aKe,{pill:Q},Q.key))})]})]}),!k&&!y&&!j&&n.jsx(dt,{className:"rounded-3xl border border-dashed border-slate-200 bg-white/70 backdrop-blur-xl",children:n.jsxs(it,{className:"py-7 flex flex-col items-center text-center gap-2",children:[n.jsx(yg,{className:"w-8 h-8 text-slate-400 mb-1"}),n.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Select a date range to view dashboard data."}),n.jsxs("p",{className:"text-xs text-slate-500 max-w-xs",children:["Choose both ",n.jsx("span",{className:"font-semibold",children:"From"})," and"," ",n.jsx("span",{className:"font-semibold",children:"To"})," dates above."]})]})}),y&&k&&!u&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[n.jsx(Qe,{className:"h-24 rounded-3xl"}),n.jsx(Qe,{className:"h-24 rounded-3xl"}),n.jsx(Qe,{className:"h-24 rounded-3xl"}),n.jsx(Qe,{className:"h-24 rounded-3xl"})]}),n.jsx(Qe,{className:"h-72 rounded-3xl"}),n.jsx(Qe,{className:"h-72 rounded-3xl"})]}),!y&&k&&u&&n.jsx(mt.div,{variants:mB,initial:"hidden",animate:"visible",className:"pb-4",children:n.jsxs(Do,{value:c,onValueChange:d,className:"w-full",children:[n.jsx("div",{className:"flex justify-between items-center mb-2",children:n.jsx(Wl,{className:Bt("flex flex-nowrap overflow-x-auto gap-1 rounded-full","bg-white/80 backdrop-blur-xl border border-slate-200/70 p-1","shadow-[0_18px_50px_rgba(15,23,42,0.05)]"),children:X.map(Q=>n.jsx(zs,{value:Q.key,className:Bt("px-4 py-2 text-xs sm:text-sm rounded-full","data-[state=active]:bg-slate-900 data-[state=active]:text-white","data-[state=active]:shadow-sm"),children:Q.label},Q.key))})}),n.jsxs(Ls,{value:"overview",className:"space-y-4 mt-2",children:[P.length>0&&n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:pp,title:"Key metrics",subtitle:"High-signal numbers for the selected range"}),n.jsx(mt.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",variants:Zk,initial:"hidden",animate:"visible",children:P.map(Q=>n.jsx(mt.div,{variants:Jk,whileHover:{y:-3,scale:1.01},transition:{type:"spring",stiffness:240,damping:20},children:n.jsx(e5,{widget:Q})},Q.code))})]}),n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:Qs,title:"Activity & revenue mix",subtitle:"Trends and distribution"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 md:gap-4",children:[T&&n.jsx(Ia,{widget:T}),U&&n.jsx(Ia,{widget:U})]})]})]}),n.jsxs(Ls,{value:"clinical",className:"space-y-4 mt-2",children:[se.length>0&&n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:Hs,title:"Clinical metrics",subtitle:"Patients, OPD & IPD indicators"}),n.jsx(mt.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",variants:Zk,initial:"hidden",animate:"visible",children:se.map(Q=>n.jsx(mt.div,{variants:Jk,whileHover:{y:-3,scale:1.01},transition:{type:"spring",stiffness:240,damping:20},children:n.jsx(e5,{widget:Q})},Q.code))})]}),n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:Qs,title:"Flow & appointment status",subtitle:"OPD flow + appointment distribution"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 md:gap-4",children:[T&&n.jsx(Ia,{widget:T}),W&&n.jsx(Ia,{widget:W})]})]}),n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:cn,title:"IPD beds & admissions",subtitle:"Occupancy snapshot and status mix"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 md:gap-4",children:[B&&n.jsx(Ia,{widget:B}),V&&n.jsx(Ia,{widget:V})]})]}),K&&n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:cn,title:"Recent IPD admissions",subtitle:"Latest activity records"}),n.jsx(xB,{widget:K})]})]}),n.jsxs(Ls,{value:"revenue",className:"space-y-4 mt-2",children:[le.length>0&&n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:Qi,title:"Revenue KPIs",subtitle:"Billing and collections performance"}),n.jsx(mt.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",variants:Zk,initial:"hidden",animate:"visible",children:le.map(Q=>n.jsx(mt.div,{variants:Jk,whileHover:{y:-3,scale:1.01},transition:{type:"spring",stiffness:240,damping:20},children:n.jsx(e5,{widget:Q})},Q.code))})]}),n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:Qi,title:"Revenue & payment mix",subtitle:"Stream split + payment distribution"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 md:gap-4",children:[U&&n.jsx(Ia,{widget:U}),R&&n.jsx(Ia,{widget:R})]})]}),n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:tl,title:"Billing summary & top tests",subtitle:"Billed vs pending + diagnostics leaders"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-3 md:gap-4",children:[H&&n.jsx(Ia,{widget:H}),F&&n.jsx(Ia,{widget:F}),G&&n.jsx(Ia,{widget:G})]})]}),$&&n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:rr,title:"Top medicines",subtitle:"Top 10 by quantity (selected range)"}),n.jsx(Ia,{widget:$})]})]}),n.jsxs(Ls,{value:"operations",className:"space-y-4 mt-2",children:[n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:Co,title:"Capacity & utilization",subtitle:"Occupancy + flow side by side"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3 md:gap-4",children:[B&&n.jsx(Ia,{widget:B}),T&&n.jsx(Ia,{widget:T})]})]}),n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:yo,title:"Pharmacy & diagnostics focus",subtitle:"Top movers across modules"}),n.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-3 md:gap-4",children:[$&&n.jsx(Ia,{widget:$}),F&&n.jsx(Ia,{widget:F}),G&&n.jsx(Ia,{widget:G})]})]}),K&&n.jsxs("section",{className:"space-y-2",children:[n.jsx(wl,{icon:cn,title:"Latest IPD activity",subtitle:"Admission timeline (latest records)"}),n.jsx(xB,{widget:K})]})]})]})})]})]})}function nKe({items:t,active:s,onChange:r}){return n.jsx("div",{className:Bt("relative rounded-2xl border border-slate-200 bg-white px-1 py-1","shadow-sm"),children:n.jsx("div",{className:"grid grid-cols-5 gap-1",children:t.map(a=>{const i=s===a.key;return n.jsxs("button",{type:"button",onClick:()=>r(a.key),className:Bt("relative rounded-xl px-2 py-2 text-[12px] font-medium transition-colors",i?"text-white":"text-slate-700 hover:bg-slate-50"),children:[i&&n.jsx(mt.span,{layoutId:"presetActivePill",className:"absolute inset-0 rounded-xl bg-slate-900",transition:{type:"spring",stiffness:300,damping:24}}),n.jsx("span",{className:"relative z-10",children:a.label})]},a.key)})})})}function wl({icon:t,title:s,subtitle:r}){return n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl border border-slate-200 bg-white shadow-sm",children:t?n.jsx(t,{className:"h-4 w-4 text-slate-800"}):null}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:s}),r?n.jsx("p",{className:"text-[12px] text-slate-600",children:r}):null]})]})})}function rKe({action:t}){const{title:s,desc:r,icon:a,href:i,stat:l,statLabel:o,statSuffix:c,tone:d}=t,u={sky:"ring-sky-200/50",emerald:"ring-emerald-200/50",violet:"ring-violet-200/50",amber:"ring-amber-200/50",rose:"ring-rose-200/50"}[d]||"ring-slate-200/50",m={sky:"bg-sky-50 text-sky-700 border-sky-200/60",emerald:"bg-emerald-50 text-emerald-700 border-emerald-200/60",violet:"bg-violet-50 text-violet-700 border-violet-200/60",amber:"bg-amber-50 text-amber-700 border-amber-200/60",rose:"bg-rose-50 text-rose-700 border-rose-200/60"}[d]||"bg-slate-50 text-slate-700 border-slate-200/60";return n.jsxs(ul,{to:i,className:Bt("group rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl","shadow-[0_18px_50px_rgba(15,23,42,0.05)]","p-3 transition-all","hover:-translate-y-0.5 hover:shadow-[0_22px_60px_rgba(15,23,42,0.08)]","focus:outline-none focus:ring-2 focus:ring-sky-500/25","ring-1",u),children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsx("div",{className:Bt("h-10 w-10 rounded-2xl border flex items-center justify-center",m),children:a?n.jsx(a,{className:"h-5 w-5"}):null}),n.jsxs("div",{className:"flex items-center gap-2",children:[typeof l=="number"&&!Number.isNaN(l)&&n.jsxs("div",{className:"text-right",children:[n.jsxs("div",{className:"text-[16px] font-semibold text-slate-900 leading-tight",children:[l.toLocaleString("en-IN",{maximumFractionDigits:c==="%"?1:0}),c?n.jsx("span",{className:"text-[12px] ml-0.5",children:c}):null]}),n.jsx("div",{className:"text-[10px] text-slate-500",children:o||""})]}),n.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white shadow-sm transition-colors group-hover:bg-slate-800",children:n.jsx(jV,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:s}),n.jsx("div",{className:"text-[12px] text-slate-600 leading-snug",children:r})]})]})}function aKe({pill:t}){const{label:s,value:r,helper:a,icon:i,tone:l,suffix:o}=t,c={sky:"bg-sky-50 border-sky-100 text-sky-900",emerald:"bg-emerald-50 border-emerald-100 text-emerald-900",violet:"bg-violet-50 border-violet-100 text-violet-900",amber:"bg-amber-50 border-amber-100 text-amber-900",rose:"bg-rose-50 border-rose-100 text-rose-900"}[l||"sky"]||"bg-slate-50 border-slate-200 text-slate-900";return n.jsxs(mt.div,{whileHover:{y:-2,scale:1.01},transition:{type:"spring",stiffness:260,damping:18},className:Bt("flex-1 min-w-[150px] sm:min-w-[170px] rounded-3xl border px-3 py-2.5","flex items-center gap-3 shadow-[0_18px_50px_rgba(15,23,42,0.05)]",c),children:[n.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-2xl bg-white/80 border border-white/60 shadow-sm shrink-0",children:i&&n.jsx(i,{className:"w-4 h-4 text-slate-800"})}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide font-semibold opacity-90",children:s}),n.jsxs("div",{className:"text-base sm:text-lg font-semibold leading-tight",children:[typeof r=="number"?r.toLocaleString("en-IN",{maximumFractionDigits:o==="%"?1:0}):r,o&&n.jsx("span",{className:"ml-0.5 text-[11px]",children:o})]}),a&&n.jsx("div",{className:"text-[11px] leading-tight opacity-80",children:a})]})]})}function e5({widget:t}){const s=t.data,r=typeof s=="number"||typeof s=="string"?s:typeof s=="object"&&s!==null?s.value??s.total??s.amount??0:0,a=typeof r=="number"?r.toLocaleString("en-IN",{maximumFractionDigits:(t.code.includes("revenue"),0)}):r;return n.jsxs(dt,{className:Bt("rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl","shadow-[0_18px_50px_rgba(15,23,42,0.06)] overflow-hidden","transition-colors hover:border-sky-200/70"),children:[n.jsxs(gt,{className:"flex flex-row items-start justify-between space-y-0 pb-1",children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-500 shadow-[0_0_0_4px_rgba(16,185,129,0.18)]"}),t.title]}),n.jsx(et,{variant:"outline",className:"text-[9px] uppercase tracking-wide border-slate-200 text-slate-500 bg-white",children:t.code})]}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"text-2xl md:text-3xl font-semibold tracking-tight mt-1 text-slate-900",children:a}),t.description&&n.jsx("p",{className:"text-[12px] text-slate-600 mt-1",children:t.description})]})]})}function Ia({widget:t}){var l,o,c;const s=((l=t.config)==null?void 0:l.chart_type)||"bar",r={backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:12,fontSize:12,boxShadow:"0 12px 30px rgba(15,23,42,0.10)"};if(s==="donut"){const d=t.data||{},u=[{label:"Occupied",value:d.occupied||0},{label:"Available",value:d.available||0}];return n.jsxs(dt,{className:"rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl shadow-[0_18px_50px_rgba(15,23,42,0.06)]",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title}),n.jsx("span",{className:"rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-[10px] text-slate-600",children:"Snapshot"})]}),n.jsxs(it,{className:"h-56 sm:h-64",children:[n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(UA,{children:[n.jsx(gw,{dataKey:"value",data:u,innerRadius:52,outerRadius:84,paddingAngle:3,children:u.map((m,x)=>n.jsx(Xc,{fill:Au[x%Au.length]},`cell-${x}`))}),n.jsx(ph,{contentStyle:r})]})}),typeof d.occupancy_pct=="number"&&n.jsxs("p",{className:"text-xs text-slate-700 text-center mt-2",children:["Occupancy:"," ",n.jsxs("span",{className:"font-semibold text-emerald-600",children:[d.occupancy_pct,"%"]})," ",n.jsxs("span",{className:"opacity-80",children:["(",d.occupied,"/",d.total," beds)"]})]})]})]})}if(s==="pie"){const d=Array.isArray(t.data)?t.data:[];return n.jsxs(dt,{className:"rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl shadow-[0_18px_50px_rgba(15,23,42,0.06)]",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title}),n.jsx("span",{className:"rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-[10px] text-slate-600",children:"Distribution"})]}),n.jsx(it,{className:"h-56 sm:h-64",children:d.length===0?n.jsx("p",{className:"text-sm text-slate-500 mt-4",children:"No data to display."}):n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(UA,{children:[n.jsx(gw,{data:d,dataKey:"value",nameKey:"label",outerRadius:84,paddingAngle:3,labelLine:!1,children:d.map((u,m)=>n.jsx(Xc,{fill:Au[m%Au.length]},`cell-${m}`))}),n.jsx(ph,{contentStyle:r})]})})})]})}if(s==="multi_bar"){const d=Array.isArray(t.data)?t.data:[],u=((o=t.config)==null?void 0:o.series)||[],m=((c=t.config)==null?void 0:c.x_key)||"label";return n.jsxs(dt,{className:"rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl shadow-[0_18px_50px_rgba(15,23,42,0.06)]",children:[n.jsx(gt,{className:"pb-2",children:n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title})}),n.jsx(it,{className:"h-56 sm:h-64",children:d.length===0?n.jsx("p",{className:"text-sm text-slate-500 mt-4",children:"No data to display."}):n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(Sw,{data:d,margin:{left:8,right:8,top:8,bottom:8},children:[n.jsx(Wb,{dataKey:m,stroke:"#6b7280",fontSize:11}),n.jsx(qb,{stroke:"#6b7280",fontSize:11}),n.jsx(ph,{contentStyle:r}),u.map((x,g)=>n.jsx(Hb,{dataKey:x.key,name:x.label,radius:[6,6,0,0],children:d.map((y,v)=>n.jsx(Xc,{fill:Au[(g+v)%Au.length]},`cell-${x.key}-${v}`))},x.key))]})})})]})}const a=Array.isArray(t.data)?t.data:[],i=a.length>0?a.map((d,u)=>({label:d.label??d.name??`Item ${u+1}`,value:d.value??d.amount??0})):[];return n.jsxs(dt,{className:"rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl shadow-[0_18px_50px_rgba(15,23,42,0.06)]",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title}),n.jsx("span",{className:"rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-[10px] text-slate-600",children:t.description?"Insight":"Summary"})]}),n.jsx(it,{className:"h-56 sm:h-64",children:i.length===0?n.jsx("p",{className:"text-sm text-slate-500 mt-4",children:"No data to display."}):n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(Sw,{data:i,margin:{left:8,right:8,top:8,bottom:8},children:[n.jsx(Wb,{dataKey:"label",stroke:"#6b7280",fontSize:11}),n.jsx(qb,{stroke:"#6b7280",fontSize:11}),n.jsx(ph,{contentStyle:r}),n.jsx(Hb,{dataKey:"value",radius:[6,6,0,0],children:i.map((d,u)=>n.jsx(Xc,{fill:Au[u%Au.length]},`cell-${u}`))})]})})})]})}function xB({widget:t}){var a;const s=Array.isArray(t.data)?t.data:[],r=((a=t.config)==null?void 0:a.columns)||(s[0]?Object.keys(s[0]):[]);return n.jsxs(dt,{className:"rounded-3xl border border-slate-200/70 bg-white/90 backdrop-blur-xl shadow-[0_18px_50px_rgba(15,23,42,0.06)]",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title}),n.jsx("span",{className:"rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-[10px] text-slate-600",children:"Latest records"})]}),n.jsx(it,{className:"space-y-2",children:s.length===0?n.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"No records found."}):n.jsx("div",{className:"flex flex-col gap-2",children:s.map((i,l)=>n.jsx("div",{className:Bt("rounded-2xl border border-slate-200 bg-slate-50/60 px-3 py-2.5","flex flex-col gap-1 text-xs md:text-sm"),children:r.map((o,c)=>n.jsxs("div",{className:Bt("flex justify-between gap-2",c===0?"font-semibold text-slate-900":"text-slate-700"),children:[n.jsx("span",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:o.replace(/_/g," ")}),n.jsx("span",{className:"text-right",children:iKe(i[o])})]},o))},l))})})]})}function iKe(t){return t==null?"-":typeof t=="number"?t.toLocaleString("en-IN",{maximumFractionDigits:1}):typeof t=="string"&&t.length>40?t.slice(0,40)+"":String(t)}function lKe(){return he.get("/mis/definitions")}function oKe(t,s){return he.post(`/mis/reports/${t}`,s)}const gv=["#0f172a","#0f766e","#1e293b","#475569","#64748b"];function Nd(t){return t.toISOString().slice(0,10)}function pB(t,s){const r=new Date(t);return r.setDate(r.getDate()+s),r}function cKe(t){if(!t)return"";const s=t.value!==null&&t.value!==void 0?t.value:0;return`${t.label}: ${s}`}const dKe={hidden:{opacity:0,y:12},visible:{opacity:1,y:0,transition:{duration:.35,ease:"easeOut"}}},R0={hidden:{opacity:0,y:8},visible:(t=0)=>({opacity:1,y:0,transition:{duration:.3,ease:"easeOut",delay:t}})},fB={hidden:{},visible:{transition:{staggerChildren:.06}}},t5={hidden:{opacity:0,y:6,scale:.98},visible:{opacity:1,y:0,scale:1,transition:{duration:.25,ease:"easeOut"}}};function uKe(){const t=new Date,[s,r]=p.useState(()=>Nd(t)),[a,i]=p.useState(()=>Nd(t)),[l,o]=p.useState([]),[c,d]=p.useState(!0),[u,m]=p.useState(""),[x,g]=p.useState({}),[y,v]=p.useState("today"),[j,w]=p.useState(null),[S,E]=p.useState(!1),[k,A]=p.useState(""),[I,P]=p.useState("summary"),O=!!(s&&a);p.useEffect(()=>{let J=!0;return(async()=>{var te,ne;d(!0),A("");try{const q=await lKe();if(!J)return;const ee=(q==null?void 0:q.data)||[];o(ee),ee.length>0&&m(ee[0].code)}catch(q){if(console.error(q),!J)return;A(((ne=(te=q==null?void 0:q.response)==null?void 0:te.data)==null?void 0:ne.detail)||"Failed to load MIS report definitions.")}finally{J&&d(!1)}})(),()=>{J=!1}},[]);const D=p.useMemo(()=>l.find(J=>J.code===u)||null,[l,u]),T=J=>{v(J);const ie=new Date;if(J==="today"){const te=Nd(ie);r(te),i(te)}else if(J==="7d")r(Nd(pB(ie,-6))),i(Nd(ie));else if(J==="30d")r(Nd(pB(ie,-29))),i(Nd(ie));else if(J==="month"){const te=new Date(ie.getFullYear(),ie.getMonth(),1);r(Nd(te)),i(Nd(ie))}else J==="custom"&&v("custom")},B=J=>ie=>{v("custom"),J(ie.target.value)},U=(J,ie)=>{g(te=>({...te,[J]:ie}))},W=async()=>{var J,ie;if(!u||!O){A("Please select a report and valid date range.");return}E(!0),A(""),w(null);try{const ne=await oKe(u,{date_from:s,date_to:a,filters:x});w((ne==null?void 0:ne.data)||null)}catch(te){console.error(te),A(((ie=(J=te==null?void 0:te.response)==null?void 0:J.data)==null?void 0:ie.detail)||"Failed to run MIS report. Please check filters and try again.")}finally{E(!1)}},V=p.useMemo(()=>j!=null&&j.cards&&Array.isArray(j.cards)?j.cards:[],[j]),R=p.useMemo(()=>j!=null&&j.charts&&Array.isArray(j.charts)?j.charts:[],[j]),F=(D==null?void 0:D.category)||"MIS",G=R.filter(J=>J.type==="bar"),H=R.filter(J=>J.type==="pie"),$=(D==null?void 0:D.name)||"No report selected",K=O?`${s}  ${a}`:"Select a date range",le=S?"Running report":j?"Showing latest results":"Awaiting first run",se=[{value:"summary",label:"Summary"},{value:"charts",label:"Charts"}];return j!=null&&j.table&&se.push({value:"details",label:"Detailed view"}),n.jsx(mt.div,{className:"relative min-h-[calc(100vh-4rem)] bg-slate-50 px-3 py-3 sm:px-4 sm:py-4 md:px-6 md:py-6 lg:px-8",variants:dKe,initial:"hidden",animate:"visible",children:n.jsxs("div",{className:"mx-auto w-full max-w-6xl space-y-4 md:space-y-5 lg:space-y-6",children:[n.jsxs(mt.div,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs md:text-sm",custom:0,variants:R0,initial:"hidden",animate:"visible",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-slate-500 bg-white px-3 py-1.5 text-slate-800 shadow-sm",children:[n.jsx(AV,{className:"w-4 h-4"}),n.jsx("span",{className:"font-medium",children:"MIS  Management Information System"})]}),n.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 text-[11px]",children:[n.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-emerald-500 animate-pulse"}),n.jsx("span",{className:"inline-flex md:hidden rounded-full bg-white px-2 py-0.5 uppercase tracking-wide border border-slate-500",children:"Mobile view"}),n.jsx("span",{className:"hidden md:inline-flex lg:hidden rounded-full bg-white px-2 py-0.5 uppercase tracking-wide border border-slate-500",children:"Tablet / Laptop"}),n.jsx("span",{className:"hidden lg:inline-flex rounded-full bg-white px-2 py-0.5 uppercase tracking-wide border border-slate-500",children:"Desktop workspace"})]})]}),n.jsx(mt.div,{variants:R0,custom:.05,initial:"hidden",animate:"visible",children:n.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-teal-700 via-teal-600 to-blue-600 text-white shadow-md",children:[n.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none bg-[radial-gradient(circle_at_top,_#e0f2fe,_transparent_55%)]"}),n.jsxs("div",{className:"relative flex flex-col gap-4 md:flex-row md:items-center md:justify-between px-4 py-5 sm:px-6 sm:py-6 md:px-8 md:py-7 lg:px-10 lg:py-8",children:[n.jsxs("div",{className:"space-y-3 max-w-xl",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-medium backdrop-blur-sm border border-white/20",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/20 text-[11px]",children:"MIS"}),"Clean, focused analytics for your hospital"]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 md:h-12 md:w-12 items-center justify-center rounded-3xl bg-white/10 text-white shadow-sm border border-white/20",children:n.jsx(pp,{className:"w-6 h-6"})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-semibold tracking-tight",children:"MIS Reports Console"}),n.jsxs("p",{className:"text-sm md:text-base text-teal-50/90 leading-relaxed",children:["Generate"," ",n.jsx("span",{className:"font-semibold",children:"clinical, operational and financial"})," ","MIS reports in a light, distraction-free workspace."]})]})]}),(D==null?void 0:D.description)&&n.jsx("p",{className:"text-xs sm:text-sm text-teal-50/90",children:D.description})]}),n.jsxs("div",{className:"w-full md:w-auto space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap gap-2 justify-start md:justify-end",children:[n.jsx(et,{className:"bg-white/15 text-xs font-semibold border border-white/25 text-white rounded-full px-3 py-1",children:"IPD / OPD Ready"}),n.jsx(et,{className:"bg-white/10 text-xs border border-white/20 text-teal-50 rounded-full px-3 py-1",children:"NABH-aligned KPIs"}),n.jsx(et,{className:"bg-white/10 text-xs border border-white/20 text-teal-50 rounded-full px-3 py-1",children:F})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs",children:[n.jsxs("div",{className:"rounded-2xl bg-white/10 px-3 py-2.5 flex flex-col gap-1 border border-white/15",children:[n.jsx("span",{className:"text-[11px] font-medium text-teal-50/80 uppercase tracking-wide",children:"Active report"}),n.jsx("span",{className:"text-sm font-semibold line-clamp-2",children:$})]}),n.jsxs("div",{className:"rounded-2xl bg-white/10 px-3 py-2.5 flex flex-col gap-1 border border-white/15",children:[n.jsx("span",{className:"text-[11px] font-medium text-teal-50/80 uppercase tracking-wide",children:"Date range"}),n.jsx("span",{className:"text-sm font-semibold",children:K})]}),n.jsxs("div",{className:"rounded-2xl bg-white/10 px-3 py-2.5 flex flex-col gap-1 border border-white/15",children:[n.jsx("span",{className:"text-[11px] font-medium text-teal-50/80 uppercase tracking-wide",children:"Status"}),n.jsxs("span",{className:"text-sm font-semibold flex items-center gap-1.5",children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-300 animate-pulse"}),le]})]})]})]})]})]})}),n.jsx(on,{children:k&&n.jsx(mt.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},children:n.jsxs(ml,{className:"bg-red-50 border-red-200 text-red-800 rounded-2xl",children:[n.jsx(Vs,{className:"h-4 w-4 mt-0.5"}),n.jsxs("div",{children:[n.jsx(hl,{className:"text-red-900 font-semibold",children:"MIS error"}),n.jsx(xl,{className:"text-red-800/90 text-sm",children:k})]})]})})}),n.jsxs(mt.div,{variants:R0,custom:.1,initial:"hidden",animate:"visible",className:"grid gap-4 lg:gap-5 lg:grid-cols-[minmax(0,320px)_minmax(0,1fr)] xl:grid-cols-[minmax(0,340px)_minmax(0,1fr)]",children:[n.jsxs("div",{className:"space-y-3 lg:space-y-4 lg:sticky lg:top-24 self-start",children:[n.jsxs(dt,{className:"rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsx(gt,{className:"pb-2 flex flex-row items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-8 w-8 rounded-xl bg-teal-600 text-white flex items-center justify-center",children:n.jsx(pp,{className:"w-4 h-4"})}),n.jsxs("div",{children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Report & Date"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Choose MIS view and time window"})]})]})}),n.jsxs(it,{className:"space-y-3 pb-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"text-xs font-medium text-slate-800",children:"Report"}),n.jsxs("span",{className:"text-[11px] text-slate-500 flex items-center gap-1",children:[n.jsx(jr,{className:"w-3 h-3"}),"MIS group"]})]}),c?n.jsx(Qe,{className:"h-9 rounded-xl bg-slate-100"}):n.jsxs(Zs,{value:u,onValueChange:J=>{m(J),w(null)},children:[n.jsx(Ws,{className:"h-9 rounded-xl border-slate-500 bg-white text-xs text-slate-900 focus:ring-teal-200",children:n.jsx(Js,{placeholder:"Select report"})}),n.jsx(qs,{className:"bg-white border-slate-500 text-slate-900 max-h-72",children:l.map(J=>n.jsx(Ut,{value:String(J.code),className:"text-xs",children:J.name},J.code))})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("span",{className:"text-xs font-medium text-slate-800",children:"Quick ranges"}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"today",label:"Today"},{key:"7d",label:"Last 7 days"},{key:"30d",label:"Last 30 days"},{key:"month",label:"This month"},{key:"custom",label:"Custom"}].map(J=>n.jsx("button",{type:"button",onClick:()=>T(J.key),className:Bt("px-3 py-1 rounded-full text-[11px] font-medium border transition-colors",y===J.key?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-700 border-slate-500 hover:bg-slate-50"),children:J.label},J.key))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("span",{className:"text-xs font-medium text-slate-800",children:"Custom date range"}),n.jsx("div",{className:"flex flex-col gap-2",children:n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-slate-500 bg-white px-2.5 py-2",children:[n.jsx(yg,{className:"w-4 h-4 text-slate-500 shrink-0"}),n.jsxs("div",{className:"flex flex-col gap-2 w-full text-xs text-slate-800",children:[n.jsxs("div",{className:"flex items-center gap-2 w-full",children:[n.jsx("span",{className:"w-10 text-[11px] text-slate-500",children:"From"}),n.jsx(Ee,{type:"date",value:s,onChange:B(r),className:"h-8 w-full rounded-lg border-slate-500 bg-slate-50 text-xs text-slate-900"})]}),n.jsxs("div",{className:"flex items-center gap-2 w-full",children:[n.jsx("span",{className:"w-10 text-[11px] text-slate-500",children:"To"}),n.jsx(Ee,{type:"date",value:a,onChange:B(i),className:"h-8 w-full rounded-lg border-slate-500 bg-slate-50 text-xs text-slate-900"})]})]})]})})]}),n.jsx("div",{className:"pt-1",children:n.jsx(ge,{size:"sm",className:"h-9 w-full rounded-full inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-sm",onClick:W,disabled:S||!u||!O,children:S?n.jsxs(n.Fragment,{children:[n.jsx(ps,{className:"w-4 h-4 animate-spin"}),"Running report"]}):n.jsxs(n.Fragment,{children:[n.jsx(ps,{className:"w-4 h-4"}),"Run MIS report"]})})})]})]}),D&&Array.isArray(D.filters)&&D.filters.length>0&&n.jsxs(dt,{className:"rounded-2xl border border-slate-500 bg-white shadow-sm",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between gap-2",children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(jr,{className:"w-4 h-4 text-slate-500"}),"Advanced filters"]}),n.jsx("span",{className:"text-[11px] text-slate-500",children:"Tailor output for this report"})]}),n.jsx(it,{className:"pb-3",children:n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:D.filters.map(J=>J.type==="select"&&Array.isArray(J.options)?n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"text-xs font-medium text-slate-800",children:J.label}),J.required&&n.jsx("span",{className:"text-[11px] text-rose-500",children:"*"})]}),n.jsxs(Zs,{value:x[J.key]!==void 0?String(x[J.key]):"",onValueChange:ie=>U(J.key,ie),children:[n.jsx(Ws,{className:"h-9 rounded-xl border-slate-500 bg-slate-50 text-xs text-slate-900",children:n.jsx(Js,{placeholder:`All ${J.label.toLowerCase()}`})}),n.jsxs(qs,{className:"bg-white border-slate-500 text-slate-900 max-h-64",children:[n.jsx(Ut,{value:"__ALL__",className:"text-xs text-slate-500",children:"All"}),J.options.map(ie=>n.jsx(Ut,{value:String(ie.value),className:"text-xs",children:ie.label},ie.value))]})]})]},J.key):n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"text-xs font-medium text-slate-800",children:J.label}),J.required&&n.jsx("span",{className:"text-[11px] text-rose-500",children:"*"})]}),n.jsx(Ee,{value:x[J.key]??"",onChange:ie=>U(J.key,ie.target.value),placeholder:`Filter by ${J.label.toLowerCase()}`,className:"h-9 rounded-xl border-slate-500 bg-slate-50 text-xs text-slate-900 placeholder:text-slate-400"})]},J.key))})})]})]}),n.jsxs("div",{className:"space-y-3 lg:space-y-4",children:[!S&&!j&&n.jsx(dt,{className:"rounded-2xl border border-dashed border-slate-300 bg-white shadow-none",children:n.jsxs(it,{className:"py-10 px-4 sm:px-8 flex flex-col items-center justify-center text-center gap-3",children:[n.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center border border-slate-500 mb-1",children:n.jsx(pp,{className:"w-6 h-6 text-slate-700"})}),n.jsx("h2",{className:"text-base md:text-lg font-semibold text-slate-900",children:"Run your first MIS report"}),n.jsxs("p",{className:"text-sm text-slate-600 max-w-md",children:["Select a report on the left, choose a date range, add filters if needed and click"," ",n.jsx("span",{className:"font-semibold text-slate-900",children:"Run MIS report"})," ","to see KPIs, charts and detailed records."]})]})}),S&&n.jsxs(mt.div,{className:"space-y-4",variants:R0,custom:.15,initial:"hidden",animate:"visible",children:[n.jsx(Qe,{className:"h-16 rounded-2xl bg-white/80"}),n.jsx(Qe,{className:"h-64 rounded-2xl bg-white/80"}),n.jsx(Qe,{className:"h-64 rounded-2xl bg-white/80"})]}),!S&&j&&n.jsx(mt.div,{variants:R0,custom:.15,initial:"hidden",animate:"visible",children:n.jsxs(Do,{value:I,onValueChange:P,className:"w-full",children:[n.jsx("div",{className:"sticky top-[4.25rem] z-10 mb-2 bg-slate-50/95 backdrop-blur-sm border-b border-slate-500/80 pb-2 md:hidden",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("span",{className:"text-[11px] text-slate-600 font-medium",children:"Section"}),n.jsx("div",{className:"relative",children:n.jsx("select",{className:"w-full rounded-2xl border border-slate-500 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500",value:I,onChange:J=>P(J.target.value),children:se.map(J=>n.jsx("option",{value:J.value,children:J.label},J.value))})})]})}),n.jsxs("div",{className:"hidden md:flex md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[n.jsx(Wl,{className:"flex flex-nowrap overflow-x-auto gap-1 rounded-full bg-slate-100 p-1 border border-slate-500",children:se.map(J=>n.jsx(zs,{value:J.value,className:"px-3 py-1.5 text-xs sm:text-sm rounded-full data-[state=active]:bg-white data-[state=active]:text-slate-900 data-[state=active]:shadow-sm",children:J.label},J.value))}),n.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-slate-500",children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-500 animate-pulse"}),n.jsxs("span",{children:["Generated for"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:j.name})]})]})]}),n.jsxs(Ls,{value:"summary",className:"space-y-4 mt-2",children:[V.length>0&&n.jsxs("section",{className:"space-y-2",children:[n.jsxs("h2",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-slate-100 text-slate-700 border border-slate-500",children:n.jsx(pp,{className:"w-3 h-3"})}),"Key indicators"]}),n.jsx(mt.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-4",variants:fB,initial:"hidden",animate:"visible",children:V.map((J,ie)=>n.jsx(mt.div,{variants:t5,children:n.jsx(mKe,{card:J})},ie))})]}),G[0]&&n.jsxs("section",{className:"space-y-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Primary trend"}),n.jsx(s5,{chart:G[0]})]})]}),n.jsx(Ls,{value:"charts",className:"space-y-4 mt-2",children:n.jsxs("section",{className:"space-y-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Chart views"}),n.jsxs(mt.div,{className:"grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-3 md:gap-4",variants:fB,initial:"hidden",animate:"visible",children:[G.map(J=>n.jsx(mt.div,{variants:t5,children:n.jsx(s5,{chart:J})},J.code)),H.map(J=>n.jsx(mt.div,{variants:t5,children:n.jsx(s5,{chart:J})},J.code))]})]})}),j.table&&n.jsx(Ls,{value:"details",className:"space-y-4 mt-2",children:n.jsxs("section",{className:"space-y-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Detailed records"}),n.jsx(hKe,{table:j.table})]})})]})})]})]})]})})}function mKe({card:t}){return n.jsxs(mt.div,{whileHover:{y:-2,scale:1.01},transition:{type:"spring",stiffness:240,damping:22},className:Bt("rounded-2xl border border-slate-500 bg-white px-4 py-3 shadow-sm","flex flex-col gap-1.5"),children:[n.jsx("div",{className:"text-[11px] uppercase tracking-wide font-semibold text-slate-500",children:t.label}),n.jsx("div",{className:"text-xl md:text-2xl font-semibold leading-tight text-slate-900",children:typeof t.value=="number"?t.value.toLocaleString("en-IN",{maximumFractionDigits:1}):t.value}),t.helper&&n.jsx("div",{className:"text-xs text-slate-500",children:t.helper})]})}function s5({chart:t}){const s=t.type||"bar",r=Array.isArray(t.data)?t.data:[],a=t.config||{};if(s==="pie"){const l=r.length>0?r.map((o,c)=>({label:o.label??o.name??`Item ${c+1}`,value:o.value??o.amount??0})):[];return n.jsxs(dt,{className:"rounded-2xl shadow-sm border border-slate-500 bg-white",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title}),n.jsx("span",{className:"rounded-full bg-slate-50 px-2 py-0.5 text-[11px] text-slate-600 border border-slate-500",children:"Distribution"})]}),n.jsx(it,{className:"h-56 sm:h-64",children:l.length===0?n.jsx("p",{className:"text-sm text-slate-500 mt-4",children:"No data to display."}):n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(UA,{children:[n.jsx(gw,{data:l,dataKey:"value",nameKey:"label",outerRadius:80,paddingAngle:3,labelLine:!1,label:cKe,children:l.map((o,c)=>n.jsx(Xc,{fill:gv[c%gv.length]},`cell-${c}`))}),n.jsx(ph,{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:8,fontSize:12,color:"#111827"}})]})})})]})}const i=r.length>0?r.map((l,o)=>({label:l.label??l.name??`Item ${o+1}`,value:l.value??l.amount??0})):[];return n.jsxs(dt,{className:"rounded-2xl shadow-sm border border-slate-500 bg-white",children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:t.title}),n.jsx("span",{className:"rounded-full bg-slate-50 px-2 py-0.5 text-[11px] text-slate-600 border border-slate-500",children:(a==null?void 0:a.label)||"Trend"})]}),n.jsx(it,{className:"h-56 sm:h-64",children:i.length===0?n.jsx("p",{className:"text-sm text-slate-500 mt-4",children:"No data to display."}):n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(Sw,{data:i,margin:{left:8,right:8,top:8,bottom:8},children:[n.jsx(Wb,{dataKey:"label",stroke:"#9ca3af",fontSize:11,tickLine:!1,axisLine:{stroke:"#e5e7eb"}}),n.jsx(qb,{stroke:"#9ca3af",fontSize:11,tickLine:!1,axisLine:{stroke:"#e5e7eb"}}),n.jsx(ph,{contentStyle:{backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:8,fontSize:12,color:"#111827"}}),n.jsx(Hb,{dataKey:"value",radius:[4,4,0,0],children:i.map((l,o)=>n.jsx(Xc,{fill:gv[o%gv.length]},`cell-${o}`))})]})})})]})}function hKe({table:t}){const s=Array.isArray(t.rows)?t.rows:[],r=t.columns&&t.columns.length>0?t.columns:s[0]?Object.keys(s[0]):[],[a,i]=p.useState(""),[l,o]=p.useState("all");if(s.length===0)return n.jsx(dt,{className:"rounded-2xl shadow-sm border border-slate-500 bg-white",children:n.jsx(it,{className:"py-6 flex items-center justify-center",children:n.jsx("p",{className:"text-sm text-slate-500",children:"No records found."})})});const c=[{key:"all",label:"All"},{key:"nonZero",label:"Non-zero values"}],d=s.filter(m=>!(a&&!Object.values(m).map(g=>g==null?"":String(g)).join(" ").toLowerCase().includes(a.toLowerCase())||l==="nonZero"&&!Object.values(m).some(g=>typeof g=="number"&&g>0))),u=()=>{const m=r.join(","),x=d.map(j=>r.map(w=>{const S=j[w],E=S==null?"":String(S);return E.includes(",")||E.includes('"')||E.includes(`
`)?`"${E.replace(/"/g,'""')}"`:E}).join(",")).join(`
`),g=new Blob([m+`
`+x],{type:"text/csv;charset=utf-8;"}),y=URL.createObjectURL(g),v=document.createElement("a");v.href=y,v.download="mis-report.csv",v.click(),URL.revokeObjectURL(y)};return n.jsx(dt,{className:"rounded-2xl shadow-sm border border-slate-500 bg-white",children:n.jsxs(it,{className:"py-3 flex flex-col gap-3 max-h-[520px] md:max-h-[560px] overflow-hidden",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"relative w-full sm:w-64",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{type:"text",value:a,onChange:m=>i(m.target.value),placeholder:"Search in records",className:"w-full rounded-xl border border-slate-500 bg-white pl-9 pr-3 py-2 text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"})]}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:c.map(m=>n.jsx("button",{type:"button",onClick:()=>o(m.key),className:Bt("inline-flex items-center rounded-full px-3 py-1 text-xs sm:text-sm transition",l===m.key?"bg-blue-600 text-white shadow-sm":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:m.label},m.key))})]}),n.jsx("div",{className:"flex justify-start sm:justify-end",children:n.jsxs(ge,{type:"button",onClick:u,className:"inline-flex items-center gap-2 rounded-full bg-blue-600 px-4 py-2 text-xs sm:text-sm font-semibold text-white hover:bg-blue-700 active:scale-95 transition",children:[n.jsx(nn,{className:"w-4 h-4"}),"Export CSV"]})})]}),n.jsxs("div",{className:"mt-1 flex-1 overflow-y-auto pr-1.5",children:[n.jsx("div",{className:"hidden md:block",children:n.jsx("div",{className:"overflow-x-auto rounded-2xl border border-slate-500",children:n.jsxs("table",{className:"min-w-full text-xs md:text-sm bg-white",children:[n.jsx("thead",{className:"bg-slate-50 sticky top-0 z-10",children:n.jsx("tr",{children:r.map(m=>n.jsx("th",{className:"px-3 py-2 text-left text-[11px] font-medium uppercase tracking-wide text-slate-600 border-b border-slate-500",children:m.replace(/_/g," ")},m))})}),n.jsx("tbody",{children:d.map((m,x)=>n.jsx("tr",{className:"border-t border-slate-100 hover:bg-slate-50/80 transition-colors",children:r.map((g,y)=>n.jsx("td",{className:Bt("px-3 py-2 text-[11px] md:text-sm text-slate-800 align-top",y===0&&"font-semibold text-slate-900"),children:n.jsx("span",{className:"line-clamp-2",children:gB(m[g])})},g))},x))})]})})}),n.jsx("div",{className:"grid gap-3 md:hidden mt-1",children:n.jsx(on,{children:d.map((m,x)=>n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.2,ease:"easeOut"},className:"rounded-2xl border border-slate-500 bg-white px-3 py-2.5 shadow-sm flex flex-col gap-1",children:r.map((g,y)=>n.jsxs("div",{className:Bt("flex justify-between gap-2",y===0?"font-semibold text-slate-900":"text-slate-700"),children:[n.jsx("span",{className:"text-[11px] uppercase tracking-wide text-slate-500",children:g.replace(/_/g," ")}),n.jsx("span",{className:"text-xs text-right truncate max-w-[60%]",children:gB(m[g])})]},g))},x))})})]})]})})}function gB(t){return t==null?"":typeof t=="number"?t.toLocaleString("en-IN",{maximumFractionDigits:1}):typeof t=="string"&&t.length>80?t.slice(0,80)+"":String(t)}const Gse=t=>he.get(`/patients/${t}`),Cw=t=>{let s={};return typeof t=="string"?t&&(s.q=t):t&&typeof t=="object"&&(s=t),he.get("/patients",{params:s})};function xKe(t){return he.get(`/patients/${t}`)}function pKe(t){return he.post("/patients",t,{meta:{successToast:"Patient registered successfully"}})}function fKe(t,s){return he.put(`/patients/${t}`,s,{meta:{successToast:"Patient updated successfully"}})}function gKe(t){return he.patch(`/patients/${t}/deactivate`,null,{meta:{successToast:"Patient deactivated successfully"}})}function bKe(t,{type:s,file:r}){const a=new FormData;return a.append("type",s||"other"),a.append("file",r),he.post(`/patients/${t}/documents`,a,{headers:{"Content-Type":"multipart/form-data"},meta:{successToast:"Document uploaded successfully"}})}function yKe(t){return he.get(`/patients/${t}/documents`)}function vKe(t){return he.get(`/patients/${t}/consents`)}function jKe(t,s){return he.post(`/patients/${t}/consents`,s,{meta:{successToast:"Consent saved successfully"}})}async function NKe(t){const s=await he.get(`/patients/${t}/print-info`,{responseType:"blob"}),r=s.headers["content-type"]||"application/octet-stream",a=new Blob([s.data],{type:r}),i=URL.createObjectURL(a);window.open(i,"_blank")}function wKe(){return he.get("/patient-masters/all")}function _Ke(t){return he.get("/patients/export",{params:t,responseType:"blob",meta:{successToast:"Export started (downloading Excel)..."}})}function SKe(t,s={}){const r={table_name:"patients",record_id:t,...s};return he.get("/audit-logs",{params:r})}const CKe=["","A+","A-","B+","B-","O+","O-","AB+","AB-"],kKe=["","Single","Married","Widowed","Divorced"],AKe=["","Mr","Ms","Mrs","Dr","Baby","Master"],EKe=[{code:"OPD",name:"OPD"},{code:"IPD",name:"IPD"},{code:"EMERGENCY",name:"Emergency"},{code:"HEALTH_CHECK",name:"Health Check"},{code:"CAMP",name:"Camp"},{code:"CORPORATE",name:"Corporate"},{code:"INSURANCE",name:"Insurance"}],TKe=["","insurance","corporate","govt","other"],PKe={prefix:"",first_name:"",last_name:"",gender:"",dob:"",patient_type:"",marital_status:"",phone:"",email:"",ref_source:"",ref_doctor_id:"",ref_details:"",blood_group:"",tag:"",religion:"",occupation:"",guardian_name:"",guardian_phone:"",guardian_relation:"",id_proof_type:"",id_proof_no:"",file_number:"",file_location:"",credit_type:"",credit_payer_id:"",credit_tpa_id:"",credit_plan_id:"",principal_member_name:"",principal_member_address:"",policy_number:"",policy_name:"",family_id:"",address:{type:"current",line1:"",line2:"",city:"",state:"",pincode:"",country:"India"}};function VA(){return JSON.parse(JSON.stringify(PKe))}function bB(t){if(!t)return VA();const s=t.addresses&&t.addresses[0]||null;return{prefix:t.prefix||"",first_name:t.first_name||"",last_name:t.last_name||"",gender:t.gender||"",dob:t.dob||"",patient_type:t.patient_type||"",marital_status:t.marital_status||"",phone:t.phone||"",email:t.email||"",ref_source:t.ref_source||"",ref_doctor_id:t.ref_doctor_id?String(t.ref_doctor_id):"__NA__",ref_details:t.ref_details||"",blood_group:t.blood_group||"",tag:t.tag||"",religion:t.religion||"",occupation:t.occupation||"",guardian_name:t.guardian_name||"",guardian_phone:t.guardian_phone||"",guardian_relation:t.guardian_relation||"",id_proof_type:t.id_proof_type||"",id_proof_no:t.id_proof_no||"",file_number:t.file_number||"",file_location:t.file_location||"",credit_type:t.credit_type||"",credit_payer_id:t.credit_payer_id||"",credit_tpa_id:t.credit_tpa_id||"",credit_plan_id:t.credit_plan_id||"",principal_member_name:t.principal_member_name||"",principal_member_address:t.principal_member_address||"",policy_number:t.policy_number||"",policy_name:t.policy_name||"",family_id:t.family_id||"",address:{type:(s==null?void 0:s.type)||"current",line1:(s==null?void 0:s.line1)||"",line2:(s==null?void 0:s.line2)||"",city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",pincode:(s==null?void 0:s.pincode)||"",country:(s==null?void 0:s.country)||"India"}}}function L0(t){if(t==null||t==="")return null;const s=Number(t);return Number.isNaN(s)?null:s}function DKe(t){var i,l,o;let s="Failed to save patient";const r={},a=(l=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:l.detail;if(Array.isArray(a)){s="Please correct the highlighted fields.";for(const c of a){const d=c.loc||[],u=c.msg||"Invalid value";if(d[0]==="body"&&d.length>=2)if(d[1]==="address"&&d[2]){const m=`address.${d[2]}`;r[m]=r[m]?`${r[m]}; ${u}`:u}else{const m=d[1];r[m]=r[m]?`${r[m]}; ${u}`:u}}!Object.keys(r).length&&((o=a[0])!=null&&o.msg)&&(s=a[0].msg)}else typeof a=="string"?s=a:a&&typeof a=="object"&&a.msg?s=a.msg:t!=null&&t.message&&(s=t.message);return{generalMessage:s,fieldErrors:r}}const MKe=t=>/^\S+@\S+\.\S+$/.test(String(t||"").trim()),yB=t=>/^\d{10}$/.test(String(t||"").trim()),Kse=t=>typeof t=="string"&&/^#[0-9a-fA-F]{6}$/.test(t),IKe=(t,s="1A")=>Kse(t)?`${t}${s}`:void 0;function OKe(t){return t.open?n.jsx(RKe,{...t}):null}function RKe({onClose:t,onSaved:s,initialPatient:r,lookups:a}){const{branding:i}=iu()||{},l=Kse(i==null?void 0:i.primary_color)?i.primary_color:"#007AFF",o=IKe(l,"33")||"rgba(0,122,255,.20)",c=p.useMemo(()=>r?"edit":"create",[r]),[d,u]=p.useState(()=>r?bB(r):VA()),[m,x]=p.useState(!1),[g,y]=p.useState(""),[v,j]=p.useState({}),[w,S]=p.useState({}),[E,k]=p.useState({optionalBasics:!1,address:!1,guardian:!1,idproof:!1,credit:!1,file:!1}),{refSources:A,doctors:I,payers:P,tpas:O,creditPlans:D,patientTypes:T}=a||{},B=T!=null&&T.length?T:EKe;p.useEffect(()=>{y(""),j({}),S({}),u(r?bB(r):VA())},[r]),p.useEffect(()=>{const q=ee=>{ee.key==="Escape"&&(t==null||t())};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[t]);const U=p.useMemo(()=>({prefix:q=>!!String(q||"").trim(),first_name:q=>!!String(q||"").trim(),gender:q=>!!String(q||"").trim(),dob:q=>!!String(q||"").trim(),patient_type:q=>!!String(q||"").trim(),marital_status:q=>!!String(q||"").trim(),phone:q=>yB(q)}),[]),W=p.useMemo(()=>{const q=Object.keys(U),ee=q.filter(X=>U[X](d[X])).length;return{okCount:ee,total:q.length,ok:ee===q.length}},[U,d]),V=q=>S(ee=>({...ee,[q]:!0})),R=q=>{j(ee=>{if(!ee[q])return ee;const X={...ee};return delete X[q],X})},F=q=>ee=>{let X=ee.target.value;(q==="phone"||q==="guardian_phone")&&(X=X.replace(/\D/g,"").slice(0,10)),u(Z=>({...Z,[q]:X})),R(q)},G=q=>ee=>{const X=ee.target.value;u(Z=>({...Z,address:{...Z.address,[q]:X}})),R(`address.${q}`)},H=()=>{const q={};for(const ee of Object.keys(U))U[ee](d[ee])||(q[ee]="Required");return Object.keys(q).length?(j(q),S(ee=>({...ee,...Object.fromEntries(Object.keys(q).map(X=>[X,!0]))})),y("Fill all mandatory fields to continue."),!1):!0},$=async q=>{var ee;if((ee=q==null?void 0:q.preventDefault)==null||ee.call(q),y(""),j({}),!!H()){x(!0);try{const X={...d,ref_doctor_id:L0(d.ref_doctor_id),credit_payer_id:L0(d.credit_payer_id),credit_tpa_id:L0(d.credit_tpa_id),credit_plan_id:L0(d.credit_plan_id),family_id:L0(d.family_id),credit_type:d.credit_type||null,patient_type:d.patient_type||null},Z=c==="create"?await pKe(X):await fKe(r.id,X);s==null||s(Z.data),t==null||t()}catch(X){const{generalMessage:Z,fieldErrors:Y}=DKe(X);y(Z),j(Y||{})}finally{x(!1)}}},K=q=>k(ee=>({...ee,[q]:!ee[q]})),le="w-full h-11 rounded-2xl border bg-white px-3 text-[14px] text-slate-900 placeholder:text-slate-400 outline-none transition shadow-sm",se="w-full rounded-2xl border bg-white px-3 py-2 text-[14px] text-slate-900 placeholder:text-slate-400 outline-none transition shadow-sm min-h-[96px]",J=q=>[le,v[q]?"border-rose-300":"border-slate-500","focus:ring-4"].join(" "),ie=q=>[se,v[q]?"border-rose-300":"border-slate-500","focus:ring-4"].join(" "),te={boxShadow:`0 0 0 6px ${o}`},ne=q=>!w[q]&&!v[q]?"idle":U[q]?U[q](d[q])?"ok":"bad":"idle";return n.jsx("div",{className:"fixed inset-0 z-50 bg-black/35 backdrop-blur-sm flex items-center justify-center p-3 sm:p-6",onMouseDown:q=>{q.target===q.currentTarget&&(t==null||t())},children:n.jsxs("div",{className:"relative w-[90vw] max-w-[1120px] max-h-[90vh] overflow-hidden rounded-[28px] border border-slate-500 bg-white shadow-[0_40px_120px_-80px_rgba(0,0,0,.50)]",onMouseDown:q=>q.stopPropagation(),children:[n.jsx("button",{type:"button",onClick:t,disabled:m,className:"absolute right-4 top-4 h-10 w-10 rounded-2xl border border-slate-500 bg-white hover:bg-slate-50 grid place-items-center transition disabled:opacity-60",title:"Close",children:n.jsx(ts,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"absolute right-4 bottom-4 z-10 flex items-center gap-2",children:[n.jsxs("div",{className:"hidden sm:flex items-center gap-2 rounded-2xl border border-slate-500 bg-white/90 backdrop-blur px-3 py-2",children:[n.jsxs("div",{className:"text-[12px] font-semibold text-slate-700",children:["Mandatory ",W.okCount,"/",W.total]}),n.jsx("div",{className:"h-1.5 w-20 rounded-full bg-slate-200 overflow-hidden",children:n.jsx("div",{className:"h-1.5 rounded-full",style:{width:`${Math.round(W.okCount/W.total*100)}%`,backgroundColor:l}})})]}),n.jsx("button",{type:"button",onClick:$,disabled:m||!W.ok,className:"h-11 rounded-full px-5 text-sm font-semibold text-white active:scale-[0.99] transition disabled:opacity-60",style:{backgroundColor:l},title:W.ok?"":"Fill all mandatory fields",children:m?c==="create"?"Creating":"Saving":c==="create"?"Create":"Save"})]}),n.jsx("form",{onSubmit:$,className:"h-full",children:n.jsxs("div",{className:"h-[90vh] max-h-[90vh] overflow-y-auto bg-[#F5F5F7] px-5 sm:px-10 py-8",children:[n.jsxs("div",{className:"mb-6 pr-12",children:[n.jsxs("div",{className:"text-[20px] sm:text-[22px] font-semibold tracking-tight text-slate-900",children:[c==="create"?"Patient Registration":"Edit Patient",r!=null&&r.uhid?n.jsxs("span",{className:"ml-2 align-middle inline-flex font-mono text-[11px] px-2 py-0.5 rounded-full border border-slate-500 bg-white text-slate-700",children:["UHID: ",r.uhid]}):null]}),n.jsx("div",{className:"mt-1 text-[13px] text-slate-600",children:"Start with mandatory fields. Optional sections can be completed later."}),g?n.jsx("div",{className:"mt-4 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-[13px] font-medium text-rose-700",children:g}):null]}),n.jsx(LKe,{title:"Mandatory fields",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs(Ps,{label:"Prefix *",state:ne("prefix"),children:[n.jsx("select",{value:d.prefix,onChange:F("prefix"),onBlur:()=>V("prefix"),className:J("prefix"),style:{...w.prefix?te:null},children:AKe.map(q=>n.jsx("option",{value:q,children:q||"Select"},q||"x"))}),n.jsx(vi,{text:v.prefix})]}),n.jsxs(Ps,{label:"First Name *",state:ne("first_name"),children:[n.jsx("input",{value:d.first_name,onChange:F("first_name"),onBlur:()=>V("first_name"),className:J("first_name"),placeholder:"Enter first name",style:{...w.first_name?te:null}}),n.jsx(vi,{text:v.first_name})]}),n.jsx(Ps,{label:"Last Name",children:n.jsx("input",{value:d.last_name,onChange:F("last_name"),className:J("__ok"),placeholder:"Optional"})}),n.jsxs(Ps,{label:"Gender *",state:ne("gender"),children:[n.jsxs("select",{value:d.gender,onChange:F("gender"),onBlur:()=>V("gender"),className:J("gender"),style:{...w.gender?te:null},children:[n.jsx("option",{value:"",children:"Select"}),n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"other",children:"Other"})]}),n.jsx(vi,{text:v.gender})]}),n.jsxs(Ps,{label:"DOB *",state:ne("dob"),children:[n.jsx("input",{type:"date",value:d.dob||"",onChange:F("dob"),onBlur:()=>V("dob"),className:J("dob"),style:{...w.dob?te:null}}),n.jsx(vi,{text:v.dob})]}),n.jsxs(Ps,{label:"Marital Status *",state:ne("marital_status"),children:[n.jsx("select",{value:d.marital_status,onChange:F("marital_status"),onBlur:()=>V("marital_status"),className:J("marital_status"),style:{...w.marital_status?te:null},children:kKe.map(q=>n.jsx("option",{value:q,children:q||"Select"},q||"x"))}),n.jsx(vi,{text:v.marital_status})]}),n.jsxs(Ps,{label:"Patient Type *",state:ne("patient_type"),children:[n.jsxs("select",{value:d.patient_type||"",onChange:F("patient_type"),onBlur:()=>V("patient_type"),className:J("patient_type"),style:{...w.patient_type?te:null},children:[n.jsx("option",{value:"",children:"Select"}),B.map(q=>n.jsx("option",{value:q.code||q.name,children:q.name||q.code},q.code||q.name))]}),n.jsx(vi,{text:v.patient_type})]}),n.jsxs(Ps,{label:"Mobile *",state:ne("phone"),children:[n.jsx("input",{value:d.phone,onChange:F("phone"),onBlur:()=>V("phone"),className:J("phone"),placeholder:"10 digit mobile",style:{...w.phone?te:null}}),n.jsx(vi,{text:v.phone||(w.phone&&!yB(d.phone)?"Enter valid 10 digit mobile":"")})]}),n.jsxs(Ps,{label:"Email",children:[n.jsx("input",{type:"email",value:d.email,onChange:F("email"),onBlur:()=>V("email"),className:J("__ok"),placeholder:"Optional"}),n.jsx(vi,{text:v.email||(w.email&&String(d.email||"").trim()&&!MKe(d.email)?"Enter valid email":"")})]}),n.jsxs(Ps,{label:"Reference Source *",state:ne("ref_source"),children:[n.jsxs("select",{value:d.ref_source,onChange:F("ref_source"),onBlur:()=>V("ref_source"),className:J("ref_source"),style:{...w.ref_source?te:null},children:[n.jsx("option",{value:"",children:"Select"}),A==null?void 0:A.map(q=>n.jsx("option",{value:q.code,children:q.label},q.code))]}),n.jsx(vi,{text:v.ref_source})]}),n.jsxs(Ps,{label:"Referring Doctor ",children:[n.jsxs("select",{value:d.ref_doctor_id||"",onChange:F("ref_doctor_id"),onBlur:()=>V("ref_doctor_id"),className:J("ref_doctor_id"),style:{...w.ref_doctor_id?te:null},children:[n.jsx("option",{value:"",children:"Select"}),n.jsx("option",{value:"__NA__",children:"Not applicable / Walk-in"}),I==null?void 0:I.map(q=>n.jsxs("option",{value:String(q.id),children:[q.name,q.department_name?` (${q.department_name})`:""]},q.id))]}),n.jsx(vi,{text:v.ref_doctor_id})]}),n.jsxs(Ps,{label:"Reference Details",className:"sm:col-span-2 lg:col-span-3",children:[n.jsx("textarea",{value:d.ref_details,onChange:F("ref_details"),onBlur:()=>V("ref_details"),className:ie("ref_details"),placeholder:"Walk-in / Google / Camp / Insurance desk / Doctor referral",style:{...w.ref_details?te:null}}),n.jsx(vi,{text:v.ref_details})]})]})}),n.jsxs("div",{className:"mt-5 grid gap-3",children:[n.jsx(Vx,{open:E.optionalBasics,onToggle:()=>K("optionalBasics"),title:"Optional basics",subtitle:"Blood group, tag, religion, occupation",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsx(Ps,{label:"Blood Group",children:n.jsx("select",{value:d.blood_group,onChange:F("blood_group"),className:J("__ok"),children:CKe.map(q=>n.jsx("option",{value:q,children:q||"Select"},q||"x"))})}),n.jsx(Ps,{label:"Tag",children:n.jsx("input",{value:d.tag,onChange:F("tag"),className:J("__ok"),placeholder:"VIP / Staff / Corporate"})}),n.jsx(Ps,{label:"Religion",children:n.jsx("input",{value:d.religion,onChange:F("religion"),className:J("__ok")})}),n.jsx(Ps,{label:"Occupation",children:n.jsx("input",{value:d.occupation,onChange:F("occupation"),className:J("__ok")})})]})}),n.jsx(Vx,{open:E.address,onToggle:()=>K("address"),title:"Address",subtitle:"Current address details",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs(Ps,{label:"Address Line 1",className:"sm:col-span-2",children:[n.jsx("input",{value:d.address.line1,onChange:G("line1"),className:J("address.line1")}),n.jsx(vi,{text:v["address.line1"]})]}),n.jsx(Ps,{label:"Address Line 2",className:"sm:col-span-2",children:n.jsx("input",{value:d.address.line2,onChange:G("line2"),className:J("__ok")})}),n.jsxs(Ps,{label:"City",children:[n.jsx("input",{value:d.address.city,onChange:G("city"),className:J("address.city")}),n.jsx(vi,{text:v["address.city"]})]}),n.jsxs(Ps,{label:"State",children:[n.jsx("input",{value:d.address.state,onChange:G("state"),className:J("address.state")}),n.jsx(vi,{text:v["address.state"]})]}),n.jsxs(Ps,{label:"Pincode",children:[n.jsx("input",{value:d.address.pincode,onChange:G("pincode"),className:J("address.pincode")}),n.jsx(vi,{text:v["address.pincode"]})]}),n.jsx(Ps,{label:"Country",children:n.jsx("input",{value:d.address.country,onChange:G("country"),className:J("__ok")})})]})}),n.jsx(Vx,{open:E.guardian,onToggle:()=>K("guardian"),title:"Guardian",subtitle:"For minor / dependent",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsx(Ps,{label:"Guardian Name",children:n.jsx("input",{value:d.guardian_name,onChange:F("guardian_name"),className:J("__ok")})}),n.jsx(Ps,{label:"Guardian Phone",children:n.jsx("input",{value:d.guardian_phone,onChange:F("guardian_phone"),className:J("__ok")})}),n.jsx(Ps,{label:"Guardian Relation",className:"sm:col-span-2",children:n.jsx("input",{value:d.guardian_relation,onChange:F("guardian_relation"),className:J("__ok")})})]})}),n.jsx(Vx,{open:E.idproof,onToggle:()=>K("idproof"),title:"ID Proof",subtitle:"Aadhaar / PAN / DL",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsx(Ps,{label:"ID Proof Type",children:n.jsx("input",{value:d.id_proof_type,onChange:F("id_proof_type"),className:J("__ok")})}),n.jsx(Ps,{label:"ID Proof No",children:n.jsx("input",{value:d.id_proof_no,onChange:F("id_proof_no"),className:J("__ok")})})]})}),n.jsx(Vx,{open:E.credit,onToggle:()=>K("credit"),title:"Credit / Insurance",subtitle:"Only when needed",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsx(Ps,{label:"Credit Type",children:n.jsx("select",{value:d.credit_type,onChange:F("credit_type"),className:J("__ok"),children:TKe.map(q=>n.jsx("option",{value:q,children:q||"Select"},q||"x"))})}),n.jsx(Ps,{label:"Payer",children:n.jsxs("select",{value:d.credit_payer_id||"",onChange:F("credit_payer_id"),className:J("__ok"),children:[n.jsx("option",{value:"",children:"Select"}),P==null?void 0:P.map(q=>n.jsx("option",{value:q.id,children:q.display_name||q.name},q.id))]})}),n.jsx(Ps,{label:"TPA",children:n.jsxs("select",{value:d.credit_tpa_id||"",onChange:F("credit_tpa_id"),className:J("__ok"),children:[n.jsx("option",{value:"",children:"Select"}),O==null?void 0:O.map(q=>n.jsx("option",{value:q.id,children:q.display_name||q.name},q.id))]})}),n.jsx(Ps,{label:"Credit Plan",children:n.jsxs("select",{value:d.credit_plan_id||"",onChange:F("credit_plan_id"),className:J("__ok"),children:[n.jsx("option",{value:"",children:"Select"}),D==null?void 0:D.map(q=>n.jsx("option",{value:q.id,children:q.name},q.id))]})}),n.jsx(Ps,{label:"Policy Number",children:n.jsx("input",{value:d.policy_number,onChange:F("policy_number"),className:J("__ok")})}),n.jsx(Ps,{label:"Policy Name",children:n.jsx("input",{value:d.policy_name,onChange:F("policy_name"),className:J("__ok")})}),n.jsx(Ps,{label:"Principal Member Name",className:"sm:col-span-2",children:n.jsx("input",{value:d.principal_member_name,onChange:F("principal_member_name"),className:J("__ok")})}),n.jsx(Ps,{label:"Principal Member Address",className:"sm:col-span-2",children:n.jsx("textarea",{value:d.principal_member_address,onChange:F("principal_member_address"),className:ie("__ok")})}),n.jsx(Ps,{label:"Family ID",children:n.jsx("input",{value:d.family_id,onChange:F("family_id"),className:J("__ok")})})]})}),n.jsx(Vx,{open:E.file,onToggle:()=>K("file"),title:"File Details",subtitle:"File number / location",children:n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsx(Ps,{label:"File Number",children:n.jsx("input",{value:d.file_number,onChange:F("file_number"),className:J("__ok")})}),n.jsx(Ps,{label:"File Location",children:n.jsx("input",{value:d.file_location,onChange:F("file_location"),className:J("__ok")})})]})}),n.jsx("div",{className:"h-20"})]})]})})]})})}function LKe({title:t,children:s}){return n.jsxs("div",{className:"rounded-[26px] border border-slate-500 bg-white",children:[n.jsxs("div",{className:"px-5 sm:px-6 py-4 border-b border-slate-500",children:[n.jsx("div",{className:"text-[14px] font-semibold text-slate-900",children:t}),n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:"Keep it clean. Mandatory first."})]}),n.jsx("div",{className:"p-5 sm:p-6",children:s})]})}function Vx({open:t,onToggle:s,title:r,subtitle:a,children:i}){return n.jsxs("div",{className:"rounded-[22px] border border-slate-500 bg-white overflow-hidden",children:[n.jsxs("button",{type:"button",onClick:s,className:"w-full px-5 sm:px-6 py-4 flex items-center justify-between gap-3 hover:bg-slate-50 transition",children:[n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"text-[14px] font-semibold text-slate-900",children:r}),n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:a})]}),t?n.jsx(el,{className:"h-5 w-5 text-slate-600"}):n.jsx(Gn,{className:"h-5 w-5 text-slate-600"})]}),t?n.jsx("div",{className:"px-5 sm:px-6 pb-5 sm:pb-6",children:i}):null]})}function Ps({label:t,children:s,state:r="idle",className:a=""}){return n.jsxs("div",{className:a,children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsx("div",{className:"text-[12px] font-medium text-slate-800",children:t}),r==="bad"?n.jsx("span",{className:"text-[11px] font-semibold text-rose-600",children:"Required"}):null,r==="ok"?n.jsx("span",{className:"text-[11px] font-semibold text-emerald-600",children:"OK"}):null]}),s]})}function vi({text:t}){return t?n.jsx("div",{className:"mt-1 text-[12px] font-medium text-rose-600",children:t}):null}function eh(t){if(t==null)return"";const s=String(t).trim();return s||""}function FKe(t){return t?{doctor:"Doctor",google:"Google",social_media:"Social Media",ads:"Advertisements",other:"Other"}[t]||t:""}function BKe(t){const s=Number(t);return!s||Number.isNaN(s)?"":s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`}function $Ke(t){if(t==null)return"";if(typeof t=="string"){const s=t.trim();return s?s.length>28?`${s.slice(0,28)}`:s:""}if(typeof t=="number"||typeof t=="boolean")return String(t);try{const s=JSON.stringify(t);return s.length>28?`${s.slice(0,28)}`:s}catch{return""}}function zKe(t){const s=(t==null?void 0:t.old_values)||{},r=(t==null?void 0:t.new_values)||{},a=Array.from(new Set([...Object.keys(s||{}),...Object.keys(r||{})])),i=[];for(const l of a){const o=s?s[l]:void 0,c=r?r[l]:void 0,d=o===void 0?void 0:JSON.stringify(o),u=c===void 0?void 0:JSON.stringify(c);d!==u&&i.push({field:l,before:o,after:c})}return i}function bv({title:t,onClick:s,disabled:r,children:a}){return n.jsx("button",{type:"button",title:t,onClick:s,disabled:r,className:["inline-flex h-9 w-9 items-center justify-center rounded-xl","border border-black/50 bg-white/80 backdrop-blur","text-slate-700 hover:bg-white active:scale-[0.98] transition",r?"opacity-50 cursor-not-allowed":""].join(" "),children:a})}function yv({active:t,onClick:s,children:r}){return n.jsx("button",{type:"button",onClick:s,className:["px-3 py-1.5 text-[12px] font-medium rounded-full transition whitespace-nowrap",t?"bg-slate-900 text-white shadow-sm":"bg-transparent text-slate-600 hover:bg-black/[0.04]"].join(" "),children:r})}function wd({title:t,icon:s,right:r,children:a}){return n.jsxs("section",{className:"rounded-2xl border border-black/50 bg-white shadow-[0_1px_2px_rgba(0,0,0,0.04)]",children:[n.jsxs("div",{className:"px-4 pt-4 pb-3 flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("span",{className:"text-slate-400",children:s}),n.jsx("h3",{className:"text-[13px] font-semibold text-slate-900 tracking-tight truncate",children:t})]}),r]}),n.jsx("div",{className:"px-4 pb-4",children:a})]})}function ga({label:t,value:s,icon:r}){return n.jsxs("div",{className:"flex items-start justify-between gap-4 py-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[12px] text-slate-500",children:[r?n.jsx("span",{className:"text-slate-400",children:r}):null,n.jsx("span",{children:t})]}),n.jsx("div",{className:"text-[12px] font-medium text-slate-900 text-right break-words",children:eh(s)})]})}function UKe({open:t,onClose:s,patient:r,onUpdated:a}){const[i,l]=p.useState("overview"),[o,c]=p.useState(null),[d,u]=p.useState([]),[m,x]=p.useState([]),[g,y]=p.useState([]),[v,j]=p.useState(!1),[w,S]=p.useState(!1),[E,k]=p.useState(!1),[A,I]=p.useState(!1),[P,O]=p.useState(""),[D,T]=p.useState(null),[B,U]=p.useState("other"),[W,V]=p.useState(""),[R,F]=p.useState(""),[G,H]=p.useState(null),[$,K]=p.useState(""),[le,se]=p.useState(""),J=p.useRef(a);p.useEffect(()=>{J.current=a},[a]);const ie=p.useRef(null),te=p.useRef(0),ne=o||r,q=(ne==null?void 0:ne.addresses)&&ne.addresses[0]||null,ee=(ne==null?void 0:ne.age_text)||"",X=p.useMemo(()=>q?[q.line1,q.line2,[q.city,q.state,q.pincode].filter(Boolean).join(", "),q.country].filter(Boolean).join(`
`):"",[q]),Z=()=>{$&&URL.revokeObjectURL($),H(null),K(""),se("")},Y=G&&((le==null?void 0:le.startsWith("image/"))||/\.(png|jpe?g|gif|webp|bmp)$/i.test(G.filename||"")),Q=G&&(le==="application/pdf"||/\.pdf$/i.test(G.filename||"")),oe=async(fe,{silent:Me=!1}={})=>{var Ke,Le,He;if(!fe)return;const Ae=++te.current;Me||j(!0),O("");try{const[pt,Pe,bt]=await Promise.all([xKe(fe),yKe(fe),vKe(fe)]);if(Ae!==te.current)return;c(pt.data),u(Pe.data||[]),x(bt.data||[]),(Ke=J.current)==null||Ke.call(J,pt.data)}catch(pt){if(Ae!==te.current)return;O(((He=(Le=pt==null?void 0:pt.response)==null?void 0:Le.data)==null?void 0:He.detail)||(pt==null?void 0:pt.message)||"Failed to load patient details")}finally{Ae===te.current&&!Me&&j(!1)}S(!0);try{const pt=await SKe(fe,{limit:30});if(Ae!==te.current)return;y(pt.data||[])}catch{}finally{Ae===te.current&&S(!1)}};if(p.useEffect(()=>{!t||!(r!=null&&r.id)||ie.current!==r.id&&(ie.current=r.id,oe(r.id))},[t,r==null?void 0:r.id]),p.useEffect(()=>{t||(te.current+=1,ie.current=null,l("overview"),c(null),u([]),x([]),y([]),j(!1),S(!1),k(!1),I(!1),O(""),T(null),U("other"),V(""),F(""),Z())},[t]),p.useEffect(()=>{if(!t)return;const fe=Me=>Me.key==="Escape"&&(s==null?void 0:s());return window.addEventListener("keydown",fe),()=>window.removeEventListener("keydown",fe)},[t,s]),!t||!r)return null;const _e=async()=>{r!=null&&r.id&&await oe(r.id,{silent:!1})},xe=async()=>{var fe,Me;O("");try{await NKe(ne.id)}catch(Ae){O(((Me=(fe=Ae==null?void 0:Ae.response)==null?void 0:fe.data)==null?void 0:Me.detail)||(Ae==null?void 0:Ae.message)||"Failed to open print view")}},me=async fe=>{var Me,Ae;if(fe.preventDefault(),!!D){k(!0),O("");try{const Ke=await bKe(ne.id,{type:B,file:D});u(Le=>[Ke.data,...Le]),T(null),U("other"),l("attachments")}catch(Ke){O(((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||(Ke==null?void 0:Ke.message)||"Failed to upload document")}finally{k(!1)}}},Re=async fe=>{var Me,Ae;if(fe.preventDefault(),!(!W||!R)){I(!0),O("");try{const Ke=await jKe(ne.id,{type:W,text:R});x(Le=>[Ke.data,...Le]),V(""),F(""),l("consents")}catch(Ke){O(((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||(Ke==null?void 0:Ke.message)||"Failed to save consent")}finally{I(!1)}}},Ze=async fe=>{var Me,Ae;O("");try{const Ke=await he.get(`/patients/documents/${fe.id}/file`,{responseType:"blob"}),Le=Ke.data,He=Ke.headers["content-type"]||fe.mime||fe.content_type||fe.mime_type||"application/octet-stream",pt=URL.createObjectURL(He?new Blob([Le],{type:He}):Le);H(fe),K(pt),se(He)}catch(Ke){O(((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||(Ke==null?void 0:Ke.message)||"Failed to load attachment for preview")}},$e=async fe=>{var Me,Ae;O("");try{const Ke=await he.get(`/patients/documents/${fe.id}/file`,{responseType:"blob"}),Le=Ke.data,He=Ke.headers["content-type"]||fe.mime||fe.content_type||fe.mime_type||"application/octet-stream",pt=URL.createObjectURL(He?new Blob([Le],{type:He}):Le),Pe=document.createElement("a");Pe.href=pt,Pe.download=fe.filename||"document",document.body.appendChild(Pe),Pe.click(),Pe.remove(),URL.revokeObjectURL(pt)}catch(Ke){O(((Ae=(Me=Ke==null?void 0:Ke.response)==null?void 0:Me.data)==null?void 0:Ae.detail)||(Ke==null?void 0:Ke.message)||"Failed to download attachment")}};return n.jsxs("div",{className:"fixed inset-0 z-50",children:[n.jsx("div",{className:"absolute inset-0 bg-black/25 backdrop-blur-sm",onClick:s}),n.jsxs("div",{className:["absolute inset-y-0 right-0","w-full sm:w-[560px] lg:w-[760px] max-w-[92vw]","bg-white shadow-2xl border-l border-black/50","flex flex-col"].join(" "),onClick:fe=>fe.stopPropagation(),children:[n.jsx("div",{className:"sticky top-0 z-10 border-b border-black/50 bg-white/85 backdrop-blur-xl",children:n.jsxs("div",{className:"px-4 pt-4 pb-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl border border-black/50 bg-slate-50 grid place-items-center",children:n.jsx(or,{className:"h-4 w-4 text-slate-600"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"truncate text-[15px] font-semibold text-slate-900 tracking-tight",children:[ne.first_name," ",ne.last_name||""]}),n.jsxs("div",{className:"truncate text-[12px] text-slate-500",children:["UHID: ",n.jsx("span",{className:"font-mono",children:eh(ne.uhid)}),ee?`  Age: ${ee}`:""]})]})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[ne.patient_type?n.jsx("span",{className:"inline-flex items-center rounded-full bg-black/[0.05] px-2.5 py-1 text-[11px] font-medium text-slate-700",children:ne.patient_type}):null,ne.tag?n.jsx("span",{className:"inline-flex items-center rounded-full bg-black/[0.05] px-2.5 py-1 text-[11px] font-medium text-slate-700",children:ne.tag}):null,n.jsxs("span",{className:"inline-flex items-center gap-1.5 text-[11px] text-slate-500",children:[n.jsx(Ka,{className:"h-3.5 w-3.5 text-emerald-600"}),"Audit-ready"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(bv,{title:"Refresh",onClick:_e,disabled:v,children:n.jsx(ps,{className:["h-4 w-4",v?"animate-spin":""].join(" ")})}),n.jsx(bv,{title:"Print",onClick:xe,children:n.jsx(Ll,{className:"h-4 w-4"})}),n.jsx(bv,{title:"Close",onClick:s,children:n.jsx(ts,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"mt-4 inline-flex items-center gap-1 rounded-full border border-black/50 bg-black/[0.03] p-1 overflow-x-auto max-w-full",children:[n.jsx(yv,{active:i==="overview",onClick:()=>l("overview"),children:"Overview"}),n.jsx(yv,{active:i==="attachments",onClick:()=>l("attachments"),children:"Attachments"}),n.jsx(yv,{active:i==="consents",onClick:()=>l("consents"),children:"Consents"}),n.jsx(yv,{active:i==="activity",onClick:()=>l("activity"),children:"Activity"})]}),P?n.jsx("div",{className:"mt-3 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:P}):null]})}),n.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50/70 p-4 space-y-4",children:[v?n.jsx("div",{className:"rounded-2xl border border-black/50 bg-white px-4 py-3 text-[12px] text-slate-500",children:"Loading"}):null,i==="overview"&&n.jsxs(n.Fragment,{children:[n.jsx(wd,{title:"Patient",icon:n.jsx(Xn,{className:"h-4 w-4"}),children:n.jsxs("div",{className:"divide-y divide-black/5",children:[n.jsx(ga,{label:"Gender",value:ne.gender}),n.jsx(ga,{label:"DOB",value:ne.dob}),n.jsx(ga,{label:"Marital Status",value:ne.marital_status}),n.jsx(ga,{label:"Blood Group",value:ne.blood_group}),n.jsx(ga,{label:"Religion",value:ne.religion}),n.jsx(ga,{label:"Occupation",value:ne.occupation})]})}),n.jsx(wd,{title:"Contact",icon:n.jsx(ad,{className:"h-4 w-4"}),children:n.jsxs("div",{className:"divide-y divide-black/5",children:[n.jsx(ga,{label:"Mobile",value:ne.phone,icon:n.jsx(ad,{className:"h-3.5 w-3.5"})}),n.jsx(ga,{label:"Email",value:ne.email,icon:n.jsx(Qp,{className:"h-3.5 w-3.5"})})]})}),n.jsx(wd,{title:"Reference & Credit",icon:n.jsx(Ka,{className:"h-4 w-4"}),children:n.jsxs("div",{className:"divide-y divide-black/5",children:[n.jsx(ga,{label:"Reference Source",value:FKe(ne.ref_source)}),n.jsx(ga,{label:"Referring Doctor",value:ne.ref_doctor_name}),n.jsx(ga,{label:"Credit Type",value:ne.credit_type}),n.jsx(ga,{label:"Payer",value:ne.credit_payer_name}),n.jsx(ga,{label:"TPA",value:ne.credit_tpa_name}),n.jsx(ga,{label:"Credit Plan",value:ne.credit_plan_name}),n.jsx(ga,{label:"Policy Number",value:ne.policy_number}),n.jsx(ga,{label:"Policy Name",value:ne.policy_name}),n.jsx(ga,{label:"Principal Member",value:ne.principal_member_name}),n.jsx(ga,{label:"Family ID",value:ne.family_id})]})}),n.jsx(wd,{title:"Address",icon:n.jsx(sb,{className:"h-4 w-4"}),children:n.jsx("pre",{className:"whitespace-pre-wrap text-[12px] text-slate-800 leading-relaxed",children:X})})]}),i==="attachments"&&n.jsxs(n.Fragment,{children:[n.jsx(wd,{title:"Upload",icon:n.jsx(Nh,{className:"h-4 w-4"}),right:n.jsx("span",{className:"text-[11px] text-slate-500",children:d.length?`${d.length} file(s)`:"No files"}),children:n.jsxs("form",{onSubmit:me,className:"grid gap-2",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[n.jsxs("select",{className:"h-10 rounded-xl border border-black/50 bg-white px-3 text-[12px] text-slate-800 focus:outline-none focus:ring-2 focus:ring-black/10",value:B,onChange:fe=>U(fe.target.value),children:[n.jsx("option",{value:"other",children:"Other"}),n.jsx("option",{value:"id_proof",children:"ID Proof"}),n.jsx("option",{value:"report",children:"Report"}),n.jsx("option",{value:"photo",children:"Photo"})]}),n.jsx("div",{className:"sm:col-span-2",children:n.jsx("input",{type:"file",className:"block w-full text-[12px] text-slate-700 file:mr-3 file:rounded-full file:border-0 file:bg-slate-900 file:px-3 file:py-2 file:text-[12px] file:font-semibold file:text-white hover:file:bg-slate-800",onChange:fe=>{var Me;return T(((Me=fe.target.files)==null?void 0:Me[0])||null)}})})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"submit",disabled:E||!D,className:["inline-flex items-center gap-2 rounded-full px-4 py-2 text-[12px] font-semibold transition",E||!D?"bg-black/[0.08] text-slate-500 cursor-not-allowed":"bg-slate-900 text-white hover:bg-slate-800 active:scale-[0.98]"].join(" "),children:[n.jsx(Nh,{className:"h-4 w-4"}),E?"Uploading":"Upload"]})})]})}),n.jsx(wd,{title:"Files",icon:n.jsx(TV,{className:"h-4 w-4"}),children:n.jsx("div",{className:"overflow-hidden rounded-2xl border border-black/50 bg-white",children:d.length===0?n.jsxs("div",{className:"px-4 py-4 text-[12px] text-slate-500 flex items-center gap-2",children:[n.jsx(Mp,{className:"h-4 w-4 text-slate-300"}),"No attachments yet."]}):n.jsx("ul",{className:"divide-y divide-black/5",children:d.map(fe=>n.jsxs("li",{className:"px-4 py-3 flex items-center justify-between gap-3 hover:bg-black/[0.02] transition",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"truncate text-[12px] font-semibold text-slate-900",children:fe.filename}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:[eh(fe.type),"  ",BKe(fe.size)]})]}),n.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[n.jsx("button",{type:"button",onClick:()=>Ze(fe),className:"rounded-full border border-black/50 bg-white px-3 py-1.5 text-[12px] font-semibold text-slate-700 hover:bg-black/[0.03]",children:"Preview"}),n.jsx("button",{type:"button",onClick:()=>$e(fe),className:"rounded-full bg-slate-900 px-3 py-1.5 text-[12px] font-semibold text-white hover:bg-slate-800",children:n.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[n.jsx(nn,{className:"h-4 w-4"}),"Download"]})})]})]},fe.id))})})})]}),i==="consents"&&n.jsxs(n.Fragment,{children:[n.jsx(wd,{title:"Add Consent",icon:n.jsx(Xn,{className:"h-4 w-4"}),children:n.jsxs("form",{onSubmit:Re,className:"grid gap-2",children:[n.jsx("input",{className:"h-10 rounded-xl border border-black/50 bg-white px-3 text-[12px] text-slate-800 focus:outline-none focus:ring-2 focus:ring-black/10",placeholder:"Consent type (e.g., General / Surgery)",value:W,onChange:fe=>V(fe.target.value)}),n.jsx("textarea",{rows:3,className:"rounded-xl border border-black/50 bg-white px-3 py-2 text-[12px] text-slate-800 focus:outline-none focus:ring-2 focus:ring-black/10",placeholder:"Consent text",value:R,onChange:fe=>F(fe.target.value)}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{type:"submit",disabled:A||!W||!R,className:["inline-flex items-center gap-2 rounded-full px-4 py-2 text-[12px] font-semibold transition",A||!W||!R?"bg-black/[0.08] text-slate-500 cursor-not-allowed":"bg-slate-900 text-white hover:bg-slate-800 active:scale-[0.98]"].join(" "),children:A?"Saving":"Add Consent"})})]})}),n.jsx(wd,{title:"Saved Consents",icon:n.jsx(Ka,{className:"h-4 w-4"}),right:n.jsx("span",{className:"text-[11px] text-slate-500",children:m.length?`${m.length} item(s)`:"Empty"}),children:n.jsx("div",{className:"overflow-hidden rounded-2xl border border-black/50 bg-white",children:m.length===0?n.jsxs("div",{className:"px-4 py-4 text-[12px] text-slate-500 flex items-center gap-2",children:[n.jsx(Mp,{className:"h-4 w-4 text-slate-300"}),"No consents captured yet."]}):n.jsx("ul",{className:"divide-y divide-black/5",children:m.map(fe=>n.jsxs("li",{className:"px-4 py-3",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:eh(fe.type)}),n.jsx("div",{className:"text-[11px] text-slate-500 mt-0.5",children:fe.captured_at?new Date(fe.captured_at).toLocaleString():""}),n.jsx("div",{className:"mt-2 text-[12px] text-slate-800 whitespace-pre-line leading-relaxed",children:eh(fe.text)})]},fe.id))})})})]}),i==="activity"&&n.jsxs(wd,{title:"Activity / Audit Trail",icon:n.jsx(Qs,{className:"h-4 w-4"}),right:n.jsx("span",{className:"text-[11px] text-slate-500",children:w?"Loading":g.length?`Latest ${g.length}`:"No history"}),children:[g.length===0&&!w?n.jsxs("div",{className:"rounded-2xl border border-black/50 bg-white px-4 py-4 text-[12px] text-slate-500 flex items-center gap-2",children:[n.jsx(Mp,{className:"h-4 w-4 text-slate-300"}),"No audit history for this patient."]}):null,g.length>0?n.jsx("div",{className:"space-y-2",children:g.map(fe=>{const Me=zKe(fe),Ae=fe.user_name||fe.user_email||(fe.user_id?`User #${fe.user_id}`:"System"),Ke=fe.created_at?new Date(fe.created_at).toLocaleString():"";return n.jsxs("div",{className:"rounded-2xl border border-black/50 bg-white p-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"text-[12px] font-semibold text-slate-900",children:[eh(fe.action||"UPDATE"),n.jsx("span",{className:"ml-2 text-[12px] font-normal text-slate-500",children:eh(Ae)})]}),n.jsx("div",{className:"text-[11px] text-slate-500",children:Ke})]}),Me.length>0?n.jsxs("ul",{className:"mt-2 space-y-1 text-[12px]",children:[Me.slice(0,4).map(Le=>n.jsxs("li",{className:"text-slate-700",children:[n.jsx("span",{className:"font-medium text-slate-900",children:Le.field})," ",n.jsx("span",{className:"text-slate-500",children:""})," ",n.jsx("span",{className:"font-medium",children:$Ke(Le.after)})]},Le.field)),Me.length>4?n.jsxs("li",{className:"text-[11px] text-slate-500",children:["+",Me.length-4," more change(s)"]}):null]}):n.jsx("div",{className:"mt-2 text-[12px] text-slate-600",children:"Multiple fields updated."})]},fe.id)})}):null]})]}),G?n.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/55 backdrop-blur-sm",onClick:Z,children:n.jsxs("div",{className:"relative w-full max-w-4xl h-[84vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col",onClick:fe=>fe.stopPropagation(),children:[n.jsxs("div",{className:"px-4 py-3 border-b border-black/50 flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"truncate text-[13px] font-semibold text-slate-900",children:G.filename}),n.jsx("div",{className:"text-[11px] text-slate-500",children:le||"Unknown type"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{type:"button",onClick:()=>$e(G),className:"rounded-full bg-slate-900 px-3 py-2 text-[12px] font-semibold text-white hover:bg-slate-800",children:n.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[n.jsx(nn,{className:"h-4 w-4"}),"Download"]})}),n.jsx(bv,{title:"Close preview",onClick:Z,children:n.jsx(ts,{className:"h-4 w-4"})})]})]}),n.jsx("div",{className:"flex-1 bg-slate-50 flex items-center justify-center",children:Y?n.jsx("img",{src:$,alt:G.filename,className:"max-h-full max-w-full object-contain"}):Q?n.jsx("iframe",{src:$,title:G.filename,className:"w-full h-full"}):n.jsxs("div",{className:"px-6 text-center text-[12px] text-slate-600 space-y-2",children:[n.jsx("p",{children:"This file type cant be previewed here."}),n.jsx("button",{type:"button",onClick:()=>$e(G),className:"rounded-full bg-slate-900 px-4 py-2 text-[12px] font-semibold text-white hover:bg-slate-800",children:"Download file"})]})})]})}):null]})]})}const kw=(...t)=>t.filter(Boolean).join(" "),VKe=t=>typeof t=="string"&&t.startsWith("#")&&t.length===7,ec=(t,s="1A")=>VKe(t)?`${t}${s}`:void 0,HA=(t="",s="")=>{const r=(t||"").trim()[0]||"P",a=(s||"").trim()[0]||"";return(r+a).toUpperCase()};function n5({label:t,value:s,tone:r="slate"}){const a={slate:"bg-black/[0.04] text-slate-700",emerald:"bg-emerald-50 text-emerald-700",rose:"bg-rose-50 text-rose-700",sky:"bg-sky-50 text-sky-700"};return n.jsxs("div",{className:kw("inline-flex items-center gap-2 rounded-full px-3 py-1","text-[12px] font-semibold tracking-tight",a[r]||a.slate),children:[n.jsx("span",{className:"opacity-80",children:t}),n.jsx("span",{className:"tabular-nums",children:s})]})}function vB({onView:t,onEdit:s,onDeactivate:r}){return n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx(ge,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-xl hover:bg-black/[0.04]",title:"Actions",onClick:a=>a.stopPropagation(),children:n.jsx(tg,{className:"h-4 w-4 text-slate-600"})})}),n.jsxs(tc,{align:"end",sideOffset:8,className:"w-44 rounded-2xl p-1.5 border border-black/50 shadow-xl bg-white",onClick:a=>a.stopPropagation(),children:[n.jsxs(kr,{className:"rounded-xl cursor-pointer",onSelect:a=>{a.preventDefault(),t==null||t()},children:[n.jsx(Wr,{className:"h-4 w-4 mr-2"}),"View"]}),n.jsxs(kr,{className:"rounded-xl cursor-pointer",onSelect:a=>{a.preventDefault(),s==null||s()},children:[n.jsx(Yr,{className:"h-4 w-4 mr-2"}),"Edit"]}),n.jsx(Dd,{className:"my-1"}),n.jsxs(kr,{className:"rounded-xl cursor-pointer text-rose-600 focus:text-rose-700 focus:bg-rose-50",onSelect:a=>{a.preventDefault(),r==null||r()},children:[n.jsx(bde,{className:"h-4 w-4 mr-2"}),"Deactivate"]})]})]})}function HKe({value:t,onChange:s,primary:r="#2563eb",options:a=[],moreOptions:i=[]}){const l={borderColor:ec(r,"22")||"#bfdbfe"};return n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex items-center rounded-2xl border border-black/50 bg-black/[0.03] p-1",children:a.map(o=>{const c=t===o.value;return n.jsx("button",{type:"button",onClick:()=>s(o.value),className:kw("relative h-9 px-3 rounded-xl text-[12px] font-semibold tracking-tight transition","focus:outline-none",c?"bg-white shadow-[0_1px_2px_rgba(0,0,0,0.08)] text-slate-900 border border-black/50":"text-slate-600 hover:text-slate-800 hover:bg-white/60"),style:c?l:void 0,children:o.label},o.value)})}),i.length>0&&n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx(ge,{variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white hover:bg-black/[0.03]",children:"More"})}),n.jsx(tc,{className:"w-56 rounded-2xl p-1.5 border border-black/50 shadow-xl bg-white",children:i.map(o=>{const c=t===o.value;return n.jsx(kr,{className:"rounded-xl cursor-pointer flex items-center justify-between",onSelect:d=>{d.preventDefault(),s(o.value)},children:n.jsxs("span",{className:"flex items-center gap-2",children:[c?n.jsx(So,{className:"h-4 w-4"}):n.jsx("span",{className:"h-4 w-4"}),o.label]})},o.value)})})]})]})}function WKe({open:t,onClose:s,primary:r,patientTypeFilter:a,onPickPatient:i,fallbackPatients:l=[]}){const[o,c]=p.useState(""),[d,u]=p.useState(!1),[m,x]=p.useState([]),[g,y]=p.useState(0),[v,j]=p.useState(""),w=p.useRef(null),S=p.useRef(0),E=p.useRef(null),k=p.useMemo(()=>(l||[]).slice(0,10),[l]);if(p.useEffect(()=>{if(!t)return;j(""),c(""),x(k),y(0);const P=setTimeout(()=>{var O,D;return(D=(O=w.current)==null?void 0:O.focus)==null?void 0:D.call(O)},50);return()=>clearTimeout(P)},[t]),p.useEffect(()=>{if(!t)return;E.current&&clearTimeout(E.current);const P=(o||"").trim();if(!P){x(k),u(!1),y(0);return}return E.current=setTimeout(async()=>{var D,T;const O=++S.current;u(!0),j("");try{const B={q:P};a&&(B.patient_type=a);const U=await Cw(B);if(S.current!==O)return;const W=U.data||[];x(W),y(0)}catch(B){if(S.current!==O)return;j(((T=(D=B==null?void 0:B.response)==null?void 0:D.data)==null?void 0:T.detail)||(B==null?void 0:B.message)||"Search failed")}finally{S.current===O&&u(!1)}},250),()=>{E.current&&clearTimeout(E.current)}},[o,t,a,k]),p.useEffect(()=>{if(!t)return;const P=O=>{O.key==="Escape"&&(s==null||s())};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[t,s]),!t)return null;const A=P=>{P&&(i==null||i(P),s==null||s())},I={backgroundColor:ec(r,"12")||"#eff6ff",borderColor:ec(r,"22")||"#bfdbfe",color:r};return n.jsx("div",{className:"fixed inset-0 z-[80] bg-black/35 backdrop-blur-sm flex items-start justify-center px-3 py-10",onMouseDown:s,children:n.jsxs("div",{className:"w-full max-w-2xl rounded-3xl border border-black/50 bg-white/90 backdrop-blur-xl shadow-[0_20px_60px_rgba(0,0,0,0.22)] overflow-hidden",onMouseDown:P=>P.stopPropagation(),children:[n.jsxs("div",{className:"px-4 py-3 border-b border-black/50",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-9 w-9 rounded-2xl grid place-items-center border",style:I,children:n.jsx(wV,{className:"h-4 w-4"})}),n.jsxs("div",{className:"flex-1 relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx(Ee,{ref:w,value:o,onChange:P=>c(P.target.value),onKeyDown:P=>{P.key==="ArrowDown"&&(P.preventDefault(),y(O=>Math.min(O+1,Math.max(0,m.length-1)))),P.key==="ArrowUp"&&(P.preventDefault(),y(O=>Math.max(0,O-1))),P.key==="Enter"&&(P.preventDefault(),A(m[g]||m[0]))},className:"h-11 rounded-2xl pl-10 pr-24 border-black/50 bg-white focus-visible:ring-black/10",placeholder:"Search patients (UHID / Name / Phone)"}),n.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[!!o&&n.jsx("button",{type:"button",onClick:()=>c(""),className:"inline-flex h-8 w-8 items-center justify-center rounded-full hover:bg-black/[0.04]",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})}),n.jsx("div",{className:"hidden sm:flex items-center gap-1 rounded-full border border-black/50 bg-black/[0.03] px-2 py-1 text-[11px] text-slate-600",children:n.jsx("span",{children:"Esc"})})]})]})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-slate-500",children:[n.jsx("div",{className:"flex items-center gap-2",children:d?"Searching":o!=null&&o.trim()?`${m.length} result(s)`:"Type to search (server)"}),n.jsx("div",{className:"hidden sm:block",children:" to navigate  Enter to open"})]}),v&&n.jsx("div",{className:"mt-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-[12px] text-rose-700",children:v})]}),n.jsx("div",{className:"max-h-[60vh] overflow-auto",children:m.length===0&&!d?n.jsxs("div",{className:"px-4 py-10 text-center text-slate-500",children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] grid place-items-center",children:n.jsx(Mp,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:"No matches"}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Try a different keyword."})]}):n.jsx("ul",{className:"divide-y divide-black/5",children:m.map((P,O)=>{const D=`${P.first_name||""} ${P.last_name||""}`.trim()||"",T=P.is_active!==!1,B=O===g;return n.jsx("li",{children:n.jsxs("button",{type:"button",onMouseEnter:()=>y(O),onClick:()=>A(P),className:kw("w-full text-left px-4 py-3 flex items-center gap-3 transition",B?"bg-black/[0.03]":"hover:bg-black/[0.02]"),children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl grid place-items-center border",style:{backgroundColor:ec(r,"12")||"#eff6ff",borderColor:ec(r,"22")||"#bfdbfe",color:r},children:n.jsx("span",{className:"text-[12px] font-extrabold",children:HA(P.first_name,P.last_name)})}),n.jsx("div",{className:"min-w-0 flex-1",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:D}),n.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-[12px] text-slate-500",children:[n.jsx("span",{className:"font-mono text-[11px] bg-black/[0.04] border border-black/50 rounded-full px-2 py-0.5",children:P.uhid||""}),P.phone&&n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(ad,{className:"h-3.5 w-3.5 text-slate-400"}),P.phone]}),n.jsx(et,{variant:"secondary",className:"rounded-full border border-black/50 bg-black/[0.03] text-slate-700",children:T?"Active":"Inactive"})]})]}),n.jsx(Ti,{className:kw("h-5 w-5",B?"text-slate-500":"text-slate-300")})]})})]})},P.id)})})})]})})}function qKe(){const{branding:t}=iu()||{},s=(t==null?void 0:t.primary_color)||"#2563eb",[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState(""),[d,u]=p.useState(""),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState(null),[E,k]=p.useState(!1),[A,I]=p.useState({refSources:[],doctors:[],payers:[],tpas:[],creditPlans:[],patientTypes:[]}),[P,O]=p.useState(""),[D,T]=p.useState(""),[B,U]=p.useState(""),[W,V]=p.useState(!1),R=p.useMemo(()=>A.patientTypes||[],[A.patientTypes]),F=p.useMemo(()=>{const Y=r.length,Q=r.filter(oe=>oe.is_active!==!1).length;return{total:Y,active:Q,inactive:Y-Q}},[r]),G=p.useMemo(()=>{if(!P)return"All";const Y=R.find(Q=>(Q.code||Q.name)===P);return(Y==null?void 0:Y.name)||(Y==null?void 0:Y.code)||P},[P,R]),H=p.useCallback(async(Y=o,Q=P)=>{var oe,_e;l(!0),u("");try{const xe={};Y&&(xe.q=Y),Q&&(xe.patient_type=Q);const me=await Cw(xe);a(me.data||[])}catch(xe){const me=((_e=(oe=xe==null?void 0:xe.response)==null?void 0:oe.data)==null?void 0:_e.detail)||(xe==null?void 0:xe.message)||"Failed to load patients";u(me),ae.error("Failed to load patients",{description:me})}finally{l(!1)}},[o,P]),$=p.useCallback(async()=>{try{const Q=(await wKe()).data||{};I({refSources:Q.reference_sources||[],doctors:Q.doctors||[],payers:Q.payers||[],tpas:Q.tpas||[],creditPlans:Q.credit_plans||[],patientTypes:Q.patient_types||[]})}catch{}},[]);p.useEffect(()=>{H("",""),$()},[]),p.useEffect(()=>{const Y=Q=>{var xe,me;(((me=(xe=navigator.platform)==null?void 0:xe.toLowerCase)==null?void 0:me.call(xe).includes("mac"))?Q.metaKey:Q.ctrlKey)&&Q.key.toLowerCase()==="k"&&(Q.preventDefault(),k(!0))};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[]);const K=Y=>{Y.preventDefault(),H(o,P)},le=Y=>{O(Y),H(o,Y)},se=()=>{O(""),c(""),H("","")},J=()=>{S(null),x(!0)},ie=Y=>{S(Y),x(!0)},te=Y=>{j(Y),y(!0)},ne=async Y=>{var oe,_e;const Q=`${Y.first_name||""} ${Y.last_name||""}`.trim()||"this patient";if(window.confirm(`Deactivate ${Q}?`))try{await gKe(Y.id),ae.success("Patient deactivated."),await H(o,P)}catch(xe){const me=((_e=(oe=xe==null?void 0:xe.response)==null?void 0:oe.data)==null?void 0:_e.detail)||(xe==null?void 0:xe.message)||"Failed to deactivate patient";ae.error("Failed to deactivate patient",{description:me})}},q=Y=>{a(Q=>{const oe=Q.findIndex(xe=>xe.id===Y.id);if(oe===-1)return Q;const _e=[...Q];return _e[oe]=Y,_e})},ee=async()=>{var Y,Q;if(!D||!B){ae.warning("Please select From and To date for Excel export.");return}if(B<D){ae.warning("To Date must be on or after From Date.");return}V(!0);try{const oe={from_date:D,to_date:B};P&&(oe.patient_type=P);const _e=await _Ke(oe),xe=new Blob([_e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),me=window.URL.createObjectURL(xe),Re=document.createElement("a");Re.href=me,Re.download=`patients_${D}_to_${B}.xlsx`,document.body.appendChild(Re),Re.click(),Re.remove(),window.URL.revokeObjectURL(me),ae.success("Excel downloaded.")}catch(oe){const _e=((Q=(Y=oe==null?void 0:oe.response)==null?void 0:Y.data)==null?void 0:Q.detail)||(oe==null?void 0:oe.message)||"Failed to export Excel.";ae.error("Export failed.",{description:_e})}finally{V(!1)}},X=p.useMemo(()=>{const Y=[{value:"",label:"All"}],Q=R.map(me=>({value:me.code||me.name,label:me.name||me.code})),oe=6,_e=Y.concat(Q).slice(0,oe+1),xe=Y.concat(Q).slice(oe+1);return{main:_e,rest:xe}},[R]),Z={backgroundColor:ec(s,"12")||"#eff6ff",borderColor:ec(s,"22")||"#bfdbfe",color:s};return n.jsxs("div",{className:"h-full min-h-0 w-full bg-slate-50",children:[n.jsxs("div",{className:"mx-auto w-full max-w-6xl px-3 sm:px-5 py-4 flex flex-col gap-4 min-h-0",children:[n.jsxs(dt,{className:"rounded-3xl border-black/50 bg-white/90 backdrop-blur shadow-[0_1px_2px_rgba(0,0,0,0.05)] overflow-hidden",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-[12px] font-semibold tracking-tight border",style:Z,children:[n.jsx(uc,{className:"h-4 w-4"}),"Patient Registry"]}),n.jsx(jt,{className:"mt-2 text-[22px] sm:text-[26px] tracking-tight font-semibold",children:"Patient Management"}),n.jsx("p",{className:"mt-1 text-[13px] text-slate-600 max-w-2xl leading-relaxed",children:"UHID search, smart filters, export, and quick profile actions."}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[n.jsx(n5,{label:"Active",value:F.active,tone:"emerald"}),n.jsx(n5,{label:"Total",value:F.total,tone:"sky"}),F.inactive>0&&n.jsx(n5,{label:"Inactive",value:F.inactive,tone:"rose"}),n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-black/[0.04] px-3 py-1 text-[12px] font-semibold text-slate-700",children:[n.jsx(ih,{className:"h-4 w-4 opacity-70"}),"Type: ",G]})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 md:justify-end",children:[n.jsxs(ge,{variant:"outline",className:"rounded-2xl border-black/50 bg-white hover:bg-black/[0.03]",onClick:()=>H(o,P),title:"Reload",children:[n.jsx(ps,{className:"h-4 w-4 mr-2"}),"Reload"]}),n.jsxs(ge,{className:"rounded-2xl shadow-sm active:scale-[0.99] transition",style:{backgroundColor:s},onClick:J,children:[n.jsx(ds,{className:"h-4 w-4 mr-2"}),"New Patient"]})]})]})}),n.jsx(it,{className:"pt-0",children:n.jsxs("div",{className:"grid gap-3",children:[n.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[n.jsx("form",{onSubmit:K,className:"w-full lg:max-w-xl",children:n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx(Ee,{className:"h-11 rounded-2xl pl-10 pr-24 border-black/50 bg-white focus-visible:ring-black/10",placeholder:"Search UHID, Name, Mobile, Email...",value:o,onChange:Y=>c(Y.target.value)}),n.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[!!o&&n.jsx("button",{type:"button",onClick:()=>{c(""),H("",P)},className:"inline-flex h-8 w-8 items-center justify-center rounded-full hover:bg-black/[0.04]",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})}),n.jsxs("button",{type:"button",onClick:()=>k(!0),className:"hidden sm:inline-flex items-center gap-1 rounded-full border border-black/50 bg-black/[0.03] px-2 py-1 text-[11px] text-slate-600 hover:bg-black/[0.05]",title:"Quick Search",children:[n.jsx(wV,{className:"h-3.5 w-3.5"}),n.jsx("span",{children:"K"})]})]})]})}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl border-black/50 bg-white hover:bg-black/[0.03]",onClick:se,children:"Reset"}),n.jsx(ge,{variant:"outline",className:"rounded-2xl border-black/50 bg-white hover:bg-black/[0.03]",onClick:()=>H(o,P),children:"Apply"})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-600",children:"Patient Type"}),n.jsx(HKe,{value:P,onChange:le,primary:s,options:X.main,moreOptions:X.rest})]}),n.jsx("div",{className:"rounded-3xl border border-black/50 bg-black/[0.02] p-3",children:n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end lg:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[12px] font-semibold text-slate-700",children:[n.jsx(Ds,{className:"h-4 w-4 text-slate-500"}),"Export Patients"]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[n.jsxs("div",{className:"grid gap-1",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"From"}),n.jsx(Ee,{type:"date",className:"h-10 rounded-2xl border-black/50 bg-white focus-visible:ring-black/10",value:D,onChange:Y=>T(Y.target.value)})]}),n.jsxs("div",{className:"grid gap-1",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"To"}),n.jsx(Ee,{type:"date",className:"h-10 rounded-2xl border-black/50 bg-white focus-visible:ring-black/10",value:B,onChange:Y=>U(Y.target.value)})]}),n.jsx("div",{className:"flex items-end",children:n.jsxs(ge,{className:"w-full h-10 rounded-2xl shadow-sm",disabled:W,onClick:ee,style:{backgroundColor:"#16a34a"},children:[n.jsx(kV,{className:"h-4 w-4 mr-2"}),W?"Exporting":"Export Excel"]})})]})]})}),!!d&&n.jsxs("div",{className:"rounded-3xl border border-rose-200 bg-rose-50 px-3 py-2 flex items-start gap-2 text-rose-700",children:[n.jsx(Vs,{className:"h-4 w-4 mt-0.5"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold",children:"Unable to load patients"}),n.jsx("div",{className:"text-[12px] break-words",children:d})]})]})]})})]}),n.jsxs("div",{className:"flex-1 min-h-0",children:[n.jsx("div",{className:"hidden md:block h-full min-h-0",children:n.jsx(dt,{className:"h-full min-h-0 rounded-3xl border-black/50 bg-white/90 backdrop-blur shadow-[0_1px_2px_rgba(0,0,0,0.05)] overflow-hidden",children:n.jsx("div",{className:"h-full min-h-0 overflow-auto",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"sticky top-0 z-10 bg-white/85 backdrop-blur border-b border-black/50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-5 py-3 text-left text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"Patient"}),n.jsx("th",{className:"px-5 py-3 text-left text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"Demographics"}),n.jsx("th",{className:"px-5 py-3 text-left text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"Contact"}),n.jsx("th",{className:"px-5 py-3 text-left text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"Tags"}),n.jsx("th",{className:"px-5 py-3 text-right text-[11px] font-bold text-slate-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsxs("tbody",{className:"divide-y divide-black/5",children:[i&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-5 py-12 text-center text-slate-500",children:"Loading patients"})}),!i&&r.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-5 py-14 text-center",children:n.jsxs("div",{className:"flex flex-col items-center gap-2",children:[n.jsx("div",{className:"h-12 w-12 rounded-3xl bg-black/[0.04] grid place-items-center",children:n.jsx(Mp,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"font-semibold text-slate-900",children:"No patients found"}),n.jsx("div",{className:"text-[12px] text-slate-500",children:"Try search / filters or create a new patient."}),n.jsxs(ge,{className:"rounded-2xl mt-1 shadow-sm",style:{backgroundColor:s},onClick:J,children:[n.jsx(ds,{className:"h-4 w-4 mr-2"}),"New Patient"]})]})})}),!i&&r.map(Y=>{const Q=`${Y.first_name||""} ${Y.last_name||""}`.trim()||"",oe=Y.is_active!==!1;return n.jsxs("tr",{className:"group hover:bg-black/[0.02] cursor-pointer transition",onClick:()=>te(Y),children:[n.jsx("td",{className:"px-5 py-4 align-top",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"h-11 w-11 rounded-2xl grid place-items-center border",style:{backgroundColor:ec(s,"12")||"#eff6ff",borderColor:ec(s,"22")||"#bfdbfe",color:s},children:n.jsx("span",{className:"text-[12px] font-extrabold",children:HA(Y.first_name,Y.last_name)})}),n.jsx("div",{className:"min-w-0 flex-1",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:Q}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[12px] text-slate-500",children:[n.jsx("span",{className:"font-mono text-[11px] bg-black/[0.04] border border-black/50 rounded-full px-2 py-0.5",children:Y.uhid||""}),n.jsxs("span",{children:["Age: ",Y.age_text||""]}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsx("span",{children:Y.gender||""}),n.jsx(et,{variant:"secondary",className:"rounded-full border border-black/50 bg-black/[0.03] text-slate-700",children:oe?"Active":"Inactive"})]})]}),n.jsx(Ti,{className:"h-5 w-5 text-slate-300 opacity-0 group-hover:opacity-100 transition"})]})})]})}),n.jsxs("td",{className:"px-5 py-4 align-top text-[12px] text-slate-700",children:[n.jsxs("div",{children:["Blood: ",Y.blood_group||""]}),n.jsxs("div",{className:"mt-1",children:["Marital: ",Y.marital_status||""]}),n.jsxs("div",{className:"mt-1",children:["Type: ",Y.patient_type||""]})]}),n.jsxs("td",{className:"px-5 py-4 align-top text-[12px] text-slate-700",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ad,{className:"h-4 w-4 text-slate-400"}),n.jsx("span",{children:Y.phone||""})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx(Qp,{className:"h-4 w-4 text-slate-400"}),n.jsx("span",{className:"truncate max-w-[260px]",children:Y.email||""})]})]}),n.jsx("td",{className:"px-5 py-4 align-top",children:n.jsxs("div",{className:"flex flex-wrap gap-2",children:[Y.patient_type&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-black/[0.04] border border-black/50 px-2.5 py-1 text-[11px] text-slate-800",children:[n.jsx(ih,{className:"h-3.5 w-3.5 text-slate-400"}),Y.patient_type]}),Y.tag&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 border border-emerald-100 px-2.5 py-1 text-[11px] text-emerald-700",children:Y.tag})]})}),n.jsx("td",{className:"px-5 py-4 align-top text-right",onClick:_e=>_e.stopPropagation(),children:n.jsx(vB,{onView:()=>te(Y),onEdit:()=>ie(Y),onDeactivate:()=>ne(Y)})})]},Y.id)})]})]})})})}),n.jsxs("div",{className:"md:hidden grid gap-3",children:[i&&n.jsx(dt,{className:"rounded-3xl border-black/50 bg-white/90 shadow-[0_1px_2px_rgba(0,0,0,0.05)]",children:n.jsx(it,{className:"py-6 text-center text-slate-500",children:"Loading"})}),!i&&r.length===0&&n.jsx(dt,{className:"rounded-3xl border-black/50 bg-white/90 shadow-[0_1px_2px_rgba(0,0,0,0.05)]",children:n.jsxs(it,{className:"py-8 text-center",children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] grid place-items-center",children:n.jsx(Mp,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:"No patients found"}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Try search or create a patient."}),n.jsxs(ge,{className:"rounded-2xl mt-4 shadow-sm",style:{backgroundColor:s},onClick:J,children:[n.jsx(ds,{className:"h-4 w-4 mr-2"}),"New Patient"]})]})}),!i&&r.map(Y=>{const Q=`${Y.first_name||""} ${Y.last_name||""}`.trim()||"",oe=Y.is_active!==!1;return n.jsx(dt,{className:"rounded-3xl border-black/50 bg-white/90 shadow-[0_1px_2px_rgba(0,0,0,0.05)]",onClick:()=>te(Y),children:n.jsx(it,{className:"p-4",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"h-11 w-11 rounded-3xl grid place-items-center border",style:{backgroundColor:ec(s,"12")||"#eff6ff",borderColor:ec(s,"22")||"#bfdbfe",color:s},children:n.jsx("span",{className:"text-[12px] font-extrabold",children:HA(Y.first_name,Y.last_name)})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"truncate font-semibold text-slate-900",children:Q}),n.jsx(Ti,{className:"h-5 w-5 text-slate-300"})]}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[12px] text-slate-500",children:[n.jsx("span",{className:"font-mono text-[11px] bg-black/[0.04] border border-black/50 rounded-full px-2 py-0.5",children:Y.uhid||""}),n.jsxs("span",{children:["Age: ",Y.age_text||""]}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsx("span",{children:Y.gender||""})]})]}),n.jsxs("div",{className:"flex items-center gap-2",onClick:_e=>_e.stopPropagation(),children:[n.jsx(et,{variant:"secondary",className:"rounded-full border border-black/50 bg-black/[0.03] text-slate-700",children:oe?"Active":"Inactive"}),n.jsx(vB,{onView:()=>te(Y),onEdit:()=>ie(Y),onDeactivate:()=>ne(Y)})]})]}),n.jsxs("div",{className:"mt-2 grid gap-1 text-[12px] text-slate-700",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ad,{className:"h-4 w-4 text-slate-400"}),n.jsx("span",{children:Y.phone||""})]}),Y.email&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Qp,{className:"h-4 w-4 text-slate-400"}),n.jsx("span",{className:"truncate",children:Y.email})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[Y.patient_type&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-black/[0.04] border border-black/50 px-2.5 py-1 text-[11px] text-slate-800",children:[n.jsx(ih,{className:"h-3.5 w-3.5 text-slate-400"}),Y.patient_type]}),Y.tag&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 border border-emerald-100 px-2.5 py-1 text-[11px] text-emerald-700",children:Y.tag})]})]})]})})},Y.id)})]})]}),n.jsx(OKe,{open:m,onClose:()=>x(!1),onSaved:()=>H(o,P),initialPatient:w,lookups:A}),n.jsx(UKe,{open:g,onClose:()=>y(!1),patient:v,onUpdated:q,onEdit:Y=>{y(!1),ie(Y)}})]}),n.jsx(WKe,{open:E,onClose:()=>k(!1),primary:s,patientTypeFilter:P,fallbackPatients:r,onPickPatient:Y=>{j(Y),y(!0)}})]})}const GKe=t=>typeof t=="string"&&t.startsWith("#")&&t.length===7,Aw=(t,s="1A")=>GKe(t)?`${t}${s}`:void 0,un=(...t)=>t.filter(Boolean).join(" "),Yse=[{value:"insurance",label:"Insurance"},{value:"corporate",label:"Corporate"},{value:"govt",label:"Govt Scheme"},{value:"other",label:"Other"}],Et={page:"bg-slate-50 min-h-full",container:"mx-auto w-full max-w-6xl px-3 sm:px-5 py-4",card:"rounded-3xl border border-black/50 bg-white/85 backdrop-blur shadow-[0_1px_2px_rgba(0,0,0,0.06)]",insetCard:"rounded-3xl border border-black/50 bg-white/90 backdrop-blur shadow-[0_1px_2px_rgba(0,0,0,0.05)]",subtle:"rounded-3xl border border-black/50 bg-black/[0.02]",label:"text-[11px] font-semibold text-slate-600",input:"w-full rounded-2xl border border-black/50 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-black/20 focus:ring-2 focus:ring-black/10",inputSm:"w-full rounded-2xl border border-black/50 bg-white px-3 py-2 text-[13px] text-slate-900 outline-none focus:border-black/20 focus:ring-2 focus:ring-black/10",textarea:"w-full rounded-2xl border border-black/50 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-black/20 focus:ring-2 focus:ring-black/10 min-h-[90px]",btn:"inline-flex items-center justify-center gap-2 rounded-2xl px-3 py-2 text-sm font-semibold transition active:scale-[0.99]",btnOutline:"inline-flex items-center justify-center gap-2 rounded-2xl px-3 py-2 text-sm font-semibold border border-black/50 bg-white hover:bg-black/[0.03] transition active:scale-[0.99]",badge:"inline-flex items-center rounded-full border border-black/50 bg-black/[0.03] px-2 py-0.5 text-[11px] font-semibold text-slate-700"};function KKe({value:t,onChange:s,options:r,primary:a="#2563eb",className:i=""}){return n.jsx("div",{className:un("inline-flex items-center rounded-2xl border border-black/50 bg-black/[0.03] p-1",i),children:r.map(l=>{const o=t===l.value;return n.jsx("button",{type:"button",onClick:()=>s(l.value),className:un("h-9 px-3 rounded-xl text-[12px] font-semibold tracking-tight transition",o?"bg-white text-slate-900 border border-black/50 shadow-[0_1px_2px_rgba(0,0,0,0.08)]":"text-slate-600 hover:text-slate-800 hover:bg-white/60"),style:o?{borderColor:Aw(a,"22")||"rgba(0,0,0,0.1)"}:void 0,children:n.jsxs("span",{className:"inline-flex items-center gap-2",children:[l.icon?n.jsx(l.icon,{className:"h-4 w-4 opacity-80"}):null,l.label]})},l.value)})})}function Xse({value:t,onChange:s,options:r,primary:a="#2563eb"}){return n.jsx("div",{className:"inline-flex items-center rounded-2xl border border-black/50 bg-black/[0.03] p-1",children:r.map(i=>{const l=t===i.value;return n.jsx("button",{type:"button",onClick:()=>s(i.value),className:un("h-8 px-3 rounded-xl text-[12px] font-semibold transition",l?"bg-white text-slate-900 border border-black/50 shadow-[0_1px_2px_rgba(0,0,0,0.08)]":"text-slate-600 hover:text-slate-800 hover:bg-white/60"),style:l?{borderColor:Aw(a,"22")||"rgba(0,0,0,0.1)"}:void 0,children:i.label},i.value)})})}function aS({value:t,onChange:s,placeholder:r="Search",className:a=""}){return n.jsxs("div",{className:un("relative w-full",a),children:[n.jsx(Yt,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx("input",{value:t,onChange:i=>s(i.target.value),placeholder:r,className:un(Et.inputSm,"pl-9 pr-9 bg-white/90")}),!!t&&n.jsx("button",{type:"button",onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 inline-flex h-8 w-8 items-center justify-center rounded-full hover:bg-black/[0.04]",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4 text-slate-500"})})]})}function iS({title:t,subtitle:s,onClose:r,children:a}){return n.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/35 backdrop-blur-sm p-0 sm:p-4",children:n.jsxs("div",{className:"w-full max-w-xl max-h-[92vh] overflow-y-auto rounded-t-3xl sm:rounded-3xl border border-black/50 bg-white/90 backdrop-blur-xl shadow-[0_20px_60px_rgba(0,0,0,0.22)] px-4 py-4 sm:px-5 sm:py-5",children:[n.jsxs("div",{className:"mb-4 flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("h3",{className:"text-[16px] sm:text-[18px] font-semibold text-slate-900 tracking-tight",children:t}),s?n.jsx("p",{className:"mt-1 text-[12px] sm:text-[13px] text-slate-500 leading-relaxed",children:s}):null]}),n.jsx("button",{onClick:r,type:"button",className:"rounded-full p-2 text-slate-500 hover:bg-black/[0.04] hover:text-slate-700",title:"Close",children:n.jsx(ts,{className:"h-4 w-4"})})]}),a]})})}function lS({title:t,subtitle:s}){return n.jsxs("div",{className:"rounded-3xl border border-black/50 bg-white/80 p-6 text-center text-slate-600",children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] grid place-items-center",children:n.jsx(uc,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:t}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:s})]})}function oS({title:t,right:s,children:r}){return n.jsxs("div",{className:"overflow-hidden rounded-3xl border border-black/50 bg-white/85 backdrop-blur",children:[(t||s)&&n.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3 border-b border-black/50 bg-white/80 backdrop-blur",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-700 tracking-tight",children:t}),n.jsx("div",{className:"flex items-center gap-2",children:s})]}),n.jsx("div",{className:"divide-y divide-black/5",children:r})]})}function YKe({dotClass:t,label:s,className:r=""}){return n.jsxs("span",{className:un("inline-flex items-center gap-2 rounded-full border px-2 py-0.5 text-[11px] font-semibold",r),children:[n.jsx("span",{className:un("h-1.5 w-1.5 rounded-full",t)}),s]})}function cS({code:t}){return t?n.jsx("span",{className:"rounded-full bg-black/[0.04] border border-black/50 px-2 py-0.5 text-[11px] font-mono text-slate-700",children:t}):null}function XKe({canManage:t,onEdit:s,onDeactivate:r,deactivateLabel:a="Deactivate"}){return t?n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-black/[0.04] text-slate-600",title:"Actions",onClick:i=>i.stopPropagation(),children:n.jsx(CV,{className:"h-4.5 w-4.5"})})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsxs(kr,{onSelect:i=>{i.preventDefault(),s==null||s()},className:"cursor-pointer",children:[n.jsx(Yr,{className:"h-4 w-4 mr-2"}),"Edit"]}),n.jsx(Dd,{}),n.jsxs(kr,{onSelect:i=>{i.preventDefault(),r==null||r()},className:"cursor-pointer text-rose-700 focus:text-rose-700",children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"}),a]})]})]}):null}function dS({title:t,subtitle:s,metaLeft:r,metaRight:a,canClick:i,onClick:l,canManage:o,onEdit:c,onDeactivate:d}){return n.jsx("div",{role:i?"button":void 0,tabIndex:i?0:-1,onClick:i?l:void 0,onKeyDown:u=>{i&&(u.key==="Enter"||u.key===" ")&&(l==null||l())},className:un("group px-4 py-3 transition",i?"cursor-pointer hover:bg-black/[0.02]":"cursor-default"),children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"text-[14px] sm:text-[15px] font-semibold text-slate-900 truncate",children:t}),s]}),(r||a)&&n.jsxs("div",{className:"mt-1 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-3",children:[n.jsx("div",{className:"text-[12px] text-slate-600 min-w-0",children:r}),n.jsx("div",{className:"text-[12px] text-slate-500 flex items-center gap-2 justify-start sm:justify-end",children:a})]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(XKe,{canManage:o,onEdit:c,onDeactivate:d}),n.jsx(Ti,{className:"h-5 w-5 text-slate-300 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition"})]})]})})}function QKe(){const{branding:t}=iu()||{},s=(t==null?void 0:t.primary_color)||"#2563eb",[r,a]=p.useState("payers"),i=ct("patients.masters.view"),l=ct("patients.view");if(!(i||l))return n.jsx("div",{className:"rounded-3xl border border-amber-200 bg-amber-50/80 p-4 text-sm text-amber-800 shadow-sm",children:"You do not have permission to view patient masters."});const c=[{value:"types",label:"Patient Types",icon:uc},{value:"payers",label:"Payers",icon:Xa},{value:"tpas",label:"TPAs",icon:LV},{value:"plans",label:"Credit Plans",icon:tN}];return n.jsx("div",{className:Et.page,children:n.jsxs("div",{className:Et.container,children:[n.jsx("div",{className:un(Et.card,"p-5"),children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-[12px] font-semibold border",style:{backgroundColor:Aw(s,"12")||"#eff6ff",borderColor:Aw(s,"22")||"#bfdbfe",color:s},children:[n.jsx(Ka,{className:"h-4 w-4"}),"Patient Masters"]}),n.jsx("div",{className:"mt-2 text-[22px] sm:text-[26px] font-semibold tracking-tight text-slate-900",children:"Registration & Billing Masters"}),n.jsx("p",{className:"mt-1 max-w-2xl text-[13px] text-slate-600 leading-relaxed",children:"Configure patient types, payers, TPAs & credit plans used across OPD/IPD registration, authorization and billing workflows."}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[n.jsxs("span",{className:Et.badge,children:[n.jsx("span",{className:"mr-2 h-1.5 w-1.5 rounded-full bg-emerald-500"}),"OPD/IPD ready"]}),n.jsxs("span",{className:Et.badge,children:[n.jsx(Ka,{className:"h-3.5 w-3.5 mr-1.5 opacity-80"}),"NABH aligned"]})]})]}),n.jsx("div",{className:"flex items-start md:justify-end",children:n.jsx("div",{className:"w-full overflow-x-auto no-scrollbar",children:n.jsx(KKe,{value:r,onChange:a,options:c,primary:s})})})]})}),n.jsxs("div",{className:un(Et.insetCard,"mt-4 p-3 sm:p-4"),children:[r==="types"&&n.jsx(ZKe,{primary:s}),r==="payers"&&n.jsx(eYe,{primary:s}),r==="tpas"&&n.jsx(sYe,{primary:s}),r==="plans"&&n.jsx(rYe,{primary:s})]})]})})}function ZKe({primary:t}){const s=ct("patients.view")||ct("patients.masters.view"),r=ct("patients.update")||ct("patients.masters.manage"),[a,i]=p.useState("all"),[l,o]=p.useState([]),[c,d]=p.useState(!1),[u,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState(!1),[j,w]=p.useState(null),S=p.useCallback(async()=>{var D,T;if(s){d(!0),m("");try{const{data:B}=await he.get("/patient-types",{params:{include_inactive:!0}});o(B||[])}catch(B){const U=((T=(D=B==null?void 0:B.response)==null?void 0:D.data)==null?void 0:T.detail)||"Failed to load patient types";m(U),ae.error(U)}finally{d(!1)}}},[s]);p.useEffect(()=>{S()},[S]);const E=p.useMemo(()=>{let D=[...l];if(a==="active"&&(D=D.filter(B=>B.is_active)),a==="inactive"&&(D=D.filter(B=>!B.is_active)),!x)return D;const T=x.toLowerCase();return D.filter(B=>{var U,W,V;return((U=B.name)==null?void 0:U.toLowerCase().includes(T))||((W=B.code)==null?void 0:W.toLowerCase().includes(T))||((V=B.description)==null?void 0:V.toLowerCase().includes(T))})},[l,x,a]),k=()=>{w(null),v(!0)},A=D=>{r&&(w(D),v(!0))},I=D=>{v(!1),w(null),S(),ae.success(D==="update"?"Patient type updated":"Patient type created")},P=()=>{S(),ae.success("Patient type deactivated")},O=async D=>{var T,B;if(r&&window.confirm("Deactivate this patient type?"))try{await he.delete(`/patient-types/${D.id}`),P()}catch(U){ae.error(((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to deactivate patient type")}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:un(Et.subtle,"p-3"),children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(Ka,{className:"mt-0.5 h-4 w-4",style:{color:t}}),n.jsxs("div",{className:"text-[13px] text-slate-600 leading-relaxed",children:["Define visit types like ",n.jsx("span",{className:"font-semibold text-slate-900",children:"Emergency, OPD, IPD"})," used in registration & triage."]})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Et.badge,children:["Total: ",n.jsx("span",{className:"ml-1 tabular-nums",children:l.length})]}),n.jsxs("span",{className:Et.badge,children:["Showing: ",n.jsx("span",{className:"ml-1 tabular-nums",children:E.length})]})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsx(aS,{value:x,onChange:g,placeholder:"Search code, name, description",className:"sm:w-[320px]"}),r&&n.jsxs("button",{onClick:k,className:un(Et.btn,"text-white shadow-sm"),style:{backgroundColor:t},children:[n.jsx(ds,{className:"h-4 w-4"}),"New Type"]})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:Et.label,children:"Status"}),n.jsx(Xse,{value:a,onChange:i,primary:t,options:[{value:"all",label:"All"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]})]})]}),u&&n.jsx("div",{className:"rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:u}),c&&n.jsx("div",{className:un(Et.card,"p-4 text-center text-slate-500"),children:"Loading"}),!c&&E.length===0&&n.jsx(lS,{title:"No patient types",subtitle:r?"Create a new patient type to get started.":"No data found."}),!c&&E.length>0&&n.jsx(oS,{title:"Patient Types",right:n.jsx("span",{className:Et.badge,children:"macOS list"}),children:E.map(D=>n.jsx(dS,{title:D.name,subtitle:n.jsx(cS,{code:D.code}),metaLeft:D.description?n.jsx("span",{className:"line-clamp-1",children:D.description}):n.jsx("span",{className:"text-slate-400",children:"No description"}),metaRight:n.jsxs(n.Fragment,{children:[n.jsx(YKe,{dotClass:D.is_active?"bg-emerald-500":"bg-slate-400",label:D.is_active?"Active":"Inactive",className:D.is_active?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-black/50 bg-black/[0.03] text-slate-600"}),n.jsxs("span",{className:"text-slate-400",children:["Sort: ",D.sort_order??0]})]}),canClick:!!r,onClick:()=>A(D),canManage:!!r,onEdit:()=>A(D),onDeactivate:()=>O(D)},D.id))}),y&&n.jsx(JKe,{primary:t,existing:j,onClose:()=>{v(!1),w(null)},onSaved:I,onDeleted:P})]})}function JKe({existing:t,onClose:s,onSaved:r,onDeleted:a,primary:i}){const l=ct("patients.update")||ct("patients.masters.manage"),[o,c]=p.useState(()=>({code:(t==null?void 0:t.code)||"",name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",is_active:(t==null?void 0:t.is_active)??!0,sort_order:(t==null?void 0:t.sort_order)??0})),[d,u]=p.useState(!1),[m,x]=p.useState(""),g=async v=>{var j,w;if(v.preventDefault(),!!l){u(!0),x("");try{const S={...o,sort_order:Number(o.sort_order)||0};t?(await he.put(`/patient-types/${t.id}`,S),r==null||r("update")):(await he.post("/patient-types",S),r==null||r("create"))}catch(S){const E=((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to save patient type";x(E),ae.error(E)}finally{u(!1)}}},y=async()=>{var v,j;if(!(!t||!l)&&window.confirm("Deactivate this patient type?")){u(!0),x("");try{await he.delete(`/patient-types/${t.id}`),a==null||a(),s==null||s()}catch(w){const S=((j=(v=w==null?void 0:w.response)==null?void 0:v.data)==null?void 0:j.detail)||"Failed to deactivate patient type";x(S),ae.error(S)}finally{u(!1)}}};return n.jsxs(iS,{title:t?"Edit Patient Type":"New Patient Type",subtitle:"Define master types like Emergency, OPD, IPD, Health Checkup",onClose:s,children:[m&&n.jsx("div",{className:"mb-3 rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:m}),n.jsxs("form",{onSubmit:g,className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Code"}),n.jsx("input",{className:Et.input,value:o.code,onChange:v=>c({...o,code:v.target.value.toUpperCase()}),required:!0}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-400",children:"Example: EMERGENCY, OPD, IPD, HC"})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Name"}),n.jsx("input",{className:Et.input,value:o.name,onChange:v=>c({...o,name:v.target.value}),required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Description"}),n.jsx("textarea",{className:Et.textarea,value:o.description,onChange:v=>c({...o,description:v.target.value})})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Sort Order"}),n.jsx("input",{className:Et.input,type:"number",value:o.sort_order,onChange:v=>c({...o,sort_order:v.target.value})}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-400",children:"Lower number shows earlier in dropdowns."})]}),n.jsxs("div",{className:"flex items-center gap-2 sm:justify-end",children:[n.jsx("input",{id:"pt-active",type:"checkbox",className:"h-4 w-4 rounded border-slate-300",checked:o.is_active,onChange:v=>c({...o,is_active:v.target.checked})}),n.jsx("label",{htmlFor:"pt-active",className:"text-[13px] font-semibold text-slate-800",children:"Active"})]})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[t?n.jsxs("button",{type:"button",onClick:y,className:"inline-flex items-center gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-700 hover:bg-rose-100/60",children:[n.jsx(Ms,{className:"h-4 w-4"}),"Deactivate"]}):n.jsx("div",{}),n.jsxs("div",{className:"ml-auto flex gap-2",children:[n.jsx("button",{type:"button",onClick:s,className:un(Et.btnOutline,"h-10"),children:"Cancel"}),n.jsx("button",{disabled:d||!l,className:un(Et.btn,"h-10 text-white shadow-sm"),style:{backgroundColor:i},children:d?"Saving":"Save"})]})]})]})]})}function eYe({primary:t}){const s=ct("patients.masters.view"),r=ct("patients.masters.manage"),[a,i]=p.useState("all"),[l,o]=p.useState([]),[c,d]=p.useState(!1),[u,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState(!1),[j,w]=p.useState(null),S=p.useCallback(async()=>{var D,T;if(s){d(!0),m("");try{const{data:B}=await he.get("/patient-masters/payers");o(B||[])}catch(B){const U=((T=(D=B==null?void 0:B.response)==null?void 0:D.data)==null?void 0:T.detail)||"Failed to load payers";m(U),ae.error(U)}finally{d(!1)}}},[s]);p.useEffect(()=>{S()},[S]);const E=p.useMemo(()=>{let D=[...l];if(a!=="all"&&(D=D.filter(B=>B.payer_type===a)),!x)return D;const T=x.toLowerCase();return D.filter(B=>{var U,W,V;return((U=B.name)==null?void 0:U.toLowerCase().includes(T))||((W=B.code)==null?void 0:W.toLowerCase().includes(T))||((V=B.payer_type)==null?void 0:V.toLowerCase().includes(T))})},[l,x,a]),k=()=>{w(null),v(!0)},A=D=>{r&&(w(D),v(!0))},I=D=>{v(!1),w(null),S(),ae.success(D==="update"?"Payer updated":"Payer created")},P=()=>{S(),ae.success("Payer deactivated")},O=async D=>{var T,B;if(r&&window.confirm("Deactivate this payer?"))try{await he.delete(`/patient-masters/payers/${D.id}`),P()}catch(U){ae.error(((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to deactivate payer")}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:un(Et.subtle,"p-3"),children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(Ka,{className:"mt-0.5 h-4 w-4",style:{color:t}}),n.jsxs("div",{className:"text-[13px] text-slate-600 leading-relaxed",children:["Payers used for ",n.jsx("span",{className:"font-semibold text-slate-900",children:"insurance / corporate / government schemes"})," in OPD/IPD billing."]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsx(aS,{value:x,onChange:g,placeholder:"Search code, name, type",className:"sm:w-[320px]"}),r&&n.jsxs("button",{onClick:k,className:un(Et.btn,"text-white shadow-sm"),style:{backgroundColor:t},children:[n.jsx(ds,{className:"h-4 w-4"}),"New Payer"]})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:Et.label,children:"Payer type"}),n.jsx(Xse,{value:a,onChange:i,primary:t,options:[{value:"all",label:"All"},...Yse.map(D=>({value:D.value,label:D.label}))]}),n.jsxs("div",{className:"ml-auto flex gap-2",children:[n.jsxs("span",{className:Et.badge,children:["Total: ",n.jsx("span",{className:"ml-1 tabular-nums",children:l.length})]}),n.jsxs("span",{className:Et.badge,children:["Showing: ",n.jsx("span",{className:"ml-1 tabular-nums",children:E.length})]})]})]})]}),u&&n.jsx("div",{className:"rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:u}),c&&n.jsx("div",{className:un(Et.card,"p-4 text-center text-slate-500"),children:"Loading"}),!c&&E.length===0&&n.jsx(lS,{title:"No payers",subtitle:r?"Create a new payer to get started.":"No data found."}),!c&&E.length>0&&n.jsx(oS,{title:"Payers",right:n.jsx("span",{className:Et.badge,children:"macOS list"}),children:E.map(D=>n.jsx(dS,{title:D.name,subtitle:n.jsx(cS,{code:D.code}),metaLeft:n.jsxs("div",{className:"flex flex-col gap-0.5 min-w-0",children:[n.jsxs("div",{className:"capitalize",children:["Type: ",n.jsx("span",{className:"font-semibold text-slate-800",children:D.payer_type||""})]}),n.jsx("div",{className:"text-slate-500 line-clamp-1",children:D.contact_person?`Contact: ${D.contact_person}`:"No contact person"}),n.jsx("div",{className:"text-slate-500 line-clamp-1",children:D.phone||D.email?`${D.phone||""}  ${D.email||""}`:"No phone/email"})]}),metaRight:n.jsx("span",{className:"text-slate-400 line-clamp-1",children:D.address||""}),canClick:!!r,onClick:()=>A(D),canManage:!!r,onEdit:()=>A(D),onDeactivate:()=>O(D)},D.id))}),y&&n.jsx(tYe,{primary:t,existing:j,onClose:()=>{v(!1),w(null)},onSaved:I,onDeleted:P})]})}function tYe({existing:t,onClose:s,onSaved:r,onDeleted:a,primary:i}){const l=ct("patients.masters.manage"),[o,c]=p.useState(()=>({code:(t==null?void 0:t.code)||"",name:(t==null?void 0:t.name)||"",payer_type:(t==null?void 0:t.payer_type)||"insurance",contact_person:(t==null?void 0:t.contact_person)||"",phone:(t==null?void 0:t.phone)||"",email:(t==null?void 0:t.email)||"",address:(t==null?void 0:t.address)||""})),[d,u]=p.useState(!1),[m,x]=p.useState(""),g=async v=>{var j,w;if(v.preventDefault(),!!l){u(!0),x("");try{t?(await he.put(`/patient-masters/payers/${t.id}`,o),r==null||r("update")):(await he.post("/patient-masters/payers",o),r==null||r("create"))}catch(S){const E=((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to save payer";x(E),ae.error(E)}finally{u(!1)}}},y=async()=>{var v,j;if(!(!t||!l)&&window.confirm("Deactivate this payer?")){u(!0),x("");try{await he.delete(`/patient-masters/payers/${t.id}`),a==null||a(),s==null||s()}catch(w){const S=((j=(v=w==null?void 0:w.response)==null?void 0:v.data)==null?void 0:j.detail)||"Failed to deactivate payer";x(S),ae.error(S)}finally{u(!1)}}};return n.jsxs(iS,{title:t?"Edit Payer":"New Payer",subtitle:"Master record used for credit / insurance patients.",onClose:s,children:[m&&n.jsx("div",{className:"mb-3 rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:m}),n.jsxs("form",{onSubmit:g,className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Code"}),n.jsx("input",{className:Et.input,value:o.code,onChange:v=>c({...o,code:v.target.value.toUpperCase()}),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Name"}),n.jsx("input",{className:Et.input,value:o.name,onChange:v=>c({...o,name:v.target.value}),required:!0})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Type"}),n.jsx("select",{className:Et.input,value:o.payer_type,onChange:v=>c({...o,payer_type:v.target.value}),children:Yse.map(v=>n.jsx("option",{value:v.value,children:v.label},v.value))})]}),n.jsxs("div",{className:"sm:col-span-2",children:[n.jsx("label",{className:Et.label,children:"Contact Person"}),n.jsx("input",{className:Et.input,value:o.contact_person,onChange:v=>c({...o,contact_person:v.target.value})})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Phone"}),n.jsx("input",{className:Et.input,value:o.phone,onChange:v=>c({...o,phone:v.target.value})})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Email"}),n.jsx("input",{className:Et.input,type:"email",value:o.email,onChange:v=>c({...o,email:v.target.value})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Address"}),n.jsx("textarea",{className:Et.textarea,value:o.address,onChange:v=>c({...o,address:v.target.value})})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[t?n.jsxs("button",{type:"button",onClick:y,className:"inline-flex items-center gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-700 hover:bg-rose-100/60",children:[n.jsx(Ms,{className:"h-4 w-4"}),"Deactivate"]}):n.jsx("div",{}),n.jsxs("div",{className:"ml-auto flex gap-2",children:[n.jsx("button",{type:"button",onClick:s,className:un(Et.btnOutline,"h-10"),children:"Cancel"}),n.jsx("button",{className:un(Et.btn,"h-10 text-white shadow-sm"),style:{backgroundColor:i},disabled:d||!l,children:d?"Saving":"Save"})]})]})]})]})}function sYe({primary:t}){const s=ct("patients.masters.view"),r=ct("patients.masters.manage"),[a,i]=p.useState([]),[l,o]=p.useState([]),[c,d]=p.useState(!1),[u,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState(!1),[j,w]=p.useState(null),S=p.useCallback(async()=>{var T,B;if(s){d(!0),m("");try{const[U,W]=await Promise.all([he.get("/patient-masters/tpas"),he.get("/patient-masters/payers")]);i(U.data||[]),o(W.data||[])}catch(U){const W=((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to load TPAs";m(W),ae.error(W)}finally{d(!1)}}},[s]);p.useEffect(()=>{S()},[S]);const E=p.useMemo(()=>{const T={};for(const B of l)T[B.id]=B;return T},[l]),k=p.useMemo(()=>{if(!x)return a;const T=x.toLowerCase();return a.filter(B=>{var U,W,V,R;return((U=B.name)==null?void 0:U.toLowerCase().includes(T))||((W=B.code)==null?void 0:W.toLowerCase().includes(T))||((R=(V=E[B.payer_id])==null?void 0:V.name)==null?void 0:R.toLowerCase().includes(T))})},[a,x,E]),A=()=>{w(null),v(!0)},I=T=>{r&&(w(T),v(!0))},P=T=>{v(!1),w(null),S(),ae.success(T==="update"?"TPA updated":"TPA created")},O=()=>{S(),ae.success("TPA deactivated")},D=async T=>{var B,U;if(r&&window.confirm("Deactivate this TPA?"))try{await he.delete(`/patient-masters/tpas/${T.id}`),O()}catch(W){ae.error(((U=(B=W==null?void 0:W.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to deactivate TPA")}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:un(Et.subtle,"p-3"),children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(LV,{className:"mt-0.5 h-4 w-4",style:{color:t}}),n.jsx("div",{className:"text-[13px] text-slate-600 leading-relaxed",children:"Third-party administrators (TPAs) linked to payers."})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsx(aS,{value:x,onChange:g,placeholder:"Search code, name, payer",className:"sm:w-[320px]"}),r&&n.jsxs("button",{onClick:A,className:un(Et.btn,"text-white shadow-sm"),style:{backgroundColor:t},children:[n.jsx(ds,{className:"h-4 w-4"}),"New TPA"]})]})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[n.jsxs("span",{className:Et.badge,children:["Total: ",n.jsx("span",{className:"ml-1 tabular-nums",children:a.length})]}),n.jsxs("span",{className:Et.badge,children:["Showing: ",n.jsx("span",{className:"ml-1 tabular-nums",children:k.length})]})]})]}),u&&n.jsx("div",{className:"rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:u}),c&&n.jsx("div",{className:un(Et.card,"p-4 text-center text-slate-500"),children:"Loading"}),!c&&k.length===0&&n.jsx(lS,{title:"No TPAs",subtitle:"No data found."}),!c&&k.length>0&&n.jsx(oS,{title:"TPAs",right:n.jsx("span",{className:Et.badge,children:"macOS list"}),children:k.map(T=>{var B;return n.jsx(dS,{title:T.name,subtitle:n.jsx(cS,{code:T.code}),metaLeft:n.jsxs("div",{className:"flex flex-col gap-0.5",children:[n.jsxs("div",{children:["Payer:"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:((B=E[T.payer_id])==null?void 0:B.name)||""})]}),n.jsx("div",{className:"text-slate-500 line-clamp-1",children:T.contact_person?`Contact: ${T.contact_person}`:"No contact person"}),n.jsx("div",{className:"text-slate-500 line-clamp-1",children:T.phone||T.email?`${T.phone||""}  ${T.email||""}`:"No phone/email"})]}),metaRight:n.jsx("span",{className:"text-slate-400",children:""}),canClick:!!r,onClick:()=>I(T),canManage:!!r,onEdit:()=>I(T),onDeactivate:()=>D(T)},T.id)})}),y&&n.jsx(nYe,{primary:t,existing:j,payers:l,onClose:()=>{v(!1),w(null)},onSaved:P,onDeleted:O})]})}function nYe({existing:t,payers:s,onClose:r,onSaved:a,onDeleted:i,primary:l}){const o=ct("patients.masters.manage"),[c,d]=p.useState(()=>({code:(t==null?void 0:t.code)||"",name:(t==null?void 0:t.name)||"",payer_id:(t==null?void 0:t.payer_id)||"",contact_person:(t==null?void 0:t.contact_person)||"",phone:(t==null?void 0:t.phone)||"",email:(t==null?void 0:t.email)||""})),[u,m]=p.useState(!1),[x,g]=p.useState(""),y=async j=>{var w,S;if(j.preventDefault(),!!o){m(!0),g("");try{const E={...c,payer_id:c.payer_id?Number(c.payer_id):null};t?(await he.put(`/patient-masters/tpas/${t.id}`,E),a==null||a("update")):(await he.post("/patient-masters/tpas",E),a==null||a("create"))}catch(E){const k=((S=(w=E==null?void 0:E.response)==null?void 0:w.data)==null?void 0:S.detail)||"Failed to save TPA";g(k),ae.error(k)}finally{m(!1)}}},v=async()=>{var j,w;if(!(!t||!o)&&window.confirm("Deactivate this TPA?")){m(!0),g("");try{await he.delete(`/patient-masters/tpas/${t.id}`),i==null||i(),r==null||r()}catch(S){const E=((w=(j=S==null?void 0:S.response)==null?void 0:j.data)==null?void 0:w.detail)||"Failed to deactivate TPA";g(E),ae.error(E)}finally{m(!1)}}};return n.jsxs(iS,{title:t?"Edit TPA":"New TPA",subtitle:"Third-party administrator master, mapped to payer.",onClose:r,children:[x&&n.jsx("div",{className:"mb-3 rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:x}),n.jsxs("form",{onSubmit:y,className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Code"}),n.jsx("input",{className:Et.input,value:c.code,onChange:j=>d({...c,code:j.target.value.toUpperCase()}),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Name"}),n.jsx("input",{className:Et.input,value:c.name,onChange:j=>d({...c,name:j.target.value}),required:!0})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Payer"}),n.jsxs("select",{className:Et.input,value:c.payer_id||"",onChange:j=>d({...c,payer_id:j.target.value||""}),required:!0,children:[n.jsx("option",{value:"",children:"Select payer"}),s.map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Contact Person"}),n.jsx("input",{className:Et.input,value:c.contact_person,onChange:j=>d({...c,contact_person:j.target.value})})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Phone"}),n.jsx("input",{className:Et.input,value:c.phone,onChange:j=>d({...c,phone:j.target.value})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Email"}),n.jsx("input",{className:Et.input,type:"email",value:c.email,onChange:j=>d({...c,email:j.target.value})})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[t?n.jsxs("button",{type:"button",onClick:v,className:"inline-flex items-center gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-700 hover:bg-rose-100/60",children:[n.jsx(Ms,{className:"h-4 w-4"}),"Deactivate"]}):n.jsx("div",{}),n.jsxs("div",{className:"ml-auto flex gap-2",children:[n.jsx("button",{type:"button",onClick:r,className:un(Et.btnOutline,"h-10"),children:"Cancel"}),n.jsx("button",{className:un(Et.btn,"h-10 text-white shadow-sm"),style:{backgroundColor:l},disabled:u||!o,children:u?"Saving":"Save"})]})]})]})]})}function rYe({primary:t}){const s=ct("patients.masters.view"),r=ct("patients.masters.manage"),[a,i]=p.useState([]),[l,o]=p.useState([]),[c,d]=p.useState([]),[u,m]=p.useState(!1),[x,g]=p.useState(""),[y,v]=p.useState(""),[j,w]=p.useState(!1),[S,E]=p.useState(null),k=p.useCallback(async()=>{var W,V;if(s){m(!0),g("");try{const[R,F,G]=await Promise.all([he.get("/patient-masters/credit-plans"),he.get("/patient-masters/payers"),he.get("/patient-masters/tpas")]);i(R.data||[]),o(F.data||[]),d(G.data||[])}catch(R){const F=((V=(W=R==null?void 0:R.response)==null?void 0:W.data)==null?void 0:V.detail)||"Failed to load credit plans";g(F),ae.error(F)}finally{m(!1)}}},[s]);p.useEffect(()=>{k()},[k]);const A=p.useMemo(()=>{const W={};for(const V of l)W[V.id]=V;return W},[l]),I=p.useMemo(()=>{const W={};for(const V of c)W[V.id]=V;return W},[c]),P=p.useMemo(()=>{if(!y)return a;const W=y.toLowerCase();return a.filter(V=>{var R,F,G,H,$,K;return((R=V.name)==null?void 0:R.toLowerCase().includes(W))||((F=V.code)==null?void 0:F.toLowerCase().includes(W))||((H=(G=A[V.payer_id])==null?void 0:G.name)==null?void 0:H.toLowerCase().includes(W))||((K=($=I[V.tpa_id])==null?void 0:$.name)==null?void 0:K.toLowerCase().includes(W))})},[a,y,A,I]),O=()=>{E(null),w(!0)},D=W=>{r&&(E(W),w(!0))},T=W=>{w(!1),E(null),k(),ae.success(W==="update"?"Credit plan updated":"Credit plan created")},B=()=>{k(),ae.success("Credit plan deactivated")},U=async W=>{var V,R;if(r&&window.confirm("Deactivate this credit plan?"))try{await he.delete(`/patient-masters/credit-plans/${W.id}`),B()}catch(F){ae.error(((R=(V=F==null?void 0:F.response)==null?void 0:V.data)==null?void 0:R.detail)||"Failed to deactivate credit plan")}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:un(Et.subtle,"p-3"),children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(Co,{className:"mt-0.5 h-4 w-4",style:{color:t}}),n.jsx("div",{className:"text-[13px] text-slate-600 leading-relaxed",children:"Credit / insurance plans used for IPD/OPD billing & authorization."})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsx(aS,{value:y,onChange:v,placeholder:"Search code, name, payer, TPA",className:"sm:w-[320px]"}),r&&n.jsxs("button",{onClick:O,className:un(Et.btn,"text-white shadow-sm"),style:{backgroundColor:t},children:[n.jsx(ds,{className:"h-4 w-4"}),"New Plan"]})]})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[n.jsxs("span",{className:Et.badge,children:["Total: ",n.jsx("span",{className:"ml-1 tabular-nums",children:a.length})]}),n.jsxs("span",{className:Et.badge,children:["Showing: ",n.jsx("span",{className:"ml-1 tabular-nums",children:P.length})]})]})]}),x&&n.jsx("div",{className:"rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:x}),u&&n.jsx("div",{className:un(Et.card,"p-4 text-center text-slate-500"),children:"Loading"}),!u&&P.length===0&&n.jsx(lS,{title:"No credit plans",subtitle:"No data found."}),!u&&P.length>0&&n.jsx(oS,{title:"Credit Plans",right:n.jsx("span",{className:Et.badge,children:"macOS list"}),children:P.map(W=>{var V,R;return n.jsx(dS,{title:W.name,subtitle:n.jsx(cS,{code:W.code}),metaLeft:n.jsxs("div",{className:"flex flex-col gap-0.5",children:[n.jsxs("div",{children:["Payer:"," ",n.jsx("span",{className:"font-semibold text-slate-800",children:((V=A[W.payer_id])==null?void 0:V.name)||""})]}),n.jsxs("div",{className:"text-slate-500",children:["TPA:"," ",n.jsx("span",{className:"font-semibold text-slate-700",children:((R=I[W.tpa_id])==null?void 0:R.name)||""})]}),W.description?n.jsx("div",{className:"text-slate-500 line-clamp-1",children:W.description}):n.jsx("div",{className:"text-slate-400",children:"No notes"})]}),metaRight:n.jsx("span",{className:"text-slate-400",children:""}),canClick:!!r,onClick:()=>D(W),canManage:!!r,onEdit:()=>D(W),onDeactivate:()=>U(W)},W.id)})}),j&&n.jsx(aYe,{primary:t,existing:S,payers:l,tpas:c,onClose:()=>{w(!1),E(null)},onSaved:T,onDeleted:B})]})}function aYe({existing:t,payers:s,tpas:r,onClose:a,onSaved:i,onDeleted:l,primary:o}){const c=ct("patients.masters.manage"),[d,u]=p.useState(()=>({code:(t==null?void 0:t.code)||"",name:(t==null?void 0:t.name)||"",payer_id:(t==null?void 0:t.payer_id)||"",tpa_id:(t==null?void 0:t.tpa_id)||"",description:(t==null?void 0:t.description)||""})),[m,x]=p.useState(!1),[g,y]=p.useState(""),v=async w=>{var S,E;if(w.preventDefault(),!!c){x(!0),y("");try{const k={...d,payer_id:d.payer_id?Number(d.payer_id):null,tpa_id:d.tpa_id?Number(d.tpa_id):null};t?(await he.put(`/patient-masters/credit-plans/${t.id}`,k),i==null||i("update")):(await he.post("/patient-masters/credit-plans",k),i==null||i("create"))}catch(k){const A=((E=(S=k==null?void 0:k.response)==null?void 0:S.data)==null?void 0:E.detail)||"Failed to save credit plan";y(A),ae.error(A)}finally{x(!1)}}},j=async()=>{var w,S;if(!(!t||!c)&&window.confirm("Deactivate this credit plan?")){x(!0),y("");try{await he.delete(`/patient-masters/credit-plans/${t.id}`),l==null||l(),a==null||a()}catch(E){const k=((S=(w=E==null?void 0:E.response)==null?void 0:w.data)==null?void 0:S.detail)||"Failed to deactivate credit plan";y(k),ae.error(k)}finally{x(!1)}}};return n.jsxs(iS,{title:t?"Edit Credit Plan":"New Credit Plan",subtitle:"Map plan to payer & optional TPA for billing workflows.",onClose:a,children:[g&&n.jsx("div",{className:"mb-3 rounded-3xl border border-rose-200 bg-rose-50/80 p-3 text-[13px] text-rose-700",children:g}),n.jsxs("form",{onSubmit:v,className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Code"}),n.jsx("input",{className:Et.input,value:d.code,onChange:w=>u({...d,code:w.target.value.toUpperCase()}),required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Name"}),n.jsx("input",{className:Et.input,value:d.name,onChange:w=>u({...d,name:w.target.value}),required:!0})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Payer"}),n.jsxs("select",{className:Et.input,value:d.payer_id||"",onChange:w=>u({...d,payer_id:w.target.value||""}),required:!0,children:[n.jsx("option",{value:"",children:"Select payer"}),s.map(w=>n.jsx("option",{value:w.id,children:w.name},w.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"TPA (optional)"}),n.jsxs("select",{className:Et.input,value:d.tpa_id||"",onChange:w=>u({...d,tpa_id:w.target.value||""}),children:[n.jsx("option",{value:"",children:"No TPA"}),r.map(w=>n.jsx("option",{value:w.id,children:w.name},w.id))]})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:Et.label,children:"Description / Notes"}),n.jsx("textarea",{className:Et.textarea,value:d.description,onChange:w=>u({...d,description:w.target.value})})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[t?n.jsxs("button",{type:"button",onClick:j,className:"inline-flex items-center gap-2 rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-700 hover:bg-rose-100/60",children:[n.jsx(Ms,{className:"h-4 w-4"}),"Deactivate"]}):n.jsx("div",{}),n.jsxs("div",{className:"ml-auto flex gap-2",children:[n.jsx("button",{type:"button",onClick:a,className:un(Et.btnOutline,"h-10"),children:"Cancel"}),n.jsx("button",{className:un(Et.btn,"h-10 text-white shadow-sm"),style:{backgroundColor:o},disabled:m||!c,children:m?"Saving":"Save"})]})]})]})]})}function Oc({label:t,name:s,value:r,onChange:a}){return n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:t}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ee,{type:"color",value:r||"#ffffff",onChange:i=>a(s,i.target.value),className:"w-12 h-9 p-1 cursor-pointer"}),n.jsx(Ee,{type:"text",value:r||"",onChange:i=>a(s,i.target.value),placeholder:"#0f172a",className:"flex-1"})]})]})}function iYe(){const{branding:t,setBranding:s,loading:r}=iu()||{},[a,i]=p.useState({}),[l,o]=p.useState(!1),[c,d]=p.useState(!1),[u,m]=p.useState(null),[x,g]=p.useState(null),[y,v]=p.useState(null),[j,w]=p.useState(null),[S,E]=p.useState(null),[k,A]=p.useState(null),[I,P]=p.useState("background");p.useEffect(()=>{t&&(P(t.letterhead_position||"background"),i({org_name:t.org_name||"",org_tagline:t.org_tagline||"",org_address:t.org_address||"",org_phone:t.org_phone||"",org_email:t.org_email||"",org_website:t.org_website||"",org_gstin:t.org_gstin||"",primary_color:t.primary_color||"",primary_color_dark:t.primary_color_dark||"",sidebar_bg_color:t.sidebar_bg_color||"",content_bg_color:t.content_bg_color||"",card_bg_color:t.card_bg_color||"",border_color:t.border_color||"",text_color:t.text_color||"",text_muted_color:t.text_muted_color||"",icon_color:t.icon_color||"",icon_bg_color:t.icon_bg_color||"",pdf_header_height_mm:typeof t.pdf_header_height_mm=="number"?t.pdf_header_height_mm:"",pdf_footer_height_mm:typeof t.pdf_footer_height_mm=="number"?t.pdf_footer_height_mm:"",pdf_show_page_number:typeof t.pdf_show_page_number=="boolean"?t.pdf_show_page_number:!0}))},[t]);const O=(H,$)=>{i(K=>({...K,[H]:$}))},D=H=>$=>{O(H,$.target.value)},T=H=>$=>{const K=$.target.value;O(H,K===""?"":Number(K))},B=H=>$=>{O(H,!!$.target.checked)},U=(H,$)=>{O(H,$)},W=async()=>{var H,$,K,le;o(!0);try{const se={...a,pdf_header_height_mm:a.pdf_header_height_mm===""?null:Number(a.pdf_header_height_mm),pdf_footer_height_mm:a.pdf_footer_height_mm===""?null:Number(a.pdf_footer_height_mm)},{data:J}=await rxe(se);s==null||s(J),ae.success("Branding settings updated")}catch(se){console.error("Failed to update branding settings",se);const J=(($=(H=se==null?void 0:se.response)==null?void 0:H.data)==null?void 0:$.detail)||((le=(K=se==null?void 0:se.response)==null?void 0:K.data)==null?void 0:le.message)||(se==null?void 0:se.message)||"Could not save branding settings";ae.error(J)}finally{o(!1)}},V=async H=>{H.preventDefault(),await W()},R=async H=>{H.preventDefault(),await W()},F=async()=>{var $,K,le,se;if(!k){ae.warning("Select a letterhead file first");return}const H=new FormData;H.append("file",k),H.append("position",I);try{const{data:J}=await ixe(H);s==null||s(J),ae.success("Letterhead updated successfully"),A(null)}catch(J){console.error("Failed to upload letterhead",J);const ie=((K=($=J==null?void 0:J.response)==null?void 0:$.data)==null?void 0:K.detail)||((se=(le=J==null?void 0:J.response)==null?void 0:le.data)==null?void 0:se.message)||(J==null?void 0:J.message)||"Could not upload letterhead";ae.error(ie)}},G=async H=>{var K,le,se,J;if(H.preventDefault(),!u&&!x&&!y&&!j&&!S){ae.warning("Select at least one file to upload");return}const $=new FormData;u&&$.append("logo",u),x&&$.append("login_logo",x),y&&$.append("favicon",y),j&&$.append("pdf_header",j),S&&$.append("pdf_footer",S),d(!0);try{const{data:ie}=await axe($);s==null||s(ie),ae.success("Branding files uploaded"),m(null),g(null),v(null),w(null),E(null)}catch(ie){console.error("Failed to upload branding files",ie);const te=((le=(K=ie==null?void 0:ie.response)==null?void 0:K.data)==null?void 0:le.detail)||((J=(se=ie==null?void 0:ie.response)==null?void 0:se.data)==null?void 0:J.message)||(ie==null?void 0:ie.message)||"Could not upload branding files";ae.error(te)}finally{d(!1)}};return r||!t?n.jsxs("div",{className:"p-6",children:[n.jsx(Qe,{className:"h-7 w-64 mb-3"}),n.jsx(Qe,{className:"h-64 w-full"})]}):n.jsxs(mt.div,{className:"p-6 space-y-4",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.2},children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-semibold text-slate-900",children:"Customization & Templates"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Configure organisation identity, logo, UI colors, and global PDF header/footer for all NABH HIMS documents."})]})}),n.jsxs(dt,{className:"border border-slate-500 rounded-2xl shadow-sm bg-white",children:[n.jsx(gt,{className:"pb-2",children:n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Global Branding & PDF Settings"})}),n.jsx(it,{children:n.jsxs(Do,{defaultValue:"branding",children:[n.jsxs(Wl,{className:"mb-4",children:[n.jsx(zs,{value:"branding",children:"Branding & Organisation"}),n.jsx(zs,{value:"pdf",children:"PDF Header / Footer & Behaviour"})]}),n.jsx(Ls,{value:"branding",className:"space-y-6",children:n.jsxs("form",{onSubmit:V,className:"space-y-6",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Organisation details"}),n.jsx("p",{className:"text-xs text-slate-500",children:"These values appear on letterheads, EMR PDFs, discharge summaries and other NABH documents."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Organisation name"}),n.jsx(Ee,{value:a.org_name||"",onChange:D("org_name"),placeholder:"Hospital / Clinic name"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Tagline"}),n.jsx(Ee,{value:a.org_tagline||"",onChange:D("org_tagline"),placeholder:"Smart  Secure  NABH-Standard"})]}),n.jsxs("div",{className:"space-y-1.5 md:col-span-2",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Address"}),n.jsx(Ee,{value:a.org_address||"",onChange:D("org_address"),placeholder:"Address line for letterhead & PDFs"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Phone"}),n.jsx(Ee,{value:a.org_phone||"",onChange:D("org_phone"),placeholder:"+91-XXXXXXXXXX"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Email"}),n.jsx(Ee,{type:"email",value:a.org_email||"",onChange:D("org_email"),placeholder:"info@example.com"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Website"}),n.jsx(Ee,{value:a.org_website||"",onChange:D("org_website"),placeholder:"https://your-hospital.com"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"GSTIN"}),n.jsx(Ee,{value:a.org_gstin||"",onChange:D("org_gstin"),placeholder:"GSTIN (optional, for bills)"})]})]})]}),n.jsx("div",{className:"border-t border-slate-100"}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Color palette"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Tune application colors. These drive sidebar, primary buttons and card backgrounds."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(Oc,{label:"Primary color (buttons, highlights)",name:"primary_color",value:a.primary_color,onChange:U}),n.jsx(Oc,{label:"Primary dark (topbar / hover)",name:"primary_color_dark",value:a.primary_color_dark,onChange:U}),n.jsx(Oc,{label:"Sidebar background color",name:"sidebar_bg_color",value:a.sidebar_bg_color,onChange:U}),n.jsx(Oc,{label:"Content background color",name:"content_bg_color",value:a.content_bg_color,onChange:U}),n.jsx(Oc,{label:"Card background color",name:"card_bg_color",value:a.card_bg_color,onChange:U}),n.jsx(Oc,{label:"Border color",name:"border_color",value:a.border_color,onChange:U}),n.jsx(Oc,{label:"Text color",name:"text_color",value:a.text_color,onChange:U}),n.jsx(Oc,{label:"Muted text color",name:"text_muted_color",value:a.text_muted_color,onChange:U}),n.jsx(Oc,{label:"Icon color",name:"icon_color",value:a.icon_color,onChange:U}),n.jsx(Oc,{label:"Icon background color",name:"icon_bg_color",value:a.icon_bg_color,onChange:U})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-2",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[(t==null?void 0:t.logo_url)&&n.jsx("img",{src:t.logo_url,alt:"Logo preview",className:"h-8 w-auto rounded-sm border border-slate-500 bg-white"}),n.jsxs("span",{className:"text-xs text-slate-500",children:["Logos & PDF artwork are managed in the"," ",n.jsx("span",{className:"font-medium",children:"PDF Header / Footer"})," tab."]})]}),n.jsx(ge,{type:"submit",disabled:l,className:"min-w-[140px]",children:l?"Saving":"Save branding"})]})]})}),n.jsxs(Ls,{value:"pdf",className:"space-y-6",children:[n.jsxs("form",{onSubmit:G,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:"Application logo (sidebar / topbar)"}),n.jsxs("div",{className:"border border-dashed border-slate-300 rounded-2xl p-3 flex flex-col items-center gap-2",children:[(t==null?void 0:t.logo_url)&&n.jsx("img",{src:t.logo_url,alt:"Logo",className:"h-8 w-auto rounded-sm border border-slate-500 bg-white mb-1"}),n.jsxs("label",{className:"w-full",children:[n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs cursor-pointer",children:[n.jsx(x0,{className:"h-4 w-4"}),n.jsx("span",{children:"Choose logo (PNG / JPG)"})]}),n.jsx(Ee,{type:"file",accept:"image/*",className:"hidden",onChange:H=>{var $;return m((($=H.target.files)==null?void 0:$[0])||null)}})]}),u&&n.jsx("p",{className:"text-[11px] text-slate-500 truncate w-full text-center",children:u.name})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:"Login-page logo (optional)"}),n.jsxs("div",{className:"border border-dashed border-slate-300 rounded-2xl p-3 flex flex-col items-center gap-2",children:[(t==null?void 0:t.login_logo_url)&&n.jsx("img",{src:t.login_logo_url,alt:"Login logo",className:"h-8 w-auto rounded-sm border border-slate-500 bg-white mb-1"}),n.jsxs("label",{className:"w-full",children:[n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs cursor-pointer",children:[n.jsx(x0,{className:"h-4 w-4"}),n.jsx("span",{children:"Choose login logo"})]}),n.jsx(Ee,{type:"file",accept:"image/*",className:"hidden",onChange:H=>{var $;return g((($=H.target.files)==null?void 0:$[0])||null)}})]}),x&&n.jsx("p",{className:"text-[11px] text-slate-500 truncate w-full text-center",children:x.name})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:"Favicon (browser tab icon)"}),n.jsxs("div",{className:"border border-dashed border-slate-300 rounded-2xl p-3 flex flex-col items-center gap-2",children:[(t==null?void 0:t.favicon_url)&&n.jsx("img",{src:t.favicon_url,alt:"Favicon",className:"h-6 w-6 rounded-sm border border-slate-500 bg-white mb-1"}),n.jsxs("label",{className:"w-full",children:[n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs cursor-pointer",children:[n.jsx(x0,{className:"h-4 w-4"}),n.jsx("span",{children:"Choose favicon (PNG / ICO)"})]}),n.jsx(Ee,{type:"file",accept:"image/*,.ico",className:"hidden",onChange:H=>{var $;return v((($=H.target.files)==null?void 0:$[0])||null)}})]}),y&&n.jsx("p",{className:"text-[11px] text-slate-500 truncate w-full text-center",children:y.name})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:"PDF header template (all documents)"}),n.jsxs("div",{className:"border border-dashed border-slate-300 rounded-2xl p-3 flex flex-col items-center gap-2",children:[(t==null?void 0:t.pdf_header_url)&&n.jsx("img",{src:t.pdf_header_url,alt:"PDF header",className:"h-12 w-auto rounded-sm border border-slate-500 bg-white mb-1"}),n.jsxs("label",{className:"w-full",children:[n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs cursor-pointer",children:[n.jsx(x0,{className:"h-4 w-4"}),n.jsx("span",{children:"Choose header image"})]}),n.jsx(Ee,{type:"file",accept:"image/*",className:"hidden",onChange:H=>{var $;return w((($=H.target.files)==null?void 0:$[0])||null)}})]}),j&&n.jsx("p",{className:"text-[11px] text-slate-500 truncate w-full text-center",children:j.name})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:"PDF footer template (all documents)"}),n.jsxs("div",{className:"border border-dashed border-slate-300 rounded-2xl p-3 flex flex-col items-center gap-2",children:[(t==null?void 0:t.pdf_footer_url)&&n.jsx("img",{src:t.pdf_footer_url,alt:"PDF footer",className:"h-12 w-auto rounded-sm border border-slate-500 bg-white mb-1"}),n.jsxs("label",{className:"w-full",children:[n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs cursor-pointer",children:[n.jsx(x0,{className:"h-4 w-4"}),n.jsx("span",{children:"Choose footer image"})]}),n.jsx(Ee,{type:"file",accept:"image/*",className:"hidden",onChange:H=>{var $;return E((($=H.target.files)==null?void 0:$[0])||null)}})]}),S&&n.jsx("p",{className:"text-[11px] text-slate-500 truncate w-full text-center",children:S.name})]})]})]}),n.jsxs("div",{className:"flex items-center justify-between pt-2",children:[n.jsx("p",{className:"text-[11px] text-slate-500 max-w-xl",children:"These logo/header/footer templates will be applied to all PDF downloads (EMR, discharge summary, lab reports, invoices, etc.) to keep NABH-compliant formatting."}),n.jsx(ge,{type:"submit",disabled:c,className:"min-w-[160px]",children:c?"Uploading":"Upload artwork"})]})]}),n.jsxs("form",{onSubmit:R,className:"space-y-4",children:[n.jsx("div",{className:"border-t border-slate-100 pt-4"}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"PDF layout behaviour"}),n.jsx("p",{className:"text-xs text-slate-500",children:'Control reserved space for header/footer and whether to show "Page X of Y" in the footer.'}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Header height (mm)"}),n.jsx(Ee,{type:"number",min:0,value:a.pdf_header_height_mm===""?"":a.pdf_header_height_mm,onChange:T("pdf_header_height_mm"),placeholder:"Auto"}),n.jsx("p",{className:"text-[11px] text-slate-400",children:"Leave blank to auto-calc based on header image."})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Footer height (mm)"}),n.jsx(Ee,{type:"number",min:0,value:a.pdf_footer_height_mm===""?"":a.pdf_footer_height_mm,onChange:T("pdf_footer_height_mm"),placeholder:"Auto"}),n.jsx("p",{className:"text-[11px] text-slate-400",children:"Leave blank to auto-calc based on footer image."})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Page number in footer"}),n.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300",checked:!!a.pdf_show_page_number,onChange:B("pdf_show_page_number")}),n.jsx("span",{children:'Show "Page X of Y" on all PDFs'})]})]})]})]}),n.jsx("div",{className:"flex items-center justify-end pt-1",children:n.jsx(ge,{type:"submit",disabled:l,className:"min-w-[160px]",children:l?"Saving":"Save PDF settings"})})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{className:"text-xs font-medium text-slate-600",children:"Upload Letterhead (PDF / JPG / PNG / DOCX)"}),n.jsxs("div",{className:"border border-dashed p-3 rounded-xl space-y-3",children:[(t==null?void 0:t.letterhead_url)&&n.jsxs("p",{className:"text-xs text-slate-600",children:["Current file:"," ",n.jsx("span",{className:"font-medium",children:t.letterhead_url.split("/").pop()})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-slate-600",children:[n.jsxs("label",{className:"inline-flex items-center gap-1",children:[n.jsx("input",{type:"radio",className:"h-3 w-3",value:"background",checked:I==="background",onChange:H=>P(H.target.value)}),n.jsx("span",{children:"Full-page background"})]}),n.jsxs("label",{className:"inline-flex items-center gap-1",children:[n.jsx("input",{type:"radio",className:"h-3 w-3",value:"none",checked:I==="none",onChange:H=>P(H.target.value)}),n.jsx("span",{children:"Disable letterhead background (use header/footer only)"})]})]}),n.jsx(Ee,{type:"file",accept:"image/*,application/pdf,.doc,.docx",onChange:H=>{var $;return A((($=H.target.files)==null?void 0:$[0])||null)}}),k&&n.jsx("p",{className:"text-xs mt-1 text-slate-600",children:k.name}),n.jsx(ge,{disabled:!k,onClick:F,className:"mt-2",children:"Upload Letterhead"})]})]})]})]})})]})]})}const jB=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function lYe(){const[t,s]=p.useState(null),[r,a]=p.useState("0"),[i,l]=p.useState("09:00"),[o,c]=p.useState("13:00"),[d,u]=p.useState("15"),[m,x]=p.useState([]),[g,y]=p.useState(!1),[v,j]=p.useState(!1),[w,S]=p.useState(null),E=p.useCallback(D=>{s(D)},[]),k=p.useCallback(async()=>{if(!t){x([]);return}try{y(!0);const{data:D}=await Fwe(t);x(D||[])}catch(D){console.error(D),ae.error("Failed to load schedules")}finally{y(!1)}},[t]);p.useEffect(()=>{k()},[k]);const A=async D=>{var B,U,W;if((B=D==null?void 0:D.preventDefault)==null||B.call(D),!t){ae.error("Select doctor first");return}const T=Number(r);if(m.some(V=>V.weekday===T)){ae.error("Schedule for this weekday already exists. Edit / delete existing slot instead.");return}try{j(!0),await Bwe({doctor_user_id:t,weekday:T,start_time:i,end_time:o,slot_minutes:Number(d)||15}),ae.success("Schedule saved"),k()}catch(V){console.error(V),ae.error(((W=(U=V==null?void 0:V.response)==null?void 0:U.data)==null?void 0:W.detail)||"Failed to save schedule")}finally{j(!1)}},I=async D=>{var T,B;if(window.confirm("Delete this schedule slot?"))try{S(D),await $we(D),ae.success("Schedule deleted"),x(U=>U.filter(W=>W.id!==D))}catch(U){console.error(U),ae.error(((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to delete schedule")}finally{S(null)}},P=!!t,O=p.useMemo(()=>`${m.length} weekday slot${m.length===1?"":"s"} configured`,[m.length]);return n.jsx("div",{className:"min-h-[calc(100vh-5rem)] bg-slate-50 px-4 py-6 md:px-6",children:n.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs font-medium uppercase tracking-[0.2em] text-sky-700",children:"OPD Scheduling"}),n.jsx("h1",{className:"mt-1 text-2xl font-semibold text-slate-900",children:"Doctor OPD Schedules"}),n.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Configure weekday-wise OPD timings for each doctor. Duplicate weekday entries are blocked to keep the roster clean."})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"border-b border-slate-100 pb-4",children:n.jsxs(jt,{className:"flex items-center justify-between text-base font-semibold text-slate-900",children:[n.jsx("span",{children:"Schedule Setup"}),n.jsx("span",{className:"text-xs font-normal text-slate-500",children:O})]})}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:"grid gap-4 md:grid-cols-[2fr,1.5fr]",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsx("label",{className:"text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:"Doctor"}),n.jsx(xc,{value:t,onChange:E}),!t&&n.jsx("p",{className:"mt-1 text-[11px] text-amber-600",children:"Select a doctor to view and update OPD schedules."})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"flex items-center gap-1 text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:[n.jsx(Ds,{className:"h-3 w-3"}),"Weekday"]}),n.jsxs(Zs,{value:r,onValueChange:a,children:[n.jsx(Ws,{className:"h-9 text-sm",children:n.jsx(Js,{placeholder:"Select weekday"})}),n.jsx(qs,{children:jB.map((D,T)=>n.jsx(Ut,{value:String(T),children:D},T))})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"flex items-center gap-1 text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:[n.jsx(jn,{className:"h-3 w-3"}),"Start"]}),n.jsx(Ee,{type:"time",value:i,onChange:D=>l(D.target.value),className:"h-9 text-sm"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"flex items-center gap-1 text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:[n.jsx(jn,{className:"h-3 w-3"}),"End"]}),n.jsx(Ee,{type:"time",value:o,onChange:D=>c(D.target.value),className:"h-9 text-sm"})]})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr,auto] md:items-end",children:[n.jsxs("div",{className:"space-y-1.5 max-w-xs",children:[n.jsx("label",{className:"text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:"Slot duration (minutes)"}),n.jsx(Ee,{type:"number",min:5,step:5,value:d,onChange:D=>u(D.target.value),className:"h-9 text-sm"}),n.jsx("p",{className:"mt-1 text-[11px] text-slate-400",children:"Used when generating appointment slots (e.g., 10 / 15 / 20)."})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(ge,{type:"button",className:"px-5",disabled:!P||v,onClick:A,children:v?"Saving":"Add Weekday Slot"})})]})]})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"border-b border-slate-100 pb-3",children:n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Existing Schedules"})}),n.jsxs(it,{className:"pt-4",children:[g&&n.jsx("div",{className:"space-y-2",children:[1,2,3].map(D=>n.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-slate-100 bg-slate-50 px-3 py-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-4 w-40"}),n.jsx(Qe,{className:"h-3 w-24"})]}),n.jsx(Qe,{className:"h-8 w-8 rounded-full"})]},D))}),!g&&(!m||m.length===0)&&n.jsx("p",{className:"py-6 text-sm text-slate-500",children:"No schedules configured yet for this doctor."}),!g&&m&&m.length>0&&n.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:m.map(D=>{var T,B;return n.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-slate-500 bg-white px-3 py-3 text-sm shadow-sm",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:n.jsxs("span",{className:"font-semibold text-slate-900",children:[jB[D.weekday]," "," ",(T=D.start_time)==null?void 0:T.slice(0,5),"",(B=D.end_time)==null?void 0:B.slice(0,5)]})}),n.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsxs(et,{variant:"outline",className:"border-slate-500 bg-slate-50 px-2 py-0.5 text-[11px]",children:["Slot: ",D.slot_minutes||15," min"]}),D.location&&n.jsx(et,{variant:"outline",className:"border-slate-500 bg-slate-50 px-2 py-0.5 text-[11px]",children:D.location})]})]}),n.jsx(ge,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-rose-600",onClick:()=>I(D.id),disabled:w===D.id,children:n.jsx(Ms,{className:"h-4 w-4"})})]},D.id)})})]})]})]})})}const oYe=()=>new Date().toISOString().slice(0,10);function hr(...t){return t.filter(Boolean).join(" ")}function cx(t){if(!t)return"";const s=String(t).trim();return!s||s===""?"":s.length>=5?s.slice(0,5):s}function cg(t){const s=cx(t);if(!s||!s.includes(":"))return 0;const[r,a]=s.split(":");return Number(r||0)*60+Number(a||0)}function r5(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-IN",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})}catch{return t}}function vv(t,s){const r=new Date(t);return r.setDate(r.getDate()+s),r.toISOString().slice(0,10)}function cYe(t){if(!t)return"";try{const s=new Date(t);if(Number.isNaN(s.getTime()))return"";const r=new Date;let a=r.getFullYear()-s.getFullYear();const i=r.getMonth()-s.getMonth();return(i<0||i===0&&r.getDate()<s.getDate())&&(a-=1),a>=0&&a<130?String(a):""}catch{return""}}function dYe(t){if(!t)return"";const s=t.prefix?`${t.prefix} `:"",r=t.first_name||t.firstname||"",a=t.last_name||t.lastname||"";return(t.full_name||t.name||""||`${s}${r} ${a}`.trim()||"").replace(/\s+/g," ").trim()}function Qse(t){const s=String(t||"").trim();return s?s.split(" ").filter(Boolean).slice(0,2).map(r=>{var a;return(a=r[0])==null?void 0:a.toUpperCase()}).join(""):"P"}function NB(t){return typeof t=="string"?!0:(t==null?void 0:t.status)==="free"||!(t!=null&&t.status)}function F0(t){return t?cx(typeof t=="string"?t:(t==null?void 0:t.start)||(t==null?void 0:t.slot_start)||""):""}function uYe(t){return!t||typeof t=="string"?"":cx((t==null?void 0:t.end)||(t==null?void 0:t.slot_end)||"")}function mYe(t){const s=cg(t);return s<12*60?"Morning":s<17*60?"Afternoon":"Evening"}const hYe={booked:"Booked",checked_in:"Checked-in",in_progress:"In progress",completed:"Completed",no_show:"No-show",cancelled:"Cancelled"};function Zse(t){switch(String(t||"booked").toLowerCase()){case"booked":return{ring:"ring-slate-200/70",tint:"from-slate-50 to-white",border:"border-black/10",pill:"border-slate-200 bg-slate-50 text-slate-700",icon:n.jsx(jn,{className:"h-4 w-4 text-slate-700"}),bar:"bg-slate-300"};case"checked_in":return{ring:"ring-sky-200/70",tint:"from-sky-50 to-white",border:"border-sky-200/60",pill:"border-sky-200 bg-sky-50 text-sky-900",icon:n.jsx(QE,{className:"h-4 w-4 text-sky-800"}),bar:"bg-sky-400"};case"in_progress":return{ring:"ring-amber-200/70",tint:"from-amber-50 to-white",border:"border-amber-200/70",pill:"border-amber-200 bg-amber-50 text-amber-950",icon:n.jsx(i2,{className:"h-4 w-4 text-amber-900"}),bar:"bg-amber-400"};case"completed":return{ring:"ring-emerald-200/70",tint:"from-emerald-50 to-white",border:"border-emerald-200/70",pill:"border-emerald-200 bg-emerald-50 text-emerald-950",icon:n.jsx(Xt,{className:"h-4 w-4 text-emerald-800"}),bar:"bg-emerald-400"};case"no_show":return{ring:"ring-rose-200/70",tint:"from-rose-50 to-white",border:"border-rose-200/70",pill:"border-rose-200 bg-rose-50 text-rose-950",icon:n.jsx(en,{className:"h-4 w-4 text-rose-800"}),bar:"bg-rose-400"};case"cancelled":return{ring:"ring-slate-200/70",tint:"from-slate-100 to-white",border:"border-black/10",pill:"border-slate-200 bg-slate-100 text-slate-600",icon:n.jsx(ca,{className:"h-4 w-4 text-slate-600"}),bar:"bg-slate-300"};default:return{ring:"ring-slate-200/70",tint:"from-slate-50 to-white",border:"border-black/10",pill:"border-slate-200 bg-slate-50 text-slate-700",icon:n.jsx(jn,{className:"h-4 w-4 text-slate-700"}),bar:"bg-slate-300"}}}const ta={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",stickyTop:" top-0 z-30",container:"px-4 py-5 md:px-8 md:py-8",glass:"rounded-3xl border border-black/10 bg-white/75 backdrop-blur-xl shadow-[0_14px_42px_rgba(2,6,23,0.08)]",chip:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",pillBtn:"inline-flex items-center gap-2 rounded-full border border-black/10 bg-white/85 px-3 py-1.5 text-[11px] font-semibold text-slate-700 hover:bg-black/[0.03] active:scale-[0.99] transition disabled:opacity-60 disabled:cursor-not-allowed",input:"w-full rounded-2xl border border-black/10 bg-white/90 px-3 py-2 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"},wB={initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18}};function a5({value:t,onChange:s,tabs:r,layoutId:a}){return n.jsx("div",{className:"inline-flex items-center rounded-full border border-black/10 bg-white/85 p-1 shadow-[0_8px_22px_rgba(2,6,23,0.08)]",children:r.map(i=>{const l=t===i.key;return n.jsxs("button",{type:"button",onClick:()=>s(i.key),className:hr("relative px-3 sm:px-4 py-1.5 rounded-full text-[12px] font-semibold transition",l?"text-white":"text-slate-700 hover:bg-black/[0.03]"),children:[l&&n.jsx(mt.span,{layoutId:a,className:"absolute inset-0 rounded-full bg-slate-900",transition:{type:"spring",stiffness:300,damping:26}}),n.jsx("span",{className:"relative z-10",children:i.label})]},i.key)})})}function _B({title:t,subtitle:s,icon:r}){return n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/15 bg-black/[0.02] px-5 py-7 text-center",children:[r?n.jsx("div",{className:"mx-auto mb-3 h-10 w-10 rounded-3xl border border-black/10 bg-white/70 grid place-items-center",children:r}):null,n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:t}),s?n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:s}):null]})}function Jse({status:t}){const s=String(t||"booked").toLowerCase(),r=Zse(s);return n.jsxs("span",{className:hr("inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] font-semibold",r.pill),children:[r.icon,hYe[s]||s]})}function xYe({active:t,label:s,onClick:r}){return n.jsx("button",{type:"button",onClick:r,className:hr("whitespace-nowrap rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",t?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/10 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:s})}function pYe({mode:t}){const s=String(t||"").toLowerCase(),r=s==="free"||s==="token";return n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700",children:[r?n.jsx(rj,{className:"h-3.5 w-3.5 text-slate-500"}):n.jsx(jn,{className:"h-3.5 w-3.5 text-slate-500"}),r?"Free":"Slot"]})}function fYe({a:t,onStatus:s}){var w,S,E;const r=String((t==null?void 0:t.status)||"booked").toLowerCase(),a=Zse(r),i=(t==null?void 0:t.patient_name)||((w=t==null?void 0:t.patient)==null?void 0:w.name)||"",l=(t==null?void 0:t.uhid)||(t==null?void 0:t.patient_uhid)||((S=t==null?void 0:t.patient)==null?void 0:S.uhid)||"",o=(t==null?void 0:t.patient_phone)||(t==null?void 0:t.phone)||((E=t==null?void 0:t.patient)==null?void 0:E.phone)||"",c=String((t==null?void 0:t.appointment_type)||"").toLowerCase(),d=cx(t==null?void 0:t.slot_start),u=cx(t==null?void 0:t.slot_end),x=!!d?`${d}${u?`${u}`:""}`:"FREE",g=Number((t==null?void 0:t.queue_no)||0)||null,y=g?String(g):"",v=(t==null?void 0:t.department_name)||"",j=(t==null?void 0:t.doctor_name)||"";return n.jsx(mt.div,{layout:!0,initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:hr("rounded-3xl border overflow-hidden shadow-[0_10px_24px_rgba(2,6,23,0.07)]",a.border),children:n.jsxs("div",{className:hr("relative bg-gradient-to-b",a.tint),children:[n.jsx("div",{className:hr("absolute left-0 top-0 h-full w-1.5",a.bar)}),n.jsx("div",{className:"p-4",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0 flex items-start gap-4",children:[n.jsx("div",{className:hr("shrink-0 rounded-3xl border border-black/10 bg-white/80 ring-1",a.ring),children:n.jsxs("div",{className:"px-4 py-3 text-center",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Token"}),n.jsx("div",{className:"mt-1 text-4xl md:text-5xl font-extrabold tabular-nums text-slate-900 leading-none",children:y})]})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-black/10 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700 tabular-nums",children:[n.jsx(jn,{className:"h-3.5 w-3.5 text-slate-500"}),x]}),n.jsx(Jse,{status:r}),c?n.jsx(pYe,{mode:c}):null,o?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx(ad,{className:"h-3.5 w-3.5 text-slate-500"}),o]}):null]}),n.jsxs("div",{className:"mt-2 flex items-start gap-3 min-w-0",children:[n.jsx("div",{className:"inline-flex h-11 w-11 shrink-0 items-center justify-center rounded-3xl border border-black/10 bg-white/80 text-[12px] font-semibold text-slate-800",children:Qse(i)}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"truncate text-[14px] font-semibold text-slate-900",children:i}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID"," ",n.jsx("span",{className:"font-semibold text-slate-700",children:l})]})]}),n.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:[v?`${v}  `:"",j?`Dr. ${j}  `:"","Purpose:"," ",n.jsx("span",{className:"font-semibold text-slate-700",children:(t==null?void 0:t.purpose)||"Consultation"})]})]})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[r==="booked"&&n.jsxs(n.Fragment,{children:[n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>s(t,"checked_in"),children:[n.jsx(QE,{className:"mr-2 h-4 w-4"}),"Check-in"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>s(t,"no_show"),children:[n.jsx(en,{className:"mr-2 h-4 w-4"}),"No-show"]})]}),r==="checked_in"&&n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>s(t,"in_progress",{goToVisit:!0}),children:[n.jsx(i2,{className:"mr-2 h-4 w-4"}),"Start visit"]}),r==="in_progress"&&n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>s(t,"completed"),children:[n.jsx(Xt,{className:"mr-2 h-4 w-4"}),"Complete"]}),(r==="booked"||r==="checked_in")&&n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>s(t,"cancelled"),children:[n.jsx(ca,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]})})]})})}function gYe(){const t=Qr(),s=p.useMemo(()=>oYe(),[]),[r,a]=p.useState("list"),[i,l]=p.useState("today"),[o,c]=p.useState(s),d=p.useMemo(()=>i==="today"?s:o,[i,s,o]),[u,m]=p.useState([]),[x,g]=p.useState(!1),[y,v]=p.useState(""),[j,w]=p.useState(""),[S,E]=p.useState("all"),[k,A]=p.useState("all"),[I,P]=p.useState("all"),[O,D]=p.useState("all"),[T,B]=p.useState([]),[U,W]=p.useState([]),[V,R]=p.useState(!1),[F,G]=p.useState(!1),[H,$]=p.useState("free"),[K,le]=p.useState(s),[se,J]=p.useState("Consultation"),[ie,te]=p.useState(null),[ne,q]=p.useState(null),[ee,X]=p.useState(null),[Z,Y]=p.useState(null),[Q,oe]=p.useState([]),[_e,xe]=p.useState(""),[me,Re]=p.useState(!1),[Ze,$e]=p.useState(!1);p.useEffect(()=>{const Fe=setTimeout(()=>w(y.trim()),300);return()=>clearTimeout(Fe)},[y]),p.useEffect(()=>{let Fe=!0;return R(!0),nP().then(ot=>{Fe&&B((ot==null?void 0:ot.data)||[])}).catch(()=>{Fe&&B([])}).finally(()=>{Fe&&R(!1)}),()=>{Fe=!1}},[]),p.useEffect(()=>{let Fe=!0;const ot=I!=="all"?Number(I):null;if(D("all"),W([]),!!ot)return G(!0),rP({departmentId:ot,isDoctor:!0}).then(ft=>{Fe&&W((ft==null?void 0:ft.data)||[])}).catch(()=>{Fe&&W([])}).finally(()=>{Fe&&G(!1)}),()=>{Fe=!1}},[I]);const fe=p.useCallback(async()=>{try{g(!0);const Fe={date:d,department_id:I!=="all"?Number(I):void 0,doctor_id:O!=="all"?Number(O):void 0,appointment_type:k!=="all"?k:void 0,q:j||void 0},{data:ot}=await Uwe(Fe);m(ot||[])}catch{m([])}finally{g(!1)}},[d,I,O,k,j]);p.useEffect(()=>{fe()},[fe]),p.useEffect(()=>{r==="book"&&le(d)},[r,d]);const Me=async()=>{await fe()},Ae=p.useMemo(()=>{const Fe={all:u.length,booked:0,checked_in:0,in_progress:0,completed:0,cancelled:0,no_show:0};for(const ot of u||[]){const ft=String((ot==null?void 0:ot.status)||"").toLowerCase();Fe[ft]!==void 0&&(Fe[ft]+=1)}return Fe},[u]),Ke=p.useMemo(()=>[{key:"all",label:`All (${Ae.all})`},{key:"booked",label:`Booked (${Ae.booked})`},{key:"checked_in",label:`Checked-in (${Ae.checked_in})`},{key:"in_progress",label:`In progress (${Ae.in_progress})`},{key:"completed",label:`Completed (${Ae.completed})`},{key:"no_show",label:`No-show (${Ae.no_show})`},{key:"cancelled",label:`Cancelled (${Ae.cancelled})`}],[Ae]),Le=p.useMemo(()=>{const Fe=String(S||"all").toLowerCase();return(u||[]).filter(ot=>{const ft=String((ot==null?void 0:ot.status)||"booked").toLowerCase();return!(Fe!=="all"&&ft!==Fe)}).sort((ot,ft)=>{const ce=Number((ot==null?void 0:ot.queue_no)||0),Ce=Number((ft==null?void 0:ft.queue_no)||0);if(ce!==Ce)return ce-Ce;const ze=cg(ot==null?void 0:ot.slot_start),Te=cg(ft==null?void 0:ft.slot_start);return ze!==Te?ze-Te:Number((ot==null?void 0:ot.id)||0)-Number((ft==null?void 0:ft.id)||0)})},[u,S]),He=p.useMemo(()=>{if(!ie)return null;const Fe=dYe(ne)||`Selected patient #${ie}`,ot=ne!=null&&ne.uhid?String(ne.uhid):"",ft=(ne==null?void 0:ne.dob)||(ne==null?void 0:ne.date_of_birth)||"",ce=cYe(ft),Ce=(ne==null?void 0:ne.sex)??(ne==null?void 0:ne.gender),ze=Ce?String(Ce).toUpperCase():"",Te=(ne==null?void 0:ne.phone)||(ne==null?void 0:ne.mobile)||"";return{nm:Fe,uhid:ot,age:ce,sex:ze,phone:Te}},[ie,ne]),pt=(Fe,ot)=>{const ft=Fe?Number(Fe):null;te(ft),q(ot||null)},Pe=p.useMemo(()=>{const Fe=new Map;for(const ot of u||[]){const ft=cx(ot==null?void 0:ot.slot_start);ft&&Fe.set(ft,ot)}return Fe},[u]),bt=p.useCallback(async()=>{if(H==="slot"&&!(!Z||!K))try{Re(!0);const{data:Fe}=await Rwe({doctor_user_id:Number(Z),date:K,detailed:!0}),ot=Array.isArray(Fe)?Fe:(Fe==null?void 0:Fe.slots)||[];oe(ot||[])}catch{oe([])}finally{Re(!1)}},[H,Z,K]);p.useEffect(()=>{if(H==="free"){oe([]),xe(""),Re(!1);return}bt()},[H,bt]),p.useEffect(()=>{xe("")},[Z,K]);const It=p.useMemo(()=>(Q||[]).filter(Fe=>{const ot=F0(Fe),ft=Pe.get(ot);return NB(Fe)&&!ft}),[Q,Pe]),De=p.useMemo(()=>[...Ze?Q||[]:It].sort((ot,ft)=>cg(F0(ot))-cg(F0(ft))),[Q,It,Ze]),tt=p.useMemo(()=>{const Fe={Morning:[],Afternoon:[],Evening:[]};for(const ot of De){const ft=F0(ot);Fe[mYe(ft)].push(ot)}return Fe},[De]),ve=p.useMemo(()=>!ie||!ee||!Z||!K?!1:H==="slot"?!!_e:!0,[ie,ee,Z,K,H,_e]),Ge=async Fe=>{var ot;if((ot=Fe==null?void 0:Fe.preventDefault)==null||ot.call(Fe),!ie)return ae.error("Please select a patient");if(!ee)return ae.error("Please select a department");if(!Z)return ae.error("Please select a doctor");if(H==="slot"&&!_e)return ae.error("Please choose a time slot");try{const ft={patient_id:Number(ie),department_id:Number(ee),doctor_user_id:Number(Z),date:K,purpose:se||"Consultation",appointment_type:H};H==="slot"&&(ft.slot_start=_e);const{data:ce}=await zwe(ft),Ce=ce!=null&&ce.queue_no?`Token #${ce.queue_no}`:"Token created";ae.success(`${H==="free"?"Free booking":"Slot booking"} done  ${Ce}`),xe(""),a("list"),l(K===s?"today":"date"),c(K),await fe()}catch{}},We=async(Fe,ot,ft={})=>{const ce=Fe==null?void 0:Fe.id;if(ce)try{const{data:Ce}=await jG(ce,ot);if(ae.success(`Status updated to ${String((Ce==null?void 0:Ce.status)||ot).toUpperCase()}`),ft.goToVisit&&(Ce!=null&&Ce.visit_id)){t(`/opd/visit/${Ce.visit_id}`);return}await fe()}catch{}},Ve=p.useMemo(()=>[{key:"list",label:"All Appointments"},{key:"book",label:"New Booking"}],[]);return n.jsxs("div",{className:ta.page,children:[n.jsx("div",{className:ta.stickyTop,children:n.jsx("div",{className:"px-4 py-4 md:px-8",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:ta.chip,children:[n.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-500 animate-pulse"}),"Live OPD  Appointments"]}),n.jsxs("span",{className:ta.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),r5(d)]}),n.jsxs("span",{className:ta.chip,children:[n.jsx(jr,{className:"h-3.5 w-3.5"}),"Showing ",n.jsx("span",{className:"tabular-nums",children:Le.length})]}),x?n.jsxs("span",{className:ta.chip,children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"}),"Loading"]}):null]}),n.jsx("h1",{className:"mt-2 text-[18px] md:text-[22px] font-semibold tracking-tight text-slate-900",children:"OPD Appointments"}),n.jsx("p",{className:"mt-1 text-[12px] md:text-[13px] text-slate-600",children:"All appointments are visible. Use filters for department / doctor / free-slot / status."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:Me,className:hr(ta.pillBtn,"h-10"),disabled:x||V||F||me,title:"Refresh",children:[n.jsx(ps,{className:hr("h-4 w-4",(x||V)&&"animate-spin")}),"Refresh"]}),n.jsx(a5,{value:r,onChange:Fe=>a(Fe),tabs:Ve,layoutId:"seg-page"})]})]}),r==="list"&&n.jsxs("div",{className:"rounded-3xl border border-black/10 bg-white/70 backdrop-blur-xl shadow-[0_10px_28px_rgba(2,6,23,0.06)] px-4 py-3",children:[n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(a5,{value:i,onChange:Fe=>{l(Fe),Fe==="today"&&c(s)},tabs:[{key:"today",label:"Today"},{key:"date",label:"Schedule Date"}],layoutId:"seg-scope"}),i==="date"&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>c(Fe=>vv(Fe,-1)),children:[n.jsx(Hl,{className:"h-4 w-4 mr-1"}),"Prev"]}),n.jsx(Ee,{type:"date",value:o,onChange:Fe=>c(Fe.target.value),className:"h-10 rounded-2xl border-black/10 bg-white/90 w-[170px]"}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>c(Fe=>vv(Fe,1)),children:["Next",n.jsx(Ki,{className:"h-4 w-4 ml-1"})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"relative w-full sm:w-[320px]",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{value:y,onChange:Fe=>v(Fe.target.value),placeholder:"Search name / UHID / token / doctor / dept",className:hr(ta.input,"pl-10 h-10")})]}),n.jsxs(ge,{type:"button",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>a("book"),children:[n.jsx(rj,{className:"mr-2 h-4 w-4"}),"New Booking"]})]})]}),n.jsx(vr,{className:"bg-black/10 my-3"}),n.jsxs("div",{className:"grid gap-3 lg:grid-cols-12",children:[n.jsxs("div",{className:"lg:col-span-3",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Department"}),n.jsxs("div",{className:"relative",children:[V&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{value:I,onChange:Fe=>P(Fe.target.value),className:hr(ta.input,"h-10"),disabled:V,children:[n.jsx("option",{value:"all",children:V?"Loading":"All departments"}),(T||[]).map(Fe=>n.jsx("option",{value:String(Fe.id),children:Fe.name},Fe.id))]})]})]}),n.jsxs("div",{className:"lg:col-span-3",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Doctor"}),n.jsxs("div",{className:"relative",children:[F&&n.jsx(Rt,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 animate-spin text-slate-400"}),n.jsxs("select",{value:O,onChange:Fe=>D(Fe.target.value),className:hr(ta.input,"h-10"),disabled:I==="all"||F,children:[n.jsx("option",{value:"all",children:I==="all"?"Select department first":F?"Loading doctors":"All doctors (within dept)"}),(U||[]).map(Fe=>n.jsx("option",{value:String(Fe.id),children:Fe.name},Fe.id))]})]})]}),n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Mode"}),n.jsxs("select",{value:k,onChange:Fe=>A(Fe.target.value),className:hr(ta.input,"h-10"),children:[n.jsx("option",{value:"all",children:"All"}),n.jsx("option",{value:"free",children:"Free (Token)"}),n.jsx("option",{value:"slot",children:"Slot"})]})]}),n.jsxs("div",{className:"lg:col-span-4 flex items-end justify-end gap-2",children:[n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>{v(""),w(""),E("all"),A("all"),P("all"),D("all")},children:[n.jsx(ca,{className:"mr-2 h-4 w-4"}),"Reset filters"]}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:fe,disabled:x,children:[n.jsx(ps,{className:hr("mr-2 h-4 w-4",x&&"animate-spin")}),"Reload"]})]})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Status"}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/10 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:Le.length})]})]}),n.jsx("div",{className:"mt-2 flex items-center gap-1.5 overflow-auto no-scrollbar py-1",children:Ke.map(Fe=>n.jsx(xYe,{label:Fe.label,active:S===Fe.key,onClick:()=>E(Fe.key)},Fe.key))})]})]})})}),n.jsx("div",{className:ta.container,children:n.jsxs(on,{initial:!1,children:[r==="list"&&n.jsx(mt.div,{...wB,className:"space-y-3",children:n.jsxs(dt,{className:hr(ta.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/10 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx(jt,{className:"text-[15px] font-semibold text-slate-900",children:"All appointments"}),n.jsxs(gs,{className:"text-[12px] text-slate-600",children:["Date: ",n.jsx("span",{className:"font-semibold",children:r5(d)})]})]}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/10 bg-white/85 text-[11px] font-semibold text-slate-700",children:[n.jsx($n,{className:"h-3.5 w-3.5 mr-1"}),"Premium Cards"]})]})}),n.jsxs(it,{className:"pt-4",children:[x&&n.jsx("div",{className:"space-y-3",children:[0,1,2,3].map(Fe=>n.jsx("div",{className:"rounded-3xl border border-black/10 bg-white/70 px-4 py-4",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-48 rounded-xl"}),n.jsx(Qe,{className:"h-3 w-80 rounded-xl"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Qe,{className:"h-10 w-24 rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-24 rounded-2xl"})]})]})},Fe))}),!x&&Le.length===0&&n.jsx(_B,{icon:n.jsx(jr,{className:"h-5 w-5 text-slate-700"}),title:"No appointments found",subtitle:"Try changing date or filters."}),!x&&Le.length>0&&n.jsx(Fn,{className:"max-h-[72vh] pr-1",children:n.jsx("div",{className:"space-y-2",children:Le.map(Fe=>n.jsx(fYe,{a:Fe,onStatus:We},Fe==null?void 0:Fe.id))})})]})]})},"list"),r==="book"&&n.jsx(mt.div,{...wB,className:"space-y-4",children:n.jsxs(dt,{className:hr(ta.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/10 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx(jt,{className:"text-[15px] font-semibold text-slate-900",children:"New appointment booking"}),n.jsxs(gs,{className:"text-[12px] text-slate-600",children:["Flow: ",n.jsx("span",{className:"font-semibold",children:"Patient  Department  Doctor  Free/Slot"})]})]}),n.jsx("div",{className:"flex flex-wrap items-center gap-2 md:justify-end",children:n.jsx(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>a("list"),children:"Back to list"})})]})}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:hr(ta.chip,ie?"border-emerald-200 bg-emerald-50 text-emerald-800":""),children:[ie?n.jsx(So,{className:"h-3.5 w-3.5"}):n.jsx(wa,{className:"h-3.5 w-3.5"}),"Step 1  Patient"]}),n.jsxs("span",{className:hr(ta.chip,ee?"border-emerald-200 bg-emerald-50 text-emerald-800":""),children:[ee?n.jsx(So,{className:"h-3.5 w-3.5"}):n.jsx(jr,{className:"h-3.5 w-3.5"}),"Step 2  Department"]}),n.jsxs("span",{className:hr(ta.chip,Z?"border-emerald-200 bg-emerald-50 text-emerald-800":""),children:[Z?n.jsx(So,{className:"h-3.5 w-3.5"}):n.jsx(Hs,{className:"h-3.5 w-3.5"}),"Step 3  Doctor"]}),n.jsxs("span",{className:ta.chip,children:[n.jsx(rj,{className:"h-3.5 w-3.5"}),"Step 4  ",H==="free"?"Free (Token)":"Slot"]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Appointment Date"}),n.jsx(Ee,{type:"date",value:K,onChange:Fe=>le(Fe.target.value),className:"h-11 rounded-2xl border-black/10 bg-white/90"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(ge,{type:"button",variant:"outline",className:"h-9 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>le(Fe=>vv(Fe,-1)),children:[n.jsx(Hl,{className:"h-4 w-4 mr-1"}),"Prev"]}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-9 rounded-2xl border-black/10 bg-white/85 font-semibold",onClick:()=>le(Fe=>vv(Fe,1)),children:["Next",n.jsx(Ki,{className:"h-4 w-4 ml-1"})]})]})]}),n.jsxs("div",{className:"space-y-1.5 md:col-span-2",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Booking Mode"}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsx(a5,{value:H,onChange:Fe=>$(Fe),tabs:[{key:"free",label:"Free Booking (Token)"},{key:"slot",label:"Time Slot Booking"}],layoutId:"seg-book-mode"}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:["Default is ",n.jsx("span",{className:"font-semibold text-slate-700",children:"Free"})]})]}),n.jsxs("div",{className:"space-y-1.5 mt-3",children:[n.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"Purpose"}),n.jsx(Ee,{value:se,onChange:Fe=>J(Fe.target.value),placeholder:"Consultation / Review / Procedure",className:"h-11 rounded-2xl border-black/10 bg-white/90"})]})]})]}),n.jsxs("div",{className:"rounded-3xl border border-black/10 bg-black/[0.02] p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Step 1  Select patient"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Pick patient first (mandatory)"})]}),He?n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-black/10 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),He.nm]}):null]}),n.jsx("div",{className:"mt-3",children:n.jsx(W2,{value:ie,onChange:pt})}),He&&n.jsx("div",{className:"mt-3 rounded-3xl border border-black/10 bg-white/80 p-4",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900 truncate",children:He.nm}),n.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[11px] text-slate-600",children:[He.uhid?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-2.5 py-1",children:[n.jsx(jo,{className:"h-3.5 w-3.5 text-slate-500"}),"UHID ",n.jsx("span",{className:"font-semibold text-slate-800",children:He.uhid})]}):null,He.age||He.sex?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-2.5 py-1",children:[n.jsx(en,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsxs("span",{className:"font-semibold text-slate-800",children:[He.age?`${He.age}y`:"",He.age&&He.sex?"  ":"",He.sex||""]})]}):null,He.phone?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/10 bg-white/85 px-2.5 py-1",children:[n.jsx(ad,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"font-semibold text-slate-800",children:He.phone})]}):null]})]}),n.jsx("div",{className:"h-11 w-11 rounded-3xl border border-black/10 bg-black/[0.03] grid place-items-center text-[12px] font-semibold text-slate-800",children:Qse(He.nm)})]})})]}),n.jsxs("div",{className:"rounded-3xl border border-black/10 bg-black/[0.02] p-4",children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900 mb-2",children:"Step 2 & 3  Department and Doctor"}),n.jsx(xc,{value:Z,label:"OPD Booking  Department  Doctor",onChange:(Fe,ot)=>{Y(Fe?Number(Fe):null),X(ot!=null&&ot.department_id?Number(ot.department_id):null)}}),n.jsxs("div",{className:"mt-2 text-[11px] text-slate-500",children:["Selected Dept ID: ",n.jsx("span",{className:"font-semibold text-slate-800",children:ee||""}),"  Selected Doctor ID: ",n.jsx("span",{className:"font-semibold text-slate-800",children:Z||""})]})]}),H==="slot"&&n.jsxs("div",{className:"rounded-3xl border border-black/10 bg-black/[0.02] p-4",children:[n.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[13px] font-semibold text-slate-900",children:"Step 4  Select time slot"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:Z?`${It.length} free slot(s) available`:"Pick doctor first"})]}),n.jsxs("button",{type:"button",onClick:()=>$e(Fe=>!Fe),className:hr(ta.pillBtn,"h-9"),disabled:!Z,children:[Ze?n.jsx(Xt,{className:"h-4 w-4"}):n.jsx(ca,{className:"h-4 w-4"}),Ze?"All slots":"Free only"]})]}),n.jsx("div",{className:"mt-3",children:Z?me?n.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:12}).map((Fe,ot)=>n.jsx(Qe,{className:"h-9 w-24 rounded-full bg-slate-100"},ot))}):De.length===0?n.jsx("div",{className:"rounded-3xl border border-amber-200 bg-amber-50 px-4 py-3 text-[12px] text-amber-950",children:"No slots available. Try another date/doctor."}):n.jsx("div",{className:"space-y-4",children:["Morning","Afternoon","Evening"].map(Fe=>{const ot=tt[Fe]||[];return ot.length?n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsx("div",{className:"text-[11px] font-semibold text-slate-600 uppercase tracking-wide",children:Fe})}),n.jsx("div",{className:"flex flex-wrap gap-2",children:ot.map((ft,ce)=>{const Ce=F0(ft),ze=uYe(ft),Te=Pe.get(Ce),Nt=NB(ft)&&!Te,Jt=_e===Ce;return n.jsxs("button",{type:"button",disabled:!Nt,onClick:()=>Nt&&xe(Ce),className:hr("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-[12px] font-semibold transition",Nt?Jt?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/10 bg-white/85 text-slate-700 hover:bg-black/[0.03]":"border-black/10 bg-slate-100 text-slate-500 cursor-not-allowed opacity-80"),children:[n.jsx(jn,{className:hr("h-4 w-4",Jt?"text-white":"text-slate-500")}),n.jsxs("span",{className:"tabular-nums",children:[Ce,ze?`${ze}`:""]}),!Nt&&Te?n.jsx("span",{className:"ml-1",children:n.jsx(Jse,{status:String(Te.status||"booked").toLowerCase()})}):null]},`${Fe}-${Ce}-${ce}`)})})]},Fe):null})}):n.jsx(_B,{title:"Pick a doctor first",subtitle:"Then slots will load instantly.",icon:n.jsx(jn,{className:"h-5 w-5 text-slate-700"})})})]}),n.jsxs("form",{onSubmit:Ge,className:"rounded-3xl border border-black/10 bg-white/80 p-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[12px] font-semibold text-slate-900",children:"Booking preview"}),n.jsxs("div",{className:"mt-1 text-[11px] text-slate-600",children:[He?He.nm:"Select patient"," "," ",ee?`Dept #${ee}`:"Select department"," "," ",Z?`Doctor #${Z}`:"Select doctor"," "," ",n.jsx("span",{className:"font-semibold text-slate-800",children:r5(K)})," "," ",n.jsx("span",{className:"font-semibold text-slate-800",children:H==="free"?"Free (Token)":_e?`Slot ${_e}`:"Select slot"})]})]}),n.jsxs(ge,{type:"submit",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold px-6",disabled:!ve,children:[H==="free"?n.jsx(rj,{className:"mr-2 h-4 w-4"}):n.jsx(Xt,{className:"mr-2 h-4 w-4"}),H==="free"?"Book (Token)":"Book (Slot)"]})]}),!ve&&n.jsxs("div",{className:"mt-2 text-[11px] text-slate-500",children:["Required: patient + department + doctor",H==="slot"?" + slot":"","."]})]})]})]})},"book")]})})]})}const bYe=()=>new Date().toISOString().slice(0,10),yYe={booked:"Booked",checked_in:"Checked-in",in_progress:"In progress",completed:"Completed",no_show:"No-show",cancelled:"Cancelled"},vYe=[{key:"active",label:"Active"},{key:"all",label:"All"},{key:"booked",label:"Booked"},{key:"checked_in",label:"Checked-in"},{key:"in_progress",label:"In progress"},{key:"completed",label:"Completed"},{key:"no_show",label:"No-show"},{key:"cancelled",label:"Cancelled"}],jYe=[{key:"clinical",label:"Clinical"},{key:"queue",label:"Queue#"},{key:"time",label:"Time"},{key:"waiting",label:"Waiting"}];function Ua(...t){return t.filter(Boolean).join(" ")}const Wo={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-slate-900 px-3 py-1.5 text-[11px] font-semibold text-white hover:bg-slate-800 active:scale-[0.99] transition",input:"h-11 w-full rounded-2xl border border-black/50 bg-white/85 px-3 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"};function NYe(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-IN",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})}catch{return t}}function wYe(t){return t===new Date().toISOString().slice(0,10)}function Jx(t,s){if(!(t!=null&&t.time)||!["booked","checked_in","in_progress"].includes(t.status)||!wYe(s))return null;try{const r=new Date,a=new Date(`${s}T${t.time}:00`),i=r.getTime()-a.getTime();return Math.max(0,Math.floor(i/(1e3*60)))}catch{return null}}function _Ye(t,s){const r=Jx(t,s);if(r===null)return null;if(r<=0)return"0 min";if(r<60)return`${r} min`;const a=Math.floor(r/60),i=r%60;return a>=5?`${a} hrs+`:i===0?`${a} hr${a>1?"s":""}`:`${a}h ${i}m`}function SYe(t){const s="rounded-full border px-2.5 py-1 text-[11px] font-semibold";switch(t){case"booked":return Ua(s,"border-slate-500 bg-slate-50 text-slate-700");case"checked_in":return Ua(s,"border-sky-200 bg-sky-50 text-sky-800");case"in_progress":return Ua(s,"border-amber-200 bg-amber-50 text-amber-800");case"completed":return Ua(s,"border-emerald-200 bg-emerald-50 text-emerald-800");case"no_show":return Ua(s,"border-rose-200 bg-rose-50 text-rose-800");case"cancelled":return Ua(s,"border-slate-500 bg-slate-100 text-slate-600");default:return Ua(s,"border-slate-500 bg-slate-50 text-slate-700")}}function jv({label:t,value:s,icon:r,tone:a="slate"}){const i=a==="dark"?"bg-slate-900 text-white border-slate-900":a==="emerald"?"bg-emerald-50 text-emerald-900 border-emerald-200":a==="sky"?"bg-sky-50 text-sky-900 border-sky-200":a==="rose"?"bg-rose-50 text-rose-900 border-rose-200":"bg-white/80 text-slate-900 border-black/50";return n.jsx("div",{className:Ua("rounded-3xl border px-4 py-3",i),children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-[20px] font-semibold tracking-tight tabular-nums",children:s})]}),r&&n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/30",children:n.jsx(r,{className:"h-5 w-5 opacity-80"})})]})})}function CYe({value:t,onChange:s}){return n.jsx("div",{className:"flex items-center gap-1.5 overflow-auto no-scrollbar py-1",children:vYe.map(r=>{const a=t===r.key;return n.jsx("button",{type:"button",onClick:()=>s(r.key),className:Ua("whitespace-nowrap rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",a?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:r.label},r.key)})})}function i5({value:t,onChange:s,options:r}){return n.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:r.map(a=>{const i=t===a.key;return n.jsx("button",{type:"button",onClick:()=>s(a.key),className:Ua("rounded-full border px-3 py-1 text-[11px] font-semibold transition",i?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/80 text-slate-700 hover:bg-black/[0.03]"),children:a.label},a.key)})})}function SB({active:t,onClick:s,icon:r,children:a,tone:i="slate",title:l}){const o=i==="emerald"?t?"border-emerald-700 bg-emerald-600 text-white":"border-emerald-200 bg-emerald-50 text-emerald-800":i==="amber"?t?"border-amber-700 bg-amber-600 text-white":"border-amber-200 bg-amber-50 text-amber-900":i==="rose"?t?"border-rose-700 bg-rose-600 text-white":"border-rose-200 bg-rose-50 text-rose-800":t?"border-slate-900 bg-slate-900 text-white":"border-black/50 bg-white/85 text-slate-700";return n.jsxs("button",{type:"button",title:l,onClick:s,className:Ua("inline-flex items-center gap-2 rounded-full border px-3 py-1 text-[11px] font-semibold transition",o),children:[r?n.jsx(r,{className:"h-4 w-4"}):null,a]})}function kYe(){const{user:t}=dn()||{},s=Qr(),[r,a]=p.useState(null),[i,l]=p.useState(null),[o,c]=p.useState(bYe()),[d,u]=p.useState([]),[m,x]=p.useState(!1),[g,y]=p.useState("active"),[v,j]=p.useState(""),[w,S]=p.useState(!1),E=p.useRef({id:null,meta:null}),[k,A]=p.useState("all"),[I,P]=p.useState("all"),[O,D]=p.useState(!1),[T,B]=p.useState("clinical"),[U,W]=p.useState(!0),V=w?t==null?void 0:t.id:r,R=!!o&&(w?!!(t!=null&&t.id):!!r);p.useEffect(()=>{!(t!=null&&t.id)||!(t!=null&&t.is_doctor)||w||r||(S(!0),a(t.id),l({name:(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"My queue"}))},[t==null?void 0:t.id]);const F=p.useCallback(async()=>{if(!o||!R){u([]);return}try{x(!0);const ee={for_date:o};w?ee.my_only=!0:ee.doctor_user_id=Number(V),t!=null&&t.department_id&&(ee.department_id=t.department_id);const{data:X}=await NG(ee);u(Array.isArray(X)?X:[])}catch(ee){console.error(ee),u([])}finally{x(!1)}},[o,R,w,V,t]);p.useEffect(()=>{F()},[F]),p.useEffect(()=>{if(!U||!R)return;const ee=setInterval(()=>{F()},3e4);return()=>clearInterval(ee)},[U,R,F]);const G=async(ee,X,Z={})=>{try{const{data:Y}=await jG(ee.appointment_id,X);ae.success(`Status updated to ${String(Y.status).toUpperCase()}`),Z.goToVisit&&Y.visit_id?s(`/opd/visit/${Y.visit_id}`):F()}catch{}},H=(ee,X)=>{w||(a(ee),l(X||null))},$=()=>{if(!(t!=null&&t.id))return ae.error("No logged-in user found");S(ee=>{const X=!ee;if(X)E.current={id:r,meta:i},a(t.id),l({name:(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"My queue"}),ae.success("Showing my appointments only");else{const Z=E.current||{};a((Z==null?void 0:Z.id)||null),l((Z==null?void 0:Z.meta)||null),ae.success("Showing selected doctor queue")}return X})},K=p.useMemo(()=>{const ee={total:d.length,booked:0,checked_in:0,in_progress:0,completed:0,no_show:0,cancelled:0,vitals_done:0,vitals_need:0,visit_yes:0,visit_no:0};for(const X of d)ee[X.status]!==void 0&&(ee[X.status]+=1),X!=null&&X.has_vitals?ee.vitals_done+=1:ee.vitals_need+=1,X!=null&&X.visit_id?ee.visit_yes+=1:ee.visit_no+=1;return ee},[d]),le=K.booked+K.checked_in+K.in_progress,se=p.useMemo(()=>g==="all"?d:g==="active"?d.filter(ee=>["booked","checked_in","in_progress"].includes(ee.status)):d.filter(ee=>ee.status===g),[d,g]),J=p.useMemo(()=>{let ee=se;k==="needed"&&(ee=ee.filter(Z=>!Z.has_vitals)),k==="done"&&(ee=ee.filter(Z=>!!Z.has_vitals)),I==="no_visit"&&(ee=ee.filter(Z=>!Z.visit_id)),I==="has_visit"&&(ee=ee.filter(Z=>!!Z.visit_id)),O&&(ee=ee.filter(Z=>{const Y=Jx(Z,o);return Y!==null&&Y>=30}));const X=v.trim().toLowerCase();return X&&(ee=ee.filter(Z=>{var me,Re,Ze;const Y=(((me=Z.patient)==null?void 0:me.name)||"").toLowerCase(),Q=String(((Re=Z.patient)==null?void 0:Re.uhid)||"").toLowerCase(),oe=String(((Ze=Z.patient)==null?void 0:Ze.phone)||"").toLowerCase(),_e=String(Z.visit_purpose||"").toLowerCase(),xe=String(Z.queue_no??"").toLowerCase();return Y.includes(X)||Q.includes(X)||oe.includes(X)||_e.includes(X)||xe.includes(X)})),ee},[se,k,I,O,v,o]),ie=p.useMemo(()=>{const ee=Q=>Q==="in_progress"?0:Q==="checked_in"?1:Q==="booked"?2:9,X=Q=>{if(!Q||Q==="Free")return 9999;const[oe,_e]=String(Q).split(":").map(xe=>Number(xe));return!Number.isFinite(oe)||!Number.isFinite(_e)?9999:oe*60+_e},Z=Q=>Number.isFinite(Number(Q))?Number(Q):999999,Y=[...J];return Y.sort((Q,oe)=>{if(T==="queue"){const $e=Z(Q.queue_no)-Z(oe.queue_no);return $e!==0?$e:X(Q.time)-X(oe.time)}if(T==="time"){const $e=X(Q.time)-X(oe.time);return $e!==0?$e:ee(Q.status)-ee(oe.status)}if(T==="waiting"){const $e=Jx(Q,o)??-1,Me=(Jx(oe,o)??-1)-$e;if(Me!==0)return Me;const Ae=ee(Q.status)-ee(oe.status);return Ae!==0?Ae:Z(Q.queue_no)-Z(oe.queue_no)}const _e=ee(Q.status)-ee(oe.status);if(_e!==0)return _e;const xe=Jx(Q,o)??-1,Re=(Jx(oe,o)??-1)-xe;if(Re!==0)return Re;const Ze=Z(Q.queue_no)-Z(oe.queue_no);return Ze!==0?Ze:X(Q.time)-X(oe.time)}),Y},[J,T,o]),te=ee=>{s("/opd/triage",{state:{doctorId:V,date:o,appointmentId:ee==null?void 0:ee.appointment_id}})},ne=p.useMemo(()=>{const ee=ie.find(Z=>Z.status==="checked_in");if(ee)return ee;const X=ie.find(Z=>Z.status==="booked");return X||null},[ie]),q=async()=>{const ee=ne;if(!ee)return ae.message("No next patient found");if(!ee.has_vitals)return ae.message("Vitals needed before starting visit"),te(ee);if(ee.status==="booked"){ae.message("Please check-in first");return}await G(ee,"in_progress",{goToVisit:!0})};return n.jsx("div",{className:Wo.page,children:n.jsxs("div",{className:"mx-auto max-w-12xl px-4 py-6 space-y-4 md:px-8",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:Ua(Wo.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(14,165,233,0.14),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-emerald-700",children:"Live OPD Queue"})]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(Hs,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"Queue Management"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Doctor workflow: find next  check vitals  start visit  complete."}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Wo.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),NYe(o)]}),(i==null?void 0:i.name)&&n.jsxs("span",{className:Wo.chip,children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),i.name,w?n.jsx("span",{className:"ml-1 opacity-70",children:"(Me)"}):null]}),n.jsxs("span",{className:Wo.chip,children:[n.jsx(Qs,{className:"h-3.5 w-3.5"}),"Active ",n.jsx("span",{className:"ml-1 tabular-nums",children:le})]}),n.jsxs("button",{type:"button",onClick:$,className:Ua(Wo.chipBtn,w&&"bg-slate-900"),title:"Show only My appointments",disabled:!(t!=null&&t.id),children:[w?n.jsx(rd,{className:"h-4 w-4"}):n.jsx(wa,{className:"h-4 w-4"}),"My appointments"]}),n.jsx(SB,{active:U,onClick:()=>W(ee=>!ee),icon:$n,title:"Auto refresh every 30 seconds",tone:"emerald",children:"Auto refresh"})]})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:F,className:Wo.chipBtn,disabled:m||!R,title:"Refresh queue",children:[n.jsx(ps,{className:Ua("h-4 w-4",m&&"animate-spin")}),"Refresh"]}),n.jsxs(ge,{type:"button",className:"h-9 rounded-full bg-slate-900 hover:bg-slate-800 text-white font-semibold px-4",onClick:q,disabled:m||!R||!ne,title:"Start next patient (opens triage if vitals missing)",children:[ne!=null&&ne.has_vitals?n.jsx(Qhe,{className:"mr-2 h-4 w-4"}):n.jsx(ac,{className:"mr-2 h-4 w-4"}),"Start next"]}),n.jsxs("span",{className:Wo.chip,children:["Total ",n.jsx("span",{className:"ml-1 tabular-nums",children:K.total})]})]})]}),n.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[n.jsx(jv,{label:"Total appointments",value:K.total,icon:uc,tone:"dark"}),n.jsx(jv,{label:"Active",value:le,icon:Qs,tone:"emerald"}),n.jsx(jv,{label:"Vitals needed",value:K.vitals_need,icon:ac,tone:"rose"}),n.jsx(jv,{label:"Completed",value:K.completed,icon:Xt,tone:"sky"})]})]})]}),n.jsxs(dt,{className:Ua(Wo.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[n.jsxs("div",{className:"grid w-full gap-3 md:grid-cols-[2fr,1.1fr]",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Queue"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Doctor filters: Vitals / Visit / Waiting / Sort. Search by UHID, phone, purpose, queue#."}),n.jsx("div",{className:Ua("mt-3 rounded-2xl border border-black/50 bg-white/85 px-3 py-2",w&&"opacity-70 pointer-events-none"),title:w?"My appointments is ON (doctor locked)":"Select doctor",children:n.jsx(xc,{value:r,onChange:H,autoSelectCurrentDoctor:!0})}),w&&n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500 inline-flex items-center gap-1",children:[n.jsx(rd,{className:"h-3.5 w-3.5"}),"my_only = true"]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"Date"]}),n.jsx(Ee,{type:"date",value:o,onChange:ee=>c(ee.target.value),className:"h-11 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{value:v,onChange:ee=>j(ee.target.value),placeholder:"Search name / UHID / phone / purpose / queue#",className:Ua(Wo.input,"pl-10")})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"h-11 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>{j(""),y("active"),A("all"),P("all"),D(!1),B("clinical")},disabled:!R,children:"Clear filters"}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:F,disabled:m||!R,children:[m?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(ps,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[n.jsxs("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide flex items-center gap-2",children:[n.jsx(Pr,{className:"h-4 w-4"}),"Quick filters"]}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:ie.length})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(i5,{value:k,onChange:A,options:[{key:"all",label:`Vitals: All (${K.total})`},{key:"needed",label:`Needs (${K.vitals_need})`},{key:"done",label:`Done (${K.vitals_done})`}]}),n.jsx("span",{className:"mx-1 hidden md:inline text-slate-300",children:""}),n.jsx(i5,{value:I,onChange:P,options:[{key:"all",label:`Visit: All (${K.total})`},{key:"no_visit",label:`No visit (${K.visit_no})`},{key:"has_visit",label:`Has visit (${K.visit_yes})`}]}),n.jsx(SB,{active:O,onClick:()=>D(ee=>!ee),icon:Che,tone:"amber",title:"Only patients waiting 30+ minutes (today)",children:"Waiting 30+"}),n.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Wo.chip,children:[n.jsx(mde,{className:"h-3.5 w-3.5"}),"Sort"]}),n.jsx(i5,{value:T,onChange:B,options:jYe})]})]})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Status"}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:["Mode ",n.jsx("span",{className:"ml-1 tabular-nums",children:w?"My":"Doctor"})]})]}),n.jsx(CYe,{value:g,onChange:y})]})}),n.jsxs(it,{className:"pt-4",children:[!R&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"mx-auto mb-3 inline-flex h-12 w-12 items-center justify-center rounded-3xl border border-black/50 bg-white/60",children:n.jsx(Hs,{className:"h-5 w-5 text-slate-600"})}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Select doctor & date to view queue"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Or enable My appointments."})]}),R&&m&&n.jsx("div",{className:"space-y-3 py-3",children:[0,1,2,3].map(ee=>n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-44 rounded-xl"}),n.jsx(Qe,{className:"h-3 w-72 rounded-xl"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Qe,{className:"h-10 w-24 rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-28 rounded-2xl"})]})]})},ee))}),R&&!m&&ie.length===0&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"mx-auto mb-3 inline-flex h-12 w-12 items-center justify-center rounded-3xl border border-black/50 bg-white/60",children:n.jsx(jn,{className:"h-5 w-5 text-slate-600"})}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No appointments found"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Try switching filters, clearing search, or choose a different date."})]}),R&&!m&&ie.length>0&&n.jsx(Fn,{className:"max-h-[62vh] pr-1",children:n.jsx("div",{className:"space-y-2",children:n.jsx(on,{initial:!1,children:ie.map(ee=>{var Q,oe,_e,xe;const X=_Ye(ee,o),Z=(((Q=ee.patient)==null?void 0:Q.name)||"P").split(" ").filter(Boolean).slice(0,2).map(me=>{var Re;return(Re=me[0])==null?void 0:Re.toUpperCase()}).join("")||"P",Y=(ee==null?void 0:ee.queue_no)??null;return n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14},className:"rounded-3xl border border-black/50 bg-white/80 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-semibold text-white tabular-nums",children:ee.time||"-"}),Y!=null?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/50 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("span",{className:"opacity-70",children:"Queue"}),n.jsx("span",{className:"tabular-nums",children:Y})]}):null,n.jsx("span",{className:SYe(ee.status),children:yYe[ee.status]||ee.status}),X&&n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/50 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx(jn,{className:"h-3.5 w-3.5 text-slate-500"}),"Waiting ",n.jsx("span",{className:"tabular-nums",children:X})]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/50 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx(ac,{className:"h-3.5 w-3.5 text-slate-500"}),"Vitals ",n.jsx("span",{className:"font-semibold",children:ee.has_vitals?"Yes":"No"})]}),ee.visit_id?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-800",children:[n.jsx(Xt,{className:"h-3.5 w-3.5"}),"Visit ready"]}):null]}),n.jsxs("div",{className:"mt-2 flex items-start gap-3 min-w-0",children:[n.jsx("div",{className:"inline-flex h-11 w-11 shrink-0 items-center justify-center rounded-3xl border border-black/50 bg-black/[0.03] text-[12px] font-semibold text-slate-800",children:Z}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"truncate text-[14px] font-semibold text-slate-900",children:((oe=ee.patient)==null?void 0:oe.name)||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID"," ",n.jsx("span",{className:"font-semibold text-slate-700",children:((_e=ee.patient)==null?void 0:_e.uhid)||""}),"  ",n.jsx("span",{className:"font-semibold text-slate-700",children:((xe=ee.patient)==null?void 0:xe.phone)||""})]})]}),n.jsx("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:n.jsxs("span",{children:["Purpose"," ",n.jsx("span",{className:"font-semibold text-slate-700",children:ee.visit_purpose||"Consultation"})]})})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>te(ee),title:"Open Triage for this appointment",children:[n.jsx(ac,{className:"mr-2 h-4 w-4"}),"Vitals"]}),ee.status==="booked"&&n.jsxs(n.Fragment,{children:[n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>G(ee,"checked_in"),children:[n.jsx(QE,{className:"mr-2 h-4 w-4"}),"Check-in"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>G(ee,"no_show"),children:[n.jsx(ca,{className:"mr-2 h-4 w-4"}),"No-show"]})]}),ee.status==="checked_in"&&n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>{if(!ee.has_vitals)return te(ee);G(ee,"in_progress",{goToVisit:!0})},title:ee.has_vitals?"Start visit":"Vitals needed first",children:[n.jsx(i2,{className:"mr-2 h-4 w-4"}),"Start visit"]}),ee.status==="in_progress"&&n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>G(ee,"completed"),children:[n.jsx(Xt,{className:"mr-2 h-4 w-4"}),"Complete"]}),ee.visit_id&&n.jsx(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>s(`/opd/visit/${ee.visit_id}`),children:"Open visit"})]})]})},ee.appointment_id)})})})})]})]})]})})}const AYe=()=>new Date().toISOString().slice(0,10),Nv={height_cm:"",weight_kg:"",temp_c:"",pulse:"",resp_rate:"",spo2:"",bp_sys:"",bp_dia:"",notes:""},Wi=t=>t==null?"":String(t),Pd=t=>{const s=Number(t);return Number.isFinite(s)?s:null},CB=t=>{if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleString()};function kn(...t){return t.filter(Boolean).join(" ")}function EYe(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-IN",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})}catch{return t}}function TYe(t,s){const r=Pd(t),a=Pd(s);if(!r||!a||r<=0||a<=0)return null;const i=r/100,l=a/(i*i);return Number.isFinite(l)?Math.round(l*10)/10:null}function PYe(t){return t===null?null:t<18.5?{label:"Underweight",tone:"warning"}:t<25?{label:"Normal",tone:"ok"}:t<30?{label:"Overweight",tone:"warning"}:{label:"Obese",tone:"critical"}}function DYe(t){let s=0;const r=[],a=Pd(t.temp_c),i=Pd(t.pulse),l=Pd(t.resp_rate),o=Pd(t.spo2),c=Pd(t.bp_sys),d=Pd(t.bp_dia);return o!==null&&(o<90?(s=Math.max(s,2),r.push("Low SpO (<90)")):o<94&&(s=Math.max(s,1),r.push("Borderline SpO (<94)"))),a!==null&&(a>=40||a<34?(s=Math.max(s,2),r.push("Temp critical")):(a>=39||a<36)&&(s=Math.max(s,1),r.push("Temp abnormal"))),i!==null&&(i>130||i<40?(s=Math.max(s,2),r.push("Pulse critical")):(i>110||i<50)&&(s=Math.max(s,1),r.push("Pulse abnormal"))),l!==null&&(l>30||l<8?(s=Math.max(s,2),r.push("Resp rate critical")):(l>20||l<12)&&(s=Math.max(s,1),r.push("Resp rate abnormal"))),c!==null&&(c<90?(s=Math.max(s,2),r.push("Low systolic BP")):c<100?(s=Math.max(s,1),r.push("Borderline systolic BP")):c>=180?(s=Math.max(s,2),r.push("Very high systolic BP")):c>=140&&(s=Math.max(s,1),r.push("High systolic BP"))),d!==null&&(d>=120?(s=Math.max(s,2),r.push("Very high diastolic BP")):d>=90&&(s=Math.max(s,1),r.push("High diastolic BP"))),{level:s,label:s===2?"Critical":s===1?"Warning":"Normal",reasons:r}}const MYe=[{key:"active",label:"Active"},{key:"all",label:"All"},{key:"booked",label:"Booked"},{key:"checked_in",label:"Checked-in"},{key:"in_progress",label:"In progress"},{key:"completed",label:"Completed"},{key:"no_show",label:"No-show"},{key:"cancelled",label:"Cancelled"}];function kB(t){const s="rounded-full border px-2.5 py-1 text-[11px] font-semibold";switch(t){case"booked":return kn(s,"border-slate-500 bg-slate-50 text-slate-700");case"checked_in":return kn(s,"border-sky-200 bg-sky-50 text-sky-800");case"in_progress":return kn(s,"border-amber-200 bg-amber-50 text-amber-800");case"completed":return kn(s,"border-emerald-200 bg-emerald-50 text-emerald-800");case"no_show":return kn(s,"border-rose-200 bg-rose-50 text-rose-800");case"cancelled":return kn(s,"border-slate-500 bg-slate-100 text-slate-600");default:return kn(s,"border-slate-500 bg-slate-50 text-slate-700")}}const ji={pageBg:"bg-[radial-gradient(circle_at_top,_rgba(13,148,136,0.10),_transparent_55%)]",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",glassSoft:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur-xl shadow-[0_6px_22px_rgba(2,6,23,0.08)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-slate-900 px-3 py-1.5 text-[11px] font-semibold text-white hover:bg-slate-800 active:scale-[0.99] transition",input:"w-full rounded-2xl border border-black/50 bg-white/85 px-3 py-2 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"};function B0(t,s){const r=[];for(const a of t||[])r.push(Pd(s(a)));return r}function $0(t){const s=(t||[]).filter(o=>typeof o=="number"&&Number.isFinite(o));if(s.length===0)return{current:null,prev:null,delta:null,dir:"flat"};const r=s[s.length-1],a=s.length>=2?s[s.length-2]:null,i=a===null?null:r-a,l=i===null?"flat":i>0?"up":i<0?"down":"flat";return{current:r,prev:a,delta:i,dir:l}}function z0(t,s=0){if(t===null||!Number.isFinite(t))return"";const r=t>0?"+":t<0?"":"",a=Math.abs(t),i=s>0?a.toFixed(s):String(Math.round(a));return`${r}${i}`}function wv({series:t,series2:s,height:r=28}){const i=r,l=3,o=(t||[]).filter(j=>typeof j=="number"&&Number.isFinite(j)),c=(s||[]).filter(j=>typeof j=="number"&&Number.isFinite(j)),d=[...o,...c];if(d.length<2)return n.jsx("div",{className:"h-[28px] w-[120px] rounded-2xl border border-black/50 bg-black/[0.02] grid place-items-center",children:n.jsx(DV,{className:"h-4 w-4 text-slate-400"})});const u=Math.min(...d),x=Math.max(...d)-u||1,g=j=>{if(!j||j.length<2)return"";const w=j.length,S=(120-l*2)/(w-1);return j.map((E,k)=>{const A=l+k*S,I=l+(i-l*2)*(1-(E-u)/x);return`${k===0?"M":"L"} ${A.toFixed(2)} ${I.toFixed(2)}`}).join(" ")},y=g(o),v=g(c);return n.jsxs("svg",{width:120,height:i,viewBox:`0 0 120 ${i}`,className:"rounded-2xl border border-black/50 bg-white/85","aria-hidden":"true",children:[n.jsx("path",{d:`M ${l} ${i-l} L ${120-l} ${i-l}`,stroke:"currentColor",opacity:"0.10",strokeWidth:"1"}),v?n.jsx("path",{d:v,fill:"none",stroke:"currentColor",opacity:"0.35",strokeWidth:"2",strokeLinecap:"round"}):null,y?n.jsx("path",{d:y,fill:"none",stroke:"currentColor",opacity:"0.75",strokeWidth:"2.2",strokeLinecap:"round"}):null]})}function IYe({dir:t,deltaText:s}){const r=t==="up"?FV:t==="down"?Ehe:DV,a=t==="up"?"border-emerald-200 bg-emerald-50 text-emerald-700":t==="down"?"border-amber-200 bg-amber-50 text-amber-800":"border-black/50 bg-black/[0.02] text-slate-700";return n.jsxs("span",{className:kn("inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] font-semibold",a),children:[n.jsx(r,{className:"h-4 w-4"}),s]})}function _v({title:t,value:s,unit:r,dir:a,deltaText:i,children:l}){return n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:t}),n.jsxs("div",{className:"mt-1 flex items-end gap-2",children:[n.jsx("div",{className:"text-[20px] font-semibold tracking-tight text-slate-900 tabular-nums",children:s??""}),n.jsx("div",{className:"text-[12px] text-slate-500 pb-0.5",children:r})]}),n.jsx("div",{className:"mt-2",children:n.jsx(IYe,{dir:a,deltaText:i})})]}),n.jsx("div",{className:"text-slate-900",children:l})]})})}function OYe({value:t,onChange:s}){return n.jsx("div",{className:"flex items-center gap-1.5 overflow-auto no-scrollbar py-1",children:MYe.map(r=>{const a=t===r.key;return n.jsx("button",{type:"button",onClick:()=>s(r.key),className:kn("whitespace-nowrap rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",a?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:r.label},r.key)})})}function l5(t){var s;return((s=t==null?void 0:t.patient)==null?void 0:s.name)||(t==null?void 0:t.patient_name)||(t==null?void 0:t.patientName)||""}function o5(t){var s;return((s=t==null?void 0:t.patient)==null?void 0:s.uhid)||(t==null?void 0:t.uhid)||""}function AB(t){var s;return((s=t==null?void 0:t.patient)==null?void 0:s.phone)||(t==null?void 0:t.phone)||""}function Sv(t){var s;return((s=t==null?void 0:t.doctor)==null?void 0:s.name)||(t==null?void 0:t.doctor_name)||""}function U0(t){var s;return((s=t==null?void 0:t.department)==null?void 0:s.name)||(t==null?void 0:t.department_name)||""}function RYe(){const{user:t}=dn()||{},s=Qr(),r=pi(),[a,i]=p.useState(null),[l,o]=p.useState(null),[c,d]=p.useState(null),[u,m]=p.useState(AYe()),[x,g]=p.useState("active"),[y,v]=p.useState(""),[j,w]=p.useState(!1),S=p.useRef({id:null,meta:null,deptId:null}),[E,k]=p.useState([]),[A,I]=p.useState(!1),[P,O]=p.useState(null),[D,T]=p.useState(!1),[B,U]=p.useState(null),[W,V]=p.useState({...Nv}),[R,F]=p.useState(!1),G=p.useRef(null),[H,$]=p.useState(!1),[K,le]=p.useState(null),[se,J]=p.useState(!1),[ie,te]=p.useState(!1),[ne,q]=p.useState([]),ee=p.useRef(null),X=!!u,Z=j?t==null?void 0:t.id:a,Y=j||a?null:l,Q=(ke,je)=>{j||(i(ke),d(je||null),o((je==null?void 0:je.department_id)??null))},oe=()=>{if(!(t!=null&&t.id))return ae.error("No logged-in user found");w(ke=>{const je=!ke;if(je)S.current={id:a,meta:c,deptId:l},i(t.id),d({doctor_name:(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"Me"}),o(null),ae.success("Showing my appointments only");else{const ht=S.current||{};i((ht==null?void 0:ht.id)||null),d((ht==null?void 0:ht.meta)||null),o((ht==null?void 0:ht.deptId)||null),ae.success("Showing all / filtered triage")}return je})};p.useEffect(()=>{const ke=(r==null?void 0:r.state)||null;if(!ke)return;const je=ke==null?void 0:ke.date,ht=ke==null?void 0:ke.appointmentId;je&&m(je),ht&&O(Number(ht)),s(r.pathname,{replace:!0,state:null})},[]);const _e=p.useCallback(async()=>{if(!X){k([]);return}try{I(!0);const{data:ke}=await NG({for_date:u,doctor_user_id:Z||void 0,department_id:Y||void 0});k(Array.isArray(ke)?ke:[])}catch{k([])}finally{I(!1)}},[X,u,Z,Y]);p.useEffect(()=>{_e()},[_e]);const xe=ke=>{V({height_cm:Wi(ke==null?void 0:ke.height_cm),weight_kg:Wi(ke==null?void 0:ke.weight_kg),temp_c:Wi(ke==null?void 0:ke.temp_c),pulse:Wi(ke==null?void 0:ke.pulse),resp_rate:Wi(ke==null?void 0:ke.resp_rate),spo2:Wi(ke==null?void 0:ke.spo2),bp_sys:Wi(ke==null?void 0:ke.bp_sys),bp_dia:Wi(ke==null?void 0:ke.bp_dia),notes:(ke==null?void 0:ke.notes)??""})},me=async ke=>{try{te(!0);const{data:je}=await Kwe({appointment_id:ke.appointment_id,for_date:u,limit:14});q(Array.isArray(je)?je:[])}catch{q([])}finally{te(!1)}},Re=async ke=>{if(U(ke),T(!0),V({...Nv}),le(null),J(!1),q([]),requestAnimationFrame(()=>{var je,ht;(ht=(je=ee.current)==null?void 0:je.scrollIntoView)==null||ht.call(je,{behavior:"instant",block:"start"})}),me(ke),ke!=null&&ke.has_vitals)try{$(!0);const{data:je}=await d8({appointment_id:ke.appointment_id,for_date:u});xe(je),le({id:je==null?void 0:je.id,created_at:je==null?void 0:je.created_at}),J(!0)}catch{le(null),J(!1)}finally{$(!1)}};p.useEffect(()=>{if(!P||A||D)return;const ke=(E||[]).find(je=>Number(je==null?void 0:je.appointment_id)===Number(P));ke&&(Re(ke),O(null))},[E,A,P]);const Ze=()=>{T(!1),U(null),V({...Nv}),le(null),J(!1),q([])},$e=async()=>{if(B)try{$(!0);const{data:ke}=await d8({appointment_id:B.appointment_id,for_date:u});xe(ke),le({id:ke==null?void 0:ke.id,created_at:ke==null?void 0:ke.created_at}),J(!0),ae.success("Latest vitals loaded"),me(B)}catch{ae.error("No existing vitals found")}finally{$(!1)}},fe=async ke=>{if(ke.preventDefault(),!!B)try{F(!0);const je={appointment_id:B.appointment_id,height_cm:W.height_cm?Number(W.height_cm):void 0,weight_kg:W.weight_kg?Number(W.weight_kg):void 0,temp_c:W.temp_c?Number(W.temp_c):void 0,pulse:W.pulse?Number(W.pulse):void 0,resp_rate:W.resp_rate?Number(W.resp_rate):void 0,spo2:W.spo2?Number(W.spo2):void 0,bp_sys:W.bp_sys?Number(W.bp_sys):void 0,bp_dia:W.bp_dia?Number(W.bp_dia):void 0,notes:W.notes||void 0};await Gwe(je),ae.success(B!=null&&B.has_vitals?"Vitals updated":"Vitals recorded"),Ze(),await _e()}finally{F(!1)}},Me=p.useMemo(()=>DYe(W),[W]),Ae=p.useMemo(()=>TYe(W.height_cm,W.weight_kg),[W.height_cm,W.weight_kg]),Ke=p.useMemo(()=>PYe(Ae),[Ae]),Le=p.useMemo(()=>Me.level===2?{icon:nb,pill:"border-rose-200 bg-rose-50 text-rose-700",dot:"bg-rose-500"}:Me.level===1?{icon:en,pill:"border-amber-200 bg-amber-50 text-amber-800",dot:"bg-amber-500"}:{icon:Xt,pill:"border-emerald-200 bg-emerald-50 text-emerald-700",dot:"bg-emerald-500"},[Me.level]),He=Le.icon,pt=R||A||H||ie,Pe=p.useMemo(()=>x==="all"?E:x==="active"?E.filter(ke=>["booked","checked_in","in_progress"].includes(ke.status)):E.filter(ke=>ke.status===x),[E,x]),bt=p.useMemo(()=>{const ke=(y||"").trim().toLowerCase();return ke?Pe.filter(je=>{const ht=l5(je).toLowerCase(),At=o5(je).toLowerCase(),ms=(AB(je)||"").toLowerCase(),Zt=(Sv(je)||"").toLowerCase(),hs=(U0(je)||"").toLowerCase();return ht.includes(ke)||At.includes(ke)||ms.includes(ke)||Zt.includes(ke)||hs.includes(ke)}):Pe},[Pe,y]),It=E.length,De=E.filter(ke=>!!(ke!=null&&ke.has_vitals)).length,tt=It-De,ve=p.useMemo(()=>{const ke=Array.isArray(ne)?[...ne]:[];return ke.sort((je,ht)=>new Date(je.created_at||0).getTime()-new Date(ht.created_at||0).getTime()),ke},[ne]),Ge=p.useMemo(()=>B0(ve,ke=>ke.pulse),[ve]),We=p.useMemo(()=>B0(ve,ke=>ke.spo2),[ve]),Ve=p.useMemo(()=>B0(ve,ke=>ke.temp_c),[ve]),Fe=p.useMemo(()=>B0(ve,ke=>ke.bp_sys),[ve]),ot=p.useMemo(()=>B0(ve,ke=>ke.bp_dia),[ve]),ft=p.useMemo(()=>$0(Ge),[Ge]),ce=p.useMemo(()=>$0(We),[We]),Ce=p.useMemo(()=>$0(Ve),[Ve]),ze=p.useMemo(()=>$0(Fe),[Fe]),Te=p.useMemo(()=>$0(ot),[ot]),Nt=p.useMemo(()=>[...ve].reverse().slice(0,3),[ve]),Jt=p.useMemo(()=>j?`${(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"Me"} (Me)`:Z?(c==null?void 0:c.doctor_name)||(c==null?void 0:c.name)||"Doctor filter":Y?c!=null&&c.department_name?`Dept: ${c.department_name}`:"Department filter":"All doctors",[j,t,Z,Y,c]);return n.jsxs("div",{className:kn("min-h-[calc(100vh-4rem)] w-full bg-slate-50",ji.pageBg),children:[n.jsx("div",{className:"px-4 py-5 md:px-8 md:py-8",children:n.jsxs("div",{className:"space-y-4 md:space-y-5",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[n.jsx(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/80 px-3 py-1 text-[11px] font-semibold tracking-wide text-slate-700",children:"OPD  Triage & Vitals (List-first + filters)"}),n.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-sm animate-pulse"}),n.jsx("span",{children:"Live queue"})]})]}),n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18},children:n.jsxs("div",{className:kn(ji.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.16),_transparent_60%)]"}),n.jsxs("div",{className:"relative px-5 py-5 md:px-7 md:py-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/70 px-3 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-black/[0.04] border border-black/50",children:n.jsx($n,{className:"h-3.5 w-3.5 text-slate-700"})}),"Apple-glass workflow  List-first"]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(ac,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"OPD Triage"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600 leading-relaxed",children:"Default shows all appointments for the date. Use filters to narrow to department/doctor/my-only."}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:ji.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),EYe(u)]}),n.jsxs("span",{className:ji.chip,children:[n.jsx(Hs,{className:"h-3.5 w-3.5"}),Jt]}),n.jsxs("button",{type:"button",onClick:oe,className:kn(ji.chipBtn,j&&"bg-slate-900"),disabled:!(t!=null&&t.id),title:"Filter by logged-in doctor_user_id",children:[j?n.jsx(rd,{className:"h-4 w-4"}):n.jsx(wa,{className:"h-4 w-4"}),"My appointments"]})]})]})]})]}),n.jsxs("div",{className:"w-full md:w-[560px] space-y-3",children:[n.jsx("div",{className:kn(ji.glassSoft,"p-3"),children:n.jsxs("div",{className:"grid gap-2",children:[n.jsxs("div",{className:kn("rounded-2xl border border-black/50 bg-white/75 px-3 py-2",j&&"opacity-70 pointer-events-none"),title:j?"My appointments is ON (doctor locked)":"Optional: filter by department/doctor",children:[n.jsxs("div",{className:"flex items-center gap-2 pb-1",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-black/[0.04] border border-black/50",children:n.jsx(Xa,{className:"h-3.5 w-3.5 text-slate-700"})}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Filters"})]}),n.jsx(xc,{value:a,onChange:Q})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex-1 space-y-1",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"Date"}),n.jsx(Ee,{type:"date",value:u,onChange:ke=>m(ke.target.value),className:"h-10 rounded-2xl border-black/50 bg-white/85 text-sm"})]}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold",onClick:_e,disabled:A||!X,children:[n.jsx(ps,{className:kn("mr-2 h-4 w-4",A&&"animate-spin")}),"Refresh"]})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Status"}),n.jsxs("span",{className:ji.chip,children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:bt.length})]})]}),n.jsx(OYe,{value:x,onChange:g})]})}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:ji.chip,children:["Total ",n.jsx("span",{className:"ml-1 tabular-nums",children:It})]}),n.jsxs("span",{className:ji.chip,children:["Done ",n.jsx("span",{className:"ml-1 tabular-nums",children:De})]}),n.jsxs("span",{className:ji.chip,children:["Need vitals ",n.jsx("span",{className:"ml-1 tabular-nums",children:tt})]}),n.jsxs("div",{className:"ml-auto relative w-full md:w-[260px]",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{value:y,onChange:ke=>v(ke.target.value),placeholder:"Search name / UHID / phone / doctor / dept",className:kn(ji.input,"pl-10 h-10")})]})]})]})]})]})}),n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18},children:n.jsxs(dt,{className:kn(ji.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Queue"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Tap a patient to record / update vitals. List loads first, then filters apply."})]}),pt&&n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/80 text-[11px] font-semibold text-slate-600",children:[n.jsx(Rt,{className:"mr-2 h-3.5 w-3.5 animate-spin"}),"Syncing"]})]})}),n.jsx(it,{className:"pt-4",children:A?n.jsx("div",{className:"space-y-2",children:Array.from({length:7}).map((ke,je)=>n.jsx(Qe,{className:"h-16 w-full rounded-3xl bg-slate-100"},je))}):bt.length===0?n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/15 bg-black/[0.02] px-5 py-7 text-center",children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] border border-black/50 grid place-items-center",children:n.jsx(wa,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:"No appointments"}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"Try changing date or clearing filters."})]}):n.jsxs(Fn,{className:"max-h-[62vh] pr-2",children:[n.jsx("div",{className:"space-y-2",children:bt.map(ke=>{const je=l5(ke),ht=o5(ke),At=AB(ke),ms=Sv(ke),Zt=U0(ke);return n.jsx("button",{type:"button",onClick:()=>Re(ke),className:kn("w-full text-left rounded-3xl border border-black/50 bg-white/75 backdrop-blur px-4 py-3","shadow-[0_10px_24px_rgba(2,6,23,0.08)] hover:bg-white/90 transition","active:scale-[0.995]"),children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-semibold text-white",children:ke.time||""}),n.jsx("span",{className:kB(ke.status),children:ke.status}),n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:je}),n.jsxs("div",{className:"text-[12px] text-slate-500",children:["UHID ",ht]})]}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[12px] text-slate-600",children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(wa,{className:"h-4 w-4 text-slate-400"}),At||"No phone"]}),Z?null:n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Hs,{className:"h-4 w-4 text-slate-400"}),n.jsx("span",{className:"font-semibold text-slate-700",children:ms||""}),Zt?n.jsxs("span",{className:"text-slate-500",children:[" ",Zt]}):null]}),ke!=null&&ke.has_vitals?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700 border border-emerald-200",children:[n.jsx(Xt,{className:"h-4 w-4"}),"Vitals recorded"]}):n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-black/[0.03] px-2.5 py-1 text-[11px] font-semibold text-slate-700 border border-black/50",children:[n.jsx(Qs,{className:"h-4 w-4"}),"Not recorded"]})]})]}),n.jsxs("div",{className:"shrink-0 flex items-center gap-2",children:[ke!=null&&ke.visit_id?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",title:"Visit already created",children:[n.jsx(jn,{className:"h-3.5 w-3.5"}),"Visit"]}):null,n.jsx("span",{className:"inline-flex items-center rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:ke!=null&&ke.has_vitals?"View / Update":"Record"})]})]})},ke.appointment_id)})}),n.jsx("div",{className:"h-6"})]})})]})})]})}),n.jsx(on,{children:D&&B&&n.jsxs(mt.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[n.jsx("div",{className:"absolute inset-0 bg-black/35 backdrop-blur-[2px]",onClick:Ze}),n.jsx(mt.div,{className:"absolute inset-0 bg-white",initial:{y:18,opacity:0,scale:.995},animate:{y:0,opacity:1,scale:1},exit:{y:18,opacity:0,scale:.995},transition:{type:"spring",stiffness:260,damping:26},children:n.jsxs("div",{className:"h-full flex flex-col min-h-0",children:[n.jsx("div",{className:"sticky top-0 z-30 border-b border-black/50 bg-white/80 backdrop-blur-xl",children:n.jsx("div",{className:"px-4 md:px-8 py-4",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{type:"button",onClick:Ze,className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-black/[0.04] border border-black/50 hover:bg-black/[0.06]",title:"Back",children:n.jsx(Hl,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"text-[16px] md:text-[18px] font-semibold text-slate-900 tracking-tight truncate",children:["Vitals  ",l5(B)]}),n.jsxs("div",{className:"mt-0.5 text-[12px] text-slate-500 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{children:["UHID ",o5(B)]}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{children:["Time ",(B==null?void 0:B.time)||""]}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsx("span",{className:kB(B==null?void 0:B.status),children:B==null?void 0:B.status}),(Sv(B)||U0(B))&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{className:"font-semibold text-slate-700",children:[Sv(B)||"",U0(B)?`  ${U0(B)}`:""]})]}),(K==null?void 0:K.created_at)&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{children:["Last: ",n.jsx("span",{className:"font-semibold text-slate-700",children:CB(K.created_at)})]})]})]})]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:kn("inline-flex items-center gap-1 rounded-full border px-3 py-1 text-[11px] font-semibold",Le.pill),children:[n.jsx("span",{className:kn("h-1.5 w-1.5 rounded-full",Le.dot)}),n.jsx(He,{className:"h-4 w-4"}),Me.label]}),Ae!==null&&Ke&&n.jsxs("span",{className:kn("inline-flex items-center gap-1 rounded-full border px-3 py-1 text-[11px] font-semibold",Ke.tone==="critical"?"border-rose-200 bg-rose-50 text-rose-700":Ke.tone==="warning"?"border-amber-200 bg-amber-50 text-amber-800":"border-emerald-200 bg-emerald-50 text-emerald-700"),children:["BMI ",Ae,"  ",Ke.label]}),se?n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-semibold text-emerald-700 border border-emerald-200",children:[n.jsx(Xt,{className:"h-4 w-4"}),"Existing loaded"]}):n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-black/[0.03] px-3 py-1 text-[11px] font-semibold text-slate-700 border border-black/50",children:[n.jsx(Qs,{className:"h-4 w-4"}),"New entry"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[(B==null?void 0:B.has_vitals)&&n.jsxs(ge,{type:"button",variant:"outline",onClick:$e,disabled:H||R,className:"rounded-2xl border-black/50 bg-white/85 font-semibold",children:[n.jsx(ps,{className:kn("h-4 w-4 mr-2",H&&"animate-spin")}),"Load latest"]}),n.jsxs(ge,{type:"button",variant:"outline",onClick:Ze,className:"rounded-2xl border-black/50 bg-white/85 font-semibold",disabled:R,children:[n.jsx(ts,{className:"h-4 w-4 mr-2"}),"Close"]})]})]})})}),n.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto px-4 md:px-8 py-5",children:[n.jsx("div",{ref:ee}),n.jsxs("div",{className:"grid gap-4",children:[n.jsxs(dt,{className:kn(ji.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50",children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Trends"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Mini charts + change from previous record."})]}),n.jsx(it,{className:"pt-4",children:ie?n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(Qe,{className:"h-24 rounded-3xl bg-slate-100"}),n.jsx(Qe,{className:"h-24 rounded-3xl bg-slate-100"}),n.jsx(Qe,{className:"h-24 rounded-3xl bg-slate-100"}),n.jsx(Qe,{className:"h-24 rounded-3xl bg-slate-100"})]}):n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(_v,{title:"Pulse",value:ft.current,unit:"bpm",dir:ft.dir,deltaText:z0(ft.delta,0),children:n.jsx(wv,{series:Ge})}),n.jsx(_v,{title:"SpO",value:ce.current,unit:"%",dir:ce.dir,deltaText:z0(ce.delta,0),children:n.jsx(wv,{series:We})}),n.jsx(_v,{title:"BP",value:ze.current!==null||Te.current!==null?`${ze.current??""}/${Te.current??""}`:null,unit:"mmHg",dir:ze.dir!=="flat"?ze.dir:Te.dir,deltaText:ze.delta!==null||Te.delta!==null?`${z0(ze.delta,0)}/${z0(Te.delta,0)}`:"",children:n.jsx(wv,{series:Fe,series2:ot})}),n.jsx(_v,{title:"Temperature",value:Ce.current,unit:"C",dir:Ce.dir,deltaText:z0(Ce.delta,1),children:n.jsx(wv,{series:Ve})})]})})]}),n.jsxs(dt,{className:kn(ji.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50",children:[n.jsxs(jt,{className:"text-base md:text-lg font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(ac,{className:"h-5 w-5 text-slate-700"}),"Vitals entry"]}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Fast single-column capture with BP inline and notes."})]}),n.jsx(it,{className:"pt-4",children:n.jsxs("form",{ref:G,onSubmit:fe,className:"space-y-4",children:[n.jsx(Eu,{label:"Height (cm)",children:n.jsx(Ee,{type:"number",inputMode:"decimal",value:W.height_cm,onChange:ke=>V(je=>({...je,height_cm:ke.target.value})),className:"h-11 rounded-2xl border-black/50 bg-white/85"})}),n.jsx(Eu,{label:"Weight (kg)",children:n.jsx(Ee,{type:"number",inputMode:"decimal",value:W.weight_kg,onChange:ke=>V(je=>({...je,weight_kg:ke.target.value})),className:"h-11 rounded-2xl border-black/50 bg-white/85"})}),n.jsx(Eu,{label:n.jsxs("span",{className:"inline-flex items-center gap-2",children:["Temperature (C) ",n.jsx(ab,{className:"h-4 w-4 text-slate-500"})]}),children:n.jsx(Ee,{type:"number",inputMode:"decimal",value:W.temp_c,onChange:ke=>V(je=>({...je,temp_c:ke.target.value})),className:"h-11 rounded-2xl border-black/50 bg-white/85"})}),n.jsx(Eu,{label:"Pulse (bpm)",children:n.jsx(Ee,{type:"number",inputMode:"numeric",value:W.pulse,onChange:ke=>V(je=>({...je,pulse:ke.target.value})),className:"h-11 rounded-2xl border-black/50 bg-white/85"})}),n.jsx(Eu,{label:"Resp. rate",children:n.jsx(Ee,{type:"number",inputMode:"numeric",value:W.resp_rate,onChange:ke=>V(je=>({...je,resp_rate:ke.target.value})),className:"h-11 rounded-2xl border-black/50 bg-white/85"})}),n.jsx(Eu,{label:"SpO (%)",children:n.jsx(Ee,{type:"number",inputMode:"decimal",value:W.spo2,onChange:ke=>V(je=>({...je,spo2:ke.target.value})),className:"h-11 rounded-2xl border-black/50 bg-white/85"})}),n.jsx(Eu,{label:"BP (sys / dia)",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Ee,{type:"number",inputMode:"numeric",value:W.bp_sys,onChange:ke=>V(je=>({...je,bp_sys:ke.target.value})),placeholder:"Sys",className:"h-11 rounded-2xl border-black/50 bg-white/85"}),n.jsx(Ee,{type:"number",inputMode:"numeric",value:W.bp_dia,onChange:ke=>V(je=>({...je,bp_dia:ke.target.value})),placeholder:"Dia",className:"h-11 rounded-2xl border-black/50 bg-white/85"})]})}),n.jsx(Eu,{label:"Notes",children:n.jsx(fs,{value:W.notes,onChange:ke=>V(je=>({...je,notes:ke.target.value})),className:"min-h-[100px] rounded-2xl border-black/50 bg-white/85",placeholder:"Pain score, alerts, triage notes"})}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsx("div",{className:"text-[12px] text-slate-500",children:"Badges update live as you type."}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>V({...Nv}),disabled:R||H,children:"Clear"}),n.jsxs(ge,{type:"submit",className:"rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",disabled:R||H,children:[n.jsx(Pi,{className:"h-4 w-4 mr-2"}),R?"Saving":B!=null&&B.has_vitals?"Update vitals":"Save vitals"]})]})]})]})})]}),n.jsxs(dt,{className:kn(ji.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-base md:text-lg font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(tb,{className:"h-5 w-5 text-slate-700"}),"History (last 3)"]}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Load one entry into the form (quick compare)."})]}),n.jsxs(ge,{type:"button",variant:"outline",className:"rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>me(B),disabled:ie,children:[n.jsx(ps,{className:kn("h-4 w-4 mr-2",ie&&"animate-spin")}),"Refresh"]})]})}),n.jsx(it,{className:"pt-4",children:ie?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-20 w-full rounded-3xl bg-slate-100"}),n.jsx(Qe,{className:"h-20 w-full rounded-3xl bg-slate-100"}),n.jsx(Qe,{className:"h-20 w-full rounded-3xl bg-slate-100"})]}):Nt.length===0?n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/15 bg-black/[0.02] px-5 py-7 text-center",children:[n.jsx("div",{className:"mx-auto h-12 w-12 rounded-3xl bg-black/[0.04] border border-black/50 grid place-items-center",children:n.jsx(tb,{className:"h-6 w-6 text-slate-400"})}),n.jsx("div",{className:"mt-3 font-semibold text-slate-900",children:"No history"}),n.jsx("div",{className:"mt-1 text-[12px] text-slate-500",children:"No vitals history found."})]}):n.jsx("div",{className:"space-y-2",children:Nt.map(ke=>n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[12px] text-slate-500",children:CB(ke.created_at)}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] font-semibold",children:[n.jsx(V0,{label:"Temp",value:Wi(ke.temp_c)||""}),n.jsx(V0,{label:"SpO",value:Wi(ke.spo2)||""}),n.jsx(V0,{label:"Pulse",value:Wi(ke.pulse)||""}),n.jsx(V0,{label:"BP",value:`${Wi(ke.bp_sys)||""}/${Wi(ke.bp_dia)||""}`}),n.jsx(V0,{label:"RR",value:Wi(ke.resp_rate)||""})]})]}),n.jsx(ge,{type:"button",className:"rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>{var je,ht;xe(ke),le({id:ke.id,created_at:ke.created_at}),J(!0),ae.success("Loaded from history"),(ht=(je=ee.current)==null?void 0:je.scrollIntoView)==null||ht.call(je,{behavior:"smooth",block:"start"})},children:"Load"})]})},ke.id))})})]}),n.jsx("div",{className:"h-10"})]})]}),n.jsx("div",{className:"sticky bottom-0 z-30 border-t border-black/50 bg-white/80 backdrop-blur-xl",children:n.jsxs("div",{className:"px-4 md:px-8 py-3 flex items-center justify-between gap-2",children:[n.jsx("div",{className:"text-[12px] text-slate-500 flex items-center gap-2",children:pt?n.jsxs(n.Fragment,{children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Working"]}):n.jsxs(n.Fragment,{children:[n.jsx(Xt,{className:"h-4 w-4 text-emerald-600"}),"Ready"]})}),n.jsxs("div",{className:"flex items-center gap-2",children:[B!=null&&B.visit_id?n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>s(`/opd/visit/${B.visit_id}`),disabled:R,title:"Open visit",children:"Open visit"}):null,n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:Ze,disabled:R,children:"Close"}),n.jsxs(ge,{type:"button",className:"rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>{var ke,je;return(je=(ke=G.current)==null?void 0:ke.requestSubmit)==null?void 0:je.call(ke)},disabled:R||H,title:"Save vitals",children:[n.jsx(Pi,{className:"h-4 w-4 mr-2"}),R?"Saving":"Save"]})]})]})})]})})]})})]})}function Eu({label:t,children:s}){return n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:t}),s]})}function V0({label:t,value:s}){return n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1",children:[n.jsx("span",{className:"text-slate-500",children:t}),n.jsx("span",{className:"text-slate-900 tabular-nums",children:s})]})}function vn(...t){return t.filter(Boolean).join(" ")}const Tt={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 ",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-black/85 px-3 py-1.5 text-[11px] font-semibold text-white hover:text-black hover:bg-black/[0.03] active:scale-[0.99] transition disabled:opacity-60",label:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",textarea:"min-h-[110px] rounded-3xl border-black/50 bg-white/85 text-[13px] leading-relaxed",input:"h-11 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold",softBox:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3"},LYe=[{key:"history",label:"History",icon:nN},{key:"exam",label:"Examination",icon:ac},{key:"dx",label:"Diagnosis",icon:Hs},{key:"plan",label:"Plan",icon:RV},{key:"orders",label:"Orders",icon:Pr},{key:"followups",label:"Follow-ups",icon:Ds},{key:"summary",label:"Summary",icon:Xn}],_l={hpi:`Onset:
Duration:
Course/Progression:
Character:
Radiation:
Aggravating factors:
Relieving factors:
Associated symptoms:
Previous episodes:
Key negatives:
`,ros:`General:
Respiratory:
Cardiovascular:
GI:
GU:
CNS:
Musculoskeletal:
Skin:
Endocrine:
Hematologic:
`,pmh:`DM:
HTN:
Asthma/COPD:
CAD/Stroke:
Thyroid:
Renal:
TB:
Other:
`,exam_normal_general:`Conscious, oriented, afebrile.
No pallor / icterus / cyanosis / clubbing / lymphadenopathy / pedal edema.
Vitals stable.
`,exam_normal_systemic:`CVS: S1S2 normal, no murmurs.
RS: Bilateral air entry equal, no added sounds.
PA: Soft, non-tender.
CNS: No focal neurological deficit.
`,exam_cvs:`CVS: Pulse regular, normal volume.
S1 S2 heard, no murmurs.
JVP normal.
`,exam_rs:`RS: Chest symmetrical.
B/L air entry equal.
No wheeze / crepitations.
`,dx_format:`Provisional:
Differential:
Final:
`,icd_hint:`Example ICD: I10 (HTN), E11.9 (T2DM), J06.9 (URTI)
`,plan_format:`Investigations:
- 

Treatment:
- 

Advice:
- 

Follow-up:
- 
`,advice_general:`Explain red flags.
Adequate fluids, rest.
Medication compliance.
Return earlier if worsening.
`};function rI(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}function ene(t){if(!t)return"";const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}function Wm({label:t,value:s}){return s==null||s===""?null:n.jsxs("span",{className:"inline-flex items-center rounded-full border border-black/50 bg-white/85 px-2.5 py-1 text-[11px] font-semibold text-slate-700",children:[n.jsxs("span",{className:"text-slate-500",children:[t,":"]}),n.jsx("span",{className:"ml-1 tabular-nums text-slate-900",children:s})]})}function hn({label:t,hint:s,children:r,right:a}){return n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-end justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:Tt.label,children:t}),s?n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:s}):null]}),a?n.jsx("div",{className:"shrink-0",children:a}):null]}),r]})}function FYe(t){const s={};for(const[r,a]of Object.entries(t||{}))if(a!==void 0)if(typeof a=="string"){const i=a.trim();s[r]=i===""?null:i}else s[r]=a;return s}function BYe(t,s,r=[]){const a=[],i=(o,c)=>{const d=(c??"").toString().trim();d&&a.push(`${o}
${d}
`)};a.push("OPD VISIT SUMMARY"),a.push(`Patient: ${(t==null?void 0:t.patient_name)||""} (UHID ${(t==null?void 0:t.uhid)||""})`),a.push(`Episode: ${(t==null?void 0:t.episode_id)||""}`),a.push(`Doctor/Dept: ${(t==null?void 0:t.doctor_name)||""} / ${(t==null?void 0:t.department_name)||""}`),a.push(`Visit time: ${rI(t==null?void 0:t.visit_at)||""}`),a.push("");const l=t==null?void 0:t.current_vitals;if(l){const o=[];l.height_cm&&o.push(`Ht ${l.height_cm} cm`),l.weight_kg&&o.push(`Wt ${l.weight_kg} kg`),l.temp_c&&o.push(`Temp ${l.temp_c} C`),l.bp_systolic&&o.push(`BP ${l.bp_systolic}/${l.bp_diastolic} mmHg`),l.pulse&&o.push(`Pulse ${l.pulse}`),l.rr&&o.push(`RR ${l.rr}`),l.spo2&&o.push(`SpO ${l.spo2}%`),o.length&&(a.push(`Vitals: ${o.join("  ")}`),a.push(""))}if(i("Chief Complaint",s.chief_complaint),i("Presenting Illness (HPI)",s.presenting_illness),i("Symptoms",s.symptoms),i("Review of Systems",s.review_of_systems),i("Past Medical History",s.medical_history),i("Past Surgical History",s.surgical_history),i("Medication History",s.medication_history),i("Drug Allergy",s.drug_allergy),i("Family History",s.family_history),i("Personal/Social History",s.personal_history),i("Menstrual History",s.menstrual_history),i("Obstetric History",s.obstetric_history),i("Immunization History",s.immunization_history),i("General Examination",s.general_examination),i("Systemic Examination",s.systemic_examination),i("Local Examination",s.local_examination),i("Provisional Diagnosis",s.provisional_diagnosis),i("Differential Diagnosis",s.differential_diagnosis),i("Final Diagnosis",s.final_diagnosis),i("Diagnosis Codes (ICD)",s.diagnosis_codes),i("Investigations",s.investigations),i("Treatment Plan",s.treatment_plan),i("Advice/Counselling",s.advice),i("Follow-up Plan",s.followup_plan),i("Referral Notes",s.referral_notes),i("Procedure Notes",s.procedure_notes),i("Counselling Notes",s.counselling_notes),i("SOAP Subjective (Legacy)",s.soap_subjective),i("SOAP Objective (Legacy)",s.soap_objective),i("SOAP Assessment (Legacy)",s.soap_assessment),i("SOAP Plan (Legacy)",s.plan),Array.isArray(r)&&r.length){a.push("FOLLOW-UPS");const o=r.slice(0,12);o.forEach((c,d)=>{const u=c!=null&&c.due_date?ene(c.due_date):"",m=((c==null?void 0:c.status)||"").toString().toUpperCase(),x=((c==null?void 0:c.note)||"").toString().trim(),g=c!=null&&c.source_episode_id?` | Source: ${c.source_episode_id}`:"";a.push(`${d+1}. Due: ${u} | ${m}${g}${x?`
   Note: ${x}`:""}`)}),r.length>o.length&&a.push(`
 and ${r.length-o.length} more`),a.push("")}return a.join(`
`)}function $Ye({mode:t,setMode:s}){return n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:vn(Tt.chip,"gap-1.5"),children:[n.jsx($n,{className:"h-3.5 w-3.5"}),"Smart tools"]}),n.jsx("button",{type:"button",onClick:()=>s("insert"),className:vn(Tt.chipBtn,t==="insert"?"bg-black text-black border-slate-900":""),children:"Insert"}),n.jsx("button",{type:"button",onClick:()=>s("append"),className:vn(Tt.chipBtn,t==="append"?"bg-slate-900 text-white border-slate-900":""),children:"Append"})]})}function EB({items:t=[],loading:s=!1,onRefresh:r,compact:a=!1,title:i="Follow-up History",subtitle:l="Patient-level follow-ups (latest first)"}){const o=a?(t||[]).slice(0,6):t||[];return n.jsxs("div",{className:vn(Tt.softBox,"space-y-3"),children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"text-[12px] font-semibold text-slate-900 inline-flex items-center gap-2",children:[n.jsx(Ds,{className:"h-4 w-4 text-slate-500"}),i]}),n.jsx("div",{className:"mt-0.5 text-[12px] text-slate-600",children:l})]}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:r,disabled:s,children:[s?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Refresh"]})]}),s?n.jsx("div",{className:"rounded-3xl border border-black/10 bg-white/60 p-4 text-[12px] text-slate-600",children:"Loading follow-ups"}):o!=null&&o.length?n.jsxs("div",{className:"space-y-2",children:[o.map(c=>{const d=c!=null&&c.due_date?ene(c.due_date):"",u=c!=null&&c.created_at?rI(c.created_at):"",m=((c==null?void 0:c.status)||"").toString().toUpperCase(),x=((c==null?void 0:c.note)||"").toString().trim(),g=c==null?void 0:c.source_episode_id;return n.jsxs("div",{className:"flex items-start justify-between gap-3 rounded-3xl border border-black/50 bg-white/75 px-4 py-3",children:[n.jsxs("div",{className:"min-w-0 space-y-1",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"text-[12px] font-semibold text-slate-900",children:["Due: ",n.jsx("span",{className:"tabular-nums",children:d})]}),n.jsx(et,{className:"rounded-full",variant:"secondary",children:m}),g?n.jsxs("span",{className:"text-[11px] font-semibold text-slate-600",children:["Source: ",n.jsx("span",{className:"text-slate-900",children:g})]}):null]}),x?n.jsx("div",{className:"text-[13px] leading-relaxed text-slate-700 break-words",children:x}):n.jsx("div",{className:"text-[12px] text-slate-500",children:"No note"})]}),n.jsx("div",{className:"shrink-0 text-right text-[11px] text-slate-500",children:u})]},c.id)}),a&&t.length>o.length?n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Showing ",o.length," of ",t.length]}):null]}):n.jsx("div",{className:"rounded-3xl border border-black/10 bg-white/60 p-4 text-[12px] text-slate-600",children:"No follow-ups yet."})]})}function zYe({currentUser:t}){const{id:s}=Cm(),r=Number(s),[a,i]=p.useState("history"),[l,o]=p.useState(!0),[c,d]=p.useState(!1),[u,m]=p.useState(!1),[x,g]=p.useState(null),y=p.useMemo(()=>({chief_complaint:"",symptoms:"",soap_subjective:"",soap_objective:"",soap_assessment:"",plan:"",presenting_illness:"",review_of_systems:"",medical_history:"",surgical_history:"",medication_history:"",drug_allergy:"",family_history:"",personal_history:"",menstrual_history:"",obstetric_history:"",immunization_history:"",general_examination:"",systemic_examination:"",local_examination:"",provisional_diagnosis:"",differential_diagnosis:"",final_diagnosis:"",diagnosis_codes:"",investigations:"",treatment_plan:"",advice:"",followup_plan:"",referral_notes:"",procedure_notes:"",counselling_notes:""}),[]),[v,j]=p.useState(y),w=p.useRef(JSON.stringify(y)),[S,E]=p.useState("insert"),[k,A]=p.useState(""),[I,P]=p.useState(""),[O,D]=p.useState(!1),[T,B]=p.useState([]),[U,W]=p.useState(!1),V=async({notify:me=!1}={})=>{if(r)try{W(!0);const Re=await a2e(r,{scope:"patient",limit:50});B(Array.isArray(Re==null?void 0:Re.data)?Re.data:[]),me&&ae.success("Follow-up history refreshed")}catch{B([]),me&&ae.error("Follow-up history load failed")}finally{W(!1)}},[R,F]=p.useState(!1),[G,H]=p.useState("");p.useEffect(()=>()=>{G&&URL.revokeObjectURL(G)},[G]);const $=p.useMemo(()=>{try{return JSON.stringify(v)!==w.current}catch{return!0}},[v]),K=(me,Re)=>j(Ze=>({...Ze,[me]:Re})),le=(me,Re)=>{if(!me)return;const Ze=(Re||"").toString();j($e=>{const fe=($e[me]||"").toString(),Me=S==="append"&&fe.trim()?`${fe.trimEnd()}
${Ze}`:Ze;return{...$e,[me]:Me}}),ae.message(`${S==="append"?"Appended":"Inserted"} to ${me.replaceAll("_"," ")}`)},se=me=>{j(Re=>{const Ze={...Re};for(const[$e,fe]of Object.entries(me||{})){const Me=(Ze[$e]||"").toString(),Ae=(fe||"").toString();Ze[$e]=S==="append"&&Me.trim()?`${Me.trimEnd()}
${Ae}`:Ae}return Ze}),ae.message(`${S==="append"?"Appended":"Inserted"} template`)},J=me=>{const Re={...y,chief_complaint:(me==null?void 0:me.chief_complaint)||"",symptoms:(me==null?void 0:me.symptoms)||"",soap_subjective:(me==null?void 0:me.soap_subjective)||"",soap_objective:(me==null?void 0:me.soap_objective)||"",soap_assessment:(me==null?void 0:me.soap_assessment)||"",plan:(me==null?void 0:me.plan)||"",presenting_illness:(me==null?void 0:me.presenting_illness)||"",review_of_systems:(me==null?void 0:me.review_of_systems)||"",medical_history:(me==null?void 0:me.medical_history)||"",surgical_history:(me==null?void 0:me.surgical_history)||"",medication_history:(me==null?void 0:me.medication_history)||"",drug_allergy:(me==null?void 0:me.drug_allergy)||"",family_history:(me==null?void 0:me.family_history)||"",personal_history:(me==null?void 0:me.personal_history)||"",menstrual_history:(me==null?void 0:me.menstrual_history)||"",obstetric_history:(me==null?void 0:me.obstetric_history)||"",immunization_history:(me==null?void 0:me.immunization_history)||"",general_examination:(me==null?void 0:me.general_examination)||"",systemic_examination:(me==null?void 0:me.systemic_examination)||"",local_examination:(me==null?void 0:me.local_examination)||"",provisional_diagnosis:(me==null?void 0:me.provisional_diagnosis)||"",differential_diagnosis:(me==null?void 0:me.differential_diagnosis)||"",final_diagnosis:(me==null?void 0:me.final_diagnosis)||"",diagnosis_codes:(me==null?void 0:me.diagnosis_codes)||"",investigations:(me==null?void 0:me.investigations)||"",treatment_plan:(me==null?void 0:me.treatment_plan)||"",advice:(me==null?void 0:me.advice)||"",followup_plan:(me==null?void 0:me.followup_plan)||"",referral_notes:(me==null?void 0:me.referral_notes)||"",procedure_notes:(me==null?void 0:me.procedure_notes)||"",counselling_notes:(me==null?void 0:me.counselling_notes)||""};j(Re),w.current=JSON.stringify(Re)},ie=async()=>{try{o(!0);const me=await Wwe(r),Re=me==null?void 0:me.data;g(Re),J(Re),await V()}catch{g(null),B([])}finally{o(!1)}};p.useEffect(()=>{r&&ie()},[r]);const te=async()=>{try{d(!0),await qwe(r,FYe(v)),ae.success("Visit updated"),await ie()}catch{ae.error("Save failed")}finally{d(!1)}},ne=async()=>{if(!k)return ae.error("Select follow-up date");try{D(!0),await Ywe(r,{due_date:k,note:I||void 0}),ae.success("Follow-up created"),A(""),P(""),await V()}catch{ae.error("Follow-up create failed")}finally{D(!1)}},q=p.useMemo(()=>x?{id:x.patient_id,full_name:x.patient_name,uhid:x.uhid,phone:x.phone,gender:x.gender,dob:x.dob,op_uid:x.op_uid,ip_uid:x.ip_uid}:null,[x]),ee=p.useMemo(()=>{if(x)return x.op_uid||x.episode_id||void 0},[x]),X=p.useMemo(()=>{if(x)return x.ip_uid||void 0},[x]),Z=p.useMemo(()=>BYe(x,v,T),[x,v,T]),Y=async()=>{try{await navigator.clipboard.writeText(Z),ae.success("Summary copied")}catch{ae.error("Copy failed")}},Q=async()=>{const me=await r2e(r),Re=new Blob([me.data],{type:"application/pdf"});return URL.createObjectURL(Re)},oe=async()=>{$&&(ae.message("Saving before PDF"),await te())},_e=async()=>{try{m(!0),await oe();const me=await Q();window.open(me,"_blank","noopener,noreferrer"),setTimeout(()=>URL.revokeObjectURL(me),6e4)}catch{ae.error("PDF print failed")}finally{m(!1)}},xe=async()=>{try{m(!0),await oe(),G&&URL.revokeObjectURL(G);const me=await Q();H(me),F(!0)}catch{ae.error("PDF preview failed")}finally{m(!1)}};return r?n.jsxs("div",{className:Tt.page,children:[n.jsx(Wa,{open:R,onOpenChange:me=>{F(me),!me&&G&&(URL.revokeObjectURL(G),H(""))},children:n.jsxs(va,{className:"max-w-5xl w-[95vw] rounded-3xl border border-black/50 bg-white/80 backdrop-blur-xl p-0 overflow-hidden",children:[n.jsx(ii,{className:"px-5 py-4 border-b border-black/10",children:n.jsx(li,{className:"text-sm font-semibold text-slate-900",children:"Visit Summary PDF"})}),n.jsx("div",{className:"h-[78vh] bg-white",children:G?n.jsx("iframe",{title:"Visit Summary PDF",src:G,className:"h-full w-full"}):n.jsx("div",{className:"h-full w-full grid place-items-center text-sm text-slate-600",children:"Loading"})}),n.jsxs("div",{className:"px-5 py-4 border-t border-black/10 flex items-center justify-end gap-2",children:[n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>{G&&window.open(G,"_blank","noopener,noreferrer")},disabled:!G,children:[n.jsx(Ll,{className:"mr-2 h-4 w-4"}),"Open in new tab"]}),n.jsx(ge,{type:"button",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>F(!1),children:"Close"})]})]})}),n.jsxs("div",{className:"mx-auto max-w-[1450px] px-4 py-6 space-y-4 md:px-8",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:vn(Tt.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.14),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-emerald-700",children:"OPD Visit"}),$&&!c&&!l?n.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 rounded-full border border-amber-500/40 bg-amber-50 px-2.5 py-1 text-[11px] font-semibold text-amber-900",children:[n.jsx(en,{className:"h-3.5 w-3.5"}),"Unsaved"]}):null]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(Hs,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"Visit Workspace"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Fast documentation + orders + follow-ups + print-ready summary PDF."}),n.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:l?n.jsxs("span",{className:Tt.chip,children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin"})," Loading"]}):x?n.jsxs(n.Fragment,{children:[n.jsxs("span",{className:Tt.chip,children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),x.patient_name,n.jsxs("span",{className:"opacity-70",children:["(UHID ",x.uhid,")"]})]}),n.jsxs("span",{className:Tt.chip,children:[n.jsx(iue,{className:"h-3.5 w-3.5"}),"Episode ",n.jsx("span",{className:"ml-1 tabular-nums",children:x.episode_id})]}),n.jsxs("span",{className:Tt.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),rI(x.visit_at)]}),n.jsxs("span",{className:Tt.chip,children:[n.jsx(Hs,{className:"h-3.5 w-3.5"}),x.department_name,"  Dr. ",x.doctor_name]}),n.jsxs("button",{type:"button",className:vn(Tt.chipBtn,"bg-white/85"),onClick:()=>i("followups"),title:"Open Follow-ups",children:[n.jsx(Ds,{className:"h-4 w-4"}),"Follow-ups (",(T==null?void 0:T.length)||0,")"]})]}):null})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",className:vn(Tt.chipBtn,"bg-white/85"),onClick:xe,disabled:u||l,title:"Preview PDF",children:[u?n.jsx(Rt,{className:"h-4 w-4 animate-spin"}):n.jsx(Wr,{className:"h-4 w-4"}),"Preview PDF"]}),n.jsxs("button",{type:"button",className:vn(Tt.chipBtn,"bg-white/85"),onClick:_e,disabled:u||l,title:"Print PDF",children:[u?n.jsx(Rt,{className:"h-4 w-4 animate-spin"}):n.jsx(Ll,{className:"h-4 w-4"}),"Print PDF"]})]})]}),!l&&(x==null?void 0:x.current_vitals)&&n.jsxs("div",{className:"mt-5 rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500 inline-flex items-center gap-2",children:[n.jsx(ac,{className:"h-4 w-4 text-slate-500"}),"Latest vitals"]}),n.jsx(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 text-[11px] font-semibold",children:"Live"})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[n.jsx(Wm,{label:"Ht",value:x.current_vitals.height_cm?`${x.current_vitals.height_cm} cm`:""}),n.jsx(Wm,{label:"Wt",value:x.current_vitals.weight_kg?`${x.current_vitals.weight_kg} kg`:""}),n.jsx(Wm,{label:"Temp",value:x.current_vitals.temp_c?`${x.current_vitals.temp_c} C`:""}),n.jsx(Wm,{label:"BP",value:x.current_vitals.bp_systolic?`${x.current_vitals.bp_systolic}/${x.current_vitals.bp_diastolic} mmHg`:""}),n.jsx(Wm,{label:"Pulse",value:x.current_vitals.pulse??""}),n.jsx(Wm,{label:"RR",value:x.current_vitals.rr??""}),n.jsx(Wm,{label:"SpO",value:x.current_vitals.spo2?`${x.current_vitals.spo2}%`:""})]})]})]})]}),n.jsx("div",{className:"sticky top-[0.25rem] z-20",children:n.jsx("div",{className:vn(Tt.glass,"px-3 py-2"),children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsx("div",{className:"flex items-center gap-2 overflow-auto",children:LYe.map(me=>{const Re=a===me.key,Ze=me.icon;return n.jsxs("button",{type:"button",onClick:()=>i(me.key),className:vn("whitespace-nowrap inline-flex items-center gap-2 rounded-full border px-4 py-2 text-[12px] font-semibold transition",Re?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:[n.jsx(Ze,{className:"h-4 w-4"}),me.label]},me.key)})}),n.jsx($Ye,{mode:S,setMode:E})]})})}),l&&n.jsx(dt,{className:vn(Tt.glass),children:n.jsxs(it,{className:"pt-6 space-y-3",children:[n.jsx(Qe,{className:"h-6 w-56 rounded-2xl"}),n.jsx(Qe,{className:"h-4 w-[80%] rounded-2xl"}),n.jsx(Qe,{className:"h-40 w-full rounded-3xl"})]})}),!l&&!x&&n.jsx(dt,{className:vn(Tt.glass),children:n.jsx(it,{className:"pt-6 text-sm text-rose-700",children:"Visit not found."})}),!l&&x&&n.jsxs(on,{mode:"wait",initial:!1,children:[a==="history"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"History"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Use templates for fast documentation."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:vn(Tt.softBox,"flex flex-wrap items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx($n,{className:"h-4 w-4 text-slate-500"}),"Templates"]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("presenting_illness",_l.hpi),children:"HPI template"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("review_of_systems",_l.ros),children:"ROS template"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("medical_history",_l.pmh),children:"PMH template"})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Chief complaint",children:n.jsx(fs,{value:v.chief_complaint,onChange:me=>K("chief_complaint",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Presenting illness (HPI)",children:n.jsx(fs,{value:v.presenting_illness,onChange:me=>K("presenting_illness",me.target.value),className:Tt.textarea})})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Symptoms",children:n.jsx(fs,{value:v.symptoms,onChange:me=>K("symptoms",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Review of Systems (ROS)",children:n.jsx(fs,{value:v.review_of_systems,onChange:me=>K("review_of_systems",me.target.value),className:Tt.textarea})})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Past medical history (PMH)",children:n.jsx(fs,{value:v.medical_history,onChange:me=>K("medical_history",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Past surgical history (PSH)",children:n.jsx(fs,{value:v.surgical_history,onChange:me=>K("surgical_history",me.target.value),className:Tt.textarea})})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Medication history",children:n.jsx(fs,{value:v.medication_history,onChange:me=>K("medication_history",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Drug allergy / allergies",children:n.jsx(fs,{value:v.drug_allergy,onChange:me=>K("drug_allergy",me.target.value),className:Tt.textarea})})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Family history",children:n.jsx(fs,{value:v.family_history,onChange:me=>K("family_history",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Personal / social history",children:n.jsx(fs,{value:v.personal_history,onChange:me=>K("personal_history",me.target.value),className:Tt.textarea})})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Menstrual history (if applicable)",children:n.jsx(fs,{value:v.menstrual_history,onChange:me=>K("menstrual_history",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Obstetric history (if applicable)",children:n.jsx(fs,{value:v.obstetric_history,onChange:me=>K("obstetric_history",me.target.value),className:Tt.textarea})})]}),n.jsx(hn,{label:"Immunization history (optional)",children:n.jsx(fs,{value:v.immunization_history,onChange:me=>K("immunization_history",me.target.value),className:Tt.textarea})}),n.jsxs("div",{className:vn(Tt.softBox,"flex items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx(nN,{className:"h-4 w-4 text-slate-500"}),"Use templates then edit  fastest and consistent."]}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:te,disabled:c||!$,children:[c?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Xt,{className:"mr-2 h-4 w-4"}),"Save"]})]})]})]})},"history"),a==="exam"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Examination"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"One-click normal exam macros."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:vn(Tt.softBox,"flex flex-wrap items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx($n,{className:"h-4 w-4 text-slate-500"}),"Macros"]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("general_examination",_l.exam_normal_general),children:"Normal General"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("systemic_examination",_l.exam_normal_systemic),children:"Normal Systemic"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>se({general_examination:_l.exam_normal_general,systemic_examination:_l.exam_normal_systemic}),children:"Normal Exam (All)"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("systemic_examination",_l.exam_cvs),children:"CVS"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("systemic_examination",_l.exam_rs),children:"RS"})]})]}),n.jsx(hn,{label:"General examination",children:n.jsx(fs,{value:v.general_examination,onChange:me=>K("general_examination",me.target.value),className:Tt.textarea})}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Systemic examination",children:n.jsx(fs,{value:v.systemic_examination,onChange:me=>K("systemic_examination",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Local examination (optional)",children:n.jsx(fs,{value:v.local_examination,onChange:me=>K("local_examination",me.target.value),className:Tt.textarea})})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsx(hn,{label:"SOAP Objective (Legacy)",children:n.jsx(fs,{value:v.soap_objective,onChange:me=>K("soap_objective",me.target.value),className:Tt.textarea})}),n.jsxs("div",{className:vn(Tt.softBox,"flex items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx(ac,{className:"h-4 w-4 text-slate-500"}),"Exam macros reduce typing and keep consistency."]}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:te,disabled:c||!$,children:[c?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Xt,{className:"mr-2 h-4 w-4"}),"Save"]})]})]})]})},"exam"),a==="dx"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Diagnosis"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Templates for Dx formatting + ICD hints."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:vn(Tt.softBox,"flex flex-wrap items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx($n,{className:"h-4 w-4 text-slate-500"}),"Templates"]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{className:Tt.chipBtn,onClick:()=>se({provisional_diagnosis:_l.dx_format}),children:"Dx format"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("diagnosis_codes",_l.icd_hint),children:"ICD hint"})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Provisional diagnosis",children:n.jsx(fs,{value:v.provisional_diagnosis,onChange:me=>K("provisional_diagnosis",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Differential diagnosis",children:n.jsx(fs,{value:v.differential_diagnosis,onChange:me=>K("differential_diagnosis",me.target.value),className:Tt.textarea})})]}),n.jsx(hn,{label:"Final diagnosis",children:n.jsx(fs,{value:v.final_diagnosis,onChange:me=>K("final_diagnosis",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Diagnosis codes (ICD)",hint:"Comma-separated (example: I10,E11.9)",children:n.jsx(Ee,{value:v.diagnosis_codes,onChange:me=>K("diagnosis_codes",me.target.value),placeholder:"I10,E11.9",className:Tt.input})}),n.jsx(hn,{label:"SOAP Assessment (Legacy)",children:n.jsx(fs,{value:v.soap_assessment,onChange:me=>K("soap_assessment",me.target.value),className:Tt.textarea})}),n.jsxs("div",{className:vn(Tt.softBox,"flex items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx(Hs,{className:"h-4 w-4 text-slate-500"}),"Dx should match plan + orders."]}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:te,disabled:c||!$,children:[c?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Xt,{className:"mr-2 h-4 w-4"}),"Save"]})]})]})]})},"dx"),a==="plan"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Plan"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Clinical plan + advice. Follow-ups are managed in the Follow-ups tab."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:vn(Tt.softBox,"flex flex-wrap items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx($n,{className:"h-4 w-4 text-slate-500"}),"Templates"]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{className:Tt.chipBtn,onClick:()=>se({investigations:_l.plan_format}),children:"Plan format"}),n.jsx("button",{className:Tt.chipBtn,onClick:()=>le("advice",_l.advice_general),children:"General advice"}),n.jsxs("button",{className:Tt.chipBtn,onClick:()=>i("followups"),children:[n.jsx(Ds,{className:"h-4 w-4"}),"Go to Follow-ups"]})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Investigations",children:n.jsx(fs,{value:v.investigations,onChange:me=>K("investigations",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Treatment plan",children:n.jsx(fs,{value:v.treatment_plan,onChange:me=>K("treatment_plan",me.target.value),className:Tt.textarea})})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Advice / counselling",children:n.jsx(fs,{value:v.advice,onChange:me=>K("advice",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Follow-up plan (clinical)",children:n.jsx(fs,{value:v.followup_plan,onChange:me=>K("followup_plan",me.target.value),className:Tt.textarea})})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsx(hn,{label:"Referral notes (optional)",children:n.jsx(fs,{value:v.referral_notes,onChange:me=>K("referral_notes",me.target.value),className:Tt.textarea})}),n.jsx(hn,{label:"Procedure notes (optional)",children:n.jsx(fs,{value:v.procedure_notes,onChange:me=>K("procedure_notes",me.target.value),className:Tt.textarea})})]}),n.jsx(hn,{label:"Counselling notes (optional)",children:n.jsx(fs,{value:v.counselling_notes,onChange:me=>K("counselling_notes",me.target.value),className:Tt.textarea})}),n.jsxs("div",{className:vn(Tt.softBox,"flex items-center justify-between gap-2"),children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx(RV,{className:"h-4 w-4 text-slate-500"}),"Plan should match Dx + orders."]}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:te,disabled:c||!$,children:[c?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Xt,{className:"mr-2 h-4 w-4"}),"Save"]})]})]})]})},"plan"),a==="orders"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Orders"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Lab / Radiology / Pharmacy orders."})]}),n.jsxs(it,{className:"pt-4 space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("span",{className:Tt.chip,children:[n.jsx(PV,{className:"h-3.5 w-3.5"})," Lab"]}),n.jsxs("span",{className:Tt.chip,children:[n.jsx(yo,{className:"h-3.5 w-3.5"})," Radiology"]}),n.jsxs("span",{className:Tt.chip,children:[n.jsx(rr,{className:"h-3.5 w-3.5"})," Pharmacy"]})]}),n.jsx(PK,{patient:q,contextType:"opd",contextId:r,opNumber:ee,ipNumber:X,currentUser:t,defaultLocationId:void 0})]})]})},"orders"),a==="followups"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Follow-ups"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Create reminders and track follow-up history (patient-level)."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:vn(Tt.softBox,"space-y-3"),children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"text-[12px] font-semibold text-slate-900 inline-flex items-center gap-2",children:[n.jsx(Ds,{className:"h-4 w-4 text-slate-500"}),"Create Follow-up"]}),n.jsx(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 text-[11px] font-semibold",children:"Reminder"})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr,2fr,auto] md:items-end",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:Tt.label,children:"Follow-up date"}),n.jsx(Ee,{type:"date",value:k,onChange:me=>A(me.target.value),className:Tt.input})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:Tt.label,children:"Note"}),n.jsx(Ee,{value:I,onChange:me=>P(me.target.value),placeholder:"Review in 2 weeks / discuss reports",className:Tt.input})]}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold px-6",onClick:ne,disabled:O,children:[O?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Ds,{className:"mr-2 h-4 w-4"}),"Create"]})]}),n.jsxs("div",{className:"text-[12px] text-slate-600",children:["Tip: This follow-up will also be included in the ",n.jsx("span",{className:"font-semibold text-slate-900",children:"Summary"})," and your PDF."]})]}),n.jsx(EB,{items:T,loading:U,onRefresh:()=>V({notify:!0}),compact:!1,title:"Follow-up History",subtitle:"Automatically updated after you create a follow-up"})]})]})},"followups"),a==="summary"&&n.jsx(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.14},className:"space-y-4",children:n.jsxs(dt,{className:vn(Tt.glass),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Summary"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Copy or print PDF."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[n.jsxs("div",{className:"text-[12px] text-slate-600 inline-flex items-center gap-2",children:[n.jsx(Xn,{className:"h-4 w-4 text-slate-500"}),"Summary built from your entries."]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:Y,children:[n.jsx(vg,{className:"mr-2 h-4 w-4"}),"Copy"]}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:xe,disabled:u,children:[u?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Wr,{className:"mr-2 h-4 w-4"}),"Preview PDF"]}),n.jsxs(ge,{type:"button",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:_e,disabled:u,children:[u?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Ll,{className:"mr-2 h-4 w-4"}),"Print PDF"]})]})]}),n.jsx(EB,{items:T,loading:U,onRefresh:()=>V({notify:!0}),compact:!1,title:"Follow-up Details",subtitle:"This will also be included in your server Summary PDF"}),n.jsx("pre",{className:"whitespace-pre-wrap rounded-3xl border border-black/50 bg-white/80 p-4 text-[12.5px] leading-relaxed text-slate-800",children:Z})]})]})},"summary")]})]})]}):n.jsx("div",{className:"p-4 text-sm",children:"Invalid visit ID."})}const TB=()=>new Date().toISOString().slice(0,10);function za(...t){return t.filter(Boolean).join(" ")}const Ni={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border bg-green-900 px-3 py-1.5 text-[11px] font-semibold text-white hover:text-black hover:bg-black/[0.03] active:scale-[0.99] transition",input:"h-11 w-full rounded-2xl border border-black/50 bg-white/85 px-3 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"};function H0(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-IN",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})}catch{return t}}const UYe=[{key:"waiting",label:"Waiting"},{key:"scheduled",label:"Scheduled"},{key:"completed",label:"Completed"},{key:"cancelled",label:"Cancelled"},{key:"*",label:"All"}],Cv={waiting:"Waiting",scheduled:"Scheduled",completed:"Completed",cancelled:"Cancelled","*":"All"};function c5(t){const s="rounded-full border px-2.5 py-1 text-[11px] font-semibold uppercase";switch(t){case"waiting":return za(s,"border-amber-200 bg-amber-50 text-amber-800");case"scheduled":return za(s,"border-sky-200 bg-sky-50 text-sky-800");case"completed":return za(s,"border-emerald-200 bg-emerald-50 text-emerald-800");case"cancelled":return za(s,"border-slate-500 bg-slate-100 text-slate-600");default:return za(s,"border-slate-500 bg-slate-50 text-slate-700")}}function kv({label:t,value:s,icon:r,tone:a="slate"}){const i=a==="dark"?"bg-slate-900 text-white border-slate-900":a==="emerald"?"bg-emerald-50 text-emerald-900 border-emerald-200":a==="sky"?"bg-sky-50 text-sky-900 border-sky-200":a==="amber"?"bg-amber-50 text-amber-900 border-amber-200":"bg-white/80 text-slate-900 border-black/50";return n.jsx("div",{className:za("rounded-3xl border px-4 py-3",i),children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-[20px] font-semibold tracking-tight tabular-nums",children:s})]}),r&&n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/30",children:n.jsx(r,{className:"h-5 w-5 opacity-80"})})]})})}function VYe({value:t,onChange:s}){return n.jsx("div",{className:"flex items-center gap-1.5 overflow-auto no-scrollbar py-1",children:UYe.map(r=>{const a=t===r.key;return n.jsx("button",{type:"button",onClick:()=>s(r.key),className:za("whitespace-nowrap rounded-full border px-3 py-1.5 text-[11px] font-semibold transition",a?"border-slate-900 bg-slate-900 text-white shadow-sm":"border-black/50 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:r.label},r.key)})})}function PB({open:t,onOpenChange:s,title:r,subtitle:a,right:i,children:l}){return n.jsx(Wa,{open:t,onOpenChange:s,children:n.jsx(va,{className:za("p-0 overflow-hidden border border-black/50 bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_rgba(2,6,23,0.18)]","!left-0 !right-0 !bottom-0 !top-auto !translate-x-0 !translate-y-0","w-screen h-[100dvh]","rounded-t-3xl rounded-b-none","sm:!left-1/2 sm:!top-1/2 sm:!bottom-auto sm:!-translate-x-1/2 sm:!-translate-y-1/2","sm:w-[92vw] sm:max-w-5xl sm:h-[88vh]","sm:rounded-3xl","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=open]:duration-200 data-[state=closed]:duration-150","data-[state=open]:slide-in-from-bottom-10 data-[state=closed]:slide-out-to-bottom-10","sm:data-[state=open]:zoom-in-95 sm:data-[state=closed]:zoom-out-95"),children:n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(14,165,233,0.12),_transparent_60%)] opacity-70"}),n.jsx("div",{className:"relative sm:hidden pt-3",children:n.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-black/15"})}),n.jsx("div",{className:"relative border-b border-black/50 bg-white/55 backdrop-blur-xl",children:n.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3 sm:px-6",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[12px] font-semibold tracking-tight text-slate-900 truncate",children:r}),a?n.jsx("div",{className:"mt-0.5 text-[11px] text-slate-600 truncate",children:a}):null]}),n.jsxs("div",{className:"flex items-center gap-2",children:[i,n.jsx("button",{type:"button",onClick:()=>s(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-black/50 bg-white/75 hover:bg-black/[0.03] transition",title:"Close",children:n.jsx(ts,{className:"h-4 w-4 text-slate-700"})})]})]})}),n.jsx(Fn,{className:"h-[calc(100dvh-72px)] sm:h-[calc(88vh-56px)]",children:n.jsx("div",{className:"p-4 sm:p-6 pb-[env(safe-area-inset-bottom)]",children:l})})]})})})}function HYe(){const{user:t}=dn()||{},s=Qr(),[r,a]=p.useState("waiting"),[i,l]=p.useState(null),[o,c]=p.useState(null),[d,u]=p.useState(TB()),[m,x]=p.useState(TB()),[g,y]=p.useState([]),[v,j]=p.useState(!1),[w,S]=p.useState(""),[E,k]=p.useState(!1),A=p.useRef({id:null,meta:null}),[I,P]=p.useState(null),[O,D]=p.useState(""),[T,B]=p.useState(""),[U,W]=p.useState(!1),[V,R]=p.useState(null),[F,G]=p.useState(""),[H,$]=p.useState(""),[K,le]=p.useState(!0),[se,J]=p.useState([]),[ie,te]=p.useState(!1),[ne,q]=p.useState(!1),ee=!!d&&!!m&&(E?!!(t!=null&&t.id):!0),X=p.useCallback(async()=>{if(!d||!m){y([]);return}const He=E?t==null?void 0:t.id:i;try{j(!0);const pt={status:r,date_from:d||void 0,date_to:m||void 0,doctor_id:He?Number(He):void 0},{data:Pe}=await Xwe(pt);y(Array.isArray(Pe)?Pe:[])}catch(pt){console.error(pt),y([])}finally{j(!1)}},[r,d,m,i,E,t]);p.useEffect(()=>{X()},[X]);const Z=(He,pt)=>{E||(l(He),c(pt||null))},Y=()=>{if(!(t!=null&&t.id))return ae.error("No logged-in user found");k(He=>{const pt=!He;if(pt)A.current={id:i,meta:o},l(t.id),c({name:(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"My follow-ups"}),ae.success("Showing my follow-ups only");else{const Pe=A.current||{};l((Pe==null?void 0:Pe.id)||null),c((Pe==null?void 0:Pe.meta)||null),ae.success("Showing selected doctor / all follow-ups")}return pt})},Q=He=>{P(He),D(He.due_date),B(He.note||"")},oe=()=>{P(null),D(""),B(""),W(!1)},_e=async He=>{if(He.preventDefault(),!!I)try{W(!0),await Qwe(I.id,{due_date:O,note:T||void 0}),ae.success("Follow-up updated"),oe(),await X()}catch{}finally{W(!1)}},xe=async(He,pt)=>{if(!(He!=null&&He.doctor_id)||!pt){J([]);return}try{q(!0);const{data:Pe}=await Lwe({doctorUserId:He.doctor_id,date:pt});J(Array.isArray(Pe)?Pe:[])}catch{J([])}finally{q(!1)}},me=async He=>{R(He);const pt=He.due_date;G(pt),$(""),J([]),le(!0),q(!1)},Re=()=>{R(null),G(""),$(""),le(!0),J([]),q(!1),te(!1)},Ze=async He=>{const pt=He.target.value;G(pt),V&&!K&&await xe(V,pt)},$e=async()=>{le(!1),V&&F&&await xe(V,F)},fe=()=>{le(!0),$(""),J([])},Me=async He=>{if(He.preventDefault(),!!V){if(!F)return ae.error("Select a date");try{te(!0);const pt={date:F||void 0,...K?{}:H?{slot_start:H}:{}};await Zwe(V.id,pt),ae.success(K||!H?"Follow-up confirmed (Free booking)":"Follow-up scheduled"),Re(),await X()}catch{}finally{te(!1)}}},Ae=p.useMemo(()=>{const He={total:g.length,waiting:0,scheduled:0,completed:0,cancelled:0};for(const pt of g)He[pt.status]!==void 0&&(He[pt.status]+=1);return He},[g]),Ke=p.useMemo(()=>{const He=w.trim().toLowerCase();return He?g.filter(pt=>{const Pe=String(pt.patient_name||"").toLowerCase(),bt=String(pt.patient_uhid||"").toLowerCase(),It=String(pt.patient_phone||"").toLowerCase(),De=String(pt.doctor_name||"").toLowerCase();return Pe.includes(He)||bt.includes(He)||It.includes(He)||De.includes(He)}):g},[g,w]),Le=p.useMemo(()=>{const He=pt=>{if(!pt)return 9e15;const Pe=new Date(pt).getTime();return Number.isFinite(Pe)?Pe:9e15};return[...Ke].sort((pt,Pe)=>He(pt.due_date)-He(Pe.due_date))},[Ke]);return n.jsx("div",{className:Ni.page,children:n.jsxs("div",{className:"mx-auto max-w-6xl px-4 md:px-8 py-6 space-y-4",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:za(Ni.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(14,165,233,0.14),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-sky-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-sky-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-sky-700",children:"Follow-up Tracker"})]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(Pr,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"OPD Follow-ups"}),n.jsxs("p",{className:"mt-1 text-sm text-slate-600",children:["Confirm follow-ups as OPD appointments  ",n.jsx("span",{className:"font-semibold",children:"time is optional (Free booking)"}),"."]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Ni.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),H0(d),"  ",H0(m)]}),(o==null?void 0:o.name)&&n.jsxs("span",{className:Ni.chip,children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),o.name,E?n.jsx("span",{className:"ml-1 opacity-70",children:"(Me)"}):null]}),n.jsxs("span",{className:Ni.chip,children:[n.jsx(sR,{className:"h-3.5 w-3.5"}),Cv[r]||r]}),n.jsxs("button",{type:"button",onClick:Y,className:za(Ni.chipBtn,E&&"bg-slate-900 text-white border-slate-900 hover:text-slate-100 hover:bg-slate-800"),disabled:!(t!=null&&t.id),title:"doctor_id = logged-in user id",children:[E?n.jsx(rd,{className:"h-4 w-4"}):n.jsx(wa,{className:"h-4 w-4"}),"My follow-ups"]}),n.jsxs("span",{className:Ni.chip,children:[n.jsx(uc,{className:"h-3.5 w-3.5"}),"Showing ",n.jsx("span",{className:"tabular-nums",children:Le.length})]})]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:X,className:Ni.chipBtn,disabled:v||!ee,title:"Refresh follow-ups",children:[n.jsx(ps,{className:za("h-4 w-4",v&&"animate-spin")}),"Refresh"]}),n.jsxs("span",{className:Ni.chip,children:["Total ",n.jsx("span",{className:"ml-1 tabular-nums",children:Ae.total})]})]})]}),n.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[n.jsx(kv,{label:"Waiting",value:Ae.waiting,icon:sR,tone:"amber"}),n.jsx(kv,{label:"Scheduled",value:Ae.scheduled,icon:jn,tone:"sky"}),n.jsx(kv,{label:"Completed",value:Ae.completed,icon:Xt,tone:"emerald"}),n.jsx(kv,{label:"Cancelled",value:Ae.cancelled,icon:ca,tone:"slate"})]})]})]}),n.jsxs(dt,{className:za(Ni.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[n.jsxs("div",{className:"grid w-full gap-3 md:grid-cols-[1.6fr,1fr,1fr]",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Follow-ups"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Filter by doctor + date range. Confirm with date only (time optional)."}),n.jsx("div",{className:za("mt-3 rounded-2xl border border-black/50 bg-white/85 px-3 py-2",E&&"opacity-70 pointer-events-none"),title:E?"My follow-ups is ON (doctor locked)":"Select doctor (optional)",children:n.jsx(xc,{value:i,onChange:Z,autoSelectCurrentDoctor:!0})}),E&&n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500 inline-flex items-center gap-1",children:[n.jsx(rd,{className:"h-3.5 w-3.5"}),"Filtering with doctor_id = your user id"]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"From"]}),n.jsx(Ee,{type:"date",value:d,onChange:He=>u(He.target.value),className:"h-11 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"To"]}),n.jsx(Ee,{type:"date",value:m,onChange:He=>x(He.target.value),className:"h-11 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{value:w,onChange:He=>S(He.target.value),placeholder:"Search name / UHID / phone / doctor",className:za(Ni.input,"pl-10")})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"h-11 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>{S(""),a("waiting")},disabled:v,children:"Clear"}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:X,disabled:v||!ee,children:[v?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(ps,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-500 uppercase tracking-wide",children:"Status"}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:Le.length})]})]}),n.jsx(VYe,{value:r,onChange:a})]})}),n.jsxs(it,{className:"pt-4",children:[ee&&v&&n.jsx("div",{className:"space-y-3 py-3",children:[0,1,2,3].map(He=>n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-44 rounded-xl"}),n.jsx(Qe,{className:"h-3 w-72 rounded-xl"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Qe,{className:"h-10 w-24 rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-28 rounded-2xl"})]})]})},He))}),ee&&!v&&Le.length>0&&n.jsx(Fn,{className:"max-h-[62vh] pr-1",children:n.jsx("div",{className:"space-y-2",children:n.jsx(on,{initial:!1,children:Le.map(He=>{const pt=He.slot_start||He.appointment_time||He.time||He.slot||"",Pe=He.status==="scheduled"&&!pt;return n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14},className:"rounded-3xl border border-black/50 bg-white/80 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-semibold text-white tabular-nums",children:H0(He.due_date)}),n.jsx("span",{className:c5(He.status),children:Cv[He.status]||He.status}),pt?n.jsxs("span",{className:Ni.chip,children:[n.jsx(jn,{className:"h-3.5 w-3.5"}),pt]}):null,Pe?n.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-[11px] font-semibold text-emerald-800",children:[n.jsx(Xt,{className:"h-4 w-4"}),"Free booking"]}):null,He.appointment_id&&n.jsxs("span",{className:Ni.chip,children:[n.jsx(Qs,{className:"h-3.5 w-3.5"}),"Appt ",n.jsxs("span",{className:"tabular-nums",children:["#",He.appointment_id]})]})]}),n.jsxs("div",{className:"mt-2 flex items-start gap-3 min-w-0",children:[n.jsx("div",{className:"inline-flex h-11 w-11 shrink-0 items-center justify-center rounded-3xl border border-black/50 bg-black/[0.03] text-[12px] font-semibold text-slate-800",children:String(He.patient_name||"P").split(" ").filter(Boolean).slice(0,2).map(bt=>{var It;return(It=bt[0])==null?void 0:It.toUpperCase()}).join("")||"P"}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"truncate text-[14px] font-semibold text-slate-900",children:He.patient_name||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID ",n.jsx("span",{className:"font-semibold text-slate-700",children:He.patient_uhid||""}),He.patient_phone?n.jsxs(n.Fragment,{children:["  ",n.jsx("span",{className:"font-semibold text-slate-700",children:He.patient_phone})]}):null]})]}),n.jsx("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),"Dr. ",n.jsx("span",{className:"font-semibold text-slate-700",children:He.doctor_name||""})]})}),He.note?n.jsxs("div",{className:"mt-1 text-[11px] text-slate-600",children:["Note: ",He.note]}):null]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[He.status==="waiting"&&n.jsxs(n.Fragment,{children:[n.jsx(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>Q(He),children:"Edit"}),n.jsx(ge,{size:"sm",className:"h-10 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:()=>me(He),children:"Confirm"})]}),He.status==="scheduled"&&He.appointment_id?n.jsx(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>s("/opd/appointments"),children:"Open appointments"}):null]})]})},He.id)})})})})]})]}),n.jsx(PB,{open:!!I,onOpenChange:He=>{He||oe()},title:"Edit Follow-up",subtitle:I?`${I.patient_name}  UHID ${I.patient_uhid}`:"",right:n.jsxs(ge,{type:"button",disabled:U,className:"h-9 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white text-[12px] font-semibold",onClick:He=>_e(He),children:[U?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Save"]}),children:I?n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/80 p-4",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:Ni.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"Due ",n.jsx("span",{className:"tabular-nums",children:H0(I.due_date)})]}),n.jsx("span",{className:c5(I.status),children:Cv[I.status]||I.status})]})}),n.jsxs("form",{onSubmit:_e,className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"Due date"]}),n.jsx(Ee,{type:"date",value:O,onChange:He=>D(He.target.value),className:"h-11 rounded-2xl"})]}),n.jsxs("div",{className:"space-y-2 md:col-span-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Hs,{className:"h-3.5 w-3.5"}),"Note"]}),n.jsx(Ee,{value:T,onChange:He=>B(He.target.value),placeholder:"Short instruction for next visit",className:"h-11 rounded-2xl"})]})]})]}):null}),n.jsx(PB,{open:!!V,onOpenChange:He=>{He||Re()},title:"Confirm Follow-up",subtitle:V?`${V.patient_name}  UHID ${V.patient_uhid}  Dr. ${V.doctor_name||""}`:"",right:n.jsxs(ge,{type:"button",disabled:ie,className:"h-9 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white text-[12px] font-semibold",onClick:He=>Me(He),children:[ie?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Confirm"]}),children:V?n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/80 p-4",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:fe,className:za("rounded-full border px-3 py-1 text-[11px] font-semibold transition",K?"border-slate-900 bg-slate-900 text-white":"border-black/50 bg-white/75 text-slate-700"),children:" Free booking (No time)"}),n.jsx("button",{type:"button",onClick:$e,className:za("rounded-full border px-3 py-1 text-[11px] font-semibold transition",K?"border-black/50 bg-white/75 text-slate-700":"border-slate-900 bg-slate-900 text-white"),children:" Optional time"}),n.jsxs("span",{className:Ni.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),H0(V.due_date)]}),n.jsx("span",{className:c5(V.status),children:Cv[V.status]||V.status})]}),K?n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-[12px] text-emerald-900",children:[n.jsx(Xt,{className:"mt-[1px] h-4 w-4"}),n.jsxs("span",{children:["Free booking means: ",n.jsx("span",{className:"font-semibold",children:"no slot/time is required"}),". Appointment will be created for the date and shown in queue."]})]}):n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2 text-[12px] text-sky-900",children:[n.jsx(jn,{className:"mt-[1px] h-4 w-4"}),n.jsx("span",{children:"Optional time: choose from free slots or type a custom time. (Still not mandatory.)"})]})]})}),n.jsx("form",{onSubmit:Me,className:"space-y-4",children:n.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr,2fr] md:items-start",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"Date"]}),n.jsx(Ee,{type:"date",value:F,onChange:Ze,className:"h-11 rounded-2xl"})]}),K?null:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(jn,{className:"h-3.5 w-3.5"}),"Time (optional)"]}),ne?n.jsx("div",{className:"text-[12px] text-slate-500",children:"Loading slots"}):se.length===0?n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-amber-200 bg-amber-50 px-3 py-2 text-[12px] text-amber-800",children:[n.jsx(Vs,{className:"mt-[1px] h-4 w-4"}),n.jsx("span",{children:"No free slots found. You can type time or leave empty."})]}):n.jsx("div",{className:"flex flex-wrap gap-2",children:se.map(He=>n.jsx("button",{type:"button",onClick:()=>$(He),className:za("rounded-full border px-3 py-1 text-[11px] font-semibold transition",H===He?"border-slate-900 bg-slate-900 text-white":"border-black/50 bg-white/75 text-slate-700 hover:bg-black/[0.03]"),children:He},He))}),n.jsx(Ee,{type:"time",value:H,onChange:He=>$(He.target.value),className:"h-11 rounded-2xl"}),n.jsx("p",{className:"text-[11px] text-slate-500",children:"Leave blank to still confirm as Free booking."})]})]})})]}):null})]})})}const WYe=()=>new Date().toISOString().slice(0,10);function Ed(...t){return t.filter(Boolean).join(" ")}const lo={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-slate-900 px-3 py-1.5 text-[11px] font-semibold text-white hover:bg-slate-800 active:scale-[0.99] transition",input:"h-11 w-full rounded-2xl border border-black/50 bg-white/85 px-3 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"};function Av(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-IN",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})}catch{return t}}function Ev({label:t,value:s,icon:r,tone:a="slate"}){const i=a==="dark"?"bg-slate-900 text-white border-slate-900":a==="rose"?"bg-rose-50 text-rose-900 border-rose-200":"bg-white/80 text-slate-900 border-black/50";return n.jsx("div",{className:Ed("rounded-3xl border px-4 py-3",i),children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-[20px] font-semibold tracking-tight tabular-nums",children:s})]}),r?n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/30",children:n.jsx(r,{className:"h-5 w-5 opacity-80"})}):null]})})}function qYe({open:t,onOpenChange:s,title:r,subtitle:a,right:i,children:l}){return n.jsx(Wa,{open:t,onOpenChange:s,children:n.jsx(va,{className:Ed("p-0 overflow-hidden border border-black/50 bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_rgba(2,6,23,0.18)]","!left-0 !right-0 !bottom-0 !top-auto !translate-x-0 !translate-y-0","w-screen h-[100dvh] rounded-t-3xl rounded-b-none","sm:!left-1/2 sm:!top-1/2 sm:!bottom-auto sm:!-translate-x-1/2 sm:!-translate-y-1/2","sm:w-[92vw] sm:max-w-3xl sm:h-[80vh] sm:rounded-3xl","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=open]:duration-200 data-[state=closed]:duration-150","data-[state=open]:slide-in-from-bottom-10 data-[state=closed]:slide-out-to-bottom-10","sm:data-[state=open]:zoom-in-95 sm:data-[state=closed]:zoom-out-95"),children:n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(244,63,94,0.14),_transparent_60%)] opacity-60"}),n.jsx("div",{className:"relative sm:hidden pt-3",children:n.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-black/15"})}),n.jsx("div",{className:"relative border-b border-black/50 bg-white/55 backdrop-blur-xl",children:n.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3 sm:px-6",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[12px] font-semibold tracking-tight text-slate-900 truncate",children:r}),a?n.jsx("div",{className:"mt-0.5 text-[11px] text-slate-600 truncate",children:a}):null]}),n.jsxs("div",{className:"flex items-center gap-2",children:[i,n.jsx("button",{type:"button",onClick:()=>s(!1),className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl border border-black/50 bg-white/75 hover:bg-black/[0.03] transition",title:"Close",children:n.jsx(ts,{className:"h-4 w-4 text-slate-700"})})]})]})}),n.jsx(Fn,{className:"h-[calc(100dvh-72px)] sm:h-[calc(80vh-56px)]",children:n.jsx("div",{className:"p-4 sm:p-6 pb-[env(safe-area-inset-bottom)]",children:l})})]})})})}function GYe(){const{user:t}=dn()||{},s=Qr(),[r,a]=p.useState(null),[i,l]=p.useState(null),[o,c]=p.useState(WYe()),[d,u]=p.useState([]),[m,x]=p.useState(!1),[g,y]=p.useState(""),[v,j]=p.useState(!1),w=p.useRef({id:null,meta:null}),[S,E]=p.useState(null),[k,A]=p.useState(""),[I,P]=p.useState(""),[O,D]=p.useState(!1),T=!!o&&(v?!!(t!=null&&t.id):!!r),B=v?t==null?void 0:t.id:r,U=p.useCallback(async()=>{if(!o||!T||!B){u([]);return}try{x(!0);const $={for_date:o,doctor_user_id:Number(B),doctor_id:Number(B)};t!=null&&t.department_id&&($.department_id=t.department_id);const{data:K}=await Hwe($);u(Array.isArray(K)?K:[])}catch($){console.error($),u([])}finally{x(!1)}},[o,T,B,t]);p.useEffect(()=>{U()},[U]);const W=($,K)=>{v||(a($),l(K||null))},V=()=>{if(!(t!=null&&t.id))return ae.error("No logged-in user found");j($=>{const K=!$;if(K)w.current={id:r,meta:i},a(t.id),l({name:(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"My no-shows"}),ae.success("Showing my no-show appointments");else{const le=w.current||{};a((le==null?void 0:le.id)||null),l((le==null?void 0:le.meta)||null),ae.success("Showing selected doctor no-shows")}return K})},R=$=>{E($),A($.date),P($.slot_start)},F=async({openQueueAfter:$=!1}={})=>{if(S){if(!k||!I)return ae.error("Select date and time");try{if(D(!0),await Vwe(S.id,{date:k,slot_start:I,create_new:!0}),ae.success("No-show rescheduled as new appointment"),E(null),await U(),$){const K=(S==null?void 0:S.doctor_id)||B;K&&k&&s("/opd/queue",{state:{doctorId:K,date:k}})}}finally{D(!1)}}},G=d.length,H=p.useMemo(()=>{const $=g.trim().toLowerCase();return $?d.filter(K=>{const le=String(K.patient_name||"").toLowerCase(),se=String(K.uhid||"").toLowerCase();return le.includes($)||se.includes($)}):d},[d,g]);return n.jsx("div",{className:lo.page,children:n.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 space-y-4 md:px-8",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:Ed(lo.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(244,63,94,0.14),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-rose-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-rose-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-rose-700",children:"No-show Recovery"})]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(cl,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"No-show Appointments"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Recover missed visits by creating a fresh appointment quickly."}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:lo.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),Av(o)]}),i!=null&&i.name?n.jsxs("span",{className:lo.chip,children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),i.name,v?n.jsx("span",{className:"ml-1 opacity-70",children:"(You)"}):null]}):null,n.jsxs("span",{className:lo.chip,children:[n.jsx(Vs,{className:"h-3.5 w-3.5 text-rose-600"}),"Total ",n.jsx("span",{className:"ml-1 tabular-nums",children:G})]}),n.jsxs("button",{type:"button",onClick:V,className:Ed(lo.chipBtn,v&&"bg-slate-900"),title:"Show only logged-in user's no-shows",disabled:!(t!=null&&t.id),children:[v?n.jsx(rd,{className:"h-4 w-4"}):n.jsx(wa,{className:"h-4 w-4"}),"My no-shows"]})]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:U,className:lo.chipBtn,disabled:m||!T,title:"Refresh",children:[n.jsx(ps,{className:Ed("h-4 w-4",m&&"animate-spin")}),"Refresh"]}),n.jsxs("span",{className:lo.chip,children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:H.length})]})]})]}),n.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[n.jsx(Ev,{label:"Total no-shows",value:G,icon:Vs,tone:"rose"}),n.jsx(Ev,{label:"Selected date",value:Av(o),icon:Ds,tone:"dark"}),n.jsx(Ev,{label:"Filtered",value:H.length,icon:Yt,tone:"slate"}),n.jsx(Ev,{label:"Action",value:"Reschedule",icon:cl,tone:"slate"})]})]})]}),n.jsxs(dt,{className:Ed(lo.glass,"overflow-hidden"),children:[n.jsx(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[n.jsxs("div",{className:"grid w-full gap-3 md:grid-cols-[2fr,1.1fr]",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"No-show List"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Select doctor + date, then reschedule missed visits."}),n.jsx("div",{className:Ed("mt-3 rounded-2xl border border-black/50 bg-white/85 px-3 py-2",v&&"opacity-70 pointer-events-none"),title:v?"My no-shows is ON (doctor locked)":"Select doctor",children:n.jsx(xc,{value:r,onChange:W,autoSelectCurrentDoctor:!0})}),v&&n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500 inline-flex items-center gap-1",children:[n.jsx(rd,{className:"h-3.5 w-3.5"}),"doctor_user_id = your user id"]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500 flex items-center gap-1",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"For date"]}),n.jsx(Ee,{type:"date",value:o,onChange:$=>c($.target.value),className:"h-11 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{value:g,onChange:$=>y($.target.value),placeholder:"Search patient / UHID",className:Ed(lo.input,"pl-10")})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"h-11 rounded-2xl border-black/50 bg-white/85 font-semibold",onClick:()=>y(""),disabled:!T,children:"Clear search"}),n.jsxs(ge,{type:"button",className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",onClick:U,disabled:m||!T,children:[n.jsx(ps,{className:Ed("mr-2 h-4 w-4",m&&"animate-spin")}),"Refresh"]})]})]}),n.jsx(vr,{className:"bg-black/10"})]})}),n.jsxs(it,{className:"pt-4",children:[!T&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"mx-auto mb-3 inline-flex h-12 w-12 items-center justify-center rounded-3xl border border-black/50 bg-white/60",children:n.jsx(Vs,{className:"h-5 w-5 text-slate-600"})}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Select doctor & date"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Or enable My no-shows."})]}),T&&m&&n.jsx("div",{className:"space-y-3 py-3",children:[0,1,2,3].map($=>n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-44 rounded-xl"}),n.jsx(Qe,{className:"h-3 w-72 rounded-xl"})]}),n.jsx(Qe,{className:"h-10 w-28 rounded-2xl"})]})},$))}),T&&!m&&H.length===0&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"mx-auto mb-3 inline-flex h-12 w-12 items-center justify-center rounded-3xl border border-black/50 bg-white/60",children:n.jsx(jn,{className:"h-5 w-5 text-slate-600"})}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No no-shows found"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Try a different doctor/date or clear search."})]}),T&&!m&&H.length>0&&n.jsx(Fn,{className:"max-h-[62vh] pr-1",children:n.jsx("div",{className:"space-y-2",children:n.jsx(on,{initial:!1,children:H.map($=>{const K=($.patient_name||"P").split(" ").filter(Boolean).slice(0,2).map(le=>{var se;return(se=le[0])==null?void 0:se.toUpperCase()}).join("")||"P";return n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14},className:"rounded-3xl border border-black/50 bg-white/80 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"rounded-full bg-slate-900 px-2.5 py-1 text-[11px] font-semibold text-white tabular-nums",children:[Av($.date),"  ",$.slot_start]}),n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-rose-200 bg-rose-50 px-2.5 py-1 text-[11px] font-semibold text-rose-800",children:[n.jsx(Vs,{className:"h-3.5 w-3.5"}),"No-show"]})]}),n.jsxs("div",{className:"mt-2 flex items-start gap-3 min-w-0",children:[n.jsx("div",{className:"inline-flex h-11 w-11 shrink-0 items-center justify-center rounded-3xl border border-black/50 bg-black/[0.03] text-[12px] font-semibold text-slate-800",children:K}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"truncate text-[14px] font-semibold text-slate-900",children:$.patient_name||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID ",n.jsx("span",{className:"font-semibold text-slate-700",children:$.uhid||""})]})]}),n.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:[$.department_name,"  Dr. ",$.doctor_name,"  Purpose:"," ",n.jsx("span",{className:"font-semibold text-slate-700",children:$.purpose||"Consultation"})]})]})]})]}),n.jsx("div",{className:"flex flex-wrap items-center justify-end gap-2",children:n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl font-semibold gap-2 bg-slate-900 hover:bg-slate-800 text-white",onClick:()=>R($),children:[n.jsx(cl,{className:"h-4 w-4"}),"Reschedule"]})})]})},$.id)})})})})]})]}),n.jsx(qYe,{open:!!S,onOpenChange:$=>{$||E(null)},title:"Reschedule No-show",subtitle:S?`${S.patient_name}  UHID ${S.uhid}  Dr. ${S.doctor_name}`:"",right:n.jsxs(n.Fragment,{children:[n.jsxs(ge,{type:"button",disabled:O,variant:"outline",className:"h-9 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold",onClick:()=>F({openQueueAfter:!1}),children:[O?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Create"]}),n.jsxs(ge,{type:"button",disabled:O,className:"h-9 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white text-[12px] font-semibold",onClick:()=>F({openQueueAfter:!0}),children:[O?n.jsx(Rt,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Create & open queue"]})]}),children:S?n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/80 p-4",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:lo.chip,children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"Old: ",Av(S.date),"  ",S.slot_start]}),n.jsxs("span",{className:lo.chip,children:[n.jsx(Vs,{className:"h-3.5 w-3.5 text-rose-600"}),"No-show"]})]})}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"flex items-center gap-1 text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:[n.jsx(Ds,{className:"h-3.5 w-3.5"}),"New date"]}),n.jsx(Ee,{type:"date",value:k,onChange:$=>A($.target.value),className:"h-11 rounded-2xl"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"flex items-center gap-1 text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:[n.jsx(jn,{className:"h-3.5 w-3.5"}),"New time"]}),n.jsx(Ee,{type:"time",value:I,onChange:$=>P($.target.value),className:"h-11 rounded-2xl"})]}),n.jsx("div",{className:"md:col-span-2 text-[12px] text-slate-500",children:"This creates a fresh appointment (keeps the old no-show as history)."})]})]}):null})]})})}function DB(){return new Date().toISOString().slice(0,10)}function MB(t,s){const r=new Date(t);return r.setDate(r.getDate()+s),r.toISOString().slice(0,10)}function IB(t,s){if(!t||!s)return"";try{const r=new Date(t),a=new Date(s),l={day:"2-digit",month:"short",...r.getFullYear()===a.getFullYear()?{}:{year:"numeric"}},o={day:"2-digit",month:"short",year:"numeric"};return`${r.toLocaleDateString("en-IN",l)}  ${a.toLocaleDateString("en-IN",o)}`}catch{return`${t}  ${s}`}}function KYe(){const[t,s]=p.useState(""),[r,a]=p.useState(""),[i,l]=p.useState(null),[o,c]=p.useState(!1),[d,u]=p.useState(null);p.useEffect(()=>{const I=DB(),P=MB(I,-6);s(P),a(I)},[]);const m=p.useCallback(async(I={})=>{var D,T;const P=I.dateFrom||t,O=I.dateTo||r;if(!(!P||!O))try{c(!0);const{data:B}=await n2e({dateFrom:P,dateTo:O,doctorId:i||void 0});u(B)}catch(B){console.error(B),ae.error(((T=(D=B==null?void 0:B.response)==null?void 0:D.data)==null?void 0:T.detail)||"Failed to load OPD dashboard")}finally{c(!1)}},[t,r,i]);p.useEffect(()=>{t&&r&&m()},[t,r,i,m]);const x=I=>{l(I)},g=d||{},y=g.appointments||{},v=g.followups||{},j=g.doctor_stats||[],w=p.useMemo(()=>(j||[]).map(I=>({name:I.doctor_name||`#${I.doctor_id}`,total:I.total_appointments||0,completed:I.completed||0,no_show:I.no_show||0})),[j]),S=g.range||{},E=S.date_from&&S.date_to?IB(S.date_from,S.date_to):IB(t,r),k=y.total??0,A=o&&!d;return n.jsx("div",{className:"min-h-[calc(100vh-5rem)] bg-slate-50 px-4 py-6 md:px-6",children:n.jsxs("div",{className:"mx-auto max-w-6xl space-y-6",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative flex h-2 w-2",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-emerald-500"})]}),n.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-emerald-700",children:"OPD Analytics"})]}),n.jsx("h1",{className:"mt-1 text-2xl font-semibold text-slate-900",children:"OPD Dashboard"}),n.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Quick view of OPD appointments, follow-ups and doctor workload for the selected date range."})]}),n.jsxs("div",{className:"flex flex-col items-start gap-2 text-xs text-slate-500 md:items-end",children:[n.jsxs(et,{variant:"outline",className:"flex items-center gap-1 rounded-full border-slate-500 bg-white px-3 py-1",children:[n.jsx(xp,{className:"h-3 w-3"}),n.jsx("span",{children:E})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(et,{variant:"outline",className:"rounded-full border-slate-500 bg-slate-50 text-[11px]",children:i?"Filtered by specific doctor":"All doctors in OPD"}),n.jsx("span",{className:"text-[11px] text-slate-400",children:o?"Refreshing":"Live clinical summary"})]})]})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"border-b border-slate-100 pb-3",children:[n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-slate-700",children:[n.jsx(xp,{className:"h-4 w-4"}),"Date & Doctor Filters"]}),n.jsx(ge,{type:"button",variant:"outline",size:"sm",onClick:()=>{const I=DB(),P=MB(I,-6);s(P),a(I),l(null)},children:"Last 7 days"})]}),n.jsx(gs,{className:"mt-1 text-xs text-slate-500",children:"Use this view daily for clinical huddle, OPD utilisation review and doctor-wise load balancing."})]}),n.jsxs(it,{className:"space-y-4 pt-4",children:[n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:"From date"}),n.jsx(Ee,{type:"date",value:t,onChange:I=>s(I.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-medium uppercase tracking-[0.16em] text-slate-500",children:"To date"}),n.jsx(Ee,{type:"date",value:r,onChange:I=>a(I.target.value)})]}),n.jsx("div",{className:"flex items-end",children:n.jsx(ge,{type:"button",className:"w-full",variant:"outline",onClick:()=>m({dateFrom:t,dateTo:r}),disabled:o,children:o?"Refreshing":"Refresh"})})]}),n.jsx(xc,{value:i,onChange:x,label:"Filter by doctor (optional)"})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-1",children:n.jsxs(jt,{className:"flex items-center justify-between text-xs font-medium text-slate-500",children:["Total appointments",n.jsx(Qs,{className:"h-4 w-4 text-slate-400"})]})}),n.jsx(it,{children:A?n.jsxs(n.Fragment,{children:[n.jsx(Qe,{className:"mb-1 h-7 w-16"}),n.jsx(Qe,{className:"h-3 w-32"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:y.total??""}),n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Unique patients:"," ",n.jsx("span",{className:"font-semibold",children:y.unique_patients??""})]})]})})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-1",children:n.jsxs(jt,{className:"flex items-center justify-between text-xs font-medium text-slate-500",children:["Completed visits",n.jsx(Xt,{className:"h-4 w-4 text-emerald-500"})]})}),n.jsx(it,{children:A?n.jsxs(n.Fragment,{children:[n.jsx(Qe,{className:"mb-1 h-7 w-16"}),n.jsx(Qe,{className:"h-3 w-40"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:y.completed??""}),n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["In progress:"," ",n.jsx("span",{className:"font-semibold",children:y.in_progress??0})," "," Checked-in:"," ",n.jsx("span",{className:"font-semibold",children:y.checked_in??0})]})]})})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-1",children:n.jsxs(jt,{className:"flex items-center justify-between text-xs font-medium text-slate-500",children:["No-show & cancellations",n.jsx(en,{className:"h-4 w-4 text-amber-500"})]})}),n.jsx(it,{children:A?n.jsxs(n.Fragment,{children:[n.jsx(Qe,{className:"mb-1 h-7 w-16"}),n.jsx(Qe,{className:"h-3 w-32"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:y.no_show??""}),n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Cancelled:"," ",n.jsx("span",{className:"font-semibold",children:y.cancelled??0})]})]})})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-1",children:n.jsxs(jt,{className:"flex items-center justify-between text-xs font-medium text-slate-500",children:["Follow-ups",n.jsx(Hs,{className:"h-4 w-4 text-sky-500"})]})}),n.jsx(it,{children:A?n.jsxs(n.Fragment,{children:[n.jsx(Qe,{className:"mb-1 h-7 w-16"}),n.jsx(Qe,{className:"h-3 w-44"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:v.total??""}),n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Waiting:"," ",n.jsx("span",{className:"font-semibold",children:v.waiting??0})," "," Scheduled:"," ",n.jsx("span",{className:"font-semibold",children:v.scheduled??0})]})]})})]})]}),n.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm lg:col-span-2",children:[n.jsxs(gt,{className:"pb-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(jt,{className:"flex items-center gap-2 text-sm font-medium text-slate-700",children:["Doctor-wise OPD load",n.jsx(uc,{className:"h-4 w-4 text-slate-400"})]}),k>0&&n.jsxs(et,{className:"rounded-full bg-slate-900 text-[11px] font-normal text-white",children:["Total: ",k]})]}),n.jsx(gs,{className:"mt-1 text-xs text-slate-500",children:"Each bar represents total appointments per doctor in the chosen period."})]}),n.jsx(it,{className:"h-72 pt-2",children:w.length===0?n.jsx("div",{className:"flex h-full items-center justify-center text-sm text-slate-500",children:o?"Loading":"No data in selected range"}):n.jsx(mh,{width:"100%",height:"100%",children:n.jsxs(Sw,{data:w,children:[n.jsx(Wb,{dataKey:"name",tick:{fontSize:11},interval:0,height:40}),n.jsx(qb,{}),n.jsx(ph,{}),n.jsx(Hb,{dataKey:"total"})]})})})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsx(gt,{className:"pb-2",children:n.jsxs(jt,{className:"flex items-center justify-between text-sm font-medium text-slate-700",children:["Highlights",n.jsx(FV,{className:"h-4 w-4 text-slate-400"})]})}),n.jsxs(it,{className:"space-y-4 pt-1 text-xs",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50/60 px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"Top by appointments"}),n.jsx(et,{variant:"outline",className:"rounded-full border-emerald-200 bg-emerald-50 text-[10px] text-emerald-700",children:"Volume"})]}),g.top_doctor_by_appointments?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"mt-1 text-[13px] font-medium text-slate-900",children:g.top_doctor_by_appointments.doctor_name}),n.jsxs("p",{className:"mt-0.5 text-[11px] text-slate-500",children:["Dept:"," ",g.top_doctor_by_appointments.department_name||""]}),n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:["Total appointments:"," ",n.jsx("span",{className:"font-semibold",children:g.top_doctor_by_appointments.total_appointments}),n.jsx("br",{}),"No-show:"," ",n.jsx("span",{className:"font-semibold",children:g.top_doctor_by_appointments.no_show}),n.jsx("br",{}),"Follow-ups in range:"," ",n.jsx("span",{className:"font-semibold",children:g.top_doctor_by_appointments.followups_in_range})]})]}):n.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:o?"Calculating":"No doctor data in this range."})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"Top by completed visits"}),n.jsx(et,{variant:"outline",className:"rounded-full border-sky-200 bg-sky-50 text-[10px] text-sky-700",children:"Quality"})]}),g.top_doctor_by_completed?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"mt-1 text-[13px] font-medium text-slate-900",children:g.top_doctor_by_completed.doctor_name}),n.jsxs("p",{className:"mt-0.5 text-[11px] text-slate-500",children:["Dept:"," ",g.top_doctor_by_completed.department_name||""]}),n.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:["Completed visits:"," ",n.jsx("span",{className:"font-semibold",children:g.top_doctor_by_completed.completed})]})]}):n.jsx("p",{className:"mt-1 text-[11px] text-slate-500",children:o?"Calculating":"Waiting for enough completed visits."})]}),n.jsx("p",{className:"text-[10px] leading-relaxed text-slate-500",children:"Use these insights for scheduling next weeks OPD, balancing high-load doctors and monitoring no-show trends."})]})]})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"pb-2",children:[n.jsxs(jt,{className:"flex items-center justify-between text-sm font-medium text-slate-700",children:["Doctor-wise breakdown",n.jsx(uc,{className:"h-4 w-4 text-slate-400"})]}),n.jsx(gs,{className:"mt-1 text-xs text-slate-500",children:"Each row shows total load, outcomes and follow-ups for a doctor in the selected range."})]}),n.jsx(it,{className:"overflow-x-auto pt-2",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b text-xs text-slate-500",children:[n.jsx("th",{className:"py-2 pr-2 text-left",children:"Doctor"}),n.jsx("th",{className:"py-2 px-2 text-left",children:"Department"}),n.jsx("th",{className:"py-2 px-2 text-right",children:"Total"}),n.jsx("th",{className:"py-2 px-2 text-right",children:"Completed"}),n.jsx("th",{className:"py-2 px-2 text-right",children:"No-show"}),n.jsx("th",{className:"py-2 px-2 text-right",children:"Cancelled"}),n.jsx("th",{className:"py-2 pl-2 text-right",children:"Follow-ups"})]})}),n.jsxs("tbody",{children:[j.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"py-4 text-center text-xs text-slate-500",children:o?"Loading":"No data to show"})}),j.map(I=>n.jsxs("tr",{className:"border-b last:border-0 hover:bg-slate-50/70",children:[n.jsx("td",{className:"py-2 pr-2 text-slate-800",children:I.doctor_name}),n.jsx("td",{className:"py-2 px-2 text-slate-600",children:I.department_name||""}),n.jsx("td",{className:"py-2 px-2 text-right",children:I.total_appointments}),n.jsx("td",{className:"py-2 px-2 text-right",children:I.completed}),n.jsx("td",{className:"py-2 px-2 text-right",children:I.no_show}),n.jsx("td",{className:"py-2 px-2 text-right",children:I.cancelled}),n.jsx("td",{className:"py-2 pl-2 text-right",children:I.followups_in_range})]},I.doctor_id))]})]})})]})]})})}function Lc(...t){return t.filter(Boolean).join(" ")}const oo={page:"min-h-[calc(100vh-4rem)] w-full bg-gradient-to-b from-slate-50 via-white to-slate-50",glass:"rounded-3xl border border-black/50 bg-white/75 backdrop-blur-xl shadow-[0_12px_35px_rgba(2,6,23,0.10)]",chip:"inline-flex items-center gap-2 rounded-full border border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",chipBtn:"inline-flex items-center gap-2 rounded-full border bg-green-900 px-3 py-1.5 text-[11px] font-semibold text-white hover:text-black hover:bg-black/[0.03] active:scale-[0.99] transition",input:"h-11 w-full rounded-2xl border border-black/50 bg-white/85 px-3 text-[12px] font-semibold text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-100 focus:border-teal-500"};function Tv({label:t,value:s,icon:r,tone:a="slate"}){const i=a==="dark"?"bg-slate-900 text-white border-slate-900":a==="emerald"?"bg-emerald-50 text-emerald-900 border-emerald-200":a==="sky"?"bg-sky-50 text-sky-900 border-sky-200":"bg-white/80 text-slate-900 border-black/50";return n.jsx("div",{className:Lc("rounded-3xl border px-4 py-3",i),children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-[20px] font-semibold tracking-tight tabular-nums",children:s})]}),r?n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/30",children:n.jsx(r,{className:"h-5 w-5 opacity-80"})}):null]})})}function YYe(){const{user:t}=dn()||{},[s,r]=p.useState(null),[a,i]=p.useState(null),[l,o]=p.useState(""),[c,d]=p.useState(""),[u]=p.useState("INR"),[m,x]=p.useState(null),[g,y]=p.useState([]),[v,j]=p.useState(!1),[w,S]=p.useState(!1),[E,k]=p.useState(null),[A,I]=p.useState(""),[P,O]=p.useState(null),[D,T]=p.useState(!1),B=p.useRef({id:null,meta:null}),[U,W]=p.useState(!1),V=!!(D?t!=null&&t.id:s),R=p.useCallback((se,J)=>{D||(r(se||null),i(J||null))},[D]),F=p.useCallback(async()=>{const se=D?t==null?void 0:t.id:s;if(!se){y([]),x(null),o(""),d("");return}try{j(!0);const{data:J}=await Jwe({doctor_user_id:Number(se)}),ie=Array.isArray(J)?J:[];y(ie);const te=ie[0]||null;x(te||null),te?(o(te.base_fee!=null?String(te.base_fee):""),d(te.followup_fee!=null?String(te.followup_fee):"")):(o(""),d("")),O(new Date)}catch(J){console.error(J),ae.error("Failed to load consultation fees")}finally{j(!1)}},[s,D,t]);p.useEffect(()=>{F()},[F]),p.useEffect(()=>{if(!U||!V)return;const se=setInterval(()=>{!w&&!E&&F()},15e3);return()=>clearInterval(se)},[U,V,w,E,F]);const G=()=>{if(!(t!=null&&t.id)){ae.error("No logged-in user found");return}T(se=>{const J=!se;if(J)B.current={id:s,meta:a},r(t.id),i(ie=>ie||{name:(t==null?void 0:t.name)||(t==null?void 0:t.full_name)||"My profile"}),ae.success("Opened my fee profile");else{const ie=B.current||{};r((ie==null?void 0:ie.id)||null),i((ie==null?void 0:ie.meta)||null),ae.success("Back to selected doctor")}return J})},H=async se=>{var ie,te,ne;(ie=se==null?void 0:se.preventDefault)==null||ie.call(se);const J=D?t==null?void 0:t.id:s;if(!J){ae.error("Select doctor first");return}if(!l||Number(l)<=0){ae.error("Enter a valid base consultation fee");return}try{S(!0);const q={doctor_user_id:Number(J),base_fee:Number(l),currency:u};if(c&&Number(c)>0&&(q.followup_fee=Number(c)),m!=null&&m.id)await u8({...q,id:m.id}),ae.success("Consultation fee updated");else{const{data:ee}=await u8(q);ae.success("Consultation fee created"),x(ee||null)}await F()}catch(q){console.error(q),ae.error(((ne=(te=q==null?void 0:q.response)==null?void 0:te.data)==null?void 0:ne.detail)||"Failed to save fee")}finally{S(!1)}},$=async se=>{var J,ie;if(se!=null&&se.id&&window.confirm("Delete this consultation fee?"))try{k(se.id),await s2e(se.id),ae.success("Fee deleted"),y(te=>te.filter(ne=>ne.id!==se.id)),(m==null?void 0:m.id)===se.id&&(x(null),o(""),d(""))}catch(te){console.error(te),ae.error(((ie=(J=te==null?void 0:te.response)==null?void 0:J.data)==null?void 0:ie.detail)||"Failed to delete fee")}finally{k(null)}},K=p.useMemo(()=>{const se=A.trim().toLowerCase();return se?g.filter(J=>String(J.doctor_name||"").toLowerCase().includes(se)):g},[g,A]),le=p.useMemo(()=>{const se=g.length,J=g.filter(ie=>ie.is_active!==!1).length;return{total:se,active:J}},[g]);return n.jsx("div",{className:oo.page,children:n.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 space-y-4 md:px-8",children:[n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:Lc(oo.glass,"relative overflow-hidden"),children:[n.jsx("div",{className:"absolute inset-0 opacity-60 bg-[radial-gradient(circle_at_top,_rgba(16,185,129,0.16),_transparent_60%)]"}),n.jsxs("div",{className:"relative p-5 md:p-7",children:[n.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"relative inline-flex h-2.5 w-2.5",children:[n.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-500 opacity-75"}),n.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-500"})]}),n.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-[0.2em] text-emerald-700",children:"Real-time Master"})]}),n.jsxs("div",{className:"mt-3 flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 items-center justify-center rounded-3xl bg-black/[0.04] border border-black/50",children:n.jsx(Qi,{className:"h-5 w-5 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight text-slate-900",children:"Doctor Consultation Fees"}),n.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Configure base and follow-up pricing  used across OPD billing & auto-pricing."}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:oo.chip,children:[n.jsx(Qs,{className:"h-3.5 w-3.5"}),"Active ",n.jsx("span",{className:"ml-1 tabular-nums",children:le.active})]}),a!=null&&a.name?n.jsxs("span",{className:oo.chip,children:[n.jsx(wa,{className:"h-3.5 w-3.5"}),a.name,D?n.jsx("span",{className:"ml-1 opacity-70",children:"(You)"}):null]}):null,n.jsxs("button",{type:"button",onClick:G,className:Lc(oo.chipBtn,D&&"bg-slate-900 text-white border-slate-900 hover:bg-slate-800"),title:"Open logged-in user profile",children:[D?n.jsx(rd,{className:"h-4 w-4"}):n.jsx(wa,{className:"h-4 w-4"}),"My profile"]}),n.jsxs("button",{type:"button",onClick:()=>W(se=>!se),className:Lc(oo.chipBtn,U&&"bg-slate-900 text-white border-slate-900 hover:bg-slate-800"),title:"Auto refresh every 15s",disabled:!V,children:[n.jsx(Qs,{className:"h-4 w-4"}),"Auto refresh"]}),P&&n.jsxs("span",{className:oo.chip,children:[n.jsx(jn,{className:"h-3.5 w-3.5"}),"Synced"," ",n.jsx("span",{className:"ml-1 tabular-nums",children:P.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]})]})]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 md:justify-end",children:[n.jsxs("button",{type:"button",onClick:F,className:oo.chipBtn,disabled:v||!V,title:"Refresh",children:[n.jsx(ps,{className:Lc("h-4 w-4",v&&"animate-spin")}),"Refresh"]}),n.jsxs("span",{className:oo.chip,children:["Total ",n.jsx("span",{className:"ml-1 tabular-nums",children:le.total})]})]})]}),n.jsxs("div",{className:"mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[n.jsx(Tv,{label:"Configured rows",value:le.total,icon:Xt,tone:"dark"}),n.jsx(Tv,{label:"Active rows",value:le.active,icon:Qs,tone:"emerald"}),n.jsx(Tv,{label:"Currency",value:u,icon:Qi,tone:"sky"}),n.jsx(Tv,{label:"Mode",value:U?"Live":"Manual",icon:ps,tone:"slate"})]})]})]}),n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.05fr,0.95fr]",children:[n.jsxs(dt,{className:Lc(oo.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Configure Fee"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Select doctor, enter fees, and save instantly."})]}),n.jsxs(it,{className:"pt-4 space-y-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:Lc("rounded-2xl border border-black/50 bg-white/85 px-3 py-2",D&&"opacity-70 pointer-events-none"),title:D?"My profile ON (doctor locked)":"Select doctor",children:n.jsx(xc,{value:s,onChange:R,autoSelectCurrentDoctor:!0})}),!V&&n.jsx("p",{className:"mt-2 text-[11px] text-amber-700 font-semibold",children:"Select a doctor (or use My profile) to manage consultation fees."})]}),n.jsx(vr,{className:"bg-black/10"}),n.jsxs("form",{onSubmit:H,className:"space-y-4",children:[n.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs("label",{className:"text-[11px] font-semibold uppercase tracking-[0.16em] text-slate-500",children:["Base consultation fee (",u,")"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-2xl border border-black/50 bg-white/70",children:n.jsx(Qi,{className:"h-4 w-4 text-slate-600"})}),n.jsx(Ee,{type:"number",min:0,step:"50",value:l,onChange:se=>o(se.target.value),className:"h-11 rounded-2xl border-black/50 bg-white/85 text-[12px] font-semibold",placeholder:"e.g. 500"})]})]})}),n.jsx("div",{className:"flex items-center justify-end gap-2",children:n.jsxs(ge,{type:"submit",disabled:!V||w,className:"h-11 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-semibold",children:[n.jsx(Pi,{className:"mr-2 h-4 w-4"}),w?"Saving":m?"Update Fee":"Save Fee"]})})]})]})]}),n.jsxs(dt,{className:Lc(oo.glass,"overflow-hidden"),children:[n.jsxs(gt,{className:"border-b border-black/50 bg-white/60 backdrop-blur-xl",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base md:text-lg font-semibold text-slate-900",children:"Existing Fees"}),n.jsx(gs,{className:"text-[12px] text-slate-600",children:"Saved fee rows for the selected doctor."})]}),n.jsxs(et,{variant:"outline",className:"rounded-full border-black/50 bg-white/85 px-3 py-1 text-[11px] font-semibold text-slate-700",children:["Showing ",n.jsx("span",{className:"ml-1 tabular-nums",children:K.length})]})]}),n.jsxs("div",{className:"mt-3 relative",children:[n.jsx(Yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),n.jsx("input",{value:A,onChange:se=>I(se.target.value),placeholder:"Search doctor name",className:Lc(oo.input,"pl-10")})]})]}),n.jsxs(it,{className:"pt-4",children:[!V&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No doctor selected"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Pick a doctor to view existing fee rows."})]}),V&&v&&n.jsx("div",{className:"space-y-2",children:[1,2,3].map(se=>n.jsx("div",{className:"rounded-3xl border border-black/50 bg-white/70 backdrop-blur px-4 py-3",children:n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx(Qe,{className:"h-4 w-40 rounded-xl"}),n.jsx(Qe,{className:"h-3 w-64 rounded-xl"})]}),n.jsx(Qe,{className:"h-10 w-10 rounded-2xl"})]})},se))}),V&&!v&&K.length===0&&n.jsxs("div",{className:"rounded-3xl border border-dashed border-black/20 bg-black/[0.02] px-6 py-10 text-center",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"No fee configured"}),n.jsx("p",{className:"mt-1 text-[12px] text-slate-500",children:"Enter fees on the left and save."})]}),V&&!v&&K.length>0&&n.jsx(Fn,{className:"max-h-[58vh] pr-1",children:n.jsx("div",{className:"space-y-2",children:n.jsx(on,{initial:!1,children:K.map(se=>n.jsx(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.14},className:"rounded-3xl border border-black/50 bg-white/80 backdrop-blur px-4 py-3 shadow-[0_10px_24px_rgba(2,6,23,0.08)]",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("div",{className:"truncate text-[14px] font-semibold text-slate-900",children:se.doctor_name||(a==null?void 0:a.name)||"Selected doctor"}),n.jsx("span",{className:Lc("rounded-full border px-2.5 py-1 text-[11px] font-semibold",se.is_active===!1?"border-slate-500 bg-slate-100 text-slate-600":"border-emerald-200 bg-emerald-50 text-emerald-800"),children:se.is_active===!1?"Inactive":"Active"})]}),n.jsx("div",{className:"mt-1 text-[11px] text-slate-500",children:"Standard OPD consultation pricing used during billing."})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"text-right text-xs text-slate-600",children:n.jsxs("div",{className:"font-semibold text-slate-900 border-b ",children:["Base:",n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Qi,{className:"h-3.5 w-3.5 text-slate-500"}),n.jsx("span",{className:"tabular-nums",children:se.base_fee})]})]})}),n.jsx(ge,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-2xl text-slate-400 hover:text-rose-600",onClick:()=>$(se),disabled:E===se.id,title:"Delete fee row",children:n.jsx(Ms,{className:"h-4 w-4"})})]})]})},se.id))})})})]})]})]})]})})}var uS="Switch",[XYe]=fc(uS),[QYe,ZYe]=XYe(uS),tne=p.forwardRef((t,s)=>{const{__scopeSwitch:r,name:a,checked:i,defaultChecked:l,required:o,disabled:c,value:d="on",onCheckedChange:u,form:m,...x}=t,[g,y]=p.useState(null),v=Fs(s,k=>y(k)),j=p.useRef(!1),w=g?m||!!g.closest("form"):!0,[S,E]=pm({prop:i,defaultProp:l??!1,onChange:u,caller:uS});return n.jsxs(QYe,{scope:r,checked:S,disabled:c,children:[n.jsx(us.button,{type:"button",role:"switch","aria-checked":S,"aria-required":o,"data-state":ane(S),"data-disabled":c?"":void 0,disabled:c,value:d,...x,ref:v,onClick:zt(t.onClick,k=>{E(A=>!A),w&&(j.current=k.isPropagationStopped(),j.current||k.stopPropagation())})}),w&&n.jsx(rne,{control:g,bubbles:!j.current,name:a,value:d,checked:S,required:o,disabled:c,form:m,style:{transform:"translateX(-100%)"}})]})});tne.displayName=uS;var sne="SwitchThumb",nne=p.forwardRef((t,s)=>{const{__scopeSwitch:r,...a}=t,i=ZYe(sne,r);return n.jsx(us.span,{"data-state":ane(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:s})});nne.displayName=sne;var JYe="SwitchBubbleInput",rne=p.forwardRef(({__scopeSwitch:t,control:s,checked:r,bubbles:a=!0,...i},l)=>{const o=p.useRef(null),c=Fs(o,l),d=gP(r),u=UT(s);return p.useEffect(()=>{const m=o.current;if(!m)return;const x=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(x,"checked").set;if(d!==r&&y){const v=new Event("click",{bubbles:a});y.call(m,r),m.dispatchEvent(v)}},[d,r,a]),n.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:c,style:{...i.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});rne.displayName=JYe;function ane(t){return t?"checked":"unchecked"}var ine=tne,eXe=nne;const Wc=p.forwardRef(({className:t,...s},r)=>n.jsx(ine,{className:Bt("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:n.jsx(eXe,{className:Bt("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Wc.displayName=ine.displayName;function tXe(t,s){const r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=s,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(r)}function sXe({open:t,onOpenChange:s,onImported:r}){const[a,i]=p.useState(null),[l,o]=p.useState(!1),[c,d]=p.useState(null),[u,m]=p.useState(!1),[x,g]=p.useState(!1),[y,v]=p.useState(!0),[j,w]=p.useState(!1),[S,E]=p.useState(""),k=(c==null?void 0:c.errors)||[],A=(c==null?void 0:c.total_rows)??0,I=(c==null?void 0:c.valid_rows)??Math.max(0,A-k.length),P=k.length,O=p.useMemo(()=>{const V=S.trim().toLowerCase();return V?k.filter(R=>`${R.row} ${R.code||""} ${R.column||""} ${R.message||""}`.toLowerCase().includes(V)):k},[k,S]),D=!!a&&!!c&&(!y||P===0);function T(){i(null),d(null),E(""),v(!0),w(!1),o(!1)}async function B(V){try{const R=await NK(V);tXe(R.data,V==="xlsx"?"items_template.xlsx":"items_template.csv"),ae.success(`${V.toUpperCase()} template downloaded`)}catch{}}async function U(V){var R;if(V){i(V),d(null),E(""),m(!0);try{const F=await p_e(V);d(F.data);const G=((R=F.data)==null?void 0:R.errors)||[];G.length?ae.warning(`Found ${G.length} issue(s). Fix & re-upload.`):ae.success("Preview looks good ")}catch{d(null)}finally{m(!1)}}}async function W(){var V,R;if(!a)return ae.error("Choose a file first");if(!c)return ae.error("Preview first");g(!0);try{const F=await f_e(a,{updateBlanks:j,strict:y});ae.success(`Imported  Created: ${F.data.created}, Updated: ${F.data.updated}`),r==null||r(F.data),s(!1),T()}catch(F){const G=(R=(V=F==null?void 0:F.response)==null?void 0:V.data)==null?void 0:R.detail;Array.isArray(G)&&(d(H=>({...H||{},errors:G})),ae.error(`Fix ${G.length} error(s) and re-upload`))}finally{g(!1)}}return n.jsx(Wa,{open:t,onOpenChange:V=>{V||T(),s(V)},children:n.jsx(va,{className:"rounded-3xl w-[96vw] max-w-5xl p-0 overflow-hidden",children:n.jsxs("div",{className:"max-h-[88vh] overflow-auto p-6",children:[n.jsxs(ii,{className:"space-y-2",children:[n.jsxs(li,{className:"flex items-center justify-between gap-3",children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(AV,{className:"h-5 w-5"}),"Bulk Upload Items (CSV / Excel)"]}),n.jsx(ge,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>s(!1),children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-[1fr,auto] md:items-center",children:[n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs(ge,{variant:"outline",className:"rounded-2xl gap-2",onClick:()=>B("csv"),children:[n.jsx(nn,{className:"h-4 w-4"}),"Template CSV"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl gap-2",onClick:()=>B("xlsx"),children:[n.jsx(nn,{className:"h-4 w-4"}),"Template Excel"]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 justify-start md:justify-end",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Wc,{checked:y,onCheckedChange:v}),n.jsx(xt,{className:"text-sm whitespace-nowrap",children:"Strict (recommended)"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Wc,{checked:j,onCheckedChange:w}),n.jsx(xt,{className:"text-sm whitespace-nowrap",children:"Overwrite blanks"})]})]})]})]}),n.jsx("div",{className:["mt-4 rounded-3xl border border-dashed p-5 transition",l?"bg-slate-50 border-slate-400":"bg-white border-slate-500"].join(" "),onDragOver:V=>{V.preventDefault(),o(!0)},onDragLeave:()=>o(!1),onDrop:V=>{var F;V.preventDefault(),o(!1);const R=(F=V.dataTransfer.files)==null?void 0:F[0];R&&U(R)},children:n.jsxs("div",{className:"grid gap-4 md:grid-cols-[1fr,auto] md:items-center",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx(Nh,{className:"h-4 w-4"}),"Drag & drop file here"]}),n.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Supports: .csv, .tsv, .txt, .xlsx"}),n.jsxs("div",{className:"text-xs text-slate-700 mt-2",children:["Selected: ",n.jsx("span",{className:"font-medium",children:(a==null?void 0:a.name)||""})]})]}),n.jsxs("div",{className:"flex items-center gap-2 md:justify-end",children:[n.jsx("input",{id:"items-upload",type:"file",accept:".csv,.tsv,.txt,.xlsx",className:"hidden",onChange:V=>{var F;const R=(F=V.target.files)==null?void 0:F[0];R&&U(R)}}),n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>{var V;return(V=document.getElementById("items-upload"))==null?void 0:V.click()},disabled:u||x,children:"Choose file"}),n.jsx(ge,{className:"rounded-2xl",onClick:()=>a&&U(a),disabled:!a||u||x,children:u?"Previewing":"Preview"})]})]})}),c?n.jsxs("div",{className:"mt-4 rounded-3xl border border-slate-500 bg-white p-4 space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(et,{variant:"outline",className:"text-xs rounded-xl",children:["File: ",(c.file_type||"").toUpperCase()]}),n.jsxs(et,{variant:"outline",className:"text-xs rounded-xl",children:["Total: ",A]}),n.jsxs(et,{variant:"outline",className:"text-xs rounded-xl",children:["Valid: ",I]}),P?n.jsxs(et,{className:"text-xs rounded-xl bg-rose-600",children:["Errors: ",P]}):n.jsx(et,{className:"text-xs rounded-xl bg-emerald-600",children:"No errors"})]}),n.jsx(vr,{}),n.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"text-sm font-semibold flex items-center gap-2",children:[P?n.jsx(en,{className:"h-4 w-4 text-rose-600"}):n.jsx(Xt,{className:"h-4 w-4 text-emerald-600"}),"Validation"]}),P?n.jsx(Ee,{placeholder:"Search errors...",className:"w-44 bg-white rounded-2xl",value:S,onChange:V=>E(V.target.value)}):null]}),n.jsx("div",{className:"rounded-2xl border border-slate-500 overflow-hidden",children:n.jsx("div",{className:"max-h-64 overflow-auto",children:P===0?n.jsx("div",{className:"p-3 text-sm text-slate-600",children:"All rows look valid "}):O.length===0?n.jsx("div",{className:"p-3 text-sm text-slate-600",children:"No matching errors"}):n.jsx("div",{className:"divide-y",children:O.slice(0,80).map((V,R)=>n.jsxs("div",{className:"p-3 text-xs",children:[n.jsxs("div",{className:"font-semibold text-slate-900",children:["Row ",V.row," ",V.code?` ${V.code}`:""," ",V.column?` ${V.column}`:""]}),n.jsx("div",{className:"text-slate-600 mt-1",children:V.message})]},R))})})}),n.jsx("div",{className:"text-xs text-slate-500",children:"Tip: Fix errors in Excel and re-upload. Strict mode prevents partial imports (best for NABH audit)."})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold",children:"Preview (valid rows)"}),n.jsx("div",{className:"rounded-2xl border border-slate-500 overflow-hidden",children:n.jsx("div",{className:"max-h-64 overflow-auto",children:n.jsxs("div",{className:"min-w-[640px]",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-2 px-3 py-2 text-[11px] font-semibold text-slate-500 bg-slate-50",children:[n.jsx("span",{children:"Code"}),n.jsx("span",{children:"Name"}),n.jsx("span",{children:"Generic"}),n.jsx("span",{className:"text-right",children:"Price"})]}),n.jsx("div",{className:"divide-y",children:(c.sample_rows||[]).slice(0,30).map((V,R)=>n.jsxs("div",{className:"grid grid-cols-4 gap-2 px-3 py-2 text-xs",children:[n.jsx("span",{className:"text-slate-700",children:V.code||""}),n.jsx("span",{className:"font-medium text-slate-900 truncate",children:V.name||""}),n.jsx("span",{className:"text-slate-600 truncate",children:V.generic_name||""}),n.jsx("span",{className:"text-right text-slate-700",children:V.default_price??""})]},R))})]})})}),n.jsx("div",{className:"text-xs text-slate-500",children:"Note: Item defaults are for prefill only. Actual selling/billing uses batch MRP from GRN (FEFO)."})]})]})]}):null,n.jsxs("div",{className:"sticky bottom-0 mt-6 -mx-6 px-6 py-4 bg-white border-t border-slate-500 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:T,disabled:u||x,children:"Reset"}),n.jsx(ge,{className:"rounded-2xl",onClick:W,disabled:!D||u||x,children:x?"Importing":y?"Commit Import":"Commit (Non-strict)"})]})]})})})}const Hx=t=>{if(!t)return"";try{return new Date(t).toLocaleDateString()}catch{return String(t)}},Cj=t=>{const s=Number(t);return Number.isFinite(s)?s:0},OB=t=>Cj(t).toFixed(2);function nXe(t,s){const r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=s,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(r)}const W0={DRAFT:"Draft",SENT:"Sent",PARTIALLY_RECEIVED:"Partial",COMPLETED:"Completed",CANCELLED:"Cancelled",CLOSED:"Closed",APPROVED:"Approved"},rXe={DRAFT:["DRAFT","SENT","CANCELLED"],APPROVED:["APPROVED","SENT","CANCELLED"],SENT:["SENT","PARTIALLY_RECEIVED","COMPLETED","CANCELLED","CLOSED"],PARTIALLY_RECEIVED:["PARTIALLY_RECEIVED","COMPLETED","CLOSED"],COMPLETED:["COMPLETED","CLOSED"],CLOSED:["CLOSED"],CANCELLED:["CANCELLED"]};function aXe(){var le,se,J,ie;const[t,s]=p.useState(!0),[r,a]=p.useState([]),[i,l]=p.useState([]),[o,c]=p.useState([]),d=p.useMemo(()=>{const te=new Map;return i.forEach(ne=>te.set(ne.id,ne)),te},[i]),u=p.useMemo(()=>{const te=new Map;return o.forEach(ne=>te.set(ne.id,ne)),te},[o]),[m,x]=p.useState(""),[g,y]=p.useState("ALL"),[v,j]=p.useState(!1),[w,S]=p.useState(null),[E,k]=p.useState({open:!1,poId:null,email:""}),[A,I]=p.useState(!1),[P,O]=p.useState(null),[D,T]=p.useState({open:!1,poId:null,reason:""});async function B(){try{const[te,ne]=await Promise.all([px(),_K()]);l(te.data||[]),c(ne.data||[])}catch(te){console.error(te)}}async function U(){s(!0);try{const te={};g&&g!=="ALL"&&(te.status=g),m!=null&&m.trim()&&(te.q=m.trim());const ne=await wK(te);a(ne.data||[])}catch(te){console.error(te),ae.error("Failed to load purchase orders")}finally{s(!1)}}p.useEffect(()=>{B(),U()},[]);const W=p.useMemo(()=>{const te=m.trim().toLowerCase();return te?r.filter(ne=>{var Z,Y,Q,oe;const q=((Z=ne.supplier)==null?void 0:Z.name)||((Y=d.get(ne.supplier_id))==null?void 0:Y.name)||"",ee=((Q=ne.location)==null?void 0:Q.name)||((oe=u.get(ne.location_id))==null?void 0:oe.name)||"";return`${ne.po_number} ${q} ${ee} ${ne.status}`.toLowerCase().includes(te)}):r},[r,m,d,u]);async function V(te){try{const ne=await S_e(te.id);nXe(ne.data,`PO_${te.po_number||te.id}.pdf`)}catch{ae.error("Failed to download PO PDF")}}async function R(te,ne){var q,ee;try{await x8(te,ne),ae.success(`PO status updated: ${W0[ne]||ne}`),U()}catch(X){ae.error(((ee=(q=X==null?void 0:X.response)==null?void 0:q.data)==null?void 0:ee.detail)||"Failed to change status")}}async function F(){var te,ne,q;if(!((te=E.email)!=null&&te.trim())){ae.error("Enter supplier email");return}I(!0);try{await C_e(E.poId,E.email.trim()),ae.success("PO emailed & marked SENT"),k({open:!1,poId:null,email:""}),U()}catch(ee){ae.error(((q=(ne=ee==null?void 0:ee.response)==null?void 0:ne.data)==null?void 0:q.detail)||"Failed to send email")}finally{I(!1)}}function G(){S(null),j(!0)}function H(te){S(te),j(!0)}function $(te){T({open:!0,poId:te,reason:""})}async function K(){var te,ne;if(!D.reason.trim()){ae.error("Cancel reason required");return}try{await x8(D.poId,"CANCELLED"),ae.success("PO cancelled"),T({open:!1,poId:null,reason:""}),U()}catch(q){ae.error(((ne=(te=q==null?void 0:q.response)==null?void 0:te.data)==null?void 0:ne.detail)||"Failed to cancel PO")}}return n.jsxs(n.Fragment,{children:[n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"flex flex-row items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Purchase orders",n.jsx(et,{variant:"outline",className:"text-xs",children:W.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Create POs, print PDF, email supplier, and track receipt status."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"gap-1",onClick:U,children:[n.jsx(ps,{className:"w-3 h-3"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"gap-1",onClick:G,children:[n.jsx(ds,{className:"w-3 h-3"}),"New PO"]})]})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[n.jsxs("div",{className:"relative w-full sm:w-96",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-2.5 text-slate-400"}),n.jsx(Ee,{value:m,onChange:te=>x(te.target.value),placeholder:"Search PO number / supplier / location...",className:"pl-9 bg-white rounded-2xl",onKeyDown:te=>te.key==="Enter"&&U()})]}),n.jsx(ge,{variant:"outline",size:"icon",className:"rounded-full",onClick:U,children:n.jsx(Yt,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(Zs,{value:g,onValueChange:y,children:[n.jsx(Ws,{className:"h-9 w-48 rounded-2xl bg-white",children:n.jsx(Js,{placeholder:"Status"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"ALL",children:"All statuses"}),n.jsx(Ut,{value:"DRAFT",children:"Draft"}),n.jsx(Ut,{value:"SENT",children:"Sent"}),n.jsx(Ut,{value:"PARTIALLY_RECEIVED",children:"Partially received"}),n.jsx(Ut,{value:"COMPLETED",children:"Completed"}),n.jsx(Ut,{value:"CLOSED",children:"Closed"}),n.jsx(Ut,{value:"CANCELLED",children:"Cancelled"})]})]}),n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:U,children:"Apply"})]})]}),n.jsxs("div",{className:"hidden sm:block border border-slate-500 rounded-2xl overflow-hidden bg-white",children:[n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,1.2fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50",children:[n.jsx("span",{children:"PO number"}),n.jsx("span",{children:"Supplier"}),n.jsx("span",{children:"Location / dates"}),n.jsx("span",{children:"Status"}),n.jsx("span",{className:"text-right",children:"Actions"})]}),n.jsx("div",{className:"max-h-[440px] overflow-auto divide-y divide-slate-100",children:t?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):W.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No purchase orders found."}):W.map(te=>{const ne=te.supplier||d.get(te.supplier_id),q=te.location||u.get(te.location_id),ee=rXe[te.status]||[te.status];return n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,1.2fr] items-center px-3 py-2 text-xs",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-900",children:te.po_number}),n.jsxs("p",{className:"text-slate-500",children:["Created: ",Hx(te.order_date)]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-900",children:(ne==null?void 0:ne.name)||""}),n.jsx("p",{className:"text-slate-500 text-[11px]",children:(ne==null?void 0:ne.phone)||(ne==null?void 0:ne.email)||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-900",children:(q==null?void 0:q.name)||""}),n.jsxs("p",{className:"text-slate-500 text-[11px]",children:["Exp: ",te.expected_date?Hx(te.expected_date):""]})]}),n.jsx("div",{children:n.jsx(et,{variant:"outline",className:"text-[10px] capitalize",children:(W0[te.status]||te.status).toLowerCase()})}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(ge,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>O(te),title:"View",children:n.jsx(Wr,{className:"w-3 h-3"})}),n.jsx(ge,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>V(te),title:"Print PDF",children:n.jsx(Ll,{className:"w-3 h-3"})}),n.jsx(ge,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>k({open:!0,poId:te.id,email:te.email_sent_to||(ne==null?void 0:ne.email)||""}),title:"Email PO",children:n.jsx(Qp,{className:"w-3 h-3"})}),te.status==="DRAFT"?n.jsx(ge,{variant:"outline",size:"sm",className:"h-7 rounded-2xl text-[11px]",onClick:()=>H(te),children:"Edit"}):null,ee.length>1&&(te.status==="DRAFT"||te.status==="SENT")?n.jsxs(Zs,{value:te.status,onValueChange:X=>{if(X==="CANCELLED")return $(te.id);R(te.id,X)},children:[n.jsx(Ws,{className:"h-7 w-36 text-[11px] bg-white rounded-2xl",children:n.jsx(Js,{})}),n.jsx(qs,{children:ee.map(X=>n.jsxs(Ut,{value:X,children:["avoid",W0[X]||X]},X))})]}):n.jsx(et,{variant:"outline",className:"text-[10px] capitalize",children:(W0[te.status]||te.status).toLowerCase()}),te.status!=="CANCELLED"&&te.status!=="CLOSED"?n.jsx(ge,{variant:"ghost",size:"icon",className:"h-7 w-7 text-rose-600",onClick:()=>$(te.id),title:"Cancel",children:n.jsx(Ms,{className:"w-3 h-3"})}):null]})]},te.id)})})]}),n.jsx("div",{className:"sm:hidden space-y-3",children:t?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-20 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-20 w-full rounded-2xl"})]}):W.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500 border rounded-2xl bg-white",children:"No purchase orders found."}):W.map(te=>{const ne=te.supplier||d.get(te.supplier_id),q=te.location||u.get(te.location_id);return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white p-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:te.po_number}),n.jsxs("div",{className:"text-xs text-slate-500",children:[(ne==null?void 0:ne.name)||"","  ",(q==null?void 0:q.name)||""]}),n.jsxs("div",{className:"text-xs text-slate-500",children:["Created: ",Hx(te.order_date),"  Exp: ",te.expected_date?Hx(te.expected_date):""]})]}),n.jsx(et,{variant:"outline",className:"text-[10px] capitalize",children:(W0[te.status]||te.status).toLowerCase()})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[n.jsx(ge,{variant:"outline",size:"sm",className:"rounded-2xl",onClick:()=>O(te),children:"View"}),n.jsx(ge,{variant:"outline",size:"sm",className:"rounded-2xl",onClick:()=>V(te),children:"PDF"}),te.status==="DRAFT"?n.jsx(ge,{size:"sm",className:"rounded-2xl",onClick:()=>H(te),children:"Edit"}):null]})]},te.id)})})]})]}),n.jsx(iXe,{open:v,onOpenChange:j,suppliers:i,locations:o,initialPo:w,onSaved:()=>{j(!1),S(null),U()}}),n.jsx(Wa,{open:E.open,onOpenChange:te=>k(ne=>({...ne,open:te})),children:n.jsxs(va,{className:"rounded-3xl max-w-md",children:[n.jsx(ii,{children:n.jsx(li,{children:"Email Purchase Order"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{children:"Supplier email"}),n.jsx(Ee,{value:E.email,onChange:te=>k(ne=>({...ne,email:te.target.value})),placeholder:"supplier@email.com",className:"rounded-2xl bg-white"}),n.jsxs("p",{className:"text-xs text-slate-500",children:["This will send PO PDF and mark status as ",n.jsx("b",{children:"SENT"}),"."]})]}),n.jsxs(Kc,{className:"gap-2 sm:gap-2",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>k({open:!1,poId:null,email:""}),disabled:A,children:"Cancel"}),n.jsx(ge,{className:"rounded-2xl",onClick:F,disabled:A,children:A?"Sending":"Send"})]})]})}),n.jsx(Wa,{open:D.open,onOpenChange:te=>T(ne=>({...ne,open:te})),children:n.jsxs(va,{className:"rounded-3xl max-w-md",children:[n.jsx(ii,{children:n.jsx(li,{children:"Cancel PO"})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(xt,{children:"Reason"}),n.jsx(fs,{value:D.reason,onChange:te=>T(ne=>({...ne,reason:te.target.value})),placeholder:"Enter cancel reason",className:"rounded-2xl bg-white"})]}),n.jsxs(Kc,{className:"gap-2",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>T({open:!1,poId:null,reason:""}),children:"Close"}),n.jsx(ge,{className:"rounded-2xl",onClick:K,children:"Cancel PO"})]})]})}),n.jsx(Wa,{open:!!P,onOpenChange:te=>!te&&O(null),children:n.jsxs(va,{className:"rounded-3xl max-w-3xl",children:[n.jsx(ii,{children:n.jsxs(li,{className:"flex items-center justify-between",children:[n.jsx("span",{children:"PO Details"}),n.jsx(et,{variant:"outline",className:"text-xs",children:P==null?void 0:P.po_number})]})}),n.jsxs("div",{className:"grid gap-2 sm:grid-cols-3 text-xs",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-500",children:"Supplier"}),n.jsx("div",{className:"text-slate-900 font-medium",children:((le=P==null?void 0:P.supplier)==null?void 0:le.name)||((se=d.get(P==null?void 0:P.supplier_id))==null?void 0:se.name)||""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-500",children:"Location"}),n.jsx("div",{className:"text-slate-900 font-medium",children:((J=P==null?void 0:P.location)==null?void 0:J.name)||((ie=u.get(P==null?void 0:P.location_id))==null?void 0:ie.name)||""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-500",children:"Dates"}),n.jsxs("div",{className:"text-slate-900",children:["Order: ",Hx(P==null?void 0:P.order_date)," ",n.jsx("br",{}),"Expected: ",Hx(P==null?void 0:P.expected_date)]})]})]}),n.jsx(vr,{}),n.jsxs("div",{className:"border rounded-2xl overflow-hidden",children:[n.jsxs("div",{className:"grid grid-cols-[1.2fr,0.6fr,0.6fr,0.6fr] bg-slate-50 text-xs font-semibold text-slate-500 px-3 py-2",children:[n.jsx("span",{children:"Item"}),n.jsx("span",{className:"text-right",children:"Qty"}),n.jsx("span",{className:"text-right",children:"Rate"}),n.jsx("span",{className:"text-right",children:"Total"})]}),n.jsx("div",{className:"max-h-72 overflow-auto divide-y",children:((P==null?void 0:P.items)||[]).length===0?n.jsx("div",{className:"p-3 text-sm text-slate-500",children:"No items"}):((P==null?void 0:P.items)||[]).map(te=>{var X;const ne=Cj(te.ordered_qty),q=Cj(te.unit_cost),ee=Cj(te.line_total||ne*q);return n.jsxs("div",{className:"grid grid-cols-[1.2fr,0.6fr,0.6fr,0.6fr] px-3 py-2 text-xs",children:[n.jsx("div",{className:"text-slate-900",children:((X=te.item)==null?void 0:X.name)||te.item_name||`Item #${te.item_id}`}),n.jsx("div",{className:"text-right text-slate-700",children:ne}),n.jsx("div",{className:"text-right text-slate-700",children:OB(q)}),n.jsx("div",{className:"text-right text-slate-900 font-medium",children:OB(ee)})]},te.id)})})]}),n.jsxs(Kc,{className:"gap-2",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>O(null),children:"Close"}),P!=null&&P.id?n.jsx(ge,{className:"rounded-2xl",onClick:()=>V(P),children:"Print PDF"}):null]})]})})]})}function iXe({open:t,onOpenChange:s,suppliers:r,locations:a,initialPo:i,onSaved:l}){const o=!!(i!=null&&i.id),[c,d]=p.useState(!1),[u,m]=p.useState(""),[x,g]=p.useState(""),[y,v]=p.useState(new Date().toISOString().slice(0,10)),[j,w]=p.useState(""),[S,E]=p.useState(""),[k,A]=p.useState(""),[I,P]=p.useState([]),[O,D]=p.useState(!1),[T,B]=p.useState([]),[U,W]=p.useState(null),V=p.useRef(null),R=p.useRef({}),F=q=>{const ee=Number(q);return Number.isFinite(ee)?ee:0},G=q=>F(q).toFixed(2);p.useEffect(()=>{if(!t)return;m(i!=null&&i.supplier_id?String(i.supplier_id):""),g(i!=null&&i.location_id?String(i.location_id):""),v((i==null?void 0:i.order_date)||new Date().toISOString().slice(0,10)),w((i==null?void 0:i.expected_date)||""),E((i==null?void 0:i.notes)||"");const q=(i==null?void 0:i.items)||[];B(q.map(ee=>{var X,Z;return{key:`${ee.id||ee.item_id}-${Math.random().toString(16).slice(2)}`,item_id:ee.item_id,item_name:((X=ee.item)==null?void 0:X.name)||ee.item_name||"",item_code:((Z=ee.item)==null?void 0:Z.code)||ee.item_code||"",ordered_qty:ee.ordered_qty??1,unit_cost:ee.unit_cost??0,tax_percent:ee.tax_percent??0,mrp:ee.mrp??0,remarks:ee.remarks||""}})),A(""),P([]),W(null)},[t,i]),p.useEffect(()=>{if(!U)return;const q=R.current[U];q!=null&&q.scrollIntoView&&q.scrollIntoView({behavior:"smooth",block:"center"})},[U]);const H=p.useMemo(()=>{const q=T.reduce((X,Z)=>X+F(Z.ordered_qty)*F(Z.unit_cost),0),ee=T.reduce((X,Z)=>{const Y=F(Z.ordered_qty)*F(Z.unit_cost);return X+Y*(F(Z.tax_percent)/100)},0);return{sub:q,tax:ee,grand:q+ee}},[T]),$=p.useMemo(()=>{if(!u||!x||!T.length)return!1;for(const q of T)if(!q.item_id||F(q.ordered_qty)<=0)return!1;return!0},[u,x,T]);let K=p.useRef(null);async function le(q){if(!q||q.length<2){P([]);return}D(!0);try{const ee=await Df({q,limit:20});P(ee.data||[])}catch(ee){console.error(ee),P([])}finally{D(!1)}}function se(q){A(q),K.current&&clearTimeout(K.current),K.current=setTimeout(()=>le(q.trim()),250)}function J(q){if(!(q!=null&&q.id))return;if(T.some(X=>X.item_id===q.id)){ae.warning("Item already added");return}const ee=`${q.id}-${Date.now()}`;B(X=>[...X,{key:ee,item_id:q.id,item_name:q.name,item_code:q.code,ordered_qty:1,unit_cost:q.default_price??0,tax_percent:q.default_tax_percent??0,mrp:q.default_mrp??0,remarks:""}]),W(ee),A(""),P([])}function ie(q,ee){B(X=>X.map(Z=>Z.key===q?{...Z,...ee}:Z))}function te(q){B(ee=>ee.filter(X=>X.key!==q))}async function ne(){var ee,X;if(!u)return ae.error("Select supplier");if(!x)return ae.error("Select location");if(!T.length)return ae.error("Add at least 1 item");for(const Z of T){if(!Z.item_id)return ae.error("Invalid item in lines");if(F(Z.ordered_qty)<=0)return ae.error("Qty must be > 0")}const q={supplier_id:Number(u),location_id:Number(x),order_date:y||null,expected_date:j||null,notes:S||"",items:T.map(Z=>({item_id:Z.item_id,ordered_qty:String(Z.ordered_qty??0),unit_cost:String(Z.unit_cost??0),tax_percent:String(Z.tax_percent??0),mrp:String(Z.mrp??0),remarks:Z.remarks||""}))};d(!0);try{o?(await __e(i.id,q),ae.success("PO updated")):(await w_e(q),ae.success("PO created")),l==null||l()}catch(Z){ae.error(((X=(ee=Z==null?void 0:Z.response)==null?void 0:ee.data)==null?void 0:X.detail)||"Failed to save PO")}finally{d(!1)}}return n.jsx(fb,{open:t,onOpenChange:s,children:n.jsx(sf,{side:"right",className:"w-screen sm:w-[980px] max-w-none sm:max-w-none p-0 overflow-hidden",children:n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsx("div",{className:"border-b bg-white p-5",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-base font-semibold text-slate-900",children:o?"Edit Purchase Order":"New Purchase Order"}),n.jsx("div",{className:"text-xs text-slate-500 mt-1",children:"Simple and clear: Supplier  Location  Items. GRN confirms invoice & batches."})]}),n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>s(!1),disabled:c,children:"Close"})]})}),n.jsxs("div",{ref:V,className:"flex-1 overflow-auto p-5 space-y-4 bg-slate-50",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white p-4",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Supplier"}),n.jsxs("select",{className:"h-11 w-full rounded-2xl border border-slate-500 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-slate-200",value:u,onChange:q=>m(q.target.value),children:[n.jsx("option",{value:"",children:"Select supplier"}),r.map(q=>n.jsx("option",{value:String(q.id),children:q.name},q.id))]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Receiving location"}),n.jsxs("select",{className:"h-11 w-full rounded-2xl border border-slate-500 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-slate-200",value:x,onChange:q=>g(q.target.value),children:[n.jsx("option",{value:"",children:"Select location"}),a.map(q=>n.jsx("option",{value:String(q.id),children:q.name},q.id))]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Order date"}),n.jsx(Ee,{type:"date",className:"h-11 rounded-2xl bg-white",value:y,onChange:q=>v(q.target.value)})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Expected date"}),n.jsx(Ee,{type:"date",className:"h-11 rounded-2xl bg-white",value:j||"",onChange:q=>w(q.target.value)})]})]}),n.jsxs("div",{className:"mt-3 space-y-1.5",children:[n.jsx(xt,{children:"Notes"}),n.jsx(fs,{className:"rounded-2xl bg-white",placeholder:"Optional instructions for supplier",value:S,onChange:q=>E(q.target.value)})]})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white",children:[n.jsxs("div",{className:"sticky top-0 z-30 bg-white rounded-t-3xl border-b border-slate-500 p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Add items"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Search and click item to add. Qty is visible and editable."})]}),n.jsxs(et,{variant:"outline",className:"text-xs",children:[T.length," items"]})]}),n.jsxs("div",{className:"mt-3 relative",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Ee,{className:"h-11 rounded-2xl bg-white",placeholder:"Search item name / code / generic (min 2 chars)",value:k,onChange:q=>se(q.target.value)}),n.jsx(ge,{variant:"outline",className:"rounded-2xl h-11",onClick:()=>le(k.trim()),disabled:O||k.trim().length<2,children:O?"Searching":"Search"})]}),I.length>0?n.jsx("div",{className:"absolute left-0 right-0 mt-2 rounded-2xl border border-slate-500 bg-white shadow-lg overflow-hidden z-50",children:n.jsx("div",{className:"max-h-72 overflow-auto divide-y",children:I.map(q=>n.jsxs("button",{type:"button",onClick:()=>J(q),className:"w-full text-left px-3 py-3 hover:bg-slate-50",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:q.name}),n.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:[q.code," ",q.generic_name?` ${q.generic_name}`:"","  Default ",G(q.default_price)]})]},q.id))})}):null]})]}),n.jsx("div",{className:"hidden sm:block p-4",children:T.length===0?n.jsx("div",{className:"text-sm text-slate-500 py-10 text-center",children:"No items added yet. Use the search box above."}):n.jsxs("div",{className:"border border-slate-500 rounded-2xl overflow-hidden",children:[n.jsxs("div",{className:"grid grid-cols-[2.2fr,0.9fr,0.9fr,0.8fr,1fr,0.5fr] bg-slate-50 px-3 py-2 text-xs font-semibold text-slate-600",children:[n.jsx("div",{children:"Item"}),n.jsx("div",{className:"text-right",children:"Qty"}),n.jsx("div",{className:"text-right",children:"Rate"}),n.jsx("div",{className:"text-right",children:"Tax %"}),n.jsx("div",{className:"text-right",children:"Est total"}),n.jsx("div",{className:"text-right",children:"Remove"})]}),n.jsx("div",{className:"divide-y",children:T.map(q=>{const ee=F(q.ordered_qty)*F(q.unit_cost),X=ee*(F(q.tax_percent)/100),Z=ee+X;return n.jsxs("div",{ref:Y=>R.current[q.key]=Y,className:`grid grid-cols-[2.2fr,0.9fr,0.9fr,0.8fr,1fr,0.5fr] items-center gap-2 px-3 py-3 ${U===q.key?"bg-emerald-50/40":"bg-white"}`,children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:q.item_name}),n.jsx("div",{className:"text-xs text-slate-500 truncate",children:q.item_code}),n.jsx(Ee,{className:"mt-2 h-9 rounded-2xl bg-white text-sm",placeholder:"Remarks (optional)",value:q.remarks,onChange:Y=>ie(q.key,{remarks:Y.target.value})})]}),n.jsx(Ee,{className:"h-10 rounded-2xl bg-white text-right font-semibold",type:"number",min:"0",step:"1",value:q.ordered_qty,onChange:Y=>ie(q.key,{ordered_qty:Y.target.value})}),n.jsx(Ee,{className:"h-10 rounded-2xl bg-white text-right",type:"number",min:"0",step:"0.01",value:q.unit_cost,onChange:Y=>ie(q.key,{unit_cost:Y.target.value})}),n.jsx(Ee,{className:"h-10 rounded-2xl bg-white text-right",type:"number",min:"0",step:"0.01",value:q.tax_percent,onChange:Y=>ie(q.key,{tax_percent:Y.target.value})}),n.jsxs("div",{className:"text-right font-semibold text-slate-900",children:["",G(Z)]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(ge,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>te(q.key),children:n.jsx(Ms,{className:"w-4 h-4 text-rose-600"})})})]},q.key)})})]})}),n.jsx("div",{className:"sm:hidden p-4 space-y-3",children:T.length===0?n.jsx("div",{className:"text-sm text-slate-500 py-8 text-center",children:"No items added yet. Use the search box above."}):T.map(q=>{const ee=F(q.ordered_qty)*F(q.unit_cost),X=ee*(F(q.tax_percent)/100),Z=ee+X;return n.jsxs("div",{ref:Y=>R.current[q.key]=Y,className:`rounded-2xl border border-slate-500 p-3 ${U===q.key?"bg-emerald-50/40":"bg-white"}`,children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:q.item_name}),n.jsx("div",{className:"text-xs text-slate-500 truncate",children:q.item_code})]}),n.jsx(ge,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>te(q.key),children:n.jsx(Ms,{className:"w-4 h-4 text-rose-600"})})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px]",children:"Qty"}),n.jsx(Ee,{className:"h-11 rounded-2xl bg-white font-semibold",type:"number",step:"1",value:q.ordered_qty,onChange:Y=>ie(q.key,{ordered_qty:Y.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px]",children:"Rate"}),n.jsx(Ee,{className:"h-11 rounded-2xl bg-white",type:"number",step:"0.01",value:q.unit_cost,onChange:Y=>ie(q.key,{unit_cost:Y.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px]",children:"Tax %"}),n.jsx(Ee,{className:"h-11 rounded-2xl bg-white",type:"number",step:"0.01",value:q.tax_percent,onChange:Y=>ie(q.key,{tax_percent:Y.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px]",children:"Est total"}),n.jsxs("div",{className:"h-11 rounded-2xl border border-slate-500 bg-slate-50 px-3 flex items-center font-semibold",children:["",G(Z)]})]})]}),n.jsx("div",{className:"mt-2",children:n.jsx(Ee,{className:"h-11 rounded-2xl bg-white",placeholder:"Remarks (optional)",value:q.remarks,onChange:Y=>ie(q.key,{remarks:Y.target.value})})})]},q.key)})})]})]}),n.jsxs("div",{className:"border-t bg-white p-5",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"text-xs text-slate-600",children:[n.jsxs("div",{children:["Subtotal: ",n.jsxs("span",{className:"font-semibold text-slate-900",children:["",G(H.sub)]})]}),n.jsxs("div",{children:["Tax (est): ",n.jsxs("span",{className:"font-semibold text-slate-900",children:["",G(H.tax)]})]}),n.jsxs("div",{className:"mt-1 text-sm font-semibold text-slate-900",children:["Grand: ",G(H.grand)]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>s(!1),disabled:c,children:"Close"}),n.jsx(ge,{className:"rounded-2xl",onClick:ne,disabled:!$||c,children:c?"Saving":o?"Update PO":"Create PO"})]})]}),n.jsx("div",{className:"text-[11px] text-slate-500 mt-2",children:"Note: GRN will confirm actual invoice values and batch-wise price/tax."})]})]})})})}const tr=t=>{if(t===""||t===null||t===void 0)return 0;const s=Number(t);return Number.isFinite(s)?s:0},Yi=t=>Math.round((tr(t)+Number.EPSILON)*100)/100,wi=t=>Yi(t).toFixed(2),WA=()=>new Date().toISOString().slice(0,10),Pv=t=>{if(!t)return"";try{return new Date(t).toLocaleDateString()}catch{return String(t)}},Wx=(t,s="Something went wrong")=>{var a,i;const r=(i=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:i.detail;return r?typeof r=="string"?r:Array.isArray(r)?r.map(l=>(l==null?void 0:l.msg)||(l==null?void 0:l.message)||(l==null?void 0:l.detail)||JSON.stringify(l)).slice(0,3).join(", "):JSON.stringify(r):s},lXe=()=>{try{return crypto.randomUUID()}catch{return`ln_${Date.now()}_${Math.random().toString(16).slice(2)}`}},RB=()=>({po_id:"",supplier_id:"",location_id:"",received_date:WA(),invoice_number:"",invoice_date:"",supplier_invoice_amount:"",freight_amount:"",other_charges:"",round_off:"",notes:"",difference_reason:""}),Us=t=>t==null?"":String(t),LB=t=>{var d,u,m,x,g,y,v,j,w,S,E,k,A;const s=(t==null?void 0:t.id)??(t==null?void 0:t.item_id)??(t==null?void 0:t.itemId)??((d=t==null?void 0:t.item)==null?void 0:d.id)??((u=t==null?void 0:t.item)==null?void 0:u.item_id)??null,r=(t==null?void 0:t.name)??(t==null?void 0:t.item_name)??(t==null?void 0:t.label)??((m=t==null?void 0:t.item)==null?void 0:m.name)??((x=t==null?void 0:t.item)==null?void 0:x.item_name)??"",a=(t==null?void 0:t.code)??(t==null?void 0:t.item_code)??((g=t==null?void 0:t.item)==null?void 0:g.code)??"",i=(t==null?void 0:t.generic_name)??(t==null?void 0:t.genericName)??((y=t==null?void 0:t.item)==null?void 0:y.generic_name)??((v=t==null?void 0:t.item)==null?void 0:v.genericName)??"",l=(t==null?void 0:t.default_price)??(t==null?void 0:t.defaultPrice)??(t==null?void 0:t.unit_cost)??(t==null?void 0:t.price)??((j=t==null?void 0:t.item)==null?void 0:j.default_price)??((w=t==null?void 0:t.item)==null?void 0:w.unit_cost)??0,o=(t==null?void 0:t.default_mrp)??(t==null?void 0:t.defaultMrp)??(t==null?void 0:t.mrp)??((S=t==null?void 0:t.item)==null?void 0:S.default_mrp)??((E=t==null?void 0:t.item)==null?void 0:E.mrp)??0,c=(t==null?void 0:t.default_tax_percent)??(t==null?void 0:t.defaultTaxPercent)??(t==null?void 0:t.tax_percent)??(t==null?void 0:t.gst_percent)??((k=t==null?void 0:t.item)==null?void 0:k.default_tax_percent)??((A=t==null?void 0:t.item)==null?void 0:A.tax_percent)??0;return{...t,id:s?Number(s):null,name:r,code:a,generic_name:i,default_price:l,default_mrp:o,default_tax_percent:c}},oXe=t=>{var r;const s=(t==null?void 0:t.id)??(t==null?void 0:t.id)??((r=t==null?void 0:t.item)==null?void 0:r.id)??null;return s?Number(s):null},q0=(t={})=>({_key:lXe(),po_item_id:null,item_id:null,item_name:"",batch_no:"",expiry_date:"",quantity:"",free_quantity:"",unit_cost:"",mrp:"",discount_percent:"",discount_amount:"",cgst_percent:"",sgst_percent:"",igst_percent:"",tax_percent:"",scheme:"",remarks:"",...t}),lne=t=>{const s=tr(t.quantity),r=tr(t.unit_cost),a=Yi(s*r),i=tr(t.discount_amount),l=tr(t.discount_percent),o=Yi(i>0?i:l>0?a*l/100:0),c=Yi(Math.max(0,a-o)),d=tr(t.cgst_percent)+tr(t.sgst_percent)+tr(t.igst_percent),u=d>0?d:tr(t.tax_percent),m=Yi(c*u/100),x=Yi(c+m);return{qty:s,gross:a,disc:o,base:c,taxP:u,tax:m,net:x}},one=t=>{const s=[];return Number(t.item_id)>0||s.push("Item missing"),String(t.batch_no||"").trim()||s.push("Batch required"),tr(t.quantity)<=0&&tr(t.free_quantity)<=0&&s.push("Qty/Free required"),tr(t.unit_cost)<0&&s.push("Rate invalid"),tr(t.mrp)<0&&s.push("MRP invalid"),s};function qm({className:t="",children:s}){return n.jsx(dt,{className:["rounded-3xl border-slate-500/70 bg-white/75 backdrop-blur supports-[backdrop-filter]:bg-white/60","shadow-[0_10px_30px_rgba(2,6,23,0.06)]","ring-1 ring-slate-200/40",t].join(" "),children:s})}function FB({icon:t,title:s,count:r,subtitle:a}){return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[t?n.jsx(t,{className:"h-4 w-4 text-slate-400"}):null,n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:s}),typeof r=="number"?n.jsx(et,{variant:"outline",className:"text-xs bg-white",children:r}):null]}),a?n.jsx("p",{className:"text-xs text-slate-500",children:a}):null]})}function BB({active:t,children:s}){return n.jsx("span",{className:["inline-flex items-center rounded-full border px-2.5 py-1 text-xs","transition-all",t?"bg-slate-900 text-white border-slate-900 shadow-sm":"bg-white/70 text-slate-700 border-slate-500"].join(" "),children:s})}function qo({label:t,value:s,tone:r="neutral"}){const a={neutral:"bg-slate-50 border-slate-500 text-slate-700",good:"bg-emerald-50 border-emerald-200 text-emerald-800",warn:"bg-amber-50 border-amber-200 text-amber-900"};return n.jsxs("div",{className:["rounded-2xl border px-3 py-2",a[r]||a.neutral].join(" "),children:[n.jsx("div",{className:"text-[11px] opacity-80",children:t}),n.jsx("div",{className:"text-sm font-semibold",children:s})]})}function cXe({ln:t,idx:s,readonly:r,onPatch:a,onSplit:i,onRemove:l}){const o=lne(t),c=one(t),d=c.length>0;return n.jsxs("div",{className:["rounded-3xl border p-3 sm:p-4","shadow-[0_6px_18px_rgba(2,6,23,0.05)]",d?"border-amber-200/80 bg-amber-50/50":"border-slate-500/70 bg-white"].join(" "),children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(et,{variant:"outline",className:"text-[10px] bg-white",children:["Line ",s+1]}),n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:t.item_name||(t.item_id?`Item #${t.item_id}`:"Select item")})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"text-xs text-slate-500",children:["Gross ",wi(o.gross)]}),n.jsxs("span",{className:"text-xs text-slate-500",children:["Disc ",wi(o.disc)]}),n.jsxs("span",{className:"text-xs text-slate-500",children:["Tax ",wi(o.tax)]}),n.jsxs(et,{variant:"outline",className:"text-xs bg-white",children:["Net ",wi(o.net)]}),d?n.jsx(et,{variant:"outline",className:"text-[11px] bg-amber-100 text-amber-900 border border-amber-200",children:c[0]}):n.jsx(et,{variant:"outline",className:"text-[11px] bg-emerald-50 text-emerald-800 border border-emerald-200",children:"OK"})]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(ge,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 rounded-2xl",title:"Split batch",onClick:i,disabled:r,children:n.jsx(phe,{className:"h-4 w-4"})}),n.jsx(ge,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 rounded-2xl text-rose-600",title:"Remove line",onClick:l,disabled:r,children:n.jsx(Ms,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2 sm:grid-cols-4 lg:grid-cols-8",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Qty"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.quantity),onChange:u=>a({quantity:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Free"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.free_quantity),onChange:u=>a({free_quantity:u.target.value})})]}),n.jsxs("div",{className:"space-y-1 col-span-2 sm:col-span-2",children:[n.jsx(xt,{className:"text-xs",children:"Batch No"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",value:Us(t.batch_no),placeholder:"Required",onChange:u=>a({batch_no:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Expiry"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"date",value:Us(t.expiry_date),onChange:u=>a({expiry_date:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Rate"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.unit_cost),onChange:u=>a({unit_cost:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"MRP"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.mrp),onChange:u=>a({mrp:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Tax %"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.tax_percent),onChange:u=>a({tax_percent:u.target.value})})]}),n.jsxs("details",{className:"col-span-2 sm:col-span-4 lg:col-span-8",children:[n.jsx("summary",{className:"cursor-pointer select-none text-xs text-slate-600 mt-2",children:"More (Discount / GST Split / Scheme)"}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 sm:grid-cols-4 lg:grid-cols-8",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Disc %"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.discount_percent),onChange:u=>a({discount_percent:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"Disc Amt"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.discount_amount),onChange:u=>a({discount_amount:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"CGST %"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.cgst_percent),onChange:u=>a({cgst_percent:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"SGST %"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.sgst_percent),onChange:u=>a({sgst_percent:u.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-xs",children:"IGST %"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",type:"number",step:"0.01",value:Us(t.igst_percent),onChange:u=>a({igst_percent:u.target.value})})]}),n.jsxs("div",{className:"space-y-1 col-span-2 sm:col-span-3 lg:col-span-3",children:[n.jsx(xt,{className:"text-xs",children:"Scheme"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",value:Us(t.scheme),onChange:u=>a({scheme:u.target.value}),placeholder:"ex: 10+1"})]}),n.jsxs("div",{className:"space-y-1 col-span-2 sm:col-span-4 lg:col-span-8",children:[n.jsx(xt,{className:"text-xs",children:"Remarks"}),n.jsx(Ee,{disabled:r,className:"h-10 rounded-2xl bg-white",value:Us(t.remarks),placeholder:"Optional",onChange:u=>a({remarks:u.target.value})})]})]})]})]})]})}function dXe(){const[t,s]=p.useState(!0),[r,a]=p.useState([]),[i,l]=p.useState(!0),[o,c]=p.useState([]),[d,u]=p.useState([]),[m,x]=p.useState([]),[g,y]=p.useState(""),[v,j]=p.useState("ALL"),[w,S]=p.useState(""),[E,k]=p.useState(!1),[A,I]=p.useState("PO"),[P,O]=p.useState(1),[D,T]=p.useState(null),[B,U]=p.useState(null),[W,V]=p.useState("DRAFT"),[R,F]=p.useState(RB()),[G,H]=p.useState([]),[$,K]=p.useState(!1),[le,se]=p.useState(!1),[J,ie]=p.useState(""),[te,ne]=p.useState([]),[q,ee]=p.useState(!1),X=p.useRef(null),Z=String(W||"DRAFT")!=="DRAFT",Y=p.useCallback(async()=>{try{const[De,tt]=await Promise.all([px(),_K()]);u(De.data||[]),x(tt.data||[])}catch{}},[]),Q=p.useCallback(async()=>{s(!0);try{const De={};v!=="ALL"&&(De.status=v),g.trim()&&(De.q=g.trim());const tt=await A_e(De);a(tt.data||[])}catch(De){ae.error(Wx(De,"Failed to load GRNs")),a([])}finally{s(!1)}},[g,v]),oe=p.useCallback(async()=>{l(!0);try{const De=await D_e({q:w.trim()||void 0});c(De.data||[])}catch(De){ae.error(Wx(De,"Failed to load pending POs")),c([])}finally{l(!1)}},[w]);p.useEffect(()=>{Y(),Q(),oe()},[Y,Q,oe]),p.useEffect(()=>{const De=tt=>{X.current&&(X.current.contains(tt.target)||ne([]))};return document.addEventListener("mousedown",De),()=>document.removeEventListener("mousedown",De)},[]);const _e=p.useMemo(()=>{const De=g.trim().toLowerCase();return De?(r||[]).filter(tt=>{var Ge,We;return`${tt.grn_number||""} ${tt.invoice_number||""} ${((Ge=tt.supplier)==null?void 0:Ge.name)||""} ${((We=tt.location)==null?void 0:We.name)||""} ${tt.status||""}`.toLowerCase().includes(De)}):r},[r,g]),xe=p.useMemo(()=>{const De=(G||[]).map(lne),tt=Yi(De.reduce((Nt,Jt)=>Nt+Jt.gross,0)),ve=Yi(De.reduce((Nt,Jt)=>Nt+Jt.disc,0)),Ge=Yi(De.reduce((Nt,Jt)=>Nt+Jt.tax,0)),We=Yi(De.reduce((Nt,Jt)=>Nt+Jt.net,0)),Ve=Yi(tr(R.freight_amount)+tr(R.other_charges)+tr(R.round_off)),Fe=Yi(We+Ve),ot=Yi(tr(R.supplier_invoice_amount)),ft=Yi(ot-Fe),ce=ot>0&&Math.abs(ft)>=.01,Ce=(G||[]).filter(Nt=>!String(Nt.batch_no||"").trim()).length,ze=(G||[]).filter(Nt=>tr(Nt.quantity)<=0&&tr(Nt.free_quantity)<=0).length,Te=(G||[]).filter(Nt=>!(Number(Nt.item_id)>0)).length;return{subtotal:tt,discount:ve,tax:Ge,netLines:We,extras:Ve,calculated:Fe,invoice:ot,diff:ft,mismatch:ce,missingBatch:Ce,qtyIssues:ze,itemMissing:Te}},[G,R]),me=p.useCallback(()=>{I("PO"),O(1),T(null),U(null),V("DRAFT"),F(RB()),H([]),ie(""),ne([])},[]),Re=p.useCallback(()=>{me(),k(!0)},[me]),Ze=p.useCallback(async De=>{var tt,ve;try{const We=(await E_e(De)).data;U(We.id),V(String(We.status||"DRAFT")),I(We.po_id?"PO":"DIRECT"),O(2),T(We.po_id?{id:We.po_id,po_number:((tt=We.po)==null?void 0:tt.po_number)||((ve=We.purchase_order)==null?void 0:ve.po_number)||""}:null),F({po_id:We.po_id?String(We.po_id):"",supplier_id:String(We.supplier_id||""),location_id:String(We.location_id||""),received_date:We.received_date||WA(),invoice_number:We.invoice_number||"",invoice_date:We.invoice_date||"",supplier_invoice_amount:Us(We.supplier_invoice_amount||""),freight_amount:Us(We.freight_amount||""),other_charges:Us(We.other_charges||""),round_off:Us(We.round_off||""),notes:We.notes||"",difference_reason:We.difference_reason||""}),H((We.items||[]).map(Ve=>{var Fe;return q0({po_item_id:Ve.po_item_id||null,item_id:Ve!=null&&Ve.id?Number(Ve==null?void 0:Ve.id):null,item_name:((Fe=Ve.item)==null?void 0:Fe.name)||Ve.item_name||`Item #${Ve.item_id}`,batch_no:Ve.batch_no||"",expiry_date:Ve.expiry_date||"",quantity:Us(Ve.quantity??""),free_quantity:Us(Ve.free_quantity??""),unit_cost:Us(Ve.unit_cost??""),mrp:Us(Ve.mrp??""),discount_percent:Us(Ve.discount_percent??""),discount_amount:Us(Ve.discount_amount??""),cgst_percent:Us(Ve.cgst_percent??""),sgst_percent:Us(Ve.sgst_percent??""),igst_percent:Us(Ve.igst_percent??""),tax_percent:Us(Ve.tax_percent??""),scheme:Ve.scheme||"",remarks:Ve.remarks||""})})),k(!0)}catch(Ge){ae.error(Wx(Ge,"Failed to open GRN"))}},[]),$e=p.useCallback(async De=>{try{const ve=(await M_e(De.id)).data;T({id:ve.po_id,po_number:ve.po_number}),I("PO"),O(2),V("DRAFT"),U(null),F(Ge=>({...Ge,po_id:String(ve.po_id),supplier_id:String(ve.supplier_id),location_id:String(ve.location_id),received_date:WA()})),H((ve.items||[]).map(Ge=>{var We,Ve,Fe,ot;return q0({po_item_id:Ge.po_item_id??null,item_id:oXe(Ge),item_name:((We=Ge.item)==null?void 0:We.name)||Ge.item_name||`Item #${Ge.item_id}`,quantity:Us(Ge.remaining_qty??0),free_quantity:"",unit_cost:Us(Ge.unit_cost??((Ve=Ge.item)==null?void 0:Ve.default_price)??0),mrp:Us(Ge.mrp??((Fe=Ge.item)==null?void 0:Fe.default_mrp)??0),tax_percent:Us(Ge.tax_percent??((ot=Ge.item)==null?void 0:ot.default_tax_percent)??0)})})),ae.success("PO pending items loaded")}catch(tt){ae.error(Wx(tt,"Failed to load PO pending items"))}},[]),fe=p.useCallback(async()=>{const De=J.trim();if(De){ee(!0);try{const ve=((await Df({q:De,limit:20})).data||[]).map(LB).filter(Ge=>Ge.id);ne(ve)}catch{ne([])}finally{ee(!1)}}},[J]),Me=p.useCallback(De=>{const tt=LB(De);if(!(tt!=null&&tt.id)){ae.error("Item id missing from API response. Fix listInventoryItems output fields.");return}H(ve=>[...ve,q0({item_id:Number(tt.id),item_name:tt.name,quantity:"1",unit_cost:Us(tt.default_price??0),mrp:Us(tt.default_mrp??0),tax_percent:Us(tt.default_tax_percent??0)})]),ie(""),ne([])},[]),Ae=p.useCallback(()=>{H(De=>[...De,q0({})])},[]),Ke=p.useCallback((De,tt)=>{H(ve=>ve.map(Ge=>Ge._key===De?{...Ge,...tt}:Ge))},[]),Le=p.useCallback(De=>{H(tt=>tt.filter(ve=>ve._key!==De))},[]),He=p.useCallback(De=>{H(tt=>{const ve=tt.findIndex(Fe=>Fe._key===De);if(ve<0)return tt;const Ge=tt[ve],We=q0({...Ge,batch_no:"",expiry_date:"",quantity:"",free_quantity:""}),Ve=[...tt];return Ve.splice(ve+1,0,We),Ve})},[]),pt=p.useCallback(()=>{if(!R.supplier_id)return"Select supplier";if(!R.location_id)return"Select location";if(!G.length)return"Add at least 1 batch line";for(const De of G){const tt=one(De);if(tt.length)return tt[0]}return xe.mismatch&&!String(R.difference_reason||"").trim()?"Difference Reason required (invoice mismatch)":null},[R,G,xe.mismatch]),Pe=p.useCallback(async()=>{var ve;if(Z)return ae.error("This GRN is not editable");const De=pt();if(De)return ae.error(De);const tt={po_id:R.po_id?Number(R.po_id):null,supplier_id:Number(R.supplier_id),location_id:Number(R.location_id),received_date:R.received_date||null,invoice_number:R.invoice_number||"",invoice_date:R.invoice_date||null,supplier_invoice_amount:String(R.supplier_invoice_amount||0),freight_amount:String(R.freight_amount||0),other_charges:String(R.other_charges||0),round_off:String(R.round_off||0),notes:R.notes||"",difference_reason:R.difference_reason||"",items:G.map(Ge=>({po_item_id:Ge.po_item_id||null,item_id:Number(Ge.item_id)||null,batch_no:Ge.batch_no,expiry_date:Ge.expiry_date||null,quantity:String(Ge.quantity||0),free_quantity:String(Ge.free_quantity||0),unit_cost:String(Ge.unit_cost||0),mrp:String(Ge.mrp||0),discount_percent:String(Ge.discount_percent||0),discount_amount:String(Ge.discount_amount||0),cgst_percent:String(Ge.cgst_percent||0),sgst_percent:String(Ge.sgst_percent||0),igst_percent:String(Ge.igst_percent||0),tax_percent:String(Ge.tax_percent||0),scheme:Ge.scheme||"",remarks:Ge.remarks||""}))};K(!0);try{if(B)await T_e(B,tt),ae.success("GRN draft updated");else{const Ge=await k_e(tt);U(((ve=Ge.data)==null?void 0:ve.id)||null),V("DRAFT"),ae.success("GRN draft created")}await Q(),await oe()}catch(Ge){ae.error(Wx(Ge,"Failed to save draft"))}finally{K(!1)}},[Z,pt,R,G,B,Q,oe]),bt=p.useCallback(async()=>{if(Z)return ae.error("This GRN cannot be posted");if(!B)return ae.error("Save draft first");const De=pt();if(De)return ae.error(De);se(!0);try{await P_e(B,{difference_reason:R.difference_reason||""}),ae.success("GRN posted  stock updated"),k(!1),me(),await Q(),await oe()}catch(tt){ae.error(Wx(tt,"Failed to post GRN"))}finally{se(!1)}},[Z,B,pt,R.difference_reason,me,Q,oe]),It=p.useMemo(()=>{const De=(r==null?void 0:r.length)||0,tt=(r||[]).filter(We=>We.status==="DRAFT").length,ve=(r||[]).filter(We=>We.status==="POSTED").length,Ge=(r||[]).filter(We=>Math.abs(tr(We.amount_difference||0))>=.01&&tr(We.supplier_invoice_amount||0)>0).length;return{all:De,draft:tt,posted:ve,mismatch:Ge}},[r]);return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-gradient-to-b from-white to-slate-50/70 p-5 shadow-[0_10px_30px_rgba(2,6,23,0.06)]",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[n.jsx("div",{className:"space-y-1",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white shadow-sm",children:n.jsx($n,{className:"h-4 w-4"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-base font-semibold text-slate-900",children:"Goods Receipt Notes"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Premium workflow: PO  batches  save draft  post stock"})]})]})}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>{oe(),Q()},children:[n.jsx(ps,{className:"h-4 w-4 mr-1"}),"Refresh all"]}),n.jsxs(ge,{className:"rounded-2xl",onClick:Re,children:[n.jsx(ds,{className:"h-4 w-4 mr-1"}),"New GRN"]})]})]}),n.jsxs("div",{className:"mt-4 grid gap-2 sm:grid-cols-4",children:[n.jsx(qo,{label:"Total GRNs",value:It.all}),n.jsx(qo,{label:"Draft",value:It.draft,tone:"warn"}),n.jsx(qo,{label:"Posted",value:It.posted,tone:"good"}),n.jsx(qo,{label:"Invoice mismatch",value:It.mismatch,tone:It.mismatch?"warn":"neutral"})]})]}),n.jsxs(qm,{children:[n.jsxs(gt,{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsx(FB,{icon:jg,title:"PO Pending GRN",count:o.length,subtitle:"Pick PO  auto-fill pending items  enter batches  save draft  post."}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"gap-1 rounded-2xl",onClick:oe,children:[n.jsx(ps,{className:"w-3 h-3"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"gap-1 rounded-2xl",onClick:Re,children:[n.jsx(ds,{className:"w-3 h-3"}),"New GRN"]})]})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[n.jsxs("div",{className:"relative w-full sm:w-96",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-2.5 text-slate-400"}),n.jsx(Ee,{value:w,onChange:De=>S(De.target.value),placeholder:"Search PO number...",className:"pl-9 bg-white rounded-2xl h-10"})]}),n.jsx(ge,{variant:"outline",className:"rounded-2xl h-10",onClick:oe,children:"Search"})]}),n.jsx("div",{className:"text-xs text-slate-500",children:i?"Loading":`${o.length} pending PO(s)`})]}),n.jsxs("div",{className:"border border-slate-500/70 rounded-3xl overflow-hidden bg-white",children:[n.jsxs("div",{className:"hidden md:grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,0.8fr] px-4 py-3 text-xs font-semibold text-slate-500 bg-slate-50",children:[n.jsx("span",{children:"PO"}),n.jsx("span",{children:"Supplier"}),n.jsx("span",{children:"Location / Date"}),n.jsx("span",{children:"Pending"}),n.jsx("span",{className:"text-right",children:"Action"})]}),n.jsx("div",{className:"max-h-[280px] overflow-auto divide-y divide-slate-100",children:i?n.jsxs("div",{className:"p-4 space-y-2",children:[n.jsx(Qe,{className:"h-10 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-full rounded-2xl"})]}):o.length===0?n.jsxs("div",{className:"p-6 text-sm text-slate-500 flex items-center gap-2",children:[n.jsx(Xt,{className:"h-4 w-4 text-slate-400"}),"No pending POs."]}):o.map(De=>{var tt,ve,Ge,We;return n.jsxs("div",{className:"px-4 py-4 md:py-3 md:grid md:grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,0.8fr] md:items-center text-sm md:text-xs hover:bg-slate-50 transition-colors",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-semibold text-slate-900",children:De.po_number}),n.jsx("div",{className:"text-slate-500 text-xs md:text-[11px]",children:Pv(De.order_date)})]}),n.jsxs("div",{className:"mt-2 md:mt-0",children:[n.jsx("div",{className:"text-slate-900",children:((tt=De.supplier)==null?void 0:tt.name)||""}),n.jsx("div",{className:"text-slate-500 text-xs md:text-[11px]",children:((ve=De.supplier)==null?void 0:ve.phone)||((Ge=De.supplier)==null?void 0:Ge.email)||""})]}),n.jsxs("div",{className:"mt-2 md:mt-0",children:[n.jsx("div",{className:"text-slate-900",children:((We=De.location)==null?void 0:We.name)||""}),n.jsxs("div",{className:"text-slate-500 text-xs md:text-[11px]",children:["Status: ",String(De.status||"")]})]}),n.jsx("div",{className:"mt-2 md:mt-0",children:n.jsxs(et,{variant:"outline",className:"text-[11px] bg-white",children:[De.pending_items_count||0," items"]})}),n.jsx("div",{className:"mt-3 md:mt-0 flex justify-end",children:n.jsxs(ge,{size:"sm",className:"gap-1 rounded-2xl",onClick:()=>{Re(),$e(De)},children:[n.jsx(yh,{className:"w-3 h-3"}),"Create GRN"]})})]},De.id)})})]})]})]}),n.jsxs(qm,{children:[n.jsxs(gt,{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[n.jsx(FB,{icon:Pr,title:"GRN Registry",count:_e.length,subtitle:"Draft  Save  Post (updates stock + PO received qty/status)."}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-2xl",onClick:Q,children:[n.jsx(ps,{className:"w-4 h-4 mr-1"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"h-10 rounded-2xl gap-1",onClick:Re,children:[n.jsx(ds,{className:"w-4 h-4"}),"New GRN"]})]})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsxs("div",{className:"relative w-full sm:w-80",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-3 text-slate-400"}),n.jsx(Ee,{placeholder:"Search GRN / supplier / invoice...",value:g,onChange:De=>y(De.target.value),className:"h-10 bg-white rounded-2xl pl-9"})]}),n.jsx("div",{className:"w-full sm:w-44",children:n.jsxs(Zs,{value:v,onValueChange:j,children:[n.jsx(Ws,{className:"h-10 bg-white rounded-2xl",children:n.jsx(Js,{placeholder:"All statuses"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"ALL",children:"All"}),n.jsx(Ut,{value:"DRAFT",children:"Draft"}),n.jsx(Ut,{value:"POSTED",children:"Posted"}),n.jsx(Ut,{value:"CANCELLED",children:"Cancelled"})]})]})}),n.jsx(ge,{variant:"outline",className:"h-10 rounded-2xl",onClick:Q,children:"Apply"})]}),n.jsx("div",{className:"text-xs text-slate-500",children:t?"Loading":`${_e.length} result(s)`})]}),n.jsxs("div",{className:"border border-slate-500/70 rounded-3xl overflow-hidden bg-white",children:[n.jsxs("div",{className:"hidden md:grid grid-cols-[1.2fr,1.1fr,1.2fr,0.9fr,0.9fr,0.9fr] px-4 py-3 text-xs font-semibold text-slate-500 bg-slate-50",children:[n.jsx("span",{children:"GRN"}),n.jsx("span",{children:"Supplier"}),n.jsx("span",{children:"Location / Invoice"}),n.jsx("span",{children:"Amounts"}),n.jsx("span",{children:"Status"}),n.jsx("span",{className:"text-right",children:"Actions"})]}),n.jsx("div",{className:"max-h-[420px] overflow-auto divide-y divide-slate-100",children:t?n.jsxs("div",{className:"p-4 space-y-2",children:[n.jsx(Qe,{className:"h-10 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-full rounded-2xl"})]}):_e.length===0?n.jsxs("div",{className:"p-6 text-sm text-slate-500 flex items-center gap-2",children:[n.jsx(Xt,{className:"h-4 w-4 text-slate-400"}),"No GRNs found."]}):_e.map(De=>{var Ge,We,Ve,Fe;const tt=tr(De.amount_difference||0),ve=Math.abs(tt)>=.01&&tr(De.supplier_invoice_amount||0)>0;return n.jsxs("div",{className:"px-4 py-4 md:py-3 md:grid md:grid-cols-[1.2fr,1.1fr,1.2fr,0.9fr,0.9fr,0.9fr] md:items-center text-sm md:text-xs hover:bg-slate-50 transition-colors",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-semibold text-slate-900",children:De.grn_number||`GRN-${String(De.id).padStart(6,"0")}`}),n.jsxs("div",{className:"text-slate-500 text-xs md:text-[11px]",children:["Received: ",Pv(De.received_date)]})]}),n.jsxs("div",{className:"mt-2 md:mt-0",children:[n.jsx("div",{className:"text-slate-900",children:((Ge=De.supplier)==null?void 0:Ge.name)||""}),n.jsx("div",{className:"text-slate-500 text-xs md:text-[11px]",children:((We=De.supplier)==null?void 0:We.phone)||((Ve=De.supplier)==null?void 0:Ve.email)||""})]}),n.jsxs("div",{className:"mt-2 md:mt-0",children:[n.jsx("div",{className:"text-slate-900",children:((Fe=De.location)==null?void 0:Fe.name)||""}),n.jsxs("div",{className:"text-slate-500 text-xs md:text-[11px]",children:["Inv: ",De.invoice_number||""," ",De.invoice_date?` ${Pv(De.invoice_date)}`:""]})]}),n.jsxs("div",{className:"mt-2 md:mt-0",children:[n.jsxs("div",{className:"text-slate-900",children:["Inv: ",wi(De.supplier_invoice_amount||0)]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs md:text-[11px] text-slate-500",children:[n.jsxs("span",{children:["Calc: ",wi(De.calculated_grn_amount||0)]}),ve?n.jsxs(et,{variant:"outline",className:"text-[10px] bg-amber-50 text-amber-800 border-amber-200",children:["Diff ",wi(tt)]}):null]})]}),n.jsx("div",{className:"mt-2 md:mt-0",children:n.jsx(et,{variant:"outline",className:["text-[11px] md:text-[10px] capitalize bg-white",De.status==="POSTED"?"bg-emerald-50 border-emerald-200 text-emerald-800":"",De.status==="CANCELLED"?"bg-rose-50 border-rose-200 text-rose-800":"",De.status==="DRAFT"?"bg-slate-50 border-slate-500 text-slate-700":""].join(" "),children:(De.status||"DRAFT").toLowerCase()})}),n.jsxs("div",{className:"mt-3 md:mt-0 flex justify-end gap-2",children:[n.jsx(ge,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-2xl bg-white",title:"Open",onClick:()=>Ze(De.id),children:n.jsx(Pr,{className:"w-4 h-4"})}),De.status==="DRAFT"?n.jsxs(ge,{size:"sm",className:"h-9 gap-1 rounded-2xl",onClick:()=>Ze(De.id),children:[n.jsx(Ki,{className:"w-3 h-3"}),"Continue"]}):null]})]},De.id)})})]})]})]}),n.jsx(fb,{open:E,onOpenChange:De=>{k(De),De||me()},children:n.jsx(sf,{side:"right",className:"w-screen sm:w-full max-w-none sm:max-w-none p-0 overflow-hidden bg-white",children:n.jsxs("div",{className:"h-full flex flex-col",children:[n.jsxs(gb,{className:"p-5 border-b bg-white sticky top-0 z-20",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(bb,{className:"text-base font-semibold",children:B?`GRN (${W})`:"New GRN (Draft)"}),n.jsx(yb,{className:"text-xs",children:"Choose PO (optional)  add batches  save draft  post."})]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>k(!1),children:[n.jsx(ts,{className:"h-4 w-4 mr-1"}),"Close"]})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[n.jsxs(Zs,{value:A,onValueChange:De=>{me(),I(De),O(De==="PO"?1:2),k(!0)},children:[n.jsx(Ws,{className:"h-10 w-64 rounded-2xl bg-white",children:n.jsx(Js,{})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"PO",children:"GRN from PO (recommended)"}),n.jsx(Ut,{value:"DIRECT",children:"Direct GRN (no PO)"})]})]}),n.jsx(BB,{active:P===1,children:"1  Select"}),n.jsx(BB,{active:P===2,children:"2  Draft"}),D!=null&&D.po_number?n.jsxs(et,{variant:"outline",className:"text-xs flex items-center gap-1 bg-white",children:[n.jsx(yh,{className:"w-3 h-3"}),D.po_number]}):null,Z?n.jsx(et,{variant:"outline",className:"text-xs bg-slate-50",children:"Read-only"}):null]})]}),n.jsxs("div",{className:"flex-1 overflow-auto p-5 bg-gradient-to-b from-slate-50/40 to-white space-y-4",children:[A==="PO"&&P===1?n.jsxs(qm,{className:"bg-white",children:[n.jsxs(gt,{className:"pb-2",children:[n.jsxs(jt,{className:"text-sm flex items-center gap-2",children:[n.jsx(jg,{className:"h-4 w-4"}),"Choose a PO (pending)"]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Selecting a PO auto-fills supplier/location + pending items."})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[n.jsx(Ee,{className:"bg-white rounded-2xl h-10",value:w,onChange:De=>S(De.target.value),placeholder:"Search PO..."}),n.jsx(ge,{variant:"outline",className:"rounded-2xl h-10",onClick:oe,children:"Search"})]}),n.jsx("div",{className:"text-xs text-slate-500",children:i?"Loading":`${o.length} PO(s)`})]}),n.jsx("div",{className:"border rounded-3xl overflow-hidden",children:n.jsx("div",{className:"max-h-[420px] overflow-auto divide-y",children:i?n.jsxs("div",{className:"p-4 space-y-2",children:[n.jsx(Qe,{className:"h-12 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-12 w-full rounded-2xl"})]}):o.length===0?n.jsx("div",{className:"p-6 text-sm text-slate-500",children:"No pending PO."}):o.map(De=>{var tt,ve;return n.jsx("button",{type:"button",onClick:()=>{$e(De),O(2)},className:"w-full text-left p-4 hover:bg-slate-50 transition-colors",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:De.po_number}),n.jsxs("div",{className:"text-xs text-slate-500 truncate mt-1",children:[((tt=De.supplier)==null?void 0:tt.name)||"","  ",((ve=De.location)==null?void 0:ve.name)||"","  ",Pv(De.order_date)]})]}),n.jsxs(et,{variant:"outline",className:"text-xs shrink-0 bg-white",children:[De.pending_items_count||0," pending"]})]})},De.id)})})}),n.jsx("div",{className:"flex justify-end",children:n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>{I("DIRECT"),O(2)},children:"Skip PO (Direct GRN)"})})]})]}):null,P===2?n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1fr),380px]",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs(qm,{className:"bg-white",children:[n.jsxs(gt,{className:"pb-2",children:[n.jsx(jt,{className:"text-sm",children:"Invoice details"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Supplier/location locked if linked to PO."})]}),n.jsxs(it,{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Supplier"}),n.jsxs(Zs,{value:R.supplier_id,onValueChange:De=>F(tt=>({...tt,supplier_id:De})),disabled:A==="PO"&&!!D||Z,children:[n.jsx(Ws,{className:"bg-white rounded-2xl h-10",children:n.jsx(Js,{placeholder:"Select supplier"})}),n.jsx(qs,{children:d.map(De=>n.jsx(Ut,{value:String(De.id),children:De.name},De.id))})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Receiving location"}),n.jsxs(Zs,{value:R.location_id,onValueChange:De=>F(tt=>({...tt,location_id:De})),disabled:A==="PO"&&!!D||Z,children:[n.jsx(Ws,{className:"bg-white rounded-2xl h-10",children:n.jsx(Js,{placeholder:"Select location"})}),n.jsx(qs,{children:m.map(De=>n.jsx(Ut,{value:String(De.id),children:De.code?`${De.code}  ${De.name}`:De.name},De.id))})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Invoice number"}),n.jsx(Ee,{disabled:Z,className:"bg-white rounded-2xl h-10",value:R.invoice_number,onChange:De=>F(tt=>({...tt,invoice_number:De.target.value})),placeholder:"Supplier bill no"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Invoice date"}),n.jsx(Ee,{disabled:Z,type:"date",className:"bg-white rounded-2xl h-10",value:R.invoice_date,onChange:De=>F(tt=>({...tt,invoice_date:De.target.value}))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Supplier invoice amount (net)"}),n.jsx(Ee,{disabled:Z,type:"number",step:"0.01",min:"0",className:"bg-white rounded-2xl h-10",value:R.supplier_invoice_amount,onChange:De=>F(tt=>({...tt,supplier_invoice_amount:De.target.value})),placeholder:"0.00"})]}),n.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Freight"}),n.jsx(Ee,{disabled:Z,type:"number",step:"0.01",min:"0",className:"bg-white rounded-2xl h-10",value:R.freight_amount,onChange:De=>F(tt=>({...tt,freight_amount:De.target.value})),placeholder:"0.00"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Other"}),n.jsx(Ee,{disabled:Z,type:"number",step:"0.01",min:"0",className:"bg-white rounded-2xl h-10",value:R.other_charges,onChange:De=>F(tt=>({...tt,other_charges:De.target.value})),placeholder:"0.00"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Round off"}),n.jsx(Ee,{disabled:Z,type:"number",step:"0.01",className:"bg-white rounded-2xl h-10",value:R.round_off,onChange:De=>F(tt=>({...tt,round_off:De.target.value})),placeholder:"0.00"})]})]}),n.jsxs("div",{className:"sm:col-span-2 space-y-1.5",children:[n.jsx(xt,{children:"Notes"}),n.jsx(fs,{disabled:Z,className:"bg-white rounded-2xl",value:R.notes,onChange:De=>F(tt=>({...tt,notes:De.target.value})),placeholder:"Optional"})]})]})]}),n.jsxs(qm,{className:"bg-white",children:[n.jsx(gt,{className:"pb-2",children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-sm",children:"Batch lines"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Premium cards. Each line shows Gross/Disc/Tax/Net."})]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:Ae,disabled:Z,children:[n.jsx(ds,{className:"h-4 w-4 mr-1"}),"Add line"]})]})}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{ref:X,className:"relative",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsxs("div",{className:"relative w-full",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-3 text-slate-400"}),n.jsx(Ee,{disabled:Z,className:"bg-white rounded-2xl h-10 pl-9",value:J,onChange:De=>ie(De.target.value),placeholder:"Search item by name / code / generic",onKeyDown:De=>De.key==="Enter"&&fe()})]}),n.jsx(ge,{disabled:Z||q,variant:"outline",className:"rounded-2xl h-10",onClick:fe,children:q?"":"Search"})]}),te.length>0?n.jsx("div",{className:"absolute z-30 mt-2 w-full rounded-3xl border border-slate-500 bg-white shadow-[0_18px_50px_rgba(2,6,23,0.12)] overflow-hidden",children:n.jsx("div",{className:"max-h-72 overflow-auto divide-y",children:te.map(De=>n.jsxs("button",{type:"button",onMouseDown:tt=>tt.preventDefault(),onClick:()=>Me(De),className:"w-full text-left px-4 py-3 hover:bg-slate-50 transition-colors",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:De.name}),n.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:[De.code||"","  ",De.generic_name||"","  Default ",wi(De.default_price||0)]})]},De.id))})}):null]}),G.length===0?n.jsx("div",{className:"rounded-3xl border border-dashed p-6 text-sm text-slate-500 bg-slate-50",children:"No batch lines yet. Search an item above (or select a PO) to start."}):n.jsx("div",{className:"space-y-3",children:G.map((De,tt)=>n.jsx(cXe,{ln:De,idx:tt,readonly:Z,onPatch:ve=>Ke(De._key,ve),onSplit:()=>He(De._key),onRemove:()=>Le(De._key)},De._key))})]})]})]}),n.jsxs("div",{className:"space-y-4 lg:sticky lg:top-4 h-fit",children:[n.jsxs(qm,{className:"bg-white",children:[n.jsx(gt,{className:"pb-2",children:n.jsx(jt,{className:"text-sm",children:"Totals"})}),n.jsxs(it,{className:"space-y-3 text-sm",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx(qo,{label:"Subtotal",value:`${wi(xe.subtotal)}`}),n.jsx(qo,{label:"Discount",value:`${wi(xe.discount)}`}),n.jsx(qo,{label:"Tax",value:`${wi(xe.tax)}`}),n.jsx(qo,{label:"Extras",value:`${wi(xe.extras)}`})]}),n.jsx(vr,{}),n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-slate-50 p-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-xs text-slate-600",children:"Calculated"}),n.jsxs("div",{className:"text-base font-semibold text-slate-900",children:["",wi(xe.calculated)]})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[n.jsx("div",{className:"text-xs text-slate-600",children:"Invoice"}),n.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:["",wi(xe.invoice)]})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[n.jsx(qo,{label:"Lines",value:G.length}),n.jsx(qo,{label:"Item miss",value:xe.itemMissing,tone:xe.itemMissing?"warn":"neutral"}),n.jsx(qo,{label:"Batch miss",value:xe.missingBatch,tone:xe.missingBatch?"warn":"neutral"})]}),n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white p-3 text-xs text-slate-700",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Qty/Free issues"}),n.jsx("span",{className:xe.qtyIssues?"font-semibold text-amber-900":"font-semibold",children:xe.qtyIssues})]})}),xe.mismatch?n.jsx("div",{className:"rounded-3xl bg-amber-50 border border-amber-200 p-4 text-xs text-amber-900",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(en,{className:"w-4 h-4 mt-0.5"}),n.jsxs("div",{className:"w-full",children:[n.jsxs("div",{className:"font-semibold",children:["Invoice mismatch: Diff ",wi(xe.diff)]}),n.jsx("div",{className:"opacity-80 mt-1",children:"Add Difference Reason to save/post."}),n.jsx(Ee,{disabled:Z,className:"mt-2 bg-white rounded-2xl h-10",value:R.difference_reason,onChange:De=>F(tt=>({...tt,difference_reason:De.target.value})),placeholder:"Short supply / damaged / rounding / manual"})]})]})}):null,D!=null&&D.po_number?n.jsxs("div",{className:"rounded-3xl bg-slate-50 border border-slate-500 p-4 text-xs text-slate-700",children:[n.jsxs("div",{className:"font-semibold flex items-center gap-1",children:[n.jsx(yh,{className:"w-3 h-3"})," Linked PO"]}),n.jsx("div",{className:"mt-1",children:D.po_number})]}):null]})]}),n.jsxs(qm,{className:"bg-white",children:[n.jsx(gt,{className:"pb-2",children:n.jsx(jt,{className:"text-sm",children:"Actions"})}),n.jsxs(it,{className:"space-y-2",children:[n.jsx(ge,{className:"w-full rounded-2xl h-11",onClick:Pe,disabled:$||Z,children:$?"Saving":B?"Update Draft":"Save Draft"}),n.jsx(ge,{className:"w-full rounded-2xl h-11",variant:"outline",onClick:bt,disabled:le||!B||Z,children:le?"Posting":"Post GRN (Update Stock)"}),B?null:n.jsx("p",{className:"text-xs text-slate-500",children:"Save draft first. Post enabled after draft exists."}),Z?n.jsx("p",{className:"text-xs text-slate-500",children:"This GRN is read-only."}):null]})]})]})]}):null]}),n.jsx("div",{className:"lg:hidden border-t bg-white p-4",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ge,{className:"w-full rounded-2xl h-11",onClick:Pe,disabled:$||Z,children:$?"Saving":"Save Draft"}),n.jsx(ge,{className:"w-full rounded-2xl h-11",variant:"outline",onClick:bt,disabled:le||!B||Z,children:le?"Posting":"Post"})]})})]})})})]})}const Gb=(...t)=>t.filter(Boolean).join(" ");function qx(t){if(!t)return"";try{return new Date(t).toLocaleDateString()}catch{return t}}const zr=t=>{const s=Number(t);return Number.isFinite(s)?s.toLocaleString("en-IN",{maximumFractionDigits:2}):"0"};function uXe(t,s=350){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}const uo="rounded-3xl border border-slate-500/70 bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/60 shadow-sm",mXe="bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b border-slate-500/60";function Dv({title:t,value:s,subtitle:r,icon:a,iconClass:i="text-slate-400"}){return n.jsxs(dt,{className:Gb(uo,"hover:shadow-md transition-shadow"),children:[n.jsxs(gt,{className:"pb-2 flex flex-row items-center justify-between",children:[n.jsx(jt,{className:"text-xs font-medium text-slate-500",children:t}),a?n.jsx(a,{className:Gb("w-4 h-4",i)}):null]}),n.jsxs(it,{children:[n.jsx("div",{className:"text-2xl font-semibold tracking-tight text-slate-900",children:s}),r?n.jsx("p",{className:"text-xs text-slate-500 mt-1",children:r}):null]})]})}function $B({label:t,value:s,total:r,accent:a="#0ea5e9"}){const i=r>0?Math.min(100,Math.max(0,s/r*100)):0;return n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"h-12 w-12 rounded-full border border-slate-500 shadow-inner",style:{background:`conic-gradient(${a} ${i}%, #e2e8f0 0)`},"aria-label":`${t}: ${i.toFixed(0)}%`,title:`${t}: ${i.toFixed(0)}%`}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-xs text-slate-500",children:t}),n.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:[zr(s)," ",n.jsxs("span",{className:"text-xs font-normal text-slate-500",children:["/ ",zr(r)]})]})]})]})}function d5({label:t,value:s,max:r,accent:a="bg-sky-500"}){const i=r>0?Math.min(100,Math.max(0,s/r*100)):0;return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs",children:[n.jsx("span",{className:"text-slate-600",children:t}),n.jsx("span",{className:"text-slate-900 font-medium",children:zr(s)})]}),n.jsx("div",{className:"h-2 rounded-full bg-slate-100 overflow-hidden border border-slate-500/60",children:n.jsx("div",{className:Gb("h-full rounded-full",a),style:{width:`${i}%`}})})]})}function hXe(){const[t,s]=p.useState("dashboard"),[r,a]=p.useState([]),[i,l]=p.useState([]),[o,c]=p.useState([]),[d,u]=p.useState(!1),[m,x]=p.useState(!1),[g,y]=p.useState([]),[v,j]=p.useState([]),[w,S]=p.useState([]),[E,k]=p.useState([]),[A,I]=p.useState([]),[P,O]=p.useState([]),[D,T]=p.useState(!1),[B,U]=p.useState([]),[W,V]=p.useState(!1),[R,F]=p.useState([]),[G,H]=p.useState(!1),[$,K]=p.useState([]),[le,se]=p.useState(!1),[J,ie]=p.useState("ALL"),[te,ne]=p.useState(""),q=uXe(te,350),[ee,X]=p.useState("saleable"),[Z,Y]=p.useState(""),[Q,oe]=p.useState(""),[_e,xe]=p.useState(null),[me,Re]=p.useState(!1),[Ze,$e]=p.useState(!1),[fe,Me]=p.useState(""),[Ae,Ke]=p.useState(!1),[Le,He]=p.useState(null),[pt,Pe]=p.useState(!1),[bt,It]=p.useState(null),[De,tt]=p.useState(!1),[ve,Ge]=p.useState(null),[We,Ve]=p.useState(!1),[Fe,ot]=p.useState({type:"TO_SUPPLIER",supplier_id:"",location_id:"",reason:""}),[ft,ce]=p.useState([]),[Ce,ze]=p.useState(!0),[Te,Nt]=p.useState(!1),Jt=p.useRef(null),ke=p.useMemo(()=>r.find(Ne=>String(Ne.id)===String(J)),[r,J]),je=p.useMemo(()=>o.length,[o]),ht=p.useMemo(()=>v.length,[v]),At=p.useMemo(()=>A.length,[A]),ms=p.useMemo(()=>w.length,[w]),Zt=p.useMemo(()=>E.length,[E]),hs=p.useMemo(()=>B.filter(Ne=>Ne.status!=="COMPLETED"&&Ne.status!=="CANCELLED"&&Ne.status!=="CLOSED").length,[B]),Is=async(Ne,ut="Copied")=>{if(Ne)try{await navigator.clipboard.writeText(String(Ne)),ae.success(ut)}catch{ae.error("Unable to copy")}};p.useEffect(()=>{Sn(),_s()},[]),p.useEffect(()=>{const Ne=ut=>{var Cs,zn;const Ft=(((Cs=ut.target)==null?void 0:Cs.tagName)||"").toLowerCase();Ft==="input"||Ft==="textarea"||(zn=ut.target)!=null&&zn.isContentEditable||(ut.key==="/"&&(ut.preventDefault(),s("items"),setTimeout(()=>{var Rs,gi;return(gi=(Rs=Jt.current)==null?void 0:Rs.focus)==null?void 0:gi.call(Rs)},50)),ut.key.toLowerCase()==="n"&&(ut.preventDefault(),Rr()),ut.key.toLowerCase()==="u"&&(ut.preventDefault(),x(!0)),ut.key.toLowerCase()==="q"&&(ut.preventDefault(),Re(!0)))};return window.addEventListener("keydown",Ne),()=>window.removeEventListener("keydown",Ne)},[]),p.useEffect(()=>{tn(q)},[q]),p.useEffect(()=>{Ts()},[J]);function _s(){tn(te),Ts(),Cn(),Pt(),Ea(),xe(new Date)}async function Sn(){try{const[Ne,ut]=await Promise.all([z2(),px()]);a(Ne.data||[]),l(ut.data||[])}catch(Ne){console.error(Ne),ae.error("Failed to load masters")}}async function tn(Ne){u(!0);try{const ut=await Df({q:(Ne??te)||void 0,is_active:!0});c(ut.data||[])}catch(ut){console.error(ut)}finally{u(!1)}}async function Ts(){T(!0);const Ne=J&&J!=="ALL"?{location_id:J}:{};try{const[ut,Ft,Vt,Cs,zn,Rs]=await Promise.all([g_e(Ne),b_e(Ne),y_e(Ne),v_e(Ne),j_e(Ne),N_e(Ne)]);y(ut.data||[]),j(Ft.data||[]),S(Vt.data||[]),k(Cs.data||[]),I(zn.data||[]),O(Rs.data||[])}catch(ut){console.error(ut)}finally{T(!1)}}async function Cn(){V(!0);try{const Ne=await wK({});U(Ne.data||[])}catch(Ne){console.error(Ne)}finally{V(!1)}}async function Pt(){H(!0);try{const Ne=await O_e({});F(Ne.data||[])}catch(Ne){console.error(Ne)}finally{H(!1)}}async function Ea(){se(!0);try{const Ne=await L_e({});K(Ne.data||[])}catch(Ne){console.error(Ne)}finally{se(!1)}}function Rr(){He(null),Ke(!0)}function Jn(Ne){He(Ne),Ke(!0)}const Zl=async Ne=>{var Cs,zn;Ne.preventDefault();const ut=Ne.currentTarget,Ft={code:ut.code.value.trim(),name:ut.name.value.trim(),generic_name:ut.generic_name.value.trim()||null,form:ut.form.value.trim()||null,strength:ut.strength.value.trim()||null,unit:ut.unit.value.trim()||"tablet",pack_size:ut.pack_size.value||"10",manufacturer:ut.manufacturer.value.trim()||null,default_price:ut.default_price.value||null,default_mrp:ut.default_mrp.value||null,default_tax_percent:ut.default_tax_percent.value||null,reorder_level:ut.reorder_level.value||null,max_level:ut.max_level.value||null,class_name:ut.class_name.value.trim()||null,atc_code:ut.atc_code.value.trim()||null,hsn_code:ut.hsn_code.value.trim()||null,is_consumable:ut.is_consumable.checked,lasa_flag:ut.lasa_flag.checked},Vt=(zn=(Cs=ut.qr_number)==null?void 0:Cs.value)==null?void 0:zn.trim();Vt&&(Ft.qr_number=Vt);try{Le!=null&&Le.id?(await x_e(Le.id,Ft),ae.success("Item updated")):(await h_e(Ft),ae.success("Item created")),Ke(!1),ut.reset(),await Promise.all([tn(te),Ts()])}catch(Rs){console.error("Failed to save item",Rs)}};function Fi(){It(null),Pe(!0)}function Jl(Ne){It(Ne),Pe(!0)}async function Nr(Ne){Ne.preventDefault();const ut=new FormData(Ne.target),Ft={code:ut.get("code")||"",name:ut.get("name")||"",description:ut.get("description")||"",is_active:!0};if(!Ft.name){ae.error("Location name is required");return}try{bt?(await d_e(bt.id,Ft),ae.success("Location updated")):(await c_e(Ft),ae.success("Location created")),Pe(!1),It(null),await Sn(),await Ts()}catch(Vt){console.error(Vt)}}function xu(){Ge(null),tt(!0)}function pu(Ne){Ge(Ne),tt(!0)}async function Ta(Ne){Ne.preventDefault();const ut=new FormData(Ne.target),Ft={code:ut.get("code")||"",name:ut.get("name")||"",contact_person:ut.get("contact_person")||"",phone:ut.get("phone")||"",email:ut.get("email")||"",gst_number:ut.get("gst_number")||"",address:ut.get("address")||"",is_active:!0};if(!Ft.name){ae.error("Supplier name is required");return}try{ve?(await m_e(ve.id,Ft),ae.success("Supplier updated")):(await u_e(Ft),ae.success("Supplier created")),tt(!1),Ge(null),await Sn(),await Cn(),await Pt()}catch(Vt){console.error(Vt)}}async function Pn(Ne){try{const Ft=(await NK(Ne)).data,Vt=window.URL.createObjectURL(Ft),Cs=document.createElement("a");Cs.href=Vt,Cs.download=Ne==="xlsx"?"items_template.xlsx":"items_template.csv",document.body.appendChild(Cs),Cs.click(),Cs.remove(),window.URL.revokeObjectURL(Vt),ae.success(`${Ne.toUpperCase()} template downloaded`)}catch{ae.error("Failed to download template")}}function Os(){ce(Ne=>[...Ne,{item_id:"",batch_id:"",batch_no:"",quantity:0,reason:""}])}function bl(Ne,ut,Ft){ce(Vt=>Vt.map((Cs,zn)=>zn===Ne?{...Cs,[ut]:Ft}:Cs))}function Za(Ne){ce(ut=>ut.filter((Ft,Vt)=>Vt!==Ne))}async function Bo(Ne){if(Ne.preventDefault(),!Fe.location_id||ft.length===0){ae.error("Location and at least one line are required");return}const ut={type:Fe.type,supplier_id:Fe.supplier_id?Number(Fe.supplier_id):null,location_id:Number(Fe.location_id),return_date:new Date().toISOString().slice(0,10),reason:Fe.reason||"",items:ft.filter(Ft=>Ft.item_id&&Ft.quantity).map(Ft=>({item_id:Number(Ft.item_id),batch_id:Ft.batch_id?Number(Ft.batch_id):null,batch_no:Ft.batch_no?Ft.batch_no.trim():null,quantity:Number(Ft.quantity||0),reason:Ft.reason||""}))};if(ut.items.length===0){ae.error("Add at least one valid return line");return}try{await I_e(ut),ae.success("Return created in DRAFT"),Ve(!1),ce([]),ot({type:"TO_SUPPLIER",supplier_id:"",location_id:"",reason:""}),Pt(),Ts()}catch(Ft){console.error(Ft)}}async function yt(Ne){try{await R_e(Ne),ae.success("Return posted & stock updated"),Pt(),Ts()}catch(ut){console.error(ut)}}function yl(Ne,ut="EXPIRED"){var Cs;if(!Ne)return;const Ft=((Cs=Ne.item)==null?void 0:Cs.name)||Ne.name||Ne.item_name||`Item #${Ne.item_id??""}`,Vt=ut==="EXPIRED"?`Expired batch ${Ne.batch_no||""} (${Ft})`:`Quarantine batch ${Ne.batch_no||""} (${Ft})`;Ve(!0),ot(zn=>({...zn,type:ut==="EXPIRED"?"INTERNAL":zn.type,location_id:Ne.location_id?String(Ne.location_id):zn.location_id,reason:Vt})),ce([{item_id:String(Ne.item_id),batch_id:String(Ne.id),batch_no:Ne.batch_no||"",quantity:Number(Ne.current_qty??0),reason:ut==="EXPIRED"?"Expired":"Quarantine / quality issue"}])}const ln=()=>{const Ne=(fe||"").trim();if(!Ne)return ae.error("Enter barcode / item code");const ut=o.find(Ft=>String(Ft.qr_number||"").trim()===Ne)||o.find(Ft=>String(Ft.code||"").trim()===Ne);if(!ut){ae.error("Not found",{description:"No item matches this barcode/code."});return}$e(!1),Me(""),Jn(ut)},wr=(Z||"").toLowerCase().trim(),Nc=p.useMemo(()=>wr?(g||[]).filter(Ne=>[Ne.name,Ne.code,Ne.location_name].filter(Boolean).join(" ").toLowerCase().includes(wr)):g,[g,wr]),Ss=p.useMemo(()=>wr?(E||[]).filter(Ne=>{var Ft,Vt,Cs;return[(Ft=Ne.item)==null?void 0:Ft.name,Ne.item_name,Ne.batch_no,(Vt=Ne.location)==null?void 0:Vt.name,(Cs=Ne.item)==null?void 0:Cs.code].filter(Boolean).join(" ").toLowerCase().includes(wr)}):E,[E,wr]),bs=(Q||"").toLowerCase().trim(),vs=p.useMemo(()=>bs?($||[]).filter(Ne=>[Ne.item_name,Ne.item_code,Ne.batch_no,Ne.location_name,Ne.txn_type,Ne.ref_display].filter(Boolean).join(" ").toLowerCase().includes(bs)):$,[$,bs]);return n.jsx(mt.div,{className:"min-h-screen bg-[radial-gradient(1200px_600px_at_20%_-10%,rgba(59,130,246,0.12),transparent),radial-gradient(900px_500px_at_90%_0%,rgba(16,185,129,0.10),transparent)]",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},children:n.jsxs("div",{className:"mx-auto w-full max-w-[1600px] px-4 sm:px-6 lg:px-8 pb-16",children:[n.jsx("div",{className:Gb("sticky top-0 z-30 -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 py-4",mXe),children:n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-slate-900 truncate",children:"Pharmacy Inventory"}),n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full",children:"Premium UI"})]}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"Purchase  GRN  Stock  Returns  NABH-friendly audit trail"})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center",children:[n.jsxs(Zs,{value:J,onValueChange:Ne=>ie(Ne),children:[n.jsx(Ws,{className:"w-full sm:w-64 bg-white/80 rounded-2xl",children:n.jsx(Js,{placeholder:"All locations","aria-label":"Location filter"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"ALL",children:"All locations"}),r.map(Ne=>n.jsx(Ut,{value:String(Ne.id),children:Ne.code?`${Ne.code}  ${Ne.name}`:Ne.name},Ne.id))]})]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl bg-white/80",onClick:_s,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Refresh"]}),n.jsxs(ge,{className:"rounded-2xl hidden sm:inline-flex",onClick:()=>Re(!0),children:[n.jsx($n,{className:"w-4 h-4 mr-2"}),"Quick"]})]})]})}),n.jsxs("div",{className:"grid gap-3 sm:gap-4 mt-5 mb-6 grid-cols-2 lg:grid-cols-4",children:[n.jsx(Dv,{title:"Active items",value:je,subtitle:"Medicines & consumables",icon:rr}),n.jsx(Dv,{title:"Near-expiry",value:ht,subtitle:`Expired: ${ms}`,icon:en,iconClass:"text-amber-500"}),n.jsx(Dv,{title:"Low stock",value:At,subtitle:`Quarantine: ${Zt}`,icon:jg,iconClass:"text-sky-600"}),n.jsx(Dv,{title:"Open POs",value:W?"":hs,subtitle:"Draft / sent / partial",icon:dC,iconClass:"text-emerald-600"})]}),n.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr,340px]",children:[n.jsx("div",{className:"space-y-4",children:n.jsxs(Do,{value:t,onValueChange:s,className:"space-y-4",children:[n.jsxs(Wl,{className:"w-full justify-start bg-white/70 backdrop-blur border border-slate-500/70 rounded-2xl p-1 overflow-x-auto",children:[n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"dashboard",children:"Dashboard"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"items",children:"Items"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"locations",children:"Locations"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"suppliers",children:"Suppliers"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"stock",children:"Stock & Alerts"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"po",children:"Purchase Orders"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"grn",children:"GRN"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"returns",children:"Returns"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"txns",children:"Transactions"})]}),n.jsx(Ls,{value:"dashboard",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-row items-center justify-between pb-2",children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Expiry alerts",n.jsx(et,{variant:"outline",className:"text-xs",children:v.length+w.length})]}),n.jsx(en,{className:"w-4 h-4 text-amber-500"})]}),n.jsx(it,{className:"space-y-3 max-h-[340px] overflow-auto",children:D?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-8 w-full"}),n.jsx(Qe,{className:"h-8 w-full"}),n.jsx(Qe,{className:"h-8 w-full"})]}):v.length===0&&w.length===0?n.jsxs("p",{className:"text-sm text-slate-500",children:["No expiry issues for ",ke?ke.name:"all locations","."]}):n.jsxs(n.Fragment,{children:[w.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-xs font-semibold text-rose-600 uppercase tracking-wide",children:"Expired on shelf"}),n.jsx("div",{className:"space-y-1.5",children:w.slice(0,30).map(Ne=>{var ut;return n.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-rose-200 bg-rose-50 px-3 py-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("p",{className:"text-sm font-medium text-slate-900 truncate",children:[((ut=Ne.item)==null?void 0:ut.name)||Ne.name||Ne.item_name||`Item #${Ne.item_id??""}`,Ne.batch_no?n.jsxs("span",{className:"text-xs text-slate-500",children:[" (",Ne.batch_no,")"]}):null]}),n.jsxs("p",{className:"text-xs text-slate-500",children:["Qty: ",zr(Ne.current_qty),"  Expired: ",qx(Ne.expiry_date)]})]}),n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx(ge,{variant:"outline",size:"icon",className:"rounded-2xl h-9 w-9 bg-white/70",children:n.jsx(tg,{className:"w-4 h-4"})})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsx(Yx,{children:"Actions"}),n.jsx(Dd,{}),n.jsx(kr,{onClick:()=>yl(Ne,"EXPIRED"),children:"Create return"})]})]})]},`expired-${Ne.id}`)})})]}),v.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-xs font-semibold text-amber-600 uppercase tracking-wide",children:"Near expiry"}),n.jsx("div",{className:"space-y-1.5",children:v.slice(0,30).map(Ne=>{var ut;return n.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-500 px-3 py-2 bg-slate-50",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("p",{className:"text-sm font-medium text-slate-900 truncate",children:[((ut=Ne.item)==null?void 0:ut.name)||Ne.name||Ne.item_name||`Item #${Ne.item_id??""}`,Ne.batch_no?n.jsxs("span",{className:"text-xs text-slate-500",children:[" (",Ne.batch_no,")"]}):null]}),n.jsxs("p",{className:"text-xs text-slate-500",children:["Qty: ",zr(Ne.current_qty),"  Exp: ",qx(Ne.expiry_date)]})]}),n.jsxs(et,{variant:"outline",className:"text-xs rounded-full",children:["Exp: ",qx(Ne.expiry_date)]})]},`near-${Ne.id}`)})})]})]})})]}),n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-row items-center justify-between pb-2",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Inventory health",n.jsx(et,{variant:"outline",className:"text-xs",children:A.length+P.length})]}),n.jsx(gs,{className:"text-xs",children:"Quick Apple Health style view of risk areas."})]}),n.jsx(Qs,{className:"w-4 h-4 text-sky-500"})]}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsx($B,{label:"Expiry risk",value:ms,total:Math.max(1,ms+ht),accent:"#ef4444"}),n.jsx($B,{label:"Stock risk",value:At,total:Math.max(1,At+P.length),accent:"#0ea5e9"})]}),n.jsxs("div",{className:"space-y-3 rounded-2xl border border-slate-500/70 bg-white/60 p-3",children:[n.jsx(d5,{label:"Low stock items",value:A.length,max:Math.max(1,A.length+P.length),accent:"bg-amber-500"}),n.jsx(d5,{label:"Over-stock items",value:P.length,max:Math.max(1,A.length+P.length),accent:"bg-sky-500"}),n.jsx(d5,{label:"Quarantine batches",value:E.length,max:Math.max(1,E.length+w.length),accent:"bg-slate-700"})]}),n.jsxs("div",{className:"text-xs text-slate-500 flex items-center justify-between",children:[n.jsxs("span",{children:["Location: ",n.jsx("span",{className:"text-slate-900 font-medium",children:(ke==null?void 0:ke.name)||"All"})]}),n.jsxs("span",{children:["Refreshed: ",n.jsx("span",{className:"text-slate-900 font-medium",children:_e?_e.toLocaleTimeString():""})]})]})]})]})]})}),n.jsx(Ls,{value:"items",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Pharmacy items",n.jsx(et,{variant:"outline",className:"text-xs",children:o.length})]}),n.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-2 mt-1",children:["Medicines & consumables master (defaults only for prefill).",n.jsxs("span",{className:"inline-flex items-center gap-1 text-slate-600",children:[n.jsx(gr,{className:"h-3 w-3"}),"Billing uses ",n.jsx("b",{children:"Batch MRP from GRN"}),"."]})]}),n.jsxs("p",{className:"text-[11px] text-slate-400 mt-1",children:["Shortcuts: ",n.jsx("span",{className:"font-medium",children:"/"})," focus search  ",n.jsx("span",{className:"font-medium",children:"N"})," new item  ",n.jsx("span",{className:"font-medium",children:"U"})," upload  ",n.jsx("span",{className:"font-medium",children:"Q"})," quick actions"]})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"gap-1 rounded-2xl bg-white/70",onClick:()=>$e(!0),children:[n.jsx(yo,{className:"w-3 h-3"}),"Barcode lookup"]}),n.jsxs(ge,{variant:"outline",size:"sm",className:"gap-1 rounded-2xl bg-white/70",onClick:()=>x(!0),children:[n.jsx(Nh,{className:"w-3 h-3"}),"Upload (CSV/Excel)"]}),n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsxs(ge,{variant:"outline",size:"sm",className:"gap-1 rounded-2xl bg-white/70",children:[n.jsx(nn,{className:"w-3 h-3"}),"Templates"]})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsx(Yx,{children:"Download template"}),n.jsx(Dd,{}),n.jsx(kr,{onClick:()=>Pn("csv"),children:"CSV template"}),n.jsx(kr,{onClick:()=>Pn("xlsx"),children:"Excel template"})]})]}),n.jsxs(ge,{size:"sm",className:"gap-1 rounded-2xl",onClick:Rr,children:[n.jsx(ds,{className:"w-3 h-3"}),"New item"]})]})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:n.jsxs("div",{className:"flex items-center gap-2 w-full",children:[n.jsxs("div",{className:"relative w-full sm:max-w-md",children:[n.jsx(Yt,{className:"h-4 w-4 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx(Ee,{ref:Jt,placeholder:"Search by name / code / generic / barcode...",className:"w-full bg-white/80 rounded-2xl h-10 pl-9 pr-9",value:te,onChange:Ne=>ne(Ne.target.value)}),te?n.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 rounded-xl p-1 text-slate-500 hover:text-slate-900",onClick:()=>ne(""),"aria-label":"Clear search",title:"Clear",children:n.jsx(ts,{className:"h-4 w-4"})}):null]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl h-10 bg-white/80",onClick:()=>tn(te),children:[n.jsx(jr,{className:"w-4 h-4 mr-2"}),"Apply"]})]})}),n.jsxs("div",{className:"hidden md:block border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[2fr,1.2fr,1fr,1fr,0.7fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Name / code"}),n.jsx("span",{children:"Generic / form"}),n.jsx("span",{children:"Defaults"}),n.jsx("span",{children:"Reorder / Max"}),n.jsx("span",{className:"text-right",children:"Actions"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:d?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):o.length===0?n.jsxs("div",{className:"p-6 text-sm text-slate-500 flex items-center gap-3",children:[n.jsx(NV,{className:"h-5 w-5 text-slate-400"}),"No items found. Use New item or Upload to add catalogue."]}):o.map(Ne=>n.jsxs("div",{className:"grid grid-cols-[2fr,1.2fr,1fr,1fr,0.7fr] items-center px-3 py-2 text-xs",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-medium text-slate-900 truncate",children:Ne.name}),n.jsxs("div",{className:"text-slate-500 flex flex-wrap items-center gap-1",children:[n.jsx("button",{type:"button",className:"hover:text-slate-900 underline-offset-2 hover:underline",onClick:()=>Is(Ne.code,"Item code copied"),children:Ne.code}),Ne.qr_number?n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full",children:Ne.qr_number}):null,Ne.is_consumable?n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full",children:"Consumable"}):null,Ne.lasa_flag?n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full border-rose-300 text-rose-600",children:"LASA"}):null]})]}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-slate-700 truncate",children:Ne.generic_name||""}),n.jsxs("div",{className:"text-slate-500 truncate",children:[Ne.form||""," ",Ne.strength?` ${Ne.strength}`:""]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"text-slate-700",children:["Price: ",zr(Ne.default_price)]}),n.jsxs("div",{className:"text-slate-500",children:["MRP: ",zr(Ne.default_mrp),"  Tax: ",zr(Ne.default_tax_percent),"%"]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"text-slate-700",children:["Reorder: ",zr(Ne.reorder_level)]}),n.jsxs("div",{className:"text-slate-500",children:["Max: ",zr(Ne.max_level)]})]}),n.jsx("div",{className:"flex items-center justify-end gap-2",children:n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx(ge,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-2xl bg-white/70",children:n.jsx(tg,{className:"w-4 h-4"})})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsx(Yx,{children:"Item actions"}),n.jsx(Dd,{}),n.jsxs(kr,{onClick:()=>Jn(Ne),children:[n.jsx(Wr,{className:"w-4 h-4 mr-2"}),"View / Edit"]}),n.jsxs(kr,{onClick:()=>Is(Ne.code,"Code copied"),children:[n.jsx(vg,{className:"w-4 h-4 mr-2"}),"Copy code"]}),Ne.qr_number?n.jsxs(kr,{onClick:()=>Is(Ne.qr_number,"Barcode copied"),children:[n.jsx(yo,{className:"w-4 h-4 mr-2"}),"Copy barcode"]}):null]})]})})]},Ne.id))})]}),n.jsx("div",{className:"md:hidden space-y-2",children:d?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-16 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-16 w-full rounded-2xl"})]}):o.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500 border rounded-2xl bg-white/70",children:"No items found. Use New item or Upload to add catalogue."}):o.map(Ne=>n.jsxs("div",{className:"rounded-2xl border border-slate-500/70 bg-white/70 backdrop-blur p-3 flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:Ne.name}),n.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2",children:[n.jsx("button",{type:"button",className:"underline-offset-2 hover:underline",onClick:()=>Is(Ne.code,"Item code copied"),children:Ne.code}),Ne.qr_number?n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full",children:Ne.qr_number}):null]}),n.jsxs("div",{className:"text-xs text-slate-700 mt-2",children:["",zr(Ne.default_price),"  MRP ",zr(Ne.default_mrp),"  ",zr(Ne.default_tax_percent),"% GST"]}),n.jsxs("div",{className:"text-[11px] text-slate-500 mt-1",children:["Reorder ",zr(Ne.reorder_level),"  Max ",zr(Ne.max_level)]}),n.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[Ne.is_consumable?n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full",children:"Consumable"}):null,Ne.lasa_flag?n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full border-rose-300 text-rose-600",children:"LASA"}):null]})]}),n.jsx(ge,{variant:"outline",size:"icon",className:"rounded-2xl bg-white/70",onClick:()=>Jn(Ne),children:n.jsx(Wr,{className:"h-4 w-4"})})]},Ne.id))}),n.jsx(sXe,{open:m,onOpenChange:x,onImported:()=>tn(te)})]})]})}),n.jsx(Ls,{value:"locations",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-row items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Inventory locations",n.jsx(et,{variant:"outline",className:"text-xs",children:r.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Define pharmacy / store locations for stock segregation."})]}),n.jsxs(ge,{size:"sm",className:"gap-1 rounded-2xl",onClick:Fi,children:[n.jsx(ds,{className:"w-3 h-3"}),"New location"]})]}),n.jsx(it,{children:n.jsxs("div",{className:"border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[0.6fr,1.4fr,1fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Code"}),n.jsx("span",{children:"Name"}),n.jsx("span",{className:"text-right",children:"Actions"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:r.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No locations defined yet."}):r.map(Ne=>n.jsxs("div",{className:"grid grid-cols-[0.6fr,1.4fr,1fr] items-center px-3 py-2 text-xs",children:[n.jsx("div",{className:"text-slate-900 font-medium",children:Ne.code||""}),n.jsxs("div",{className:"text-slate-900",children:[Ne.name,Ne.description?n.jsx("div",{className:"text-[11px] text-slate-500",children:Ne.description}):null]}),n.jsx("div",{className:"flex items-center justify-end",children:n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx(ge,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-2xl bg-white/70",children:n.jsx(tg,{className:"w-4 h-4"})})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsx(Yx,{children:"Actions"}),n.jsx(Dd,{}),n.jsxs(kr,{onClick:()=>Jl(Ne),children:[n.jsx(Wr,{className:"w-4 h-4 mr-2"}),"View / Edit"]}),n.jsxs(kr,{onClick:()=>Is(Ne.name,"Location name copied"),children:[n.jsx(vg,{className:"w-4 h-4 mr-2"}),"Copy name"]})]})]})})]},Ne.id))})]})})]})}),n.jsx(Ls,{value:"suppliers",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-row items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Suppliers",n.jsx(et,{variant:"outline",className:"text-xs",children:i.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Vendor master for PO, GRN, and returns."})]}),n.jsxs(ge,{size:"sm",className:"gap-1 rounded-2xl",onClick:xu,children:[n.jsx(ds,{className:"w-3 h-3"}),"New supplier"]})]}),n.jsx(it,{children:n.jsxs("div",{className:"border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[0.8fr,1.4fr,1.4fr,0.8fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Code"}),n.jsx("span",{children:"Name / contact"}),n.jsx("span",{children:"Contact details"}),n.jsx("span",{className:"text-right",children:"Actions"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:i.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No suppliers defined yet."}):i.map(Ne=>n.jsxs("div",{className:"grid grid-cols-[0.8fr,1.4fr,1.4fr,0.8fr] items-center px-3 py-2 text-xs",children:[n.jsx("div",{className:"text-slate-900 font-medium",children:Ne.code||""}),n.jsxs("div",{className:"text-slate-900",children:[Ne.name,Ne.contact_person?n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Contact: ",Ne.contact_person]}):null]}),n.jsxs("div",{className:"text-slate-700 text-[11px] space-y-0.5",children:[Ne.phone?n.jsxs("div",{children:[" ",Ne.phone]}):null,Ne.email?n.jsxs("div",{children:[" ",Ne.email]}):null,Ne.gst_number?n.jsxs("div",{className:"text-slate-500",children:["GST: ",Ne.gst_number]}):null]}),n.jsx("div",{className:"flex items-center justify-end",children:n.jsxs(Vc,{children:[n.jsx(Hc,{asChild:!0,children:n.jsx(ge,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-2xl bg-white/70",children:n.jsx(tg,{className:"w-4 h-4"})})}),n.jsxs(tc,{align:"end",className:"rounded-2xl",children:[n.jsx(Yx,{children:"Supplier actions"}),n.jsx(Dd,{}),n.jsxs(kr,{onClick:()=>pu(Ne),children:[n.jsx(Wr,{className:"w-4 h-4 mr-2"}),"View / Edit"]}),Ne.email?n.jsxs(kr,{onClick:()=>Is(Ne.email,"Email copied"),children:[n.jsx(vg,{className:"w-4 h-4 mr-2"}),"Copy email"]}):null]})]})})]},Ne.id))})]})})]})}),n.jsx(Ls,{value:"stock",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Stock summary",n.jsx(et,{variant:"outline",className:"text-xs",children:g.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Location-wise quantities with low/max indicators."})]}),n.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(Yt,{className:"h-4 w-4 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx(Ee,{placeholder:"Search stock...",className:"bg-white/80 rounded-2xl h-10 pl-9",value:Z,onChange:Ne=>Y(Ne.target.value)})]}),n.jsx(nb,{className:"w-4 h-4 text-slate-400 hidden sm:block"})]})]}),n.jsx(it,{className:"space-y-4",children:n.jsxs(Do,{value:ee,onValueChange:X,className:"space-y-3",children:[n.jsxs(Wl,{className:"bg-white/70 border border-slate-500/70 rounded-2xl p-1 inline-flex gap-1",children:[n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"saleable",children:"Saleable stock"}),n.jsx(zs,{className:"rounded-xl px-4 py-2 text-xs",value:"quarantine",children:"Expired & quarantine"})]}),n.jsx(Ls,{value:"saleable",className:"space-y-3",children:n.jsxs("div",{className:"border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[2fr,1.2fr,1fr,0.8fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Item"}),n.jsx("span",{children:"Location"}),n.jsx("span",{children:"Qty"}),n.jsx("span",{children:"Status"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:D?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):Nc.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No stock summary."}):Nc.map(Ne=>{const ut=[];return Ne.is_low&&ut.push(n.jsx(et,{variant:"outline",className:"border-amber-300 text-amber-700 text-[10px] rounded-full",children:"Low"},"low")),Ne.is_over&&ut.push(n.jsx(et,{variant:"outline",className:"border-sky-300 text-sky-700 text-[10px] rounded-full",children:"Max"},"max")),ut.length||ut.push(n.jsx(et,{variant:"outline",className:"text-[10px] rounded-full",children:"OK"},"ok")),n.jsxs("div",{className:"grid grid-cols-[2fr,1.2fr,1fr,0.8fr] items-center px-3 py-2 text-xs",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-medium text-slate-900 truncate",children:Ne.name}),n.jsx("p",{className:"text-slate-500 truncate",children:Ne.code})]}),n.jsx("div",{className:"text-slate-700 truncate",children:Ne.location_name||"All locations"}),n.jsx("div",{className:"text-slate-900 font-medium",children:zr(Ne.total_qty)}),n.jsx("div",{className:"flex gap-1 flex-wrap",children:ut})]},`${Ne.item_id}-${Ne.location_id||"all"}`)})})]})}),n.jsx(Ls,{value:"quarantine",className:"space-y-3",children:n.jsxs("div",{className:"border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[2fr,1.2fr,1fr,1fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Item / batch"}),n.jsx("span",{children:"Location"}),n.jsx("span",{children:"Qty / expiry"}),n.jsx("span",{className:"text-right",children:"Status / actions"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:D?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):Ss.length===0?n.jsxs("div",{className:"p-4 text-sm text-slate-500",children:["No quarantine / expired batches for ",ke?ke.name:"all locations","."]}):Ss.map(Ne=>{var Vt,Cs,zn;const ut=(Ne.status||"").toUpperCase();let Ft="text-[10px] rounded-full";return ut==="EXPIRED"||ut==="WRITTEN_OFF"?Ft+=" border-rose-300 text-rose-700":ut==="QUARANTINE"?Ft+=" border-amber-300 text-amber-700":ut==="RETURNED"&&(Ft+=" border-slate-300 text-slate-600"),n.jsxs("div",{className:"grid grid-cols-[2fr,1.2fr,1fr,1fr] items-center px-3 py-2 text-xs",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-medium text-slate-900 truncate",children:((Vt=Ne.item)==null?void 0:Vt.name)||Ne.name||Ne.item_name||`Item #${Ne.item_id??""}`}),n.jsxs("p",{className:"text-[11px] text-slate-500 truncate",children:["Batch: ",Ne.batch_no||"","  Code: ",((Cs=Ne.item)==null?void 0:Cs.code)||""]})]}),n.jsx("div",{className:"text-slate-700 truncate",children:((zn=Ne.location)==null?void 0:zn.name)||""}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-slate-900 font-medium",children:["Qty: ",zr(Ne.current_qty)]}),n.jsxs("p",{className:"text-[11px] text-slate-500",children:["Exp: ",qx(Ne.expiry_date)||""]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(et,{variant:"outline",className:Ft,children:ut||"UNKNOWN"}),ut!=="RETURNED"?n.jsx(ge,{type:"button",variant:"outline",size:"sm",className:"h-9 px-3 rounded-2xl bg-white/70 text-[11px]",onClick:()=>yl(Ne,ut==="EXPIRED"?"EXPIRED":"QUARANTINE"),children:"Create return"}):null]})]},`q-${Ne.id}`)})})]})})]})})]})}),n.jsx(Ls,{value:"po",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Purchase Orders",n.jsx(et,{variant:"outline",className:"text-xs",children:B.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Modern PO workflow is inside this tab."})]}),n.jsxs(ge,{className:"rounded-2xl",onClick:()=>ae.message("Use New PO inside Purchase Orders tab UI"),children:[n.jsx(Ki,{className:"w-4 h-4 mr-2"}),"Go"]})]}),n.jsx(it,{children:n.jsx(aXe,{})})]})}),n.jsx(Ls,{value:"grn",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["GRN",n.jsx(et,{variant:"outline",className:"text-xs",children:"Workflow"})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Create GRN drafts, post to update stock, and view history."})]}),n.jsxs(ge,{className:"rounded-2xl",onClick:()=>ae.message("Use New GRN inside GRN tab UI"),children:[n.jsx(Ki,{className:"w-4 h-4 mr-2"}),"Go"]})]}),n.jsx(it,{children:n.jsx(dXe,{})})]})}),n.jsx(Ls,{value:"returns",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-row items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Returns",n.jsx(et,{variant:"outline",className:"text-xs",children:R.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Returns to suppliers, from customers, and internal adjustments."})]}),n.jsxs(ge,{size:"sm",className:"gap-1 rounded-2xl",onClick:()=>Ve(!0),children:[n.jsx(ds,{className:"w-3 h-3"}),"New return"]})]}),n.jsx(it,{children:n.jsxs("div",{className:"border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,0.9fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Return no."}),n.jsx("span",{children:"Type / supplier"}),n.jsx("span",{children:"Location / reason"}),n.jsx("span",{children:"Status"}),n.jsx("span",{className:"text-right",children:"Actions"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:G?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):R.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No returns recorded yet."}):R.map(Ne=>{var ut,Ft;return n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,0.9fr] items-center px-3 py-2 text-xs",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-900",children:Ne.return_number}),n.jsxs("p",{className:"text-slate-500",children:["Date: ",qx(Ne.return_date)]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-900",children:Ne.type.replace("_"," ")}),n.jsx("p",{className:"text-slate-500 text-[11px]",children:((ut=Ne.supplier)==null?void 0:ut.name)||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-900",children:(Ft=Ne.location)==null?void 0:Ft.name}),n.jsx("p",{className:"text-slate-500 text-[11px]",children:Ne.reason||""})]}),n.jsx("div",{children:n.jsx(et,{variant:"outline",className:"text-[10px] capitalize rounded-full",children:Ne.status.toLowerCase()})}),n.jsx("div",{className:"flex items-center justify-end gap-2",children:Ne.status==="DRAFT"?n.jsx(ge,{variant:"outline",size:"sm",className:"h-9 px-3 rounded-2xl bg-white/70 text-[11px]",onClick:()=>yt(Ne.id),children:"Post return"}):n.jsx("span",{className:"text-[11px] text-slate-400",children:""})})]},Ne.id)})})]})})]})}),n.jsx(Ls,{value:"txns",children:n.jsxs(dt,{className:uo,children:[n.jsxs(gt,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("div",{children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:["Stock transactions",n.jsx(et,{variant:"outline",className:"text-xs",children:$.length})]}),n.jsx("p",{className:"text-xs text-slate-500",children:"Audit trail of every stock movement (GRN, returns, adjustments)."})]}),n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(Yt,{className:"h-4 w-4 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx(Ee,{placeholder:"Search transactions...",className:"bg-white/80 rounded-2xl h-10 pl-9",value:Q,onChange:Ne=>oe(Ne.target.value)})]})]}),n.jsx(it,{children:n.jsxs("div",{className:"border border-slate-500/70 rounded-2xl overflow-hidden bg-white/70 backdrop-blur",children:[n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.4fr,1fr,1.1fr,0.9fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0 z-10",children:[n.jsx("span",{children:"Date / type"}),n.jsx("span",{children:"Item / batch"}),n.jsx("span",{children:"Location"}),n.jsx("span",{children:"Qty / cost"}),n.jsx("span",{children:"User / ref"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:le?n.jsxs("div",{className:"p-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):vs.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No stock transactions found."}):vs.map(Ne=>n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.4fr,1fr,1.1fr,0.9fr] items-center px-3 py-2 text-xs",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-slate-900",children:qx(Ne.txn_time)}),n.jsxs("p",{className:"text-slate-500",children:[Ne.txn_type," ",Ne.ref_display?` ${Ne.ref_display}`:Ne.ref_type&&Ne.ref_id?` ${Ne.ref_type} #${Ne.ref_id}`:""]})]}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"text-slate-900 truncate",children:Ne.item_name||`Item #${Ne.item_id}`}),n.jsxs("p",{className:"text-slate-500 text-[11px] truncate",children:[Ne.item_code?n.jsxs("span",{children:["Code: ",Ne.item_code,"  "]}):null,"Batch: ",Ne.batch_no?Ne.batch_no:Ne.batch_id?`#${Ne.batch_id}`:""]})]}),n.jsx("div",{className:"text-slate-700 truncate",children:Ne.location_name||(Ne.location_id?`Location #${Ne.location_id}`:"")}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-slate-900",children:["Qty: ",zr(Ne.quantity_change)]}),n.jsxs("p",{className:"text-slate-500 text-[11px]",children:["Rate: ",zr(Ne.unit_cost),"  MRP: ",zr(Ne.mrp)]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-900 text-[11px]",children:Ne.user_name||(Ne.user_id?`User #${Ne.user_id}`:"System")}),n.jsx("p",{className:"text-slate-500 text-[11px] truncate",children:Ne.ref_display||(Ne.ref_type&&Ne.ref_id?`${Ne.ref_type} #${Ne.ref_id}`:"")})]})]},Ne.id))})]})})]})})]})}),n.jsx("div",{className:"hidden lg:block space-y-4",children:n.jsxs(dt,{className:Gb(uo,"sticky top-[92px]"),children:[n.jsxs(gt,{className:"pb-2",children:[n.jsxs(jt,{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[n.jsx($n,{className:"w-4 h-4"}),"Quick Actions"]}),n.jsx(gs,{className:"text-xs",children:"One-click actions for faster work."})]}),n.jsxs(it,{className:"space-y-2",children:[n.jsxs(ge,{className:"w-full justify-between rounded-2xl",onClick:Rr,children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(ds,{className:"w-4 h-4"}),"New Item"]}),n.jsx("span",{className:"text-xs opacity-70",children:"N"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>x(!0),children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(Nh,{className:"w-4 h-4"}),"Upload Items"]}),n.jsx("span",{className:"text-xs opacity-70",children:"U"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>$e(!0),children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(yo,{className:"w-4 h-4"}),"Barcode Lookup"]}),n.jsx("span",{className:"text-xs opacity-70",children:"/"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>s("po"),children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(dC,{className:"w-4 h-4"}),"Purchase Orders"]}),n.jsx(Ki,{className:"w-4 h-4 opacity-70"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>s("grn"),children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(jg,{className:"w-4 h-4"}),"GRN"]}),n.jsx(Ki,{className:"w-4 h-4 opacity-70"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>Ve(!0),children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(en,{className:"w-4 h-4"}),"New Return"]}),n.jsx(Ki,{className:"w-4 h-4 opacity-70"})]}),n.jsxs("div",{className:"mt-3 rounded-2xl border border-slate-500/70 bg-white/60 p-3",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Active location"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:(ke==null?void 0:ke.name)||"All locations"}),n.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Refreshed: ",n.jsx("span",{className:"text-slate-900 font-medium",children:_e?_e.toLocaleTimeString():""})]})]})]})]})})]}),n.jsxs("button",{type:"button",className:"lg:hidden fixed bottom-6 right-5 z-40 rounded-full shadow-lg border border-slate-500 bg-white/90 backdrop-blur px-4 py-3 flex items-center gap-2",onClick:()=>Re(!0),"aria-label":"Quick actions",children:[n.jsx($n,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-semibold",children:"Quick"})]}),n.jsx(fb,{open:me,onOpenChange:Re,children:n.jsxs(sf,{className:"w-full sm:max-w-md",children:[n.jsxs(gb,{className:"mb-4",children:[n.jsx(bb,{className:"text-base font-semibold",children:"Quick Actions"}),n.jsx(yb,{className:"text-xs",children:"Fast shortcuts for inventory work."})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs(ge,{className:"w-full justify-between rounded-2xl",onClick:()=>{Re(!1),Rr()},children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(ds,{className:"w-4 h-4"})," New Item"]}),n.jsx("span",{className:"text-xs opacity-70",children:"N"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>{Re(!1),x(!0)},children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(Nh,{className:"w-4 h-4"})," Upload Items"]}),n.jsx("span",{className:"text-xs opacity-70",children:"U"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>{Re(!1),$e(!0)},children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(yo,{className:"w-4 h-4"})," Barcode Lookup"]}),n.jsx("span",{className:"text-xs opacity-70",children:"/"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>{Re(!1),s("po")},children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(dC,{className:"w-4 h-4"})," Purchase Orders"]}),n.jsx(Ki,{className:"w-4 h-4 opacity-70"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>{Re(!1),s("grn")},children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(jg,{className:"w-4 h-4"})," GRN"]}),n.jsx(Ki,{className:"w-4 h-4 opacity-70"})]}),n.jsxs(ge,{variant:"outline",className:"w-full justify-between rounded-2xl bg-white/70",onClick:()=>{Re(!1),Ve(!0)},children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx(en,{className:"w-4 h-4"})," New Return"]}),n.jsx(Ki,{className:"w-4 h-4 opacity-70"})]}),n.jsxs("div",{className:"mt-4 rounded-2xl border border-slate-500/70 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Bulk import options"}),n.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-slate-900",children:"Strict mode"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Block commit if any row has error."})]}),n.jsx(Wc,{checked:Ce,onCheckedChange:ze})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-slate-900",children:"Overwrite blanks"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Blank values overwrite existing."})]}),n.jsx(Wc,{checked:Te,onCheckedChange:Nt})]})]})]})]})}),n.jsx(Wa,{open:Ae,onOpenChange:Ke,children:n.jsxs(va,{className:"max-w-2xl rounded-3xl",children:[n.jsxs(ii,{children:[n.jsx(li,{className:"text-base font-semibold",children:Le?"Edit item":"New item"}),n.jsx(ch,{className:"text-xs",children:"Maintain medicine / consumable master details, LASA flag, thresholds and barcode."})]}),n.jsxs("form",{onSubmit:Zl,className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"code",children:"Code"}),n.jsx(Ee,{id:"code",name:"code",defaultValue:(Le==null?void 0:Le.code)||"",required:!0})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"qr_number",children:"Barcode number (scan code)"}),n.jsx(Ee,{id:"qr_number",name:"qr_number",placeholder:"Leave blank to auto-generate",defaultValue:(Le==null?void 0:Le.qr_number)||""}),n.jsx("p",{className:"text-[11px] text-slate-400 mt-0.5",children:"Optional. Empty =system will create MD_XXXX."})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"name",children:"Name (brand)"}),n.jsx(Ee,{id:"name",name:"name",defaultValue:(Le==null?void 0:Le.name)||"",required:!0})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"generic_name",children:"Generic name"}),n.jsx(Ee,{id:"generic_name",name:"generic_name",defaultValue:(Le==null?void 0:Le.generic_name)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"form",children:"Form"}),n.jsx(Ee,{id:"form",name:"form",placeholder:"tablet / capsule / syrup...",defaultValue:(Le==null?void 0:Le.form)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"strength",children:"Strength"}),n.jsx(Ee,{id:"strength",name:"strength",placeholder:"500 mg / 5 mg/ml",defaultValue:(Le==null?void 0:Le.strength)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"unit",children:"Unit"}),n.jsx(Ee,{id:"unit",name:"unit",placeholder:"tablet / ml / vial",defaultValue:(Le==null?void 0:Le.unit)||"tablet"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"pack_size",children:"Pack size"}),n.jsx(Ee,{id:"pack_size",name:"pack_size",defaultValue:(Le==null?void 0:Le.pack_size)||"10"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"manufacturer",children:"Manufacturer"}),n.jsx(Ee,{id:"manufacturer",name:"manufacturer",defaultValue:(Le==null?void 0:Le.manufacturer)||""})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"default_price",children:"Default price"}),n.jsx(Ee,{id:"default_price",name:"default_price",type:"number",step:"0.01",defaultValue:(Le==null?void 0:Le.default_price)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"default_mrp",children:"Default MRP"}),n.jsx(Ee,{id:"default_mrp",name:"default_mrp",type:"number",step:"0.01",defaultValue:(Le==null?void 0:Le.default_mrp)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"default_tax_percent",children:"Tax %"}),n.jsx(Ee,{id:"default_tax_percent",name:"default_tax_percent",type:"number",step:"0.01",defaultValue:(Le==null?void 0:Le.default_tax_percent)||""})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"reorder_level",children:"Reorder level"}),n.jsx(Ee,{id:"reorder_level",name:"reorder_level",type:"number",step:"0.01",defaultValue:(Le==null?void 0:Le.reorder_level)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"max_level",children:"Max level"}),n.jsx(Ee,{id:"max_level",name:"max_level",type:"number",step:"0.01",defaultValue:(Le==null?void 0:Le.max_level)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"class_name",children:"Therapeutic class"}),n.jsx(Ee,{id:"class_name",name:"class_name",defaultValue:(Le==null?void 0:Le.class_name)||""})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"atc_code",children:"ATC code"}),n.jsx(Ee,{id:"atc_code",name:"atc_code",defaultValue:(Le==null?void 0:Le.atc_code)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"hsn_code",children:"HSN code"}),n.jsx(Ee,{id:"hsn_code",name:"hsn_code",defaultValue:(Le==null?void 0:Le.hsn_code)||""})]}),n.jsxs("div",{className:"flex items-center gap-4 mt-6 text-xs",children:[n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",name:"is_consumable",defaultChecked:Le==null?void 0:Le.is_consumable,className:"rounded border-slate-300"}),"Consumable"]}),n.jsxs("label",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",name:"lasa_flag",defaultChecked:Le==null?void 0:Le.lasa_flag,className:"rounded border-slate-300"}),"LASA"]})]})]}),n.jsxs(Kc,{className:"flex justify-between",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl",onClick:()=>Ke(!1),children:"Cancel"}),n.jsx(ge,{type:"submit",className:"rounded-2xl",children:Le?"Save changes":"Create item"})]})]})]})}),n.jsx(Wa,{open:pt,onOpenChange:Pe,children:n.jsxs(va,{className:"max-w-md rounded-3xl",children:[n.jsxs(ii,{children:[n.jsx(li,{className:"text-base font-semibold",children:bt?"Edit location":"New location"}),n.jsx(ch,{className:"text-xs",children:"Define pharmacy/store location used for stock and GRN posting."})]}),n.jsxs("form",{onSubmit:Nr,className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"loc_code",children:"Code"}),n.jsx(Ee,{id:"loc_code",name:"code",defaultValue:(bt==null?void 0:bt.code)||"",placeholder:"PHARM1 / MAIN"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"loc_name",children:"Name"}),n.jsx(Ee,{id:"loc_name",name:"name",required:!0,defaultValue:(bt==null?void 0:bt.name)||"",placeholder:"Main Pharmacy"})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"loc_desc",children:"Description"}),n.jsx(Ee,{id:"loc_desc",name:"description",defaultValue:(bt==null?void 0:bt.description)||"",placeholder:"Optional description"})]}),n.jsxs(Kc,{className:"flex justify-between",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl",onClick:()=>Pe(!1),children:"Cancel"}),n.jsx(ge,{type:"submit",className:"rounded-2xl",children:bt?"Save changes":"Create location"})]})]})]})}),n.jsx(Wa,{open:De,onOpenChange:tt,children:n.jsxs(va,{className:"max-w-xl rounded-3xl",children:[n.jsxs(ii,{children:[n.jsx(li,{className:"text-base font-semibold",children:ve?"Edit supplier":"New supplier"}),n.jsx(ch,{className:"text-xs",children:"Vendor details used for POs, GRNs, and returns."})]}),n.jsxs("form",{onSubmit:Ta,className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"sup_code",children:"Code"}),n.jsx(Ee,{id:"sup_code",name:"code",defaultValue:(ve==null?void 0:ve.code)||"",placeholder:"SUPP001"})]}),n.jsxs("div",{className:"space-y-1.5 sm:col-span-2",children:[n.jsx(xt,{htmlFor:"sup_name",children:"Name"}),n.jsx(Ee,{id:"sup_name",name:"name",required:!0,defaultValue:(ve==null?void 0:ve.name)||"",placeholder:"ABC Pharma Distributors"})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"sup_contact_person",children:"Contact person"}),n.jsx(Ee,{id:"sup_contact_person",name:"contact_person",defaultValue:(ve==null?void 0:ve.contact_person)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"sup_phone",children:"Phone"}),n.jsx(Ee,{id:"sup_phone",name:"phone",defaultValue:(ve==null?void 0:ve.phone)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"sup_email",children:"Email"}),n.jsx(Ee,{id:"sup_email",type:"email",name:"email",defaultValue:(ve==null?void 0:ve.email)||""})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"sup_gst",children:"GST number"}),n.jsx(Ee,{id:"sup_gst",name:"gst_number",defaultValue:(ve==null?void 0:ve.gst_number)||""})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{htmlFor:"sup_address",children:"Address"}),n.jsx(Ee,{id:"sup_address",name:"address",defaultValue:(ve==null?void 0:ve.address)||"",placeholder:"City / area / address"})]})]}),n.jsxs(Kc,{className:"flex justify-between",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl",onClick:()=>tt(!1),children:"Cancel"}),n.jsx(ge,{type:"submit",className:"rounded-2xl",children:ve?"Save changes":"Create supplier"})]})]})]})}),n.jsx(Wa,{open:Ze,onOpenChange:$e,children:n.jsxs(va,{className:"max-w-lg rounded-3xl",children:[n.jsxs(ii,{children:[n.jsx(li,{className:"text-base font-semibold",children:"Barcode / Code lookup"}),n.jsx(ch,{className:"text-xs",children:"Paste scanned barcode (qr_number) or item code to open item instantly."})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Barcode / Code"}),n.jsx(Ee,{value:fe,onChange:Ne=>Me(Ne.target.value),placeholder:"Scan or type...",className:"rounded-2xl",onKeyDown:Ne=>Ne.key==="Enter"&&ln()})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500/70 bg-slate-50 p-3 text-xs text-slate-600 flex items-start gap-2",children:[n.jsx(gr,{className:"h-4 w-4 mt-0.5 text-slate-500"}),"Tip: Use scanner  it fills this input  press Enter to open the item."]})]}),n.jsxs(Kc,{className:"flex justify-between",children:[n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>{$e(!1),Me("")},children:"Cancel"}),n.jsxs(ge,{className:"rounded-2xl gap-2",onClick:ln,children:[n.jsx(yo,{className:"h-4 w-4"}),"Find"]})]})]})}),n.jsx(fb,{open:We,onOpenChange:Ve,children:n.jsxs(sf,{className:"w-full sm:max-w-xl overflow-y-auto",children:[n.jsxs(gb,{className:"mb-4",children:[n.jsx(bb,{className:"text-base font-semibold",children:"New Return (DRAFT)"}),n.jsx(yb,{className:"text-xs",children:"Choose return type (to supplier / from customer / internal), and specify items & quantities."})]}),n.jsxs("form",{onSubmit:Bo,className:"space-y-4 pb-6",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Return type"}),n.jsxs(Zs,{value:Fe.type,onValueChange:Ne=>ot(ut=>({...ut,type:Ne})),children:[n.jsx(Ws,{className:"bg-white rounded-2xl",children:n.jsx(Js,{})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"TO_SUPPLIER",children:"To Supplier"}),n.jsx(Ut,{value:"FROM_CUSTOMER",children:"From Customer"}),n.jsx(Ut,{value:"INTERNAL",children:"Internal"})]})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{children:"Location"}),n.jsxs(Zs,{value:Fe.location_id,onValueChange:Ne=>ot(ut=>({...ut,location_id:Ne})),children:[n.jsx(Ws,{className:"bg-white rounded-2xl",children:n.jsx(Js,{placeholder:"Select location"})}),n.jsx(qs,{children:r.map(Ne=>n.jsx(Ut,{value:String(Ne.id),children:Ne.name},Ne.id))})]})]}),Fe.type==="TO_SUPPLIER"&&n.jsxs("div",{className:"space-y-1.5 sm:col-span-2",children:[n.jsx(xt,{children:"Supplier (for return)"}),n.jsxs(Zs,{value:Fe.supplier_id,onValueChange:Ne=>ot(ut=>({...ut,supplier_id:Ne})),children:[n.jsx(Ws,{className:"bg-white rounded-2xl",children:n.jsx(Js,{placeholder:"Select supplier"})}),n.jsx(qs,{children:i.map(Ne=>n.jsx(Ut,{value:String(Ne.id),children:Ne.name},Ne.id))})]})]}),n.jsxs("div",{className:"space-y-1.5 sm:col-span-2",children:[n.jsx(xt,{children:"Reason"}),n.jsx(Ee,{value:Fe.reason,onChange:Ne=>ot(ut=>({...ut,reason:Ne.target.value})),className:"rounded-2xl"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx(xt,{children:"Line items"}),n.jsxs(ge,{type:"button",size:"sm",variant:"outline",className:"gap-1 rounded-2xl bg-white/70",onClick:Os,children:[n.jsx(ds,{className:"w-3 h-3"}),"Add line"]})]}),ft.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"No lines yet. Click Add line or use Create return from Expired / Quarantine batches."}):n.jsx("div",{className:"space-y-2 max-h-[280px] overflow-auto pr-1",children:ft.map((Ne,ut)=>n.jsxs("div",{className:"grid gap-2 rounded-2xl border border-slate-500 p-2 bg-white/70 sm:grid-cols-[1.6fr,1fr,0.8fr,0.8fr,0.4fr]",children:[n.jsxs(Zs,{value:Ne.item_id?String(Ne.item_id):"",onValueChange:Ft=>bl(ut,"item_id",Ft),children:[n.jsx(Ws,{className:"bg-white h-10 rounded-2xl",children:n.jsx(Js,{placeholder:"Item"})}),n.jsx(qs,{children:o.map(Ft=>n.jsx(Ut,{value:String(Ft.id),children:Ft.name},Ft.id))})]}),n.jsx(Ee,{className:"h-10 rounded-2xl",placeholder:"Batch no.",value:Ne.batch_no||"",onChange:Ft=>bl(ut,"batch_no",Ft.target.value)}),n.jsx(Ee,{type:"number",min:"0",step:"0.01",className:"h-10 rounded-2xl",placeholder:"Qty",value:Ne.quantity,onChange:Ft=>bl(ut,"quantity",Ft.target.value)}),n.jsx(Ee,{className:"h-10 rounded-2xl",placeholder:"Reason",value:Ne.reason,onChange:Ft=>bl(ut,"reason",Ft.target.value)}),n.jsx(ge,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 rounded-2xl",onClick:()=>Za(ut),children:""})]},ut))})]}),n.jsxs("div",{className:"flex justify-between pt-2",children:[n.jsx(ge,{type:"button",variant:"outline",className:"rounded-2xl",onClick:()=>Ve(!1),children:"Cancel"}),n.jsx(ge,{type:"submit",className:"rounded-2xl",children:"Create Return (DRAFT)"})]})]})]})})]})})}var Ht;(function(t){t[t.QR_CODE=0]="QR_CODE",t[t.AZTEC=1]="AZTEC",t[t.CODABAR=2]="CODABAR",t[t.CODE_39=3]="CODE_39",t[t.CODE_93=4]="CODE_93",t[t.CODE_128=5]="CODE_128",t[t.DATA_MATRIX=6]="DATA_MATRIX",t[t.MAXICODE=7]="MAXICODE",t[t.ITF=8]="ITF",t[t.EAN_13=9]="EAN_13",t[t.EAN_8=10]="EAN_8",t[t.PDF_417=11]="PDF_417",t[t.RSS_14=12]="RSS_14",t[t.RSS_EXPANDED=13]="RSS_EXPANDED",t[t.UPC_A=14]="UPC_A",t[t.UPC_E=15]="UPC_E",t[t.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Ht||(Ht={}));var zB=new Map([[Ht.QR_CODE,"QR_CODE"],[Ht.AZTEC,"AZTEC"],[Ht.CODABAR,"CODABAR"],[Ht.CODE_39,"CODE_39"],[Ht.CODE_93,"CODE_93"],[Ht.CODE_128,"CODE_128"],[Ht.DATA_MATRIX,"DATA_MATRIX"],[Ht.MAXICODE,"MAXICODE"],[Ht.ITF,"ITF"],[Ht.EAN_13,"EAN_13"],[Ht.EAN_8,"EAN_8"],[Ht.PDF_417,"PDF_417"],[Ht.RSS_14,"RSS_14"],[Ht.RSS_EXPANDED,"RSS_EXPANDED"],[Ht.UPC_A,"UPC_A"],[Ht.UPC_E,"UPC_E"],[Ht.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),UB;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.URL=1]="URL"})(UB||(UB={}));function xXe(t){return Object.values(Ht).includes(t)}var jm;(function(t){t[t.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",t[t.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(jm||(jm={}));var Zo=function(){function t(){}return t.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",t.SCAN_DEFAULT_FPS=2,t.DEFAULT_DISABLE_FLIP=!1,t.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,t.DEFAULT_SUPPORTED_SCAN_TYPE=[jm.SCAN_TYPE_CAMERA,jm.SCAN_TYPE_FILE],t}(),cne=function(){function t(s,r){this.format=s,this.formatName=r}return t.prototype.toString=function(){return this.formatName},t.create=function(s){if(!zB.has(s))throw"".concat(s," not in html5QrcodeSupportedFormatsTextMap");return new t(s,zB.get(s))},t}(),VB=function(){function t(){}return t.createFromText=function(s){var r={text:s};return{decodedText:s,result:r}},t.createFromQrcodeResult=function(s){return{decodedText:s.text,result:s}},t}(),qA;(function(t){t[t.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",t[t.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",t[t.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(qA||(qA={}));var dne=function(){function t(){}return t.createFrom=function(s){return{errorMessage:s,type:qA.UNKWOWN_ERROR}},t}(),une=function(){function t(s){this.verbose=s}return t.prototype.log=function(s){this.verbose&&console.log(s)},t.prototype.warn=function(s){this.verbose&&console.warn(s)},t.prototype.logError=function(s,r){(this.verbose||r===!0)&&console.error(s)},t.prototype.logErrors=function(s){if(s.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(s)},t}();function $c(t){return typeof t>"u"||t===null}function pXe(t,s,r){return t>r?r:t<s?s:t}var Cp=function(){function t(){}return t.codeParseError=function(s){return"QR code parse error, error = ".concat(s)},t.errorGettingUserMedia=function(s){return"Error getting userMedia, error = ".concat(s)},t.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},t.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},t.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},t.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},t.scannerPaused=function(){return"Scanner paused"},t}(),xn=function(){function t(){}return t.scanningStatus=function(){return"Scanning"},t.idleStatus=function(){return"Idle"},t.errorStatus=function(){return"Error"},t.permissionStatus=function(){return"Permission"},t.noCameraFoundErrorStatus=function(){return"No Cameras"},t.lastMatch=function(s){return"Last Match: ".concat(s)},t.codeScannerTitle=function(){return"Code Scanner"},t.cameraPermissionTitle=function(){return"Request Camera Permissions"},t.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},t.noCameraFound=function(){return"No camera found"},t.scanButtonStopScanningText=function(){return"Stop Scanning"},t.scanButtonStartScanningText=function(){return"Start Scanning"},t.torchOnButton=function(){return"Switch On Torch"},t.torchOffButton=function(){return"Switch Off Torch"},t.torchOnFailedMessage=function(){return"Failed to turn on torch"},t.torchOffFailedMessage=function(){return"Failed to turn off torch"},t.scanButtonScanningStarting=function(){return"Launching Camera..."},t.textIfCameraScanSelected=function(){return"Scan an Image File"},t.textIfFileScanSelected=function(){return"Scan using camera directly"},t.selectCamera=function(){return"Select Camera"},t.fileSelectionChooseImage=function(){return"Choose Image"},t.fileSelectionChooseAnother=function(){return"Choose Another"},t.fileSelectionNoImageSelected=function(){return"No image choosen"},t.anonymousCameraPrefix=function(){return"Anonymous Camera"},t.dragAndDropMessage=function(){return"Or drop an image to scan"},t.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},t.zoom=function(){return"zoom"},t.loadingImage=function(){return"Loading image..."},t.cameraScanAltText=function(){return"Camera based scan"},t.fileScanAltText=function(){return"Fule based scan"},t}(),HB=function(){function t(){}return t.poweredBy=function(){return"Powered by "},t.reportIssues=function(){return"Report issues"},t}(),mne=function(){function t(){}return t.isMediaStreamConstraintsValid=function(s,r){if(typeof s!="object"){var a=typeof s;return r.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(a,"."),!0),!1}for(var i=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],l=new Set(i),o=Object.keys(s),c=0,d=o;c<d.length;c++){var u=d[c];if(l.has(u))return r.logError("".concat(u," is not supported videoConstaints."),!0),!1}return!0},t}(),GA={exports:{}};(function(t,s){(function(r,a){a(s)})(n0,function(r){function a(de){return de==null}var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(de,h){de.__proto__=h}||function(de,h){for(var f in h)h.hasOwnProperty(f)&&(de[f]=h[f])};function l(de,h){i(de,h);function f(){this.constructor=de}de.prototype=h===null?Object.create(h):(f.prototype=h.prototype,new f)}function o(de,h){var f=Object.setPrototypeOf;f?f(de,h):de.__proto__=h}function c(de,h){h===void 0&&(h=de.constructor);var f=Error.captureStackTrace;f&&f(de,h)}var d=function(de){l(h,de);function h(f){var b=this.constructor,N=de.call(this,f)||this;return Object.defineProperty(N,"name",{value:b.name,enumerable:!1}),o(N,b.prototype),c(N),N}return h}(Error);class u extends d{constructor(h=void 0){super(h),this.message=h}getKind(){return this.constructor.kind}}u.kind="Exception";class m extends u{}m.kind="ArgumentException";class x extends u{}x.kind="IllegalArgumentException";class g{constructor(h){if(this.binarizer=h,h===null)throw new x("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(h,f){return this.binarizer.getBlackRow(h,f)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(h,f,b,N){const _=this.binarizer.getLuminanceSource().crop(h,f,b,N);return new g(this.binarizer.createBinarizer(_))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const h=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new g(this.binarizer.createBinarizer(h))}rotateCounterClockwise45(){const h=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new g(this.binarizer.createBinarizer(h))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class y extends u{static getChecksumInstance(){return new y}}y.kind="ChecksumException";class v{constructor(h){this.source=h}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class j{static arraycopy(h,f,b,N,_){for(;_--;)b[N++]=h[f++]}static currentTimeMillis(){return Date.now()}}class w extends u{}w.kind="IndexOutOfBoundsException";class S extends w{constructor(h=void 0,f=void 0){super(f),this.index=h,this.message=f}}S.kind="ArrayIndexOutOfBoundsException";class E{static fill(h,f){for(let b=0,N=h.length;b<N;b++)h[b]=f}static fillWithin(h,f,b,N){E.rangeCheck(h.length,f,b);for(let _=f;_<b;_++)h[_]=N}static rangeCheck(h,f,b){if(f>b)throw new x("fromIndex("+f+") > toIndex("+b+")");if(f<0)throw new S(f);if(b>h)throw new S(b)}static asList(...h){return h}static create(h,f,b){return Array.from({length:h}).map(_=>Array.from({length:f}).fill(b))}static createInt32Array(h,f,b){return Array.from({length:h}).map(_=>Int32Array.from({length:f}).fill(b))}static equals(h,f){if(!h||!f||!h.length||!f.length||h.length!==f.length)return!1;for(let b=0,N=h.length;b<N;b++)if(h[b]!==f[b])return!1;return!0}static hashCode(h){if(h===null)return 0;let f=1;for(const b of h)f=31*f+b;return f}static fillUint8Array(h,f){for(let b=0;b!==h.length;b++)h[b]=f}static copyOf(h,f){return h.slice(0,f)}static copyOfUint8Array(h,f){if(h.length<=f){const b=new Uint8Array(f);return b.set(h),b}return h.slice(0,f)}static copyOfRange(h,f,b){const N=b-f,_=new Int32Array(N);return j.arraycopy(h,f,_,0,N),_}static binarySearch(h,f,b){b===void 0&&(b=E.numberComparator);let N=0,_=h.length-1;for(;N<=_;){const C=_+N>>1,M=b(f,h[C]);if(M>0)N=C+1;else if(M<0)_=C-1;else return C}return-N-1}static numberComparator(h,f){return h-f}}class k{static numberOfTrailingZeros(h){let f;if(h===0)return 32;let b=31;return f=h<<16,f!==0&&(b-=16,h=f),f=h<<8,f!==0&&(b-=8,h=f),f=h<<4,f!==0&&(b-=4,h=f),f=h<<2,f!==0&&(b-=2,h=f),b-(h<<1>>>31)}static numberOfLeadingZeros(h){if(h===0)return 32;let f=1;return h>>>16||(f+=16,h<<=16),h>>>24||(f+=8,h<<=8),h>>>28||(f+=4,h<<=4),h>>>30||(f+=2,h<<=2),f-=h>>>31,f}static toHexString(h){return h.toString(16)}static toBinaryString(h){return String(parseInt(String(h),2))}static bitCount(h){return h=h-(h>>>1&1431655765),h=(h&858993459)+(h>>>2&858993459),h=h+(h>>>4)&252645135,h=h+(h>>>8),h=h+(h>>>16),h&63}static truncDivision(h,f){return Math.trunc(h/f)}static parseInt(h,f=void 0){return parseInt(h,f)}}k.MIN_VALUE_32_BITS=-2147483648,k.MAX_VALUE=Number.MAX_SAFE_INTEGER;class A{constructor(h,f){h===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=h,f==null?this.bits=A.makeArray(h):this.bits=f)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(h){if(h>this.bits.length*32){const f=A.makeArray(h);j.arraycopy(this.bits,0,f,0,this.bits.length),this.bits=f}}get(h){return(this.bits[Math.floor(h/32)]&1<<(h&31))!==0}set(h){this.bits[Math.floor(h/32)]|=1<<(h&31)}flip(h){this.bits[Math.floor(h/32)]^=1<<(h&31)}getNextSet(h){const f=this.size;if(h>=f)return f;const b=this.bits;let N=Math.floor(h/32),_=b[N];_&=~((1<<(h&31))-1);const C=b.length;for(;_===0;){if(++N===C)return f;_=b[N]}const M=N*32+k.numberOfTrailingZeros(_);return M>f?f:M}getNextUnset(h){const f=this.size;if(h>=f)return f;const b=this.bits;let N=Math.floor(h/32),_=~b[N];_&=~((1<<(h&31))-1);const C=b.length;for(;_===0;){if(++N===C)return f;_=~b[N]}const M=N*32+k.numberOfTrailingZeros(_);return M>f?f:M}setBulk(h,f){this.bits[Math.floor(h/32)]=f}setRange(h,f){if(f<h||h<0||f>this.size)throw new x;if(f===h)return;f--;const b=Math.floor(h/32),N=Math.floor(f/32),_=this.bits;for(let C=b;C<=N;C++){const M=C>b?0:h&31,z=(2<<(C<N?31:f&31))-(1<<M);_[C]|=z}}clear(){const h=this.bits.length,f=this.bits;for(let b=0;b<h;b++)f[b]=0}isRange(h,f,b){if(f<h||h<0||f>this.size)throw new x;if(f===h)return!0;f--;const N=Math.floor(h/32),_=Math.floor(f/32),C=this.bits;for(let M=N;M<=_;M++){const L=M>N?0:h&31,re=(2<<(M<_?31:f&31))-(1<<L)&4294967295;if((C[M]&re)!==(b?re:0))return!1}return!0}appendBit(h){this.ensureCapacity(this.size+1),h&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(h,f){if(f<0||f>32)throw new x("Num bits must be between 0 and 32");this.ensureCapacity(this.size+f);for(let b=f;b>0;b--)this.appendBit((h>>b-1&1)===1)}appendBitArray(h){const f=h.size;this.ensureCapacity(this.size+f);for(let b=0;b<f;b++)this.appendBit(h.get(b))}xor(h){if(this.size!==h.size)throw new x("Sizes don't match");const f=this.bits;for(let b=0,N=f.length;b<N;b++)f[b]^=h.bits[b]}toBytes(h,f,b,N){for(let _=0;_<N;_++){let C=0;for(let M=0;M<8;M++)this.get(h)&&(C|=1<<7-M),h++;f[b+_]=C}}getBitArray(){return this.bits}reverse(){const h=new Int32Array(this.bits.length),f=Math.floor((this.size-1)/32),b=f+1,N=this.bits;for(let _=0;_<b;_++){let C=N[_];C=C>>1&1431655765|(C&1431655765)<<1,C=C>>2&858993459|(C&858993459)<<2,C=C>>4&252645135|(C&252645135)<<4,C=C>>8&16711935|(C&16711935)<<8,C=C>>16&65535|(C&65535)<<16,h[f-_]=C}if(this.size!==b*32){const _=b*32-this.size;let C=h[0]>>>_;for(let M=1;M<b;M++){const L=h[M];C|=L<<32-_,h[M-1]=C,C=L>>>_}h[b-1]=C}this.bits=h}static makeArray(h){return new Int32Array(Math.floor((h+31)/32))}equals(h){if(!(h instanceof A))return!1;const f=h;return this.size===f.size&&E.equals(this.bits,f.bits)}hashCode(){return 31*this.size+E.hashCode(this.bits)}toString(){let h="";for(let f=0,b=this.size;f<b;f++)f&7||(h+=" "),h+=this.get(f)?"X":".";return h}clone(){return new A(this.size,this.bits.slice())}}var I;(function(de){de[de.OTHER=0]="OTHER",de[de.PURE_BARCODE=1]="PURE_BARCODE",de[de.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",de[de.TRY_HARDER=3]="TRY_HARDER",de[de.CHARACTER_SET=4]="CHARACTER_SET",de[de.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",de[de.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",de[de.ASSUME_GS1=7]="ASSUME_GS1",de[de.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",de[de.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",de[de.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(I||(I={}));var P=I;class O extends u{static getFormatInstance(){return new O}}O.kind="FormatException";var D;(function(de){de[de.Cp437=0]="Cp437",de[de.ISO8859_1=1]="ISO8859_1",de[de.ISO8859_2=2]="ISO8859_2",de[de.ISO8859_3=3]="ISO8859_3",de[de.ISO8859_4=4]="ISO8859_4",de[de.ISO8859_5=5]="ISO8859_5",de[de.ISO8859_6=6]="ISO8859_6",de[de.ISO8859_7=7]="ISO8859_7",de[de.ISO8859_8=8]="ISO8859_8",de[de.ISO8859_9=9]="ISO8859_9",de[de.ISO8859_10=10]="ISO8859_10",de[de.ISO8859_11=11]="ISO8859_11",de[de.ISO8859_13=12]="ISO8859_13",de[de.ISO8859_14=13]="ISO8859_14",de[de.ISO8859_15=14]="ISO8859_15",de[de.ISO8859_16=15]="ISO8859_16",de[de.SJIS=16]="SJIS",de[de.Cp1250=17]="Cp1250",de[de.Cp1251=18]="Cp1251",de[de.Cp1252=19]="Cp1252",de[de.Cp1256=20]="Cp1256",de[de.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",de[de.UTF8=22]="UTF8",de[de.ASCII=23]="ASCII",de[de.Big5=24]="Big5",de[de.GB18030=25]="GB18030",de[de.EUC_KR=26]="EUC_KR"})(D||(D={}));class T{constructor(h,f,b,...N){this.valueIdentifier=h,this.name=b,typeof f=="number"?this.values=Int32Array.from([f]):this.values=f,this.otherEncodingNames=N,T.VALUE_IDENTIFIER_TO_ECI.set(h,this),T.NAME_TO_ECI.set(b,this);const _=this.values;for(let C=0,M=_.length;C!==M;C++){const L=_[C];T.VALUES_TO_ECI.set(L,this)}for(const C of N)T.NAME_TO_ECI.set(C,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(h){if(h<0||h>=900)throw new O("incorect value");const f=T.VALUES_TO_ECI.get(h);if(f===void 0)throw new O("incorect value");return f}static getCharacterSetECIByName(h){const f=T.NAME_TO_ECI.get(h);if(f===void 0)throw new O("incorect value");return f}equals(h){if(!(h instanceof T))return!1;const f=h;return this.getName()===f.getName()}}T.VALUE_IDENTIFIER_TO_ECI=new Map,T.VALUES_TO_ECI=new Map,T.NAME_TO_ECI=new Map,T.Cp437=new T(D.Cp437,Int32Array.from([0,2]),"Cp437"),T.ISO8859_1=new T(D.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),T.ISO8859_2=new T(D.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),T.ISO8859_3=new T(D.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),T.ISO8859_4=new T(D.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),T.ISO8859_5=new T(D.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),T.ISO8859_6=new T(D.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),T.ISO8859_7=new T(D.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),T.ISO8859_8=new T(D.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),T.ISO8859_9=new T(D.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),T.ISO8859_10=new T(D.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),T.ISO8859_11=new T(D.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),T.ISO8859_13=new T(D.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),T.ISO8859_14=new T(D.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),T.ISO8859_15=new T(D.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),T.ISO8859_16=new T(D.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),T.SJIS=new T(D.SJIS,20,"SJIS","Shift_JIS"),T.Cp1250=new T(D.Cp1250,21,"Cp1250","windows-1250"),T.Cp1251=new T(D.Cp1251,22,"Cp1251","windows-1251"),T.Cp1252=new T(D.Cp1252,23,"Cp1252","windows-1252"),T.Cp1256=new T(D.Cp1256,24,"Cp1256","windows-1256"),T.UnicodeBigUnmarked=new T(D.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),T.UTF8=new T(D.UTF8,26,"UTF8","UTF-8"),T.ASCII=new T(D.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),T.Big5=new T(D.Big5,28,"Big5"),T.GB18030=new T(D.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),T.EUC_KR=new T(D.EUC_KR,30,"EUC_KR","EUC-KR");class B extends u{}B.kind="UnsupportedOperationException";class U{static decode(h,f){const b=this.encodingName(f);return this.customDecoder?this.customDecoder(h,b):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(b)?this.decodeFallback(h,b):new TextDecoder(b).decode(h)}static shouldDecodeOnFallback(h){return!U.isBrowser()&&h==="ISO-8859-1"}static encode(h,f){const b=this.encodingName(f);return this.customEncoder?this.customEncoder(h,b):typeof TextEncoder>"u"?this.encodeFallback(h):new TextEncoder().encode(h)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(h){return typeof h=="string"?h:h.getName()}static encodingCharacterSet(h){return h instanceof T?h:T.getCharacterSetECIByName(h)}static decodeFallback(h,f){const b=this.encodingCharacterSet(f);if(U.isDecodeFallbackSupported(b)){let N="";for(let _=0,C=h.length;_<C;_++){let M=h[_].toString(16);M.length<2&&(M="0"+M),N+="%"+M}return decodeURIComponent(N)}if(b.equals(T.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(h.buffer));throw new B(`Encoding ${this.encodingName(f)} not supported by fallback.`)}static isDecodeFallbackSupported(h){return h.equals(T.UTF8)||h.equals(T.ISO8859_1)||h.equals(T.ASCII)}static encodeFallback(h){const b=btoa(unescape(encodeURIComponent(h))).split(""),N=[];for(let _=0;_<b.length;_++)N.push(b[_].charCodeAt(0));return new Uint8Array(N)}}class W{static castAsNonUtf8Char(h,f=null){const b=f?f.getName():this.ISO88591;return U.decode(new Uint8Array([h]),b)}static guessEncoding(h,f){if(f!=null&&f.get(P.CHARACTER_SET)!==void 0)return f.get(P.CHARACTER_SET).toString();const b=h.length;let N=!0,_=!0,C=!0,M=0,L=0,z=0,re=0,ue=0,pe=0,Se=0,Ie=0,Be=0,Xe=0,nt=0;const Ct=h.length>3&&h[0]===239&&h[1]===187&&h[2]===191;for(let kt=0;kt<b&&(N||_||C);kt++){const wt=h[kt]&255;C&&(M>0?wt&128?M--:C=!1:wt&128&&(wt&64?(M++,wt&32?(M++,wt&16?(M++,wt&8?C=!1:re++):z++):L++):C=!1)),N&&(wt>127&&wt<160?N=!1:wt>159&&(wt<192||wt===215||wt===247)&&nt++),_&&(ue>0?wt<64||wt===127||wt>252?_=!1:ue--:wt===128||wt===160||wt>239?_=!1:wt>160&&wt<224?(pe++,Ie=0,Se++,Se>Be&&(Be=Se)):wt>127?(ue++,Se=0,Ie++,Ie>Xe&&(Xe=Ie)):(Se=0,Ie=0))}return C&&M>0&&(C=!1),_&&ue>0&&(_=!1),C&&(Ct||L+z+re>0)?W.UTF8:_&&(W.ASSUME_SHIFT_JIS||Be>=3||Xe>=3)?W.SHIFT_JIS:N&&_?Be===2&&pe===2||nt*10>=b?W.SHIFT_JIS:W.ISO88591:N?W.ISO88591:_?W.SHIFT_JIS:C?W.UTF8:W.PLATFORM_DEFAULT_ENCODING}static format(h,...f){let b=-1;function N(C,M,L,z,re,ue){if(C==="%%")return"%";if(f[++b]===void 0)return;C=z?parseInt(z.substr(1)):void 0;let pe=re?parseInt(re.substr(1)):void 0,Se;switch(ue){case"s":Se=f[b];break;case"c":Se=f[b][0];break;case"f":Se=parseFloat(f[b]).toFixed(C);break;case"p":Se=parseFloat(f[b]).toPrecision(C);break;case"e":Se=parseFloat(f[b]).toExponential(C);break;case"x":Se=parseInt(f[b]).toString(pe||16);break;case"d":Se=parseFloat(parseInt(f[b],pe||10).toPrecision(C)).toFixed(0);break}Se=typeof Se=="object"?JSON.stringify(Se):(+Se).toString(pe);let Ie=parseInt(L),Be=L&&L[0]+""=="0"?"0":" ";for(;Se.length<Ie;)Se=M!==void 0?Se+Be:Be+Se;return Se}let _=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return h.replace(_,N)}static getBytes(h,f){return U.encode(h,f)}static getCharCode(h,f=0){return h.charCodeAt(f)}static getCharAt(h){return String.fromCharCode(h)}}W.SHIFT_JIS=T.SJIS.getName(),W.GB2312="GB2312",W.ISO88591=T.ISO8859_1.getName(),W.EUC_JP="EUC_JP",W.UTF8=T.UTF8.getName(),W.PLATFORM_DEFAULT_ENCODING=W.UTF8,W.ASSUME_SHIFT_JIS=!1;class V{constructor(h=""){this.value=h}enableDecoding(h){return this.encoding=h,this}append(h){return typeof h=="string"?this.value+=h.toString():this.encoding?this.value+=W.castAsNonUtf8Char(h,this.encoding):this.value+=String.fromCharCode(h),this}appendChars(h,f,b){for(let N=f;f<f+b;N++)this.append(h[N]);return this}length(){return this.value.length}charAt(h){return this.value.charAt(h)}deleteCharAt(h){this.value=this.value.substr(0,h)+this.value.substring(h+1)}setCharAt(h,f){this.value=this.value.substr(0,h)+f+this.value.substr(h+1)}substring(h,f){return this.value.substring(h,f)}setLengthToZero(){this.value=""}toString(){return this.value}insert(h,f){this.value=this.value.substr(0,h)+f+this.value.substr(h+f.length)}}class R{constructor(h,f,b,N){if(this.width=h,this.height=f,this.rowSize=b,this.bits=N,f==null&&(f=h),this.height=f,h<1||f<1)throw new x("Both dimensions must be greater than 0");b==null&&(b=Math.floor((h+31)/32)),this.rowSize=b,N==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(h){const f=h.length,b=h[0].length,N=new R(b,f);for(let _=0;_<f;_++){const C=h[_];for(let M=0;M<b;M++)C[M]&&N.set(M,_)}return N}static parseFromString(h,f,b){if(h===null)throw new x("stringRepresentation cannot be null");const N=new Array(h.length);let _=0,C=0,M=-1,L=0,z=0;for(;z<h.length;)if(h.charAt(z)===`
`||h.charAt(z)==="\r"){if(_>C){if(M===-1)M=_-C;else if(_-C!==M)throw new x("row lengths do not match");C=_,L++}z++}else if(h.substring(z,z+f.length)===f)z+=f.length,N[_]=!0,_++;else if(h.substring(z,z+b.length)===b)z+=b.length,N[_]=!1,_++;else throw new x("illegal character encountered: "+h.substring(z));if(_>C){if(M===-1)M=_-C;else if(_-C!==M)throw new x("row lengths do not match");L++}const re=new R(M,L);for(let ue=0;ue<_;ue++)N[ue]&&re.set(Math.floor(ue%M),Math.floor(ue/M));return re}get(h,f){const b=f*this.rowSize+Math.floor(h/32);return(this.bits[b]>>>(h&31)&1)!==0}set(h,f){const b=f*this.rowSize+Math.floor(h/32);this.bits[b]|=1<<(h&31)&4294967295}unset(h,f){const b=f*this.rowSize+Math.floor(h/32);this.bits[b]&=~(1<<(h&31)&4294967295)}flip(h,f){const b=f*this.rowSize+Math.floor(h/32);this.bits[b]^=1<<(h&31)&4294967295}xor(h){if(this.width!==h.getWidth()||this.height!==h.getHeight()||this.rowSize!==h.getRowSize())throw new x("input matrix dimensions do not match");const f=new A(Math.floor(this.width/32)+1),b=this.rowSize,N=this.bits;for(let _=0,C=this.height;_<C;_++){const M=_*b,L=h.getRow(_,f).getBitArray();for(let z=0;z<b;z++)N[M+z]^=L[z]}}clear(){const h=this.bits,f=h.length;for(let b=0;b<f;b++)h[b]=0}setRegion(h,f,b,N){if(f<0||h<0)throw new x("Left and top must be nonnegative");if(N<1||b<1)throw new x("Height and width must be at least 1");const _=h+b,C=f+N;if(C>this.height||_>this.width)throw new x("The region must fit inside the matrix");const M=this.rowSize,L=this.bits;for(let z=f;z<C;z++){const re=z*M;for(let ue=h;ue<_;ue++)L[re+Math.floor(ue/32)]|=1<<(ue&31)&4294967295}}getRow(h,f){f==null||f.getSize()<this.width?f=new A(this.width):f.clear();const b=this.rowSize,N=this.bits,_=h*b;for(let C=0;C<b;C++)f.setBulk(C*32,N[_+C]);return f}setRow(h,f){j.arraycopy(f.getBitArray(),0,this.bits,h*this.rowSize,this.rowSize)}rotate180(){const h=this.getWidth(),f=this.getHeight();let b=new A(h),N=new A(h);for(let _=0,C=Math.floor((f+1)/2);_<C;_++)b=this.getRow(_,b),N=this.getRow(f-1-_,N),b.reverse(),N.reverse(),this.setRow(_,N),this.setRow(f-1-_,b)}getEnclosingRectangle(){const h=this.width,f=this.height,b=this.rowSize,N=this.bits;let _=h,C=f,M=-1,L=-1;for(let z=0;z<f;z++)for(let re=0;re<b;re++){const ue=N[z*b+re];if(ue!==0){if(z<C&&(C=z),z>L&&(L=z),re*32<_){let pe=0;for(;!(ue<<31-pe&4294967295);)pe++;re*32+pe<_&&(_=re*32+pe)}if(re*32+31>M){let pe=31;for(;!(ue>>>pe);)pe--;re*32+pe>M&&(M=re*32+pe)}}}return M<_||L<C?null:Int32Array.from([_,C,M-_+1,L-C+1])}getTopLeftOnBit(){const h=this.rowSize,f=this.bits;let b=0;for(;b<f.length&&f[b]===0;)b++;if(b===f.length)return null;const N=b/h;let _=b%h*32;const C=f[b];let M=0;for(;!(C<<31-M&4294967295);)M++;return _+=M,Int32Array.from([_,N])}getBottomRightOnBit(){const h=this.rowSize,f=this.bits;let b=f.length-1;for(;b>=0&&f[b]===0;)b--;if(b<0)return null;const N=Math.floor(b/h);let _=Math.floor(b%h)*32;const C=f[b];let M=31;for(;!(C>>>M);)M--;return _+=M,Int32Array.from([_,N])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(h){if(!(h instanceof R))return!1;const f=h;return this.width===f.width&&this.height===f.height&&this.rowSize===f.rowSize&&E.equals(this.bits,f.bits)}hashCode(){let h=this.width;return h=31*h+this.width,h=31*h+this.height,h=31*h+this.rowSize,h=31*h+E.hashCode(this.bits),h}toString(h="X ",f="  ",b=`
`){return this.buildToString(h,f,b)}buildToString(h,f,b){let N=new V;for(let _=0,C=this.height;_<C;_++){for(let M=0,L=this.width;M<L;M++)N.append(this.get(M,_)?h:f);N.append(b)}return N.toString()}clone(){return new R(this.width,this.height,this.rowSize,this.bits.slice())}}class F extends u{static getNotFoundInstance(){return new F}}F.kind="NotFoundException";class G extends v{constructor(h){super(h),this.luminances=G.EMPTY,this.buckets=new Int32Array(G.LUMINANCE_BUCKETS)}getBlackRow(h,f){const b=this.getLuminanceSource(),N=b.getWidth();f==null||f.getSize()<N?f=new A(N):f.clear(),this.initArrays(N);const _=b.getRow(h,this.luminances),C=this.buckets;for(let L=0;L<N;L++)C[(_[L]&255)>>G.LUMINANCE_SHIFT]++;const M=G.estimateBlackPoint(C);if(N<3)for(let L=0;L<N;L++)(_[L]&255)<M&&f.set(L);else{let L=_[0]&255,z=_[1]&255;for(let re=1;re<N-1;re++){const ue=_[re+1]&255;(z*4-L-ue)/2<M&&f.set(re),L=z,z=ue}}return f}getBlackMatrix(){const h=this.getLuminanceSource(),f=h.getWidth(),b=h.getHeight(),N=new R(f,b);this.initArrays(f);const _=this.buckets;for(let L=1;L<5;L++){const z=Math.floor(b*L/5),re=h.getRow(z,this.luminances),ue=Math.floor(f*4/5);for(let pe=Math.floor(f/5);pe<ue;pe++){const Se=re[pe]&255;_[Se>>G.LUMINANCE_SHIFT]++}}const C=G.estimateBlackPoint(_),M=h.getMatrix();for(let L=0;L<b;L++){const z=L*f;for(let re=0;re<f;re++)(M[z+re]&255)<C&&N.set(re,L)}return N}createBinarizer(h){return new G(h)}initArrays(h){this.luminances.length<h&&(this.luminances=new Uint8ClampedArray(h));const f=this.buckets;for(let b=0;b<G.LUMINANCE_BUCKETS;b++)f[b]=0}static estimateBlackPoint(h){const f=h.length;let b=0,N=0,_=0;for(let re=0;re<f;re++)h[re]>_&&(N=re,_=h[re]),h[re]>b&&(b=h[re]);let C=0,M=0;for(let re=0;re<f;re++){const ue=re-N,pe=h[re]*ue*ue;pe>M&&(C=re,M=pe)}if(N>C){const re=N;N=C,C=re}if(C-N<=f/16)throw new F;let L=C-1,z=-1;for(let re=C-1;re>N;re--){const ue=re-N,pe=ue*ue*(C-re)*(b-h[re]);pe>z&&(L=re,z=pe)}return L<<G.LUMINANCE_SHIFT}}G.LUMINANCE_BITS=5,G.LUMINANCE_SHIFT=8-G.LUMINANCE_BITS,G.LUMINANCE_BUCKETS=1<<G.LUMINANCE_BITS,G.EMPTY=Uint8ClampedArray.from([0]);class H extends G{constructor(h){super(h),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const h=this.getLuminanceSource(),f=h.getWidth(),b=h.getHeight();if(f>=H.MINIMUM_DIMENSION&&b>=H.MINIMUM_DIMENSION){const N=h.getMatrix();let _=f>>H.BLOCK_SIZE_POWER;f&H.BLOCK_SIZE_MASK&&_++;let C=b>>H.BLOCK_SIZE_POWER;b&H.BLOCK_SIZE_MASK&&C++;const M=H.calculateBlackPoints(N,_,C,f,b),L=new R(f,b);H.calculateThresholdForBlock(N,_,C,f,b,M,L),this.matrix=L}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(h){return new H(h)}static calculateThresholdForBlock(h,f,b,N,_,C,M){const L=_-H.BLOCK_SIZE,z=N-H.BLOCK_SIZE;for(let re=0;re<b;re++){let ue=re<<H.BLOCK_SIZE_POWER;ue>L&&(ue=L);const pe=H.cap(re,2,b-3);for(let Se=0;Se<f;Se++){let Ie=Se<<H.BLOCK_SIZE_POWER;Ie>z&&(Ie=z);const Be=H.cap(Se,2,f-3);let Xe=0;for(let Ct=-2;Ct<=2;Ct++){const kt=C[pe+Ct];Xe+=kt[Be-2]+kt[Be-1]+kt[Be]+kt[Be+1]+kt[Be+2]}const nt=Xe/25;H.thresholdBlock(h,Ie,ue,nt,N,M)}}}static cap(h,f,b){return h<f?f:h>b?b:h}static thresholdBlock(h,f,b,N,_,C){for(let M=0,L=b*_+f;M<H.BLOCK_SIZE;M++,L+=_)for(let z=0;z<H.BLOCK_SIZE;z++)(h[L+z]&255)<=N&&C.set(f+z,b+M)}static calculateBlackPoints(h,f,b,N,_){const C=_-H.BLOCK_SIZE,M=N-H.BLOCK_SIZE,L=new Array(b);for(let z=0;z<b;z++){L[z]=new Int32Array(f);let re=z<<H.BLOCK_SIZE_POWER;re>C&&(re=C);for(let ue=0;ue<f;ue++){let pe=ue<<H.BLOCK_SIZE_POWER;pe>M&&(pe=M);let Se=0,Ie=255,Be=0;for(let nt=0,Ct=re*N+pe;nt<H.BLOCK_SIZE;nt++,Ct+=N){for(let kt=0;kt<H.BLOCK_SIZE;kt++){const wt=h[Ct+kt]&255;Se+=wt,wt<Ie&&(Ie=wt),wt>Be&&(Be=wt)}if(Be-Ie>H.MIN_DYNAMIC_RANGE)for(nt++,Ct+=N;nt<H.BLOCK_SIZE;nt++,Ct+=N)for(let kt=0;kt<H.BLOCK_SIZE;kt++)Se+=h[Ct+kt]&255}let Xe=Se>>H.BLOCK_SIZE_POWER*2;if(Be-Ie<=H.MIN_DYNAMIC_RANGE&&(Xe=Ie/2,z>0&&ue>0)){const nt=(L[z-1][ue]+2*L[z][ue-1]+L[z-1][ue-1])/4;Ie<nt&&(Xe=nt)}L[z][ue]=Xe}}return L}}H.BLOCK_SIZE_POWER=3,H.BLOCK_SIZE=1<<H.BLOCK_SIZE_POWER,H.BLOCK_SIZE_MASK=H.BLOCK_SIZE-1,H.MINIMUM_DIMENSION=H.BLOCK_SIZE*5,H.MIN_DYNAMIC_RANGE=24;class ${constructor(h,f){this.width=h,this.height=f}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(h,f,b,N){throw new B("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new B("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new B("This luminance source does not support rotation by 45 degrees.")}toString(){const h=new Uint8ClampedArray(this.width);let f=new V;for(let b=0;b<this.height;b++){const N=this.getRow(b,h);for(let _=0;_<this.width;_++){const C=N[_]&255;let M;C<64?M="#":C<128?M="+":C<192?M=".":M=" ",f.append(M)}f.append(`
`)}return f.toString()}}class K extends ${constructor(h){super(h.getWidth(),h.getHeight()),this.delegate=h}getRow(h,f){const b=this.delegate.getRow(h,f),N=this.getWidth();for(let _=0;_<N;_++)b[_]=255-(b[_]&255);return b}getMatrix(){const h=this.delegate.getMatrix(),f=this.getWidth()*this.getHeight(),b=new Uint8ClampedArray(f);for(let N=0;N<f;N++)b[N]=255-(h[N]&255);return b}isCropSupported(){return this.delegate.isCropSupported()}crop(h,f,b,N){return new K(this.delegate.crop(h,f,b,N))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new K(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new K(this.delegate.rotateCounterClockwise45())}}class le extends ${constructor(h){super(h.width,h.height),this.canvas=h,this.tempCanvasElement=null,this.buffer=le.makeBufferFromCanvasImageData(h)}static makeBufferFromCanvasImageData(h){const f=h.getContext("2d").getImageData(0,0,h.width,h.height);return le.toGrayscaleBuffer(f.data,h.width,h.height)}static toGrayscaleBuffer(h,f,b){const N=new Uint8ClampedArray(f*b);for(let _=0,C=0,M=h.length;_<M;_+=4,C++){let L;if(h[_+3]===0)L=255;else{const re=h[_],ue=h[_+1],pe=h[_+2];L=306*re+601*ue+117*pe+512>>10}N[C]=L}return N}getRow(h,f){if(h<0||h>=this.getHeight())throw new x("Requested row is outside the image: "+h);const b=this.getWidth(),N=h*b;return f===null?f=this.buffer.slice(N,N+b):(f.length<b&&(f=new Uint8ClampedArray(b)),f.set(this.buffer.slice(N,N+b))),f}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(h,f,b,N){return super.crop(h,f,b,N),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const h=this.canvas.ownerDocument.createElement("canvas");h.width=this.canvas.width,h.height=this.canvas.height,this.tempCanvasElement=h}return this.tempCanvasElement}rotate(h){const f=this.getTempCanvasElement(),b=f.getContext("2d"),N=h*le.DEGREE_TO_RADIANS,_=this.canvas.width,C=this.canvas.height,M=Math.ceil(Math.abs(Math.cos(N))*_+Math.abs(Math.sin(N))*C),L=Math.ceil(Math.abs(Math.sin(N))*_+Math.abs(Math.cos(N))*C);return f.width=M,f.height=L,b.translate(M/2,L/2),b.rotate(N),b.drawImage(this.canvas,_/-2,C/-2),this.buffer=le.makeBufferFromCanvasImageData(f),this}invert(){return new K(this)}}le.DEGREE_TO_RADIANS=Math.PI/180;class se{constructor(h,f,b){this.deviceId=h,this.label=f,this.kind="videoinput",this.groupId=b||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var J=(globalThis||n0||self||window||void 0)&&(globalThis||n0||self||window||void 0).__awaiter||function(de,h,f,b){function N(_){return _ instanceof f?_:new f(function(C){C(_)})}return new(f||(f=Promise))(function(_,C){function M(re){try{z(b.next(re))}catch(ue){C(ue)}}function L(re){try{z(b.throw(re))}catch(ue){C(ue)}}function z(re){re.done?_(re.value):N(re.value).then(M,L)}z((b=b.apply(de,h||[])).next())})};class ie{constructor(h,f=500,b){this.reader=h,this.timeBetweenScansMillis=f,this._hints=b,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(h){this._timeBetweenDecodingAttempts=h<0?0:h}set hints(h){this._hints=h||null}get hints(){return this._hints}listVideoInputDevices(){return J(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const h=yield navigator.mediaDevices.enumerateDevices(),f=[];for(const b of h){const N=b.kind==="video"?"videoinput":b.kind;if(N!=="videoinput")continue;const _=b.deviceId||b.id,C=b.label||`Video device ${f.length+1}`,M=b.groupId,L={deviceId:_,label:C,kind:N,groupId:M};f.push(L)}return f})}getVideoInputDevices(){return J(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(f=>new se(f.deviceId,f.label))})}findDeviceById(h){return J(this,void 0,void 0,function*(){const f=yield this.listVideoInputDevices();return f?f.find(b=>b.deviceId===h):null})}decodeFromInputVideoDevice(h,f){return J(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(h,f)})}decodeOnceFromVideoDevice(h,f){return J(this,void 0,void 0,function*(){this.reset();let b;h?b={deviceId:{exact:h}}:b={facingMode:"environment"};const N={video:b};return yield this.decodeOnceFromConstraints(N,f)})}decodeOnceFromConstraints(h,f){return J(this,void 0,void 0,function*(){const b=yield navigator.mediaDevices.getUserMedia(h);return yield this.decodeOnceFromStream(b,f)})}decodeOnceFromStream(h,f){return J(this,void 0,void 0,function*(){this.reset();const b=yield this.attachStreamToVideo(h,f);return yield this.decodeOnce(b)})}decodeFromInputVideoDeviceContinuously(h,f,b){return J(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(h,f,b)})}decodeFromVideoDevice(h,f,b){return J(this,void 0,void 0,function*(){let N;h?N={deviceId:{exact:h}}:N={facingMode:"environment"};const _={video:N};return yield this.decodeFromConstraints(_,f,b)})}decodeFromConstraints(h,f,b){return J(this,void 0,void 0,function*(){const N=yield navigator.mediaDevices.getUserMedia(h);return yield this.decodeFromStream(N,f,b)})}decodeFromStream(h,f,b){return J(this,void 0,void 0,function*(){this.reset();const N=yield this.attachStreamToVideo(h,f);return yield this.decodeContinuously(N,b)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(h,f){return J(this,void 0,void 0,function*(){const b=this.prepareVideoElement(f);return this.addVideoSource(b,h),this.videoElement=b,this.stream=h,yield this.playVideoOnLoadAsync(b),b})}playVideoOnLoadAsync(h){return new Promise((f,b)=>this.playVideoOnLoad(h,()=>f()))}playVideoOnLoad(h,f){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(h),h.addEventListener("ended",this.videoEndedListener),h.addEventListener("canplay",this.videoCanPlayListener),h.addEventListener("playing",f),this.tryPlayVideo(h)}isVideoPlaying(h){return h.currentTime>0&&!h.paused&&!h.ended&&h.readyState>2}tryPlayVideo(h){return J(this,void 0,void 0,function*(){if(this.isVideoPlaying(h)){console.warn("Trying to play video that is already playing.");return}try{yield h.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(h,f){const b=document.getElementById(h);if(!b)throw new m(`element with id '${h}' not found`);if(b.nodeName.toLowerCase()!==f.toLowerCase())throw new m(`element with id '${h}' must be an ${f} element`);return b}decodeFromImage(h,f){if(!h&&!f)throw new m("either imageElement with a src set or an url must be provided");return f&&!h?this.decodeFromImageUrl(f):this.decodeFromImageElement(h)}decodeFromVideo(h,f){if(!h&&!f)throw new m("Either an element with a src set or an URL must be provided");return f&&!h?this.decodeFromVideoUrl(f):this.decodeFromVideoElement(h)}decodeFromVideoContinuously(h,f,b){if(h===void 0&&f===void 0)throw new m("Either an element with a src set or an URL must be provided");return f&&!h?this.decodeFromVideoUrlContinuously(f,b):this.decodeFromVideoElementContinuously(h,b)}decodeFromImageElement(h){if(!h)throw new m("An image element must be provided.");this.reset();const f=this.prepareImageElement(h);this.imageElement=f;let b;return this.isImageLoaded(f)?b=this.decodeOnce(f,!1,!0):b=this._decodeOnLoadImage(f),b}decodeFromVideoElement(h){const f=this._decodeFromVideoElementSetup(h);return this._decodeOnLoadVideo(f)}decodeFromVideoElementContinuously(h,f){const b=this._decodeFromVideoElementSetup(h);return this._decodeOnLoadVideoContinuously(b,f)}_decodeFromVideoElementSetup(h){if(!h)throw new m("A video element must be provided.");this.reset();const f=this.prepareVideoElement(h);return this.videoElement=f,f}decodeFromImageUrl(h){if(!h)throw new m("An URL must be provided.");this.reset();const f=this.prepareImageElement();this.imageElement=f;const b=this._decodeOnLoadImage(f);return f.src=h,b}decodeFromVideoUrl(h){if(!h)throw new m("An URL must be provided.");this.reset();const f=this.prepareVideoElement(),b=this.decodeFromVideoElement(f);return f.src=h,b}decodeFromVideoUrlContinuously(h,f){if(!h)throw new m("An URL must be provided.");this.reset();const b=this.prepareVideoElement(),N=this.decodeFromVideoElementContinuously(b,f);return b.src=h,N}_decodeOnLoadImage(h){return new Promise((f,b)=>{this.imageLoadedListener=()=>this.decodeOnce(h,!1,!0).then(f,b),h.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(h){return J(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(h),yield this.decodeOnce(h)})}_decodeOnLoadVideoContinuously(h,f){return J(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(h),this.decodeContinuously(h,f)})}isImageLoaded(h){return!(!h.complete||h.naturalWidth===0)}prepareImageElement(h){let f;return typeof h>"u"&&(f=document.createElement("img"),f.width=200,f.height=200),typeof h=="string"&&(f=this.getMediaElement(h,"img")),h instanceof HTMLImageElement&&(f=h),f}prepareVideoElement(h){let f;return!h&&typeof document<"u"&&(f=document.createElement("video"),f.width=200,f.height=200),typeof h=="string"&&(f=this.getMediaElement(h,"video")),h instanceof HTMLVideoElement&&(f=h),f.setAttribute("autoplay","true"),f.setAttribute("muted","true"),f.setAttribute("playsinline","true"),f}decodeOnce(h,f=!0,b=!0){this._stopAsyncDecode=!1;const N=(_,C)=>{if(this._stopAsyncDecode){C(new F("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const M=this.decode(h);_(M)}catch(M){const L=f&&M instanceof F,re=(M instanceof y||M instanceof O)&&b;if(L||re)return setTimeout(N,this._timeBetweenDecodingAttempts,_,C);C(M)}};return new Promise((_,C)=>N(_,C))}decodeContinuously(h,f){this._stopContinuousDecode=!1;const b=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const N=this.decode(h);f(N,null),setTimeout(b,this.timeBetweenScansMillis)}catch(N){f(null,N);const _=N instanceof y||N instanceof O,C=N instanceof F;(_||C)&&setTimeout(b,this._timeBetweenDecodingAttempts)}};b()}decode(h){const f=this.createBinaryBitmap(h);return this.decodeBitmap(f)}_isHTMLVideoElement(h){return h.videoWidth!==0}drawFrameOnCanvas(h,f,b){f||(f={sx:0,sy:0,sWidth:h.videoWidth,sHeight:h.videoHeight,dx:0,dy:0,dWidth:h.videoWidth,dHeight:h.videoHeight}),b||(b=this.captureCanvasContext),b.drawImage(h,f.sx,f.sy,f.sWidth,f.sHeight,f.dx,f.dy,f.dWidth,f.dHeight)}drawImageOnCanvas(h,f,b=this.captureCanvasContext){f||(f={sx:0,sy:0,sWidth:h.naturalWidth,sHeight:h.naturalHeight,dx:0,dy:0,dWidth:h.naturalWidth,dHeight:h.naturalHeight}),b||(b=this.captureCanvasContext),b.drawImage(h,f.sx,f.sy,f.sWidth,f.sHeight,f.dx,f.dy,f.dWidth,f.dHeight)}createBinaryBitmap(h){this.getCaptureCanvasContext(h),this._isHTMLVideoElement(h)?this.drawFrameOnCanvas(h):this.drawImageOnCanvas(h);const f=this.getCaptureCanvas(h),b=new le(f),N=new H(b);return new g(N)}getCaptureCanvasContext(h){if(!this.captureCanvasContext){const b=this.getCaptureCanvas(h).getContext("2d");this.captureCanvasContext=b}return this.captureCanvasContext}getCaptureCanvas(h){if(!this.captureCanvas){const f=this.createCaptureCanvas(h);this.captureCanvas=f}return this.captureCanvas}decodeBitmap(h){return this.reader.decode(h,this._hints)}createCaptureCanvas(h){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const f=document.createElement("canvas");let b,N;return typeof h<"u"&&(h instanceof HTMLVideoElement?(b=h.videoWidth,N=h.videoHeight):h instanceof HTMLImageElement&&(b=h.naturalWidth||h.width,N=h.naturalHeight||h.height)),f.style.width=b+"px",f.style.height=N+"px",f.width=b,f.height=N,f}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(h=>h.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(h,f){try{h.srcObject=f}catch{h.src=URL.createObjectURL(f)}}cleanVideoSource(h){try{h.srcObject=null}catch{h.src=""}this.videoElement.removeAttribute("src")}}class te{constructor(h,f,b=f==null?0:8*f.length,N,_,C=j.currentTimeMillis()){this.text=h,this.rawBytes=f,this.numBits=b,this.resultPoints=N,this.format=_,this.timestamp=C,this.text=h,this.rawBytes=f,b==null?this.numBits=f==null?0:8*f.length:this.numBits=b,this.resultPoints=N,this.format=_,this.resultMetadata=null,C==null?this.timestamp=j.currentTimeMillis():this.timestamp=C}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(h,f){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(h,f)}putAllMetadata(h){h!==null&&(this.resultMetadata===null?this.resultMetadata=h:this.resultMetadata=new Map(h))}addResultPoints(h){const f=this.resultPoints;if(f===null)this.resultPoints=h;else if(h!==null&&h.length>0){const b=new Array(f.length+h.length);j.arraycopy(f,0,b,0,f.length),j.arraycopy(h,0,b,f.length,h.length),this.resultPoints=b}}getTimestamp(){return this.timestamp}toString(){return this.text}}var ne;(function(de){de[de.AZTEC=0]="AZTEC",de[de.CODABAR=1]="CODABAR",de[de.CODE_39=2]="CODE_39",de[de.CODE_93=3]="CODE_93",de[de.CODE_128=4]="CODE_128",de[de.DATA_MATRIX=5]="DATA_MATRIX",de[de.EAN_8=6]="EAN_8",de[de.EAN_13=7]="EAN_13",de[de.ITF=8]="ITF",de[de.MAXICODE=9]="MAXICODE",de[de.PDF_417=10]="PDF_417",de[de.QR_CODE=11]="QR_CODE",de[de.RSS_14=12]="RSS_14",de[de.RSS_EXPANDED=13]="RSS_EXPANDED",de[de.UPC_A=14]="UPC_A",de[de.UPC_E=15]="UPC_E",de[de.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(ne||(ne={}));var q=ne,ee;(function(de){de[de.OTHER=0]="OTHER",de[de.ORIENTATION=1]="ORIENTATION",de[de.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",de[de.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",de[de.ISSUE_NUMBER=4]="ISSUE_NUMBER",de[de.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",de[de.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",de[de.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",de[de.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",de[de.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",de[de.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(ee||(ee={}));var X=ee;class Z{constructor(h,f,b,N,_=-1,C=-1){this.rawBytes=h,this.text=f,this.byteSegments=b,this.ecLevel=N,this.structuredAppendSequenceNumber=_,this.structuredAppendParity=C,this.numBits=h==null?0:8*h.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(h){this.numBits=h}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(h){this.errorsCorrected=h}getErasures(){return this.erasures}setErasures(h){this.erasures=h}getOther(){return this.other}setOther(h){this.other=h}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Y{exp(h){return this.expTable[h]}log(h){if(h===0)throw new x;return this.logTable[h]}static addOrSubtract(h,f){return h^f}}class Q{constructor(h,f){if(f.length===0)throw new x;this.field=h;const b=f.length;if(b>1&&f[0]===0){let N=1;for(;N<b&&f[N]===0;)N++;N===b?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(b-N),j.arraycopy(f,N,this.coefficients,0,this.coefficients.length))}else this.coefficients=f}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(h){return this.coefficients[this.coefficients.length-1-h]}evaluateAt(h){if(h===0)return this.getCoefficient(0);const f=this.coefficients;let b;if(h===1){b=0;for(let C=0,M=f.length;C!==M;C++){const L=f[C];b=Y.addOrSubtract(b,L)}return b}b=f[0];const N=f.length,_=this.field;for(let C=1;C<N;C++)b=Y.addOrSubtract(_.multiply(h,b),f[C]);return b}addOrSubtract(h){if(!this.field.equals(h.field))throw new x("GenericGFPolys do not have same GenericGF field");if(this.isZero())return h;if(h.isZero())return this;let f=this.coefficients,b=h.coefficients;if(f.length>b.length){const C=f;f=b,b=C}let N=new Int32Array(b.length);const _=b.length-f.length;j.arraycopy(b,0,N,0,_);for(let C=_;C<b.length;C++)N[C]=Y.addOrSubtract(f[C-_],b[C]);return new Q(this.field,N)}multiply(h){if(!this.field.equals(h.field))throw new x("GenericGFPolys do not have same GenericGF field");if(this.isZero()||h.isZero())return this.field.getZero();const f=this.coefficients,b=f.length,N=h.coefficients,_=N.length,C=new Int32Array(b+_-1),M=this.field;for(let L=0;L<b;L++){const z=f[L];for(let re=0;re<_;re++)C[L+re]=Y.addOrSubtract(C[L+re],M.multiply(z,N[re]))}return new Q(M,C)}multiplyScalar(h){if(h===0)return this.field.getZero();if(h===1)return this;const f=this.coefficients.length,b=this.field,N=new Int32Array(f),_=this.coefficients;for(let C=0;C<f;C++)N[C]=b.multiply(_[C],h);return new Q(b,N)}multiplyByMonomial(h,f){if(h<0)throw new x;if(f===0)return this.field.getZero();const b=this.coefficients,N=b.length,_=new Int32Array(N+h),C=this.field;for(let M=0;M<N;M++)_[M]=C.multiply(b[M],f);return new Q(C,_)}divide(h){if(!this.field.equals(h.field))throw new x("GenericGFPolys do not have same GenericGF field");if(h.isZero())throw new x("Divide by 0");const f=this.field;let b=f.getZero(),N=this;const _=h.getCoefficient(h.getDegree()),C=f.inverse(_);for(;N.getDegree()>=h.getDegree()&&!N.isZero();){const M=N.getDegree()-h.getDegree(),L=f.multiply(N.getCoefficient(N.getDegree()),C),z=h.multiplyByMonomial(M,L),re=f.buildMonomial(M,L);b=b.addOrSubtract(re),N=N.addOrSubtract(z)}return[b,N]}toString(){let h="";for(let f=this.getDegree();f>=0;f--){let b=this.getCoefficient(f);if(b!==0){if(b<0?(h+=" - ",b=-b):h.length>0&&(h+=" + "),f===0||b!==1){const N=this.field.log(b);N===0?h+="1":N===1?h+="a":(h+="a^",h+=N)}f!==0&&(f===1?h+="x":(h+="x^",h+=f))}}return h}}class oe extends u{}oe.kind="ArithmeticException";class _e extends Y{constructor(h,f,b){super(),this.primitive=h,this.size=f,this.generatorBase=b;const N=new Int32Array(f);let _=1;for(let M=0;M<f;M++)N[M]=_,_*=2,_>=f&&(_^=h,_&=f-1);this.expTable=N;const C=new Int32Array(f);for(let M=0;M<f-1;M++)C[N[M]]=M;this.logTable=C,this.zero=new Q(this,Int32Array.from([0])),this.one=new Q(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(h,f){if(h<0)throw new x;if(f===0)return this.zero;const b=new Int32Array(h+1);return b[0]=f,new Q(this,b)}inverse(h){if(h===0)throw new oe;return this.expTable[this.size-this.logTable[h]-1]}multiply(h,f){return h===0||f===0?0:this.expTable[(this.logTable[h]+this.logTable[f])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+k.toHexString(this.primitive)+","+this.size+")"}equals(h){return h===this}}_e.AZTEC_DATA_12=new _e(4201,4096,1),_e.AZTEC_DATA_10=new _e(1033,1024,1),_e.AZTEC_DATA_6=new _e(67,64,1),_e.AZTEC_PARAM=new _e(19,16,1),_e.QR_CODE_FIELD_256=new _e(285,256,0),_e.DATA_MATRIX_FIELD_256=new _e(301,256,1),_e.AZTEC_DATA_8=_e.DATA_MATRIX_FIELD_256,_e.MAXICODE_FIELD_64=_e.AZTEC_DATA_6;class xe extends u{}xe.kind="ReedSolomonException";class me extends u{}me.kind="IllegalStateException";class Re{constructor(h){this.field=h}decode(h,f){const b=this.field,N=new Q(b,h),_=new Int32Array(f);let C=!0;for(let Se=0;Se<f;Se++){const Ie=N.evaluateAt(b.exp(Se+b.getGeneratorBase()));_[_.length-1-Se]=Ie,Ie!==0&&(C=!1)}if(C)return;const M=new Q(b,_),L=this.runEuclideanAlgorithm(b.buildMonomial(f,1),M,f),z=L[0],re=L[1],ue=this.findErrorLocations(z),pe=this.findErrorMagnitudes(re,ue);for(let Se=0;Se<ue.length;Se++){const Ie=h.length-1-b.log(ue[Se]);if(Ie<0)throw new xe("Bad error location");h[Ie]=_e.addOrSubtract(h[Ie],pe[Se])}}runEuclideanAlgorithm(h,f,b){if(h.getDegree()<f.getDegree()){const Se=h;h=f,f=Se}const N=this.field;let _=h,C=f,M=N.getZero(),L=N.getOne();for(;C.getDegree()>=(b/2|0);){let Se=_,Ie=M;if(_=C,M=L,_.isZero())throw new xe("r_{i-1} was zero");C=Se;let Be=N.getZero();const Xe=_.getCoefficient(_.getDegree()),nt=N.inverse(Xe);for(;C.getDegree()>=_.getDegree()&&!C.isZero();){const Ct=C.getDegree()-_.getDegree(),kt=N.multiply(C.getCoefficient(C.getDegree()),nt);Be=Be.addOrSubtract(N.buildMonomial(Ct,kt)),C=C.addOrSubtract(_.multiplyByMonomial(Ct,kt))}if(L=Be.multiply(M).addOrSubtract(Ie),C.getDegree()>=_.getDegree())throw new me("Division algorithm failed to reduce polynomial?")}const z=L.getCoefficient(0);if(z===0)throw new xe("sigmaTilde(0) was zero");const re=N.inverse(z),ue=L.multiplyScalar(re),pe=C.multiplyScalar(re);return[ue,pe]}findErrorLocations(h){const f=h.getDegree();if(f===1)return Int32Array.from([h.getCoefficient(1)]);const b=new Int32Array(f);let N=0;const _=this.field;for(let C=1;C<_.getSize()&&N<f;C++)h.evaluateAt(C)===0&&(b[N]=_.inverse(C),N++);if(N!==f)throw new xe("Error locator degree does not match number of roots");return b}findErrorMagnitudes(h,f){const b=f.length,N=new Int32Array(b),_=this.field;for(let C=0;C<b;C++){const M=_.inverse(f[C]);let L=1;for(let z=0;z<b;z++)if(C!==z){const re=_.multiply(f[z],M),ue=re&1?re&-2:re|1;L=_.multiply(L,ue)}N[C]=_.multiply(h.evaluateAt(M),_.inverse(L)),_.getGeneratorBase()!==0&&(N[C]=_.multiply(N[C],M))}return N}}var Ze;(function(de){de[de.UPPER=0]="UPPER",de[de.LOWER=1]="LOWER",de[de.MIXED=2]="MIXED",de[de.DIGIT=3]="DIGIT",de[de.PUNCT=4]="PUNCT",de[de.BINARY=5]="BINARY"})(Ze||(Ze={}));class $e{decode(h){this.ddata=h;let f=h.getBits(),b=this.extractBits(f),N=this.correctBits(b),_=$e.convertBoolArrayToByteArray(N),C=$e.getEncodedData(N),M=new Z(_,C,null,null);return M.setNumBits(N.length),M}static highLevelDecode(h){return this.getEncodedData(h)}static getEncodedData(h){let f=h.length,b=Ze.UPPER,N=Ze.UPPER,_="",C=0;for(;C<f;)if(N===Ze.BINARY){if(f-C<5)break;let M=$e.readCode(h,C,5);if(C+=5,M===0){if(f-C<11)break;M=$e.readCode(h,C,11)+31,C+=11}for(let L=0;L<M;L++){if(f-C<8){C=f;break}const z=$e.readCode(h,C,8);_+=W.castAsNonUtf8Char(z),C+=8}N=b}else{let M=N===Ze.DIGIT?4:5;if(f-C<M)break;let L=$e.readCode(h,C,M);C+=M;let z=$e.getCharacter(N,L);z.startsWith("CTRL_")?(b=N,N=$e.getTable(z.charAt(5)),z.charAt(6)==="L"&&(b=N)):(_+=z,N=b)}return _}static getTable(h){switch(h){case"L":return Ze.LOWER;case"P":return Ze.PUNCT;case"M":return Ze.MIXED;case"D":return Ze.DIGIT;case"B":return Ze.BINARY;case"U":default:return Ze.UPPER}}static getCharacter(h,f){switch(h){case Ze.UPPER:return $e.UPPER_TABLE[f];case Ze.LOWER:return $e.LOWER_TABLE[f];case Ze.MIXED:return $e.MIXED_TABLE[f];case Ze.PUNCT:return $e.PUNCT_TABLE[f];case Ze.DIGIT:return $e.DIGIT_TABLE[f];default:throw new me("Bad table")}}correctBits(h){let f,b;this.ddata.getNbLayers()<=2?(b=6,f=_e.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(b=8,f=_e.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(b=10,f=_e.AZTEC_DATA_10):(b=12,f=_e.AZTEC_DATA_12);let N=this.ddata.getNbDatablocks(),_=h.length/b;if(_<N)throw new O;let C=h.length%b,M=new Int32Array(_);for(let pe=0;pe<_;pe++,C+=b)M[pe]=$e.readCode(h,C,b);try{new Re(f).decode(M,_-N)}catch(pe){throw new O(pe)}let L=(1<<b)-1,z=0;for(let pe=0;pe<N;pe++){let Se=M[pe];if(Se===0||Se===L)throw new O;(Se===1||Se===L-1)&&z++}let re=new Array(N*b-z),ue=0;for(let pe=0;pe<N;pe++){let Se=M[pe];if(Se===1||Se===L-1)re.fill(Se>1,ue,ue+b-1),ue+=b-1;else for(let Ie=b-1;Ie>=0;--Ie)re[ue++]=(Se&1<<Ie)!==0}return re}extractBits(h){let f=this.ddata.isCompact(),b=this.ddata.getNbLayers(),N=(f?11:14)+b*4,_=new Int32Array(N),C=new Array(this.totalBitsInLayer(b,f));if(f)for(let M=0;M<_.length;M++)_[M]=M;else{let M=N+1+2*k.truncDivision(k.truncDivision(N,2)-1,15),L=N/2,z=k.truncDivision(M,2);for(let re=0;re<L;re++){let ue=re+k.truncDivision(re,15);_[L-re-1]=z-ue-1,_[L+re]=z+ue+1}}for(let M=0,L=0;M<b;M++){let z=(b-M)*4+(f?9:12),re=M*2,ue=N-1-re;for(let pe=0;pe<z;pe++){let Se=pe*2;for(let Ie=0;Ie<2;Ie++)C[L+Se+Ie]=h.get(_[re+Ie],_[re+pe]),C[L+2*z+Se+Ie]=h.get(_[re+pe],_[ue-Ie]),C[L+4*z+Se+Ie]=h.get(_[ue-Ie],_[ue-pe]),C[L+6*z+Se+Ie]=h.get(_[ue-pe],_[re+Ie])}L+=z*8}return C}static readCode(h,f,b){let N=0;for(let _=f;_<f+b;_++)N<<=1,h[_]&&(N|=1);return N}static readByte(h,f){let b=h.length-f;return b>=8?$e.readCode(h,f,8):$e.readCode(h,f,b)<<8-b}static convertBoolArrayToByteArray(h){let f=new Uint8Array((h.length+7)/8);for(let b=0;b<f.length;b++)f[b]=$e.readByte(h,8*b);return f}totalBitsInLayer(h,f){return((f?88:112)+16*h)*h}}$e.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],$e.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],$e.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],$e.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],$e.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class fe{constructor(){}static round(h){return h===NaN?0:h<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:h>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:h+(h<0?-.5:.5)|0}static distance(h,f,b,N){const _=h-b,C=f-N;return Math.sqrt(_*_+C*C)}static sum(h){let f=0;for(let b=0,N=h.length;b!==N;b++){const _=h[b];f+=_}return f}}class Me{static floatToIntBits(h){return h}}Me.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Ae{constructor(h,f){this.x=h,this.y=f}getX(){return this.x}getY(){return this.y}equals(h){if(h instanceof Ae){const f=h;return this.x===f.x&&this.y===f.y}return!1}hashCode(){return 31*Me.floatToIntBits(this.x)+Me.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(h){const f=this.distance(h[0],h[1]),b=this.distance(h[1],h[2]),N=this.distance(h[0],h[2]);let _,C,M;if(b>=f&&b>=N?(C=h[0],_=h[1],M=h[2]):N>=b&&N>=f?(C=h[1],_=h[0],M=h[2]):(C=h[2],_=h[0],M=h[1]),this.crossProductZ(_,C,M)<0){const L=_;_=M,M=L}h[0]=_,h[1]=C,h[2]=M}static distance(h,f){return fe.distance(h.x,h.y,f.x,f.y)}static crossProductZ(h,f,b){const N=f.x,_=f.y;return(b.x-N)*(h.y-_)-(b.y-_)*(h.x-N)}}class Ke{constructor(h,f){this.bits=h,this.points=f}getBits(){return this.bits}getPoints(){return this.points}}class Le extends Ke{constructor(h,f,b,N,_){super(h,f),this.compact=b,this.nbDatablocks=N,this.nbLayers=_}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class He{constructor(h,f,b,N){this.image=h,this.height=h.getHeight(),this.width=h.getWidth(),f==null&&(f=He.INIT_SIZE),b==null&&(b=h.getWidth()/2|0),N==null&&(N=h.getHeight()/2|0);const _=f/2|0;if(this.leftInit=b-_,this.rightInit=b+_,this.upInit=N-_,this.downInit=N+_,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new F}detect(){let h=this.leftInit,f=this.rightInit,b=this.upInit,N=this.downInit,_=!1,C=!0,M=!1,L=!1,z=!1,re=!1,ue=!1;const pe=this.width,Se=this.height;for(;C;){C=!1;let Ie=!0;for(;(Ie||!L)&&f<pe;)Ie=this.containsBlackPoint(b,N,f,!1),Ie?(f++,C=!0,L=!0):L||f++;if(f>=pe){_=!0;break}let Be=!0;for(;(Be||!z)&&N<Se;)Be=this.containsBlackPoint(h,f,N,!0),Be?(N++,C=!0,z=!0):z||N++;if(N>=Se){_=!0;break}let Xe=!0;for(;(Xe||!re)&&h>=0;)Xe=this.containsBlackPoint(b,N,h,!1),Xe?(h--,C=!0,re=!0):re||h--;if(h<0){_=!0;break}let nt=!0;for(;(nt||!ue)&&b>=0;)nt=this.containsBlackPoint(h,f,b,!0),nt?(b--,C=!0,ue=!0):ue||b--;if(b<0){_=!0;break}C&&(M=!0)}if(!_&&M){const Ie=f-h;let Be=null;for(let kt=1;Be===null&&kt<Ie;kt++)Be=this.getBlackPointOnSegment(h,N-kt,h+kt,N);if(Be==null)throw new F;let Xe=null;for(let kt=1;Xe===null&&kt<Ie;kt++)Xe=this.getBlackPointOnSegment(h,b+kt,h+kt,b);if(Xe==null)throw new F;let nt=null;for(let kt=1;nt===null&&kt<Ie;kt++)nt=this.getBlackPointOnSegment(f,b+kt,f-kt,b);if(nt==null)throw new F;let Ct=null;for(let kt=1;Ct===null&&kt<Ie;kt++)Ct=this.getBlackPointOnSegment(f,N-kt,f-kt,N);if(Ct==null)throw new F;return this.centerEdges(Ct,Be,nt,Xe)}else throw new F}getBlackPointOnSegment(h,f,b,N){const _=fe.round(fe.distance(h,f,b,N)),C=(b-h)/_,M=(N-f)/_,L=this.image;for(let z=0;z<_;z++){const re=fe.round(h+z*C),ue=fe.round(f+z*M);if(L.get(re,ue))return new Ae(re,ue)}return null}centerEdges(h,f,b,N){const _=h.getX(),C=h.getY(),M=f.getX(),L=f.getY(),z=b.getX(),re=b.getY(),ue=N.getX(),pe=N.getY(),Se=He.CORR;return _<this.width/2?[new Ae(ue-Se,pe+Se),new Ae(M+Se,L+Se),new Ae(z-Se,re-Se),new Ae(_+Se,C-Se)]:[new Ae(ue+Se,pe+Se),new Ae(M+Se,L-Se),new Ae(z-Se,re+Se),new Ae(_-Se,C-Se)]}containsBlackPoint(h,f,b,N){const _=this.image;if(N){for(let C=h;C<=f;C++)if(_.get(C,b))return!0}else for(let C=h;C<=f;C++)if(_.get(b,C))return!0;return!1}}He.INIT_SIZE=10,He.CORR=1;class pt{static checkAndNudgePoints(h,f){const b=h.getWidth(),N=h.getHeight();let _=!0;for(let C=0;C<f.length&&_;C+=2){const M=Math.floor(f[C]),L=Math.floor(f[C+1]);if(M<-1||M>b||L<-1||L>N)throw new F;_=!1,M===-1?(f[C]=0,_=!0):M===b&&(f[C]=b-1,_=!0),L===-1?(f[C+1]=0,_=!0):L===N&&(f[C+1]=N-1,_=!0)}_=!0;for(let C=f.length-2;C>=0&&_;C-=2){const M=Math.floor(f[C]),L=Math.floor(f[C+1]);if(M<-1||M>b||L<-1||L>N)throw new F;_=!1,M===-1?(f[C]=0,_=!0):M===b&&(f[C]=b-1,_=!0),L===-1?(f[C+1]=0,_=!0):L===N&&(f[C+1]=N-1,_=!0)}}}class Pe{constructor(h,f,b,N,_,C,M,L,z){this.a11=h,this.a21=f,this.a31=b,this.a12=N,this.a22=_,this.a32=C,this.a13=M,this.a23=L,this.a33=z}static quadrilateralToQuadrilateral(h,f,b,N,_,C,M,L,z,re,ue,pe,Se,Ie,Be,Xe){const nt=Pe.quadrilateralToSquare(h,f,b,N,_,C,M,L);return Pe.squareToQuadrilateral(z,re,ue,pe,Se,Ie,Be,Xe).times(nt)}transformPoints(h){const f=h.length,b=this.a11,N=this.a12,_=this.a13,C=this.a21,M=this.a22,L=this.a23,z=this.a31,re=this.a32,ue=this.a33;for(let pe=0;pe<f;pe+=2){const Se=h[pe],Ie=h[pe+1],Be=_*Se+L*Ie+ue;h[pe]=(b*Se+C*Ie+z)/Be,h[pe+1]=(N*Se+M*Ie+re)/Be}}transformPointsWithValues(h,f){const b=this.a11,N=this.a12,_=this.a13,C=this.a21,M=this.a22,L=this.a23,z=this.a31,re=this.a32,ue=this.a33,pe=h.length;for(let Se=0;Se<pe;Se++){const Ie=h[Se],Be=f[Se],Xe=_*Ie+L*Be+ue;h[Se]=(b*Ie+C*Be+z)/Xe,f[Se]=(N*Ie+M*Be+re)/Xe}}static squareToQuadrilateral(h,f,b,N,_,C,M,L){const z=h-b+_-M,re=f-N+C-L;if(z===0&&re===0)return new Pe(b-h,_-b,h,N-f,C-N,f,0,0,1);{const ue=b-_,pe=M-_,Se=N-C,Ie=L-C,Be=ue*Ie-pe*Se,Xe=(z*Ie-pe*re)/Be,nt=(ue*re-z*Se)/Be;return new Pe(b-h+Xe*b,M-h+nt*M,h,N-f+Xe*N,L-f+nt*L,f,Xe,nt,1)}}static quadrilateralToSquare(h,f,b,N,_,C,M,L){return Pe.squareToQuadrilateral(h,f,b,N,_,C,M,L).buildAdjoint()}buildAdjoint(){return new Pe(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(h){return new Pe(this.a11*h.a11+this.a21*h.a12+this.a31*h.a13,this.a11*h.a21+this.a21*h.a22+this.a31*h.a23,this.a11*h.a31+this.a21*h.a32+this.a31*h.a33,this.a12*h.a11+this.a22*h.a12+this.a32*h.a13,this.a12*h.a21+this.a22*h.a22+this.a32*h.a23,this.a12*h.a31+this.a22*h.a32+this.a32*h.a33,this.a13*h.a11+this.a23*h.a12+this.a33*h.a13,this.a13*h.a21+this.a23*h.a22+this.a33*h.a23,this.a13*h.a31+this.a23*h.a32+this.a33*h.a33)}}class bt extends pt{sampleGrid(h,f,b,N,_,C,M,L,z,re,ue,pe,Se,Ie,Be,Xe,nt,Ct,kt){const wt=Pe.quadrilateralToQuadrilateral(N,_,C,M,L,z,re,ue,pe,Se,Ie,Be,Xe,nt,Ct,kt);return this.sampleGridWithTransform(h,f,b,wt)}sampleGridWithTransform(h,f,b,N){if(f<=0||b<=0)throw new F;const _=new R(f,b),C=new Float32Array(2*f);for(let M=0;M<b;M++){const L=C.length,z=M+.5;for(let re=0;re<L;re+=2)C[re]=re/2+.5,C[re+1]=z;N.transformPoints(C),pt.checkAndNudgePoints(h,C);try{for(let re=0;re<L;re+=2)h.get(Math.floor(C[re]),Math.floor(C[re+1]))&&_.set(re/2,M)}catch{throw new F}}return _}}class It{static setGridSampler(h){It.gridSampler=h}static getInstance(){return It.gridSampler}}It.gridSampler=new bt;class De{constructor(h,f){this.x=h,this.y=f}toResultPoint(){return new Ae(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class tt{constructor(h){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=h}detect(){return this.detectMirror(!1)}detectMirror(h){let f=this.getMatrixCenter(),b=this.getBullsEyeCorners(f);if(h){let C=b[0];b[0]=b[2],b[2]=C}this.extractParameters(b);let N=this.sampleGrid(this.image,b[this.shift%4],b[(this.shift+1)%4],b[(this.shift+2)%4],b[(this.shift+3)%4]),_=this.getMatrixCornerPoints(b);return new Le(N,_,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(h){if(!this.isValidPoint(h[0])||!this.isValidPoint(h[1])||!this.isValidPoint(h[2])||!this.isValidPoint(h[3]))throw new F;let f=2*this.nbCenterLayers,b=new Int32Array([this.sampleLine(h[0],h[1],f),this.sampleLine(h[1],h[2],f),this.sampleLine(h[2],h[3],f),this.sampleLine(h[3],h[0],f)]);this.shift=this.getRotation(b,f);let N=0;for(let C=0;C<4;C++){let M=b[(this.shift+C)%4];this.compact?(N<<=7,N+=M>>1&127):(N<<=10,N+=(M>>2&992)+(M>>1&31))}let _=this.getCorrectedParameterData(N,this.compact);this.compact?(this.nbLayers=(_>>6)+1,this.nbDataBlocks=(_&63)+1):(this.nbLayers=(_>>11)+1,this.nbDataBlocks=(_&2047)+1)}getRotation(h,f){let b=0;h.forEach((N,_,C)=>{let M=(N>>f-2<<1)+(N&1);b=(b<<3)+M}),b=((b&1)<<11)+(b>>1);for(let N=0;N<4;N++)if(k.bitCount(b^this.EXPECTED_CORNER_BITS[N])<=2)return N;throw new F}getCorrectedParameterData(h,f){let b,N;f?(b=7,N=2):(b=10,N=4);let _=b-N,C=new Int32Array(b);for(let L=b-1;L>=0;--L)C[L]=h&15,h>>=4;try{new Re(_e.AZTEC_PARAM).decode(C,_)}catch{throw new F}let M=0;for(let L=0;L<N;L++)M=(M<<4)+C[L];return M}getBullsEyeCorners(h){let f=h,b=h,N=h,_=h,C=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let ue=this.getFirstDifferent(f,C,1,-1),pe=this.getFirstDifferent(b,C,1,1),Se=this.getFirstDifferent(N,C,-1,1),Ie=this.getFirstDifferent(_,C,-1,-1);if(this.nbCenterLayers>2){let Be=this.distancePoint(Ie,ue)*this.nbCenterLayers/(this.distancePoint(_,f)*(this.nbCenterLayers+2));if(Be<.75||Be>1.25||!this.isWhiteOrBlackRectangle(ue,pe,Se,Ie))break}f=ue,b=pe,N=Se,_=Ie,C=!C}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new F;this.compact=this.nbCenterLayers===5;let M=new Ae(f.getX()+.5,f.getY()-.5),L=new Ae(b.getX()+.5,b.getY()+.5),z=new Ae(N.getX()-.5,N.getY()+.5),re=new Ae(_.getX()-.5,_.getY()-.5);return this.expandSquare([M,L,z,re],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let h,f,b,N;try{let M=new He(this.image).detect();h=M[0],f=M[1],b=M[2],N=M[3]}catch{let L=this.image.getWidth()/2,z=this.image.getHeight()/2;h=this.getFirstDifferent(new De(L+7,z-7),!1,1,-1).toResultPoint(),f=this.getFirstDifferent(new De(L+7,z+7),!1,1,1).toResultPoint(),b=this.getFirstDifferent(new De(L-7,z+7),!1,-1,1).toResultPoint(),N=this.getFirstDifferent(new De(L-7,z-7),!1,-1,-1).toResultPoint()}let _=fe.round((h.getX()+N.getX()+f.getX()+b.getX())/4),C=fe.round((h.getY()+N.getY()+f.getY()+b.getY())/4);try{let M=new He(this.image,15,_,C).detect();h=M[0],f=M[1],b=M[2],N=M[3]}catch{h=this.getFirstDifferent(new De(_+7,C-7),!1,1,-1).toResultPoint(),f=this.getFirstDifferent(new De(_+7,C+7),!1,1,1).toResultPoint(),b=this.getFirstDifferent(new De(_-7,C+7),!1,-1,1).toResultPoint(),N=this.getFirstDifferent(new De(_-7,C-7),!1,-1,-1).toResultPoint()}return _=fe.round((h.getX()+N.getX()+f.getX()+b.getX())/4),C=fe.round((h.getY()+N.getY()+f.getY()+b.getY())/4),new De(_,C)}getMatrixCornerPoints(h){return this.expandSquare(h,2*this.nbCenterLayers,this.getDimension())}sampleGrid(h,f,b,N,_){let C=It.getInstance(),M=this.getDimension(),L=M/2-this.nbCenterLayers,z=M/2+this.nbCenterLayers;return C.sampleGrid(h,M,M,L,L,z,L,z,z,L,z,f.getX(),f.getY(),b.getX(),b.getY(),N.getX(),N.getY(),_.getX(),_.getY())}sampleLine(h,f,b){let N=0,_=this.distanceResultPoint(h,f),C=_/b,M=h.getX(),L=h.getY(),z=C*(f.getX()-h.getX())/_,re=C*(f.getY()-h.getY())/_;for(let ue=0;ue<b;ue++)this.image.get(fe.round(M+ue*z),fe.round(L+ue*re))&&(N|=1<<b-ue-1);return N}isWhiteOrBlackRectangle(h,f,b,N){let _=3;h=new De(h.getX()-_,h.getY()+_),f=new De(f.getX()-_,f.getY()-_),b=new De(b.getX()+_,b.getY()-_),N=new De(N.getX()+_,N.getY()+_);let C=this.getColor(N,h);if(C===0)return!1;let M=this.getColor(h,f);return M!==C||(M=this.getColor(f,b),M!==C)?!1:(M=this.getColor(b,N),M===C)}getColor(h,f){let b=this.distancePoint(h,f),N=(f.getX()-h.getX())/b,_=(f.getY()-h.getY())/b,C=0,M=h.getX(),L=h.getY(),z=this.image.get(h.getX(),h.getY()),re=Math.ceil(b);for(let pe=0;pe<re;pe++)M+=N,L+=_,this.image.get(fe.round(M),fe.round(L))!==z&&C++;let ue=C/b;return ue>.1&&ue<.9?0:ue<=.1===z?1:-1}getFirstDifferent(h,f,b,N){let _=h.getX()+b,C=h.getY()+N;for(;this.isValid(_,C)&&this.image.get(_,C)===f;)_+=b,C+=N;for(_-=b,C-=N;this.isValid(_,C)&&this.image.get(_,C)===f;)_+=b;for(_-=b;this.isValid(_,C)&&this.image.get(_,C)===f;)C+=N;return C-=N,new De(_,C)}expandSquare(h,f,b){let N=b/(2*f),_=h[0].getX()-h[2].getX(),C=h[0].getY()-h[2].getY(),M=(h[0].getX()+h[2].getX())/2,L=(h[0].getY()+h[2].getY())/2,z=new Ae(M+N*_,L+N*C),re=new Ae(M-N*_,L-N*C);_=h[1].getX()-h[3].getX(),C=h[1].getY()-h[3].getY(),M=(h[1].getX()+h[3].getX())/2,L=(h[1].getY()+h[3].getY())/2;let ue=new Ae(M+N*_,L+N*C),pe=new Ae(M-N*_,L-N*C);return[z,ue,re,pe]}isValid(h,f){return h>=0&&h<this.image.getWidth()&&f>0&&f<this.image.getHeight()}isValidPoint(h){let f=fe.round(h.getX()),b=fe.round(h.getY());return this.isValid(f,b)}distancePoint(h,f){return fe.distance(h.getX(),h.getY(),f.getX(),f.getY())}distanceResultPoint(h,f){return fe.distance(h.getX(),h.getY(),f.getX(),f.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(k.truncDivision(this.nbLayers-4,8)+1)+15}}class ve{decode(h,f=null){let b=null,N=new tt(h.getBlackMatrix()),_=null,C=null;try{let re=N.detectMirror(!1);_=re.getPoints(),this.reportFoundResultPoints(f,_),C=new $e().decode(re)}catch(re){b=re}if(C==null)try{let re=N.detectMirror(!0);_=re.getPoints(),this.reportFoundResultPoints(f,_),C=new $e().decode(re)}catch(re){throw b??re}let M=new te(C.getText(),C.getRawBytes(),C.getNumBits(),_,q.AZTEC,j.currentTimeMillis()),L=C.getByteSegments();L!=null&&M.putMetadata(X.BYTE_SEGMENTS,L);let z=C.getECLevel();return z!=null&&M.putMetadata(X.ERROR_CORRECTION_LEVEL,z),M}reportFoundResultPoints(h,f){if(h!=null){let b=h.get(P.NEED_RESULT_POINT_CALLBACK);b!=null&&f.forEach((N,_,C)=>{b.foundPossibleResultPoint(N)})}}reset(){}}class Ge extends ie{constructor(h=500){super(new ve,h)}}class We{decode(h,f){try{return this.doDecode(h,f)}catch{if(f&&f.get(P.TRY_HARDER)===!0&&h.isRotateSupported()){const _=h.rotateCounterClockwise(),C=this.doDecode(_,f),M=C.getResultMetadata();let L=270;M!==null&&M.get(X.ORIENTATION)===!0&&(L=L+M.get(X.ORIENTATION)%360),C.putMetadata(X.ORIENTATION,L);const z=C.getResultPoints();if(z!==null){const re=_.getHeight();for(let ue=0;ue<z.length;ue++)z[ue]=new Ae(re-z[ue].getY()-1,z[ue].getX())}return C}else throw new F}}reset(){}doDecode(h,f){const b=h.getWidth(),N=h.getHeight();let _=new A(b);const C=f&&f.get(P.TRY_HARDER)===!0,M=Math.max(1,N>>(C?8:5));let L;C?L=N:L=15;const z=Math.trunc(N/2);for(let re=0;re<L;re++){const ue=Math.trunc((re+1)/2),pe=(re&1)===0,Se=z+M*(pe?ue:-ue);if(Se<0||Se>=N)break;try{_=h.getBlackRow(Se,_)}catch{continue}for(let Ie=0;Ie<2;Ie++){if(Ie===1&&(_.reverse(),f&&f.get(P.NEED_RESULT_POINT_CALLBACK)===!0)){const Be=new Map;f.forEach((Xe,nt)=>Be.set(nt,Xe)),Be.delete(P.NEED_RESULT_POINT_CALLBACK),f=Be}try{const Be=this.decodeRow(Se,_,f);if(Ie===1){Be.putMetadata(X.ORIENTATION,180);const Xe=Be.getResultPoints();Xe!==null&&(Xe[0]=new Ae(b-Xe[0].getX()-1,Xe[0].getY()),Xe[1]=new Ae(b-Xe[1].getX()-1,Xe[1].getY()))}return Be}catch{}}}throw new F}static recordPattern(h,f,b){const N=b.length;for(let z=0;z<N;z++)b[z]=0;const _=h.getSize();if(f>=_)throw new F;let C=!h.get(f),M=0,L=f;for(;L<_;){if(h.get(L)!==C)b[M]++;else{if(++M===N)break;b[M]=1,C=!C}L++}if(!(M===N||M===N-1&&L===_))throw new F}static recordPatternInReverse(h,f,b){let N=b.length,_=h.get(f);for(;f>0&&N>=0;)h.get(--f)!==_&&(N--,_=!_);if(N>=0)throw new F;We.recordPattern(h,f+1,b)}static patternMatchVariance(h,f,b){const N=h.length;let _=0,C=0;for(let z=0;z<N;z++)_+=h[z],C+=f[z];if(_<C)return Number.POSITIVE_INFINITY;const M=_/C;b*=M;let L=0;for(let z=0;z<N;z++){const re=h[z],ue=f[z]*M,pe=re>ue?re-ue:ue-re;if(pe>b)return Number.POSITIVE_INFINITY;L+=pe}return L/_}}class Ve extends We{static findStartPattern(h){const f=h.getSize(),b=h.getNextSet(0);let N=0,_=Int32Array.from([0,0,0,0,0,0]),C=b,M=!1;const L=6;for(let z=b;z<f;z++)if(h.get(z)!==M)_[N]++;else{if(N===L-1){let re=Ve.MAX_AVG_VARIANCE,ue=-1;for(let pe=Ve.CODE_START_A;pe<=Ve.CODE_START_C;pe++){const Se=We.patternMatchVariance(_,Ve.CODE_PATTERNS[pe],Ve.MAX_INDIVIDUAL_VARIANCE);Se<re&&(re=Se,ue=pe)}if(ue>=0&&h.isRange(Math.max(0,C-(z-C)/2),C,!1))return Int32Array.from([C,z,ue]);C+=_[0]+_[1],_=_.slice(2,_.length-1),_[N-1]=0,_[N]=0,N--}else N++;_[N]=1,M=!M}throw new F}static decodeCode(h,f,b){We.recordPattern(h,b,f);let N=Ve.MAX_AVG_VARIANCE,_=-1;for(let C=0;C<Ve.CODE_PATTERNS.length;C++){const M=Ve.CODE_PATTERNS[C],L=this.patternMatchVariance(f,M,Ve.MAX_INDIVIDUAL_VARIANCE);L<N&&(N=L,_=C)}if(_>=0)return _;throw new F}decodeRow(h,f,b){const N=b&&b.get(P.ASSUME_GS1)===!0,_=Ve.findStartPattern(f),C=_[2];let M=0;const L=new Uint8Array(20);L[M++]=C;let z;switch(C){case Ve.CODE_START_A:z=Ve.CODE_CODE_A;break;case Ve.CODE_START_B:z=Ve.CODE_CODE_B;break;case Ve.CODE_START_C:z=Ve.CODE_CODE_C;break;default:throw new O}let re=!1,ue=!1,pe="",Se=_[0],Ie=_[1];const Be=Int32Array.from([0,0,0,0,0,0]);let Xe=0,nt=0,Ct=C,kt=0,wt=!0,$s=!1,Ns=!1;for(;!re;){const Ax=ue;switch(ue=!1,Xe=nt,nt=Ve.decodeCode(f,Be,Ie),L[M++]=nt,nt!==Ve.CODE_STOP&&(wt=!0),nt!==Ve.CODE_STOP&&(kt++,Ct+=kt*nt),Se=Ie,Ie+=Be.reduce((Hne,Wne)=>Hne+Wne,0),nt){case Ve.CODE_START_A:case Ve.CODE_START_B:case Ve.CODE_START_C:throw new O}switch(z){case Ve.CODE_CODE_A:if(nt<64)Ns===$s?pe+=String.fromCharCode(32+nt):pe+=String.fromCharCode(32+nt+128),Ns=!1;else if(nt<96)Ns===$s?pe+=String.fromCharCode(nt-64):pe+=String.fromCharCode(nt+64),Ns=!1;else switch(nt!==Ve.CODE_STOP&&(wt=!1),nt){case Ve.CODE_FNC_1:N&&(pe.length===0?pe+="]C1":pe+="");break;case Ve.CODE_FNC_2:case Ve.CODE_FNC_3:break;case Ve.CODE_FNC_4_A:!$s&&Ns?($s=!0,Ns=!1):$s&&Ns?($s=!1,Ns=!1):Ns=!0;break;case Ve.CODE_SHIFT:ue=!0,z=Ve.CODE_CODE_B;break;case Ve.CODE_CODE_B:z=Ve.CODE_CODE_B;break;case Ve.CODE_CODE_C:z=Ve.CODE_CODE_C;break;case Ve.CODE_STOP:re=!0;break}break;case Ve.CODE_CODE_B:if(nt<96)Ns===$s?pe+=String.fromCharCode(32+nt):pe+=String.fromCharCode(32+nt+128),Ns=!1;else switch(nt!==Ve.CODE_STOP&&(wt=!1),nt){case Ve.CODE_FNC_1:N&&(pe.length===0?pe+="]C1":pe+="");break;case Ve.CODE_FNC_2:case Ve.CODE_FNC_3:break;case Ve.CODE_FNC_4_B:!$s&&Ns?($s=!0,Ns=!1):$s&&Ns?($s=!1,Ns=!1):Ns=!0;break;case Ve.CODE_SHIFT:ue=!0,z=Ve.CODE_CODE_A;break;case Ve.CODE_CODE_A:z=Ve.CODE_CODE_A;break;case Ve.CODE_CODE_C:z=Ve.CODE_CODE_C;break;case Ve.CODE_STOP:re=!0;break}break;case Ve.CODE_CODE_C:if(nt<100)nt<10&&(pe+="0"),pe+=nt;else switch(nt!==Ve.CODE_STOP&&(wt=!1),nt){case Ve.CODE_FNC_1:N&&(pe.length===0?pe+="]C1":pe+="");break;case Ve.CODE_CODE_A:z=Ve.CODE_CODE_A;break;case Ve.CODE_CODE_B:z=Ve.CODE_CODE_B;break;case Ve.CODE_STOP:re=!0;break}break}Ax&&(z=z===Ve.CODE_CODE_A?Ve.CODE_CODE_B:Ve.CODE_CODE_A)}const zi=Ie-Se;if(Ie=f.getNextUnset(Ie),!f.isRange(Ie,Math.min(f.getSize(),Ie+(Ie-Se)/2),!1))throw new F;if(Ct-=kt*Xe,Ct%103!==Xe)throw new y;const zo=pe.length;if(zo===0)throw new F;zo>0&&wt&&(z===Ve.CODE_CODE_C?pe=pe.substring(0,zo-2):pe=pe.substring(0,zo-1));const Ui=(_[1]+_[0])/2,wn=Se+zi/2,Ma=L.length,vl=new Uint8Array(Ma);for(let Ax=0;Ax<Ma;Ax++)vl[Ax]=L[Ax];const kx=[new Ae(Ui,h),new Ae(wn,h)];return new te(pe,vl,0,kx,q.CODE_128,new Date().getTime())}}Ve.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],Ve.MAX_AVG_VARIANCE=.25,Ve.MAX_INDIVIDUAL_VARIANCE=.7,Ve.CODE_SHIFT=98,Ve.CODE_CODE_C=99,Ve.CODE_CODE_B=100,Ve.CODE_CODE_A=101,Ve.CODE_FNC_1=102,Ve.CODE_FNC_2=97,Ve.CODE_FNC_3=96,Ve.CODE_FNC_4_A=101,Ve.CODE_FNC_4_B=100,Ve.CODE_START_A=103,Ve.CODE_START_B=104,Ve.CODE_START_C=105,Ve.CODE_STOP=106;class Fe extends We{constructor(h=!1,f=!1){super(),this.usingCheckDigit=h,this.extendedMode=f,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(h,f,b){let N=this.counters;N.fill(0),this.decodeRowResult="";let _=Fe.findAsteriskPattern(f,N),C=f.getNextSet(_[1]),M=f.getSize(),L,z;do{Fe.recordPattern(f,C,N);let Be=Fe.toNarrowWidePattern(N);if(Be<0)throw new F;L=Fe.patternToChar(Be),this.decodeRowResult+=L,z=C;for(let Xe of N)C+=Xe;C=f.getNextSet(C)}while(L!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let re=0;for(let Be of N)re+=Be;let ue=C-z-re;if(C!==M&&ue*2<re)throw new F;if(this.usingCheckDigit){let Be=this.decodeRowResult.length-1,Xe=0;for(let nt=0;nt<Be;nt++)Xe+=Fe.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(nt));if(this.decodeRowResult.charAt(Be)!==Fe.ALPHABET_STRING.charAt(Xe%43))throw new y;this.decodeRowResult=this.decodeRowResult.substring(0,Be)}if(this.decodeRowResult.length===0)throw new F;let pe;this.extendedMode?pe=Fe.decodeExtended(this.decodeRowResult):pe=this.decodeRowResult;let Se=(_[1]+_[0])/2,Ie=z+re/2;return new te(pe,null,0,[new Ae(Se,h),new Ae(Ie,h)],q.CODE_39,new Date().getTime())}static findAsteriskPattern(h,f){let b=h.getSize(),N=h.getNextSet(0),_=0,C=N,M=!1,L=f.length;for(let z=N;z<b;z++)if(h.get(z)!==M)f[_]++;else{if(_===L-1){if(this.toNarrowWidePattern(f)===Fe.ASTERISK_ENCODING&&h.isRange(Math.max(0,C-Math.floor((z-C)/2)),C,!1))return[C,z];C+=f[0]+f[1],f.copyWithin(0,2,2+_-1),f[_-1]=0,f[_]=0,_--}else _++;f[_]=1,M=!M}throw new F}static toNarrowWidePattern(h){let f=h.length,b=0,N;do{let _=2147483647;for(let L of h)L<_&&L>b&&(_=L);b=_,N=0;let C=0,M=0;for(let L=0;L<f;L++){let z=h[L];z>b&&(M|=1<<f-1-L,N++,C+=z)}if(N===3){for(let L=0;L<f&&N>0;L++){let z=h[L];if(z>b&&(N--,z*2>=C))return-1}return M}}while(N>3);return-1}static patternToChar(h){for(let f=0;f<Fe.CHARACTER_ENCODINGS.length;f++)if(Fe.CHARACTER_ENCODINGS[f]===h)return Fe.ALPHABET_STRING.charAt(f);if(h===Fe.ASTERISK_ENCODING)return"*";throw new F}static decodeExtended(h){let f=h.length,b="";for(let N=0;N<f;N++){let _=h.charAt(N);if(_==="+"||_==="$"||_==="%"||_==="/"){let C=h.charAt(N+1),M="\0";switch(_){case"+":if(C>="A"&&C<="Z")M=String.fromCharCode(C.charCodeAt(0)+32);else throw new O;break;case"$":if(C>="A"&&C<="Z")M=String.fromCharCode(C.charCodeAt(0)-64);else throw new O;break;case"%":if(C>="A"&&C<="E")M=String.fromCharCode(C.charCodeAt(0)-38);else if(C>="F"&&C<="J")M=String.fromCharCode(C.charCodeAt(0)-11);else if(C>="K"&&C<="O")M=String.fromCharCode(C.charCodeAt(0)+16);else if(C>="P"&&C<="T")M=String.fromCharCode(C.charCodeAt(0)+43);else if(C==="U")M="\0";else if(C==="V")M="@";else if(C==="W")M="`";else if(C==="X"||C==="Y"||C==="Z")M="";else throw new O;break;case"/":if(C>="A"&&C<="O")M=String.fromCharCode(C.charCodeAt(0)-32);else if(C==="Z")M=":";else throw new O;break}b+=M,N++}else b+=_}return b}}Fe.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Fe.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Fe.ASTERISK_ENCODING=148;class ot extends We{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(h,f,b){let N=this.decodeStart(f),_=this.decodeEnd(f),C=new V;ot.decodeMiddle(f,N[1],_[0],C);let M=C.toString(),L=null;b!=null&&(L=b.get(P.ALLOWED_LENGTHS)),L==null&&(L=ot.DEFAULT_ALLOWED_LENGTHS);let z=M.length,re=!1,ue=0;for(let Ie of L){if(z===Ie){re=!0;break}Ie>ue&&(ue=Ie)}if(!re&&z>ue&&(re=!0),!re)throw new O;const pe=[new Ae(N[1],h),new Ae(_[0],h)];return new te(M,null,0,pe,q.ITF,new Date().getTime())}static decodeMiddle(h,f,b,N){let _=new Int32Array(10),C=new Int32Array(5),M=new Int32Array(5);for(_.fill(0),C.fill(0),M.fill(0);f<b;){We.recordPattern(h,f,_);for(let z=0;z<5;z++){let re=2*z;C[z]=_[re],M[z]=_[re+1]}let L=ot.decodeDigit(C);N.append(L.toString()),L=this.decodeDigit(M),N.append(L.toString()),_.forEach(function(z){f+=z})}}decodeStart(h){let f=ot.skipWhiteSpace(h),b=ot.findGuardPattern(h,f,ot.START_PATTERN);return this.narrowLineWidth=(b[1]-b[0])/4,this.validateQuietZone(h,b[0]),b}validateQuietZone(h,f){let b=this.narrowLineWidth*10;b=b<f?b:f;for(let N=f-1;b>0&&N>=0&&!h.get(N);N--)b--;if(b!==0)throw new F}static skipWhiteSpace(h){const f=h.getSize(),b=h.getNextSet(0);if(b===f)throw new F;return b}decodeEnd(h){h.reverse();try{let f=ot.skipWhiteSpace(h),b;try{b=ot.findGuardPattern(h,f,ot.END_PATTERN_REVERSED[0])}catch(_){_ instanceof F&&(b=ot.findGuardPattern(h,f,ot.END_PATTERN_REVERSED[1]))}this.validateQuietZone(h,b[0]);let N=b[0];return b[0]=h.getSize()-b[1],b[1]=h.getSize()-N,b}finally{h.reverse()}}static findGuardPattern(h,f,b){let N=b.length,_=new Int32Array(N),C=h.getSize(),M=!1,L=0,z=f;_.fill(0);for(let re=f;re<C;re++)if(h.get(re)!==M)_[L]++;else{if(L===N-1){if(We.patternMatchVariance(_,b,ot.MAX_INDIVIDUAL_VARIANCE)<ot.MAX_AVG_VARIANCE)return[z,re];z+=_[0]+_[1],j.arraycopy(_,2,_,0,L-1),_[L-1]=0,_[L]=0,L--}else L++;_[L]=1,M=!M}throw new F}static decodeDigit(h){let f=ot.MAX_AVG_VARIANCE,b=-1,N=ot.PATTERNS.length;for(let _=0;_<N;_++){let C=ot.PATTERNS[_],M=We.patternMatchVariance(h,C,ot.MAX_INDIVIDUAL_VARIANCE);M<f?(f=M,b=_):M===f&&(b=-1)}if(b>=0)return b%10;throw new F}}ot.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],ot.MAX_AVG_VARIANCE=.38,ot.MAX_INDIVIDUAL_VARIANCE=.5,ot.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],ot.START_PATTERN=Int32Array.from([1,1,1,1]),ot.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class ft extends We{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(h){let f=!1,b,N=0,_=Int32Array.from([0,0,0]);for(;!f;){_=Int32Array.from([0,0,0]),b=ft.findGuardPattern(h,N,!1,this.START_END_PATTERN,_);let C=b[0];N=b[1];let M=C-(N-C);M>=0&&(f=h.isRange(M,C,!1))}return b}static checkChecksum(h){return ft.checkStandardUPCEANChecksum(h)}static checkStandardUPCEANChecksum(h){let f=h.length;if(f===0)return!1;let b=parseInt(h.charAt(f-1),10);return ft.getStandardUPCEANChecksum(h.substring(0,f-1))===b}static getStandardUPCEANChecksum(h){let f=h.length,b=0;for(let N=f-1;N>=0;N-=2){let _=h.charAt(N).charCodeAt(0)-48;if(_<0||_>9)throw new O;b+=_}b*=3;for(let N=f-2;N>=0;N-=2){let _=h.charAt(N).charCodeAt(0)-48;if(_<0||_>9)throw new O;b+=_}return(1e3-b)%10}static decodeEnd(h,f){return ft.findGuardPattern(h,f,!1,ft.START_END_PATTERN,new Int32Array(ft.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(h,f,b,N){return this.findGuardPattern(h,f,b,N,new Int32Array(N.length))}static findGuardPattern(h,f,b,N,_){let C=h.getSize();f=b?h.getNextUnset(f):h.getNextSet(f);let M=0,L=f,z=N.length,re=b;for(let ue=f;ue<C;ue++)if(h.get(ue)!==re)_[M]++;else{if(M===z-1){if(We.patternMatchVariance(_,N,ft.MAX_INDIVIDUAL_VARIANCE)<ft.MAX_AVG_VARIANCE)return Int32Array.from([L,ue]);L+=_[0]+_[1];let pe=_.slice(2,_.length-1);for(let Se=0;Se<M-1;Se++)_[Se]=pe[Se];_[M-1]=0,_[M]=0,M--}else M++;_[M]=1,re=!re}throw new F}static decodeDigit(h,f,b,N){this.recordPattern(h,b,f);let _=this.MAX_AVG_VARIANCE,C=-1,M=N.length;for(let L=0;L<M;L++){let z=N[L],re=We.patternMatchVariance(f,z,ft.MAX_INDIVIDUAL_VARIANCE);re<_&&(_=re,C=L)}if(C>=0)return C;throw new F}}ft.MAX_AVG_VARIANCE=.48,ft.MAX_INDIVIDUAL_VARIANCE=.7,ft.START_END_PATTERN=Int32Array.from([1,1,1]),ft.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),ft.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ft.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class ce{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(h,f,b){let N=this.decodeRowStringBuffer,_=this.decodeMiddle(f,b,N),C=N.toString(),M=ce.parseExtensionString(C),L=[new Ae((b[0]+b[1])/2,h),new Ae(_,h)],z=new te(C,null,0,L,q.UPC_EAN_EXTENSION,new Date().getTime());return M!=null&&z.putAllMetadata(M),z}decodeMiddle(h,f,b){let N=this.decodeMiddleCounters;N[0]=0,N[1]=0,N[2]=0,N[3]=0;let _=h.getSize(),C=f[1],M=0;for(let z=0;z<5&&C<_;z++){let re=ft.decodeDigit(h,N,C,ft.L_AND_G_PATTERNS);b+=String.fromCharCode(48+re%10);for(let ue of N)C+=ue;re>=10&&(M|=1<<4-z),z!==4&&(C=h.getNextSet(C),C=h.getNextUnset(C))}if(b.length!==5)throw new F;let L=this.determineCheckDigit(M);if(ce.extensionChecksum(b.toString())!==L)throw new F;return C}static extensionChecksum(h){let f=h.length,b=0;for(let N=f-2;N>=0;N-=2)b+=h.charAt(N).charCodeAt(0)-48;b*=3;for(let N=f-1;N>=0;N-=2)b+=h.charAt(N).charCodeAt(0)-48;return b*=3,b%10}determineCheckDigit(h){for(let f=0;f<10;f++)if(h===this.CHECK_DIGIT_ENCODINGS[f])return f;throw new F}static parseExtensionString(h){if(h.length!==5)return null;let f=ce.parseExtension5String(h);return f==null?null:new Map([[X.SUGGESTED_PRICE,f]])}static parseExtension5String(h){let f;switch(h.charAt(0)){case"0":f="";break;case"5":f="$";break;case"9":switch(h){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}f="";break;default:f="";break}let b=parseInt(h.substring(1)),N=(b/100).toString(),_=b%100,C=_<10?"0"+_:_.toString();return f+N+"."+C}}class Ce{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(h,f,b){let N=this.decodeRowStringBuffer,_=this.decodeMiddle(f,b,N),C=N.toString(),M=Ce.parseExtensionString(C),L=[new Ae((b[0]+b[1])/2,h),new Ae(_,h)],z=new te(C,null,0,L,q.UPC_EAN_EXTENSION,new Date().getTime());return M!=null&&z.putAllMetadata(M),z}decodeMiddle(h,f,b){let N=this.decodeMiddleCounters;N[0]=0,N[1]=0,N[2]=0,N[3]=0;let _=h.getSize(),C=f[1],M=0;for(let L=0;L<2&&C<_;L++){let z=ft.decodeDigit(h,N,C,ft.L_AND_G_PATTERNS);b+=String.fromCharCode(48+z%10);for(let re of N)C+=re;z>=10&&(M|=1<<1-L),L!==1&&(C=h.getNextSet(C),C=h.getNextUnset(C))}if(b.length!==2)throw new F;if(parseInt(b.toString())%4!==M)throw new F;return C}static parseExtensionString(h){return h.length!==2?null:new Map([[X.ISSUE_NUMBER,parseInt(h)]])}}class ze{static decodeRow(h,f,b){let N=ft.findGuardPattern(f,b,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new ce().decodeRow(h,f,N)}catch{return new Ce().decodeRow(h,f,N)}}}ze.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Te extends ft{constructor(){super(),this.decodeRowStringBuffer="",Te.L_AND_G_PATTERNS=Te.L_PATTERNS.map(h=>Int32Array.from(h));for(let h=10;h<20;h++){let f=Te.L_PATTERNS[h-10],b=new Int32Array(f.length);for(let N=0;N<f.length;N++)b[N]=f[f.length-N-1];Te.L_AND_G_PATTERNS[h]=b}}decodeRow(h,f,b){let N=Te.findStartGuardPattern(f),_=b==null?null:b.get(P.NEED_RESULT_POINT_CALLBACK);if(_!=null){const wt=new Ae((N[0]+N[1])/2,h);_.foundPossibleResultPoint(wt)}let C=this.decodeMiddle(f,N,this.decodeRowStringBuffer),M=C.rowOffset,L=C.resultString;if(_!=null){const wt=new Ae(M,h);_.foundPossibleResultPoint(wt)}let z=this.decodeEnd(f,M);if(_!=null){const wt=new Ae((z[0]+z[1])/2,h);_.foundPossibleResultPoint(wt)}let re=z[1],ue=re+(re-z[0]);if(ue>=f.getSize()||!f.isRange(re,ue,!1))throw new F;let pe=L.toString();if(pe.length<8)throw new O;if(!Te.checkChecksum(pe))throw new y;let Se=(N[1]+N[0])/2,Ie=(z[1]+z[0])/2,Be=this.getBarcodeFormat(),Xe=[new Ae(Se,h),new Ae(Ie,h)],nt=new te(pe,null,0,Xe,Be,new Date().getTime()),Ct=0;try{let wt=ze.decodeRow(h,f,z[1]);nt.putMetadata(X.UPC_EAN_EXTENSION,wt.getText()),nt.putAllMetadata(wt.getResultMetadata()),nt.addResultPoints(wt.getResultPoints()),Ct=wt.getText().length}catch{}let kt=b==null?null:b.get(P.ALLOWED_EAN_EXTENSIONS);if(kt!=null){let wt=!1;for(let $s in kt)if(Ct.toString()===$s){wt=!0;break}if(!wt)throw new F}return nt}decodeEnd(h,f){return Te.findGuardPattern(h,f,!1,Te.START_END_PATTERN,new Int32Array(Te.START_END_PATTERN.length).fill(0))}static checkChecksum(h){return Te.checkStandardUPCEANChecksum(h)}static checkStandardUPCEANChecksum(h){let f=h.length;if(f===0)return!1;let b=parseInt(h.charAt(f-1),10);return Te.getStandardUPCEANChecksum(h.substring(0,f-1))===b}static getStandardUPCEANChecksum(h){let f=h.length,b=0;for(let N=f-1;N>=0;N-=2){let _=h.charAt(N).charCodeAt(0)-48;if(_<0||_>9)throw new O;b+=_}b*=3;for(let N=f-2;N>=0;N-=2){let _=h.charAt(N).charCodeAt(0)-48;if(_<0||_>9)throw new O;b+=_}return(1e3-b)%10}}class Nt extends Te{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(h,f,b){let N=this.decodeMiddleCounters;N[0]=0,N[1]=0,N[2]=0,N[3]=0;let _=h.getSize(),C=f[1],M=0;for(let z=0;z<6&&C<_;z++){let re=Te.decodeDigit(h,N,C,Te.L_AND_G_PATTERNS);b+=String.fromCharCode(48+re%10);for(let ue of N)C+=ue;re>=10&&(M|=1<<5-z)}b=Nt.determineFirstDigit(b,M),C=Te.findGuardPattern(h,C,!0,Te.MIDDLE_PATTERN,new Int32Array(Te.MIDDLE_PATTERN.length).fill(0))[1];for(let z=0;z<6&&C<_;z++){let re=Te.decodeDigit(h,N,C,Te.L_PATTERNS);b+=String.fromCharCode(48+re);for(let ue of N)C+=ue}return{rowOffset:C,resultString:b}}getBarcodeFormat(){return q.EAN_13}static determineFirstDigit(h,f){for(let b=0;b<10;b++)if(f===this.FIRST_DIGIT_ENCODINGS[b])return h=String.fromCharCode(48+b)+h,h;throw new F}}Nt.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Jt extends Te{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(h,f,b){const N=this.decodeMiddleCounters;N[0]=0,N[1]=0,N[2]=0,N[3]=0;let _=h.getSize(),C=f[1];for(let L=0;L<4&&C<_;L++){let z=Te.decodeDigit(h,N,C,Te.L_PATTERNS);b+=String.fromCharCode(48+z);for(let re of N)C+=re}C=Te.findGuardPattern(h,C,!0,Te.MIDDLE_PATTERN,new Int32Array(Te.MIDDLE_PATTERN.length).fill(0))[1];for(let L=0;L<4&&C<_;L++){let z=Te.decodeDigit(h,N,C,Te.L_PATTERNS);b+=String.fromCharCode(48+z);for(let re of N)C+=re}return{rowOffset:C,resultString:b}}getBarcodeFormat(){return q.EAN_8}}class ke extends Te{constructor(){super(...arguments),this.ean13Reader=new Nt}getBarcodeFormat(){return q.UPC_A}decode(h,f){return this.maybeReturnResult(this.ean13Reader.decode(h))}decodeRow(h,f,b){return this.maybeReturnResult(this.ean13Reader.decodeRow(h,f,b))}decodeMiddle(h,f,b){return this.ean13Reader.decodeMiddle(h,f,b)}maybeReturnResult(h){let f=h.getText();if(f.charAt(0)==="0"){let b=new te(f.substring(1),null,null,h.getResultPoints(),q.UPC_A);return h.getResultMetadata()!=null&&b.putAllMetadata(h.getResultMetadata()),b}else throw new F}reset(){this.ean13Reader.reset()}}class je extends Te{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(h,f,b){const N=this.decodeMiddleCounters.map(z=>z);N[0]=0,N[1]=0,N[2]=0,N[3]=0;const _=h.getSize();let C=f[1],M=0;for(let z=0;z<6&&C<_;z++){const re=je.decodeDigit(h,N,C,je.L_AND_G_PATTERNS);b+=String.fromCharCode(48+re%10);for(let ue of N)C+=ue;re>=10&&(M|=1<<5-z)}let L=je.determineNumSysAndCheckDigit(b,M);return{rowOffset:C,resultString:L}}decodeEnd(h,f){return je.findGuardPatternWithoutCounters(h,f,!0,je.MIDDLE_END_PATTERN)}checkChecksum(h){return Te.checkChecksum(je.convertUPCEtoUPCA(h))}static determineNumSysAndCheckDigit(h,f){for(let b=0;b<=1;b++)for(let N=0;N<10;N++)if(f===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[b][N]){let _=String.fromCharCode(48+b),C=String.fromCharCode(48+N);return _+h+C}throw F.getNotFoundInstance()}getBarcodeFormat(){return q.UPC_E}static convertUPCEtoUPCA(h){const f=h.slice(1,7).split("").map(_=>_.charCodeAt(0)),b=new V;b.append(h.charAt(0));let N=f[5];switch(N){case 0:case 1:case 2:b.appendChars(f,0,2),b.append(N),b.append("0000"),b.appendChars(f,2,3);break;case 3:b.appendChars(f,0,3),b.append("00000"),b.appendChars(f,3,2);break;case 4:b.appendChars(f,0,4),b.append("00000"),b.append(f[4]);break;default:b.appendChars(f,0,5),b.append("0000"),b.append(N);break}return h.length>=8&&b.append(h.charAt(7)),b.toString()}}je.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),je.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ht extends We{constructor(h){super();let f=h==null?null:h.get(P.POSSIBLE_FORMATS),b=[];a(f)?(b.push(new Nt),b.push(new ke),b.push(new Jt),b.push(new je)):(f.indexOf(q.EAN_13)>-1&&b.push(new Nt),f.indexOf(q.UPC_A)>-1&&b.push(new ke),f.indexOf(q.EAN_8)>-1&&b.push(new Jt),f.indexOf(q.UPC_E)>-1&&b.push(new je)),this.readers=b}decodeRow(h,f,b){for(let N of this.readers)try{const _=N.decodeRow(h,f,b),C=_.getBarcodeFormat()===q.EAN_13&&_.getText().charAt(0)==="0",M=b==null?null:b.get(P.POSSIBLE_FORMATS),L=M==null||M.includes(q.UPC_A);if(C&&L){const z=_.getRawBytes(),re=new te(_.getText().substring(1),z,z?z.length:null,_.getResultPoints(),q.UPC_A);return re.putAllMetadata(_.getResultMetadata()),re}return _}catch{}throw new F}reset(){for(let h of this.readers)h.reset()}}class At extends We{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(h,f){for(let b=0;b<f.length;b++)if(We.patternMatchVariance(h,f[b],At.MAX_INDIVIDUAL_VARIANCE)<At.MAX_AVG_VARIANCE)return b;throw new F}static count(h){return fe.sum(new Int32Array(h))}static increment(h,f){let b=0,N=f[0];for(let _=1;_<h.length;_++)f[_]>N&&(N=f[_],b=_);h[b]++}static decrement(h,f){let b=0,N=f[0];for(let _=1;_<h.length;_++)f[_]<N&&(N=f[_],b=_);h[b]--}static isFinderPattern(h){let f=h[0]+h[1],b=f+h[2]+h[3],N=f/b;if(N>=At.MIN_FINDER_PATTERN_RATIO&&N<=At.MAX_FINDER_PATTERN_RATIO){let _=Number.MAX_SAFE_INTEGER,C=Number.MIN_SAFE_INTEGER;for(let M of h)M>C&&(C=M),M<_&&(_=M);return C<10*_}return!1}}At.MAX_AVG_VARIANCE=.2,At.MAX_INDIVIDUAL_VARIANCE=.45,At.MIN_FINDER_PATTERN_RATIO=9.5/12,At.MAX_FINDER_PATTERN_RATIO=12.5/14;class ms{constructor(h,f){this.value=h,this.checksumPortion=f}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(h){if(!(h instanceof ms))return!1;const f=h;return this.value===f.value&&this.checksumPortion===f.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Zt{constructor(h,f,b,N,_){this.value=h,this.startEnd=f,this.value=h,this.startEnd=f,this.resultPoints=new Array,this.resultPoints.push(new Ae(b,_)),this.resultPoints.push(new Ae(N,_))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(h){if(!(h instanceof Zt))return!1;const f=h;return this.value===f.value}hashCode(){return this.value}}class hs{constructor(){}static getRSSvalue(h,f,b){let N=0;for(let L of h)N+=L;let _=0,C=0,M=h.length;for(let L=0;L<M-1;L++){let z;for(z=1,C|=1<<L;z<h[L];z++,C&=~(1<<L)){let re=hs.combins(N-z-1,M-L-2);if(b&&C===0&&N-z-(M-L-1)>=M-L-1&&(re-=hs.combins(N-z-(M-L),M-L-2)),M-L-1>1){let ue=0;for(let pe=N-z-(M-L-2);pe>f;pe--)ue+=hs.combins(N-z-pe-1,M-L-3);re-=ue*(M-1-L)}else N-z>f&&re--;_+=re}N-=z}return _}static combins(h,f){let b,N;h-f>f?(N=f,b=h-f):(N=h-f,b=f);let _=1,C=1;for(let M=h;M>b;M--)_*=M,C<=N&&(_/=C,C++);for(;C<=N;)_/=C,C++;return _}}class Is{static buildBitArray(h){let f=h.length*2-1;h[h.length-1].getRightChar()==null&&(f-=1);let b=12*f,N=new A(b),_=0,M=h[0].getRightChar().getValue();for(let L=11;L>=0;--L)M&1<<L&&N.set(_),_++;for(let L=1;L<h.length;++L){let z=h[L],re=z.getLeftChar().getValue();for(let ue=11;ue>=0;--ue)re&1<<ue&&N.set(_),_++;if(z.getRightChar()!=null){let ue=z.getRightChar().getValue();for(let pe=11;pe>=0;--pe)ue&1<<pe&&N.set(_),_++}}return N}}class _s{constructor(h,f){f?this.decodedInformation=null:(this.finished=h,this.decodedInformation=f)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Sn{constructor(h){this.newPosition=h}getNewPosition(){return this.newPosition}}class tn extends Sn{constructor(h,f){super(h),this.value=f}getValue(){return this.value}isFNC1(){return this.value===tn.FNC1}}tn.FNC1="$";class Ts extends Sn{constructor(h,f,b){super(h),b?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=f}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Cn extends Sn{constructor(h,f,b){if(super(h),f<0||f>10||b<0||b>10)throw new O;this.firstDigit=f,this.secondDigit=b}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Cn.FNC1}isSecondDigitFNC1(){return this.secondDigit===Cn.FNC1}isAnyFNC1(){return this.firstDigit===Cn.FNC1||this.secondDigit===Cn.FNC1}}Cn.FNC1=10;class Pt{constructor(){}static parseFieldsInGeneralPurpose(h){if(!h)return null;if(h.length<2)throw new F;let f=h.substring(0,2);for(let _ of Pt.TWO_DIGIT_DATA_LENGTH)if(_[0]===f)return _[1]===Pt.VARIABLE_LENGTH?Pt.processVariableAI(2,_[2],h):Pt.processFixedAI(2,_[1],h);if(h.length<3)throw new F;let b=h.substring(0,3);for(let _ of Pt.THREE_DIGIT_DATA_LENGTH)if(_[0]===b)return _[1]===Pt.VARIABLE_LENGTH?Pt.processVariableAI(3,_[2],h):Pt.processFixedAI(3,_[1],h);for(let _ of Pt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(_[0]===b)return _[1]===Pt.VARIABLE_LENGTH?Pt.processVariableAI(4,_[2],h):Pt.processFixedAI(4,_[1],h);if(h.length<4)throw new F;let N=h.substring(0,4);for(let _ of Pt.FOUR_DIGIT_DATA_LENGTH)if(_[0]===N)return _[1]===Pt.VARIABLE_LENGTH?Pt.processVariableAI(4,_[2],h):Pt.processFixedAI(4,_[1],h);throw new F}static processFixedAI(h,f,b){if(b.length<h)throw new F;let N=b.substring(0,h);if(b.length<h+f)throw new F;let _=b.substring(h,h+f),C=b.substring(h+f),M="("+N+")"+_,L=Pt.parseFieldsInGeneralPurpose(C);return L==null?M:M+L}static processVariableAI(h,f,b){let N=b.substring(0,h),_;b.length<h+f?_=b.length:_=h+f;let C=b.substring(h,_),M=b.substring(_),L="("+N+")"+C,z=Pt.parseFieldsInGeneralPurpose(M);return z==null?L:L+z}}Pt.VARIABLE_LENGTH=[],Pt.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Pt.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Pt.VARIABLE_LENGTH,20],["22",Pt.VARIABLE_LENGTH,29],["30",Pt.VARIABLE_LENGTH,8],["37",Pt.VARIABLE_LENGTH,8],["90",Pt.VARIABLE_LENGTH,30],["91",Pt.VARIABLE_LENGTH,30],["92",Pt.VARIABLE_LENGTH,30],["93",Pt.VARIABLE_LENGTH,30],["94",Pt.VARIABLE_LENGTH,30],["95",Pt.VARIABLE_LENGTH,30],["96",Pt.VARIABLE_LENGTH,30],["97",Pt.VARIABLE_LENGTH,3],["98",Pt.VARIABLE_LENGTH,30],["99",Pt.VARIABLE_LENGTH,30]],Pt.THREE_DIGIT_DATA_LENGTH=[["240",Pt.VARIABLE_LENGTH,30],["241",Pt.VARIABLE_LENGTH,30],["242",Pt.VARIABLE_LENGTH,6],["250",Pt.VARIABLE_LENGTH,30],["251",Pt.VARIABLE_LENGTH,30],["253",Pt.VARIABLE_LENGTH,17],["254",Pt.VARIABLE_LENGTH,20],["400",Pt.VARIABLE_LENGTH,30],["401",Pt.VARIABLE_LENGTH,30],["402",17],["403",Pt.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Pt.VARIABLE_LENGTH,20],["421",Pt.VARIABLE_LENGTH,15],["422",3],["423",Pt.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Pt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Pt.VARIABLE_LENGTH,15],["391",Pt.VARIABLE_LENGTH,18],["392",Pt.VARIABLE_LENGTH,15],["393",Pt.VARIABLE_LENGTH,18],["703",Pt.VARIABLE_LENGTH,30]],Pt.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Pt.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Pt.VARIABLE_LENGTH,20],["8003",Pt.VARIABLE_LENGTH,30],["8004",Pt.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Pt.VARIABLE_LENGTH,30],["8008",Pt.VARIABLE_LENGTH,12],["8018",18],["8020",Pt.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Pt.VARIABLE_LENGTH,70],["8200",Pt.VARIABLE_LENGTH,70]];class Ea{constructor(h){this.buffer=new V,this.information=h}decodeAllCodes(h,f){let b=f,N=null;do{let _=this.decodeGeneralPurposeField(b,N),C=Pt.parseFieldsInGeneralPurpose(_.getNewString());if(C!=null&&h.append(C),_.isRemaining()?N=""+_.getRemainingValue():N=null,b===_.getNewPosition())break;b=_.getNewPosition()}while(!0);return h.toString()}isStillNumeric(h){if(h+7>this.information.getSize())return h+4<=this.information.getSize();for(let f=h;f<h+3;++f)if(this.information.get(f))return!0;return this.information.get(h+3)}decodeNumeric(h){if(h+7>this.information.getSize()){let _=this.extractNumericValueFromBitArray(h,4);return _===0?new Cn(this.information.getSize(),Cn.FNC1,Cn.FNC1):new Cn(this.information.getSize(),_-1,Cn.FNC1)}let f=this.extractNumericValueFromBitArray(h,7),b=(f-8)/11,N=(f-8)%11;return new Cn(h+7,b,N)}extractNumericValueFromBitArray(h,f){return Ea.extractNumericValueFromBitArray(this.information,h,f)}static extractNumericValueFromBitArray(h,f,b){let N=0;for(let _=0;_<b;++_)h.get(f+_)&&(N|=1<<b-_-1);return N}decodeGeneralPurposeField(h,f){this.buffer.setLengthToZero(),f!=null&&this.buffer.append(f),this.current.setPosition(h);let b=this.parseBlocks();return b!=null&&b.isRemaining()?new Ts(this.current.getPosition(),this.buffer.toString(),b.getRemainingValue()):new Ts(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let h,f;do{let b=this.current.getPosition();if(this.current.isAlpha()?(f=this.parseAlphaBlock(),h=f.isFinished()):this.current.isIsoIec646()?(f=this.parseIsoIec646Block(),h=f.isFinished()):(f=this.parseNumericBlock(),h=f.isFinished()),!(b!==this.current.getPosition())&&!h)break}while(!h);return f.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let h=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(h.getNewPosition()),h.isFirstDigitFNC1()){let f;return h.isSecondDigitFNC1()?f=new Ts(this.current.getPosition(),this.buffer.toString()):f=new Ts(this.current.getPosition(),this.buffer.toString(),h.getSecondDigit()),new _s(!0,f)}if(this.buffer.append(h.getFirstDigit()),h.isSecondDigitFNC1()){let f=new Ts(this.current.getPosition(),this.buffer.toString());return new _s(!0,f)}this.buffer.append(h.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new _s(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let h=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(h.getNewPosition()),h.isFNC1()){let f=new Ts(this.current.getPosition(),this.buffer.toString());return new _s(!0,f)}this.buffer.append(h.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new _s(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let h=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(h.getNewPosition()),h.isFNC1()){let f=new Ts(this.current.getPosition(),this.buffer.toString());return new _s(!0,f)}this.buffer.append(h.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new _s(!1)}isStillIsoIec646(h){if(h+5>this.information.getSize())return!1;let f=this.extractNumericValueFromBitArray(h,5);if(f>=5&&f<16)return!0;if(h+7>this.information.getSize())return!1;let b=this.extractNumericValueFromBitArray(h,7);if(b>=64&&b<116)return!0;if(h+8>this.information.getSize())return!1;let N=this.extractNumericValueFromBitArray(h,8);return N>=232&&N<253}decodeIsoIec646(h){let f=this.extractNumericValueFromBitArray(h,5);if(f===15)return new tn(h+5,tn.FNC1);if(f>=5&&f<15)return new tn(h+5,"0"+(f-5));let b=this.extractNumericValueFromBitArray(h,7);if(b>=64&&b<90)return new tn(h+7,""+(b+1));if(b>=90&&b<116)return new tn(h+7,""+(b+7));let N=this.extractNumericValueFromBitArray(h,8),_;switch(N){case 232:_="!";break;case 233:_='"';break;case 234:_="%";break;case 235:_="&";break;case 236:_="'";break;case 237:_="(";break;case 238:_=")";break;case 239:_="*";break;case 240:_="+";break;case 241:_=",";break;case 242:_="-";break;case 243:_=".";break;case 244:_="/";break;case 245:_=":";break;case 246:_=";";break;case 247:_="<";break;case 248:_="=";break;case 249:_=">";break;case 250:_="?";break;case 251:_="_";break;case 252:_=" ";break;default:throw new O}return new tn(h+8,_)}isStillAlpha(h){if(h+5>this.information.getSize())return!1;let f=this.extractNumericValueFromBitArray(h,5);if(f>=5&&f<16)return!0;if(h+6>this.information.getSize())return!1;let b=this.extractNumericValueFromBitArray(h,6);return b>=16&&b<63}decodeAlphanumeric(h){let f=this.extractNumericValueFromBitArray(h,5);if(f===15)return new tn(h+5,tn.FNC1);if(f>=5&&f<15)return new tn(h+5,"0"+(f-5));let b=this.extractNumericValueFromBitArray(h,6);if(b>=32&&b<58)return new tn(h+6,""+(b+33));let N;switch(b){case 58:N="*";break;case 59:N=",";break;case 60:N="-";break;case 61:N=".";break;case 62:N="/";break;default:throw new me("Decoding invalid alphanumeric value: "+b)}return new tn(h+6,N)}isAlphaTo646ToAlphaLatch(h){if(h+1>this.information.getSize())return!1;for(let f=0;f<5&&f+h<this.information.getSize();++f)if(f===2){if(!this.information.get(h+2))return!1}else if(this.information.get(h+f))return!1;return!0}isAlphaOr646ToNumericLatch(h){if(h+3>this.information.getSize())return!1;for(let f=h;f<h+3;++f)if(this.information.get(f))return!1;return!0}isNumericToAlphaNumericLatch(h){if(h+1>this.information.getSize())return!1;for(let f=0;f<4&&f+h<this.information.getSize();++f)if(this.information.get(h+f))return!1;return!0}}class Rr{constructor(h){this.information=h,this.generalDecoder=new Ea(h)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Jn extends Rr{constructor(h){super(h)}encodeCompressedGtin(h,f){h.append("(01)");let b=h.length();h.append("9"),this.encodeCompressedGtinWithoutAI(h,f,b)}encodeCompressedGtinWithoutAI(h,f,b){for(let N=0;N<4;++N){let _=this.getGeneralDecoder().extractNumericValueFromBitArray(f+10*N,10);_/100===0&&h.append("0"),_/10===0&&h.append("0"),h.append(_)}Jn.appendCheckDigit(h,b)}static appendCheckDigit(h,f){let b=0;for(let N=0;N<13;N++){let _=h.charAt(N+f).charCodeAt(0)-48;b+=N&1?_:3*_}b=10-b%10,b===10&&(b=0),h.append(b)}}Jn.GTIN_SIZE=40;class Zl extends Jn{constructor(h){super(h)}parseInformation(){let h=new V;h.append("(01)");let f=h.length(),b=this.getGeneralDecoder().extractNumericValueFromBitArray(Zl.HEADER_SIZE,4);return h.append(b),this.encodeCompressedGtinWithoutAI(h,Zl.HEADER_SIZE+4,f),this.getGeneralDecoder().decodeAllCodes(h,Zl.HEADER_SIZE+44)}}Zl.HEADER_SIZE=4;class Fi extends Rr{constructor(h){super(h)}parseInformation(){let h=new V;return this.getGeneralDecoder().decodeAllCodes(h,Fi.HEADER_SIZE)}}Fi.HEADER_SIZE=5;class Jl extends Jn{constructor(h){super(h)}encodeCompressedWeight(h,f,b){let N=this.getGeneralDecoder().extractNumericValueFromBitArray(f,b);this.addWeightCode(h,N);let _=this.checkWeight(N),C=1e5;for(let M=0;M<5;++M)_/C===0&&h.append("0"),C/=10;h.append(_)}}class Nr extends Jl{constructor(h){super(h)}parseInformation(){if(this.getInformation().getSize()!=Nr.HEADER_SIZE+Jl.GTIN_SIZE+Nr.WEIGHT_SIZE)throw new F;let h=new V;return this.encodeCompressedGtin(h,Nr.HEADER_SIZE),this.encodeCompressedWeight(h,Nr.HEADER_SIZE+Jl.GTIN_SIZE,Nr.WEIGHT_SIZE),h.toString()}}Nr.HEADER_SIZE=5,Nr.WEIGHT_SIZE=15;class xu extends Nr{constructor(h){super(h)}addWeightCode(h,f){h.append("(3103)")}checkWeight(h){return h}}class pu extends Nr{constructor(h){super(h)}addWeightCode(h,f){f<1e4?h.append("(3202)"):h.append("(3203)")}checkWeight(h){return h<1e4?h:h-1e4}}class Ta extends Jn{constructor(h){super(h)}parseInformation(){if(this.getInformation().getSize()<Ta.HEADER_SIZE+Jn.GTIN_SIZE)throw new F;let h=new V;this.encodeCompressedGtin(h,Ta.HEADER_SIZE);let f=this.getGeneralDecoder().extractNumericValueFromBitArray(Ta.HEADER_SIZE+Jn.GTIN_SIZE,Ta.LAST_DIGIT_SIZE);h.append("(392"),h.append(f),h.append(")");let b=this.getGeneralDecoder().decodeGeneralPurposeField(Ta.HEADER_SIZE+Jn.GTIN_SIZE+Ta.LAST_DIGIT_SIZE,null);return h.append(b.getNewString()),h.toString()}}Ta.HEADER_SIZE=8,Ta.LAST_DIGIT_SIZE=2;class Pn extends Jn{constructor(h){super(h)}parseInformation(){if(this.getInformation().getSize()<Pn.HEADER_SIZE+Jn.GTIN_SIZE)throw new F;let h=new V;this.encodeCompressedGtin(h,Pn.HEADER_SIZE);let f=this.getGeneralDecoder().extractNumericValueFromBitArray(Pn.HEADER_SIZE+Jn.GTIN_SIZE,Pn.LAST_DIGIT_SIZE);h.append("(393"),h.append(f),h.append(")");let b=this.getGeneralDecoder().extractNumericValueFromBitArray(Pn.HEADER_SIZE+Jn.GTIN_SIZE+Pn.LAST_DIGIT_SIZE,Pn.FIRST_THREE_DIGITS_SIZE);b/100==0&&h.append("0"),b/10==0&&h.append("0"),h.append(b);let N=this.getGeneralDecoder().decodeGeneralPurposeField(Pn.HEADER_SIZE+Jn.GTIN_SIZE+Pn.LAST_DIGIT_SIZE+Pn.FIRST_THREE_DIGITS_SIZE,null);return h.append(N.getNewString()),h.toString()}}Pn.HEADER_SIZE=8,Pn.LAST_DIGIT_SIZE=2,Pn.FIRST_THREE_DIGITS_SIZE=10;class Os extends Jl{constructor(h,f,b){super(h),this.dateCode=b,this.firstAIdigits=f}parseInformation(){if(this.getInformation().getSize()!=Os.HEADER_SIZE+Os.GTIN_SIZE+Os.WEIGHT_SIZE+Os.DATE_SIZE)throw new F;let h=new V;return this.encodeCompressedGtin(h,Os.HEADER_SIZE),this.encodeCompressedWeight(h,Os.HEADER_SIZE+Os.GTIN_SIZE,Os.WEIGHT_SIZE),this.encodeCompressedDate(h,Os.HEADER_SIZE+Os.GTIN_SIZE+Os.WEIGHT_SIZE),h.toString()}encodeCompressedDate(h,f){let b=this.getGeneralDecoder().extractNumericValueFromBitArray(f,Os.DATE_SIZE);if(b==38400)return;h.append("("),h.append(this.dateCode),h.append(")");let N=b%32;b/=32;let _=b%12+1;b/=12;let C=b;C/10==0&&h.append("0"),h.append(C),_/10==0&&h.append("0"),h.append(_),N/10==0&&h.append("0"),h.append(N)}addWeightCode(h,f){h.append("("),h.append(this.firstAIdigits),h.append(f/1e5),h.append(")")}checkWeight(h){return h%1e5}}Os.HEADER_SIZE=8,Os.WEIGHT_SIZE=20,Os.DATE_SIZE=16;function bl(de){try{if(de.get(1))return new Zl(de);if(!de.get(2))return new Fi(de);switch(Ea.extractNumericValueFromBitArray(de,1,4)){case 4:return new xu(de);case 5:return new pu(de)}switch(Ea.extractNumericValueFromBitArray(de,1,5)){case 12:return new Ta(de);case 13:return new Pn(de)}switch(Ea.extractNumericValueFromBitArray(de,1,7)){case 56:return new Os(de,"310","11");case 57:return new Os(de,"320","11");case 58:return new Os(de,"310","13");case 59:return new Os(de,"320","13");case 60:return new Os(de,"310","15");case 61:return new Os(de,"320","15");case 62:return new Os(de,"310","17");case 63:return new Os(de,"320","17")}}catch(h){throw console.log(h),new me("unknown decoder: "+de)}}class Za{constructor(h,f,b,N){this.leftchar=h,this.rightchar=f,this.finderpattern=b,this.maybeLast=N}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(h,f){return h instanceof Za?Za.equalsOrNull(h.leftchar,f.leftchar)&&Za.equalsOrNull(h.rightchar,f.rightchar)&&Za.equalsOrNull(h.finderpattern,f.finderpattern):!1}static equalsOrNull(h,f){return h===null?f===null:Za.equals(h,f)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Bo{constructor(h,f,b){this.pairs=h,this.rowNumber=f,this.wasReversed=b}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(h){return this.checkEqualitity(this,h)}toString(){return"{ "+this.pairs+" }"}equals(h,f){return h instanceof Bo?this.checkEqualitity(h,f)&&h.wasReversed===f.wasReversed:!1}checkEqualitity(h,f){if(!h||!f)return;let b;return h.forEach((N,_)=>{f.forEach(C=>{N.getLeftChar().getValue()===C.getLeftChar().getValue()&&N.getRightChar().getValue()===C.getRightChar().getValue()&&N.getFinderPatter().getValue()===C.getFinderPatter().getValue()&&(b=!0)})}),b}}class yt extends At{constructor(h){super(...arguments),this.pairs=new Array(yt.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=h===!0}decodeRow(h,f,b){this.pairs.length=0,this.startFromEven=!1;try{return yt.constructResult(this.decodeRow2pairs(h,f))}catch(N){this.verbose&&console.log(N)}return this.pairs.length=0,this.startFromEven=!0,yt.constructResult(this.decodeRow2pairs(h,f))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(h,f){let b=!1;for(;!b;)try{this.pairs.push(this.retrieveNextPair(f,this.pairs,h))}catch(_){if(_ instanceof F){if(!this.pairs.length)throw new F;b=!0}}if(this.checkChecksum())return this.pairs;let N;if(this.rows.length?N=!0:N=!1,this.storeRow(h,!1),N){let _=this.checkRowsBoolean(!1);if(_!=null||(_=this.checkRowsBoolean(!0),_!=null))return _}throw new F}checkRowsBoolean(h){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,h&&(this.rows=this.rows.reverse());let f=null;try{f=this.checkRows(new Array,0)}catch(b){this.verbose&&console.log(b)}return h&&(this.rows=this.rows.reverse()),f}checkRows(h,f){for(let b=f;b<this.rows.length;b++){let N=this.rows[b];this.pairs.length=0;for(let C of h)this.pairs.push(C.getPairs());if(this.pairs.push(N.getPairs()),!yt.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let _=new Array(h);_.push(N);try{return this.checkRows(_,b+1)}catch(C){this.verbose&&console.log(C)}}throw new F}static isValidSequence(h){for(let f of yt.FINDER_PATTERN_SEQUENCES){if(h.length>f.length)continue;let b=!0;for(let N=0;N<h.length;N++)if(h[N].getFinderPattern().getValue()!=f[N]){b=!1;break}if(b)return!0}return!1}storeRow(h,f){let b=0,N=!1,_=!1;for(;b<this.rows.length;){let C=this.rows[b];if(C.getRowNumber()>h){_=C.isEquivalent(this.pairs);break}N=C.isEquivalent(this.pairs),b++}_||N||yt.isPartialRow(this.pairs,this.rows)||(this.rows.push(b,new Bo(this.pairs,h,f)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(h,f){for(let b of f)if(b.getPairs().length!==h.length){for(let N of b.getPairs())for(let _ of h)if(Za.equals(N,_))break}}static isPartialRow(h,f){for(let b of f){let N=!0;for(let _ of h){let C=!1;for(let M of b.getPairs())if(_.equals(M)){C=!0;break}if(!C){N=!1;break}}if(N)return!0}return!1}getRows(){return this.rows}static constructResult(h){let f=Is.buildBitArray(h),N=bl(f).parseInformation(),_=h[0].getFinderPattern().getResultPoints(),C=h[h.length-1].getFinderPattern().getResultPoints(),M=[_[0],_[1],C[0],C[1]];return new te(N,null,null,M,q.RSS_EXPANDED,null)}checkChecksum(){let h=this.pairs.get(0),f=h.getLeftChar(),b=h.getRightChar();if(b==null)return!1;let N=b.getChecksumPortion(),_=2;for(let M=1;M<this.pairs.size();++M){let L=this.pairs.get(M);N+=L.getLeftChar().getChecksumPortion(),_++;let z=L.getRightChar();z!=null&&(N+=z.getChecksumPortion(),_++)}return N%=211,211*(_-4)+N==f.getValue()}static getNextSecondBar(h,f){let b;return h.get(f)?(b=h.getNextUnset(f),b=h.getNextSet(b)):(b=h.getNextSet(f),b=h.getNextUnset(b)),b}retrieveNextPair(h,f,b){let N=f.length%2==0;this.startFromEven&&(N=!N);let _,C=!0,M=-1;do this.findNextPair(h,f,M),_=this.parseFoundFinderPattern(h,b,N),_==null?M=yt.getNextSecondBar(h,this.startEnd[0]):C=!1;while(C);let L=this.decodeDataCharacter(h,_,N,!0);if(!this.isEmptyPair(f)&&f[f.length-1].mustBeLast())throw new F;let z;try{z=this.decodeDataCharacter(h,_,N,!1)}catch(re){z=null,this.verbose&&console.log(re)}return new Za(L,z,_,!0)}isEmptyPair(h){return h.length===0}findNextPair(h,f,b){let N=this.getDecodeFinderCounters();N[0]=0,N[1]=0,N[2]=0,N[3]=0;let _=h.getSize(),C;b>=0?C=b:this.isEmptyPair(f)?C=0:C=f[f.length-1].getFinderPattern().getStartEnd()[1];let M=f.length%2!=0;this.startFromEven&&(M=!M);let L=!1;for(;C<_&&(L=!h.get(C),!!L);)C++;let z=0,re=C;for(let ue=C;ue<_;ue++)if(h.get(ue)!=L)N[z]++;else{if(z==3){if(M&&yt.reverseCounters(N),yt.isFinderPattern(N)){this.startEnd[0]=re,this.startEnd[1]=ue;return}M&&yt.reverseCounters(N),re+=N[0]+N[1],N[0]=N[2],N[1]=N[3],N[2]=0,N[3]=0,z--}else z++;N[z]=1,L=!L}throw new F}static reverseCounters(h){let f=h.length;for(let b=0;b<f/2;++b){let N=h[b];h[b]=h[f-b-1],h[f-b-1]=N}}parseFoundFinderPattern(h,f,b){let N,_,C;if(b){let z=this.startEnd[0]-1;for(;z>=0&&!h.get(z);)z--;z++,N=this.startEnd[0]-z,_=z,C=this.startEnd[1]}else _=this.startEnd[0],C=h.getNextUnset(this.startEnd[1]+1),N=C-this.startEnd[1];let M=this.getDecodeFinderCounters();j.arraycopy(M,0,M,1,M.length-1),M[0]=N;let L;try{L=this.parseFinderValue(M,yt.FINDER_PATTERNS)}catch{return null}return new Zt(L,[_,C],_,C,f)}decodeDataCharacter(h,f,b,N){let _=this.getDataCharacterCounters();for(let wn=0;wn<_.length;wn++)_[wn]=0;if(N)yt.recordPatternInReverse(h,f.getStartEnd()[0],_);else{yt.recordPattern(h,f.getStartEnd()[1],_);for(let wn=0,Ma=_.length-1;wn<Ma;wn++,Ma--){let vl=_[wn];_[wn]=_[Ma],_[Ma]=vl}}let C=17,M=fe.sum(new Int32Array(_))/C,L=(f.getStartEnd()[1]-f.getStartEnd()[0])/15;if(Math.abs(M-L)/L>.3)throw new F;let z=this.getOddCounts(),re=this.getEvenCounts(),ue=this.getOddRoundingErrors(),pe=this.getEvenRoundingErrors();for(let wn=0;wn<_.length;wn++){let Ma=1*_[wn]/M,vl=Ma+.5;if(vl<1){if(Ma<.3)throw new F;vl=1}else if(vl>8){if(Ma>8.7)throw new F;vl=8}let kx=wn/2;wn&1?(re[kx]=vl,pe[kx]=Ma-vl):(z[kx]=vl,ue[kx]=Ma-vl)}this.adjustOddEvenCounts(C);let Se=4*f.getValue()+(b?0:2)+(N?0:1)-1,Ie=0,Be=0;for(let wn=z.length-1;wn>=0;wn--){if(yt.isNotA1left(f,b,N)){let Ma=yt.WEIGHTS[Se][2*wn];Be+=z[wn]*Ma}Ie+=z[wn]}let Xe=0;for(let wn=re.length-1;wn>=0;wn--)if(yt.isNotA1left(f,b,N)){let Ma=yt.WEIGHTS[Se][2*wn+1];Xe+=re[wn]*Ma}let nt=Be+Xe;if(Ie&1||Ie>13||Ie<4)throw new F;let Ct=(13-Ie)/2,kt=yt.SYMBOL_WIDEST[Ct],wt=9-kt,$s=hs.getRSSvalue(z,kt,!0),Ns=hs.getRSSvalue(re,wt,!1),zi=yt.EVEN_TOTAL_SUBSET[Ct],zo=yt.GSUM[Ct],Ui=$s*zi+Ns+zo;return new ms(Ui,nt)}static isNotA1left(h,f,b){return!(h.getValue()==0&&f&&b)}adjustOddEvenCounts(h){let f=fe.sum(new Int32Array(this.getOddCounts())),b=fe.sum(new Int32Array(this.getEvenCounts())),N=!1,_=!1;f>13?_=!0:f<4&&(N=!0);let C=!1,M=!1;b>13?M=!0:b<4&&(C=!0);let L=f+b-h,z=(f&1)==1,re=(b&1)==0;if(L==1)if(z){if(re)throw new F;_=!0}else{if(!re)throw new F;M=!0}else if(L==-1)if(z){if(re)throw new F;N=!0}else{if(!re)throw new F;C=!0}else if(L==0){if(z){if(!re)throw new F;f<b?(N=!0,M=!0):(_=!0,C=!0)}else if(re)throw new F}else throw new F;if(N){if(_)throw new F;yt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(_&&yt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),C){if(M)throw new F;yt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}M&&yt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}yt.SYMBOL_WIDEST=[7,5,4,3,1],yt.EVEN_TOTAL_SUBSET=[4,20,52,104,204],yt.GSUM=[0,348,1388,2948,3988],yt.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],yt.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],yt.FINDER_PAT_A=0,yt.FINDER_PAT_B=1,yt.FINDER_PAT_C=2,yt.FINDER_PAT_D=3,yt.FINDER_PAT_E=4,yt.FINDER_PAT_F=5,yt.FINDER_PATTERN_SEQUENCES=[[yt.FINDER_PAT_A,yt.FINDER_PAT_A],[yt.FINDER_PAT_A,yt.FINDER_PAT_B,yt.FINDER_PAT_B],[yt.FINDER_PAT_A,yt.FINDER_PAT_C,yt.FINDER_PAT_B,yt.FINDER_PAT_D],[yt.FINDER_PAT_A,yt.FINDER_PAT_E,yt.FINDER_PAT_B,yt.FINDER_PAT_D,yt.FINDER_PAT_C],[yt.FINDER_PAT_A,yt.FINDER_PAT_E,yt.FINDER_PAT_B,yt.FINDER_PAT_D,yt.FINDER_PAT_D,yt.FINDER_PAT_F],[yt.FINDER_PAT_A,yt.FINDER_PAT_E,yt.FINDER_PAT_B,yt.FINDER_PAT_D,yt.FINDER_PAT_E,yt.FINDER_PAT_F,yt.FINDER_PAT_F],[yt.FINDER_PAT_A,yt.FINDER_PAT_A,yt.FINDER_PAT_B,yt.FINDER_PAT_B,yt.FINDER_PAT_C,yt.FINDER_PAT_C,yt.FINDER_PAT_D,yt.FINDER_PAT_D],[yt.FINDER_PAT_A,yt.FINDER_PAT_A,yt.FINDER_PAT_B,yt.FINDER_PAT_B,yt.FINDER_PAT_C,yt.FINDER_PAT_C,yt.FINDER_PAT_D,yt.FINDER_PAT_E,yt.FINDER_PAT_E],[yt.FINDER_PAT_A,yt.FINDER_PAT_A,yt.FINDER_PAT_B,yt.FINDER_PAT_B,yt.FINDER_PAT_C,yt.FINDER_PAT_C,yt.FINDER_PAT_D,yt.FINDER_PAT_E,yt.FINDER_PAT_F,yt.FINDER_PAT_F],[yt.FINDER_PAT_A,yt.FINDER_PAT_A,yt.FINDER_PAT_B,yt.FINDER_PAT_B,yt.FINDER_PAT_C,yt.FINDER_PAT_D,yt.FINDER_PAT_D,yt.FINDER_PAT_E,yt.FINDER_PAT_E,yt.FINDER_PAT_F,yt.FINDER_PAT_F]],yt.MAX_PAIRS=11;class yl extends ms{constructor(h,f,b){super(h,f),this.count=0,this.finderPattern=b}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ln extends At{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(h,f,b){const N=this.decodePair(f,!1,h,b);ln.addOrTally(this.possibleLeftPairs,N),f.reverse();let _=this.decodePair(f,!0,h,b);ln.addOrTally(this.possibleRightPairs,_),f.reverse();for(let C of this.possibleLeftPairs)if(C.getCount()>1){for(let M of this.possibleRightPairs)if(M.getCount()>1&&ln.checkChecksum(C,M))return ln.constructResult(C,M)}throw new F}static addOrTally(h,f){if(f==null)return;let b=!1;for(let N of h)if(N.getValue()===f.getValue()){N.incrementCount(),b=!0;break}b||h.push(f)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(h,f){let b=4537077*h.getValue()+f.getValue(),N=new String(b).toString(),_=new V;for(let z=13-N.length;z>0;z--)_.append("0");_.append(N);let C=0;for(let z=0;z<13;z++){let re=_.charAt(z).charCodeAt(0)-48;C+=z&1?re:3*re}C=10-C%10,C===10&&(C=0),_.append(C.toString());let M=h.getFinderPattern().getResultPoints(),L=f.getFinderPattern().getResultPoints();return new te(_.toString(),null,0,[M[0],M[1],L[0],L[1]],q.RSS_14,new Date().getTime())}static checkChecksum(h,f){let b=(h.getChecksumPortion()+16*f.getChecksumPortion())%79,N=9*h.getFinderPattern().getValue()+f.getFinderPattern().getValue();return N>72&&N--,N>8&&N--,b===N}decodePair(h,f,b,N){try{let _=this.findFinderPattern(h,f),C=this.parseFoundFinderPattern(h,b,f,_),M=N==null?null:N.get(P.NEED_RESULT_POINT_CALLBACK);if(M!=null){let re=(_[0]+_[1])/2;f&&(re=h.getSize()-1-re),M.foundPossibleResultPoint(new Ae(re,b))}let L=this.decodeDataCharacter(h,C,!0),z=this.decodeDataCharacter(h,C,!1);return new yl(1597*L.getValue()+z.getValue(),L.getChecksumPortion()+4*z.getChecksumPortion(),C)}catch{return null}}decodeDataCharacter(h,f,b){let N=this.getDataCharacterCounters();for(let Xe=0;Xe<N.length;Xe++)N[Xe]=0;if(b)We.recordPatternInReverse(h,f.getStartEnd()[0],N);else{We.recordPattern(h,f.getStartEnd()[1]+1,N);for(let Xe=0,nt=N.length-1;Xe<nt;Xe++,nt--){let Ct=N[Xe];N[Xe]=N[nt],N[nt]=Ct}}let _=b?16:15,C=fe.sum(new Int32Array(N))/_,M=this.getOddCounts(),L=this.getEvenCounts(),z=this.getOddRoundingErrors(),re=this.getEvenRoundingErrors();for(let Xe=0;Xe<N.length;Xe++){let nt=N[Xe]/C,Ct=Math.floor(nt+.5);Ct<1?Ct=1:Ct>8&&(Ct=8);let kt=Math.floor(Xe/2);Xe&1?(L[kt]=Ct,re[kt]=nt-Ct):(M[kt]=Ct,z[kt]=nt-Ct)}this.adjustOddEvenCounts(b,_);let ue=0,pe=0;for(let Xe=M.length-1;Xe>=0;Xe--)pe*=9,pe+=M[Xe],ue+=M[Xe];let Se=0,Ie=0;for(let Xe=L.length-1;Xe>=0;Xe--)Se*=9,Se+=L[Xe],Ie+=L[Xe];let Be=pe+3*Se;if(b){if(ue&1||ue>12||ue<4)throw new F;let Xe=(12-ue)/2,nt=ln.OUTSIDE_ODD_WIDEST[Xe],Ct=9-nt,kt=hs.getRSSvalue(M,nt,!1),wt=hs.getRSSvalue(L,Ct,!0),$s=ln.OUTSIDE_EVEN_TOTAL_SUBSET[Xe],Ns=ln.OUTSIDE_GSUM[Xe];return new ms(kt*$s+wt+Ns,Be)}else{if(Ie&1||Ie>10||Ie<4)throw new F;let Xe=(10-Ie)/2,nt=ln.INSIDE_ODD_WIDEST[Xe],Ct=9-nt,kt=hs.getRSSvalue(M,nt,!0),wt=hs.getRSSvalue(L,Ct,!1),$s=ln.INSIDE_ODD_TOTAL_SUBSET[Xe],Ns=ln.INSIDE_GSUM[Xe];return new ms(wt*$s+kt+Ns,Be)}}findFinderPattern(h,f){let b=this.getDecodeFinderCounters();b[0]=0,b[1]=0,b[2]=0,b[3]=0;let N=h.getSize(),_=!1,C=0;for(;C<N&&(_=!h.get(C),f!==_);)C++;let M=0,L=C;for(let z=C;z<N;z++)if(h.get(z)!==_)b[M]++;else{if(M===3){if(At.isFinderPattern(b))return[L,z];L+=b[0]+b[1],b[0]=b[2],b[1]=b[3],b[2]=0,b[3]=0,M--}else M++;b[M]=1,_=!_}throw new F}parseFoundFinderPattern(h,f,b,N){let _=h.get(N[0]),C=N[0]-1;for(;C>=0&&_!==h.get(C);)C--;C++;const M=N[0]-C,L=this.getDecodeFinderCounters(),z=new Int32Array(L.length);j.arraycopy(L,0,z,1,L.length-1),z[0]=M;const re=this.parseFinderValue(z,ln.FINDER_PATTERNS);let ue=C,pe=N[1];return b&&(ue=h.getSize()-1-ue,pe=h.getSize()-1-pe),new Zt(re,[C,N[1]],ue,pe,f)}adjustOddEvenCounts(h,f){let b=fe.sum(new Int32Array(this.getOddCounts())),N=fe.sum(new Int32Array(this.getEvenCounts())),_=!1,C=!1,M=!1,L=!1;h?(b>12?C=!0:b<4&&(_=!0),N>12?L=!0:N<4&&(M=!0)):(b>11?C=!0:b<5&&(_=!0),N>10?L=!0:N<4&&(M=!0));let z=b+N-f,re=(b&1)===(h?1:0),ue=(N&1)===1;if(z===1)if(re){if(ue)throw new F;C=!0}else{if(!ue)throw new F;L=!0}else if(z===-1)if(re){if(ue)throw new F;_=!0}else{if(!ue)throw new F;M=!0}else if(z===0){if(re){if(!ue)throw new F;b<N?(_=!0,L=!0):(C=!0,M=!0)}else if(ue)throw new F}else throw new F;if(_){if(C)throw new F;At.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(C&&At.decrement(this.getOddCounts(),this.getOddRoundingErrors()),M){if(L)throw new F;At.increment(this.getEvenCounts(),this.getOddRoundingErrors())}L&&At.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ln.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ln.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ln.OUTSIDE_GSUM=[0,161,961,2015,2715],ln.INSIDE_GSUM=[0,336,1036,1516],ln.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ln.INSIDE_ODD_WIDEST=[2,4,6,8],ln.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class wr extends We{constructor(h,f){super(),this.readers=[],this.verbose=f===!0;const b=h?h.get(P.POSSIBLE_FORMATS):null,N=h&&h.get(P.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;b?((b.includes(q.EAN_13)||b.includes(q.UPC_A)||b.includes(q.EAN_8)||b.includes(q.UPC_E))&&this.readers.push(new ht(h)),b.includes(q.CODE_39)&&this.readers.push(new Fe(N)),b.includes(q.CODE_128)&&this.readers.push(new Ve),b.includes(q.ITF)&&this.readers.push(new ot),b.includes(q.RSS_14)&&this.readers.push(new ln),b.includes(q.RSS_EXPANDED)&&this.readers.push(new yt(this.verbose))):(this.readers.push(new ht(h)),this.readers.push(new Fe),this.readers.push(new ht(h)),this.readers.push(new Ve),this.readers.push(new ot),this.readers.push(new ln),this.readers.push(new yt(this.verbose)))}decodeRow(h,f,b){for(let N=0;N<this.readers.length;N++)try{return this.readers[N].decodeRow(h,f,b)}catch{}throw new F}reset(){this.readers.forEach(h=>h.reset())}}class Nc extends ie{constructor(h=500,f){super(new wr(f),h,f)}}class Ss{constructor(h,f,b){this.ecCodewords=h,this.ecBlocks=[f],b&&this.ecBlocks.push(b)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class bs{constructor(h,f){this.count=h,this.dataCodewords=f}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class vs{constructor(h,f,b,N,_,C){this.versionNumber=h,this.symbolSizeRows=f,this.symbolSizeColumns=b,this.dataRegionSizeRows=N,this.dataRegionSizeColumns=_,this.ecBlocks=C;let M=0;const L=C.getECCodewords(),z=C.getECBlocks();for(let re of z)M+=re.getCount()*(re.getDataCodewords()+L);this.totalCodewords=M}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(h,f){if(h&1||f&1)throw new O;for(let b of vs.VERSIONS)if(b.symbolSizeRows===h&&b.symbolSizeColumns===f)return b;throw new O}toString(){return""+this.versionNumber}static buildVersions(){return[new vs(1,10,10,8,8,new Ss(5,new bs(1,3))),new vs(2,12,12,10,10,new Ss(7,new bs(1,5))),new vs(3,14,14,12,12,new Ss(10,new bs(1,8))),new vs(4,16,16,14,14,new Ss(12,new bs(1,12))),new vs(5,18,18,16,16,new Ss(14,new bs(1,18))),new vs(6,20,20,18,18,new Ss(18,new bs(1,22))),new vs(7,22,22,20,20,new Ss(20,new bs(1,30))),new vs(8,24,24,22,22,new Ss(24,new bs(1,36))),new vs(9,26,26,24,24,new Ss(28,new bs(1,44))),new vs(10,32,32,14,14,new Ss(36,new bs(1,62))),new vs(11,36,36,16,16,new Ss(42,new bs(1,86))),new vs(12,40,40,18,18,new Ss(48,new bs(1,114))),new vs(13,44,44,20,20,new Ss(56,new bs(1,144))),new vs(14,48,48,22,22,new Ss(68,new bs(1,174))),new vs(15,52,52,24,24,new Ss(42,new bs(2,102))),new vs(16,64,64,14,14,new Ss(56,new bs(2,140))),new vs(17,72,72,16,16,new Ss(36,new bs(4,92))),new vs(18,80,80,18,18,new Ss(48,new bs(4,114))),new vs(19,88,88,20,20,new Ss(56,new bs(4,144))),new vs(20,96,96,22,22,new Ss(68,new bs(4,174))),new vs(21,104,104,24,24,new Ss(56,new bs(6,136))),new vs(22,120,120,18,18,new Ss(68,new bs(6,175))),new vs(23,132,132,20,20,new Ss(62,new bs(8,163))),new vs(24,144,144,22,22,new Ss(62,new bs(8,156),new bs(2,155))),new vs(25,8,18,6,16,new Ss(7,new bs(1,5))),new vs(26,8,32,6,14,new Ss(11,new bs(1,10))),new vs(27,12,26,10,24,new Ss(14,new bs(1,16))),new vs(28,12,36,10,16,new Ss(18,new bs(1,22))),new vs(29,16,36,14,16,new Ss(24,new bs(1,32))),new vs(30,16,48,14,22,new Ss(28,new bs(1,49)))]}}vs.VERSIONS=vs.buildVersions();class Ne{constructor(h){const f=h.getHeight();if(f<8||f>144||f&1)throw new O;this.version=Ne.readVersion(h),this.mappingBitMatrix=this.extractDataRegion(h),this.readMappingMatrix=new R(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(h){const f=h.getHeight(),b=h.getWidth();return vs.getVersionForDimensions(f,b)}readCodewords(){const h=new Int8Array(this.version.getTotalCodewords());let f=0,b=4,N=0;const _=this.mappingBitMatrix.getHeight(),C=this.mappingBitMatrix.getWidth();let M=!1,L=!1,z=!1,re=!1;do if(b===_&&N===0&&!M)h[f++]=this.readCorner1(_,C)&255,b-=2,N+=2,M=!0;else if(b===_-2&&N===0&&C&3&&!L)h[f++]=this.readCorner2(_,C)&255,b-=2,N+=2,L=!0;else if(b===_+4&&N===2&&!(C&7)&&!z)h[f++]=this.readCorner3(_,C)&255,b-=2,N+=2,z=!0;else if(b===_-2&&N===0&&(C&7)===4&&!re)h[f++]=this.readCorner4(_,C)&255,b-=2,N+=2,re=!0;else{do b<_&&N>=0&&!this.readMappingMatrix.get(N,b)&&(h[f++]=this.readUtah(b,N,_,C)&255),b-=2,N+=2;while(b>=0&&N<C);b+=1,N+=3;do b>=0&&N<C&&!this.readMappingMatrix.get(N,b)&&(h[f++]=this.readUtah(b,N,_,C)&255),b+=2,N-=2;while(b<_&&N>=0);b+=3,N+=1}while(b<_||N<C);if(f!==this.version.getTotalCodewords())throw new O;return h}readModule(h,f,b,N){return h<0&&(h+=b,f+=4-(b+4&7)),f<0&&(f+=N,h+=4-(N+4&7)),this.readMappingMatrix.set(f,h),this.mappingBitMatrix.get(f,h)}readUtah(h,f,b,N){let _=0;return this.readModule(h-2,f-2,b,N)&&(_|=1),_<<=1,this.readModule(h-2,f-1,b,N)&&(_|=1),_<<=1,this.readModule(h-1,f-2,b,N)&&(_|=1),_<<=1,this.readModule(h-1,f-1,b,N)&&(_|=1),_<<=1,this.readModule(h-1,f,b,N)&&(_|=1),_<<=1,this.readModule(h,f-2,b,N)&&(_|=1),_<<=1,this.readModule(h,f-1,b,N)&&(_|=1),_<<=1,this.readModule(h,f,b,N)&&(_|=1),_}readCorner1(h,f){let b=0;return this.readModule(h-1,0,h,f)&&(b|=1),b<<=1,this.readModule(h-1,1,h,f)&&(b|=1),b<<=1,this.readModule(h-1,2,h,f)&&(b|=1),b<<=1,this.readModule(0,f-2,h,f)&&(b|=1),b<<=1,this.readModule(0,f-1,h,f)&&(b|=1),b<<=1,this.readModule(1,f-1,h,f)&&(b|=1),b<<=1,this.readModule(2,f-1,h,f)&&(b|=1),b<<=1,this.readModule(3,f-1,h,f)&&(b|=1),b}readCorner2(h,f){let b=0;return this.readModule(h-3,0,h,f)&&(b|=1),b<<=1,this.readModule(h-2,0,h,f)&&(b|=1),b<<=1,this.readModule(h-1,0,h,f)&&(b|=1),b<<=1,this.readModule(0,f-4,h,f)&&(b|=1),b<<=1,this.readModule(0,f-3,h,f)&&(b|=1),b<<=1,this.readModule(0,f-2,h,f)&&(b|=1),b<<=1,this.readModule(0,f-1,h,f)&&(b|=1),b<<=1,this.readModule(1,f-1,h,f)&&(b|=1),b}readCorner3(h,f){let b=0;return this.readModule(h-1,0,h,f)&&(b|=1),b<<=1,this.readModule(h-1,f-1,h,f)&&(b|=1),b<<=1,this.readModule(0,f-3,h,f)&&(b|=1),b<<=1,this.readModule(0,f-2,h,f)&&(b|=1),b<<=1,this.readModule(0,f-1,h,f)&&(b|=1),b<<=1,this.readModule(1,f-3,h,f)&&(b|=1),b<<=1,this.readModule(1,f-2,h,f)&&(b|=1),b<<=1,this.readModule(1,f-1,h,f)&&(b|=1),b}readCorner4(h,f){let b=0;return this.readModule(h-3,0,h,f)&&(b|=1),b<<=1,this.readModule(h-2,0,h,f)&&(b|=1),b<<=1,this.readModule(h-1,0,h,f)&&(b|=1),b<<=1,this.readModule(0,f-2,h,f)&&(b|=1),b<<=1,this.readModule(0,f-1,h,f)&&(b|=1),b<<=1,this.readModule(1,f-1,h,f)&&(b|=1),b<<=1,this.readModule(2,f-1,h,f)&&(b|=1),b<<=1,this.readModule(3,f-1,h,f)&&(b|=1),b}extractDataRegion(h){const f=this.version.getSymbolSizeRows(),b=this.version.getSymbolSizeColumns();if(h.getHeight()!==f)throw new x("Dimension of bitMatrix must match the version size");const N=this.version.getDataRegionSizeRows(),_=this.version.getDataRegionSizeColumns(),C=f/N|0,M=b/_|0,L=C*N,z=M*_,re=new R(z,L);for(let ue=0;ue<C;++ue){const pe=ue*N;for(let Se=0;Se<M;++Se){const Ie=Se*_;for(let Be=0;Be<N;++Be){const Xe=ue*(N+2)+1+Be,nt=pe+Be;for(let Ct=0;Ct<_;++Ct){const kt=Se*(_+2)+1+Ct;if(h.get(kt,Xe)){const wt=Ie+Ct;re.set(wt,nt)}}}}}return re}}class ut{constructor(h,f){this.numDataCodewords=h,this.codewords=f}static getDataBlocks(h,f){const b=f.getECBlocks();let N=0;const _=b.getECBlocks();for(let Be of _)N+=Be.getCount();const C=new Array(N);let M=0;for(let Be of _)for(let Xe=0;Xe<Be.getCount();Xe++){const nt=Be.getDataCodewords(),Ct=b.getECCodewords()+nt;C[M++]=new ut(nt,new Uint8Array(Ct))}const z=C[0].codewords.length-b.getECCodewords(),re=z-1;let ue=0;for(let Be=0;Be<re;Be++)for(let Xe=0;Xe<M;Xe++)C[Xe].codewords[Be]=h[ue++];const pe=f.getVersionNumber()===24,Se=pe?8:M;for(let Be=0;Be<Se;Be++)C[Be].codewords[z-1]=h[ue++];const Ie=C[0].codewords.length;for(let Be=z;Be<Ie;Be++)for(let Xe=0;Xe<M;Xe++){const nt=pe?(Xe+8)%M:Xe,Ct=pe&&nt>7?Be-1:Be;C[nt].codewords[Ct]=h[ue++]}if(ue!==h.length)throw new x;return C}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Ft{constructor(h){this.bytes=h,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(h){if(h<1||h>32||h>this.available())throw new x(""+h);let f=0,b=this.bitOffset,N=this.byteOffset;const _=this.bytes;if(b>0){const C=8-b,M=h<C?h:C,L=C-M,z=255>>8-M<<L;f=(_[N]&z)>>L,h-=M,b+=M,b===8&&(b=0,N++)}if(h>0){for(;h>=8;)f=f<<8|_[N]&255,N++,h-=8;if(h>0){const C=8-h,M=255>>C<<C;f=f<<h|(_[N]&M)>>C,b+=h}}return this.bitOffset=b,this.byteOffset=N,f}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Vt;(function(de){de[de.PAD_ENCODE=0]="PAD_ENCODE",de[de.ASCII_ENCODE=1]="ASCII_ENCODE",de[de.C40_ENCODE=2]="C40_ENCODE",de[de.TEXT_ENCODE=3]="TEXT_ENCODE",de[de.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",de[de.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",de[de.BASE256_ENCODE=6]="BASE256_ENCODE"})(Vt||(Vt={}));class Cs{static decode(h){const f=new Ft(h),b=new V,N=new V,_=new Array;let C=Vt.ASCII_ENCODE;do if(C===Vt.ASCII_ENCODE)C=this.decodeAsciiSegment(f,b,N);else{switch(C){case Vt.C40_ENCODE:this.decodeC40Segment(f,b);break;case Vt.TEXT_ENCODE:this.decodeTextSegment(f,b);break;case Vt.ANSIX12_ENCODE:this.decodeAnsiX12Segment(f,b);break;case Vt.EDIFACT_ENCODE:this.decodeEdifactSegment(f,b);break;case Vt.BASE256_ENCODE:this.decodeBase256Segment(f,b,_);break;default:throw new O}C=Vt.ASCII_ENCODE}while(C!==Vt.PAD_ENCODE&&f.available()>0);return N.length()>0&&b.append(N.toString()),new Z(h,b.toString(),_.length===0?null:_,null)}static decodeAsciiSegment(h,f,b){let N=!1;do{let _=h.readBits(8);if(_===0)throw new O;if(_<=128)return N&&(_+=128),f.append(String.fromCharCode(_-1)),Vt.ASCII_ENCODE;if(_===129)return Vt.PAD_ENCODE;if(_<=229){const C=_-130;C<10&&f.append("0"),f.append(""+C)}else switch(_){case 230:return Vt.C40_ENCODE;case 231:return Vt.BASE256_ENCODE;case 232:f.append("");break;case 233:case 234:break;case 235:N=!0;break;case 236:f.append("[)>05"),b.insert(0,"");break;case 237:f.append("[)>06"),b.insert(0,"");break;case 238:return Vt.ANSIX12_ENCODE;case 239:return Vt.TEXT_ENCODE;case 240:return Vt.EDIFACT_ENCODE;case 241:break;default:if(_!==254||h.available()!==0)throw new O;break}}while(h.available()>0);return Vt.ASCII_ENCODE}static decodeC40Segment(h,f){let b=!1;const N=[];let _=0;do{if(h.available()===8)return;const C=h.readBits(8);if(C===254)return;this.parseTwoBytes(C,h.readBits(8),N);for(let M=0;M<3;M++){const L=N[M];switch(_){case 0:if(L<3)_=L+1;else if(L<this.C40_BASIC_SET_CHARS.length){const z=this.C40_BASIC_SET_CHARS[L];b?(f.append(String.fromCharCode(z.charCodeAt(0)+128)),b=!1):f.append(z)}else throw new O;break;case 1:b?(f.append(String.fromCharCode(L+128)),b=!1):f.append(String.fromCharCode(L)),_=0;break;case 2:if(L<this.C40_SHIFT2_SET_CHARS.length){const z=this.C40_SHIFT2_SET_CHARS[L];b?(f.append(String.fromCharCode(z.charCodeAt(0)+128)),b=!1):f.append(z)}else switch(L){case 27:f.append("");break;case 30:b=!0;break;default:throw new O}_=0;break;case 3:b?(f.append(String.fromCharCode(L+224)),b=!1):f.append(String.fromCharCode(L+96)),_=0;break;default:throw new O}}}while(h.available()>0)}static decodeTextSegment(h,f){let b=!1,N=[],_=0;do{if(h.available()===8)return;const C=h.readBits(8);if(C===254)return;this.parseTwoBytes(C,h.readBits(8),N);for(let M=0;M<3;M++){const L=N[M];switch(_){case 0:if(L<3)_=L+1;else if(L<this.TEXT_BASIC_SET_CHARS.length){const z=this.TEXT_BASIC_SET_CHARS[L];b?(f.append(String.fromCharCode(z.charCodeAt(0)+128)),b=!1):f.append(z)}else throw new O;break;case 1:b?(f.append(String.fromCharCode(L+128)),b=!1):f.append(String.fromCharCode(L)),_=0;break;case 2:if(L<this.TEXT_SHIFT2_SET_CHARS.length){const z=this.TEXT_SHIFT2_SET_CHARS[L];b?(f.append(String.fromCharCode(z.charCodeAt(0)+128)),b=!1):f.append(z)}else switch(L){case 27:f.append("");break;case 30:b=!0;break;default:throw new O}_=0;break;case 3:if(L<this.TEXT_SHIFT3_SET_CHARS.length){const z=this.TEXT_SHIFT3_SET_CHARS[L];b?(f.append(String.fromCharCode(z.charCodeAt(0)+128)),b=!1):f.append(z),_=0}else throw new O;break;default:throw new O}}}while(h.available()>0)}static decodeAnsiX12Segment(h,f){const b=[];do{if(h.available()===8)return;const N=h.readBits(8);if(N===254)return;this.parseTwoBytes(N,h.readBits(8),b);for(let _=0;_<3;_++){const C=b[_];switch(C){case 0:f.append("\r");break;case 1:f.append("*");break;case 2:f.append(">");break;case 3:f.append(" ");break;default:if(C<14)f.append(String.fromCharCode(C+44));else if(C<40)f.append(String.fromCharCode(C+51));else throw new O;break}}}while(h.available()>0)}static parseTwoBytes(h,f,b){let N=(h<<8)+f-1,_=Math.floor(N/1600);b[0]=_,N-=_*1600,_=Math.floor(N/40),b[1]=_,b[2]=N-_*40}static decodeEdifactSegment(h,f){do{if(h.available()<=16)return;for(let b=0;b<4;b++){let N=h.readBits(6);if(N===31){const _=8-h.getBitOffset();_!==8&&h.readBits(_);return}N&32||(N|=64),f.append(String.fromCharCode(N))}}while(h.available()>0)}static decodeBase256Segment(h,f,b){let N=1+h.getByteOffset();const _=this.unrandomize255State(h.readBits(8),N++);let C;if(_===0?C=h.available()/8|0:_<250?C=_:C=250*(_-249)+this.unrandomize255State(h.readBits(8),N++),C<0)throw new O;const M=new Uint8Array(C);for(let L=0;L<C;L++){if(h.available()<8)throw new O;M[L]=this.unrandomize255State(h.readBits(8),N++)}b.push(M);try{f.append(U.decode(M,W.ISO88591))}catch(L){throw new me("Platform does not support required encoding: "+L.message)}}static unrandomize255State(h,f){const b=149*f%255+1,N=h-b;return N>=0?N:N+256}}Cs.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Cs.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Cs.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Cs.TEXT_SHIFT2_SET_CHARS=Cs.C40_SHIFT2_SET_CHARS,Cs.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class zn{constructor(){this.rsDecoder=new Re(_e.DATA_MATRIX_FIELD_256)}decode(h){const f=new Ne(h),b=f.getVersion(),N=f.readCodewords(),_=ut.getDataBlocks(N,b);let C=0;for(let z of _)C+=z.getNumDataCodewords();const M=new Uint8Array(C),L=_.length;for(let z=0;z<L;z++){const re=_[z],ue=re.getCodewords(),pe=re.getNumDataCodewords();this.correctErrors(ue,pe);for(let Se=0;Se<pe;Se++)M[Se*L+z]=ue[Se]}return Cs.decode(M)}correctErrors(h,f){const b=new Int32Array(h);try{this.rsDecoder.decode(b,h.length-f)}catch{throw new y}for(let N=0;N<f;N++)h[N]=b[N]}}class Rs{constructor(h){this.image=h,this.rectangleDetector=new He(this.image)}detect(){const h=this.rectangleDetector.detect();let f=this.detectSolid1(h);if(f=this.detectSolid2(f),f[3]=this.correctTopRight(f),!f[3])throw new F;f=this.shiftToModuleCenter(f);const b=f[0],N=f[1],_=f[2],C=f[3];let M=this.transitionsBetween(b,C)+1,L=this.transitionsBetween(_,C)+1;(M&1)===1&&(M+=1),(L&1)===1&&(L+=1),4*M<7*L&&4*L<7*M&&(M=L=Math.max(M,L));let z=Rs.sampleGrid(this.image,b,N,_,C,M,L);return new Ke(z,[b,N,_,C])}static shiftPoint(h,f,b){let N=(f.getX()-h.getX())/(b+1),_=(f.getY()-h.getY())/(b+1);return new Ae(h.getX()+N,h.getY()+_)}static moveAway(h,f,b){let N=h.getX(),_=h.getY();return N<f?N-=1:N+=1,_<b?_-=1:_+=1,new Ae(N,_)}detectSolid1(h){let f=h[0],b=h[1],N=h[3],_=h[2],C=this.transitionsBetween(f,b),M=this.transitionsBetween(b,N),L=this.transitionsBetween(N,_),z=this.transitionsBetween(_,f),re=C,ue=[_,f,b,N];return re>M&&(re=M,ue[0]=f,ue[1]=b,ue[2]=N,ue[3]=_),re>L&&(re=L,ue[0]=b,ue[1]=N,ue[2]=_,ue[3]=f),re>z&&(ue[0]=N,ue[1]=_,ue[2]=f,ue[3]=b),ue}detectSolid2(h){let f=h[0],b=h[1],N=h[2],_=h[3],C=this.transitionsBetween(f,_),M=Rs.shiftPoint(b,N,(C+1)*4),L=Rs.shiftPoint(N,b,(C+1)*4),z=this.transitionsBetween(M,f),re=this.transitionsBetween(L,_);return z<re?(h[0]=f,h[1]=b,h[2]=N,h[3]=_):(h[0]=b,h[1]=N,h[2]=_,h[3]=f),h}correctTopRight(h){let f=h[0],b=h[1],N=h[2],_=h[3],C=this.transitionsBetween(f,_),M=this.transitionsBetween(b,_),L=Rs.shiftPoint(f,b,(M+1)*4),z=Rs.shiftPoint(N,b,(C+1)*4);C=this.transitionsBetween(L,_),M=this.transitionsBetween(z,_);let re=new Ae(_.getX()+(N.getX()-b.getX())/(C+1),_.getY()+(N.getY()-b.getY())/(C+1)),ue=new Ae(_.getX()+(f.getX()-b.getX())/(M+1),_.getY()+(f.getY()-b.getY())/(M+1));if(!this.isValid(re))return this.isValid(ue)?ue:null;if(!this.isValid(ue))return re;let pe=this.transitionsBetween(L,re)+this.transitionsBetween(z,re),Se=this.transitionsBetween(L,ue)+this.transitionsBetween(z,ue);return pe>Se?re:ue}shiftToModuleCenter(h){let f=h[0],b=h[1],N=h[2],_=h[3],C=this.transitionsBetween(f,_)+1,M=this.transitionsBetween(N,_)+1,L=Rs.shiftPoint(f,b,M*4),z=Rs.shiftPoint(N,b,C*4);C=this.transitionsBetween(L,_)+1,M=this.transitionsBetween(z,_)+1,(C&1)===1&&(C+=1),(M&1)===1&&(M+=1);let re=(f.getX()+b.getX()+N.getX()+_.getX())/4,ue=(f.getY()+b.getY()+N.getY()+_.getY())/4;f=Rs.moveAway(f,re,ue),b=Rs.moveAway(b,re,ue),N=Rs.moveAway(N,re,ue),_=Rs.moveAway(_,re,ue);let pe,Se;return L=Rs.shiftPoint(f,b,M*4),L=Rs.shiftPoint(L,_,C*4),pe=Rs.shiftPoint(b,f,M*4),pe=Rs.shiftPoint(pe,N,C*4),z=Rs.shiftPoint(N,_,M*4),z=Rs.shiftPoint(z,b,C*4),Se=Rs.shiftPoint(_,N,M*4),Se=Rs.shiftPoint(Se,f,C*4),[L,pe,z,Se]}isValid(h){return h.getX()>=0&&h.getX()<this.image.getWidth()&&h.getY()>0&&h.getY()<this.image.getHeight()}static sampleGrid(h,f,b,N,_,C,M){return It.getInstance().sampleGrid(h,C,M,.5,.5,C-.5,.5,C-.5,M-.5,.5,M-.5,f.getX(),f.getY(),_.getX(),_.getY(),N.getX(),N.getY(),b.getX(),b.getY())}transitionsBetween(h,f){let b=Math.trunc(h.getX()),N=Math.trunc(h.getY()),_=Math.trunc(f.getX()),C=Math.trunc(f.getY()),M=Math.abs(C-N)>Math.abs(_-b);if(M){let Be=b;b=N,N=Be,Be=_,_=C,C=Be}let L=Math.abs(_-b),z=Math.abs(C-N),re=-L/2,ue=N<C?1:-1,pe=b<_?1:-1,Se=0,Ie=this.image.get(M?N:b,M?b:N);for(let Be=b,Xe=N;Be!==_;Be+=pe){let nt=this.image.get(M?Xe:Be,M?Be:Xe);if(nt!==Ie&&(Se++,Ie=nt),re+=z,re>0){if(Xe===C)break;Xe+=ue,re-=L}}return Se}}class gi{constructor(){this.decoder=new zn}decode(h,f=null){let b,N;if(f!=null&&f.has(P.PURE_BARCODE)){const z=gi.extractPureBits(h.getBlackMatrix());b=this.decoder.decode(z),N=gi.NO_POINTS}else{const z=new Rs(h.getBlackMatrix()).detect();b=this.decoder.decode(z.getBits()),N=z.getPoints()}const _=b.getRawBytes(),C=new te(b.getText(),_,8*_.length,N,q.DATA_MATRIX,j.currentTimeMillis()),M=b.getByteSegments();M!=null&&C.putMetadata(X.BYTE_SEGMENTS,M);const L=b.getECLevel();return L!=null&&C.putMetadata(X.ERROR_CORRECTION_LEVEL,L),C}reset(){}static extractPureBits(h){const f=h.getTopLeftOnBit(),b=h.getBottomRightOnBit();if(f==null||b==null)throw new F;const N=this.moduleSize(f,h);let _=f[1];const C=b[1];let M=f[0];const z=(b[0]-M+1)/N,re=(C-_+1)/N;if(z<=0||re<=0)throw new F;const ue=N/2;_+=ue,M+=ue;const pe=new R(z,re);for(let Se=0;Se<re;Se++){const Ie=_+Se*N;for(let Be=0;Be<z;Be++)h.get(M+Be*N,Ie)&&pe.set(Be,Se)}return pe}static moduleSize(h,f){const b=f.getWidth();let N=h[0];const _=h[1];for(;N<b&&f.get(N,_);)N++;if(N===b)throw new F;const C=N-h[0];if(C===0)throw new F;return C}}gi.NO_POINTS=[];class wc extends ie{constructor(h=500){super(new gi,h)}}var $o;(function(de){de[de.L=0]="L",de[de.M=1]="M",de[de.Q=2]="Q",de[de.H=3]="H"})($o||($o={}));class ye{constructor(h,f,b){this.value=h,this.stringValue=f,this.bits=b,ye.FOR_BITS.set(b,this),ye.FOR_VALUE.set(h,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(h){switch(h){case"L":return ye.L;case"M":return ye.M;case"Q":return ye.Q;case"H":return ye.H;default:throw new m(h+"not available")}}toString(){return this.stringValue}equals(h){if(!(h instanceof ye))return!1;const f=h;return this.value===f.value}static forBits(h){if(h<0||h>=ye.FOR_BITS.size)throw new x;return ye.FOR_BITS.get(h)}}ye.FOR_BITS=new Map,ye.FOR_VALUE=new Map,ye.L=new ye($o.L,"L",1),ye.M=new ye($o.M,"M",0),ye.Q=new ye($o.Q,"Q",3),ye.H=new ye($o.H,"H",2);class at{constructor(h){this.errorCorrectionLevel=ye.forBits(h>>3&3),this.dataMask=h&7}static numBitsDiffering(h,f){return k.bitCount(h^f)}static decodeFormatInformation(h,f){const b=at.doDecodeFormatInformation(h,f);return b!==null?b:at.doDecodeFormatInformation(h^at.FORMAT_INFO_MASK_QR,f^at.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(h,f){let b=Number.MAX_SAFE_INTEGER,N=0;for(const _ of at.FORMAT_INFO_DECODE_LOOKUP){const C=_[0];if(C===h||C===f)return new at(_[1]);let M=at.numBitsDiffering(h,C);M<b&&(N=_[1],b=M),h!==f&&(M=at.numBitsDiffering(f,C),M<b&&(N=_[1],b=M))}return b<=3?new at(N):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(h){if(!(h instanceof at))return!1;const f=h;return this.errorCorrectionLevel===f.errorCorrectionLevel&&this.dataMask===f.dataMask}}at.FORMAT_INFO_MASK_QR=21522,at.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Oe{constructor(h,...f){this.ecCodewordsPerBlock=h,this.ecBlocks=f}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let h=0;const f=this.ecBlocks;for(const b of f)h+=b.getCount();return h}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class be{constructor(h,f){this.count=h,this.dataCodewords=f}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class $t{constructor(h,f,...b){this.versionNumber=h,this.alignmentPatternCenters=f,this.ecBlocks=b;let N=0;const _=b[0].getECCodewordsPerBlock(),C=b[0].getECBlocks();for(const M of C)N+=M.getCount()*(M.getDataCodewords()+_);this.totalCodewords=N}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(h){return this.ecBlocks[h.getValue()]}static getProvisionalVersionForDimension(h){if(h%4!==1)throw new O;try{return this.getVersionForNumber((h-17)/4)}catch{throw new O}}static getVersionForNumber(h){if(h<1||h>40)throw new x;return $t.VERSIONS[h-1]}static decodeVersionInformation(h){let f=Number.MAX_SAFE_INTEGER,b=0;for(let N=0;N<$t.VERSION_DECODE_INFO.length;N++){const _=$t.VERSION_DECODE_INFO[N];if(_===h)return $t.getVersionForNumber(N+7);const C=at.numBitsDiffering(h,_);C<f&&(b=N+7,f=C)}return f<=3?$t.getVersionForNumber(b):null}buildFunctionPattern(){const h=this.getDimensionForVersion(),f=new R(h);f.setRegion(0,0,9,9),f.setRegion(h-8,0,8,9),f.setRegion(0,h-8,9,8);const b=this.alignmentPatternCenters.length;for(let N=0;N<b;N++){const _=this.alignmentPatternCenters[N]-2;for(let C=0;C<b;C++)N===0&&(C===0||C===b-1)||N===b-1&&C===0||f.setRegion(this.alignmentPatternCenters[C]-2,_,5,5)}return f.setRegion(6,9,1,h-17),f.setRegion(9,6,h-17,1),this.versionNumber>6&&(f.setRegion(h-11,0,3,6),f.setRegion(0,h-11,6,3)),f}toString(){return""+this.versionNumber}}$t.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),$t.VERSIONS=[new $t(1,new Int32Array(0),new Oe(7,new be(1,19)),new Oe(10,new be(1,16)),new Oe(13,new be(1,13)),new Oe(17,new be(1,9))),new $t(2,Int32Array.from([6,18]),new Oe(10,new be(1,34)),new Oe(16,new be(1,28)),new Oe(22,new be(1,22)),new Oe(28,new be(1,16))),new $t(3,Int32Array.from([6,22]),new Oe(15,new be(1,55)),new Oe(26,new be(1,44)),new Oe(18,new be(2,17)),new Oe(22,new be(2,13))),new $t(4,Int32Array.from([6,26]),new Oe(20,new be(1,80)),new Oe(18,new be(2,32)),new Oe(26,new be(2,24)),new Oe(16,new be(4,9))),new $t(5,Int32Array.from([6,30]),new Oe(26,new be(1,108)),new Oe(24,new be(2,43)),new Oe(18,new be(2,15),new be(2,16)),new Oe(22,new be(2,11),new be(2,12))),new $t(6,Int32Array.from([6,34]),new Oe(18,new be(2,68)),new Oe(16,new be(4,27)),new Oe(24,new be(4,19)),new Oe(28,new be(4,15))),new $t(7,Int32Array.from([6,22,38]),new Oe(20,new be(2,78)),new Oe(18,new be(4,31)),new Oe(18,new be(2,14),new be(4,15)),new Oe(26,new be(4,13),new be(1,14))),new $t(8,Int32Array.from([6,24,42]),new Oe(24,new be(2,97)),new Oe(22,new be(2,38),new be(2,39)),new Oe(22,new be(4,18),new be(2,19)),new Oe(26,new be(4,14),new be(2,15))),new $t(9,Int32Array.from([6,26,46]),new Oe(30,new be(2,116)),new Oe(22,new be(3,36),new be(2,37)),new Oe(20,new be(4,16),new be(4,17)),new Oe(24,new be(4,12),new be(4,13))),new $t(10,Int32Array.from([6,28,50]),new Oe(18,new be(2,68),new be(2,69)),new Oe(26,new be(4,43),new be(1,44)),new Oe(24,new be(6,19),new be(2,20)),new Oe(28,new be(6,15),new be(2,16))),new $t(11,Int32Array.from([6,30,54]),new Oe(20,new be(4,81)),new Oe(30,new be(1,50),new be(4,51)),new Oe(28,new be(4,22),new be(4,23)),new Oe(24,new be(3,12),new be(8,13))),new $t(12,Int32Array.from([6,32,58]),new Oe(24,new be(2,92),new be(2,93)),new Oe(22,new be(6,36),new be(2,37)),new Oe(26,new be(4,20),new be(6,21)),new Oe(28,new be(7,14),new be(4,15))),new $t(13,Int32Array.from([6,34,62]),new Oe(26,new be(4,107)),new Oe(22,new be(8,37),new be(1,38)),new Oe(24,new be(8,20),new be(4,21)),new Oe(22,new be(12,11),new be(4,12))),new $t(14,Int32Array.from([6,26,46,66]),new Oe(30,new be(3,115),new be(1,116)),new Oe(24,new be(4,40),new be(5,41)),new Oe(20,new be(11,16),new be(5,17)),new Oe(24,new be(11,12),new be(5,13))),new $t(15,Int32Array.from([6,26,48,70]),new Oe(22,new be(5,87),new be(1,88)),new Oe(24,new be(5,41),new be(5,42)),new Oe(30,new be(5,24),new be(7,25)),new Oe(24,new be(11,12),new be(7,13))),new $t(16,Int32Array.from([6,26,50,74]),new Oe(24,new be(5,98),new be(1,99)),new Oe(28,new be(7,45),new be(3,46)),new Oe(24,new be(15,19),new be(2,20)),new Oe(30,new be(3,15),new be(13,16))),new $t(17,Int32Array.from([6,30,54,78]),new Oe(28,new be(1,107),new be(5,108)),new Oe(28,new be(10,46),new be(1,47)),new Oe(28,new be(1,22),new be(15,23)),new Oe(28,new be(2,14),new be(17,15))),new $t(18,Int32Array.from([6,30,56,82]),new Oe(30,new be(5,120),new be(1,121)),new Oe(26,new be(9,43),new be(4,44)),new Oe(28,new be(17,22),new be(1,23)),new Oe(28,new be(2,14),new be(19,15))),new $t(19,Int32Array.from([6,30,58,86]),new Oe(28,new be(3,113),new be(4,114)),new Oe(26,new be(3,44),new be(11,45)),new Oe(26,new be(17,21),new be(4,22)),new Oe(26,new be(9,13),new be(16,14))),new $t(20,Int32Array.from([6,34,62,90]),new Oe(28,new be(3,107),new be(5,108)),new Oe(26,new be(3,41),new be(13,42)),new Oe(30,new be(15,24),new be(5,25)),new Oe(28,new be(15,15),new be(10,16))),new $t(21,Int32Array.from([6,28,50,72,94]),new Oe(28,new be(4,116),new be(4,117)),new Oe(26,new be(17,42)),new Oe(28,new be(17,22),new be(6,23)),new Oe(30,new be(19,16),new be(6,17))),new $t(22,Int32Array.from([6,26,50,74,98]),new Oe(28,new be(2,111),new be(7,112)),new Oe(28,new be(17,46)),new Oe(30,new be(7,24),new be(16,25)),new Oe(24,new be(34,13))),new $t(23,Int32Array.from([6,30,54,78,102]),new Oe(30,new be(4,121),new be(5,122)),new Oe(28,new be(4,47),new be(14,48)),new Oe(30,new be(11,24),new be(14,25)),new Oe(30,new be(16,15),new be(14,16))),new $t(24,Int32Array.from([6,28,54,80,106]),new Oe(30,new be(6,117),new be(4,118)),new Oe(28,new be(6,45),new be(14,46)),new Oe(30,new be(11,24),new be(16,25)),new Oe(30,new be(30,16),new be(2,17))),new $t(25,Int32Array.from([6,32,58,84,110]),new Oe(26,new be(8,106),new be(4,107)),new Oe(28,new be(8,47),new be(13,48)),new Oe(30,new be(7,24),new be(22,25)),new Oe(30,new be(22,15),new be(13,16))),new $t(26,Int32Array.from([6,30,58,86,114]),new Oe(28,new be(10,114),new be(2,115)),new Oe(28,new be(19,46),new be(4,47)),new Oe(28,new be(28,22),new be(6,23)),new Oe(30,new be(33,16),new be(4,17))),new $t(27,Int32Array.from([6,34,62,90,118]),new Oe(30,new be(8,122),new be(4,123)),new Oe(28,new be(22,45),new be(3,46)),new Oe(30,new be(8,23),new be(26,24)),new Oe(30,new be(12,15),new be(28,16))),new $t(28,Int32Array.from([6,26,50,74,98,122]),new Oe(30,new be(3,117),new be(10,118)),new Oe(28,new be(3,45),new be(23,46)),new Oe(30,new be(4,24),new be(31,25)),new Oe(30,new be(11,15),new be(31,16))),new $t(29,Int32Array.from([6,30,54,78,102,126]),new Oe(30,new be(7,116),new be(7,117)),new Oe(28,new be(21,45),new be(7,46)),new Oe(30,new be(1,23),new be(37,24)),new Oe(30,new be(19,15),new be(26,16))),new $t(30,Int32Array.from([6,26,52,78,104,130]),new Oe(30,new be(5,115),new be(10,116)),new Oe(28,new be(19,47),new be(10,48)),new Oe(30,new be(15,24),new be(25,25)),new Oe(30,new be(23,15),new be(25,16))),new $t(31,Int32Array.from([6,30,56,82,108,134]),new Oe(30,new be(13,115),new be(3,116)),new Oe(28,new be(2,46),new be(29,47)),new Oe(30,new be(42,24),new be(1,25)),new Oe(30,new be(23,15),new be(28,16))),new $t(32,Int32Array.from([6,34,60,86,112,138]),new Oe(30,new be(17,115)),new Oe(28,new be(10,46),new be(23,47)),new Oe(30,new be(10,24),new be(35,25)),new Oe(30,new be(19,15),new be(35,16))),new $t(33,Int32Array.from([6,30,58,86,114,142]),new Oe(30,new be(17,115),new be(1,116)),new Oe(28,new be(14,46),new be(21,47)),new Oe(30,new be(29,24),new be(19,25)),new Oe(30,new be(11,15),new be(46,16))),new $t(34,Int32Array.from([6,34,62,90,118,146]),new Oe(30,new be(13,115),new be(6,116)),new Oe(28,new be(14,46),new be(23,47)),new Oe(30,new be(44,24),new be(7,25)),new Oe(30,new be(59,16),new be(1,17))),new $t(35,Int32Array.from([6,30,54,78,102,126,150]),new Oe(30,new be(12,121),new be(7,122)),new Oe(28,new be(12,47),new be(26,48)),new Oe(30,new be(39,24),new be(14,25)),new Oe(30,new be(22,15),new be(41,16))),new $t(36,Int32Array.from([6,24,50,76,102,128,154]),new Oe(30,new be(6,121),new be(14,122)),new Oe(28,new be(6,47),new be(34,48)),new Oe(30,new be(46,24),new be(10,25)),new Oe(30,new be(2,15),new be(64,16))),new $t(37,Int32Array.from([6,28,54,80,106,132,158]),new Oe(30,new be(17,122),new be(4,123)),new Oe(28,new be(29,46),new be(14,47)),new Oe(30,new be(49,24),new be(10,25)),new Oe(30,new be(24,15),new be(46,16))),new $t(38,Int32Array.from([6,32,58,84,110,136,162]),new Oe(30,new be(4,122),new be(18,123)),new Oe(28,new be(13,46),new be(32,47)),new Oe(30,new be(48,24),new be(14,25)),new Oe(30,new be(42,15),new be(32,16))),new $t(39,Int32Array.from([6,26,54,82,110,138,166]),new Oe(30,new be(20,117),new be(4,118)),new Oe(28,new be(40,47),new be(7,48)),new Oe(30,new be(43,24),new be(22,25)),new Oe(30,new be(10,15),new be(67,16))),new $t(40,Int32Array.from([6,30,58,86,114,142,170]),new Oe(30,new be(19,118),new be(6,119)),new Oe(28,new be(18,47),new be(31,48)),new Oe(30,new be(34,24),new be(34,25)),new Oe(30,new be(20,15),new be(61,16)))];var bn;(function(de){de[de.DATA_MASK_000=0]="DATA_MASK_000",de[de.DATA_MASK_001=1]="DATA_MASK_001",de[de.DATA_MASK_010=2]="DATA_MASK_010",de[de.DATA_MASK_011=3]="DATA_MASK_011",de[de.DATA_MASK_100=4]="DATA_MASK_100",de[de.DATA_MASK_101=5]="DATA_MASK_101",de[de.DATA_MASK_110=6]="DATA_MASK_110",de[de.DATA_MASK_111=7]="DATA_MASK_111"})(bn||(bn={}));class er{constructor(h,f){this.value=h,this.isMasked=f}unmaskBitMatrix(h,f){for(let b=0;b<f;b++)for(let N=0;N<f;N++)this.isMasked(b,N)&&h.flip(N,b)}}er.values=new Map([[bn.DATA_MASK_000,new er(bn.DATA_MASK_000,(de,h)=>(de+h&1)===0)],[bn.DATA_MASK_001,new er(bn.DATA_MASK_001,(de,h)=>(de&1)===0)],[bn.DATA_MASK_010,new er(bn.DATA_MASK_010,(de,h)=>h%3===0)],[bn.DATA_MASK_011,new er(bn.DATA_MASK_011,(de,h)=>(de+h)%3===0)],[bn.DATA_MASK_100,new er(bn.DATA_MASK_100,(de,h)=>(Math.floor(de/2)+Math.floor(h/3)&1)===0)],[bn.DATA_MASK_101,new er(bn.DATA_MASK_101,(de,h)=>de*h%6===0)],[bn.DATA_MASK_110,new er(bn.DATA_MASK_110,(de,h)=>de*h%6<3)],[bn.DATA_MASK_111,new er(bn.DATA_MASK_111,(de,h)=>(de+h+de*h%3&1)===0)]]);class qf{constructor(h){const f=h.getHeight();if(f<21||(f&3)!==1)throw new O;this.bitMatrix=h}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let h=0;for(let _=0;_<6;_++)h=this.copyBit(_,8,h);h=this.copyBit(7,8,h),h=this.copyBit(8,8,h),h=this.copyBit(8,7,h);for(let _=5;_>=0;_--)h=this.copyBit(8,_,h);const f=this.bitMatrix.getHeight();let b=0;const N=f-7;for(let _=f-1;_>=N;_--)b=this.copyBit(8,_,b);for(let _=f-8;_<f;_++)b=this.copyBit(_,8,b);if(this.parsedFormatInfo=at.decodeFormatInformation(h,b),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new O}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const h=this.bitMatrix.getHeight(),f=Math.floor((h-17)/4);if(f<=6)return $t.getVersionForNumber(f);let b=0;const N=h-11;for(let C=5;C>=0;C--)for(let M=h-9;M>=N;M--)b=this.copyBit(M,C,b);let _=$t.decodeVersionInformation(b);if(_!==null&&_.getDimensionForVersion()===h)return this.parsedVersion=_,_;b=0;for(let C=5;C>=0;C--)for(let M=h-9;M>=N;M--)b=this.copyBit(C,M,b);if(_=$t.decodeVersionInformation(b),_!==null&&_.getDimensionForVersion()===h)return this.parsedVersion=_,_;throw new O}copyBit(h,f,b){return(this.isMirror?this.bitMatrix.get(f,h):this.bitMatrix.get(h,f))?b<<1|1:b<<1}readCodewords(){const h=this.readFormatInformation(),f=this.readVersion(),b=er.values.get(h.getDataMask()),N=this.bitMatrix.getHeight();b.unmaskBitMatrix(this.bitMatrix,N);const _=f.buildFunctionPattern();let C=!0;const M=new Uint8Array(f.getTotalCodewords());let L=0,z=0,re=0;for(let ue=N-1;ue>0;ue-=2){ue===6&&ue--;for(let pe=0;pe<N;pe++){const Se=C?N-1-pe:pe;for(let Ie=0;Ie<2;Ie++)_.get(ue-Ie,Se)||(re++,z<<=1,this.bitMatrix.get(ue-Ie,Se)&&(z|=1),re===8&&(M[L++]=z,re=0,z=0))}C=!C}if(L!==f.getTotalCodewords())throw new O;return M}remask(){if(this.parsedFormatInfo===null)return;const h=er.values[this.parsedFormatInfo.getDataMask()],f=this.bitMatrix.getHeight();h.unmaskBitMatrix(this.bitMatrix,f)}setMirror(h){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=h}mirror(){const h=this.bitMatrix;for(let f=0,b=h.getWidth();f<b;f++)for(let N=f+1,_=h.getHeight();N<_;N++)h.get(f,N)!==h.get(N,f)&&(h.flip(N,f),h.flip(f,N))}}class Gf{constructor(h,f){this.numDataCodewords=h,this.codewords=f}static getDataBlocks(h,f,b){if(h.length!==f.getTotalCodewords())throw new x;const N=f.getECBlocksForLevel(b);let _=0;const C=N.getECBlocks();for(const Ie of C)_+=Ie.getCount();const M=new Array(_);let L=0;for(const Ie of C)for(let Be=0;Be<Ie.getCount();Be++){const Xe=Ie.getDataCodewords(),nt=N.getECCodewordsPerBlock()+Xe;M[L++]=new Gf(Xe,new Uint8Array(nt))}const z=M[0].codewords.length;let re=M.length-1;for(;re>=0&&M[re].codewords.length!==z;)re--;re++;const ue=z-N.getECCodewordsPerBlock();let pe=0;for(let Ie=0;Ie<ue;Ie++)for(let Be=0;Be<L;Be++)M[Be].codewords[Ie]=h[pe++];for(let Ie=re;Ie<L;Ie++)M[Ie].codewords[ue]=h[pe++];const Se=M[0].codewords.length;for(let Ie=ue;Ie<Se;Ie++)for(let Be=0;Be<L;Be++){const Xe=Be<re?Ie:Ie+1;M[Be].codewords[Xe]=h[pe++]}return M}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Bi;(function(de){de[de.TERMINATOR=0]="TERMINATOR",de[de.NUMERIC=1]="NUMERIC",de[de.ALPHANUMERIC=2]="ALPHANUMERIC",de[de.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",de[de.BYTE=4]="BYTE",de[de.ECI=5]="ECI",de[de.KANJI=6]="KANJI",de[de.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",de[de.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",de[de.HANZI=9]="HANZI"})(Bi||(Bi={}));class ss{constructor(h,f,b,N){this.value=h,this.stringValue=f,this.characterCountBitsForVersions=b,this.bits=N,ss.FOR_BITS.set(N,this),ss.FOR_VALUE.set(h,this)}static forBits(h){const f=ss.FOR_BITS.get(h);if(f===void 0)throw new x;return f}getCharacterCountBits(h){const f=h.getVersionNumber();let b;return f<=9?b=0:f<=26?b=1:b=2,this.characterCountBitsForVersions[b]}getValue(){return this.value}getBits(){return this.bits}equals(h){if(!(h instanceof ss))return!1;const f=h;return this.value===f.value}toString(){return this.stringValue}}ss.FOR_BITS=new Map,ss.FOR_VALUE=new Map,ss.TERMINATOR=new ss(Bi.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),ss.NUMERIC=new ss(Bi.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),ss.ALPHANUMERIC=new ss(Bi.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),ss.STRUCTURED_APPEND=new ss(Bi.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),ss.BYTE=new ss(Bi.BYTE,"BYTE",Int32Array.from([8,16,16]),4),ss.ECI=new ss(Bi.ECI,"ECI",Int32Array.from([0,0,0]),7),ss.KANJI=new ss(Bi.KANJI,"KANJI",Int32Array.from([8,10,12]),8),ss.FNC1_FIRST_POSITION=new ss(Bi.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),ss.FNC1_SECOND_POSITION=new ss(Bi.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),ss.HANZI=new ss(Bi.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Dn{static decode(h,f,b,N){const _=new Ft(h);let C=new V;const M=new Array;let L=-1,z=-1;try{let re=null,ue=!1,pe;do{if(_.available()<4)pe=ss.TERMINATOR;else{const Se=_.readBits(4);pe=ss.forBits(Se)}switch(pe){case ss.TERMINATOR:break;case ss.FNC1_FIRST_POSITION:case ss.FNC1_SECOND_POSITION:ue=!0;break;case ss.STRUCTURED_APPEND:if(_.available()<16)throw new O;L=_.readBits(8),z=_.readBits(8);break;case ss.ECI:const Se=Dn.parseECIValue(_);if(re=T.getCharacterSetECIByValue(Se),re===null)throw new O;break;case ss.HANZI:const Ie=_.readBits(4),Be=_.readBits(pe.getCharacterCountBits(f));Ie===Dn.GB2312_SUBSET&&Dn.decodeHanziSegment(_,C,Be);break;default:const Xe=_.readBits(pe.getCharacterCountBits(f));switch(pe){case ss.NUMERIC:Dn.decodeNumericSegment(_,C,Xe);break;case ss.ALPHANUMERIC:Dn.decodeAlphanumericSegment(_,C,Xe,ue);break;case ss.BYTE:Dn.decodeByteSegment(_,C,Xe,re,M,N);break;case ss.KANJI:Dn.decodeKanjiSegment(_,C,Xe);break;default:throw new O}break}}while(pe!==ss.TERMINATOR)}catch{throw new O}return new Z(h,C.toString(),M.length===0?null:M,b===null?null:b.toString(),L,z)}static decodeHanziSegment(h,f,b){if(b*13>h.available())throw new O;const N=new Uint8Array(2*b);let _=0;for(;b>0;){const C=h.readBits(13);let M=C/96<<8&4294967295|C%96;M<959?M+=41377:M+=42657,N[_]=M>>8&255,N[_+1]=M&255,_+=2,b--}try{f.append(U.decode(N,W.GB2312))}catch(C){throw new O(C)}}static decodeKanjiSegment(h,f,b){if(b*13>h.available())throw new O;const N=new Uint8Array(2*b);let _=0;for(;b>0;){const C=h.readBits(13);let M=C/192<<8&4294967295|C%192;M<7936?M+=33088:M+=49472,N[_]=M>>8,N[_+1]=M,_+=2,b--}try{f.append(U.decode(N,W.SHIFT_JIS))}catch(C){throw new O(C)}}static decodeByteSegment(h,f,b,N,_,C){if(8*b>h.available())throw new O;const M=new Uint8Array(b);for(let z=0;z<b;z++)M[z]=h.readBits(8);let L;N===null?L=W.guessEncoding(M,C):L=N.getName();try{f.append(U.decode(M,L))}catch(z){throw new O(z)}_.push(M)}static toAlphaNumericChar(h){if(h>=Dn.ALPHANUMERIC_CHARS.length)throw new O;return Dn.ALPHANUMERIC_CHARS[h]}static decodeAlphanumericSegment(h,f,b,N){const _=f.length();for(;b>1;){if(h.available()<11)throw new O;const C=h.readBits(11);f.append(Dn.toAlphaNumericChar(Math.floor(C/45))),f.append(Dn.toAlphaNumericChar(C%45)),b-=2}if(b===1){if(h.available()<6)throw new O;f.append(Dn.toAlphaNumericChar(h.readBits(6)))}if(N)for(let C=_;C<f.length();C++)f.charAt(C)==="%"&&(C<f.length()-1&&f.charAt(C+1)==="%"?f.deleteCharAt(C+1):f.setCharAt(C,""))}static decodeNumericSegment(h,f,b){for(;b>=3;){if(h.available()<10)throw new O;const N=h.readBits(10);if(N>=1e3)throw new O;f.append(Dn.toAlphaNumericChar(Math.floor(N/100))),f.append(Dn.toAlphaNumericChar(Math.floor(N/10)%10)),f.append(Dn.toAlphaNumericChar(N%10)),b-=3}if(b===2){if(h.available()<7)throw new O;const N=h.readBits(7);if(N>=100)throw new O;f.append(Dn.toAlphaNumericChar(Math.floor(N/10))),f.append(Dn.toAlphaNumericChar(N%10))}else if(b===1){if(h.available()<4)throw new O;const N=h.readBits(4);if(N>=10)throw new O;f.append(Dn.toAlphaNumericChar(N))}}static parseECIValue(h){const f=h.readBits(8);if(!(f&128))return f&127;if((f&192)===128){const b=h.readBits(8);return(f&63)<<8&4294967295|b}if((f&224)===192){const b=h.readBits(16);return(f&31)<<16&4294967295|b}throw new O}}Dn.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Dn.GB2312_SUBSET=1;class Ry{constructor(h){this.mirrored=h}isMirrored(){return this.mirrored}applyMirroredCorrection(h){if(!this.mirrored||h===null||h.length<3)return;const f=h[0];h[0]=h[2],h[2]=f}}class xS{constructor(){this.rsDecoder=new Re(_e.QR_CODE_FIELD_256)}decodeBooleanArray(h,f){return this.decodeBitMatrix(R.parseFromBooleanArray(h),f)}decodeBitMatrix(h,f){const b=new qf(h);let N=null;try{return this.decodeBitMatrixParser(b,f)}catch(_){N=_}try{b.remask(),b.setMirror(!0),b.readVersion(),b.readFormatInformation(),b.mirror();const _=this.decodeBitMatrixParser(b,f);return _.setOther(new Ry(!0)),_}catch(_){throw N!==null?N:_}}decodeBitMatrixParser(h,f){const b=h.readVersion(),N=h.readFormatInformation().getErrorCorrectionLevel(),_=h.readCodewords(),C=Gf.getDataBlocks(_,b,N);let M=0;for(const re of C)M+=re.getNumDataCodewords();const L=new Uint8Array(M);let z=0;for(const re of C){const ue=re.getCodewords(),pe=re.getNumDataCodewords();this.correctErrors(ue,pe);for(let Se=0;Se<pe;Se++)L[z++]=ue[Se]}return Dn.decode(L,b,N,f)}correctErrors(h,f){const b=new Int32Array(h);try{this.rsDecoder.decode(b,h.length-f)}catch{throw new y}for(let N=0;N<f;N++)h[N]=b[N]}}class Kf extends Ae{constructor(h,f,b){super(h,f),this.estimatedModuleSize=b}aboutEquals(h,f,b){if(Math.abs(f-this.getY())<=h&&Math.abs(b-this.getX())<=h){const N=Math.abs(h-this.estimatedModuleSize);return N<=1||N<=this.estimatedModuleSize}return!1}combineEstimate(h,f,b){const N=(this.getX()+f)/2,_=(this.getY()+h)/2,C=(this.estimatedModuleSize+b)/2;return new Kf(N,_,C)}}class _x{constructor(h,f,b,N,_,C,M){this.image=h,this.startX=f,this.startY=b,this.width=N,this.height=_,this.moduleSize=C,this.resultPointCallback=M,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const h=this.startX,f=this.height,b=this.width,N=h+b,_=this.startY+f/2,C=new Int32Array(3),M=this.image;for(let L=0;L<f;L++){const z=_+(L&1?-Math.floor((L+1)/2):Math.floor((L+1)/2));C[0]=0,C[1]=0,C[2]=0;let re=h;for(;re<N&&!M.get(re,z);)re++;let ue=0;for(;re<N;){if(M.get(re,z))if(ue===1)C[1]++;else if(ue===2){if(this.foundPatternCross(C)){const pe=this.handlePossibleCenter(C,z,re);if(pe!==null)return pe}C[0]=C[2],C[1]=1,C[2]=0,ue=1}else C[++ue]++;else ue===1&&ue++,C[ue]++;re++}if(this.foundPatternCross(C)){const pe=this.handlePossibleCenter(C,z,N);if(pe!==null)return pe}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new F}static centerFromEnd(h,f){return f-h[2]-h[1]/2}foundPatternCross(h){const f=this.moduleSize,b=f/2;for(let N=0;N<3;N++)if(Math.abs(f-h[N])>=b)return!1;return!0}crossCheckVertical(h,f,b,N){const _=this.image,C=_.getHeight(),M=this.crossCheckStateCount;M[0]=0,M[1]=0,M[2]=0;let L=h;for(;L>=0&&_.get(f,L)&&M[1]<=b;)M[1]++,L--;if(L<0||M[1]>b)return NaN;for(;L>=0&&!_.get(f,L)&&M[0]<=b;)M[0]++,L--;if(M[0]>b)return NaN;for(L=h+1;L<C&&_.get(f,L)&&M[1]<=b;)M[1]++,L++;if(L===C||M[1]>b)return NaN;for(;L<C&&!_.get(f,L)&&M[2]<=b;)M[2]++,L++;if(M[2]>b)return NaN;const z=M[0]+M[1]+M[2];return 5*Math.abs(z-N)>=2*N?NaN:this.foundPatternCross(M)?_x.centerFromEnd(M,L):NaN}handlePossibleCenter(h,f,b){const N=h[0]+h[1]+h[2],_=_x.centerFromEnd(h,b),C=this.crossCheckVertical(f,_,2*h[1],N);if(!isNaN(C)){const M=(h[0]+h[1]+h[2])/3;for(const z of this.possibleCenters)if(z.aboutEquals(M,C,_))return z.combineEstimate(C,_,M);const L=new Kf(_,C,M);this.possibleCenters.push(L),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(L)}return null}}class Yf extends Ae{constructor(h,f,b,N){super(h,f),this.estimatedModuleSize=b,this.count=N,N===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(h,f,b){if(Math.abs(f-this.getY())<=h&&Math.abs(b-this.getX())<=h){const N=Math.abs(h-this.estimatedModuleSize);return N<=1||N<=this.estimatedModuleSize}return!1}combineEstimate(h,f,b){const N=this.count+1,_=(this.count*this.getX()+f)/N,C=(this.count*this.getY()+h)/N,M=(this.count*this.estimatedModuleSize+b)/N;return new Yf(_,C,M,N)}}class pS{constructor(h){this.bottomLeft=h[0],this.topLeft=h[1],this.topRight=h[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Lr{constructor(h,f){this.image=h,this.resultPointCallback=f,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=f}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(h){const f=h!=null&&h.get(P.TRY_HARDER)!==void 0,b=h!=null&&h.get(P.PURE_BARCODE)!==void 0,N=this.image,_=N.getHeight(),C=N.getWidth();let M=Math.floor(3*_/(4*Lr.MAX_MODULES));(M<Lr.MIN_SKIP||f)&&(M=Lr.MIN_SKIP);let L=!1;const z=new Int32Array(5);for(let ue=M-1;ue<_&&!L;ue+=M){z[0]=0,z[1]=0,z[2]=0,z[3]=0,z[4]=0;let pe=0;for(let Se=0;Se<C;Se++)if(N.get(Se,ue))(pe&1)===1&&pe++,z[pe]++;else if(pe&1)z[pe]++;else if(pe===4)if(Lr.foundPatternCross(z)){if(this.handlePossibleCenter(z,ue,Se,b)===!0)if(M=2,this.hasSkipped===!0)L=this.haveMultiplyConfirmedCenters();else{const Be=this.findRowSkip();Be>z[2]&&(ue+=Be-z[2]-M,Se=C-1)}else{z[0]=z[2],z[1]=z[3],z[2]=z[4],z[3]=1,z[4]=0,pe=3;continue}pe=0,z[0]=0,z[1]=0,z[2]=0,z[3]=0,z[4]=0}else z[0]=z[2],z[1]=z[3],z[2]=z[4],z[3]=1,z[4]=0,pe=3;else z[++pe]++;Lr.foundPatternCross(z)&&this.handlePossibleCenter(z,ue,C,b)===!0&&(M=z[0],this.hasSkipped&&(L=this.haveMultiplyConfirmedCenters()))}const re=this.selectBestPatterns();return Ae.orderBestPatterns(re),new pS(re)}static centerFromEnd(h,f){return f-h[4]-h[3]-h[2]/2}static foundPatternCross(h){let f=0;for(let _=0;_<5;_++){const C=h[_];if(C===0)return!1;f+=C}if(f<7)return!1;const b=f/7,N=b/2;return Math.abs(b-h[0])<N&&Math.abs(b-h[1])<N&&Math.abs(3*b-h[2])<3*N&&Math.abs(b-h[3])<N&&Math.abs(b-h[4])<N}getCrossCheckStateCount(){const h=this.crossCheckStateCount;return h[0]=0,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h}crossCheckDiagonal(h,f,b,N){const _=this.getCrossCheckStateCount();let C=0;const M=this.image;for(;h>=C&&f>=C&&M.get(f-C,h-C);)_[2]++,C++;if(h<C||f<C)return!1;for(;h>=C&&f>=C&&!M.get(f-C,h-C)&&_[1]<=b;)_[1]++,C++;if(h<C||f<C||_[1]>b)return!1;for(;h>=C&&f>=C&&M.get(f-C,h-C)&&_[0]<=b;)_[0]++,C++;if(_[0]>b)return!1;const L=M.getHeight(),z=M.getWidth();for(C=1;h+C<L&&f+C<z&&M.get(f+C,h+C);)_[2]++,C++;if(h+C>=L||f+C>=z)return!1;for(;h+C<L&&f+C<z&&!M.get(f+C,h+C)&&_[3]<b;)_[3]++,C++;if(h+C>=L||f+C>=z||_[3]>=b)return!1;for(;h+C<L&&f+C<z&&M.get(f+C,h+C)&&_[4]<b;)_[4]++,C++;if(_[4]>=b)return!1;const re=_[0]+_[1]+_[2]+_[3]+_[4];return Math.abs(re-N)<2*N&&Lr.foundPatternCross(_)}crossCheckVertical(h,f,b,N){const _=this.image,C=_.getHeight(),M=this.getCrossCheckStateCount();let L=h;for(;L>=0&&_.get(f,L);)M[2]++,L--;if(L<0)return NaN;for(;L>=0&&!_.get(f,L)&&M[1]<=b;)M[1]++,L--;if(L<0||M[1]>b)return NaN;for(;L>=0&&_.get(f,L)&&M[0]<=b;)M[0]++,L--;if(M[0]>b)return NaN;for(L=h+1;L<C&&_.get(f,L);)M[2]++,L++;if(L===C)return NaN;for(;L<C&&!_.get(f,L)&&M[3]<b;)M[3]++,L++;if(L===C||M[3]>=b)return NaN;for(;L<C&&_.get(f,L)&&M[4]<b;)M[4]++,L++;if(M[4]>=b)return NaN;const z=M[0]+M[1]+M[2]+M[3]+M[4];return 5*Math.abs(z-N)>=2*N?NaN:Lr.foundPatternCross(M)?Lr.centerFromEnd(M,L):NaN}crossCheckHorizontal(h,f,b,N){const _=this.image,C=_.getWidth(),M=this.getCrossCheckStateCount();let L=h;for(;L>=0&&_.get(L,f);)M[2]++,L--;if(L<0)return NaN;for(;L>=0&&!_.get(L,f)&&M[1]<=b;)M[1]++,L--;if(L<0||M[1]>b)return NaN;for(;L>=0&&_.get(L,f)&&M[0]<=b;)M[0]++,L--;if(M[0]>b)return NaN;for(L=h+1;L<C&&_.get(L,f);)M[2]++,L++;if(L===C)return NaN;for(;L<C&&!_.get(L,f)&&M[3]<b;)M[3]++,L++;if(L===C||M[3]>=b)return NaN;for(;L<C&&_.get(L,f)&&M[4]<b;)M[4]++,L++;if(M[4]>=b)return NaN;const z=M[0]+M[1]+M[2]+M[3]+M[4];return 5*Math.abs(z-N)>=N?NaN:Lr.foundPatternCross(M)?Lr.centerFromEnd(M,L):NaN}handlePossibleCenter(h,f,b,N){const _=h[0]+h[1]+h[2]+h[3]+h[4];let C=Lr.centerFromEnd(h,b),M=this.crossCheckVertical(f,Math.floor(C),h[2],_);if(!isNaN(M)&&(C=this.crossCheckHorizontal(Math.floor(C),Math.floor(M),h[2],_),!isNaN(C)&&(!N||this.crossCheckDiagonal(Math.floor(M),Math.floor(C),h[2],_)))){const L=_/7;let z=!1;const re=this.possibleCenters;for(let ue=0,pe=re.length;ue<pe;ue++){const Se=re[ue];if(Se.aboutEquals(L,M,C)){re[ue]=Se.combineEstimate(M,C,L),z=!0;break}}if(!z){const ue=new Yf(C,M,L);re.push(ue),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(ue)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let f=null;for(const b of this.possibleCenters)if(b.getCount()>=Lr.CENTER_QUORUM)if(f==null)f=b;else return this.hasSkipped=!0,Math.floor((Math.abs(f.getX()-b.getX())-Math.abs(f.getY()-b.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let h=0,f=0;const b=this.possibleCenters.length;for(const C of this.possibleCenters)C.getCount()>=Lr.CENTER_QUORUM&&(h++,f+=C.getEstimatedModuleSize());if(h<3)return!1;const N=f/b;let _=0;for(const C of this.possibleCenters)_+=Math.abs(C.getEstimatedModuleSize()-N);return _<=.05*f}selectBestPatterns(){const h=this.possibleCenters.length;if(h<3)throw new F;const f=this.possibleCenters;let b;if(h>3){let N=0,_=0;for(const L of this.possibleCenters){const z=L.getEstimatedModuleSize();N+=z,_+=z*z}b=N/h;let C=Math.sqrt(_/h-b*b);f.sort((L,z)=>{const re=Math.abs(z.getEstimatedModuleSize()-b),ue=Math.abs(L.getEstimatedModuleSize()-b);return re<ue?-1:re>ue?1:0});const M=Math.max(.2*b,C);for(let L=0;L<f.length&&f.length>3;L++){const z=f[L];Math.abs(z.getEstimatedModuleSize()-b)>M&&(f.splice(L,1),L--)}}if(f.length>3){let N=0;for(const _ of f)N+=_.getEstimatedModuleSize();b=N/f.length,f.sort((_,C)=>{if(C.getCount()===_.getCount()){const M=Math.abs(C.getEstimatedModuleSize()-b),L=Math.abs(_.getEstimatedModuleSize()-b);return M<L?1:M>L?-1:0}else return C.getCount()-_.getCount()}),f.splice(3)}return[f[0],f[1],f[2]]}}Lr.CENTER_QUORUM=2,Lr.MIN_SKIP=3,Lr.MAX_MODULES=57;class $i{constructor(h){this.image=h}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(h){this.resultPointCallback=h==null?null:h.get(P.NEED_RESULT_POINT_CALLBACK);const b=new Lr(this.image,this.resultPointCallback).find(h);return this.processFinderPatternInfo(b)}processFinderPatternInfo(h){const f=h.getTopLeft(),b=h.getTopRight(),N=h.getBottomLeft(),_=this.calculateModuleSize(f,b,N);if(_<1)throw new F("No pattern found in proccess finder.");const C=$i.computeDimension(f,b,N,_),M=$t.getProvisionalVersionForDimension(C),L=M.getDimensionForVersion()-7;let z=null;if(M.getAlignmentPatternCenters().length>0){const Se=b.getX()-f.getX()+N.getX(),Ie=b.getY()-f.getY()+N.getY(),Be=1-3/L,Xe=Math.floor(f.getX()+Be*(Se-f.getX())),nt=Math.floor(f.getY()+Be*(Ie-f.getY()));for(let Ct=4;Ct<=16;Ct<<=1)try{z=this.findAlignmentInRegion(_,Xe,nt,Ct);break}catch(kt){if(!(kt instanceof F))throw kt}}const re=$i.createTransform(f,b,N,z,C),ue=$i.sampleGrid(this.image,re,C);let pe;return z===null?pe=[N,f,b]:pe=[N,f,b,z],new Ke(ue,pe)}static createTransform(h,f,b,N,_){const C=_-3.5;let M,L,z,re;return N!==null?(M=N.getX(),L=N.getY(),z=C-3,re=z):(M=f.getX()-h.getX()+b.getX(),L=f.getY()-h.getY()+b.getY(),z=C,re=C),Pe.quadrilateralToQuadrilateral(3.5,3.5,C,3.5,z,re,3.5,C,h.getX(),h.getY(),f.getX(),f.getY(),M,L,b.getX(),b.getY())}static sampleGrid(h,f,b){return It.getInstance().sampleGridWithTransform(h,b,b,f)}static computeDimension(h,f,b,N){const _=fe.round(Ae.distance(h,f)/N),C=fe.round(Ae.distance(h,b)/N);let M=Math.floor((_+C)/2)+7;switch(M&3){case 0:M++;break;case 2:M--;break;case 3:throw new F("Dimensions could be not found.")}return M}calculateModuleSize(h,f,b){return(this.calculateModuleSizeOneWay(h,f)+this.calculateModuleSizeOneWay(h,b))/2}calculateModuleSizeOneWay(h,f){const b=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(h.getX()),Math.floor(h.getY()),Math.floor(f.getX()),Math.floor(f.getY())),N=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(f.getX()),Math.floor(f.getY()),Math.floor(h.getX()),Math.floor(h.getY()));return isNaN(b)?N/7:isNaN(N)?b/7:(b+N)/14}sizeOfBlackWhiteBlackRunBothWays(h,f,b,N){let _=this.sizeOfBlackWhiteBlackRun(h,f,b,N),C=1,M=h-(b-h);M<0?(C=h/(h-M),M=0):M>=this.image.getWidth()&&(C=(this.image.getWidth()-1-h)/(M-h),M=this.image.getWidth()-1);let L=Math.floor(f-(N-f)*C);return C=1,L<0?(C=f/(f-L),L=0):L>=this.image.getHeight()&&(C=(this.image.getHeight()-1-f)/(L-f),L=this.image.getHeight()-1),M=Math.floor(h+(M-h)*C),_+=this.sizeOfBlackWhiteBlackRun(h,f,M,L),_-1}sizeOfBlackWhiteBlackRun(h,f,b,N){const _=Math.abs(N-f)>Math.abs(b-h);if(_){let Se=h;h=f,f=Se,Se=b,b=N,N=Se}const C=Math.abs(b-h),M=Math.abs(N-f);let L=-C/2;const z=h<b?1:-1,re=f<N?1:-1;let ue=0;const pe=b+z;for(let Se=h,Ie=f;Se!==pe;Se+=z){const Be=_?Ie:Se,Xe=_?Se:Ie;if(ue===1===this.image.get(Be,Xe)){if(ue===2)return fe.distance(Se,Ie,h,f);ue++}if(L+=M,L>0){if(Ie===N)break;Ie+=re,L-=C}}return ue===2?fe.distance(b+z,N,h,f):NaN}findAlignmentInRegion(h,f,b,N){const _=Math.floor(N*h),C=Math.max(0,f-_),M=Math.min(this.image.getWidth()-1,f+_);if(M-C<h*3)throw new F("Alignment top exceeds estimated module size.");const L=Math.max(0,b-_),z=Math.min(this.image.getHeight()-1,b+_);if(z-L<h*3)throw new F("Alignment bottom exceeds estimated module size.");return new _x(this.image,C,L,M-C,z-L,h,this.resultPointCallback).find()}}class _c{constructor(){this.decoder=new xS}getDecoder(){return this.decoder}decode(h,f){let b,N;if(f!=null&&f.get(P.PURE_BARCODE)!==void 0){const L=_c.extractPureBits(h.getBlackMatrix());b=this.decoder.decodeBitMatrix(L,f),N=_c.NO_POINTS}else{const L=new $i(h.getBlackMatrix()).detect(f);b=this.decoder.decodeBitMatrix(L.getBits(),f),N=L.getPoints()}b.getOther()instanceof Ry&&b.getOther().applyMirroredCorrection(N);const _=new te(b.getText(),b.getRawBytes(),void 0,N,q.QR_CODE,void 0),C=b.getByteSegments();C!==null&&_.putMetadata(X.BYTE_SEGMENTS,C);const M=b.getECLevel();return M!==null&&_.putMetadata(X.ERROR_CORRECTION_LEVEL,M),b.hasStructuredAppend()&&(_.putMetadata(X.STRUCTURED_APPEND_SEQUENCE,b.getStructuredAppendSequenceNumber()),_.putMetadata(X.STRUCTURED_APPEND_PARITY,b.getStructuredAppendParity())),_}reset(){}static extractPureBits(h){const f=h.getTopLeftOnBit(),b=h.getBottomRightOnBit();if(f===null||b===null)throw new F;const N=this.moduleSize(f,h);let _=f[1],C=b[1],M=f[0],L=b[0];if(M>=L||_>=C)throw new F;if(C-_!==L-M&&(L=M+(C-_),L>=h.getWidth()))throw new F;const z=Math.round((L-M+1)/N),re=Math.round((C-_+1)/N);if(z<=0||re<=0)throw new F;if(re!==z)throw new F;const ue=Math.floor(N/2);_+=ue,M+=ue;const pe=M+Math.floor((z-1)*N)-L;if(pe>0){if(pe>ue)throw new F;M-=pe}const Se=_+Math.floor((re-1)*N)-C;if(Se>0){if(Se>ue)throw new F;_-=Se}const Ie=new R(z,re);for(let Be=0;Be<re;Be++){const Xe=_+Math.floor(Be*N);for(let nt=0;nt<z;nt++)h.get(M+Math.floor(nt*N),Xe)&&Ie.set(nt,Be)}return Ie}static moduleSize(h,f){const b=f.getHeight(),N=f.getWidth();let _=h[0],C=h[1],M=!0,L=0;for(;_<N&&C<b;){if(M!==f.get(_,C)){if(++L===5)break;M=!M}_++,C++}if(_===N||C===b)throw new F;return(_-h[0])/7}}_c.NO_POINTS=new Array;class ls{PDF417Common(){}static getBitCountSum(h){return fe.sum(h)}static toIntArray(h){if(h==null||!h.length)return ls.EMPTY_INT_ARRAY;const f=new Int32Array(h.length);let b=0;for(const N of h)f[b++]=N;return f}static getCodeword(h){const f=E.binarySearch(ls.SYMBOL_TABLE,h&262143);return f<0?-1:(ls.CODEWORD_TABLE[f]-1)%ls.NUMBER_OF_CODEWORDS}}ls.NUMBER_OF_CODEWORDS=929,ls.MAX_CODEWORDS_IN_BARCODE=ls.NUMBER_OF_CODEWORDS-1,ls.MIN_ROWS_IN_BARCODE=3,ls.MAX_ROWS_IN_BARCODE=90,ls.MODULES_IN_CODEWORD=17,ls.MODULES_IN_STOP_PATTERN=18,ls.BARS_IN_MODULE=8,ls.EMPTY_INT_ARRAY=new Int32Array([]),ls.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),ls.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class fS{constructor(h,f){this.bits=h,this.points=f}getBits(){return this.bits}getPoints(){return this.points}}class js{static detectMultiple(h,f,b){let N=h.getBlackMatrix(),_=js.detect(b,N);return _.length||(N=N.clone(),N.rotate180(),_=js.detect(b,N)),new fS(N,_)}static detect(h,f){const b=new Array;let N=0,_=0,C=!1;for(;N<f.getHeight();){const M=js.findVertices(f,N,_);if(M[0]==null&&M[3]==null){if(!C)break;C=!1,_=0;for(const L of b)L[1]!=null&&(N=Math.trunc(Math.max(N,L[1].getY()))),L[3]!=null&&(N=Math.max(N,Math.trunc(L[3].getY())));N+=js.ROW_STEP;continue}if(C=!0,b.push(M),!h)break;M[2]!=null?(_=Math.trunc(M[2].getX()),N=Math.trunc(M[2].getY())):(_=Math.trunc(M[4].getX()),N=Math.trunc(M[4].getY()))}return b}static findVertices(h,f,b){const N=h.getHeight(),_=h.getWidth(),C=new Array(8);return js.copyToResult(C,js.findRowsWithPattern(h,N,_,f,b,js.START_PATTERN),js.INDEXES_START_PATTERN),C[4]!=null&&(b=Math.trunc(C[4].getX()),f=Math.trunc(C[4].getY())),js.copyToResult(C,js.findRowsWithPattern(h,N,_,f,b,js.STOP_PATTERN),js.INDEXES_STOP_PATTERN),C}static copyToResult(h,f,b){for(let N=0;N<b.length;N++)h[b[N]]=f[N]}static findRowsWithPattern(h,f,b,N,_,C){const M=new Array(4);let L=!1;const z=new Int32Array(C.length);for(;N<f;N+=js.ROW_STEP){let ue=js.findGuardPattern(h,_,N,b,!1,C,z);if(ue!=null){for(;N>0;){const pe=js.findGuardPattern(h,_,--N,b,!1,C,z);if(pe!=null)ue=pe;else{N++;break}}M[0]=new Ae(ue[0],N),M[1]=new Ae(ue[1],N),L=!0;break}}let re=N+1;if(L){let ue=0,pe=Int32Array.from([Math.trunc(M[0].getX()),Math.trunc(M[1].getX())]);for(;re<f;re++){const Se=js.findGuardPattern(h,pe[0],re,b,!1,C,z);if(Se!=null&&Math.abs(pe[0]-Se[0])<js.MAX_PATTERN_DRIFT&&Math.abs(pe[1]-Se[1])<js.MAX_PATTERN_DRIFT)pe=Se,ue=0;else{if(ue>js.SKIPPED_ROW_COUNT_MAX)break;ue++}}re-=ue+1,M[2]=new Ae(pe[0],re),M[3]=new Ae(pe[1],re)}return re-N<js.BARCODE_MIN_HEIGHT&&E.fill(M,null),M}static findGuardPattern(h,f,b,N,_,C,M){E.fillWithin(M,0,M.length,0);let L=f,z=0;for(;h.get(L,b)&&L>0&&z++<js.MAX_PIXEL_DRIFT;)L--;let re=L,ue=0,pe=C.length;for(let Se=_;re<N;re++)if(h.get(re,b)!==Se)M[ue]++;else{if(ue===pe-1){if(js.patternMatchVariance(M,C,js.MAX_INDIVIDUAL_VARIANCE)<js.MAX_AVG_VARIANCE)return new Int32Array([L,re]);L+=M[0]+M[1],j.arraycopy(M,2,M,0,ue-1),M[ue-1]=0,M[ue]=0,ue--}else ue++;M[ue]=1,Se=!Se}return ue===pe-1&&js.patternMatchVariance(M,C,js.MAX_INDIVIDUAL_VARIANCE)<js.MAX_AVG_VARIANCE?new Int32Array([L,re-1]):null}static patternMatchVariance(h,f,b){let N=h.length,_=0,C=0;for(let z=0;z<N;z++)_+=h[z],C+=f[z];if(_<C)return 1/0;let M=_/C;b*=M;let L=0;for(let z=0;z<N;z++){let re=h[z],ue=f[z]*M,pe=re>ue?re-ue:ue-re;if(pe>b)return 1/0;L+=pe}return L/_}}js.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),js.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),js.MAX_AVG_VARIANCE=.42,js.MAX_INDIVIDUAL_VARIANCE=.8,js.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),js.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),js.MAX_PIXEL_DRIFT=3,js.MAX_PATTERN_DRIFT=5,js.SKIPPED_ROW_COUNT_MAX=25,js.ROW_STEP=5,js.BARCODE_MIN_HEIGHT=10;class Zr{constructor(h,f){if(f.length===0)throw new x;this.field=h;let b=f.length;if(b>1&&f[0]===0){let N=1;for(;N<b&&f[N]===0;)N++;N===b?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(b-N),j.arraycopy(f,N,this.coefficients,0,this.coefficients.length))}else this.coefficients=f}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(h){return this.coefficients[this.coefficients.length-1-h]}evaluateAt(h){if(h===0)return this.getCoefficient(0);if(h===1){let N=0;for(let _ of this.coefficients)N=this.field.add(N,_);return N}let f=this.coefficients[0],b=this.coefficients.length;for(let N=1;N<b;N++)f=this.field.add(this.field.multiply(h,f),this.coefficients[N]);return f}add(h){if(!this.field.equals(h.field))throw new x("ModulusPolys do not have same ModulusGF field");if(this.isZero())return h;if(h.isZero())return this;let f=this.coefficients,b=h.coefficients;if(f.length>b.length){let C=f;f=b,b=C}let N=new Int32Array(b.length),_=b.length-f.length;j.arraycopy(b,0,N,0,_);for(let C=_;C<b.length;C++)N[C]=this.field.add(f[C-_],b[C]);return new Zr(this.field,N)}subtract(h){if(!this.field.equals(h.field))throw new x("ModulusPolys do not have same ModulusGF field");return h.isZero()?this:this.add(h.negative())}multiply(h){return h instanceof Zr?this.multiplyOther(h):this.multiplyScalar(h)}multiplyOther(h){if(!this.field.equals(h.field))throw new x("ModulusPolys do not have same ModulusGF field");if(this.isZero()||h.isZero())return new Zr(this.field,new Int32Array([0]));let f=this.coefficients,b=f.length,N=h.coefficients,_=N.length,C=new Int32Array(b+_-1);for(let M=0;M<b;M++){let L=f[M];for(let z=0;z<_;z++)C[M+z]=this.field.add(C[M+z],this.field.multiply(L,N[z]))}return new Zr(this.field,C)}negative(){let h=this.coefficients.length,f=new Int32Array(h);for(let b=0;b<h;b++)f[b]=this.field.subtract(0,this.coefficients[b]);return new Zr(this.field,f)}multiplyScalar(h){if(h===0)return new Zr(this.field,new Int32Array([0]));if(h===1)return this;let f=this.coefficients.length,b=new Int32Array(f);for(let N=0;N<f;N++)b[N]=this.field.multiply(this.coefficients[N],h);return new Zr(this.field,b)}multiplyByMonomial(h,f){if(h<0)throw new x;if(f===0)return new Zr(this.field,new Int32Array([0]));let b=this.coefficients.length,N=new Int32Array(b+h);for(let _=0;_<b;_++)N[_]=this.field.multiply(this.coefficients[_],f);return new Zr(this.field,N)}toString(){let h=new V;for(let f=this.getDegree();f>=0;f--){let b=this.getCoefficient(f);b!==0&&(b<0?(h.append(" - "),b=-b):h.length()>0&&h.append(" + "),(f===0||b!==1)&&h.append(b),f!==0&&(f===1?h.append("x"):(h.append("x^"),h.append(f))))}return h.toString()}}class gS{add(h,f){return(h+f)%this.modulus}subtract(h,f){return(this.modulus+h-f)%this.modulus}exp(h){return this.expTable[h]}log(h){if(h===0)throw new x;return this.logTable[h]}inverse(h){if(h===0)throw new oe;return this.expTable[this.modulus-this.logTable[h]-1]}multiply(h,f){return h===0||f===0?0:this.expTable[(this.logTable[h]+this.logTable[f])%(this.modulus-1)]}getSize(){return this.modulus}equals(h){return h===this}}class fu extends gS{constructor(h,f){super(),this.modulus=h,this.expTable=new Int32Array(h),this.logTable=new Int32Array(h);let b=1;for(let N=0;N<h;N++)this.expTable[N]=b,b=b*f%h;for(let N=0;N<h-1;N++)this.logTable[this.expTable[N]]=N;this.zero=new Zr(this,new Int32Array([0])),this.one=new Zr(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(h,f){if(h<0)throw new x;if(f===0)return this.zero;let b=new Int32Array(h+1);return b[0]=f,new Zr(this,b)}}fu.PDF417_GF=new fu(ls.NUMBER_OF_CODEWORDS,3);class Xf{constructor(){this.field=fu.PDF417_GF}decode(h,f,b){let N=new Zr(this.field,h),_=new Int32Array(f),C=!1;for(let Ie=f;Ie>0;Ie--){let Be=N.evaluateAt(this.field.exp(Ie));_[f-Ie]=Be,Be!==0&&(C=!0)}if(!C)return 0;let M=this.field.getOne();if(b!=null)for(const Ie of b){let Be=this.field.exp(h.length-1-Ie),Xe=new Zr(this.field,new Int32Array([this.field.subtract(0,Be),1]));M=M.multiply(Xe)}let L=new Zr(this.field,_),z=this.runEuclideanAlgorithm(this.field.buildMonomial(f,1),L,f),re=z[0],ue=z[1],pe=this.findErrorLocations(re),Se=this.findErrorMagnitudes(ue,re,pe);for(let Ie=0;Ie<pe.length;Ie++){let Be=h.length-1-this.field.log(pe[Ie]);if(Be<0)throw y.getChecksumInstance();h[Be]=this.field.subtract(h[Be],Se[Ie])}return pe.length}runEuclideanAlgorithm(h,f,b){if(h.getDegree()<f.getDegree()){let pe=h;h=f,f=pe}let N=h,_=f,C=this.field.getZero(),M=this.field.getOne();for(;_.getDegree()>=Math.round(b/2);){let pe=N,Se=C;if(N=_,C=M,N.isZero())throw y.getChecksumInstance();_=pe;let Ie=this.field.getZero(),Be=N.getCoefficient(N.getDegree()),Xe=this.field.inverse(Be);for(;_.getDegree()>=N.getDegree()&&!_.isZero();){let nt=_.getDegree()-N.getDegree(),Ct=this.field.multiply(_.getCoefficient(_.getDegree()),Xe);Ie=Ie.add(this.field.buildMonomial(nt,Ct)),_=_.subtract(N.multiplyByMonomial(nt,Ct))}M=Ie.multiply(C).subtract(Se).negative()}let L=M.getCoefficient(0);if(L===0)throw y.getChecksumInstance();let z=this.field.inverse(L),re=M.multiply(z),ue=_.multiply(z);return[re,ue]}findErrorLocations(h){let f=h.getDegree(),b=new Int32Array(f),N=0;for(let _=1;_<this.field.getSize()&&N<f;_++)h.evaluateAt(_)===0&&(b[N]=this.field.inverse(_),N++);if(N!==f)throw y.getChecksumInstance();return b}findErrorMagnitudes(h,f,b){let N=f.getDegree(),_=new Int32Array(N);for(let z=1;z<=N;z++)_[N-z]=this.field.multiply(z,f.getCoefficient(z));let C=new Zr(this.field,_),M=b.length,L=new Int32Array(M);for(let z=0;z<M;z++){let re=this.field.inverse(b[z]),ue=this.field.subtract(0,h.evaluateAt(re)),pe=this.field.inverse(C.evaluateAt(re));L[z]=this.field.multiply(ue,pe)}return L}}class Sc{constructor(h,f,b,N,_){h instanceof Sc?this.constructor_2(h):this.constructor_1(h,f,b,N,_)}constructor_1(h,f,b,N,_){const C=f==null||b==null,M=N==null||_==null;if(C&&M)throw new F;C?(f=new Ae(0,N.getY()),b=new Ae(0,_.getY())):M&&(N=new Ae(h.getWidth()-1,f.getY()),_=new Ae(h.getWidth()-1,b.getY())),this.image=h,this.topLeft=f,this.bottomLeft=b,this.topRight=N,this.bottomRight=_,this.minX=Math.trunc(Math.min(f.getX(),b.getX())),this.maxX=Math.trunc(Math.max(N.getX(),_.getX())),this.minY=Math.trunc(Math.min(f.getY(),N.getY())),this.maxY=Math.trunc(Math.max(b.getY(),_.getY()))}constructor_2(h){this.image=h.image,this.topLeft=h.getTopLeft(),this.bottomLeft=h.getBottomLeft(),this.topRight=h.getTopRight(),this.bottomRight=h.getBottomRight(),this.minX=h.getMinX(),this.maxX=h.getMaxX(),this.minY=h.getMinY(),this.maxY=h.getMaxY()}static merge(h,f){return h==null?f:f==null?h:new Sc(h.image,h.topLeft,h.bottomLeft,f.topRight,f.bottomRight)}addMissingRows(h,f,b){let N=this.topLeft,_=this.bottomLeft,C=this.topRight,M=this.bottomRight;if(h>0){let L=b?this.topLeft:this.topRight,z=Math.trunc(L.getY()-h);z<0&&(z=0);let re=new Ae(L.getX(),z);b?N=re:C=re}if(f>0){let L=b?this.bottomLeft:this.bottomRight,z=Math.trunc(L.getY()+f);z>=this.image.getHeight()&&(z=this.image.getHeight()-1);let re=new Ae(L.getX(),z);b?_=re:M=re}return new Sc(this.image,N,_,C,M)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Ly{constructor(h,f,b,N){this.columnCount=h,this.errorCorrectionLevel=N,this.rowCountUpperPart=f,this.rowCountLowerPart=b,this.rowCount=f+b}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class gu{constructor(){this.buffer=""}static form(h,f){let b=-1;function N(C,M,L,z,re,ue){if(C==="%%")return"%";if(f[++b]===void 0)return;C=z?parseInt(z.substr(1)):void 0;let pe=re?parseInt(re.substr(1)):void 0,Se;switch(ue){case"s":Se=f[b];break;case"c":Se=f[b][0];break;case"f":Se=parseFloat(f[b]).toFixed(C);break;case"p":Se=parseFloat(f[b]).toPrecision(C);break;case"e":Se=parseFloat(f[b]).toExponential(C);break;case"x":Se=parseInt(f[b]).toString(pe||16);break;case"d":Se=parseFloat(parseInt(f[b],pe||10).toPrecision(C)).toFixed(0);break}Se=typeof Se=="object"?JSON.stringify(Se):(+Se).toString(pe);let Ie=parseInt(L),Be=L&&L[0]+""=="0"?"0":" ";for(;Se.length<Ie;)Se=M!==void 0?Se+Be:Be+Se;return Se}let _=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return h.replace(_,N)}format(h,...f){this.buffer+=gu.form(h,f)}toString(){return this.buffer}}class bu{constructor(h){this.boundingBox=new Sc(h),this.codewords=new Array(h.getMaxY()-h.getMinY()+1)}getCodewordNearby(h){let f=this.getCodeword(h);if(f!=null)return f;for(let b=1;b<bu.MAX_NEARBY_DISTANCE;b++){let N=this.imageRowToCodewordIndex(h)-b;if(N>=0&&(f=this.codewords[N],f!=null)||(N=this.imageRowToCodewordIndex(h)+b,N<this.codewords.length&&(f=this.codewords[N],f!=null)))return f}return null}imageRowToCodewordIndex(h){return h-this.boundingBox.getMinY()}setCodeword(h,f){this.codewords[this.imageRowToCodewordIndex(h)]=f}getCodeword(h){return this.codewords[this.imageRowToCodewordIndex(h)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const h=new gu;let f=0;for(const b of this.codewords){if(b==null){h.format("%3d:    |   %n",f++);continue}h.format("%3d: %3d|%3d%n",f++,b.getRowNumber(),b.getValue())}return h.toString()}}bu.MAX_NEARBY_DISTANCE=5;class yu{constructor(){this.values=new Map}setValue(h){h=Math.trunc(h);let f=this.values.get(h);f==null&&(f=0),f++,this.values.set(h,f)}getValue(){let h=-1,f=new Array;for(const[b,N]of this.values.entries()){const _={getKey:()=>b,getValue:()=>N};_.getValue()>h?(h=_.getValue(),f=[],f.push(_.getKey())):_.getValue()===h&&f.push(_.getKey())}return ls.toIntArray(f)}getConfidence(h){return this.values.get(h)}}class Qf extends bu{constructor(h,f){super(h),this._isLeft=f}setRowNumbers(){for(let h of this.getCodewords())h!=null&&h.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(h){let f=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(f,h);let b=this.getBoundingBox(),N=this._isLeft?b.getTopLeft():b.getTopRight(),_=this._isLeft?b.getBottomLeft():b.getBottomRight(),C=this.imageRowToCodewordIndex(Math.trunc(N.getY())),M=this.imageRowToCodewordIndex(Math.trunc(_.getY())),L=-1,z=1,re=0;for(let ue=C;ue<M;ue++){if(f[ue]==null)continue;let pe=f[ue],Se=pe.getRowNumber()-L;if(Se===0)re++;else if(Se===1)z=Math.max(z,re),re=1,L=pe.getRowNumber();else if(Se<0||pe.getRowNumber()>=h.getRowCount()||Se>ue)f[ue]=null;else{let Ie;z>2?Ie=(z-2)*Se:Ie=Se;let Be=Ie>=ue;for(let Xe=1;Xe<=Ie&&!Be;Xe++)Be=f[ue-Xe]!=null;Be?f[ue]=null:(L=pe.getRowNumber(),re=1)}}}getRowHeights(){let h=this.getBarcodeMetadata();if(h==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(h);let f=new Int32Array(h.getRowCount());for(let b of this.getCodewords())if(b!=null){let N=b.getRowNumber();if(N>=f.length)continue;f[N]++}return f}adjustIncompleteIndicatorColumnRowNumbers(h){let f=this.getBoundingBox(),b=this._isLeft?f.getTopLeft():f.getTopRight(),N=this._isLeft?f.getBottomLeft():f.getBottomRight(),_=this.imageRowToCodewordIndex(Math.trunc(b.getY())),C=this.imageRowToCodewordIndex(Math.trunc(N.getY())),M=this.getCodewords(),L=-1;for(let z=_;z<C;z++){if(M[z]==null)continue;let re=M[z];re.setRowNumberAsRowIndicatorColumn();let ue=re.getRowNumber()-L;ue===0||(ue===1?L=re.getRowNumber():re.getRowNumber()>=h.getRowCount()?M[z]=null:L=re.getRowNumber())}}getBarcodeMetadata(){let h=this.getCodewords(),f=new yu,b=new yu,N=new yu,_=new yu;for(let M of h){if(M==null)continue;M.setRowNumberAsRowIndicatorColumn();let L=M.getValue()%30,z=M.getRowNumber();switch(this._isLeft||(z+=2),z%3){case 0:b.setValue(L*3+1);break;case 1:_.setValue(L/3),N.setValue(L%3);break;case 2:f.setValue(L+1);break}}if(f.getValue().length===0||b.getValue().length===0||N.getValue().length===0||_.getValue().length===0||f.getValue()[0]<1||b.getValue()[0]+N.getValue()[0]<ls.MIN_ROWS_IN_BARCODE||b.getValue()[0]+N.getValue()[0]>ls.MAX_ROWS_IN_BARCODE)return null;let C=new Ly(f.getValue()[0],b.getValue()[0],N.getValue()[0],_.getValue()[0]);return this.removeIncorrectCodewords(h,C),C}removeIncorrectCodewords(h,f){for(let b=0;b<h.length;b++){let N=h[b];if(h[b]==null)continue;let _=N.getValue()%30,C=N.getRowNumber();if(C>f.getRowCount()){h[b]=null;continue}switch(this._isLeft||(C+=2),C%3){case 0:_*3+1!==f.getRowCountUpperPart()&&(h[b]=null);break;case 1:(Math.trunc(_/3)!==f.getErrorCorrectionLevel()||_%3!==f.getRowCountLowerPart())&&(h[b]=null);break;case 2:_+1!==f.getColumnCount()&&(h[b]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class vu{constructor(h,f){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=h,this.barcodeColumnCount=h.getColumnCount(),this.boundingBox=f,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let h=ls.MAX_CODEWORDS_IN_BARCODE,f;do f=h,h=this.adjustRowNumbersAndGetCount();while(h>0&&h<f);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(h){h!=null&&h.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let h=this.adjustRowNumbersByRow();if(h===0)return 0;for(let f=1;f<this.barcodeColumnCount+1;f++){let b=this.detectionResultColumns[f].getCodewords();for(let N=0;N<b.length;N++)b[N]!=null&&(b[N].hasValidRowNumber()||this.adjustRowNumbers(f,N,b))}return h}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let h=this.detectionResultColumns[0].getCodewords(),f=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let b=0;b<h.length;b++)if(h[b]!=null&&f[b]!=null&&h[b].getRowNumber()===f[b].getRowNumber())for(let N=1;N<=this.barcodeColumnCount;N++){let _=this.detectionResultColumns[N].getCodewords()[b];_!=null&&(_.setRowNumber(h[b].getRowNumber()),_.hasValidRowNumber()||(this.detectionResultColumns[N].getCodewords()[b]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let h=0,f=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let b=0;b<f.length;b++){if(f[b]==null)continue;let N=f[b].getRowNumber(),_=0;for(let C=this.barcodeColumnCount+1;C>0&&_<this.ADJUST_ROW_NUMBER_SKIP;C--){let M=this.detectionResultColumns[C].getCodewords()[b];M!=null&&(_=vu.adjustRowNumberIfValid(N,_,M),M.hasValidRowNumber()||h++)}}return h}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let h=0,f=this.detectionResultColumns[0].getCodewords();for(let b=0;b<f.length;b++){if(f[b]==null)continue;let N=f[b].getRowNumber(),_=0;for(let C=1;C<this.barcodeColumnCount+1&&_<this.ADJUST_ROW_NUMBER_SKIP;C++){let M=this.detectionResultColumns[C].getCodewords()[b];M!=null&&(_=vu.adjustRowNumberIfValid(N,_,M),M.hasValidRowNumber()||h++)}}return h}static adjustRowNumberIfValid(h,f,b){return b==null||b.hasValidRowNumber()||(b.isValidRowNumber(h)?(b.setRowNumber(h),f=0):++f),f}adjustRowNumbers(h,f,b){if(!this.detectionResultColumns[h-1])return;let N=b[f],_=this.detectionResultColumns[h-1].getCodewords(),C=_;this.detectionResultColumns[h+1]!=null&&(C=this.detectionResultColumns[h+1].getCodewords());let M=new Array(14);M[2]=_[f],M[3]=C[f],f>0&&(M[0]=b[f-1],M[4]=_[f-1],M[5]=C[f-1]),f>1&&(M[8]=b[f-2],M[10]=_[f-2],M[11]=C[f-2]),f<b.length-1&&(M[1]=b[f+1],M[6]=_[f+1],M[7]=C[f+1]),f<b.length-2&&(M[9]=b[f+2],M[12]=_[f+2],M[13]=C[f+2]);for(let L of M)if(vu.adjustRowNumber(N,L))return}static adjustRowNumber(h,f){return f==null?!1:f.hasValidRowNumber()&&f.getBucket()===h.getBucket()?(h.setRowNumber(f.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(h){this.boundingBox=h}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(h,f){this.detectionResultColumns[h]=f}getDetectionResultColumn(h){return this.detectionResultColumns[h]}toString(){let h=this.detectionResultColumns[0];h==null&&(h=this.detectionResultColumns[this.barcodeColumnCount+1]);let f=new gu;for(let b=0;b<h.getCodewords().length;b++){f.format("CW %3d:",b);for(let N=0;N<this.barcodeColumnCount+2;N++){if(this.detectionResultColumns[N]==null){f.format("    |   ");continue}let _=this.detectionResultColumns[N].getCodewords()[b];if(_==null){f.format("    |   ");continue}f.format(" %3d|%3d",_.getRowNumber(),_.getValue())}f.format("%n")}return f.toString()}}class ju{constructor(h,f,b,N){this.rowNumber=ju.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(h),this.endX=Math.trunc(f),this.bucket=Math.trunc(b),this.value=Math.trunc(N)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(h){return h!==ju.BARCODE_ROW_UNKNOWN&&this.bucket===h%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(h){this.rowNumber=h}toString(){return this.rowNumber+"|"+this.value}}ju.BARCODE_ROW_UNKNOWN=-1;class Pa{static initialize(){for(let h=0;h<ls.SYMBOL_TABLE.length;h++){let f=ls.SYMBOL_TABLE[h],b=f&1;for(let N=0;N<ls.BARS_IN_MODULE;N++){let _=0;for(;(f&1)===b;)_+=1,f>>=1;b=f&1,Pa.RATIOS_TABLE[h]||(Pa.RATIOS_TABLE[h]=new Array(ls.BARS_IN_MODULE)),Pa.RATIOS_TABLE[h][ls.BARS_IN_MODULE-N-1]=Math.fround(_/ls.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(h){let f=Pa.getDecodedCodewordValue(Pa.sampleBitCounts(h));return f!==-1?f:Pa.getClosestDecodedValue(h)}static sampleBitCounts(h){let f=fe.sum(h),b=new Int32Array(ls.BARS_IN_MODULE),N=0,_=0;for(let C=0;C<ls.MODULES_IN_CODEWORD;C++){let M=f/(2*ls.MODULES_IN_CODEWORD)+C*f/ls.MODULES_IN_CODEWORD;_+h[N]<=M&&(_+=h[N],N++),b[N]++}return b}static getDecodedCodewordValue(h){let f=Pa.getBitValue(h);return ls.getCodeword(f)===-1?-1:f}static getBitValue(h){let f=0;for(let b=0;b<h.length;b++)for(let N=0;N<h[b];N++)f=f<<1|(b%2===0?1:0);return Math.trunc(f)}static getClosestDecodedValue(h){let f=fe.sum(h),b=new Array(ls.BARS_IN_MODULE);if(f>1)for(let C=0;C<b.length;C++)b[C]=Math.fround(h[C]/f);let N=Me.MAX_VALUE,_=-1;this.bSymbolTableReady||Pa.initialize();for(let C=0;C<Pa.RATIOS_TABLE.length;C++){let M=0,L=Pa.RATIOS_TABLE[C];for(let z=0;z<ls.BARS_IN_MODULE;z++){let re=Math.fround(L[z]-b[z]);if(M+=Math.fround(re*re),M>=N)break}M<N&&(N=M,_=ls.SYMBOL_TABLE[C])}return _}}Pa.bSymbolTableReady=!1,Pa.RATIOS_TABLE=new Array(ls.SYMBOL_TABLE.length).map(de=>new Array(ls.BARS_IN_MODULE));class Zf{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(h){this.segmentIndex=h}getFileId(){return this.fileId}setFileId(h){this.fileId=h}getOptionalData(){return this.optionalData}setOptionalData(h){this.optionalData=h}isLastSegment(){return this.lastSegment}setLastSegment(h){this.lastSegment=h}getSegmentCount(){return this.segmentCount}setSegmentCount(h){this.segmentCount=h}getSender(){return this.sender||null}setSender(h){this.sender=h}getAddressee(){return this.addressee||null}setAddressee(h){this.addressee=h}getFileName(){return this.fileName}setFileName(h){this.fileName=h}getFileSize(){return this.fileSize}setFileSize(h){this.fileSize=h}getChecksum(){return this.checksum}setChecksum(h){this.checksum=h}getTimestamp(){return this.timestamp}setTimestamp(h){this.timestamp=h}}class Jf{static parseLong(h,f=void 0){return parseInt(h,f)}}class we extends u{}we.kind="NullPointerException";class Dt{writeBytes(h){this.writeBytesOffset(h,0,h.length)}writeBytesOffset(h,f,b){if(h==null)throw new we;if(f<0||f>h.length||b<0||f+b>h.length||f+b<0)throw new w;if(b===0)return;for(let N=0;N<b;N++)this.write(h[f+N])}flush(){}close(){}}class Ot extends u{}class ys extends Dt{constructor(h=32){if(super(),this.count=0,h<0)throw new x("Negative initial size: "+h);this.buf=new Uint8Array(h)}ensureCapacity(h){h-this.buf.length>0&&this.grow(h)}grow(h){let b=this.buf.length<<1;if(b-h<0&&(b=h),b<0){if(h<0)throw new Ot;b=k.MAX_VALUE}this.buf=E.copyOfUint8Array(this.buf,b)}write(h){this.ensureCapacity(this.count+1),this.buf[this.count]=h,this.count+=1}writeBytesOffset(h,f,b){if(f<0||f>h.length||b<0||f+b-h.length>0)throw new w;this.ensureCapacity(this.count+b),j.arraycopy(h,f,this.buf,this.count,b),this.count+=b}writeTo(h){h.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return E.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(h){return h?typeof h=="string"?this.toString_string(h):this.toString_number(h):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(h){return new String(this.buf).toString()}toString_number(h){return new String(this.buf).toString()}close(){}}var Gs;(function(de){de[de.ALPHA=0]="ALPHA",de[de.LOWER=1]="LOWER",de[de.MIXED=2]="MIXED",de[de.PUNCT=3]="PUNCT",de[de.ALPHA_SHIFT=4]="ALPHA_SHIFT",de[de.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Gs||(Gs={}));function e0(){if(typeof window<"u")return window.BigInt||null;if(typeof n0<"u")return n0.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Fy;function Nu(de){if(typeof Fy>"u"&&(Fy=e0()),Fy===null)throw new Error("BigInt is not supported!");return Fy(de)}function Dne(){let de=[];de[0]=Nu(1);let h=Nu(900);de[1]=h;for(let f=2;f<16;f++)de[f]=de[f-1]*h;return de}class st{static decode(h,f){let b=new V(""),N=T.ISO8859_1;b.enableDecoding(N);let _=1,C=h[_++],M=new Zf;for(;_<h[0];){switch(C){case st.TEXT_COMPACTION_MODE_LATCH:_=st.textCompaction(h,_,b);break;case st.BYTE_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH_6:_=st.byteCompaction(C,h,N,_,b);break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:b.append(h[_++]);break;case st.NUMERIC_COMPACTION_MODE_LATCH:_=st.numericCompaction(h,_,b);break;case st.ECI_CHARSET:T.getCharacterSetECIByValue(h[_++]);break;case st.ECI_GENERAL_PURPOSE:_+=2;break;case st.ECI_USER_DEFINED:_++;break;case st.BEGIN_MACRO_PDF417_CONTROL_BLOCK:_=st.decodeMacroBlock(h,_,M);break;case st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case st.MACRO_PDF417_TERMINATOR:throw new O;default:_--,_=st.textCompaction(h,_,b);break}if(_<h.length)C=h[_++];else throw O.getFormatInstance()}if(b.length()===0)throw O.getFormatInstance();let L=new Z(null,b.toString(),null,f);return L.setOther(M),L}static decodeMacroBlock(h,f,b){if(f+st.NUMBER_OF_SEQUENCE_CODEWORDS>h[0])throw O.getFormatInstance();let N=new Int32Array(st.NUMBER_OF_SEQUENCE_CODEWORDS);for(let M=0;M<st.NUMBER_OF_SEQUENCE_CODEWORDS;M++,f++)N[M]=h[f];b.setSegmentIndex(k.parseInt(st.decodeBase900toBase10(N,st.NUMBER_OF_SEQUENCE_CODEWORDS)));let _=new V;f=st.textCompaction(h,f,_),b.setFileId(_.toString());let C=-1;for(h[f]===st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(C=f+1);f<h[0];)switch(h[f]){case st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(f++,h[f]){case st.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let M=new V;f=st.textCompaction(h,f+1,M),b.setFileName(M.toString());break;case st.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let L=new V;f=st.textCompaction(h,f+1,L),b.setSender(L.toString());break;case st.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let z=new V;f=st.textCompaction(h,f+1,z),b.setAddressee(z.toString());break;case st.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let re=new V;f=st.numericCompaction(h,f+1,re),b.setSegmentCount(k.parseInt(re.toString()));break;case st.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let ue=new V;f=st.numericCompaction(h,f+1,ue),b.setTimestamp(Jf.parseLong(ue.toString()));break;case st.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let pe=new V;f=st.numericCompaction(h,f+1,pe),b.setChecksum(k.parseInt(pe.toString()));break;case st.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let Se=new V;f=st.numericCompaction(h,f+1,Se),b.setFileSize(Jf.parseLong(Se.toString()));break;default:throw O.getFormatInstance()}break;case st.MACRO_PDF417_TERMINATOR:f++,b.setLastSegment(!0);break;default:throw O.getFormatInstance()}if(C!==-1){let M=f-C;b.isLastSegment()&&M--,b.setOptionalData(E.copyOfRange(h,C,C+M))}return f}static textCompaction(h,f,b){let N=new Int32Array((h[0]-f)*2),_=new Int32Array((h[0]-f)*2),C=0,M=!1;for(;f<h[0]&&!M;){let L=h[f++];if(L<st.TEXT_COMPACTION_MODE_LATCH)N[C]=L/30,N[C+1]=L%30,C+=2;else switch(L){case st.TEXT_COMPACTION_MODE_LATCH:N[C++]=st.TEXT_COMPACTION_MODE_LATCH;break;case st.BYTE_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH_6:case st.NUMERIC_COMPACTION_MODE_LATCH:case st.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case st.MACRO_PDF417_TERMINATOR:f--,M=!0;break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:N[C]=st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,L=h[f++],_[C]=L,C++;break}}return st.decodeTextCompaction(N,_,C,b),f}static decodeTextCompaction(h,f,b,N){let _=Gs.ALPHA,C=Gs.ALPHA,M=0;for(;M<b;){let L=h[M],z="";switch(_){case Gs.ALPHA:if(L<26)z=String.fromCharCode(65+L);else switch(L){case 26:z=" ";break;case st.LL:_=Gs.LOWER;break;case st.ML:_=Gs.MIXED;break;case st.PS:C=_,_=Gs.PUNCT_SHIFT;break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:N.append(f[M]);break;case st.TEXT_COMPACTION_MODE_LATCH:_=Gs.ALPHA;break}break;case Gs.LOWER:if(L<26)z=String.fromCharCode(97+L);else switch(L){case 26:z=" ";break;case st.AS:C=_,_=Gs.ALPHA_SHIFT;break;case st.ML:_=Gs.MIXED;break;case st.PS:C=_,_=Gs.PUNCT_SHIFT;break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:N.append(f[M]);break;case st.TEXT_COMPACTION_MODE_LATCH:_=Gs.ALPHA;break}break;case Gs.MIXED:if(L<st.PL)z=st.MIXED_CHARS[L];else switch(L){case st.PL:_=Gs.PUNCT;break;case 26:z=" ";break;case st.LL:_=Gs.LOWER;break;case st.AL:_=Gs.ALPHA;break;case st.PS:C=_,_=Gs.PUNCT_SHIFT;break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:N.append(f[M]);break;case st.TEXT_COMPACTION_MODE_LATCH:_=Gs.ALPHA;break}break;case Gs.PUNCT:if(L<st.PAL)z=st.PUNCT_CHARS[L];else switch(L){case st.PAL:_=Gs.ALPHA;break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:N.append(f[M]);break;case st.TEXT_COMPACTION_MODE_LATCH:_=Gs.ALPHA;break}break;case Gs.ALPHA_SHIFT:if(_=C,L<26)z=String.fromCharCode(65+L);else switch(L){case 26:z=" ";break;case st.TEXT_COMPACTION_MODE_LATCH:_=Gs.ALPHA;break}break;case Gs.PUNCT_SHIFT:if(_=C,L<st.PAL)z=st.PUNCT_CHARS[L];else switch(L){case st.PAL:_=Gs.ALPHA;break;case st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:N.append(f[M]);break;case st.TEXT_COMPACTION_MODE_LATCH:_=Gs.ALPHA;break}break}z!==""&&N.append(z),M++}}static byteCompaction(h,f,b,N,_){let C=new ys,M=0,L=0,z=!1;switch(h){case st.BYTE_COMPACTION_MODE_LATCH:let re=new Int32Array(6),ue=f[N++];for(;N<f[0]&&!z;)switch(re[M++]=ue,L=900*L+ue,ue=f[N++],ue){case st.TEXT_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH:case st.NUMERIC_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH_6:case st.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case st.MACRO_PDF417_TERMINATOR:N--,z=!0;break;default:if(M%5===0&&M>0){for(let pe=0;pe<6;++pe)C.write(Number(Nu(L)>>Nu(8*(5-pe))));L=0,M=0}break}N===f[0]&&ue<st.TEXT_COMPACTION_MODE_LATCH&&(re[M++]=ue);for(let pe=0;pe<M;pe++)C.write(re[pe]);break;case st.BYTE_COMPACTION_MODE_LATCH_6:for(;N<f[0]&&!z;){let pe=f[N++];if(pe<st.TEXT_COMPACTION_MODE_LATCH)M++,L=900*L+pe;else switch(pe){case st.TEXT_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH:case st.NUMERIC_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH_6:case st.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case st.MACRO_PDF417_TERMINATOR:N--,z=!0;break}if(M%5===0&&M>0){for(let Se=0;Se<6;++Se)C.write(Number(Nu(L)>>Nu(8*(5-Se))));L=0,M=0}}break}return _.append(U.decode(C.toByteArray(),b)),N}static numericCompaction(h,f,b){let N=0,_=!1,C=new Int32Array(st.MAX_NUMERIC_CODEWORDS);for(;f<h[0]&&!_;){let M=h[f++];if(f===h[0]&&(_=!0),M<st.TEXT_COMPACTION_MODE_LATCH)C[N]=M,N++;else switch(M){case st.TEXT_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH:case st.BYTE_COMPACTION_MODE_LATCH_6:case st.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case st.MACRO_PDF417_TERMINATOR:f--,_=!0;break}(N%st.MAX_NUMERIC_CODEWORDS===0||M===st.NUMERIC_COMPACTION_MODE_LATCH||_)&&N>0&&(b.append(st.decodeBase900toBase10(C,N)),N=0)}return f}static decodeBase900toBase10(h,f){let b=Nu(0);for(let _=0;_<f;_++)b+=st.EXP900[f-_-1]*Nu(h[_]);let N=b.toString();if(N.charAt(0)!=="1")throw new O;return N.substring(1)}}st.TEXT_COMPACTION_MODE_LATCH=900,st.BYTE_COMPACTION_MODE_LATCH=901,st.NUMERIC_COMPACTION_MODE_LATCH=902,st.BYTE_COMPACTION_MODE_LATCH_6=924,st.ECI_USER_DEFINED=925,st.ECI_GENERAL_PURPOSE=926,st.ECI_CHARSET=927,st.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,st.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,st.MACRO_PDF417_TERMINATOR=922,st.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,st.MAX_NUMERIC_CODEWORDS=15,st.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,st.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,st.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,st.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,st.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,st.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,st.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,st.PL=25,st.LL=27,st.AS=27,st.ML=28,st.AL=28,st.PS=29,st.PAL=29,st.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,st.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",st.EXP900=e0()?Dne():[],st.NUMBER_OF_SEQUENCE_CODEWORDS=2;class ks{constructor(){}static decode(h,f,b,N,_,C,M){let L=new Sc(h,f,b,N,_),z=null,re=null,ue;for(let Ie=!0;;Ie=!1){if(f!=null&&(z=ks.getRowIndicatorColumn(h,L,f,!0,C,M)),N!=null&&(re=ks.getRowIndicatorColumn(h,L,N,!1,C,M)),ue=ks.merge(z,re),ue==null)throw F.getNotFoundInstance();let Be=ue.getBoundingBox();if(Ie&&Be!=null&&(Be.getMinY()<L.getMinY()||Be.getMaxY()>L.getMaxY()))L=Be;else break}ue.setBoundingBox(L);let pe=ue.getBarcodeColumnCount()+1;ue.setDetectionResultColumn(0,z),ue.setDetectionResultColumn(pe,re);let Se=z!=null;for(let Ie=1;Ie<=pe;Ie++){let Be=Se?Ie:pe-Ie;if(ue.getDetectionResultColumn(Be)!==void 0)continue;let Xe;Be===0||Be===pe?Xe=new Qf(L,Be===0):Xe=new bu(L),ue.setDetectionResultColumn(Be,Xe);let nt=-1,Ct=nt;for(let kt=L.getMinY();kt<=L.getMaxY();kt++){if(nt=ks.getStartColumn(ue,Be,kt,Se),nt<0||nt>L.getMaxX()){if(Ct===-1)continue;nt=Ct}let wt=ks.detectCodeword(h,L.getMinX(),L.getMaxX(),Se,nt,kt,C,M);wt!=null&&(Xe.setCodeword(kt,wt),Ct=nt,C=Math.min(C,wt.getWidth()),M=Math.max(M,wt.getWidth()))}}return ks.createDecoderResult(ue)}static merge(h,f){if(h==null&&f==null)return null;let b=ks.getBarcodeMetadata(h,f);if(b==null)return null;let N=Sc.merge(ks.adjustBoundingBox(h),ks.adjustBoundingBox(f));return new vu(b,N)}static adjustBoundingBox(h){if(h==null)return null;let f=h.getRowHeights();if(f==null)return null;let b=ks.getMax(f),N=0;for(let M of f)if(N+=b-M,M>0)break;let _=h.getCodewords();for(let M=0;N>0&&_[M]==null;M++)N--;let C=0;for(let M=f.length-1;M>=0&&(C+=b-f[M],!(f[M]>0));M--);for(let M=_.length-1;C>0&&_[M]==null;M--)C--;return h.getBoundingBox().addMissingRows(N,C,h.isLeft())}static getMax(h){let f=-1;for(let b of h)f=Math.max(f,b);return f}static getBarcodeMetadata(h,f){let b;if(h==null||(b=h.getBarcodeMetadata())==null)return f==null?null:f.getBarcodeMetadata();let N;return f==null||(N=f.getBarcodeMetadata())==null?b:b.getColumnCount()!==N.getColumnCount()&&b.getErrorCorrectionLevel()!==N.getErrorCorrectionLevel()&&b.getRowCount()!==N.getRowCount()?null:b}static getRowIndicatorColumn(h,f,b,N,_,C){let M=new Qf(f,N);for(let L=0;L<2;L++){let z=L===0?1:-1,re=Math.trunc(Math.trunc(b.getX()));for(let ue=Math.trunc(Math.trunc(b.getY()));ue<=f.getMaxY()&&ue>=f.getMinY();ue+=z){let pe=ks.detectCodeword(h,0,h.getWidth(),N,re,ue,_,C);pe!=null&&(M.setCodeword(ue,pe),N?re=pe.getStartX():re=pe.getEndX())}}return M}static adjustCodewordCount(h,f){let b=f[0][1],N=b.getValue(),_=h.getBarcodeColumnCount()*h.getBarcodeRowCount()-ks.getNumberOfECCodeWords(h.getBarcodeECLevel());if(N.length===0){if(_<1||_>ls.MAX_CODEWORDS_IN_BARCODE)throw F.getNotFoundInstance();b.setValue(_)}else N[0]!==_&&b.setValue(_)}static createDecoderResult(h){let f=ks.createBarcodeMatrix(h);ks.adjustCodewordCount(h,f);let b=new Array,N=new Int32Array(h.getBarcodeRowCount()*h.getBarcodeColumnCount()),_=[],C=new Array;for(let L=0;L<h.getBarcodeRowCount();L++)for(let z=0;z<h.getBarcodeColumnCount();z++){let re=f[L][z+1].getValue(),ue=L*h.getBarcodeColumnCount()+z;re.length===0?b.push(ue):re.length===1?N[ue]=re[0]:(C.push(ue),_.push(re))}let M=new Array(_.length);for(let L=0;L<M.length;L++)M[L]=_[L];return ks.createDecoderResultFromAmbiguousValues(h.getBarcodeECLevel(),N,ls.toIntArray(b),ls.toIntArray(C),M)}static createDecoderResultFromAmbiguousValues(h,f,b,N,_){let C=new Int32Array(N.length),M=100;for(;M-- >0;){for(let L=0;L<C.length;L++)f[N[L]]=_[L][C[L]];try{return ks.decodeCodewords(f,h,b)}catch(L){if(!(L instanceof y))throw L}if(C.length===0)throw y.getChecksumInstance();for(let L=0;L<C.length;L++)if(C[L]<_[L].length-1){C[L]++;break}else if(C[L]=0,L===C.length-1)throw y.getChecksumInstance()}throw y.getChecksumInstance()}static createBarcodeMatrix(h){let f=Array.from({length:h.getBarcodeRowCount()},()=>new Array(h.getBarcodeColumnCount()+2));for(let N=0;N<f.length;N++)for(let _=0;_<f[N].length;_++)f[N][_]=new yu;let b=0;for(let N of h.getDetectionResultColumns()){if(N!=null){for(let _ of N.getCodewords())if(_!=null){let C=_.getRowNumber();if(C>=0){if(C>=f.length)continue;f[C][b].setValue(_.getValue())}}}b++}return f}static isValidBarcodeColumn(h,f){return f>=0&&f<=h.getBarcodeColumnCount()+1}static getStartColumn(h,f,b,N){let _=N?1:-1,C=null;if(ks.isValidBarcodeColumn(h,f-_)&&(C=h.getDetectionResultColumn(f-_).getCodeword(b)),C!=null)return N?C.getEndX():C.getStartX();if(C=h.getDetectionResultColumn(f).getCodewordNearby(b),C!=null)return N?C.getStartX():C.getEndX();if(ks.isValidBarcodeColumn(h,f-_)&&(C=h.getDetectionResultColumn(f-_).getCodewordNearby(b)),C!=null)return N?C.getEndX():C.getStartX();let M=0;for(;ks.isValidBarcodeColumn(h,f-_);){f-=_;for(let L of h.getDetectionResultColumn(f).getCodewords())if(L!=null)return(N?L.getEndX():L.getStartX())+_*M*(L.getEndX()-L.getStartX());M++}return N?h.getBoundingBox().getMinX():h.getBoundingBox().getMaxX()}static detectCodeword(h,f,b,N,_,C,M,L){_=ks.adjustCodewordStartColumn(h,f,b,N,_,C);let z=ks.getModuleBitCount(h,f,b,N,_,C);if(z==null)return null;let re,ue=fe.sum(z);if(N)re=_+ue;else{for(let Ie=0;Ie<z.length/2;Ie++){let Be=z[Ie];z[Ie]=z[z.length-1-Ie],z[z.length-1-Ie]=Be}re=_,_=re-ue}if(!ks.checkCodewordSkew(ue,M,L))return null;let pe=Pa.getDecodedValue(z),Se=ls.getCodeword(pe);return Se===-1?null:new ju(_,re,ks.getCodewordBucketNumber(pe),Se)}static getModuleBitCount(h,f,b,N,_,C){let M=_,L=new Int32Array(8),z=0,re=N?1:-1,ue=N;for(;(N?M<b:M>=f)&&z<L.length;)h.get(M,C)===ue?(L[z]++,M+=re):(z++,ue=!ue);return z===L.length||M===(N?b:f)&&z===L.length-1?L:null}static getNumberOfECCodeWords(h){return 2<<h}static adjustCodewordStartColumn(h,f,b,N,_,C){let M=_,L=N?-1:1;for(let z=0;z<2;z++){for(;(N?M>=f:M<b)&&N===h.get(M,C);){if(Math.abs(_-M)>ks.CODEWORD_SKEW_SIZE)return _;M+=L}L=-L,N=!N}return M}static checkCodewordSkew(h,f,b){return f-ks.CODEWORD_SKEW_SIZE<=h&&h<=b+ks.CODEWORD_SKEW_SIZE}static decodeCodewords(h,f,b){if(h.length===0)throw O.getFormatInstance();let N=1<<f+1,_=ks.correctErrors(h,b,N);ks.verifyCodewordCount(h,N);let C=st.decode(h,""+f);return C.setErrorsCorrected(_),C.setErasures(b.length),C}static correctErrors(h,f,b){if(f!=null&&f.length>b/2+ks.MAX_ERRORS||b<0||b>ks.MAX_EC_CODEWORDS)throw y.getChecksumInstance();return ks.errorCorrection.decode(h,b,f)}static verifyCodewordCount(h,f){if(h.length<4)throw O.getFormatInstance();let b=h[0];if(b>h.length)throw O.getFormatInstance();if(b===0)if(f<h.length)h[0]=h.length-f;else throw O.getFormatInstance()}static getBitCountForCodeword(h){let f=new Int32Array(8),b=0,N=f.length-1;for(;!((h&1)!==b&&(b=h&1,N--,N<0));)f[N]++,h>>=1;return f}static getCodewordBucketNumber(h){return h instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(h):this.getCodewordBucketNumber_number(h)}static getCodewordBucketNumber_number(h){return ks.getCodewordBucketNumber(ks.getBitCountForCodeword(h))}static getCodewordBucketNumber_Int32Array(h){return(h[0]-h[2]+h[4]-h[6]+9)%9}static toString(h){let f=new gu;for(let b=0;b<h.length;b++){f.format("Row %2d: ",b);for(let N=0;N<h[b].length;N++){let _=h[b][N];_.getValue().length===0?f.format("        ",null):f.format("%4d(%2d)",_.getValue()[0],_.getConfidence(_.getValue()[0]))}f.format("%n")}return f.toString()}}ks.CODEWORD_SKEW_SIZE=2,ks.MAX_ERRORS=3,ks.MAX_EC_CODEWORDS=512,ks.errorCorrection=new Xf;class Da{decode(h,f=null){let b=Da.decode(h,f,!1);if(b==null||b.length===0||b[0]==null)throw F.getNotFoundInstance();return b[0]}decodeMultiple(h,f=null){try{return Da.decode(h,f,!0)}catch(b){throw b instanceof O||b instanceof y?F.getNotFoundInstance():b}}static decode(h,f,b){const N=new Array,_=js.detectMultiple(h,f,b);for(const C of _.getPoints()){const M=ks.decode(_.getBits(),C[4],C[5],C[6],C[7],Da.getMinCodewordWidth(C),Da.getMaxCodewordWidth(C)),L=new te(M.getText(),M.getRawBytes(),void 0,C,q.PDF_417);L.putMetadata(X.ERROR_CORRECTION_LEVEL,M.getECLevel());const z=M.getOther();z!=null&&L.putMetadata(X.PDF417_EXTRA_METADATA,z),N.push(L)}return N.map(C=>C)}static getMaxWidth(h,f){return h==null||f==null?0:Math.trunc(Math.abs(h.getX()-f.getX()))}static getMinWidth(h,f){return h==null||f==null?k.MAX_VALUE:Math.trunc(Math.abs(h.getX()-f.getX()))}static getMaxCodewordWidth(h){return Math.floor(Math.max(Math.max(Da.getMaxWidth(h[0],h[4]),Da.getMaxWidth(h[6],h[2])*ls.MODULES_IN_CODEWORD/ls.MODULES_IN_STOP_PATTERN),Math.max(Da.getMaxWidth(h[1],h[5]),Da.getMaxWidth(h[7],h[3])*ls.MODULES_IN_CODEWORD/ls.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(h){return Math.floor(Math.min(Math.min(Da.getMinWidth(h[0],h[4]),Da.getMinWidth(h[6],h[2])*ls.MODULES_IN_CODEWORD/ls.MODULES_IN_STOP_PATTERN),Math.min(Da.getMinWidth(h[1],h[5]),Da.getMinWidth(h[7],h[3])*ls.MODULES_IN_CODEWORD/ls.MODULES_IN_STOP_PATTERN)))}reset(){}}class By extends u{}By.kind="ReaderException";class uI{constructor(h,f){this.verbose=h===!0,f&&this.setHints(f)}decode(h,f){return f&&this.setHints(f),this.decodeInternal(h)}decodeWithState(h){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(h)}setHints(h){this.hints=h;const f=!a(h)&&h.get(P.TRY_HARDER)===!0,b=a(h)?null:h.get(P.POSSIBLE_FORMATS),N=new Array;if(!a(b)){const _=b.some(C=>C===q.UPC_A||C===q.UPC_E||C===q.EAN_13||C===q.EAN_8||C===q.CODABAR||C===q.CODE_39||C===q.CODE_93||C===q.CODE_128||C===q.ITF||C===q.RSS_14||C===q.RSS_EXPANDED);_&&!f&&N.push(new wr(h,this.verbose)),b.includes(q.QR_CODE)&&N.push(new _c),b.includes(q.DATA_MATRIX)&&N.push(new gi),b.includes(q.AZTEC)&&N.push(new ve),b.includes(q.PDF_417)&&N.push(new Da),_&&f&&N.push(new wr(h,this.verbose))}N.length===0&&(f||N.push(new wr(h,this.verbose)),N.push(new _c),N.push(new gi),N.push(new ve),N.push(new Da),f&&N.push(new wr(h,this.verbose))),this.readers=N}reset(){if(this.readers!==null)for(const h of this.readers)h.reset()}decodeInternal(h){if(this.readers===null)throw new By("No readers where selected, nothing can be read.");for(const f of this.readers)try{return f.decode(h,this.hints)}catch(b){if(b instanceof By)continue}throw new F("No MultiFormat Readers were able to detect the code.")}}class Mne extends ie{constructor(h=null,f=500){const b=new uI;b.setHints(h),super(b,f)}decodeBitmap(h){return this.reader.decodeWithState(h)}}class Ine extends ie{constructor(h=500){super(new Da,h)}}class One extends ie{constructor(h=500){super(new _c,h)}}var bS;(function(de){de[de.ERROR_CORRECTION=0]="ERROR_CORRECTION",de[de.CHARACTER_SET=1]="CHARACTER_SET",de[de.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",de[de.MIN_SIZE=3]="MIN_SIZE",de[de.MAX_SIZE=4]="MAX_SIZE",de[de.MARGIN=5]="MARGIN",de[de.PDF417_COMPACT=6]="PDF417_COMPACT",de[de.PDF417_COMPACTION=7]="PDF417_COMPACTION",de[de.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",de[de.AZTEC_LAYERS=9]="AZTEC_LAYERS",de[de.QR_VERSION=10]="QR_VERSION"})(bS||(bS={}));var Jr=bS;class yS{constructor(h){this.field=h,this.cachedGenerators=[],this.cachedGenerators.push(new Q(h,Int32Array.from([1])))}buildGenerator(h){const f=this.cachedGenerators;if(h>=f.length){let b=f[f.length-1];const N=this.field;for(let _=f.length;_<=h;_++){const C=b.multiply(new Q(N,Int32Array.from([1,N.exp(_-1+N.getGeneratorBase())])));f.push(C),b=C}}return f[h]}encode(h,f){if(f===0)throw new x("No error correction bytes");const b=h.length-f;if(b<=0)throw new x("No data bytes provided");const N=this.buildGenerator(f),_=new Int32Array(b);j.arraycopy(h,0,_,0,b);let C=new Q(this.field,_);C=C.multiplyByMonomial(f,1);const L=C.divide(N)[1].getCoefficients(),z=f-L.length;for(let re=0;re<z;re++)h[b+re]=0;j.arraycopy(L,0,h,b+z,L.length)}}class ur{constructor(){}static applyMaskPenaltyRule1(h){return ur.applyMaskPenaltyRule1Internal(h,!0)+ur.applyMaskPenaltyRule1Internal(h,!1)}static applyMaskPenaltyRule2(h){let f=0;const b=h.getArray(),N=h.getWidth(),_=h.getHeight();for(let C=0;C<_-1;C++){const M=b[C];for(let L=0;L<N-1;L++){const z=M[L];z===M[L+1]&&z===b[C+1][L]&&z===b[C+1][L+1]&&f++}}return ur.N2*f}static applyMaskPenaltyRule3(h){let f=0;const b=h.getArray(),N=h.getWidth(),_=h.getHeight();for(let C=0;C<_;C++)for(let M=0;M<N;M++){const L=b[C];M+6<N&&L[M]===1&&L[M+1]===0&&L[M+2]===1&&L[M+3]===1&&L[M+4]===1&&L[M+5]===0&&L[M+6]===1&&(ur.isWhiteHorizontal(L,M-4,M)||ur.isWhiteHorizontal(L,M+7,M+11))&&f++,C+6<_&&b[C][M]===1&&b[C+1][M]===0&&b[C+2][M]===1&&b[C+3][M]===1&&b[C+4][M]===1&&b[C+5][M]===0&&b[C+6][M]===1&&(ur.isWhiteVertical(b,M,C-4,C)||ur.isWhiteVertical(b,M,C+7,C+11))&&f++}return f*ur.N3}static isWhiteHorizontal(h,f,b){f=Math.max(f,0),b=Math.min(b,h.length);for(let N=f;N<b;N++)if(h[N]===1)return!1;return!0}static isWhiteVertical(h,f,b,N){b=Math.max(b,0),N=Math.min(N,h.length);for(let _=b;_<N;_++)if(h[_][f]===1)return!1;return!0}static applyMaskPenaltyRule4(h){let f=0;const b=h.getArray(),N=h.getWidth(),_=h.getHeight();for(let L=0;L<_;L++){const z=b[L];for(let re=0;re<N;re++)z[re]===1&&f++}const C=h.getHeight()*h.getWidth();return Math.floor(Math.abs(f*2-C)*10/C)*ur.N4}static getDataMaskBit(h,f,b){let N,_;switch(h){case 0:N=b+f&1;break;case 1:N=b&1;break;case 2:N=f%3;break;case 3:N=(b+f)%3;break;case 4:N=Math.floor(b/2)+Math.floor(f/3)&1;break;case 5:_=b*f,N=(_&1)+_%3;break;case 6:_=b*f,N=(_&1)+_%3&1;break;case 7:_=b*f,N=_%3+(b+f&1)&1;break;default:throw new x("Invalid mask pattern: "+h)}return N===0}static applyMaskPenaltyRule1Internal(h,f){let b=0;const N=f?h.getHeight():h.getWidth(),_=f?h.getWidth():h.getHeight(),C=h.getArray();for(let M=0;M<N;M++){let L=0,z=-1;for(let re=0;re<_;re++){const ue=f?C[M][re]:C[re][M];ue===z?L++:(L>=5&&(b+=ur.N1+(L-5)),L=1,z=ue)}L>=5&&(b+=ur.N1+(L-5))}return b}}ur.N1=3,ur.N2=3,ur.N3=40,ur.N4=10;class $y{constructor(h,f){this.width=h,this.height=f;const b=new Array(f);for(let N=0;N!==f;N++)b[N]=new Uint8Array(h);this.bytes=b}getHeight(){return this.height}getWidth(){return this.width}get(h,f){return this.bytes[f][h]}getArray(){return this.bytes}setNumber(h,f,b){this.bytes[f][h]=b}setBoolean(h,f,b){this.bytes[f][h]=b?1:0}clear(h){for(const f of this.bytes)E.fill(f,h)}equals(h){if(!(h instanceof $y))return!1;const f=h;if(this.width!==f.width||this.height!==f.height)return!1;for(let b=0,N=this.height;b<N;++b){const _=this.bytes[b],C=f.bytes[b];for(let M=0,L=this.width;M<L;++M)if(_[M]!==C[M])return!1}return!0}toString(){const h=new V;for(let f=0,b=this.height;f<b;++f){const N=this.bytes[f];for(let _=0,C=this.width;_<C;++_)switch(N[_]){case 0:h.append(" 0");break;case 1:h.append(" 1");break;default:h.append("  ");break}h.append(`
`)}return h.toString()}}class Fm{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const h=new V;return h.append(`<<
`),h.append(" mode: "),h.append(this.mode?this.mode.toString():"null"),h.append(`
 ecLevel: `),h.append(this.ecLevel?this.ecLevel.toString():"null"),h.append(`
 version: `),h.append(this.version?this.version.toString():"null"),h.append(`
 maskPattern: `),h.append(this.maskPattern.toString()),this.matrix?(h.append(`
 matrix:
`),h.append(this.matrix.toString())):h.append(`
 matrix: null
`),h.append(`>>
`),h.toString()}setMode(h){this.mode=h}setECLevel(h){this.ecLevel=h}setVersion(h){this.version=h}setMaskPattern(h){this.maskPattern=h}setMatrix(h){this.matrix=h}static isValidMaskPattern(h){return h>=0&&h<Fm.NUM_MASK_PATTERNS}}Fm.NUM_MASK_PATTERNS=8;class Nn extends u{}Nn.kind="WriterException";class cs{constructor(){}static clearMatrix(h){h.clear(255)}static buildMatrix(h,f,b,N,_){cs.clearMatrix(_),cs.embedBasicPatterns(b,_),cs.embedTypeInfo(f,N,_),cs.maybeEmbedVersionInfo(b,_),cs.embedDataBits(h,N,_)}static embedBasicPatterns(h,f){cs.embedPositionDetectionPatternsAndSeparators(f),cs.embedDarkDotAtLeftBottomCorner(f),cs.maybeEmbedPositionAdjustmentPatterns(h,f),cs.embedTimingPatterns(f)}static embedTypeInfo(h,f,b){const N=new A;cs.makeTypeInfoBits(h,f,N);for(let _=0,C=N.getSize();_<C;++_){const M=N.get(N.getSize()-1-_),L=cs.TYPE_INFO_COORDINATES[_],z=L[0],re=L[1];if(b.setBoolean(z,re,M),_<8){const ue=b.getWidth()-_-1;b.setBoolean(ue,8,M)}else{const pe=b.getHeight()-7+(_-8);b.setBoolean(8,pe,M)}}}static maybeEmbedVersionInfo(h,f){if(h.getVersionNumber()<7)return;const b=new A;cs.makeVersionInfoBits(h,b);let N=6*3-1;for(let _=0;_<6;++_)for(let C=0;C<3;++C){const M=b.get(N);N--,f.setBoolean(_,f.getHeight()-11+C,M),f.setBoolean(f.getHeight()-11+C,_,M)}}static embedDataBits(h,f,b){let N=0,_=-1,C=b.getWidth()-1,M=b.getHeight()-1;for(;C>0;){for(C===6&&(C-=1);M>=0&&M<b.getHeight();){for(let L=0;L<2;++L){const z=C-L;if(!cs.isEmpty(b.get(z,M)))continue;let re;N<h.getSize()?(re=h.get(N),++N):re=!1,f!==255&&ur.getDataMaskBit(f,z,M)&&(re=!re),b.setBoolean(z,M,re)}M+=_}_=-_,M+=_,C-=2}if(N!==h.getSize())throw new Nn("Not all bits consumed: "+N+"/"+h.getSize())}static findMSBSet(h){return 32-k.numberOfLeadingZeros(h)}static calculateBCHCode(h,f){if(f===0)throw new x("0 polynomial");const b=cs.findMSBSet(f);for(h<<=b-1;cs.findMSBSet(h)>=b;)h^=f<<cs.findMSBSet(h)-b;return h}static makeTypeInfoBits(h,f,b){if(!Fm.isValidMaskPattern(f))throw new Nn("Invalid mask pattern");const N=h.getBits()<<3|f;b.appendBits(N,5);const _=cs.calculateBCHCode(N,cs.TYPE_INFO_POLY);b.appendBits(_,10);const C=new A;if(C.appendBits(cs.TYPE_INFO_MASK_PATTERN,15),b.xor(C),b.getSize()!==15)throw new Nn("should not happen but we got: "+b.getSize())}static makeVersionInfoBits(h,f){f.appendBits(h.getVersionNumber(),6);const b=cs.calculateBCHCode(h.getVersionNumber(),cs.VERSION_INFO_POLY);if(f.appendBits(b,12),f.getSize()!==18)throw new Nn("should not happen but we got: "+f.getSize())}static isEmpty(h){return h===255}static embedTimingPatterns(h){for(let f=8;f<h.getWidth()-8;++f){const b=(f+1)%2;cs.isEmpty(h.get(f,6))&&h.setNumber(f,6,b),cs.isEmpty(h.get(6,f))&&h.setNumber(6,f,b)}}static embedDarkDotAtLeftBottomCorner(h){if(h.get(8,h.getHeight()-8)===0)throw new Nn;h.setNumber(8,h.getHeight()-8,1)}static embedHorizontalSeparationPattern(h,f,b){for(let N=0;N<8;++N){if(!cs.isEmpty(b.get(h+N,f)))throw new Nn;b.setNumber(h+N,f,0)}}static embedVerticalSeparationPattern(h,f,b){for(let N=0;N<7;++N){if(!cs.isEmpty(b.get(h,f+N)))throw new Nn;b.setNumber(h,f+N,0)}}static embedPositionAdjustmentPattern(h,f,b){for(let N=0;N<5;++N){const _=cs.POSITION_ADJUSTMENT_PATTERN[N];for(let C=0;C<5;++C)b.setNumber(h+C,f+N,_[C])}}static embedPositionDetectionPattern(h,f,b){for(let N=0;N<7;++N){const _=cs.POSITION_DETECTION_PATTERN[N];for(let C=0;C<7;++C)b.setNumber(h+C,f+N,_[C])}}static embedPositionDetectionPatternsAndSeparators(h){const f=cs.POSITION_DETECTION_PATTERN[0].length;cs.embedPositionDetectionPattern(0,0,h),cs.embedPositionDetectionPattern(h.getWidth()-f,0,h),cs.embedPositionDetectionPattern(0,h.getWidth()-f,h);const b=8;cs.embedHorizontalSeparationPattern(0,b-1,h),cs.embedHorizontalSeparationPattern(h.getWidth()-b,b-1,h),cs.embedHorizontalSeparationPattern(0,h.getWidth()-b,h);const N=7;cs.embedVerticalSeparationPattern(N,0,h),cs.embedVerticalSeparationPattern(h.getHeight()-N-1,0,h),cs.embedVerticalSeparationPattern(N,h.getHeight()-N,h)}static maybeEmbedPositionAdjustmentPatterns(h,f){if(h.getVersionNumber()<2)return;const b=h.getVersionNumber()-1,N=cs.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[b];for(let _=0,C=N.length;_!==C;_++){const M=N[_];if(M>=0)for(let L=0;L!==C;L++){const z=N[L];z>=0&&cs.isEmpty(f.get(z,M))&&cs.embedPositionAdjustmentPattern(z-2,M-2,f)}}}}cs.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),cs.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),cs.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),cs.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),cs.VERSION_INFO_POLY=7973,cs.TYPE_INFO_POLY=1335,cs.TYPE_INFO_MASK_PATTERN=21522;class Rne{constructor(h,f){this.dataBytes=h,this.errorCorrectionBytes=f}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Mn{constructor(){}static calculateMaskPenalty(h){return ur.applyMaskPenaltyRule1(h)+ur.applyMaskPenaltyRule2(h)+ur.applyMaskPenaltyRule3(h)+ur.applyMaskPenaltyRule4(h)}static encode(h,f,b=null){let N=Mn.DEFAULT_BYTE_MODE_ENCODING;const _=b!==null&&b.get(Jr.CHARACTER_SET)!==void 0;_&&(N=b.get(Jr.CHARACTER_SET).toString());const C=this.chooseMode(h,N),M=new A;if(C===ss.BYTE&&(_||Mn.DEFAULT_BYTE_MODE_ENCODING!==N)){const kt=T.getCharacterSetECIByName(N);kt!==void 0&&this.appendECI(kt,M)}this.appendModeInfo(C,M);const L=new A;this.appendBytes(h,C,L,N);let z;if(b!==null&&b.get(Jr.QR_VERSION)!==void 0){const kt=Number.parseInt(b.get(Jr.QR_VERSION).toString(),10);z=$t.getVersionForNumber(kt);const wt=this.calculateBitsNeeded(C,M,L,z);if(!this.willFit(wt,z,f))throw new Nn("Data too big for requested version")}else z=this.recommendVersion(f,C,M,L);const re=new A;re.appendBitArray(M);const ue=C===ss.BYTE?L.getSizeInBytes():h.length;this.appendLengthInfo(ue,z,C,re),re.appendBitArray(L);const pe=z.getECBlocksForLevel(f),Se=z.getTotalCodewords()-pe.getTotalECCodewords();this.terminateBits(Se,re);const Ie=this.interleaveWithECBytes(re,z.getTotalCodewords(),Se,pe.getNumBlocks()),Be=new Fm;Be.setECLevel(f),Be.setMode(C),Be.setVersion(z);const Xe=z.getDimensionForVersion(),nt=new $y(Xe,Xe),Ct=this.chooseMaskPattern(Ie,f,z,nt);return Be.setMaskPattern(Ct),cs.buildMatrix(Ie,f,z,Ct,nt),Be.setMatrix(nt),Be}static recommendVersion(h,f,b,N){const _=this.calculateBitsNeeded(f,b,N,$t.getVersionForNumber(1)),C=this.chooseVersion(_,h),M=this.calculateBitsNeeded(f,b,N,C);return this.chooseVersion(M,h)}static calculateBitsNeeded(h,f,b,N){return f.getSize()+h.getCharacterCountBits(N)+b.getSize()}static getAlphanumericCode(h){return h<Mn.ALPHANUMERIC_TABLE.length?Mn.ALPHANUMERIC_TABLE[h]:-1}static chooseMode(h,f=null){if(T.SJIS.getName()===f&&this.isOnlyDoubleByteKanji(h))return ss.KANJI;let b=!1,N=!1;for(let _=0,C=h.length;_<C;++_){const M=h.charAt(_);if(Mn.isDigit(M))b=!0;else if(this.getAlphanumericCode(M.charCodeAt(0))!==-1)N=!0;else return ss.BYTE}return N?ss.ALPHANUMERIC:b?ss.NUMERIC:ss.BYTE}static isOnlyDoubleByteKanji(h){let f;try{f=U.encode(h,T.SJIS)}catch{return!1}const b=f.length;if(b%2!==0)return!1;for(let N=0;N<b;N+=2){const _=f[N]&255;if((_<129||_>159)&&(_<224||_>235))return!1}return!0}static chooseMaskPattern(h,f,b,N){let _=Number.MAX_SAFE_INTEGER,C=-1;for(let M=0;M<Fm.NUM_MASK_PATTERNS;M++){cs.buildMatrix(h,f,b,M,N);let L=this.calculateMaskPenalty(N);L<_&&(_=L,C=M)}return C}static chooseVersion(h,f){for(let b=1;b<=40;b++){const N=$t.getVersionForNumber(b);if(Mn.willFit(h,N,f))return N}throw new Nn("Data too big")}static willFit(h,f,b){const N=f.getTotalCodewords(),C=f.getECBlocksForLevel(b).getTotalECCodewords(),M=N-C,L=(h+7)/8;return M>=L}static terminateBits(h,f){const b=h*8;if(f.getSize()>b)throw new Nn("data bits cannot fit in the QR Code"+f.getSize()+" > "+b);for(let C=0;C<4&&f.getSize()<b;++C)f.appendBit(!1);const N=f.getSize()&7;if(N>0)for(let C=N;C<8;C++)f.appendBit(!1);const _=h-f.getSizeInBytes();for(let C=0;C<_;++C)f.appendBits(C&1?17:236,8);if(f.getSize()!==b)throw new Nn("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(h,f,b,N,_,C){if(N>=b)throw new Nn("Block ID too large");const M=h%b,L=b-M,z=Math.floor(h/b),re=z+1,ue=Math.floor(f/b),pe=ue+1,Se=z-ue,Ie=re-pe;if(Se!==Ie)throw new Nn("EC bytes mismatch");if(b!==L+M)throw new Nn("RS blocks mismatch");if(h!==(ue+Se)*L+(pe+Ie)*M)throw new Nn("Total bytes mismatch");N<L?(_[0]=ue,C[0]=Se):(_[0]=pe,C[0]=Ie)}static interleaveWithECBytes(h,f,b,N){if(h.getSizeInBytes()!==b)throw new Nn("Number of bits and data bytes does not match");let _=0,C=0,M=0;const L=new Array;for(let re=0;re<N;++re){const ue=new Int32Array(1),pe=new Int32Array(1);Mn.getNumDataBytesAndNumECBytesForBlockID(f,b,N,re,ue,pe);const Se=ue[0],Ie=new Uint8Array(Se);h.toBytes(8*_,Ie,0,Se);const Be=Mn.generateECBytes(Ie,pe[0]);L.push(new Rne(Ie,Be)),C=Math.max(C,Se),M=Math.max(M,Be.length),_+=ue[0]}if(b!==_)throw new Nn("Data bytes does not match offset");const z=new A;for(let re=0;re<C;++re)for(const ue of L){const pe=ue.getDataBytes();re<pe.length&&z.appendBits(pe[re],8)}for(let re=0;re<M;++re)for(const ue of L){const pe=ue.getErrorCorrectionBytes();re<pe.length&&z.appendBits(pe[re],8)}if(f!==z.getSizeInBytes())throw new Nn("Interleaving error: "+f+" and "+z.getSizeInBytes()+" differ.");return z}static generateECBytes(h,f){const b=h.length,N=new Int32Array(b+f);for(let C=0;C<b;C++)N[C]=h[C]&255;new yS(_e.QR_CODE_FIELD_256).encode(N,f);const _=new Uint8Array(f);for(let C=0;C<f;C++)_[C]=N[b+C];return _}static appendModeInfo(h,f){f.appendBits(h.getBits(),4)}static appendLengthInfo(h,f,b,N){const _=b.getCharacterCountBits(f);if(h>=1<<_)throw new Nn(h+" is bigger than "+((1<<_)-1));N.appendBits(h,_)}static appendBytes(h,f,b,N){switch(f){case ss.NUMERIC:Mn.appendNumericBytes(h,b);break;case ss.ALPHANUMERIC:Mn.appendAlphanumericBytes(h,b);break;case ss.BYTE:Mn.append8BitBytes(h,b,N);break;case ss.KANJI:Mn.appendKanjiBytes(h,b);break;default:throw new Nn("Invalid mode: "+f)}}static getDigit(h){return h.charCodeAt(0)-48}static isDigit(h){const f=Mn.getDigit(h);return f>=0&&f<=9}static appendNumericBytes(h,f){const b=h.length;let N=0;for(;N<b;){const _=Mn.getDigit(h.charAt(N));if(N+2<b){const C=Mn.getDigit(h.charAt(N+1)),M=Mn.getDigit(h.charAt(N+2));f.appendBits(_*100+C*10+M,10),N+=3}else if(N+1<b){const C=Mn.getDigit(h.charAt(N+1));f.appendBits(_*10+C,7),N+=2}else f.appendBits(_,4),N++}}static appendAlphanumericBytes(h,f){const b=h.length;let N=0;for(;N<b;){const _=Mn.getAlphanumericCode(h.charCodeAt(N));if(_===-1)throw new Nn;if(N+1<b){const C=Mn.getAlphanumericCode(h.charCodeAt(N+1));if(C===-1)throw new Nn;f.appendBits(_*45+C,11),N+=2}else f.appendBits(_,6),N++}}static append8BitBytes(h,f,b){let N;try{N=U.encode(h,b)}catch(_){throw new Nn(_)}for(let _=0,C=N.length;_!==C;_++){const M=N[_];f.appendBits(M,8)}}static appendKanjiBytes(h,f){let b;try{b=U.encode(h,T.SJIS)}catch(_){throw new Nn(_)}const N=b.length;for(let _=0;_<N;_+=2){const C=b[_]&255,M=b[_+1]&255,L=C<<8&4294967295|M;let z=-1;if(L>=33088&&L<=40956?z=L-33088:L>=57408&&L<=60351&&(z=L-49472),z===-1)throw new Nn("Invalid byte sequence");const re=(z>>8)*192+(z&255);f.appendBits(re,13)}}static appendECI(h,f){f.appendBits(ss.ECI.getBits(),4),f.appendBits(h.getValue(),8)}}Mn.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Mn.DEFAULT_BYTE_MODE_ENCODING=T.UTF8.getName();class Bm{write(h,f,b,N=null){if(h.length===0)throw new x("Found empty contents");if(f<0||b<0)throw new x("Requested dimensions are too small: "+f+"x"+b);let _=ye.L,C=Bm.QUIET_ZONE_SIZE;N!==null&&(N.get(Jr.ERROR_CORRECTION)!==void 0&&(_=ye.fromString(N.get(Jr.ERROR_CORRECTION).toString())),N.get(Jr.MARGIN)!==void 0&&(C=Number.parseInt(N.get(Jr.MARGIN).toString(),10)));const M=Mn.encode(h,_,N);return this.renderResult(M,f,b,C)}writeToDom(h,f,b,N,_=null){typeof h=="string"&&(h=document.querySelector(h));const C=this.write(f,b,N,_);h&&h.appendChild(C)}renderResult(h,f,b,N){const _=h.getMatrix();if(_===null)throw new me;const C=_.getWidth(),M=_.getHeight(),L=C+N*2,z=M+N*2,re=Math.max(f,L),ue=Math.max(b,z),pe=Math.min(Math.floor(re/L),Math.floor(ue/z)),Se=Math.floor((re-C*pe)/2),Ie=Math.floor((ue-M*pe)/2),Be=this.createSVGElement(re,ue);for(let Xe=0,nt=Ie;Xe<M;Xe++,nt+=pe)for(let Ct=0,kt=Se;Ct<C;Ct++,kt+=pe)if(_.get(Ct,Xe)===1){const wt=this.createSvgRectElement(kt,nt,pe,pe);Be.appendChild(wt)}return Be}createSVGElement(h,f){const b=document.createElementNS(Bm.SVG_NS,"svg");return b.setAttributeNS(null,"height",h.toString()),b.setAttributeNS(null,"width",f.toString()),b}createSvgRectElement(h,f,b,N){const _=document.createElementNS(Bm.SVG_NS,"rect");return _.setAttributeNS(null,"x",h.toString()),_.setAttributeNS(null,"y",f.toString()),_.setAttributeNS(null,"height",b.toString()),_.setAttributeNS(null,"width",N.toString()),_.setAttributeNS(null,"fill","#000000"),_}}Bm.QUIET_ZONE_SIZE=4,Bm.SVG_NS="http://www.w3.org/2000/svg";class Sx{encode(h,f,b,N,_){if(h.length===0)throw new x("Found empty contents");if(f!==q.QR_CODE)throw new x("Can only encode QR_CODE, but got "+f);if(b<0||N<0)throw new x(`Requested dimensions are too small: ${b}x${N}`);let C=ye.L,M=Sx.QUIET_ZONE_SIZE;_!==null&&(_.get(Jr.ERROR_CORRECTION)!==void 0&&(C=ye.fromString(_.get(Jr.ERROR_CORRECTION).toString())),_.get(Jr.MARGIN)!==void 0&&(M=Number.parseInt(_.get(Jr.MARGIN).toString(),10)));const L=Mn.encode(h,C,_);return Sx.renderResult(L,b,N,M)}static renderResult(h,f,b,N){const _=h.getMatrix();if(_===null)throw new me;const C=_.getWidth(),M=_.getHeight(),L=C+N*2,z=M+N*2,re=Math.max(f,L),ue=Math.max(b,z),pe=Math.min(Math.floor(re/L),Math.floor(ue/z)),Se=Math.floor((re-C*pe)/2),Ie=Math.floor((ue-M*pe)/2),Be=new R(re,ue);for(let Xe=0,nt=Ie;Xe<M;Xe++,nt+=pe)for(let Ct=0,kt=Se;Ct<C;Ct++,kt+=pe)_.get(Ct,Xe)===1&&Be.setRegion(kt,nt,pe,pe);return Be}}Sx.QUIET_ZONE_SIZE=4;class Lne{encode(h,f,b,N,_){let C;switch(f){case q.QR_CODE:C=new Sx;break;default:throw new x("No encoder available for format "+f)}return C.encode(h,f,b,N,_)}}class Cc extends ${constructor(h,f,b,N,_,C,M,L){if(super(C,M),this.yuvData=h,this.dataWidth=f,this.dataHeight=b,this.left=N,this.top=_,N+C>f||_+M>b)throw new x("Crop rectangle does not fit within image data.");L&&this.reverseHorizontal(C,M)}getRow(h,f){if(h<0||h>=this.getHeight())throw new x("Requested row is outside the image: "+h);const b=this.getWidth();(f==null||f.length<b)&&(f=new Uint8ClampedArray(b));const N=(h+this.top)*this.dataWidth+this.left;return j.arraycopy(this.yuvData,N,f,0,b),f}getMatrix(){const h=this.getWidth(),f=this.getHeight();if(h===this.dataWidth&&f===this.dataHeight)return this.yuvData;const b=h*f,N=new Uint8ClampedArray(b);let _=this.top*this.dataWidth+this.left;if(h===this.dataWidth)return j.arraycopy(this.yuvData,_,N,0,b),N;for(let C=0;C<f;C++){const M=C*h;j.arraycopy(this.yuvData,_,N,M,h),_+=this.dataWidth}return N}isCropSupported(){return!0}crop(h,f,b,N){return new Cc(this.yuvData,this.dataWidth,this.dataHeight,this.left+h,this.top+f,b,N,!1)}renderThumbnail(){const h=this.getWidth()/Cc.THUMBNAIL_SCALE_FACTOR,f=this.getHeight()/Cc.THUMBNAIL_SCALE_FACTOR,b=new Int32Array(h*f),N=this.yuvData;let _=this.top*this.dataWidth+this.left;for(let C=0;C<f;C++){const M=C*h;for(let L=0;L<h;L++){const z=N[_+L*Cc.THUMBNAIL_SCALE_FACTOR]&255;b[M+L]=4278190080|z*65793}_+=this.dataWidth*Cc.THUMBNAIL_SCALE_FACTOR}return b}getThumbnailWidth(){return this.getWidth()/Cc.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Cc.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(h,f){const b=this.yuvData;for(let N=0,_=this.top*this.dataWidth+this.left;N<f;N++,_+=this.dataWidth){const C=_+h/2;for(let M=_,L=_+h-1;M<C;M++,L--){const z=b[M];b[M]=b[L],b[L]=z}}}invert(){return new K(this)}}Cc.THUMBNAIL_SCALE_FACTOR=2;class vS extends ${constructor(h,f,b,N,_,C,M){if(super(f,b),this.dataWidth=N,this.dataHeight=_,this.left=C,this.top=M,h.BYTES_PER_ELEMENT===4){const L=f*b,z=new Uint8ClampedArray(L);for(let re=0;re<L;re++){const ue=h[re],pe=ue>>16&255,Se=ue>>7&510,Ie=ue&255;z[re]=(pe+Se+Ie)/4&255}this.luminances=z}else this.luminances=h;if(N===void 0&&(this.dataWidth=f),_===void 0&&(this.dataHeight=b),C===void 0&&(this.left=0),M===void 0&&(this.top=0),this.left+f>this.dataWidth||this.top+b>this.dataHeight)throw new x("Crop rectangle does not fit within image data.")}getRow(h,f){if(h<0||h>=this.getHeight())throw new x("Requested row is outside the image: "+h);const b=this.getWidth();(f==null||f.length<b)&&(f=new Uint8ClampedArray(b));const N=(h+this.top)*this.dataWidth+this.left;return j.arraycopy(this.luminances,N,f,0,b),f}getMatrix(){const h=this.getWidth(),f=this.getHeight();if(h===this.dataWidth&&f===this.dataHeight)return this.luminances;const b=h*f,N=new Uint8ClampedArray(b);let _=this.top*this.dataWidth+this.left;if(h===this.dataWidth)return j.arraycopy(this.luminances,_,N,0,b),N;for(let C=0;C<f;C++){const M=C*h;j.arraycopy(this.luminances,_,N,M,h),_+=this.dataWidth}return N}isCropSupported(){return!0}crop(h,f,b,N){return new vS(this.luminances,b,N,this.dataWidth,this.dataHeight,this.left+h,this.top+f)}invert(){return new K(this)}}class mI extends T{static forName(h){return this.getCharacterSetECIByName(h)}}class jS{}jS.ISO_8859_1=T.ISO8859_1;class hI{isCompact(){return this.compact}setCompact(h){this.compact=h}getSize(){return this.size}setSize(h){this.size=h}getLayers(){return this.layers}setLayers(h){this.layers=h}getCodeWords(){return this.codeWords}setCodeWords(h){this.codeWords=h}getMatrix(){return this.matrix}setMatrix(h){this.matrix=h}}class xI{static singletonList(h){return[h]}static min(h,f){return h.sort(f)[0]}}class Fne{constructor(h){this.previous=h}getPrevious(){return this.previous}}class Cx extends Fne{constructor(h,f,b){super(h),this.value=f,this.bitCount=b}appendTo(h,f){h.appendBits(this.value,this.bitCount)}add(h,f){return new Cx(this,h,f)}addBinaryShift(h,f){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Cx(this,h,f)}toString(){let h=this.value&(1<<this.bitCount)-1;return h|=1<<this.bitCount,"<"+k.toBinaryString(h|1<<this.bitCount).substring(1)+">"}}class NS extends Cx{constructor(h,f,b){super(h,0,0),this.binaryShiftStart=f,this.binaryShiftByteCount=b}appendTo(h,f){for(let b=0;b<this.binaryShiftByteCount;b++)(b===0||b===31&&this.binaryShiftByteCount<=62)&&(h.appendBits(31,5),this.binaryShiftByteCount>62?h.appendBits(this.binaryShiftByteCount-31,16):b===0?h.appendBits(Math.min(this.binaryShiftByteCount,31),5):h.appendBits(this.binaryShiftByteCount-31,5)),h.appendBits(f[this.binaryShiftStart+b],8)}addBinaryShift(h,f){return new NS(this,h,f)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Bne(de,h,f){return new NS(de,h,f)}function t0(de,h,f){return new Cx(de,h,f)}const $ne=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],wu=0,zy=1,eo=2,pI=3,kc=4,zne=new Cx(null,0,0),wS=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function Une(de){for(let h of de)E.fill(h,-1);return de[wu][kc]=0,de[zy][kc]=0,de[zy][wu]=28,de[pI][kc]=0,de[eo][kc]=0,de[eo][wu]=15,de}const fI=Une(E.createInt32Array(6,6));class Ac{constructor(h,f,b,N){this.token=h,this.mode=f,this.binaryShiftByteCount=b,this.bitCount=N}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(h,f){let b=this.bitCount,N=this.token;if(h!==this.mode){let C=wS[this.mode][h];N=t0(N,C&65535,C>>16),b+=C>>16}let _=h===eo?4:5;return N=t0(N,f,_),new Ac(N,h,0,b+_)}shiftAndAppend(h,f){let b=this.token,N=this.mode===eo?4:5;return b=t0(b,fI[this.mode][h],N),b=t0(b,f,5),new Ac(b,this.mode,0,this.bitCount+N+5)}addBinaryShiftChar(h){let f=this.token,b=this.mode,N=this.bitCount;if(this.mode===kc||this.mode===eo){let M=wS[b][wu];f=t0(f,M&65535,M>>16),N+=M>>16,b=wu}let _=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,C=new Ac(f,b,this.binaryShiftByteCount+1,N+_);return C.binaryShiftByteCount===2078&&(C=C.endBinaryShift(h+1)),C}endBinaryShift(h){if(this.binaryShiftByteCount===0)return this;let f=this.token;return f=Bne(f,h-this.binaryShiftByteCount,this.binaryShiftByteCount),new Ac(f,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(h){let f=this.bitCount+(wS[this.mode][h.mode]>>16);return this.binaryShiftByteCount<h.binaryShiftByteCount?f+=Ac.calculateBinaryShiftCost(h)-Ac.calculateBinaryShiftCost(this):this.binaryShiftByteCount>h.binaryShiftByteCount&&h.binaryShiftByteCount>0&&(f+=10),f<=h.bitCount}toBitArray(h){let f=[];for(let N=this.endBinaryShift(h.length).token;N!==null;N=N.getPrevious())f.unshift(N);let b=new A;for(const N of f)N.appendTo(b,h);return b}toString(){return W.format("%s bits=%d bytes=%d",$ne[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(h){return h.binaryShiftByteCount>62?21:h.binaryShiftByteCount>31?20:h.binaryShiftByteCount>0?10:0}}Ac.INITIAL_STATE=new Ac(zne,wu,0,0);function Vne(de){const h=W.getCharCode(" "),f=W.getCharCode("."),b=W.getCharCode(",");de[wu][h]=1;const N=W.getCharCode("Z"),_=W.getCharCode("A");for(let pe=_;pe<=N;pe++)de[wu][pe]=pe-_+2;de[zy][h]=1;const C=W.getCharCode("z"),M=W.getCharCode("a");for(let pe=M;pe<=C;pe++)de[zy][pe]=pe-M+2;de[eo][h]=1;const L=W.getCharCode("9"),z=W.getCharCode("0");for(let pe=z;pe<=L;pe++)de[eo][pe]=pe-z+2;de[eo][b]=12,de[eo][f]=13;const re=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let pe=0;pe<re.length;pe++)de[pI][W.getCharCode(re[pe])]=pe;const ue=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let pe=0;pe<ue.length;pe++)W.getCharCode(ue[pe])>0&&(de[kc][W.getCharCode(ue[pe])]=pe);return de}const _S=Vne(E.createInt32Array(5,256));class s0{constructor(h){this.text=h}encode(){const h=W.getCharCode(" "),f=W.getCharCode(`
`);let b=xI.singletonList(Ac.INITIAL_STATE);for(let _=0;_<this.text.length;_++){let C,M=_+1<this.text.length?this.text[_+1]:0;switch(this.text[_]){case W.getCharCode("\r"):C=M===f?2:0;break;case W.getCharCode("."):C=M===h?3:0;break;case W.getCharCode(","):C=M===h?4:0;break;case W.getCharCode(":"):C=M===h?5:0;break;default:C=0}C>0?(b=s0.updateStateListForPair(b,_,C),_++):b=this.updateStateListForChar(b,_)}return xI.min(b,(_,C)=>_.getBitCount()-C.getBitCount()).toBitArray(this.text)}updateStateListForChar(h,f){const b=[];for(let N of h)this.updateStateForChar(N,f,b);return s0.simplifyStates(b)}updateStateForChar(h,f,b){let N=this.text[f]&255,_=_S[h.getMode()][N]>0,C=null;for(let M=0;M<=kc;M++){let L=_S[M][N];if(L>0){if(C==null&&(C=h.endBinaryShift(f)),!_||M===h.getMode()||M===eo){const z=C.latchAndAppend(M,L);b.push(z)}if(!_&&fI[h.getMode()][M]>=0){const z=C.shiftAndAppend(M,L);b.push(z)}}}if(h.getBinaryShiftByteCount()>0||_S[h.getMode()][N]===0){let M=h.addBinaryShiftChar(f);b.push(M)}}static updateStateListForPair(h,f,b){const N=[];for(let _ of h)this.updateStateForPair(_,f,b,N);return this.simplifyStates(N)}static updateStateForPair(h,f,b,N){let _=h.endBinaryShift(f);if(N.push(_.latchAndAppend(kc,b)),h.getMode()!==kc&&N.push(_.shiftAndAppend(kc,b)),b===3||b===4){let C=_.latchAndAppend(eo,16-b).latchAndAppend(eo,1);N.push(C)}if(h.getBinaryShiftByteCount()>0){let C=h.addBinaryShiftChar(f).addBinaryShiftChar(f+1);N.push(C)}}static simplifyStates(h){let f=[];for(const b of h){let N=!0;for(const _ of f){if(_.isBetterThanOrEqualTo(b)){N=!1;break}b.isBetterThanOrEqualTo(_)&&(f=f.filter(C=>C!==_))}N&&f.push(b)}return f}}class Ks{constructor(){}static encodeBytes(h){return Ks.encode(h,Ks.DEFAULT_EC_PERCENT,Ks.DEFAULT_AZTEC_LAYERS)}static encode(h,f,b){let N=new s0(h).encode(),_=k.truncDivision(N.getSize()*f,100)+11,C=N.getSize()+_,M,L,z,re,ue;if(b!==Ks.DEFAULT_AZTEC_LAYERS){if(M=b<0,L=Math.abs(b),L>(M?Ks.MAX_NB_BITS_COMPACT:Ks.MAX_NB_BITS))throw new x(W.format("Illegal value %s for layers",b));z=Ks.totalBitsInLayer(L,M),re=Ks.WORD_SIZE[L];let wt=z-z%re;if(ue=Ks.stuffBits(N,re),ue.getSize()+_>wt)throw new x("Data to large for user specified layer");if(M&&ue.getSize()>re*64)throw new x("Data to large for user specified layer")}else{re=0,ue=null;for(let wt=0;;wt++){if(wt>Ks.MAX_NB_BITS)throw new x("Data too large for an Aztec code");if(M=wt<=3,L=M?wt+1:wt,z=Ks.totalBitsInLayer(L,M),C>z)continue;(ue==null||re!==Ks.WORD_SIZE[L])&&(re=Ks.WORD_SIZE[L],ue=Ks.stuffBits(N,re));let $s=z-z%re;if(!(M&&ue.getSize()>re*64)&&ue.getSize()+_<=$s)break}}let pe=Ks.generateCheckWords(ue,z,re),Se=ue.getSize()/re,Ie=Ks.generateModeMessage(M,L,Se),Be=(M?11:14)+L*4,Xe=new Int32Array(Be),nt;if(M){nt=Be;for(let wt=0;wt<Xe.length;wt++)Xe[wt]=wt}else{nt=Be+1+2*k.truncDivision(k.truncDivision(Be,2)-1,15);let wt=k.truncDivision(Be,2),$s=k.truncDivision(nt,2);for(let Ns=0;Ns<wt;Ns++){let zi=Ns+k.truncDivision(Ns,15);Xe[wt-Ns-1]=$s-zi-1,Xe[wt+Ns]=$s+zi+1}}let Ct=new R(nt);for(let wt=0,$s=0;wt<L;wt++){let Ns=(L-wt)*4+(M?9:12);for(let zi=0;zi<Ns;zi++){let zo=zi*2;for(let Ui=0;Ui<2;Ui++)pe.get($s+zo+Ui)&&Ct.set(Xe[wt*2+Ui],Xe[wt*2+zi]),pe.get($s+Ns*2+zo+Ui)&&Ct.set(Xe[wt*2+zi],Xe[Be-1-wt*2-Ui]),pe.get($s+Ns*4+zo+Ui)&&Ct.set(Xe[Be-1-wt*2-Ui],Xe[Be-1-wt*2-zi]),pe.get($s+Ns*6+zo+Ui)&&Ct.set(Xe[Be-1-wt*2-zi],Xe[wt*2+Ui])}$s+=Ns*8}if(Ks.drawModeMessage(Ct,M,nt,Ie),M)Ks.drawBullsEye(Ct,k.truncDivision(nt,2),5);else{Ks.drawBullsEye(Ct,k.truncDivision(nt,2),7);for(let wt=0,$s=0;wt<k.truncDivision(Be,2)-1;wt+=15,$s+=16)for(let Ns=k.truncDivision(nt,2)&1;Ns<nt;Ns+=2)Ct.set(k.truncDivision(nt,2)-$s,Ns),Ct.set(k.truncDivision(nt,2)+$s,Ns),Ct.set(Ns,k.truncDivision(nt,2)-$s),Ct.set(Ns,k.truncDivision(nt,2)+$s)}let kt=new hI;return kt.setCompact(M),kt.setSize(nt),kt.setLayers(L),kt.setCodeWords(Se),kt.setMatrix(Ct),kt}static drawBullsEye(h,f,b){for(let N=0;N<b;N+=2)for(let _=f-N;_<=f+N;_++)h.set(_,f-N),h.set(_,f+N),h.set(f-N,_),h.set(f+N,_);h.set(f-b,f-b),h.set(f-b+1,f-b),h.set(f-b,f-b+1),h.set(f+b,f-b),h.set(f+b,f-b+1),h.set(f+b,f+b-1)}static generateModeMessage(h,f,b){let N=new A;return h?(N.appendBits(f-1,2),N.appendBits(b-1,6),N=Ks.generateCheckWords(N,28,4)):(N.appendBits(f-1,5),N.appendBits(b-1,11),N=Ks.generateCheckWords(N,40,4)),N}static drawModeMessage(h,f,b,N){let _=k.truncDivision(b,2);if(f)for(let C=0;C<7;C++){let M=_-3+C;N.get(C)&&h.set(M,_-5),N.get(C+7)&&h.set(_+5,M),N.get(20-C)&&h.set(M,_+5),N.get(27-C)&&h.set(_-5,M)}else for(let C=0;C<10;C++){let M=_-5+C+k.truncDivision(C,5);N.get(C)&&h.set(M,_-7),N.get(C+10)&&h.set(_+7,M),N.get(29-C)&&h.set(M,_+7),N.get(39-C)&&h.set(_-7,M)}}static generateCheckWords(h,f,b){let N=h.getSize()/b,_=new yS(Ks.getGF(b)),C=k.truncDivision(f,b),M=Ks.bitsToWords(h,b,C);_.encode(M,C-N);let L=f%b,z=new A;z.appendBits(0,L);for(const re of Array.from(M))z.appendBits(re,b);return z}static bitsToWords(h,f,b){let N=new Int32Array(b),_,C;for(_=0,C=h.getSize()/f;_<C;_++){let M=0;for(let L=0;L<f;L++)M|=h.get(_*f+L)?1<<f-L-1:0;N[_]=M}return N}static getGF(h){switch(h){case 4:return _e.AZTEC_PARAM;case 6:return _e.AZTEC_DATA_6;case 8:return _e.AZTEC_DATA_8;case 10:return _e.AZTEC_DATA_10;case 12:return _e.AZTEC_DATA_12;default:throw new x("Unsupported word size "+h)}}static stuffBits(h,f){let b=new A,N=h.getSize(),_=(1<<f)-2;for(let C=0;C<N;C+=f){let M=0;for(let L=0;L<f;L++)(C+L>=N||h.get(C+L))&&(M|=1<<f-1-L);(M&_)===_?(b.appendBits(M&_,f),C--):M&_?b.appendBits(M,f):(b.appendBits(M|1,f),C--)}return b}static totalBitsInLayer(h,f){return((f?88:112)+16*h)*h}}Ks.DEFAULT_EC_PERCENT=33,Ks.DEFAULT_AZTEC_LAYERS=0,Ks.MAX_NB_BITS=32,Ks.MAX_NB_BITS_COMPACT=4,Ks.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Uy{encode(h,f,b,N){return this.encodeWithHints(h,f,b,N,null)}encodeWithHints(h,f,b,N,_){let C=jS.ISO_8859_1,M=Ks.DEFAULT_EC_PERCENT,L=Ks.DEFAULT_AZTEC_LAYERS;return _!=null&&(_.has(Jr.CHARACTER_SET)&&(C=mI.forName(_.get(Jr.CHARACTER_SET).toString())),_.has(Jr.ERROR_CORRECTION)&&(M=k.parseInt(_.get(Jr.ERROR_CORRECTION).toString())),_.has(Jr.AZTEC_LAYERS)&&(L=k.parseInt(_.get(Jr.AZTEC_LAYERS).toString()))),Uy.encodeLayers(h,f,b,N,C,M,L)}static encodeLayers(h,f,b,N,_,C,M){if(f!==q.AZTEC)throw new x("Can only encode AZTEC, but got "+f);let L=Ks.encode(W.getBytes(h,_),C,M);return Uy.renderResult(L,b,N)}static renderResult(h,f,b){let N=h.getMatrix();if(N==null)throw new me;let _=N.getWidth(),C=N.getHeight(),M=Math.max(f,_),L=Math.max(b,C),z=Math.min(M/_,L/C),re=(M-_*z)/2,ue=(L-C*z)/2,pe=new R(M,L);for(let Se=0,Ie=ue;Se<C;Se++,Ie+=z)for(let Be=0,Xe=re;Be<_;Be++,Xe+=z)N.get(Be,Se)&&pe.setRegion(Xe,Ie,z,z);return pe}}r.AbstractExpandedDecoder=Rr,r.ArgumentException=m,r.ArithmeticException=oe,r.AztecCode=hI,r.AztecCodeReader=ve,r.AztecCodeWriter=Uy,r.AztecDecoder=$e,r.AztecDetector=tt,r.AztecDetectorResult=Le,r.AztecEncoder=Ks,r.AztecHighLevelEncoder=s0,r.AztecPoint=De,r.BarcodeFormat=q,r.Binarizer=v,r.BinaryBitmap=g,r.BitArray=A,r.BitMatrix=R,r.BitSource=Ft,r.BrowserAztecCodeReader=Ge,r.BrowserBarcodeReader=Nc,r.BrowserCodeReader=ie,r.BrowserDatamatrixCodeReader=wc,r.BrowserMultiFormatReader=Mne,r.BrowserPDF417Reader=Ine,r.BrowserQRCodeReader=One,r.BrowserQRCodeSvgWriter=Bm,r.CharacterSetECI=T,r.ChecksumException=y,r.Code128Reader=Ve,r.Code39Reader=Fe,r.DataMatrixDecodedBitStreamParser=Cs,r.DataMatrixReader=gi,r.DecodeHintType=P,r.DecoderResult=Z,r.DefaultGridSampler=bt,r.DetectorResult=Ke,r.EAN13Reader=Nt,r.EncodeHintType=Jr,r.Exception=u,r.FormatException=O,r.GenericGF=_e,r.GenericGFPoly=Q,r.GlobalHistogramBinarizer=G,r.GridSampler=pt,r.GridSamplerInstance=It,r.HTMLCanvasElementLuminanceSource=le,r.HybridBinarizer=H,r.ITFReader=ot,r.IllegalArgumentException=x,r.IllegalStateException=me,r.InvertedLuminanceSource=K,r.LuminanceSource=$,r.MathUtils=fe,r.MultiFormatOneDReader=wr,r.MultiFormatReader=uI,r.MultiFormatWriter=Lne,r.NotFoundException=F,r.OneDReader=We,r.PDF417DecodedBitStreamParser=st,r.PDF417DecoderErrorCorrection=Xf,r.PDF417Reader=Da,r.PDF417ResultMetadata=Zf,r.PerspectiveTransform=Pe,r.PlanarYUVLuminanceSource=Cc,r.QRCodeByteMatrix=$y,r.QRCodeDataMask=er,r.QRCodeDecodedBitStreamParser=Dn,r.QRCodeDecoderErrorCorrectionLevel=ye,r.QRCodeDecoderFormatInformation=at,r.QRCodeEncoder=Mn,r.QRCodeEncoderQRCode=Fm,r.QRCodeMaskUtil=ur,r.QRCodeMatrixUtil=cs,r.QRCodeMode=ss,r.QRCodeReader=_c,r.QRCodeVersion=$t,r.QRCodeWriter=Sx,r.RGBLuminanceSource=vS,r.RSS14Reader=ln,r.RSSExpandedReader=yt,r.ReaderException=By,r.ReedSolomonDecoder=Re,r.ReedSolomonEncoder=yS,r.ReedSolomonException=xe,r.Result=te,r.ResultMetadataType=X,r.ResultPoint=Ae,r.StringUtils=W,r.UnsupportedOperationException=B,r.VideoInputDevice=se,r.WhiteRectangleDetector=He,r.WriterException=Nn,r.ZXingArrays=E,r.ZXingCharset=mI,r.ZXingInteger=k,r.ZXingStandardCharsets=jS,r.ZXingStringBuilder=V,r.ZXingStringEncoding=U,r.ZXingSystem=j,r.createAbstractExpandedDecoder=bl,Object.defineProperty(r,"__esModule",{value:!0})})})(GA,GA.exports);var Rn=GA.exports;const fXe=Ro(Rn),gXe=f$({__proto__:null,default:fXe},[Rn]);var WB=function(){function t(s,r,a){if(this.formatMap=new Map([[Ht.QR_CODE,Rn.BarcodeFormat.QR_CODE],[Ht.AZTEC,Rn.BarcodeFormat.AZTEC],[Ht.CODABAR,Rn.BarcodeFormat.CODABAR],[Ht.CODE_39,Rn.BarcodeFormat.CODE_39],[Ht.CODE_93,Rn.BarcodeFormat.CODE_93],[Ht.CODE_128,Rn.BarcodeFormat.CODE_128],[Ht.DATA_MATRIX,Rn.BarcodeFormat.DATA_MATRIX],[Ht.MAXICODE,Rn.BarcodeFormat.MAXICODE],[Ht.ITF,Rn.BarcodeFormat.ITF],[Ht.EAN_13,Rn.BarcodeFormat.EAN_13],[Ht.EAN_8,Rn.BarcodeFormat.EAN_8],[Ht.PDF_417,Rn.BarcodeFormat.PDF_417],[Ht.RSS_14,Rn.BarcodeFormat.RSS_14],[Ht.RSS_EXPANDED,Rn.BarcodeFormat.RSS_EXPANDED],[Ht.UPC_A,Rn.BarcodeFormat.UPC_A],[Ht.UPC_E,Rn.BarcodeFormat.UPC_E],[Ht.UPC_EAN_EXTENSION,Rn.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!gXe)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=r,this.logger=a;var i=this.createZXingFormats(s),l=new Map;l.set(Rn.DecodeHintType.POSSIBLE_FORMATS,i),l.set(Rn.DecodeHintType.TRY_HARDER,!1),this.hints=l}return t.prototype.decodeAsync=function(s){var r=this;return new Promise(function(a,i){try{a(r.decode(s))}catch(l){i(l)}})},t.prototype.decode=function(s){var r=new Rn.MultiFormatReader(this.verbose,this.hints),a=new Rn.HTMLCanvasElementLuminanceSource(s),i=new Rn.BinaryBitmap(new Rn.HybridBinarizer(a)),l=r.decode(i);return{text:l.text,format:cne.create(this.toHtml5QrcodeSupportedFormats(l.format)),debugData:this.createDebugData()}},t.prototype.createReverseFormatMap=function(){var s=new Map;return this.formatMap.forEach(function(r,a,i){s.set(r,a)}),s},t.prototype.toHtml5QrcodeSupportedFormats=function(s){if(!this.reverseFormatMap.has(s))throw"reverseFormatMap doesn't have ".concat(s);return this.reverseFormatMap.get(s)},t.prototype.createZXingFormats=function(s){for(var r=[],a=0,i=s;a<i.length;a++){var l=i[a];this.formatMap.has(l)?r.push(this.formatMap.get(l)):this.logger.logError("".concat(l," is not supported by")+"ZXingHtml5QrcodeShim")}return r},t.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},t}(),bXe=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},yXe=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},qB=function(){function t(s,r,a){if(this.formatMap=new Map([[Ht.QR_CODE,"qr_code"],[Ht.AZTEC,"aztec"],[Ht.CODABAR,"codabar"],[Ht.CODE_39,"code_39"],[Ht.CODE_93,"code_93"],[Ht.CODE_128,"code_128"],[Ht.DATA_MATRIX,"data_matrix"],[Ht.ITF,"itf"],[Ht.EAN_13,"ean_13"],[Ht.EAN_8,"ean_8"],[Ht.PDF_417,"pdf417"],[Ht.UPC_A,"upc_a"],[Ht.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!t.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=r,this.logger=a;var i=this.createBarcodeDetectorFormats(s);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return t.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var s=new BarcodeDetector({formats:["qr_code"]});return typeof s<"u"},t.prototype.decodeAsync=function(s){return bXe(this,void 0,void 0,function(){var r,a;return yXe(this,function(i){switch(i.label){case 0:return[4,this.detector.detect(s)];case 1:if(r=i.sent(),!r||r.length===0)throw"No barcode or QR code detected.";return a=this.selectLargestBarcode(r),[2,{text:a.rawValue,format:cne.create(this.toHtml5QrcodeSupportedFormats(a.format)),debugData:this.createDebugData()}]}})})},t.prototype.selectLargestBarcode=function(s){for(var r=null,a=0,i=0,l=s;i<l.length;i++){var o=l[i],c=o.boundingBox.width*o.boundingBox.height;c>a&&(a=c,r=o)}if(!r)throw"No largest barcode found";return r},t.prototype.createBarcodeDetectorFormats=function(s){for(var r=[],a=0,i=s;a<i.length;a++){var l=i[a];this.formatMap.has(l)?r.push(this.formatMap.get(l)):this.logger.warn("".concat(l," is not supported by")+"BarcodeDetectorDelegate")}return{formats:r}},t.prototype.toHtml5QrcodeSupportedFormats=function(s){if(!this.reverseFormatMap.has(s))throw"reverseFormatMap doesn't have ".concat(s);return this.reverseFormatMap.get(s)},t.prototype.createReverseFormatMap=function(){var s=new Map;return this.formatMap.forEach(function(r,a,i){s.set(r,a)}),s},t.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},t}(),GB=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},KB=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},vXe=function(){function t(s,r,a,i){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=a,r&&qB.isSupported()?(this.primaryDecoder=new qB(s,a,i),this.secondaryDecoder=new WB(s,a,i)):this.primaryDecoder=new WB(s,a,i)}return t.prototype.decodeAsync=function(s){return GB(this,void 0,void 0,function(){var r;return KB(this,function(a){switch(a.label){case 0:r=performance.now(),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(s)];case 2:return[2,a.sent()];case 3:return this.possiblyLogPerformance(r),[7];case 4:return[2]}})})},t.prototype.decodeRobustlyAsync=function(s){return GB(this,void 0,void 0,function(){var r,a;return KB(this,function(i){switch(i.label){case 0:r=performance.now(),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(s)];case 2:return[2,i.sent()];case 3:if(a=i.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(s)];throw a;case 4:return this.possiblyLogPerformance(r),[7];case 5:return[2]}})})},t.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},t.prototype.possiblyLogPerformance=function(s){if(this.verbose){var r=performance.now()-s;this.executionResults.push(r),this.executions++,this.possiblyFlushPerformanceReport()}},t.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var s=0,r=0,a=this.executionResults;r<a.length;r++){var i=a[r];s+=i}var l=s/this.executionResults.length;console.log("".concat(l," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},t}(),aI=function(){var t=function(s,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(a[l]=i[l])},t(s,r)};return function(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(s,r);function a(){this.constructor=s}s.prototype=r===null?Object.create(r):(a.prototype=r.prototype,new a)}}(),Ew=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},Tw=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},hne=function(){function t(s,r){this.name=s,this.track=r}return t.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},t.prototype.apply=function(s){var r={};r[this.name]=s;var a={advanced:[r]};return this.track.applyConstraints(a)},t.prototype.value=function(){var s=this.track.getSettings();if(this.name in s){var r=s[this.name];return r}return null},t}(),jXe=function(t){aI(s,t);function s(r,a){return t.call(this,r,a)||this}return s.prototype.min=function(){return this.getCapabilities().min},s.prototype.max=function(){return this.getCapabilities().max},s.prototype.step=function(){return this.getCapabilities().step},s.prototype.apply=function(r){var a={};a[this.name]=r;var i={advanced:[a]};return this.track.applyConstraints(i)},s.prototype.getCapabilities=function(){this.failIfNotSupported();var r=this.track.getCapabilities(),a=r[this.name];return{min:a.min,max:a.max,step:a.step}},s.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},s}(hne),NXe=function(t){aI(s,t);function s(r){return t.call(this,"zoom",r)||this}return s}(jXe),wXe=function(t){aI(s,t);function s(r){return t.call(this,"torch",r)||this}return s}(hne),_Xe=function(){function t(s){this.track=s}return t.prototype.zoomFeature=function(){return new NXe(this.track)},t.prototype.torchFeature=function(){return new wXe(this.track)},t}(),SXe=function(){function t(s,r,a){this.isClosed=!1,this.parentElement=s,this.mediaStream=r,this.callbacks=a,this.surface=this.createVideoElement(this.parentElement.clientWidth),s.append(this.surface)}return t.prototype.createVideoElement=function(s){var r=document.createElement("video");return r.style.width="".concat(s,"px"),r.style.display="block",r.muted=!0,r.setAttribute("muted","true"),r.playsInline=!0,r},t.prototype.setupSurface=function(){var s=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var r=function(){var a=s.surface.clientWidth,i=s.surface.clientHeight;s.callbacks.onRenderSurfaceReady(a,i),s.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.srcObject=this.mediaStream,this.surface.play()},t.create=function(s,r,a,i){return Ew(this,void 0,void 0,function(){var l,o;return Tw(this,function(c){switch(c.label){case 0:return l=new t(s,r,i),a.aspectRatio?(o={aspectRatio:a.aspectRatio},[4,l.getFirstTrackOrFail().applyConstraints(o)]):[3,2];case 1:c.sent(),c.label=2;case 2:return l.setupSurface(),[2,l]}})})},t.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},t.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},t.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},t.prototype.resume=function(s){this.failIfClosed();var r=this,a=function(){setTimeout(s,200),r.surface.removeEventListener("playing",a)};this.surface.addEventListener("playing",a),this.surface.play()},t.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},t.prototype.getSurface=function(){return this.failIfClosed(),this.surface},t.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},t.prototype.applyVideoConstraints=function(s){return Ew(this,void 0,void 0,function(){return Tw(this,function(r){if("aspectRatio"in s)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(s)]})})},t.prototype.close=function(){if(this.isClosed)return Promise.resolve();var s=this;return new Promise(function(r,a){var i=s.mediaStream.getVideoTracks(),l=i.length,o=0;s.mediaStream.getVideoTracks().forEach(function(c){s.mediaStream.removeTrack(c),c.stop(),++o,o>=l&&(s.isClosed=!0,s.parentElement.removeChild(s.surface),r())})})},t.prototype.getCapabilities=function(){return new _Xe(this.getFirstTrackOrFail())},t}(),CXe=function(){function t(s){this.mediaStream=s}return t.prototype.render=function(s,r,a){return Ew(this,void 0,void 0,function(){return Tw(this,function(i){return[2,SXe.create(s,this.mediaStream,r,a)]})})},t.create=function(s){return Ew(this,void 0,void 0,function(){var r,a;return Tw(this,function(i){switch(i.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return r={audio:!1,video:s},[4,navigator.mediaDevices.getUserMedia(r)];case 1:return a=i.sent(),[2,new t(a)]}})})},t}(),YB=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},XB=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},kXe=function(){function t(){}return t.failIfNotSupported=function(){return YB(this,void 0,void 0,function(){return XB(this,function(s){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new t]})})},t.prototype.create=function(s){return YB(this,void 0,void 0,function(){return XB(this,function(r){return[2,CXe.create(s)]})})},t}(),AXe=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},EXe=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},TXe=function(){function t(){}return t.retrieve=function(){if(navigator.mediaDevices)return t.getCamerasFromMediaDevices();var s=MediaStreamTrack;return MediaStreamTrack&&s.getSources?t.getCamerasFromMediaStreamTrack():t.rejectWithError()},t.rejectWithError=function(){var s=Cp.unableToQuerySupportedDevices();return t.isHttpsOrLocalhost()||(s=Cp.insecureContextCameraQueryError()),Promise.reject(s)},t.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var s=location.host.split(":")[0];return s==="127.0.0.1"||s==="localhost"},t.getCamerasFromMediaDevices=function(){return AXe(this,void 0,void 0,function(){var s,r,a,i,l,o,c;return EXe(this,function(d){switch(d.label){case 0:return s=function(u){for(var m=u.getVideoTracks(),x=0,g=m;x<g.length;x++){var y=g[x];y.enabled=!1,y.stop(),u.removeTrack(y)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return r=d.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(a=d.sent(),i=[],l=0,o=a;l<o.length;l++)c=o[l],c.kind==="videoinput"&&i.push({id:c.deviceId,label:c.label});return s(r),[2,i]}})})},t.getCamerasFromMediaStreamTrack=function(){return new Promise(function(s,r){var a=function(l){for(var o=[],c=0,d=l;c<d.length;c++){var u=d[c];u.kind==="video"&&o.push({id:u.id,label:u.label})}s(o)},i=MediaStreamTrack;i.getSources(a)})},t}(),xr;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.NOT_STARTED=1]="NOT_STARTED",t[t.SCANNING=2]="SCANNING",t[t.PAUSED=3]="PAUSED"})(xr||(xr={}));var PXe=function(){function t(){this.state=xr.NOT_STARTED,this.onGoingTransactionNewState=xr.UNKNOWN}return t.prototype.directTransition=function(s){this.failIfTransitionOngoing(),this.validateTransition(s),this.state=s},t.prototype.startTransition=function(s){return this.failIfTransitionOngoing(),this.validateTransition(s),this.onGoingTransactionNewState=s,this},t.prototype.execute=function(){if(this.onGoingTransactionNewState===xr.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var s=this.onGoingTransactionNewState;this.onGoingTransactionNewState=xr.UNKNOWN,this.directTransition(s)},t.prototype.cancel=function(){if(this.onGoingTransactionNewState===xr.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=xr.UNKNOWN},t.prototype.getState=function(){return this.state},t.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==xr.UNKNOWN)throw"Cannot transition to a new state, already under transition"},t.prototype.validateTransition=function(s){switch(this.state){case xr.UNKNOWN:throw"Transition from unknown is not allowed";case xr.NOT_STARTED:this.failIfNewStateIs(s,[xr.PAUSED]);break;case xr.SCANNING:break;case xr.PAUSED:break}},t.prototype.failIfNewStateIs=function(s,r){for(var a=0,i=r;a<i.length;a++){var l=i[a];if(s===l)throw"Cannot transition from ".concat(this.state," to ").concat(s)}},t}(),DXe=function(){function t(s){this.stateManager=s}return t.prototype.startTransition=function(s){return this.stateManager.startTransition(s)},t.prototype.directTransition=function(s){this.stateManager.directTransition(s)},t.prototype.getState=function(){return this.stateManager.getState()},t.prototype.canScanFile=function(){return this.stateManager.getState()===xr.NOT_STARTED},t.prototype.isScanning=function(){return this.stateManager.getState()!==xr.NOT_STARTED},t.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===xr.SCANNING},t.prototype.isPaused=function(){return this.stateManager.getState()===xr.PAUSED},t}(),MXe=function(){function t(){}return t.create=function(){return new DXe(new PXe)},t}(),IXe=function(){var t=function(s,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,i){a.__proto__=i}||function(a,i){for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(a[l]=i[l])},t(s,r)};return function(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(s,r);function a(){this.constructor=s}s.prototype=r===null?Object.create(r):(a.prototype=r.prototype,new a)}}(),kl=function(t){IXe(s,t);function s(){return t!==null&&t.apply(this,arguments)||this}return s.DEFAULT_WIDTH=300,s.DEFAULT_WIDTH_OFFSET=2,s.FILE_SCAN_MIN_HEIGHT=300,s.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,s.MIN_QR_BOX_SIZE=50,s.SHADED_LEFT=1,s.SHADED_RIGHT=2,s.SHADED_TOP=3,s.SHADED_BOTTOM=4,s.SHADED_REGION_ELEMENT_ID="qr-shaded-region",s.VERBOSE=!1,s.BORDER_SHADER_DEFAULT_COLOR="#ffffff",s.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",s}(Zo),OXe=function(){function t(s,r){this.logger=r,this.fps=kl.SCAN_DEFAULT_FPS,s?(s.fps&&(this.fps=s.fps),this.disableFlip=s.disableFlip===!0,this.qrbox=s.qrbox,this.aspectRatio=s.aspectRatio,this.videoConstraints=s.videoConstraints):this.disableFlip=kl.DEFAULT_DISABLE_FLIP}return t.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?mne.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},t.prototype.isShadedBoxEnabled=function(){return!$c(this.qrbox)},t.create=function(s,r){return new t(s,r)},t}(),QB=function(){function t(s,r){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(s))throw"HTML Element with id=".concat(s," not found");this.elementId=s,this.verbose=!1;var a;typeof r=="boolean"?this.verbose=r===!0:r&&(a=r,this.verbose=a.verbose===!0,a.experimentalFeatures),this.logger=new une(this.verbose),this.qrcode=new vXe(this.getSupportedFormats(r),this.getUseBarCodeDetectorIfSupported(a),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=MXe.create()}return t.prototype.start=function(s,r,a,i){var l=this;if(!s)throw"cameraIdOrConfig is required";if(!a||typeof a!="function")throw"qrCodeSuccessCallback is required and should be a function.";var o;i?o=i:o=this.verbose?this.logger.log:function(){};var c=OXe.create(r,this.logger);this.clearElement();var d=!1;c.videoConstraints&&(c.isMediaStreamConstraintsValid()?d=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var u=d,m=document.getElementById(this.elementId);m.clientWidth?m.clientWidth:kl.DEFAULT_WIDTH,m.style.position="relative",this.shouldScan=!0,this.element=m;var x=this,g=this.stateManagerProxy.startTransition(xr.SCANNING);return new Promise(function(y,v){var j=u?c.videoConstraints:x.createVideoConstraints(s);if(!j){g.cancel(),v("videoConstraints should be defined");return}var w={};(!u||c.aspectRatio)&&(w.aspectRatio=c.aspectRatio);var S={onRenderSurfaceReady:function(E,k){x.setupUi(E,k,c),x.isScanning=!0,x.foreverScan(c,a,o)}};kXe.failIfNotSupported().then(function(E){E.create(j).then(function(k){return k.render(l.element,w,S).then(function(A){x.renderedCamera=A,g.execute(),y(null)}).catch(function(A){g.cancel(),v(A)})}).catch(function(k){g.cancel(),v(Cp.errorGettingUserMedia(k))})}).catch(function(E){g.cancel(),v(Cp.cameraStreamingNotSupported())})})},t.prototype.pause=function(s){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(xr.PAUSED),this.showPausedState(),($c(s)||s!==!0)&&(s=!1),s&&this.renderedCamera&&this.renderedCamera.pause()},t.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var s=this,r=function(){s.stateManagerProxy.directTransition(xr.SCANNING),s.hidePausedState()};if(!this.renderedCamera.isPaused()){r();return}this.renderedCamera.resume(function(){r()})},t.prototype.getState=function(){return this.stateManagerProxy.getState()},t.prototype.stop=function(){var s=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var r=this.stateManagerProxy.startTransition(xr.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var a=function(){if(s.element){var l=document.getElementById(kl.SHADED_REGION_ELEMENT_ID);l&&s.element.removeChild(l)}},i=this;return this.renderedCamera.close().then(function(){return i.renderedCamera=null,i.element&&(i.element.removeChild(i.canvasElement),i.canvasElement=null),a(),i.qrRegion&&(i.qrRegion=null),i.context&&(i.context=null),r.execute(),i.hidePausedState(),i.isScanning=!1,Promise.resolve()})},t.prototype.scanFile=function(s,r){return this.scanFileV2(s,r).then(function(a){return a.decodedText})},t.prototype.scanFileV2=function(s,r){var a=this;if(!s||!(s instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if($c(r)&&(r=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(i,l){a.possiblyCloseLastScanImageFile(),a.clearElement(),a.lastScanImageFile=URL.createObjectURL(s);var o=new Image;o.onload=function(){var c=o.width,d=o.height,u=document.getElementById(a.elementId),m=u.clientWidth?u.clientWidth:kl.DEFAULT_WIDTH,x=Math.max(u.clientHeight?u.clientHeight:d,kl.FILE_SCAN_MIN_HEIGHT),g=a.computeCanvasDrawConfig(c,d,m,x);if(r){var y=a.createCanvasElement(m,x,"qr-canvas-visible");y.style.display="inline-block",u.appendChild(y);var v=y.getContext("2d");if(!v)throw"Unable to get 2d context from canvas";v.canvas.width=m,v.canvas.height=x,v.drawImage(o,0,0,c,d,g.x,g.y,g.width,g.height)}var j=kl.FILE_SCAN_HIDDEN_CANVAS_PADDING,w=Math.max(o.width,g.width),S=Math.max(o.height,g.height),E=w+2*j,k=S+2*j,A=a.createCanvasElement(E,k);u.appendChild(A);var I=A.getContext("2d");if(!I)throw"Unable to get 2d context from canvas";I.canvas.width=E,I.canvas.height=k,I.drawImage(o,0,0,c,d,j,j,w,S);try{a.qrcode.decodeRobustlyAsync(A).then(function(P){i(VB.createFromQrcodeResult(P))}).catch(l)}catch(P){l("QR code parse error, error = ".concat(P))}},o.onerror=l,o.onabort=l,o.onstalled=l,o.onsuspend=l,o.src=URL.createObjectURL(s)})},t.prototype.clear=function(){this.clearElement()},t.getCameras=function(){return TXe.retrieve()},t.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},t.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},t.prototype.applyVideoConstraints=function(s){if(s){if(!mne.isMediaStreamConstraintsValid(s,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(s)},t.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},t.prototype.getSupportedFormats=function(s){var r=[Ht.QR_CODE,Ht.AZTEC,Ht.CODABAR,Ht.CODE_39,Ht.CODE_93,Ht.CODE_128,Ht.DATA_MATRIX,Ht.MAXICODE,Ht.ITF,Ht.EAN_13,Ht.EAN_8,Ht.PDF_417,Ht.RSS_14,Ht.RSS_EXPANDED,Ht.UPC_A,Ht.UPC_E,Ht.UPC_EAN_EXTENSION];if(!s||typeof s=="boolean"||!s.formatsToSupport)return r;if(!Array.isArray(s.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(s.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var a=[],i=0,l=s.formatsToSupport;i<l.length;i++){var o=l[i];xXe(o)?a.push(o):this.logger.warn("Invalid format: ".concat(o," passed in config, ignoring."))}if(a.length===0)throw"None of formatsToSupport match supported values.";return a},t.prototype.getUseBarCodeDetectorIfSupported=function(s){if($c(s))return!0;if(!$c(s.useBarCodeDetectorIfSupported))return s.useBarCodeDetectorIfSupported!==!1;if($c(s.experimentalFeatures))return!0;var r=s.experimentalFeatures;return $c(r.useBarCodeDetectorIfSupported)?!0:r.useBarCodeDetectorIfSupported!==!1},t.prototype.validateQrboxSize=function(s,r,a){var i=this,l=a.qrbox;this.validateQrboxConfig(l);var o=this.toQrdimensions(s,r,l),c=function(u){if(u<kl.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(kl.MIN_QR_BOX_SIZE,"px.")},d=function(u){return u>s&&(i.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),u=s),u};c(o.width),c(o.height),o.width=d(o.width)},t.prototype.validateQrboxConfig=function(s){if(typeof s!="number"&&typeof s!="function"&&(s.width===void 0||s.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},t.prototype.toQrdimensions=function(s,r,a){if(typeof a=="number")return{width:a,height:a};if(typeof a=="function")try{return a(s,r)}catch(i){throw new Error("qrbox config was passed as a function but it failed with unknown error"+i)}return a},t.prototype.setupUi=function(s,r,a){a.isShadedBoxEnabled()&&this.validateQrboxSize(s,r,a);var i=$c(a.qrbox)?{width:s,height:r}:a.qrbox;this.validateQrboxConfig(i);var l=this.toQrdimensions(s,r,i);l.height>r&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var o=a.isShadedBoxEnabled()&&l.height<=r,c={x:0,y:0,width:s,height:r},d=o?this.getShadedRegionBounds(s,r,l):c,u=this.createCanvasElement(d.width,d.height),m={willReadFrequently:!0},x=u.getContext("2d",m);x.canvas.width=d.width,x.canvas.height=d.height,this.element.append(u),o&&this.possiblyInsertShadingElement(this.element,s,r,l),this.createScannerPausedUiElement(this.element),this.qrRegion=d,this.context=x,this.canvasElement=u},t.prototype.createScannerPausedUiElement=function(s){var r=document.createElement("div");r.innerText=Cp.scannerPaused(),r.style.display="none",r.style.position="absolute",r.style.top="0px",r.style.zIndex="1",r.style.background="rgba(9, 9, 9, 0.46)",r.style.color="#FFECEC",r.style.textAlign="center",r.style.width="100%",s.appendChild(r),this.scannerPausedUiElement=r},t.prototype.scanContext=function(s,r){var a=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(i){return s(i.text,VB.createFromQrcodeResult(i)),a.possiblyUpdateShaders(!0),!0}).catch(function(i){a.possiblyUpdateShaders(!1);var l=Cp.codeParseError(i);return r(l,dne.createFrom(l)),!1})},t.prototype.foreverScan=function(s,r,a){var i=this;if(this.shouldScan&&this.renderedCamera){var l=this.renderedCamera.getSurface(),o=l.videoWidth/l.clientWidth,c=l.videoHeight/l.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var d=this.qrRegion.width*o,u=this.qrRegion.height*c,m=this.qrRegion.x*o,x=this.qrRegion.y*c;this.context.drawImage(l,m,x,d,u,0,0,this.qrRegion.width,this.qrRegion.height);var g=function(){i.foreverScanTimeout=setTimeout(function(){i.foreverScan(s,r,a)},i.getTimeoutFps(s.fps))};this.scanContext(r,a).then(function(y){!y&&s.disableFlip!==!0?(i.context.translate(i.context.canvas.width,0),i.context.scale(-1,1),i.scanContext(r,a).finally(function(){g()})):g()}).catch(function(y){i.logger.logError("Error happend while scanning context",y),g()})}},t.prototype.createVideoConstraints=function(s){if(typeof s=="string")return{deviceId:{exact:s}};if(typeof s=="object"){var r="facingMode",a="deviceId",i={user:!0,environment:!0},l="exact",o=function(v){if(v in i)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(v,"'")},c=Object.keys(s);if(c.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(c.length," keys");var d=Object.keys(s)[0];if(d!==r&&d!==a)throw"Only '".concat(r,"' and '").concat(a,"' ")+" are supported for 'cameraIdOrConfig'";if(d===r){var u=s.facingMode;if(typeof u=="string"){if(o(u))return{facingMode:u}}else if(typeof u=="object")if(l in u){if(o(u["".concat(l)]))return{facingMode:{exact:u["".concat(l)]}}}else throw"'facingMode' should be string or object with"+" ".concat(l," as key.");else{var m=typeof u;throw"Invalid type of 'facingMode' = ".concat(m)}}else{var x=s.deviceId;if(typeof x=="string")return{deviceId:x};if(typeof x=="object"){if(l in x)return{deviceId:{exact:x["".concat(l)]}};throw"'deviceId' should be string or object with"+" ".concat(l," as key.")}else{var g=typeof x;throw"Invalid type of 'deviceId' = ".concat(g)}}}var y=typeof s;throw"Invalid type of 'cameraIdOrConfig' = ".concat(y)},t.prototype.computeCanvasDrawConfig=function(s,r,a,i){if(s<=a&&r<=i){var l=(a-s)/2,o=(i-r)/2;return{x:l,y:o,width:s,height:r}}else{var c=s,d=r;return s>a&&(r=a/s*r,s=a),r>i&&(s=i/r*s,r=i),this.logger.log("Image downsampled from "+"".concat(c,"X").concat(d)+" to ".concat(s,"X").concat(r,".")),this.computeCanvasDrawConfig(s,r,a,i)}},t.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var s=document.getElementById(this.elementId);s&&(s.innerHTML="")},t.prototype.possiblyUpdateShaders=function(s){this.qrMatch!==s&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(r){r.style.backgroundColor=s?kl.BORDER_SHADER_MATCH_COLOR:kl.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=s)},t.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},t.prototype.createCanvasElement=function(s,r,a){var i=s,l=r,o=document.createElement("canvas");return o.style.width="".concat(i,"px"),o.style.height="".concat(l,"px"),o.style.display="none",o.id=$c(a)?"qr-canvas":a,o},t.prototype.getShadedRegionBounds=function(s,r,a){if(a.width>s||a.height>r)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(s-a.width)/2,y:(r-a.height)/2,width:a.width,height:a.height}},t.prototype.possiblyInsertShadingElement=function(s,r,a,i){if(!(r-i.width<1||a-i.height<1)){var l=document.createElement("div");l.style.position="absolute";var o=(r-i.width)/2,c=(a-i.height)/2;if(l.style.borderLeft="".concat(o,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderRight="".concat(o,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderTop="".concat(c,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderBottom="".concat(c,"px solid rgba(0, 0, 0, 0.48)"),l.style.boxSizing="border-box",l.style.top="0px",l.style.bottom="0px",l.style.left="0px",l.style.right="0px",l.id="".concat(kl.SHADED_REGION_ELEMENT_ID),r-i.width<11||a-i.height<11)this.hasBorderShaders=!1;else{var d=5,u=40;this.insertShaderBorders(l,u,d,-d,null,0,!0),this.insertShaderBorders(l,u,d,-d,null,0,!1),this.insertShaderBorders(l,u,d,null,-d,0,!0),this.insertShaderBorders(l,u,d,null,-d,0,!1),this.insertShaderBorders(l,d,u+d,-d,null,-d,!0),this.insertShaderBorders(l,d,u+d,null,-d,-d,!0),this.insertShaderBorders(l,d,u+d,-d,null,-d,!1),this.insertShaderBorders(l,d,u+d,null,-d,-d,!1),this.hasBorderShaders=!0}s.append(l)}},t.prototype.insertShaderBorders=function(s,r,a,i,l,o,c){var d=document.createElement("div");d.style.position="absolute",d.style.backgroundColor=kl.BORDER_SHADER_DEFAULT_COLOR,d.style.width="".concat(r,"px"),d.style.height="".concat(a,"px"),i!==null&&(d.style.top="".concat(i,"px")),l!==null&&(d.style.bottom="".concat(l,"px")),c?d.style.left="".concat(o,"px"):d.style.right="".concat(o,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(d),s.appendChild(d)},t.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},t.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},t.prototype.getTimeoutFps=function(s){return 1e3/s},t}(),iI="data:image/svg+xml;base64,",RXe=iI+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",LXe=iI+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",ZB=iI+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",FXe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",JB=function(){function t(){}return t.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},t}(),BXe=function(){function t(){this.data=JB.createDefault();var s=localStorage.getItem(t.LOCAL_STORAGE_KEY);s?this.data=JSON.parse(s):this.reset()}return t.prototype.hasCameraPermissions=function(){return this.data.hasPermission},t.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},t.prototype.setHasPermission=function(s){this.data.hasPermission=s,this.flush()},t.prototype.setLastUsedCameraId=function(s){this.data.lastUsedCameraId=s,this.flush()},t.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},t.prototype.reset=function(){this.data=JB.createDefault(),this.flush()},t.prototype.flush=function(){localStorage.setItem(t.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},t.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",t}(),$Xe=function(){function t(){this.infoDiv=document.createElement("div")}return t.prototype.renderInto=function(s){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=HB.poweredBy();var r=document.createElement("a");r.innerText="ScanApp",r.href="https://scanapp.org",r.target="new",r.style.color="white",this.infoDiv.appendChild(r);var a=document.createElement("br"),i=document.createElement("br");this.infoDiv.appendChild(a),this.infoDiv.appendChild(i);var l=document.createElement("a");l.innerText=HB.reportIssues(),l.href="https://github.com/mebjas/html5-qrcode/issues",l.target="new",l.style.color="white",this.infoDiv.appendChild(l),s.appendChild(this.infoDiv)},t.prototype.show=function(){this.infoDiv.style.display="block"},t.prototype.hide=function(){this.infoDiv.style.display="none"},t}(),zXe=function(){function t(s,r){this.isShowingInfoIcon=!0,this.onTapIn=s,this.onTapOut=r,this.infoIcon=document.createElement("img")}return t.prototype.renderInto=function(s){var r=this;this.infoIcon.alt="Info icon",this.infoIcon.src=ZB,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(a){return r.onHoverIn()},this.infoIcon.onmouseout=function(a){return r.onHoverOut()},this.infoIcon.onclick=function(a){return r.onClick()},s.appendChild(this.infoIcon)},t.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},t.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},t.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=FXe,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=ZB,this.infoIcon.style.opacity="0.6")},t}(),UXe=function(){function t(){var s=this;this.infoDiv=new $Xe,this.infoIcon=new zXe(function(){s.infoDiv.show()},function(){s.infoDiv.hide()})}return t.prototype.renderInto=function(s){this.infoDiv.renderInto(s),this.infoIcon.renderInto(s)},t}(),VXe=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},HXe=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},e$=function(){function t(){}return t.hasPermissions=function(){return VXe(this,void 0,void 0,function(){var s,r,a,i;return HXe(this,function(l){switch(l.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(s=l.sent(),r=0,a=s;r<a.length;r++)if(i=a[r],i.kind==="videoinput"&&i.label)return[2,!0];return[2,!1]}})})},t}(),Tu=function(){function t(s){this.supportedScanTypes=this.validateAndReturnScanTypes(s)}return t.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},t.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},t.prototype.isCameraScanRequired=function(){for(var s=0,r=this.supportedScanTypes;s<r.length;s++){var a=r[s];if(t.isCameraScanType(a))return!0}return!1},t.isCameraScanType=function(s){return s===jm.SCAN_TYPE_CAMERA},t.isFileScanType=function(s){return s===jm.SCAN_TYPE_FILE},t.prototype.validateAndReturnScanTypes=function(s){if(!s||s.length===0)return Zo.DEFAULT_SUPPORTED_SCAN_TYPE;var r=Zo.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(s.length>r)throw"Max ".concat(r," values expected for ")+"supportedScanTypes";for(var a=0,i=s;a<i.length;a++){var l=i[a];if(!Zo.DEFAULT_SUPPORTED_SCAN_TYPE.includes(l))throw"Unsupported scan type ".concat(l)}return s},t}(),Ol=function(){function t(){}return t.ALL_ELEMENT_CLASS="html5-qrcode-element",t.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",t.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",t.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",t.TORCH_BUTTON_ID="html5-qrcode-button-torch",t.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",t.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",t.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",t.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",t.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",t.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",t}(),Bd=function(){function t(){}return t.createElement=function(s,r){var a=document.createElement(s);return a.id=r,a.classList.add(Ol.ALL_ELEMENT_CLASS),s==="button"&&a.setAttribute("type","button"),a},t}(),xne=function(t,s,r,a){function i(l){return l instanceof r?l:new r(function(o){o(l)})}return new(r||(r=Promise))(function(l,o){function c(m){try{u(a.next(m))}catch(x){o(x)}}function d(m){try{u(a.throw(m))}catch(x){o(x)}}function u(m){m.done?l(m.value):i(m.value).then(c,d)}u((a=a.apply(t,s||[])).next())})},pne=function(t,s){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},a,i,l,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(m){return d([u,m])}}function d(u){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(a=1,i&&(l=u[0]&2?i.return:u[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,u[1])).done)return l;switch(i=0,l&&(u=[u[0]&2,l.value]),u[0]){case 0:case 1:l=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!l||u[1]>l[0]&&u[1]<l[3])){r.label=u[1];break}if(u[0]===6&&r.label<l[1]){r.label=l[1],l=u;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(u);break}l[2]&&r.ops.pop(),r.trys.pop();continue}u=s.call(t,r)}catch(m){u=[6,m],i=0}finally{a=l=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},t$=function(){function t(s,r,a){this.isTorchOn=!1,this.torchCapability=s,this.buttonController=r,this.onTorchActionFailureCallback=a}return t.prototype.isTorchEnabled=function(){return this.isTorchOn},t.prototype.flipState=function(){return xne(this,void 0,void 0,function(){var s,r;return pne(this,function(a){switch(a.label){case 0:this.buttonController.disable(),s=!this.isTorchOn,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.torchCapability.apply(s)];case 2:return a.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),s),[3,4];case 3:return r=a.sent(),this.propagateFailure(s,r),this.buttonController.enable(),[3,4];case 4:return[2]}})})},t.prototype.updateUiBasedOnLatestSettings=function(s,r){s===r?(this.buttonController.setText(r?xn.torchOffButton():xn.torchOnButton()),this.isTorchOn=r):this.propagateFailure(r),this.buttonController.enable()},t.prototype.propagateFailure=function(s,r){var a=s?xn.torchOnFailedMessage():xn.torchOffFailedMessage();r&&(a+="; Error = "+r),this.onTorchActionFailureCallback(a)},t.prototype.reset=function(){this.isTorchOn=!1},t}(),WXe=function(){function t(s,r){this.onTorchActionFailureCallback=r,this.torchButton=Bd.createElement("button",Ol.TORCH_BUTTON_ID),this.torchController=new t$(s,this,r)}return t.prototype.render=function(s,r){var a=this;this.torchButton.innerText=xn.torchOnButton(),this.torchButton.style.display=r.display,this.torchButton.style.marginLeft=r.marginLeft;var i=this;this.torchButton.addEventListener("click",function(l){return xne(a,void 0,void 0,function(){return pne(this,function(o){switch(o.label){case 0:return[4,i.torchController.flipState()];case 1:return o.sent(),i.torchController.isTorchEnabled()?(i.torchButton.classList.remove(Ol.TORCH_BUTTON_CLASS_TORCH_OFF),i.torchButton.classList.add(Ol.TORCH_BUTTON_CLASS_TORCH_ON)):(i.torchButton.classList.remove(Ol.TORCH_BUTTON_CLASS_TORCH_ON),i.torchButton.classList.add(Ol.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),s.appendChild(this.torchButton)},t.prototype.updateTorchCapability=function(s){this.torchController=new t$(s,this,this.onTorchActionFailureCallback)},t.prototype.getTorchButton=function(){return this.torchButton},t.prototype.hide=function(){this.torchButton.style.display="none"},t.prototype.show=function(){this.torchButton.style.display="inline-block"},t.prototype.disable=function(){this.torchButton.disabled=!0},t.prototype.enable=function(){this.torchButton.disabled=!1},t.prototype.setText=function(s){this.torchButton.innerText=s},t.prototype.reset=function(){this.torchButton.innerText=xn.torchOnButton(),this.torchController.reset()},t.create=function(s,r,a,i){var l=new t(r,i);return l.render(s,a),l},t}(),qXe=function(){function t(s,r,a){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=r?"block":"none",s.appendChild(this.fileBasedScanRegion);var i=document.createElement("label");i.setAttribute("for",this.getFileScanInputId()),i.style.display="inline-block",this.fileBasedScanRegion.appendChild(i),this.fileSelectionButton=Bd.createElement("button",Ol.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(c){i.click()}),i.append(this.fileSelectionButton),this.fileScanInput=Bd.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",i.appendChild(this.fileScanInput);var l=this;this.fileScanInput.addEventListener("change",function(c){if(!(c==null||c.target==null)){var d=c.target;if(!(d.files&&d.files.length===0)){var u=d.files,m=u[0],x=m.name;l.setImageNameToButton(x),a(m)}}});var o=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(o),this.fileBasedScanRegion.addEventListener("dragenter",function(c){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionActiveBorder(),c.stopPropagation(),c.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(c){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionDefaultBorder(),c.stopPropagation(),c.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(c){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionActiveBorder(),c.stopPropagation(),c.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(c){c.stopPropagation(),c.preventDefault(),l.fileBasedScanRegion.style.border=l.fileBasedScanRegionDefaultBorder();var d=c.dataTransfer;if(d){var u=d.files;if(!u||u.length===0)return;for(var m=!1,x=0;x<u.length;++x){var g=u.item(x);if(g){var y=/image.*/;if(g.type.match(y)){m=!0;var v=g.name;l.setImageNameToButton(v),a(g),o.innerText=xn.dragAndDropMessage();break}}}m||(o.innerText=xn.dragAndDropMessageOnlyImages())}})}return t.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},t.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},t.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},t.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},t.prototype.createFileBasedScanRegion=function(){var s=document.createElement("div");return s.style.textAlign="center",s.style.margin="auto",s.style.width="80%",s.style.maxWidth="600px",s.style.border=this.fileBasedScanRegionDefaultBorder(),s.style.padding="10px",s.style.marginBottom="10px",s},t.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},t.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},t.prototype.createDragAndDropMessage=function(){var s=document.createElement("div");return s.innerText=xn.dragAndDropMessage(),s.style.fontWeight="400",s},t.prototype.setImageNameToButton=function(s){var r=20;if(s.length>r){var a=s.substring(0,8),i=s.length,l=s.substring(i-8,i);s="".concat(a,"....").concat(l)}var o=xn.fileSelectionChooseAnother()+" - "+s;this.fileSelectionButton.innerText=o},t.prototype.setInitialValueToButton=function(){var s=xn.fileSelectionChooseImage()+" - "+xn.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=s},t.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},t.create=function(s,r,a){var i=new t(s,r,a);return i},t}(),GXe=function(){function t(s){this.selectElement=Bd.createElement("select",Ol.CAMERA_SELECTION_SELECT_ID),this.cameras=s,this.options=[]}return t.prototype.render=function(s){var r=document.createElement("span");r.style.marginRight="10px";var a=this.cameras.length;if(a===0)throw new Error("No cameras found");if(a===1)r.style.display="none";else{var i=xn.selectCamera();r.innerText="".concat(i," (").concat(this.cameras.length,")  ")}for(var l=1,o=0,c=this.cameras;o<c.length;o++){var d=c[o],u=d.id,m=d.label==null?u:d.label;(!m||m==="")&&(m=[xn.anonymousCameraPrefix(),l++].join(" "));var x=document.createElement("option");x.value=u,x.innerText=m,this.options.push(x),this.selectElement.appendChild(x)}r.appendChild(this.selectElement),s.appendChild(r)},t.prototype.disable=function(){this.selectElement.disabled=!0},t.prototype.isDisabled=function(){return this.selectElement.disabled===!0},t.prototype.enable=function(){this.selectElement.disabled=!1},t.prototype.getValue=function(){return this.selectElement.value},t.prototype.hasValue=function(s){for(var r=0,a=this.options;r<a.length;r++){var i=a[r];if(i.value===s)return!0}return!1},t.prototype.setValue=function(s){if(!this.hasValue(s))throw new Error("".concat(s," is not present in the camera list."));this.selectElement.value=s},t.prototype.hasSingleItem=function(){return this.cameras.length===1},t.prototype.numCameras=function(){return this.cameras.length},t.create=function(s,r){var a=new t(r);return a.render(s),a},t}(),KXe=function(){function t(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=Bd.createElement("input",Ol.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return t.prototype.render=function(s,r){this.zoomElementContainer.style.display=r?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",s.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var a=xn.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(a),this.rangeText.style.marginRight="10px";var i=this;this.rangeInput.addEventListener("input",function(){return i.onValueChange()}),this.rangeInput.addEventListener("change",function(){return i.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},t.prototype.onValueChange=function(){var s=xn.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(s),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},t.prototype.setValues=function(s,r,a,i){this.rangeInput.min=s.toString(),this.rangeInput.max=r.toString(),this.rangeInput.step=i.toString(),this.rangeInput.value=a.toString(),this.onValueChange()},t.prototype.show=function(){this.zoomElementContainer.style.display="block"},t.prototype.hide=function(){this.zoomElementContainer.style.display="none"},t.prototype.setOnCameraZoomValueChangeCallback=function(s){this.onChangeCallback=s},t.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},t.create=function(s,r){var a=new t;return a.render(s,r),a},t}(),Al;(function(t){t[t.STATUS_DEFAULT=0]="STATUS_DEFAULT",t[t.STATUS_SUCCESS=1]="STATUS_SUCCESS",t[t.STATUS_WARNING=2]="STATUS_WARNING",t[t.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Al||(Al={}));function YXe(t){return{fps:t.fps,qrbox:t.qrbox,aspectRatio:t.aspectRatio,disableFlip:t.disableFlip,videoConstraints:t.videoConstraints}}function XXe(t,s){return{formatsToSupport:t.formatsToSupport,useBarCodeDetectorIfSupported:t.useBarCodeDetectorIfSupported,experimentalFeatures:t.experimentalFeatures,verbose:s}}var QXe=function(){function t(s,r,a){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=s,this.config=this.createConfig(r),this.verbose=a===!0,!document.getElementById(s))throw"HTML Element with id=".concat(s," not found");this.scanTypeSelector=new Tu(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new une(this.verbose),this.persistedDataManager=new BXe,r.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return t.prototype.render=function(s,r){var a=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(l,o){if(s)s(l,o);else{if(a.lastMatchFound===l)return;a.lastMatchFound=l,a.setHeaderMessage(xn.lastMatch(l),Al.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(l,o){r&&r(l,o)};var i=document.getElementById(this.elementId);if(!i)throw"HTML Element with id=".concat(this.elementId," not found");i.innerHTML="",this.createBasicLayout(i),this.html5Qrcode=new QB(this.getScanRegionId(),XXe(this.config,this.verbose))},t.prototype.pause=function(s){($c(s)||s!==!0)&&(s=!1),this.getHtml5QrcodeOrFail().pause(s)},t.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},t.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},t.prototype.clear=function(){var s=this,r=function(){var a=document.getElementById(s.elementId);a&&(a.innerHTML="",s.resetBasicLayout(a))};return this.html5Qrcode?new Promise(function(a,i){if(!s.html5Qrcode){a();return}s.html5Qrcode.isScanning?s.html5Qrcode.stop().then(function(l){if(!s.html5Qrcode){a();return}s.html5Qrcode.clear(),r(),a()}).catch(function(l){s.verbose&&s.logger.logError("Unable to stop qrcode scanner",l),i(l)}):(s.html5Qrcode.clear(),r(),a())}):Promise.resolve()},t.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},t.prototype.applyVideoConstraints=function(s){return this.getHtml5QrcodeOrFail().applyVideoConstraints(s)},t.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},t.prototype.createConfig=function(s){return s?(s.fps||(s.fps=Zo.SCAN_DEFAULT_FPS),s.rememberLastUsedCamera!==!Zo.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(s.rememberLastUsedCamera=Zo.DEFAULT_REMEMBER_LAST_CAMERA_USED),s.supportedScanTypes||(s.supportedScanTypes=Zo.DEFAULT_SUPPORTED_SCAN_TYPE),s):{fps:Zo.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Zo.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Zo.DEFAULT_SUPPORTED_SCAN_TYPE}},t.prototype.createBasicLayout=function(s){s.style.position="relative",s.style.padding="0px",s.style.border="1px solid silver",this.createHeader(s);var r=document.createElement("div"),a=this.getScanRegionId();r.id=a,r.style.width="100%",r.style.minHeight="100px",r.style.textAlign="center",s.appendChild(r),Tu.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var i=document.createElement("div"),l=this.getDashboardId();i.id=l,i.style.width="100%",s.appendChild(i),this.setupInitialDashboard(i)},t.prototype.resetBasicLayout=function(s){s.style.border="none"},t.prototype.setupInitialDashboard=function(s){this.createSection(s),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},t.prototype.createHeader=function(s){var r=document.createElement("div");r.style.textAlign="left",r.style.margin="0px",s.appendChild(r);var a=new UXe;a.renderInto(r);var i=document.createElement("div");i.id=this.getHeaderMessageContainerId(),i.style.display="none",i.style.textAlign="center",i.style.fontSize="14px",i.style.padding="2px 10px",i.style.margin="4px",i.style.borderTop="1px solid #f6f6f6",r.appendChild(i)},t.prototype.createSection=function(s){var r=document.createElement("div");r.id=this.getDashboardSectionId(),r.style.width="100%",r.style.padding="10px 0px 10px 0px",r.style.textAlign="left",s.appendChild(r)},t.prototype.createCameraListUi=function(s,r,a){var i=this;i.showHideScanTypeSwapLink(!1),i.setHeaderMessage(xn.cameraPermissionRequesting());var l=function(){a||i.createPermissionButton(s,r)};QB.getCameras().then(function(o){i.persistedDataManager.setHasPermission(!0),i.showHideScanTypeSwapLink(!0),i.resetHeaderMessage(),o&&o.length>0?(s.removeChild(r),i.renderCameraSelection(o)):(i.setHeaderMessage(xn.noCameraFound(),Al.STATUS_WARNING),l())}).catch(function(o){i.persistedDataManager.setHasPermission(!1),a?a.disabled=!1:l(),i.setHeaderMessage(o,Al.STATUS_WARNING),i.showHideScanTypeSwapLink(!0)})},t.prototype.createPermissionButton=function(s,r){var a=this,i=Bd.createElement("button",this.getCameraPermissionButtonId());i.innerText=xn.cameraPermissionTitle(),i.addEventListener("click",function(){i.disabled=!0,a.createCameraListUi(s,r,i)}),r.appendChild(i)},t.prototype.createPermissionsUi=function(s,r){var a=this;if(Tu.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){e$.hasPermissions().then(function(i){i?a.createCameraListUi(s,r):(a.persistedDataManager.setHasPermission(!1),a.createPermissionButton(s,r))}).catch(function(i){a.persistedDataManager.setHasPermission(!1),a.createPermissionButton(s,r)});return}this.createPermissionButton(s,r)},t.prototype.createSectionControlPanel=function(){var s=document.getElementById(this.getDashboardSectionId()),r=document.createElement("div");s.appendChild(r);var a=document.createElement("div");a.id=this.getDashboardSectionCameraScanRegionId(),a.style.display=Tu.isCameraScanType(this.currentScanType)?"block":"none",r.appendChild(a);var i=document.createElement("div");i.style.textAlign="center",a.appendChild(i),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(a,i),this.renderFileScanUi(r)},t.prototype.renderFileScanUi=function(s){var r=Tu.isFileScanType(this.currentScanType),a=this,i=function(l){if(!a.html5Qrcode)throw"html5Qrcode not defined";Tu.isFileScanType(a.currentScanType)&&(a.setHeaderMessage(xn.loadingImage()),a.html5Qrcode.scanFileV2(l,!0).then(function(o){a.resetHeaderMessage(),a.qrCodeSuccessCallback(o.decodedText,o)}).catch(function(o){a.setHeaderMessage(o,Al.STATUS_WARNING),a.qrCodeErrorCallback(o,dne.createFrom(o))}))};this.fileSelectionUi=qXe.create(s,r,i)},t.prototype.renderCameraSelection=function(s){var r=this,a=this,i=document.getElementById(this.getDashboardSectionCameraScanRegionId());i.style.textAlign="center";var l=KXe.create(i,!1),o=function(j){var w=j.zoomFeature();if(w.isSupported()){l.setOnCameraZoomValueChangeCallback(function(E){w.apply(E)});var S=1;r.config.defaultZoomValueIfSupported&&(S=r.config.defaultZoomValueIfSupported),S=pXe(S,w.min(),w.max()),l.setValues(w.min(),w.max(),S,w.step()),l.show()}},c=GXe.create(i,s),d=document.createElement("span"),u=Bd.createElement("button",Ol.CAMERA_START_BUTTON_ID);u.innerText=xn.scanButtonStartScanningText(),d.appendChild(u);var m=Bd.createElement("button",Ol.CAMERA_STOP_BUTTON_ID);m.innerText=xn.scanButtonStopScanningText(),m.style.display="none",m.disabled=!0,d.appendChild(m);var x,g=function(j){if(!j.torchFeature().isSupported()){x&&x.hide();return}x?x.updateTorchCapability(j.torchFeature()):x=WXe.create(d,j.torchFeature(),{display:"none",marginLeft:"5px"},function(w){a.setHeaderMessage(w,Al.STATUS_WARNING)}),x.show()};i.appendChild(d);var y=function(j){j||(u.style.display="none"),u.innerText=xn.scanButtonStartScanningText(),u.style.opacity="1",u.disabled=!1,j&&(u.style.display="inline-block")};if(u.addEventListener("click",function(j){u.innerText=xn.scanButtonScanningStarting(),c.disable(),u.disabled=!0,u.style.opacity="0.5",r.scanTypeSelector.hasMoreThanOneScanType()&&a.showHideScanTypeSwapLink(!1),a.resetHeaderMessage();var w=c.getValue();a.persistedDataManager.setLastUsedCameraId(w),a.html5Qrcode.start(w,YXe(a.config),a.qrCodeSuccessCallback,a.qrCodeErrorCallback).then(function(S){m.disabled=!1,m.style.display="inline-block",y(!1);var E=a.html5Qrcode.getRunningTrackCameraCapabilities();r.config.showTorchButtonIfSupported===!0&&g(E),r.config.showZoomSliderIfSupported===!0&&o(E)}).catch(function(S){a.showHideScanTypeSwapLink(!0),c.enable(),y(!0),a.setHeaderMessage(S,Al.STATUS_WARNING)})}),c.hasSingleItem()&&u.click(),m.addEventListener("click",function(j){if(!a.html5Qrcode)throw"html5Qrcode not defined";m.disabled=!0,a.html5Qrcode.stop().then(function(w){r.scanTypeSelector.hasMoreThanOneScanType()&&a.showHideScanTypeSwapLink(!0),c.enable(),u.disabled=!1,m.style.display="none",u.style.display="inline-block",x&&(x.reset(),x.hide()),l.removeOnCameraZoomValueChangeCallback(),l.hide(),a.insertCameraScanImageToScanRegion()}).catch(function(w){m.disabled=!1,a.setHeaderMessage(w,Al.STATUS_WARNING)})}),a.persistedDataManager.getLastUsedCameraId()){var v=a.persistedDataManager.getLastUsedCameraId();c.hasValue(v)?(c.setValue(v),u.click()):a.persistedDataManager.resetLastUsedCameraId()}},t.prototype.createSectionSwap=function(){var s=this,r=xn.textIfCameraScanSelected(),a=xn.textIfFileScanSelected(),i=document.getElementById(this.getDashboardSectionId()),l=document.createElement("div");l.style.textAlign="center";var o=Bd.createElement("span",this.getDashboardSectionSwapLinkId());o.style.textDecoration="underline",o.style.cursor="pointer",o.innerText=Tu.isCameraScanType(this.currentScanType)?r:a,o.addEventListener("click",function(){if(!s.sectionSwapAllowed){s.verbose&&s.logger.logError("Section swap called when not allowed");return}s.resetHeaderMessage(),s.fileSelectionUi.resetValue(),s.sectionSwapAllowed=!1,Tu.isCameraScanType(s.currentScanType)?(s.clearScanRegion(),s.getCameraScanRegion().style.display="none",s.fileSelectionUi.show(),o.innerText=a,s.currentScanType=jm.SCAN_TYPE_FILE,s.insertFileScanImageToScanRegion()):(s.clearScanRegion(),s.getCameraScanRegion().style.display="block",s.fileSelectionUi.hide(),o.innerText=r,s.currentScanType=jm.SCAN_TYPE_CAMERA,s.insertCameraScanImageToScanRegion(),s.startCameraScanIfPermissionExistsOnSwap()),s.sectionSwapAllowed=!0}),l.appendChild(o),i.appendChild(l)},t.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var s=this,r=this;if(this.persistedDataManager.hasCameraPermissions()){e$.hasPermissions().then(function(a){if(a){var i=document.getElementById(r.getCameraPermissionButtonId());if(!i)throw s.logger.logError("Permission button not found, fail;"),"Permission button not found";i.click()}else r.persistedDataManager.setHasPermission(!1)}).catch(function(a){r.persistedDataManager.setHasPermission(!1)});return}},t.prototype.resetHeaderMessage=function(){var s=document.getElementById(this.getHeaderMessageContainerId());s.style.display="none"},t.prototype.setHeaderMessage=function(s,r){r||(r=Al.STATUS_DEFAULT);var a=this.getHeaderMessageDiv();switch(a.innerText=s,a.style.display="block",r){case Al.STATUS_SUCCESS:a.style.background="rgba(106, 175, 80, 0.26)",a.style.color="#477735";break;case Al.STATUS_WARNING:a.style.background="rgba(203, 36, 49, 0.14)",a.style.color="#cb2431";break;case Al.STATUS_DEFAULT:default:a.style.background="rgba(0, 0, 0, 0)",a.style.color="rgb(17, 17, 17)";break}},t.prototype.showHideScanTypeSwapLink=function(s){this.scanTypeSelector.hasMoreThanOneScanType()&&(s!==!0&&(s=!1),this.sectionSwapAllowed=s,this.getDashboardSectionSwapLink().style.display=s?"inline-block":"none")},t.prototype.insertCameraScanImageToScanRegion=function(){var s=this,r=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){r.innerHTML="<br>",r.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(a){r.innerHTML="<br>",r.appendChild(s.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=RXe,this.cameraScanImage.alt=xn.cameraScanAltText()},t.prototype.insertFileScanImageToScanRegion=function(){var s=this,r=document.getElementById(this.getScanRegionId());if(this.fileScanImage){r.innerHTML="<br>",r.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(a){r.innerHTML="<br>",r.appendChild(s.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=LXe,this.fileScanImage.alt=xn.fileScanAltText()},t.prototype.clearScanRegion=function(){var s=document.getElementById(this.getScanRegionId());s.innerHTML=""},t.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},t.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},t.prototype.getDashboardSectionSwapLinkId=function(){return Ol.SCAN_TYPE_CHANGE_ANCHOR_ID},t.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},t.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},t.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},t.prototype.getCameraPermissionButtonId=function(){return Ol.CAMERA_PERMISSION_BUTTON_ID},t.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},t.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},t.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},t}();function ZXe(){const[t,s]=p.useState(""),[r,a]=p.useState(!1),[i,l]=p.useState(null),[o,c]=p.useState(""),[d,u]=p.useState(null),[m,x]=p.useState(!1),g=p.useRef(null),y=p.useCallback(async k=>{if(!k){u(null);return}try{const A=await he.get(`/inventory/items/${k.id}/qr`,{responseType:"blob"}),I=URL.createObjectURL(A.data);u(P=>(P&&URL.revokeObjectURL(P),I))}catch(A){console.error(A),u(null),ae.error("Unable to load QR image")}},[]),v=p.useCallback(async k=>{var I,P;const A=(k||"").trim();if(c(""),l(null),u(null),!A){c("Please scan or enter a QR number.");return}try{a(!0);const O=await F_e(A);l(O.data),await y(O.data)}catch(O){const D=((P=(I=O==null?void 0:O.response)==null?void 0:I.data)==null?void 0:P.detail)||(O==null?void 0:O.message)||"No medicine found for this QR";c(D),ae.error(D)}finally{a(!1)}},[y]),j=p.useCallback(async k=>{k.preventDefault(),await v(t)},[t,v]),w=p.useCallback(async k=>{s(k),ae.success(`QR scanned: ${k}`),x(!1),await v(k)},[v]),S=p.useCallback(()=>{},[]);p.useEffect(()=>{if(!m){g.current&&(g.current.clear().catch(()=>{}),g.current=null);return}const k=new QXe("qr-reader",{fps:10,qrbox:250},!1);return g.current=k,k.render(w,S),()=>{g.current&&(g.current.clear().catch(()=>{}),g.current=null)}},[m,w,S]);const E=p.useCallback(async()=>{if(i)try{const A=(await he.get(`/inventory/items/${i.id}/qr`,{responseType:"blob"})).data,I=URL.createObjectURL(A),P=document.createElement("a");P.href=I,P.download=`${i.code||"medicine"}_qr.png`,document.body.appendChild(P),P.click(),P.remove(),URL.revokeObjectURL(I)}catch(k){const A=(k==null?void 0:k.message)||"Unable to download QR image";ae.error(A)}},[i]);return p.useEffect(()=>()=>{d&&URL.revokeObjectURL(d)},[d]),n.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-slate-50 px-4 py-6 lg:px-8",children:n.jsxs("div",{className:"mx-auto flex max-w-5xl flex-col gap-6",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"flex items-center gap-2 text-2xl font-semibold tracking-tight text-slate-900",children:[n.jsx(oC,{className:"h-6 w-6 text-slate-700"}),"Medicine QR Lookup"]}),n.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Scan medicine QR code with camera / scanner or enter QR number to instantly fetch medicine details."})]}),n.jsxs(et,{className:"flex items-center gap-1 rounded-full bg-slate-900 px-3 py-1 text-xs font-medium text-white",children:[n.jsx(yo,{className:"h-3 w-3"}),"Live QR search"]})]}),n.jsxs(dt,{className:"rounded-2xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{children:[n.jsx(jt,{className:"text-base font-semibold text-slate-900",children:"Scan or Enter QR Number"}),n.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Keep the cursor inside the QR box and scan with your scanner or use the camera scanner below."})]}),n.jsx(ge,{type:"button",variant:m?"outline":"default",size:"sm",onClick:()=>x(k=>!k),className:"inline-flex items-center gap-2",children:m?n.jsxs(n.Fragment,{children:[n.jsx(Lde,{className:"h-4 w-4"}),"Stop Camera"]}):n.jsxs(n.Fragment,{children:[n.jsx(rR,{className:"h-4 w-4"}),"Use Camera Scanner"]})})]}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("form",{onSubmit:j,className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx("label",{className:"text-xs font-medium text-slate-600",children:"QR Number"}),n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(oC,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),n.jsx(Ee,{autoFocus:!0,value:t,onChange:k=>s(k.target.value),placeholder:"e.g., MED-000123 or scan with your QR scanner...",className:"pl-9 text-sm"})]}),n.jsx(ge,{type:"submit",className:"w-full sm:w-auto",disabled:r,children:r?n.jsxs("span",{className:"inline-flex items-center gap-2",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"}),"Searching..."]}):n.jsxs("span",{className:"inline-flex items-center gap-2",children:[n.jsx(JXe,{}),"Search"]})})]})]}),n.jsxs("div",{className:"flex items-start gap-2 text-xs text-slate-500",children:[n.jsx(gr,{className:"mt-0.5 h-3 w-3"}),n.jsxs("p",{children:["For USB QR scanners: focus the box and scan. Most scanners type the code and press",n.jsx("span",{className:"mx-1 rounded bg-slate-100 px-1 py-0.5 font-semibold",children:"Enter"}),"automatically."]})]})]}),m&&n.jsxs("div",{className:"mt-3 rounded-2xl border border-dashed border-slate-500 bg-slate-100/60 px-3 py-3",children:[n.jsxs("p",{className:"mb-2 flex items-center gap-2 text-xs text-slate-600",children:[n.jsx(rR,{className:"h-3 w-3"}),"Point your medicine QR code at the camera. Once decoded, the medicine will load automatically."]}),n.jsx("div",{id:"qr-reader",className:"h-[280px] w-full overflow-hidden rounded-xl bg-black/90"})]}),o&&n.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-xs text-red-700",children:[n.jsx(gr,{className:"h-3 w-3"}),o]})]})]}),i&&n.jsxs(dt,{className:"rounded-2xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs(jt,{className:"flex items-center gap-2 text-lg",children:[n.jsx(rr,{className:"h-5 w-5 text-slate-700"}),n.jsx("span",{children:i.name})]}),n.jsxs("p",{className:"text-xs text-slate-500",children:["Code:"," ",n.jsx("span",{className:"font-mono text-slate-700",children:i.code}),i.qr_number&&n.jsxs(n.Fragment,{children:["  ","QR:"," ",n.jsx("span",{className:"font-mono text-slate-700",children:i.qr_number})]})]}),i.generic_name&&n.jsxs("p",{className:"text-xs text-slate-500",children:["Generic: ",i.generic_name]})]}),d&&n.jsxs("div",{className:"flex flex-col items-center gap-2",children:[n.jsx("div",{className:"rounded-xl border border-slate-500 bg-white p-2",children:n.jsx("img",{src:d,alt:`QR for ${i.name}`,className:"h-28 w-28 object-contain"})}),n.jsxs(ge,{type:"button",variant:"outline",size:"sm",className:"text-xs",onClick:E,children:[n.jsx(oC,{className:"mr-1 h-3 w-3"}),"Download QR"]})]})]}),n.jsxs(it,{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[n.jsx(_d,{label:"FORM / STRENGTH",value:`${i.form||"-"}${i.strength?`  ${i.strength}`:""}`}),n.jsx(_d,{label:"PACK",value:`${i.pack_size||"-"} ${i.unit||""}`}),n.jsx(_d,{label:"MANUFACTURER",value:i.manufacturer||"-"}),n.jsx(_d,{label:"THERAPEUTIC CLASS",value:i.class_name||"-"}),n.jsx(_d,{label:"ATC CODE",value:i.atc_code||"-"}),n.jsx(_d,{label:"HSN CODE",value:i.hsn_code||"-"}),n.jsx(_d,{label:"MRP / PRICE",value:`${i.default_mrp||0} MRP  ${i.default_price||0} Price`}),n.jsx(_d,{label:"TAX %",value:`${i.default_tax_percent||0}%`}),n.jsx(_d,{label:"REORDER / MAX LEVEL",value:`${i.reorder_level||0} / ${i.max_level||0}`})]})]})]})})}function _d({label:t,value:s}){return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white px-3 py-2.5",children:[n.jsx("p",{className:"text-[11px] font-medium uppercase tracking-wide text-slate-500",children:t}),n.jsx("p",{className:"mt-1 truncate text-sm text-slate-800",title:s,children:s||"-"})]})}function JXe(){return n.jsx(yo,{className:"h-4 w-4"})}function eQe(){const[t,s]=p.useState(""),[r,a]=p.useState(!1),[i,l]=p.useState(null),[o,c]=p.useState(""),[d,u]=p.useState(!1),[m,x]=p.useState(!1);p.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]);const g=async()=>{const S=t.trim();if(!S){ae.error("Please enter or scan a barcode number");return}a(!0),x(!0),l(null),c("");try{const k=(await B_e(S)).data;if(!k){l(null);return}l(k),await y(k.id)}catch(E){console.error("Failed to lookup item by barcode",E),l(null)}finally{a(!1)}},y=async S=>{u(!0);try{const E=await p8(S),k=URL.createObjectURL(E.data);c(k)}catch(E){console.error("Failed to fetch barcode image",E)}finally{u(!1)}},v=S=>{S.key==="Enter"&&(S.preventDefault(),g())},j=async()=>{if(i)try{const S=await p8(i.id),E=new Blob([S.data],{type:"image/png"}),k=URL.createObjectURL(E),A=document.createElement("a");A.href=k,A.download=`${i.code||"medicine"}_barcode.png`,document.body.appendChild(A),A.click(),A.remove(),URL.revokeObjectURL(k)}catch(S){console.error("Failed to download barcode image",S)}},w=!r&&m&&!i;return n.jsx("div",{className:"min-h-[calc(100vh-4rem)] bg-slate-50 px-3 py-3 sm:px-4 sm:py-4 md:px-6 md:py-6",children:n.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 md:space-y-5 lg:space-y-6",children:[n.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-teal-700 via-teal-600 to-blue-600 text-white shadow-md",children:[n.jsx("div",{className:"absolute inset-0 opacity-25 pointer-events-none bg-[radial-gradient(circle_at_top,_#e0f2fe,_transparent_55%)]"}),n.jsxs("div",{className:"relative px-4 py-5 sm:px-6 sm:py-6 md:px-8 md:py-7 lg:px-10 lg:py-8 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{className:"space-y-3 max-w-xl",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-medium backdrop-blur-sm border border-white/20",children:[n.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/20 text-[11px]",children:n.jsx(c1,{className:"w-3.5 h-3.5"})}),"Scan & verify pharmacy items instantly"]}),n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"inline-flex h-11 w-11 md:h-12 md:w-12 items-center justify-center rounded-3xl bg-white/10 text-white shadow-sm border border-white/20",children:n.jsx(c1,{className:"w-6 h-6"})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-semibold tracking-tight",children:"Medicine Barcode Lookup"}),n.jsxs("p",{className:"text-sm md:text-base text-teal-50/90 leading-relaxed",children:["Point your barcode / QR scanner at any"," ",n.jsx("span",{className:"font-semibold",children:"pharmacy item"})," and instantly fetch the mapped medicine, pricing and stock configuration from"," ",n.jsx("span",{className:"font-semibold",children:"Nutryah HIMS"}),"."]})]})]})]}),n.jsxs("div",{className:"w-full md:w-auto space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap gap-2 justify-start md:justify-end",children:[n.jsx(et,{className:"bg-white/15 text-xs font-semibold border border-white/25 text-white rounded-full px-3 py-1",children:"Pharmacy Inventory"}),n.jsx(et,{className:"bg-white/10 text-xs border border-white/20 text-teal-50 rounded-full px-3 py-1",children:"Scan-ready"})]}),n.jsxs("div",{className:"rounded-2xl bg-white/10 px-3 py-2.5 border border-white/15 text-xs text-teal-50/90",children:[n.jsx("span",{className:"font-semibold",children:"Tip:"})," Keep the cursor inside the barcode box. Most hardware scanners type the code and press"," ",n.jsx("span",{className:"inline-flex items-center rounded-md border border-white/40 bg-white/10 px-1.5 py-0.5 text-[11px] font-semibold",children:"Enter"})," ","automatically."]})]})]})]}),n.jsxs(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsx(jt,{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between text-slate-900",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(c1,{className:"w-4 h-4"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold",children:"Scan or enter barcode / QR number"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Works with both hardware scanners and manual entry."})]})]})})}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"relative flex items-center",children:[n.jsx("div",{className:"pointer-events-none absolute left-3 flex items-center text-slate-400",children:n.jsx(c1,{className:"w-4 h-4"})}),n.jsx(Ee,{value:t,onChange:S=>s(S.target.value),onKeyDown:v,placeholder:"Scan or type the barcode / QR number (e.g. MD_1001)",className:"w-full rounded-2xl border border-slate-500 bg-slate-50 pl-9 pr-3 py-2 text-sm text-slate-800 shadow-none focus-visible:ring-2 focus-visible:ring-teal-100 focus-visible:border-teal-500",autoFocus:!0})]})}),n.jsxs(ge,{onClick:g,className:"shrink-0 rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white hover:bg-blue-700 active:scale-95 flex items-center gap-2",disabled:r,children:[n.jsx(Yt,{className:"w-4 h-4"}),r?"Searching":"Search"]})]}),n.jsxs("p",{className:"text-xs md:text-sm text-slate-500 flex items-center gap-1.5",children:[n.jsx(Vs,{className:"w-3.5 h-3.5"}),"If your scanner is configured as a keyboard wedge, just keep the focus here and scan. No extra clicks needed."]})]})]}),r&&n.jsx(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm",children:n.jsxs(it,{className:"p-4 md:p-6 space-y-4",children:[n.jsx(Qe,{className:"h-6 w-2/3 rounded-xl"}),n.jsx(Qe,{className:"h-4 w-1/3 rounded-xl"}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[n.jsx(Qe,{className:"h-20 rounded-2xl"}),n.jsx(Qe,{className:"h-20 rounded-2xl"}),n.jsx(Qe,{className:"h-20 rounded-2xl"})]})]})}),w&&n.jsx(dt,{className:"rounded-3xl border-dashed border-slate-300 bg-white shadow-none",children:n.jsxs(it,{className:"p-6 flex flex-col items-center justify-center text-center gap-3",children:[n.jsx("div",{className:"h-12 w-12 rounded-full bg-slate-100 flex items-center justify-center border border-slate-500",children:n.jsx(Vs,{className:"w-6 h-6 text-slate-600"})}),n.jsx("h2",{className:"text-sm md:text-base font-semibold text-slate-900",children:"No item found for this barcode"}),n.jsxs("p",{className:"text-xs md:text-sm text-slate-600 max-w-md",children:["Check if the code is correct or try scanning again. If this is a new medicine, map the barcode in"," ",n.jsx("span",{className:"font-semibold text-slate-900",children:"Pharmacy Inventory > Items"}),"."]})]})}),!r&&i&&n.jsx(dt,{className:"rounded-3xl border-slate-500 bg-white shadow-sm overflow-hidden",children:n.jsxs(it,{className:"p-4 md:p-6 space-y-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:gap-8",children:[n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-slate-100",children:n.jsx(rr,{className:"w-4 h-4 text-slate-600"})}),n.jsx("h2",{className:"text-xl md:text-2xl font-semibold text-slate-900",children:i.name}),i.is_active===!1&&n.jsx(et,{variant:"outline",className:"border-amber-300 text-amber-800 bg-amber-50 text-xs rounded-full",children:"Inactive"})]}),n.jsxs("div",{className:"text-sm text-slate-600 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{children:[n.jsx("span",{className:"font-medium text-slate-700",children:"Code:"})," ",i.code||""]}),n.jsx("span",{className:"text-slate-300",children:""}),n.jsxs("span",{children:[n.jsx("span",{className:"font-medium text-slate-700",children:"Barcode / QR:"})," ",i.qr_number||""]})]}),i.generic_name&&n.jsxs("p",{className:"text-sm text-slate-600",children:[n.jsx("span",{className:"font-medium text-slate-700",children:"Generic:"})," ",i.generic_name]})]}),n.jsxs("div",{className:"w-full md:w-64 lg:w-72 flex flex-col items-center gap-3",children:[n.jsxs("div",{className:"w-full h-32 md:h-36 rounded-2xl border border-dashed border-slate-500 bg-slate-50 flex items-center justify-center",children:[d&&n.jsx(Qe,{className:"w-40 h-20 rounded-md"}),!d&&o&&n.jsx("img",{src:o,alt:`Barcode for ${i.name}`,className:"max-h-full max-w-full object-contain"}),!d&&!o&&n.jsx("span",{className:"text-xs text-slate-400",children:"No barcode image"})]}),n.jsxs(ge,{type:"button",variant:"outline",className:"w-full rounded-full text-sm font-semibold border-slate-500",onClick:j,children:[n.jsx(nn,{className:"w-4 h-4 mr-2"}),"Download barcode"]})]})]}),n.jsxs("div",{className:"grid gap-3 md:grid-cols-3 lg:grid-cols-4 mt-3",children:[n.jsx(Pu,{label:"Form / Strength",icon:n.jsx(rr,{className:"w-4 h-4"}),value:`${i.form||"-"}${i.strength?`  ${i.strength}`:""}`}),n.jsx(Pu,{label:"Pack",icon:n.jsx(l2,{className:"w-4 h-4"}),value:`${i.pack_size||1} ${i.unit||"unit"}`}),n.jsx(Pu,{label:"Manufacturer",icon:n.jsx(ih,{className:"w-4 h-4"}),value:i.manufacturer||""}),n.jsx(Pu,{label:"Therapeutic class",icon:n.jsx(ih,{className:"w-4 h-4"}),value:i.class_name||""}),n.jsx(Pu,{label:"ATC code",icon:n.jsx(ih,{className:"w-4 h-4"}),value:i.atc_code||""}),n.jsx(Pu,{label:"HSN code",icon:n.jsx(ih,{className:"w-4 h-4"}),value:i.hsn_code||""}),n.jsx(Pu,{label:"MRP / Price",icon:n.jsx(Qi,{className:"w-4 h-4"}),value:`${Number(i.default_mrp||0).toFixed(2)} MRP  ${Number(i.default_price||0).toFixed(2)} Price`}),n.jsx(Pu,{label:"Reorder / Max level",icon:n.jsx(Vs,{className:"w-4 h-4"}),value:`${Number(i.reorder_level||0).toFixed(2)} / ${Number(i.max_level||0).toFixed(2)}`})]})]})})]})})}function Pu({label:t,icon:s,value:r}){return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white px-4 py-3 flex flex-col gap-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-slate-500 uppercase tracking-wide",children:[n.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-100 text-slate-600",children:s}),t]}),n.jsx("div",{className:"text-sm text-slate-800 truncate",title:r?String(r):"",children:r||""})]})}function tQe(t={}){return he.get("/pharmacy/rx",{params:t})}function fne(t){return he.get(`/pharmacy/prescriptions/${t}`)}function sQe(t){return he.post("/pharmacy/prescriptions",t)}function nQe(t,s){return he.post(`/pharmacy/prescriptions/${t}/dispense`,s)}function rQe(t={}){return he.get("/pharmacy/rx-queue",{params:t})}async function u5(t){const s=await he.get(`/pharmacy/prescriptions/${t}/pdf`,{responseType:"blob"}),r=new Blob([s.data],{type:"application/pdf"}),a=window.URL.createObjectURL(r);window.open(a,"_blank","noopener,noreferrer")}function KA(){const t=new Date,s=t.getTimezoneOffset();return new Date(t.getTime()-s*60*1e3).toISOString().slice(0,16)}function m5(t){if(!t)return"";try{return String(t).replace("T"," ").slice(0,16)}catch{return""}}function ep(t){return(t??"").toString()}function h5(t,s=300){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}function s$(t,s){p.useEffect(()=>{const r=a=>{const i=t==null?void 0:t.current;i&&(i.contains(a.target)||s==null||s(a))};return document.addEventListener("mousedown",r),document.addEventListener("touchstart",r),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r)}},[t,s])}function gne(t){return ep(t).trim().toUpperCase()}function Vr(t,s,r=""){for(const a of s){const i=t==null?void 0:t[a];if(i!=null&&String(i).trim()!=="")return i}return r}function aQe(t){const s=gne(t),r={OD:1,QD:1,ONCE:1,BD:2,BID:2,TID:3,TDS:3,QID:4,QHS:1,HS:1};if(r[s])return r[s];if(s.includes("-"))return s.split("-").map(o=>Number(o||0)).reduce((o,c)=>o+(Number.isFinite(c)?c:0),0)||0;const a=s.match(/^Q(\d{1,2})H$/);if(a){const i=Number(a[1]);if(i>0)return Math.floor(24/i)}return 0}function Rc({frequency:t,duration_days:s}){const r=Number(s||0),a=aQe(t);return!r||!a?"":String(a*r)}function Mv(t){if(!t)return"";const s=`${t.first_name||""} ${t.last_name||""}`.trim()||t.name||"",r=t.uhid?`UHID: ${t.uhid}`:"",a=t.phone?`Ph: ${t.phone}`:"";return[s,r,a].filter(Boolean).join("  ")}function bne(t){return t&&(`${t.first_name||""} ${t.last_name||""}`.trim()||t.name||`Patient #${t.id||""}`)||""}function n$(t){if(!t)return"";const s=Vr(t,["age","age_years"],"")||(t.dob,""),r=Vr(t,["gender","sex"],"");return[s?`${s}y`:"",r].filter(Boolean).join("  ")}function r$(t){const s=Vr(t,["item_name","medicine_name","name"],""),r=Vr(t,["strength","item_strength"],""),a=Vr(t,["dose","dosage","dose_text"],""),i=Vr(t,["frequency","freq","dosage_frequency","frequency_text","freq_code"],""),l=Vr(t,["duration_days","days","duration","duration_day"],""),o=Vr(t,["route","route_code","administration_route"],""),c=Vr(t,["instructions","sig","remarks","instruction"],""),d=Vr(t,["total_qty","requested_qty","qty","quantity"],"");return{itemName:s,strength:r,dose:a,frequency:i,duration_days:l,route:o,instructions:c,qty:d}}const x5=[{value:"OPD",label:"OPD"},{value:"IPD",label:"IPD"},{value:"OT",label:"OT"},{value:"COUNTER",label:"Counter"}],iQe=[{value:"ROUTINE",label:"Routine"},{value:"STAT",label:"STAT / Urgent"},{value:"PRN",label:"PRN / As needed"}],lQe=[{label:"OD",value:"OD"},{label:"BD",value:"BD"},{label:"TID",value:"TID"},{label:"QID",value:"QID"},{label:"1-0-1",value:"1-0-1"},{label:"1-1-1",value:"1-1-1"},{label:"0-0-1",value:"0-0-1"},{label:"0-1-0",value:"0-1-0"}],oQe=["PO","IV","IM","SC","PR","INH","TOP"],p5={type:"OPD",priority:"ROUTINE",datetime:KA(),patient:null,doctorId:"",visitNo:"",admissionNo:"",otCaseNo:"",notes:""},Iv={item:null,item_name:"",strength:"",route:"PO",dose:"",frequency:"",duration_days:"",total_qty:"",instructions:"",is_prn:!1,is_stat:!1,requested_qty:"",_qtyTouched:!1};function Gm({className:t="",children:s}){return n.jsx(dt,{className:["rounded-3xl border border-slate-500/70","bg-white/70 backdrop-blur-xl","shadow-[0_12px_30px_rgba(0,0,0,0.06)]","ring-1 ring-black/[0.03]",t].join(" "),children:s})}function cQe({value:t}){return n.jsxs(Wl,{className:"w-full sm:w-auto rounded-full bg-white/70 backdrop-blur border border-slate-500 p-1 shadow-sm",children:[n.jsx(zs,{value:"list",className:"rounded-full px-4 data-[state=active]:bg-slate-900 data-[state=active]:text-white",children:"Queue"}),n.jsx(zs,{value:"new",className:"rounded-full px-4 data-[state=active]:bg-slate-900 data-[state=active]:text-white",children:"New"}),n.jsx(zs,{value:"detail",className:"rounded-full px-4 data-[state=active]:bg-slate-900 data-[state=active]:text-white",children:"Selected"})]})}function f5({status:t}){const s=(t||"").toUpperCase();let r=s||"PENDING",a="bg-white/70 text-slate-700 border border-slate-500";return s==="PENDING"||s==="NEW"?(r="Pending",a="bg-amber-50/80 text-amber-700 border border-amber-200"):s==="PARTIAL"?(r="Partial",a="bg-blue-50/80 text-blue-700 border border-blue-200"):s==="DISPENSED"||s==="COMPLETED"?(r="Dispensed",a="bg-emerald-50/80 text-emerald-700 border border-emerald-200"):s==="CANCELLED"&&(r="Cancelled",a="bg-rose-50/80 text-rose-700 border border-rose-200"),n.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 text-[11px] rounded-full ${a}`,children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-current opacity-60"}),r]})}function a$({patient:t,loading:s}){const r=bne(t),a=Vr(t,["uhid","patient_uhid"],""),i=Vr(t,["phone","mobile","contact"],""),l=Vr(t,["gender","sex"],""),o=Vr(t,["age","age_years"],""),c=Vr(t,["dob","date_of_birth"],""),d=Vr(t,["blood_group","bloodGroup"],""),u=Vr(t,["address","current_address","full_address"],""),m=Vr(t,["city"],""),x=Vr(t,["state"],""),g=Vr(t,["pincode","pin"],""),y=[u,m,x,g].filter(Boolean).join(", ");return n.jsx("div",{className:"rounded-3xl border border-slate-500 bg-white/70 backdrop-blur p-4 shadow-sm",children:n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center",children:n.jsx(or,{className:"w-5 h-5 text-slate-600"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:s?"Loading patient...":r}),n.jsx("div",{className:"text-xs text-slate-500 truncate",children:s?"":[o?`${o}y`:"",l].filter(Boolean).join("  ")||""})]})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[n.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[n.jsx(Wue,{className:"w-4 h-4 text-slate-400"}),n.jsx("span",{className:"font-medium text-slate-700",children:"UHID:"})," ",a]}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[n.jsx(ad,{className:"w-4 h-4 text-slate-400"}),n.jsx("span",{className:"font-medium text-slate-700",children:"Phone:"})," ",i]}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[n.jsx(yg,{className:"w-4 h-4 text-slate-400"}),n.jsx("span",{className:"font-medium text-slate-700",children:"DOB:"})," ",c||""]}),n.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[n.jsx(ny,{className:"w-4 h-4 text-slate-400"}),n.jsx("span",{className:"font-medium text-slate-700",children:"Blood:"})," ",d||""]})]}),y?n.jsxs("div",{className:"mt-3 flex items-start gap-2 text-xs text-slate-600",children:[n.jsx(sb,{className:"w-4 h-4 text-slate-400 mt-0.5"}),n.jsxs("div",{className:"leading-relaxed",children:[n.jsx("span",{className:"font-medium text-slate-700",children:"Address:"})," ",y]})]}):null]}),n.jsx(et,{variant:"outline",className:"rounded-full text-[11px] border-slate-500",children:"Patient"})]})})}function dQe(){const[t,s]=p.useState("list"),[r,a]=p.useState("ALL"),[i,l]=p.useState("ALL"),[o,c]=p.useState(""),d=h5(o,350),[u,m]=p.useState(!1),[x,g]=p.useState([]),[y,v]=p.useState(null),[j,w]=p.useState(!0),[S,E]=p.useState("OPD"),[k,A]=p.useState(p5),[I,P]=p.useState([]),[O,D]=p.useState(Iv),[T,B]=p.useState(!1),[U,W]=p.useState(""),V=h5(U,250),[R,F]=p.useState([]),[G,H]=p.useState(!1),[$,K]=p.useState(!1),[le,se]=p.useState(!1),[J,ie]=p.useState(null),[te,ne]=p.useState(!1),[q,ee]=p.useState([]),[X,Z]=p.useState(!1),[Y,Q]=p.useState(""),oe=h5(Y,220),[_e,xe]=p.useState([]),[me,Re]=p.useState(!1),[Ze,$e]=p.useState(!1),fe=p.useRef(null),Me=p.useRef(null),Ae=p.useRef(null),Ke=p.useRef(null),Le=p.useRef(new Map);s$(fe,()=>K(!1)),s$(Me,()=>$e(!1));async function He(ce,{silent:Ce=!1}={}){if(!ce)return null;const ze=String(ce);if(Le.current.has(ze))return Le.current.get(ze);try{Ce||se(!0);const Te=await Gse(ce),Nt=(Te==null?void 0:Te.data)||null;return Nt&&Le.current.set(ze,Nt),Nt}catch{return null}finally{Ce||se(!1)}}p.useEffect(()=>{(async()=>{var ce;try{Z(!0);const Ce=await jP(),ze=((ce=Ce==null?void 0:Ce.data)==null?void 0:ce.doctors)||[];ee(ze);const Te=localStorage.getItem("pharmacy.lastDoctorId");Te&&A(Nt=>({...Nt,doctorId:Nt.doctorId||Te}))}catch{}finally{Z(!1)}})()},[]),p.useEffect(()=>{pt()},[r,i,d]),p.useEffect(()=>{if(t!=="list"||!j)return;const ce=setInterval(()=>{pt(!0)},2e4);return()=>clearInterval(ce)},[t,j,r,i,d]);async function pt(ce=!1){try{ce||m(!0);const Ce={};r!=="ALL"&&(Ce.type=r),i!=="ALL"&&(Ce.status=i),d!=null&&d.trim()&&(Ce.q=d.trim()),Ce.limit=100;const ze=await tQe(Ce);g((ze==null?void 0:ze.data)||[])}catch{}finally{ce||m(!1)}}p.useEffect(()=>{const ce=V==null?void 0:V.trim();if(!ce||ce.length<2){F([]);return}let Ce=!1;return(async()=>{var ze;try{H(!0);let Te;try{Te=await Cw(ce)}catch{Te=await Cw({q:ce})}if(Ce)return;F(((ze=Te==null?void 0:Te.data)==null?void 0:ze.items)||(Te==null?void 0:Te.data)||[]),K(!0)}catch{}finally{Ce||H(!1)}})(),()=>{Ce=!0}},[V]);async function Pe(ce){A(ze=>({...ze,patient:ce})),W(Mv(ce)),K(!1);const Ce=await He(ce==null?void 0:ce.id,{silent:!1});Ce&&(A(ze=>({...ze,patient:Ce})),W(Mv(Ce)))}function bt(){A(ce=>({...ce,patient:null})),W(""),F([]),K(!1)}p.useEffect(()=>{const ce=oe==null?void 0:oe.trim();if(!ce||ce.length<2){xe([]);return}let Ce=!1;return(async()=>{var ze;try{Re(!0);const Te=await Df({q:ce,kind:"MEDICINE",limit:15});if(Ce)return;const Nt=((ze=Te==null?void 0:Te.data)==null?void 0:ze.items)||(Te==null?void 0:Te.data)||[];xe(Nt),$e(!0)}catch{}finally{Ce||Re(!1)}})(),()=>{Ce=!0}},[oe]);function It(ce){D(Ce=>{const ze={...Ce,item:ce,item_name:ce.name||ce.item_name||Ce.item_name||"",strength:Ce.strength||ce.strength||ce.form||"",route:Ce.route||ce.route||"PO"};if(!ze._qtyTouched){const Te=Rc(ze);Te&&(ze.total_qty=Te)}return ze}),Q(ce.name||ce.item_name||""),$e(!1)}function De(ce=!0){A(Ce=>({...p5,type:ce?Ce.type:"OPD",datetime:KA(),doctorId:Ce.doctorId||""})),P([]),D(Iv),W(""),F([]),Q(""),xe([]),K(!1),$e(!1)}function tt(ce){const Ce=ce||S||"OPD";A(ze=>({...p5,type:Ce,datetime:KA(),doctorId:ze.doctorId||localStorage.getItem("pharmacy.lastDoctorId")||""})),P([]),D(Iv),W(""),v(null),ie(null),s("new"),setTimeout(()=>{var ze,Te;(Te=(ze=Ae.current)==null?void 0:ze.focus)==null||Te.call(ze)},50)}function ve(){return Rc(O)}function Ge(){var Jt,ke;const ce=((Jt=O.item)==null?void 0:Jt.name)||O.item_name;if(!O.item&&!ce){ae.error("Select a medicine first");return}const Ce=ep(O.total_qty||ve()).trim(),ze=Ce?Number(Ce):0;if(!ze||!Number.isFinite(ze)||ze<=0){ae.error("Enter a valid Total Qty (or set Frequency + Days)");return}const Te={...O,total_qty:String(ze),requested_qty:O.requested_qty||String(ze)},Nt=((ke=Te.item)==null?void 0:ke.id)||Te.item_id;if(Nt){const je=I.findIndex(ht=>{var At;return(((At=ht.item)==null?void 0:At.id)||ht.item_id)===Nt});if(je>=0){const ht=I[je],At=Number(ht.total_qty||ht.requested_qty||0)||0,ms=At+ze,Zt={...ht,...Te,total_qty:String(ms),requested_qty:String(ms)};P(hs=>hs.map((Is,_s)=>_s===je?Zt:Is)),ae.success(`Merged duplicate: ${ce} (Qty ${At}  ${ms})`)}else P(ht=>[...ht,Te])}else P(je=>[...je,Te]);D(Iv),Q(""),$e(!1),setTimeout(()=>{var je,ht;return(ht=(je=Ae.current)==null?void 0:je.focus)==null?void 0:ht.call(je)},50)}function We(ce){P(Ce=>Ce.filter((ze,Te)=>Te!==ce))}async function Ve(){var ze;const ce=k.type==="COUNTER";if(!ce&&!k.patient){ae.error("Select a patient");return}if(!ce&&!k.doctorId){ae.error("Select a doctor");return}if(!I.length){ae.error("Add at least one medicine");return}const Ce={type:k.type,priority:k.priority,rx_datetime:k.datetime,patient_id:((ze=k.patient)==null?void 0:ze.id)||null,doctor_user_id:ce?null:k.doctorId||null,visit_id:k.type==="OPD"&&k.visitNo||null,ipd_admission_id:k.type==="IPD"&&k.admissionNo||null,ot_case_id:k.type==="OT"&&k.otCaseNo||null,notes:k.notes||"",lines:I.map(Te=>{var ke,je;const Nt=ep(Te.total_qty||Te.requested_qty||Rc(Te)).trim(),Jt=Nt?Number(Nt):null;return{item_id:((ke=Te.item)==null?void 0:ke.id)||Te.item_id||null,item_name:((je=Te.item)==null?void 0:je.name)||Te.item_name||"",strength:Te.strength||null,route:Te.route||null,dose:Te.dose||null,frequency:Te.frequency||null,duration_days:Te.duration_days?Number(Te.duration_days):null,requested_qty:Jt,total_qty:Jt,instructions:Te.instructions||null,is_prn:!!Te.is_prn,is_stat:!!Te.is_stat}})};try{B(!0),k.doctorId&&localStorage.setItem("pharmacy.lastDoctorId",k.doctorId);const Te=await sQe(Ce);ae.success("Prescription created & sent to Pharmacy"),De(!0),s("list"),pt(),Te!=null&&Te.data&&v(Te.data)}catch{}finally{B(!1)}}async function Fe(ce){try{const Ce=await fne(ce.id),ze=(Ce==null?void 0:Ce.data)||ce;v(ze),s("detail")}catch{}}p.useEffect(()=>{let ce=!1;return(async()=>{if(!y){ie(null);return}const Ce=y.patient,ze=y.patient_id||y.patientId||(Ce==null?void 0:Ce.id)||null;if(Ce&&(Ce.uhid||Ce.phone||Ce.gender||Ce.age)){ie(Ce);return}if(!ze){ie(Ce||null);return}try{ne(!0);const Te=await He(ze,{silent:!0});if(ce)return;ie(Te||Ce||null)}finally{ce||ne(!1)}})(),()=>{ce=!0}},[y]);const ot=p.useMemo(()=>y?y.lines||y.items||[]:[],[y]),ft=p.useMemo(()=>{const ce=x.length,Ce=x.filter(Nt=>["PENDING","NEW"].includes(ep(Nt.status).toUpperCase())).length,ze=x.filter(Nt=>ep(Nt.status).toUpperCase()==="PARTIAL").length,Te=x.filter(Nt=>["DISPENSED","COMPLETED"].includes(ep(Nt.status).toUpperCase())).length;return{total:ce,pending:Ce,partial:ze,disp:Te}},[x]);return p.useEffect(()=>{const ce=Ce=>{(Ce.ctrlKey||Ce.metaKey)&&Ce.key.toLowerCase()==="k"&&(Ce.preventDefault(),s("list"),setTimeout(()=>{var ze,Te;return(Te=(ze=Ke.current)==null?void 0:ze.focus)==null?void 0:Te.call(ze)},50)),(Ce.ctrlKey||Ce.metaKey)&&Ce.key.toLowerCase()==="n"&&(Ce.preventDefault(),tt(S)),Ce.key==="Escape"&&(K(!1),$e(!1))};return window.addEventListener("keydown",ce),()=>window.removeEventListener("keydown",ce)},[S]),n.jsxs("div",{className:"relative w-full",children:[n.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-50 via-white to-slate-50"}),n.jsx("div",{className:"absolute -top-24 left-1/2 h-72 w-[720px] -translate-x-1/2 rounded-full bg-slate-200/40 blur-3xl"}),n.jsx("div",{className:"absolute top-36 right-10 h-52 w-52 rounded-full bg-slate-100 blur-2xl"})]}),n.jsx("div",{className:"relative p-3 sm:p-4 md:p-6",children:n.jsx("div",{className:"mx-auto w-full max-w-[1440px] space-y-4",children:n.jsx(Gm,{className:"overflow-hidden",children:n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white via-white to-slate-50"}),n.jsxs("div",{className:"relative p-4 sm:p-5",children:[n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-start lg:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-slate-900 tracking-tight",children:"Pharmacy Rx"}),n.jsxs("div",{className:"text-sm text-slate-500 flex flex-wrap items-center gap-2 mt-1",children:[n.jsx("span",{children:"Fast queue + quick Rx entry for daily pharmacy ops."}),n.jsxs("span",{className:"text-[11px] text-slate-400",children:["Tips: ",n.jsx("span",{className:"font-medium",children:"Ctrl+K"})," search "," ",n.jsx("span",{className:"font-medium",children:"Ctrl+N"})," new Rx"]})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white/70 backdrop-blur px-3 py-2",children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Total"}),n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:ft.total})]}),n.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50/60 backdrop-blur px-3 py-2",children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-amber-700",children:"Pending"}),n.jsx("div",{className:"text-sm font-semibold text-amber-900",children:ft.pending})]}),n.jsxs("div",{className:"rounded-2xl border border-blue-200 bg-blue-50/60 backdrop-blur px-3 py-2",children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-blue-700",children:"Partial"}),n.jsx("div",{className:"text-sm font-semibold text-blue-900",children:ft.partial})]}),n.jsxs("div",{className:"rounded-2xl border border-emerald-200 bg-emerald-50/60 backdrop-blur px-3 py-2",children:[n.jsx("div",{className:"text-[10px] uppercase tracking-wide text-emerald-700",children:"Done"}),n.jsx("div",{className:"text-sm font-semibold text-emerald-900",children:ft.disp})]})]})]}),n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end",children:[n.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-slate-500 bg-white/70 backdrop-blur px-3 py-2 shadow-sm",children:[n.jsx($n,{className:"w-4 h-4 text-slate-500"}),n.jsx("span",{className:"text-xs text-slate-600",children:"Queue"}),n.jsx(et,{variant:"outline",className:"text-[11px]",children:ft.total}),n.jsx("span",{className:"text-[11px] text-slate-400",children:""}),n.jsxs("span",{className:"text-[11px] text-amber-700",children:["Pending ",ft.pending]}),n.jsx("span",{className:"text-[11px] text-slate-400",children:""}),n.jsxs("span",{className:"text-[11px] text-blue-700",children:["Partial ",ft.partial]}),n.jsx("span",{className:"text-[11px] text-slate-400",children:""}),n.jsxs("span",{className:"text-[11px] text-emerald-700",children:["Done ",ft.disp]})]}),n.jsxs(Zs,{value:S,onValueChange:E,children:[n.jsx(Ws,{className:"w-full sm:w-[170px] bg-white/70 backdrop-blur border-slate-500 rounded-full",children:n.jsx(Js,{placeholder:"New Rx Type"})}),n.jsx(qs,{children:x5.map(ce=>n.jsx(Ut,{value:ce.value,children:ce.label},ce.value))})]}),n.jsxs(ge,{className:"rounded-full shadow-sm",onClick:()=>tt(S),children:[n.jsx(ds,{className:"w-4 h-4 mr-2"}),"New Prescription"]})]})]}),n.jsx("div",{className:"mt-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:n.jsxs(Do,{value:t,onValueChange:s,className:"w-full",children:[n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsx(cQe,{value:t}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{type:"button",onClick:()=>w(ce=>!ce),className:["px-3 py-2 rounded-full text-xs border backdrop-blur shadow-sm",j?"bg-emerald-50/70 text-emerald-700 border-emerald-200":"bg-white/70 text-slate-700 border-slate-500"].join(" "),title:"Auto-refresh queue",children:[n.jsx(Xt,{className:"w-3 h-3 inline mr-1"}),"Auto refresh"]}),n.jsxs(ge,{variant:"outline",size:"sm",className:"h-9 rounded-full border-slate-500 bg-white/70 backdrop-blur",onClick:()=>pt(),children:[n.jsx(cl,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})]}),n.jsx(Ls,{value:"list",className:"mt-4 space-y-3",children:n.jsxs(Gm,{children:[n.jsx(gt,{className:"pb-3",children:n.jsx("div",{className:"flex flex-col gap-3",children:n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsx("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Type"}),n.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[n.jsx("button",{type:"button",onClick:()=>a("ALL"),className:["px-3 py-1.5 rounded-full text-xs border transition shadow-sm backdrop-blur",r==="ALL"?"bg-slate-900 text-white border-slate-900":"bg-white/70 text-slate-700 border-slate-500"].join(" "),children:"All"}),x5.map(ce=>n.jsxs("button",{type:"button",onClick:()=>a(ce.value),className:["px-3 py-1.5 rounded-full text-xs border flex items-center gap-1.5 transition shadow-sm backdrop-blur",r===ce.value?"bg-slate-900 text-white border-slate-900":"bg-white/70 text-slate-700 border-slate-500"].join(" "),children:[n.jsx(rr,{className:"w-3 h-3"}),ce.label]},ce.value))]})]}),n.jsxs("div",{className:"flex items-center gap-2 w-full lg:w-auto",children:[n.jsxs("div",{className:"relative flex-1 lg:w-[420px]",children:[n.jsx(Yt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3"}),n.jsx(Ee,{ref:Ke,value:o,onChange:ce=>c(ce.target.value),placeholder:"Search UHID / name / Rx no...",className:"pl-9 h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsxs(Zs,{value:i,onValueChange:l,children:[n.jsx(Ws,{className:"w-[150px] bg-white/70 backdrop-blur border-slate-500 rounded-full text-xs h-10",children:n.jsx(Js,{placeholder:"Status"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"ALL",children:"All status"}),n.jsx(Ut,{value:"DRAFT",children:"Draft"}),n.jsx(Ut,{value:"PENDING",children:"Pending"}),n.jsx(Ut,{value:"PARTIAL",children:"Partial"}),n.jsx(Ut,{value:"DISPENSED",children:"Dispensed"}),n.jsx(Ut,{value:"CANCELLED",children:"Cancelled"})]})]}),n.jsx(ge,{variant:"outline",size:"icon",className:"rounded-full border-slate-500 bg-white/70 backdrop-blur h-10 w-10",onClick:()=>pt(),title:"Apply filters",children:n.jsx(jr,{className:"w-4 h-4"})})]})]})})}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"hidden md:block border border-slate-100 rounded-2xl overflow-hidden bg-white/60 backdrop-blur",children:n.jsx("div",{className:"max-h-[560px] overflow-auto",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full min-w-[980px] text-sm",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10 backdrop-blur",children:n.jsxs("tr",{className:"text-xs text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Rx No"}),n.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Patient"}),n.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Type / Doctor"}),n.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Created"}),n.jsx("th",{className:"text-left px-3 py-3 font-medium",children:"Status"}),n.jsx("th",{className:"text-right px-3 py-3 font-medium",children:"Actions"})]})}),n.jsxs("tbody",{children:[u&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-10 text-center text-xs text-slate-500",children:"Loading prescriptions..."})}),!u&&!x.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-12 text-center text-xs text-slate-500",children:"No prescriptions found for the selected filters."})}),!u&&x.map(ce=>{var ke,je,ht;const Ce=(ce.status||"").toUpperCase()||"PENDING",ze=ce.type||ce.rx_type||"OPD",Te=m5(ce.created_at||ce.rx_datetime||ce.bill_date),Nt=ce.patient_name||`${((ke=ce.patient)==null?void 0:ke.first_name)||""} ${((je=ce.patient)==null?void 0:je.last_name)||""}`.trim()||((ht=ce.patient)==null?void 0:ht.name)||ce.patient_uhid||"",Jt=ce.doctor_name||ce.doctor||ce.doctor_display||"";return n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/70 transition-colors",children:[n.jsx("td",{className:"px-3 py-3 align-middle",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-xs font-semibold text-slate-900",children:ce.rx_number||`RX-${ce.id}`}),(ce.patient_uhid||ce.uhid)&&n.jsxs("span",{className:"text-[11px] text-slate-500",children:["UHID: ",ce.patient_uhid||ce.uhid]})]})}),n.jsx("td",{className:"px-3 py-3 align-middle",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-[11px] font-medium text-slate-700",children:n.jsx(or,{className:"w-3.5 h-3.5"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-900 font-medium",children:Nt}),(ce.patient_uhid||ce.uhid)&&n.jsx("div",{className:"text-[11px] text-slate-500",children:ce.patient_uhid||ce.uhid})]})]})}),n.jsx("td",{className:"px-3 py-3 align-middle",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(et,{variant:"outline",className:"border-slate-500 text-[11px] px-2 py-0.5",children:ze}),Jt&&n.jsxs("span",{className:"text-[11px] text-slate-600 flex items-center gap-1",children:[n.jsx(Hs,{className:"w-3 h-3"}),Jt]})]}),ce.context_label&&n.jsx("span",{className:"text-[11px] text-slate-500",children:ce.context_label})]})}),n.jsx("td",{className:"px-3 py-3 align-middle text-xs text-slate-700",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Na,{className:"w-3 h-3 text-slate-400"}),n.jsx("span",{children:Te})]})}),n.jsx("td",{className:"px-3 py-3 align-middle",children:n.jsx(f5,{status:Ce})}),n.jsx("td",{className:"px-3 py-3 align-middle text-right",children:n.jsxs(ge,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs rounded-full border-slate-500 bg-white",onClick:()=>Fe(ce),children:[n.jsx(Pr,{className:"w-3.5 h-3.5 mr-1"}),"View"]})})]},ce.id)})]})]})})})}),n.jsx("div",{className:"md:hidden space-y-2",children:u?n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white/70 backdrop-blur p-4 text-xs text-slate-500",children:"Loading prescriptions..."}):x.length?x.map(ce=>{var ke,je,ht;const Ce=(ce.status||"").toUpperCase()||"PENDING",ze=ce.type||ce.rx_type||"OPD",Te=m5(ce.created_at||ce.rx_datetime||ce.bill_date),Nt=ce.doctor_name||ce.doctor||ce.doctor_display||"",Jt=ce.patient_name||`${((ke=ce.patient)==null?void 0:ke.first_name)||""} ${((je=ce.patient)==null?void 0:je.last_name)||""}`.trim()||((ht=ce.patient)==null?void 0:ht.name)||ce.patient_uhid||"";return n.jsxs("button",{type:"button",onClick:()=>Fe(ce),className:"w-full text-left rounded-3xl border border-slate-500 bg-white/70 backdrop-blur p-4 shadow-sm active:scale-[0.99] transition",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:ce.rx_number||`RX-${ce.id}`}),n.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[Jt," ",ce.patient_uhid||ce.uhid?` ${ce.patient_uhid||ce.uhid}`:""]})]}),n.jsx(f5,{status:Ce})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-[11px] text-slate-600",children:[n.jsx(et,{variant:"outline",className:"border-slate-500 text-[11px]",children:ze}),Nt?n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Hs,{className:"w-3 h-3 text-slate-400"}),Nt]}):null,n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Na,{className:"w-3 h-3 text-slate-400"}),Te]})]}),n.jsx("div",{className:"mt-3",children:n.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-slate-900 text-white px-3 py-1.5 text-xs",children:[n.jsx(Pr,{className:"w-4 h-4"}),"Open"]})})]},ce.id)}):n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white/70 backdrop-blur p-4 text-xs text-slate-500",children:"No prescriptions found for the selected filters."})})]})]})}),n.jsx(Ls,{value:"new",className:"mt-4",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,1.8fr)]",children:[n.jsxs(Gm,{children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"flex items-center gap-2 text-sm font-semibold",children:[n.jsx(rr,{className:"w-4 h-4 text-slate-500"}),"Prescription Details",n.jsx(et,{variant:"outline",className:"ml-1 text-[11px]",children:k.type})]})}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Prescription Type"}),n.jsx("div",{className:"flex flex-wrap gap-1.5",children:x5.map(ce=>n.jsxs("button",{type:"button",onClick:()=>A(Ce=>({...Ce,type:ce.value})),className:["px-3 py-1.5 rounded-full text-xs border flex items-center gap-1.5 transition shadow-sm",k.type===ce.value?"bg-slate-900 text-white border-slate-900":"bg-white/70 text-slate-700 border-slate-500 backdrop-blur"].join(" "),children:[n.jsx(rr,{className:"w-3 h-3"}),ce.label]},ce.value))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Priority"}),n.jsxs(Zs,{value:k.priority,onValueChange:ce=>A(Ce=>({...Ce,priority:ce})),children:[n.jsx(Ws,{className:"w-full bg-white/70 backdrop-blur border-slate-500 rounded-full h-10 text-xs",children:n.jsx(Js,{placeholder:"Select priority"})}),n.jsx(qs,{children:iQe.map(ce=>n.jsx(Ut,{value:ce.value,children:ce.label},ce.value))})]})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Date & Time"}),n.jsx(Ee,{type:"datetime-local",value:k.datetime,onChange:ce=>A(Ce=>({...Ce,datetime:ce.target.value})),className:"h-10 text-xs bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"space-y-1.5 relative",ref:fe,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(xt,{className:"text-xs text-slate-600 flex items-center gap-1.5",children:[n.jsx(or,{className:"w-3 h-3"}),"Patient (UHID / name / phone)"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[le&&n.jsx("span",{className:"text-[11px] text-slate-500",children:"Loading full patient"}),k.patient&&n.jsx("button",{type:"button",onClick:bt,className:"text-[11px] text-slate-500 hover:text-slate-900",children:"Clear"})]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3"}),n.jsx(Ee,{value:U,onChange:ce=>{W(ce.target.value),K(!0)},placeholder:k.type==="COUNTER"?"Optional for counter sale":"Search patient...",className:"pl-9 h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsx(on,{children:$&&(R.length>0||G)&&n.jsxs(mt.div,{initial:{opacity:0,y:-6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"absolute z-30 mt-2 w-full bg-white/80 backdrop-blur border border-slate-500 rounded-2xl shadow-xl max-h-60 overflow-auto text-xs",children:[G&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"Searching..."}),!G&&!R.length&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"No patients found"}),!G&&R.map(ce=>n.jsxs("button",{type:"button",onClick:()=>Pe(ce),className:"w-full text-left px-3 py-2.5 hover:bg-slate-50 flex flex-col gap-0.5",children:[n.jsxs("div",{className:"flex justify-between items-center gap-2",children:[n.jsx("span",{className:"font-medium text-slate-900",children:bne(ce)}),ce.uhid&&n.jsxs("span",{className:"text-[10px] text-slate-500",children:["UHID: ",ce.uhid]})]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:[n$(ce)?`${n$(ce)}  `:"",ce.phone||""]})]},ce.id))]})})]}),k.patient&&k.type!=="COUNTER"?n.jsx(a$,{patient:k.patient,loading:le}):null,n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[k.type==="OPD"&&n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"OPD Visit No (optional)"}),n.jsx(Ee,{value:k.visitNo,onChange:ce=>A(Ce=>({...Ce,visitNo:ce.target.value})),placeholder:"e.g., OPD-2025-0001",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),k.type==="IPD"&&n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Admission No"}),n.jsx(Ee,{value:k.admissionNo,onChange:ce=>A(Ce=>({...Ce,admissionNo:ce.target.value})),placeholder:"IPD admission number",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),k.type==="OT"&&n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"OT Case No"}),n.jsx(Ee,{value:k.otCaseNo,onChange:ce=>A(Ce=>({...Ce,otCaseNo:ce.target.value})),placeholder:"OT / procedure case ID",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsxs(xt,{className:"text-xs text-slate-600 flex items-center gap-1",children:[n.jsx(Hs,{className:"w-3 h-3"}),"Consultant / Prescriber ",k.type==="COUNTER"?"(optional)":""]}),n.jsxs(Zs,{value:k.doctorId||"",onValueChange:ce=>A(Ce=>({...Ce,doctorId:ce})),children:[n.jsx(Ws,{className:"w-full bg-white/70 backdrop-blur border-slate-500 rounded-full h-10 text-sm",children:n.jsx(Js,{placeholder:"Select doctor"})}),n.jsxs(qs,{children:[X&&n.jsx(Ut,{value:"__loading",disabled:!0,children:"Loading..."}),!X&&(!q||!q.length)&&n.jsx(Ut,{value:"__none",disabled:!0,children:"No doctors configured"}),!X&&(q==null?void 0:q.map(ce=>n.jsx(Ut,{value:String(ce.id),children:ce.name||ce.full_name||ce.email},ce.id)))]})]})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-xs text-slate-600",children:"Notes / instructions to pharmacist (optional)"}),n.jsx(fs,{value:k.notes,onChange:ce=>A(Ce=>({...Ce,notes:ce.target.value})),rows:3,className:"text-sm bg-white/70 backdrop-blur border-slate-500 resize-none rounded-2xl",placeholder:"Eg: Allergic to penicillin, avoid NSAIDs, taper after 5 days..."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:[n.jsxs(ge,{type:"button",variant:"outline",size:"sm",className:"h-9 rounded-full border-slate-500 bg-white/70 backdrop-blur",onClick:()=>De(!0),children:[n.jsx(cl,{className:"w-4 h-4 mr-1"}),"Reset"]}),n.jsxs("div",{className:"text-[11px] text-slate-500 flex items-center gap-2",children:[n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx($n,{className:"w-3 h-3"}),"Automation:"]}),n.jsx("span",{children:"Debounced search  Auto qty  Merge duplicates"})]})]})]})]}),n.jsxs(Gm,{children:[n.jsxs(gt,{className:"pb-3 flex flex-row items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Pr,{className:"w-4 h-4 text-slate-500"}),n.jsx(jt,{className:"text-sm font-semibold",children:"Medicines & Instructions"})]}),n.jsx("div",{className:"text-[11px] text-slate-500",children:I.length?`${I.length} lines`:"No lines added yet"})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsx("div",{className:"border border-slate-500/70 rounded-2xl p-3 bg-white/60 backdrop-blur",children:n.jsxs("div",{className:"grid lg:grid-cols-[minmax(0,2.4fr)_minmax(0,1fr)] gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"space-y-1 relative",ref:Me,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(xt,{className:"text-[11px] text-slate-600",children:["Medicine ",n.jsx("span",{className:"text-[10px] text-slate-400",children:"(linked to Inventory)"})]}),!!ve()&&!O.total_qty&&n.jsxs("span",{className:"text-[10px] text-slate-500",children:["Suggested qty:"," ",n.jsx("span",{className:"font-medium",children:ve()})]})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-3"}),n.jsx(Ee,{ref:Ae,value:Y,onChange:ce=>{Q(ce.target.value),$e(!0)},placeholder:"Search drug name, brand, generic...",className:"pl-9 h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsx(on,{children:Ze&&(_e.length>0||me)&&n.jsxs(mt.div,{initial:{opacity:0,y:-6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"absolute z-30 mt-2 w-full bg-white/85 backdrop-blur border border-slate-500 rounded-2xl shadow-xl max-h-60 overflow-auto text-xs",children:[me&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"Searching medicines..."}),!me&&!_e.length&&n.jsx("div",{className:"px-3 py-2 text-slate-500",children:"No items found"}),!me&&_e.map(ce=>n.jsxs("button",{type:"button",onClick:()=>It(ce),className:"w-full text-left px-3 py-2.5 hover:bg-slate-50 flex flex-col gap-0.5",children:[n.jsxs("div",{className:"flex justify-between items-center gap-2",children:[n.jsx("span",{className:"font-medium text-slate-900",children:ce.name||ce.item_name}),ce.code&&n.jsx("span",{className:"text-[10px] text-slate-500",children:ce.code})]}),n.jsxs("div",{className:"text-[11px] text-slate-500 flex items-center gap-2",children:[n.jsx("span",{children:ce.strength||ce.form||""}),Number.isFinite(Number(ce.available_qty))&&n.jsxs(et,{variant:"outline",className:"text-[10px]",children:["Stock: ",ce.available_qty]})]})]},ce.id))]})})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Dose"}),n.jsx(Ee,{value:O.dose,onChange:ce=>D(Ce=>({...Ce,dose:ce.target.value})),placeholder:"e.g. 500 mg",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Frequency"}),n.jsx(Ee,{value:O.frequency,onChange:ce=>D(Ce=>{const ze={...Ce,frequency:ce.target.value};if(!ze._qtyTouched&&!ze.total_qty){const Te=Rc(ze);Te&&(ze.total_qty=Te)}return ze}),placeholder:"e.g. 1-0-1 / BD / TID",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Days"}),n.jsx(Ee,{value:O.duration_days,onChange:ce=>D(Ce=>{const ze={...Ce,duration_days:ce.target.value};if(!ze._qtyTouched&&!ze.total_qty){const Te=Rc(ze);Te&&(ze.total_qty=Te)}return ze}),placeholder:"e.g. 5",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]})]}),n.jsx("div",{className:"flex flex-wrap gap-1.5 pt-1",children:lQe.map(ce=>n.jsx("button",{type:"button",onClick:()=>D(Ce=>{const ze={...Ce,frequency:ce.value};if(!ze._qtyTouched&&!ze.total_qty){const Te=Rc(ze);Te&&(ze.total_qty=Te)}return ze}),className:["px-3 py-1 rounded-full text-[11px] border shadow-sm transition",gne(O.frequency)===ce.value?"bg-slate-900 text-white border-slate-900":"bg-white/70 text-slate-700 border-slate-500 backdrop-blur"].join(" "),children:ce.label},ce.value))}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Route"}),n.jsxs(Zs,{value:O.route||"PO",onValueChange:ce=>D(Ce=>({...Ce,route:ce})),children:[n.jsx(Ws,{className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full",children:n.jsx(Js,{placeholder:"Route"})}),n.jsx(qs,{children:oQe.map(ce=>n.jsx(Ut,{value:ce,children:ce},ce))})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Total Qty"}),n.jsx(Ee,{value:O.total_qty,onChange:ce=>D(Ce=>({...Ce,total_qty:ce.target.value,_qtyTouched:!0})),placeholder:ve()?`Suggested: ${ve()}`:"eg. 10",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Strength"}),n.jsx(Ee,{value:O.strength,onChange:ce=>D(Ce=>({...Ce,strength:ce.target.value})),placeholder:"Auto-filled if available",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Instructions to patient"}),n.jsx(Ee,{value:O.instructions,onChange:ce=>D(Ce=>({...Ce,instructions:ce.target.value})),placeholder:"After food, morning & night, etc.",className:"h-10 text-sm bg-white/70 backdrop-blur border-slate-500 rounded-full"})]})]}),n.jsxs("div",{className:"flex flex-col justify-between gap-2",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:n.jsx("p",{className:"leading-relaxed",children:"Fast add line. Use frequency chips and auto-qty to reduce typing. Duplicate medicines auto-merge."})}),n.jsx("div",{className:"flex justify-end",children:n.jsxs(ge,{type:"button",size:"sm",className:"h-10 px-4 rounded-full shadow-sm",onClick:Ge,children:[n.jsx(ds,{className:"w-4 h-4 mr-1"}),"Add line"]})})]})]})}),n.jsxs("div",{className:"border border-slate-100 rounded-2xl overflow-hidden bg-white/60 backdrop-blur",children:[n.jsx("div",{className:"hidden md:block",children:n.jsx(Fn,{className:"max-h-[340px]",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full min-w-[760px] text-[12px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10 backdrop-blur",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"#"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Medicine"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Dose / Freq / Days"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Route"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Qty"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Actions"})]})}),n.jsxs("tbody",{children:[!I.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-8 text-center text-[11px] text-slate-500",children:"No lines added. Use the panel above to add medicines."})}),I.map((ce,Ce)=>{var ze,Te,Nt,Jt;return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-500",children:Ce+1}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[12px] font-semibold text-slate-900",children:((ze=ce.item)==null?void 0:ze.name)||ce.item_name||"Unnamed medicine"}),(ce.strength||((Te=ce.item)==null?void 0:Te.strength))&&n.jsx("span",{className:"text-[11px] text-slate-500",children:ce.strength||((Nt=ce.item)==null?void 0:Nt.strength)})]})}),n.jsx("td",{className:"px-3 py-2 align-top text-[12px] text-slate-700",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("span",{children:[ce.dose||"","  ",ce.frequency||"","  ",ce.duration_days?`${ce.duration_days} days`:""]}),ce.instructions&&n.jsx("span",{className:"text-[11px] text-slate-500",children:ce.instructions})]})}),n.jsx("td",{className:"px-3 py-2 align-top text-[12px] text-slate-700",children:ce.route||""}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[12px] text-slate-700 font-semibold",children:ce.total_qty||Rc(ce)||""}),n.jsx("td",{className:"px-3 py-2 align-top text-right",children:n.jsx(ge,{variant:"ghost",size:"sm",className:"h-8 px-2 text-[11px] text-slate-500 hover:text-red-600",onClick:()=>We(Ce),children:"Remove"})})]},`${ce.item_id||((Jt=ce.item)==null?void 0:Jt.id)||Ce}-${Ce}`)})]})]})})})}),n.jsx("div",{className:"md:hidden p-3 space-y-2",children:I.length?I.map((ce,Ce)=>{var ze,Te,Nt,Jt;return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white/70 backdrop-blur p-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:((ze=ce.item)==null?void 0:ze.name)||ce.item_name||"Unnamed medicine"}),n.jsx("div",{className:"text-xs text-slate-500 truncate",children:ce.strength||(Te=ce.item)!=null&&Te.strength?ce.strength||((Nt=ce.item)==null?void 0:Nt.strength):""})]}),n.jsxs("div",{className:"text-xs font-semibold text-slate-900",children:["Qty ",ce.total_qty||Rc(ce)||""]})]}),n.jsxs("div",{className:"mt-2 text-xs text-slate-700",children:[ce.dose||"","  ",ce.frequency||"","  ",ce.duration_days?`${ce.duration_days} days`:"","  ",ce.route||""]}),ce.instructions?n.jsx("div",{className:"mt-1 text-xs text-slate-500",children:ce.instructions}):null,n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx(ge,{variant:"outline",size:"sm",className:"h-9 rounded-full border-slate-500 bg-white",onClick:()=>We(Ce),children:"Remove"})})]},`${ce.item_id||((Jt=ce.item)==null?void 0:Jt.id)||Ce}-${Ce}`)}):n.jsx("div",{className:"text-center text-xs text-slate-500 py-6",children:"No lines added. Use the panel above to add medicines."})})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 pt-1",children:[n.jsxs(ge,{type:"button",variant:"ghost",size:"sm",className:"h-9 px-2 text-sm text-slate-500 justify-start",onClick:()=>{De(!0),s("list")},children:[n.jsx(Hl,{className:"w-4 h-4 mr-1"}),"Back to queue"]}),n.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[n.jsxs("div",{className:"text-[11px] text-slate-500 hidden md:block",children:["Patient:"," ",n.jsx("span",{className:"font-medium text-slate-700",children:k.patient?Mv(k.patient):k.type==="COUNTER"?"Counter":""}),n.jsx("span",{className:"mx-2 text-slate-300",children:"|"}),"Lines:"," ",n.jsx("span",{className:"font-medium text-slate-700",children:I.length})]}),n.jsx(ge,{type:"button",size:"sm",className:"h-10 px-5 rounded-full shadow-sm",onClick:Ve,disabled:T,children:T?"Saving...":n.jsxs(n.Fragment,{children:[n.jsx(Pr,{className:"w-4 h-4 mr-1"}),"Save & Send"]})})]})]})]})]})]})}),n.jsx(Ls,{value:"detail",className:"mt-4",children:y?n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.05fr)_minmax(0,1.95fr)]",children:[n.jsxs(Gm,{children:[n.jsxs(gt,{className:"pb-3",children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(Pr,{className:"w-4 h-4 text-slate-500"}),"Prescription #",y.rx_number||y.id,n.jsx(f5,{status:y.status||"PENDING"})]}),n.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-slate-500",children:[n.jsxs("span",{children:["Type:"," ",n.jsx(et,{variant:"outline",className:"px-2 py-0.5",children:y.type||y.rx_type||"OPD"})]}),y.priority&&n.jsxs("span",{children:["Priority: ",y.priority]}),(y.doctor_name||y.doctor_display)&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Hs,{className:"w-3 h-3"}),y.doctor_name||y.doctor_display]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Na,{className:"w-3 h-3"}),m5(y.created_at||y.rx_datetime)]})]})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsx(a$,{patient:J||y.patient||null,loading:te}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(ge,{variant:"outline",className:"rounded-full border-slate-500 bg-white/70 backdrop-blur",onClick:()=>{s("list")},children:[n.jsx(Hl,{className:"w-4 h-4 mr-2"}),"Back"]}),n.jsxs(ge,{className:"rounded-full",onClick:()=>{var ze;const ce=y.type||y.rx_type||"OPD";tt(ce);const Ce=y.patient_id||y.patientId||((ze=y.patient)==null?void 0:ze.id)||null;Ce&&(async()=>{const Te=await He(Ce,{silent:!0});Te&&(A(Nt=>({...Nt,patient:Te})),W(Mv(Te)))})()},children:[n.jsx(ds,{className:"w-4 h-4 mr-2"}),"Copy as New"]})]})]})]}),n.jsxs(Gm,{children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold",children:["Medicines",n.jsx(et,{variant:"outline",className:"ml-2 text-[11px]",children:ot.length})]})}),n.jsx(it,{className:"space-y-3",children:n.jsxs("div",{className:"border border-slate-100 rounded-2xl overflow-hidden bg-white/60 backdrop-blur",children:[n.jsx("div",{className:"hidden md:block",children:n.jsx(Fn,{className:"max-h-[520px]",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full min-w-[760px] text-[12px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10 backdrop-blur",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"#"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Medicine"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Dose / Freq / Days"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Route"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Qty"})]})}),n.jsxs("tbody",{children:[!ot.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-8 text-center text-[11px] text-slate-500",children:"No lines found for this prescription."})}),ot.map((ce,Ce)=>{const ze=r$(ce);return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-500",children:Ce+1}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[12px] font-semibold text-slate-900",children:ze.itemName||"Unnamed medicine"}),ze.strength?n.jsx("span",{className:"text-[11px] text-slate-500",children:ze.strength}):null]})}),n.jsx("td",{className:"px-3 py-2 align-top text-[12px] text-slate-700",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("span",{children:[ze.dose||"","  ",ze.frequency||""," "," ",ze.duration_days?`${ze.duration_days} days`:""]}),ze.instructions?n.jsx("span",{className:"text-[11px] text-slate-500",children:ze.instructions}):null]})}),n.jsx("td",{className:"px-3 py-2 align-top text-[12px] text-slate-700",children:ze.route||""}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[12px] text-slate-700 font-semibold",children:ze.qty||Rc({frequency:ze.frequency,duration_days:ze.duration_days})||""})]},ce.id||Ce)})]})]})})})}),n.jsx("div",{className:"md:hidden p-3 space-y-2",children:ot.length?ot.map((ce,Ce)=>{const ze=r$(ce);return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white/70 backdrop-blur p-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:ze.itemName||"Unnamed medicine"}),n.jsx("div",{className:"text-xs text-slate-500 truncate",children:ze.strength||""})]}),n.jsxs("div",{className:"text-xs font-semibold text-slate-900",children:["Qty ",ze.qty||Rc({frequency:ze.frequency,duration_days:ze.duration_days})||""]})]}),n.jsxs("div",{className:"mt-2 text-xs text-slate-700",children:[ze.dose||"","  ",ze.frequency||"","  ",ze.duration_days?`${ze.duration_days} days`:"","  ",ze.route||""]}),ze.instructions?n.jsx("div",{className:"mt-1 text-xs text-slate-500",children:ze.instructions}):null]},ce.id||Ce)}):n.jsx("div",{className:"text-center text-xs text-slate-500 py-6",children:"No lines found for this prescription."})})]})})]})]}):n.jsx(Gm,{children:n.jsx(it,{className:"py-10 text-center text-sm text-slate-500",children:"Select a prescription from the queue to view details."})})})]})})]})]})})})})]})}function g5(t={}){return he.get("/pharmacy/billing",{params:t})}function b5(t){return he.get(`/pharmacy/billing/${t}`)}function uQe(t,s){return he.post(`/pharmacy/billing/${t}/status`,s)}function mQe(t={}){return he.get("/pharmacy/billing/returns/list",{params:t})}function hQe(t){return he.post("/pharmacy/billing/returns",t)}function xQe(t){return he.post("/pharmacy/billing/ipd/consolidated",t)}async function y5(t){try{const s=await he.get(`/pharmacy/billing/${t}/pdf`,{responseType:"blob"}),r=new Blob([s.data],{type:"application/pdf"}),a=window.URL.createObjectURL(r);window.open(a,"_blank","noopener,noreferrer")}catch(s){console.error("Failed to open pharmacy bill PDF",s)}}const pQe=[{value:"ALL",label:"All types"},{value:"OPD",label:"OPD"},{value:"IPD",label:"IPD"},{value:"OT",label:"OT"},{value:"COUNTER",label:"Counter"}],fQe=[{value:"ALL",label:"All"},{value:"UNPAID",label:"Unpaid"},{value:"PARTIAL",label:"Partial"},{value:"PAID",label:"Paid"},{value:"CANCELLED",label:"Cancelled"}],gQe=[{value:"CASH",label:"Cash"},{value:"CARD",label:"Card"},{value:"UPI",label:"UPI"},{value:"NET_BANKING",label:"Net Banking"},{value:"OTHER",label:"Other"}];function Oa(t){const s=Number(t??0);return Number.isFinite(s)?`${s.toFixed(2)}`:"0.00"}function Ov(t={}){const s=(t.type||t.bill_type||"").toUpperCase();if(s==="OPD"||s==="IPD"||s==="OT"||s==="COUNTER")return s;const r=(t.context_type||"").toUpperCase();return r==="OPD"?"OPD":r==="IPD"?"IPD":r==="PHARM_COUNTER"||r==="COUNTER"?"COUNTER":"OPD"}function v5(t){const s=(t||"").toUpperCase();return s?s==="PARTIALLY_PAID"?"PARTIAL":s==="DRAFT"?"UNPAID":s:"UNPAID"}function bQe(){var It,De,tt,ve,Ge,We,Ve,Fe,ot,ft,ce,Ce,ze,Te,Nt,Jt,ke;const[t,s]=p.useState("bills"),[r,a]=p.useState([]),[i,l]=p.useState(!1),[o,c]=p.useState("ALL"),[d,u]=p.useState("ALL"),[m,x]=p.useState(""),[g,y]=p.useState(""),[v,j]=p.useState(""),[w,S]=p.useState(null),[E,k]=p.useState(!1),[A,I]=p.useState(null),[P,O]=p.useState("CASH"),[D,T]=p.useState(""),[B,U]=p.useState(!1),[W,V]=p.useState([]),[R,F]=p.useState(!1),[G,H]=p.useState(""),[$,K]=p.useState(null),[le,se]=p.useState([]),[J,ie]=p.useState(""),[te,ne]=p.useState(!1),[q,ee]=p.useState(""),[X,Z]=p.useState(""),[Y,Q]=p.useState(!1),[oe,_e]=p.useState([]),[xe,me]=p.useState(null);p.useEffect(()=>{Re()},[d]),p.useEffect(()=>{t==="returns"&&$e(),t==="ipd"&&fe()},[t]);async function Re(){try{l(!0);const je={limit:100};d!=="ALL"&&(je.status=d),m.trim()&&(je.q=m.trim()),g&&(je.date_from=g),v&&(je.date_to=v);const ht=await g5(je);a((ht==null?void 0:ht.data)||[])}catch{}finally{l(!1)}}async function Ze(je){try{const ht=await b5(je.id);S((ht==null?void 0:ht.data)||je)}catch{}}async function $e(){try{F(!0);const je=await mQe({limit:50});V((je==null?void 0:je.data)||[])}catch{}finally{F(!1)}}async function fe(){try{const je=await g5({limit:100}),At=((je==null?void 0:je.data)||[]).filter(ms=>Ov(ms)==="IPD");_e(At)}catch{}}const Me=p.useMemo(()=>r!=null&&r.length?o==="ALL"?r:r.filter(je=>Ov(je)===o):[],[r,o]);function Ae(je){const ht=Number(je.total_amount??je.gross_total??je.net_amount??0),At=Number(je.paid_amount??0),ms=Number(je.balance_amount??ht-At)||0;I(je),T(ms>0?String(ms.toFixed(2)):String(ht.toFixed(2))),O("CASH"),k(!0)}async function Ke(){if(!A)return;const je=Number(D);if(!je||je<=0){ae.error("Enter a valid payment amount");return}const ht=Number(A.total_amount??A.gross_total??A.net_amount??0),ms=Number(A.paid_amount??0)+je,Zt=Math.max(ht-ms,0);let hs="PARTIAL";Zt<=.01?hs="PAID":ms<=.01&&(hs="UNPAID");try{if(U(!0),await uQe(A.id,{payment_status:hs,paid_amount:je,note:null}),ae.success("Payment recorded successfully"),k(!1),I(null),T(""),await Re(),w&&w.id===A.id){const Is=await b5(w.id);S((Is==null?void 0:Is.data)||w)}}catch{}finally{U(!1)}}async function Le(){if(!G.trim()){ae.error("Enter bill no / patient / UHID to search");return}try{const je=await g5({q:G.trim(),limit:1}),ht=(je==null?void 0:je.data)||[];if(!ht.length){ae.error("No matching pharmacy bill found");return}const At=ht[0],ms=await b5(At.id),Zt=(ms==null?void 0:ms.data)||At,Is=(Zt.items||Zt.lines||[]).map(_s=>({..._s,return_qty:""}));K(Zt),se(Is)}catch{}}function He(je,ht){se(At=>At.map((ms,Zt)=>Zt===je?{...ms,return_qty:ht}:ms))}async function pt(){if(!$){ae.error("Select a source bill first");return}const je=le.filter(At=>Number(At.return_qty||0)>0);if(!je.length){ae.error("Enter return quantity for at least one item");return}const ht={source_invoice_id:$.id,reason:J||null,lines:je.map(At=>({bill_line_id:At.id,qty_to_return:Number(At.return_qty||0)}))};try{ne(!0),await hQe(ht),ae.success("Return note created successfully"),ie(""),K(null),se([]),H(""),$e()}catch{}finally{ne(!1)}}async function Pe(){if(!q&&!X){ae.error("Enter Patient ID or Admission ID");return}const je={};q&&(je.patient_id=Number(q)),X&&(je.admission_id=Number(X));try{Q(!0);const ht=await xQe(je),At=(ht==null?void 0:ht.data)||ht||null;if(!At){ae.error("No consolidated data returned");return}me(At),ae.success("IPD consolidated pharmacy summary generated")}catch{}finally{Q(!1)}}const bt=p.useMemo(()=>w?w.items||w.lines||[]:[],[w]);return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[n.jsx("div",{className:"flex items-center justify-between gap-3",children:n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-slate-900",children:"Pharmacy Billing Console"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Manage pharmacy invoices, payments, returns & IPD consolidated bills."})]})}),n.jsxs(Do,{value:t,onValueChange:s,children:[n.jsxs(Wl,{className:"mb-4",children:[n.jsx(zs,{value:"bills",children:"Bills"}),n.jsx(zs,{value:"returns",children:"Returns"}),n.jsx(zs,{value:"ipd",children:"IPD Consolidated"})]}),n.jsx(Ls,{value:"bills",className:"space-y-3",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.7fr)_minmax(0,1.3fr)]",children:[n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(nj,{className:"w-4 h-4 text-slate-500"}),"Pharmacy Bills"]}),n.jsx(ge,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full border-slate-500",onClick:Re,children:n.jsx(jr,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1 min-w-[180px]",children:[n.jsx(Yt,{className:"w-4 h-4 text-slate-400 absolute left-2.5 top-2.5"}),n.jsx(Ee,{value:m,onChange:je=>x(je.target.value),onKeyDown:je=>{je.key==="Enter"&&Re()},placeholder:"Search bill no / UHID / patient / phone",className:"pl-8 h-9 text-xs bg-white border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ee,{type:"date",value:g,onChange:je=>y(je.target.value),className:"h-9 text-[11px] bg-white border-slate-500 rounded-full w-[130px]"}),n.jsx(Ee,{type:"date",value:v,onChange:je=>j(je.target.value),className:"h-9 text-[11px] bg-white border-slate-500 rounded-full w-[130px]"}),n.jsx(ge,{variant:"outline",size:"sm",className:"h-8 px-3 rounded-full text-[11px]",onClick:Re,children:"Apply"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(Zs,{value:o,onValueChange:c,children:[n.jsx(Ws,{className:"w-[140px] bg-white border-slate-500 rounded-full h-8 text-[11px]",children:n.jsx(Js,{placeholder:"Bill type"})}),n.jsx(qs,{children:pQe.map(je=>n.jsx(Ut,{value:je.value,children:je.label},je.value))})]}),n.jsxs(Zs,{value:d,onValueChange:u,children:[n.jsx(Ws,{className:"w-[130px] bg-white border-slate-500 rounded-full h-8 text-[11px]",children:n.jsx(Js,{placeholder:"Status"})}),n.jsx(qs,{children:fQe.map(je=>n.jsx(Ut,{value:je.value,children:je.label},je.value))})]})]})]})]})}),n.jsx(it,{className:"pt-0",children:n.jsx("div",{className:"border border-slate-100 rounded-xl overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[480px]",children:n.jsxs("table",{className:"w-full text-xs",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Bill"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Patient"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Type"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Amount"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Paid / Balance"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Date"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Actions"})]})}),n.jsxs("tbody",{children:[i&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"Loading bills..."})}),!i&&!Me.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"No pharmacy bills found for selected filters."})}),!i&&Me.map(je=>{var Cn,Pt,Ea;const ht=Number(je.total_amount??je.gross_total??je.net_amount??0),At=Number(je.paid_amount??0),ms=Number(je.balance_amount??ht-At)||0,Zt=v5(je.status),hs=je.bill_date||je.created_at||je.invoice_date||null,Is=hs?String(hs).slice(0,16).replace("T"," "):"",_s=Ov(je),Sn=je.patient_name||`${((Cn=je.patient)==null?void 0:Cn.first_name)||""} ${((Pt=je.patient)==null?void 0:Pt.last_name)||""}`.trim()||"",tn=je.patient_uhid||((Ea=je.patient)==null?void 0:Ea.uhid),Ts=Zt!=="PAID"&&Zt!=="CANCELLED"&&ht>0;return n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/70 cursor-pointer",onClick:()=>Ze(je),children:[n.jsx("td",{className:"px-3 py-2 align-middle",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:je.bill_number||je.invoice_number||`PB-${je.id}`}),je.rx_number&&n.jsxs("span",{className:"text-[10px] text-slate-500",children:["Rx: ",je.rx_number]})]})}),n.jsx("td",{className:"px-3 py-2 align-middle",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-7 h-7 rounded-full bg-slate-100 flex items-center justify-center text-[11px] text-slate-700",children:n.jsx(or,{className:"w-3 h-3"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-900",children:Sn}),tn&&n.jsxs("div",{className:"text-[10px] text-slate-500",children:["UHID: ",tn]})]})]})}),n.jsx("td",{className:"px-3 py-2 align-middle",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx(et,{variant:"outline",className:"border-slate-500 text-[10px] px-1.5 py-0.5 w-max",children:_s}),n.jsx(j5,{status:Zt})]})}),n.jsx("td",{className:"px-3 py-2 align-middle text-right",children:n.jsx("div",{className:"text-[11px] text-slate-900",children:Oa(ht)})}),n.jsx("td",{className:"px-3 py-2 align-middle text-right",children:n.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[n.jsxs("span",{className:"text-[11px] text-emerald-700",children:["Paid: ",Oa(At)]}),n.jsxs("span",{className:"text-[11px] text-rose-700",children:["Bal: ",Oa(ms)]})]})}),n.jsx("td",{className:"px-3 py-2 align-middle text-[11px] text-slate-700",children:n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(Na,{className:"w-3 h-3 text-slate-400"}),n.jsx("span",{children:Is})]})}),n.jsx("td",{className:"px-3 py-2 align-middle text-right",onClick:Rr=>Rr.stopPropagation(),children:n.jsxs("div",{className:"flex justify-end gap-1.5",children:[n.jsx(ge,{variant:"outline",size:"icon",className:"h-7 w-7 rounded-full border-slate-500",onClick:()=>{const Rr=je.id||je.invoice_id;Rr&&y5(Rr)},children:n.jsx(nn,{className:"w-3 h-3"})}),Ts&&n.jsxs(ge,{size:"sm",className:"h-7 px-3 rounded-full text-[11px]",onClick:()=>Ae(je),children:[n.jsx(Qi,{className:"w-3 h-3 mr-1"}),"Collect"]})]})})]},je.id)})]})]})})})})]}),n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(nj,{className:"w-4 h-4 text-slate-500"}),"Bill Details"]})}),n.jsx(it,{className:"space-y-3 text-xs",children:w?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-900",children:w.patient_name||`${((It=w.patient)==null?void 0:It.first_name)||""} ${((De=w.patient)==null?void 0:De.last_name)||""}`.trim()||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID:"," ",w.patient_uhid||((tt=w.patient)==null?void 0:tt.uhid)||""]}),n.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[n.jsx(et,{variant:"outline",className:"border-slate-500 text-[10px] px-1.5 py-0.5",children:Ov(w)}),w.location&&n.jsxs("span",{className:"text-[10px] text-slate-500 flex items-center gap-1",children:[n.jsx(lC,{className:"w-3 h-3"}),w.location]})]})]}),n.jsxs("div",{className:"text-right text-[11px] text-slate-500",children:[n.jsxs("div",{children:["Bill:"," ",w.bill_number||w.invoice_number||`PB-${w.id}`]}),n.jsxs("div",{children:["Date:"," ",((Ge=(ve=w.bill_date||w.created_at||"")==null?void 0:ve.toString())==null?void 0:Ge.slice(0,10))||""]}),n.jsx("div",{className:"mt-1",children:n.jsx(j5,{status:v5(w.status)})})]})]}),n.jsxs("div",{className:"border border-slate-100 rounded-xl px-3 py-2.5 flex flex-col gap-1.5 bg-slate-50/60",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[11px] text-slate-600",children:"Total"}),n.jsx("span",{className:"text-[12px] font-semibold text-slate-900",children:Oa(w.total_amount??w.gross_total??w.net_amount)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[11px] text-slate-600",children:"Paid"}),n.jsx("span",{className:"text-[11px] text-emerald-700",children:Oa(w.paid_amount)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[11px] text-slate-600",children:"Balance"}),n.jsx("span",{className:"text-[11px] text-rose-700",children:Oa(w.balance_amount??Number(w.total_amount??w.gross_total??w.net_amount??0)-Number(w.paid_amount??0))})]})]}),n.jsx("div",{className:"border border-slate-100 rounded-xl overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[260px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"#"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Medicine"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Qty"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Rate"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Amount"})]})}),n.jsxs("tbody",{children:[!bt.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-4 text-center text-[11px] text-slate-500",children:"No items found for this bill."})}),bt.map((je,ht)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-500",children:ht+1}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:je.item_name||je.medicine_name||""}),je.batch_no&&n.jsxs("span",{className:"text-[10px] text-slate-500",children:["Batch: ",je.batch_no]})]})}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[11px] text-slate-700",children:je.qty||je.quantity||""}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[11px] text-slate-700",children:Oa(je.rate||je.unit_price)}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[11px] text-slate-700",children:Oa(je.amount||je.line_total)})]},je.id||ht))]})]})})}),n.jsxs("div",{className:"flex items-center justify-between pt-1",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"h-8 px-3 rounded-full text-[11px]",onClick:()=>{const je=w.id||w.invoice_id;je&&y5(je)},children:[n.jsx(nn,{className:"w-3 h-3 mr-1"}),"Download PDF"]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs(ge,{variant:"outline",size:"sm",className:"h-8 px-3 rounded-full text-[11px]",onClick:()=>Ae(w),children:[n.jsx(Qi,{className:"w-3 h-3 mr-1"}),"Add Payment"]})})]})]}):n.jsx("div",{className:"py-10 text-center text-[11px] text-slate-500",children:"Select a pharmacy bill from the list to view details."})})]})]})}),n.jsx(Ls,{value:"returns",className:"space-y-3",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.4fr)_minmax(0,1.6fr)]",children:[n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(cl,{className:"w-4 h-4 text-slate-500"}),"New Pharmacy Return"]})}),n.jsxs(it,{className:"space-y-3 text-xs",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Source bill (search by bill no / UHID / patient)"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Yt,{className:"w-4 h-4 text-slate-400 absolute left-2.5 top-2.5"}),n.jsx(Ee,{value:G,onChange:je=>H(je.target.value),placeholder:"Eg. PB-0001, UHID, patient name",className:"pl-8 h-9 text-xs bg-white border-slate-500 rounded-full"})]}),n.jsx(ge,{size:"sm",className:"h-9 px-3 rounded-full text-[11px]",onClick:Le,children:"Search"})]})]}),$&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"border border-slate-100 rounded-xl p-3 bg-slate-50/60 space-y-1.5",children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-900",children:$.patient_name||`${((We=$.patient)==null?void 0:We.first_name)||""} ${((Ve=$.patient)==null?void 0:Ve.last_name)||""}`.trim()||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID:"," ",$.patient_uhid||((Fe=$.patient)==null?void 0:Fe.uhid)||""]})]}),n.jsxs("div",{className:"text-right text-[11px] text-slate-500",children:["Bill:"," ",$.bill_number||$.invoice_number||`PB-${$.id}`,n.jsx("br",{}),"Date:"," ",((ft=(ot=$.bill_date||$.created_at||"")==null?void 0:ot.toString())==null?void 0:ft.slice(0,10))||""]})]})}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Items & return quantity"}),n.jsx("div",{className:"border border-slate-100 rounded-xl overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[250px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"#"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Medicine"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Sold Qty"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Return Qty"})]})}),n.jsxs("tbody",{children:[!le.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-[11px] text-slate-500",children:"No items found for this bill."})}),le.map((je,ht)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-500",children:ht+1}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:je.item_name||je.medicine_name||""}),je.batch_no&&n.jsxs("span",{className:"text-[10px] text-slate-500",children:["Batch: ",je.batch_no]})]})}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[11px] text-slate-700",children:je.qty||je.quantity||""}),n.jsx("td",{className:"px-3 py-2 align-top text-right",children:n.jsx(Ee,{type:"number",min:"0",value:je.return_qty??"",onChange:At=>He(ht,At.target.value),className:"h-8 w-20 ml-auto text-[11px] text-right bg-white border-slate-500 rounded-full"})})]},je.id||ht))]})]})})})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Reason for return"}),n.jsx(fs,{value:J,onChange:je=>ie(je.target.value),rows:3,className:"text-[11px] bg-white border-slate-500 rounded-xl resize-none",placeholder:"Eg. Patient mismatch, wrong strength, expiry, doctor changed prescription, etc."})]}),n.jsx("div",{className:"flex justify-end pt-1",children:n.jsx(ge,{size:"sm",className:"h-9 px-4 rounded-full text-[11px]",onClick:pt,disabled:te,children:te?"Creating return...":n.jsxs(n.Fragment,{children:[n.jsx(cl,{className:"w-3.5 h-3.5 mr-1"}),"Create Return Note"]})})})]})]})]}),n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(cl,{className:"w-4 h-4 text-slate-500"}),"Recent Pharmacy Returns"]})}),n.jsx(it,{className:"pt-0",children:n.jsx("div",{className:"border border-slate-100 rounded-xl overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[420px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Return"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Patient"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Source bill"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Refund"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Date"})]})}),n.jsxs("tbody",{children:[R&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"Loading returns..."})}),!R&&!W.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"No pharmacy returns found."})}),!R&&W.map(je=>{var hs,Is;const ht=Math.abs(Number(je.net_amount??je.total_amount??0)),At=(je.created_at||"").toString().slice(0,16).replace("T"," "),ms=je.patient_name||`${((hs=je.patient)==null?void 0:hs.first_name)||""} ${((Is=je.patient)==null?void 0:Is.last_name)||""}`.trim()||"",Zt=je.source_bill_number||je.source_invoice_number||"";return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:je.return_number||je.bill_number||`PR-${je.id}`}),je.reason&&n.jsx("span",{className:"text-[10px] text-slate-500",children:je.reason})]})}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsx("div",{className:"text-[11px] text-slate-900",children:ms})}),n.jsx("td",{className:"px-3 py-2 align-top text-[11px] text-slate-700",children:Zt}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[11px] text-slate-700",children:Oa(ht)}),n.jsx("td",{className:"px-3 py-2 align-top text-[11px] text-slate-700",children:At||""})]},je.id)})]})]})})})})]})]})}),n.jsx(Ls,{value:"ipd",className:"space-y-3",children:n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.3fr)_minmax(0,1.7fr)]",children:[n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(lC,{className:"w-4 h-4 text-slate-500"}),"Generate IPD Pharmacy Summary"]})}),n.jsxs(it,{className:"space-y-3 text-xs",children:[n.jsx("p",{className:"text-[11px] text-slate-500",children:"Generate consolidated pharmacy summary for all UNPAID / PARTIALLY_PAID IPD pharmacy invoices for a given admission. Use this for final IPD discharge billing."}),n.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Patient ID (internal PK)"}),n.jsx(Ee,{value:q,onChange:je=>ee(je.target.value),placeholder:"Eg. 123 (required)",className:"h-9 text-xs bg-white border-slate-500 rounded-full"})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"IPD Admission ID (optional filter)"}),n.jsx(Ee,{value:X,onChange:je=>Z(je.target.value),placeholder:"Eg. 45  IPD admission table ID",className:"h-9 text-xs bg-white border-slate-500 rounded-full"})]})]}),n.jsx("div",{className:"flex justify-end pt-2",children:n.jsx(ge,{size:"sm",className:"h-9 px-4 rounded-full text-[11px]",onClick:Pe,disabled:Y,children:Y?"Generating...":n.jsxs(n.Fragment,{children:[n.jsx(nj,{className:"w-3.5 h-3.5 mr-1"}),"Generate Summary"]})})}),xe&&n.jsxs("div",{className:"mt-3 border border-slate-100 rounded-xl p-3 bg-slate-50/60 space-y-2",children:[n.jsx("div",{className:"flex items-start justify-between gap-3",children:n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-900",children:xe.patient_name||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID:"," ",xe.patient_uhid||""]}),xe.admission_id&&n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Admission ID: ",xe.admission_id]})]})}),n.jsxs("div",{className:"border border-slate-100 rounded-lg px-3 py-2 bg-white space-y-1.5",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[11px] text-slate-600",children:"Gross Total"}),n.jsx("span",{className:"text-[11px] font-semibold text-slate-900",children:Oa(xe.total_amount)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[11px] text-slate-600",children:"Tax"}),n.jsx("span",{className:"text-[11px] text-slate-900",children:Oa(xe.total_tax)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-[11px] text-slate-600",children:"Net Amount"}),n.jsx("span",{className:"text-[11px] font-semibold text-slate-900",children:Oa(xe.net_amount)})]})]}),n.jsx("div",{className:"border border-slate-100 rounded-lg overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[220px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Medicine"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Qty"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Amount"})]})}),n.jsxs("tbody",{children:[!((ce=xe.items)!=null&&ce.length)&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"px-3 py-4 text-center text-[11px] text-slate-500",children:"No pharmacy items found in this summary."})}),(Ce=xe.items)==null?void 0:Ce.map((je,ht)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-900",children:je.medicine_name||""}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-slate-700",children:je.qty}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-slate-700",children:Oa(je.amount)})]},ht))]})]})})}),n.jsxs("p",{className:"text-[10px] text-slate-500",children:["Use this summary while generating the final IPD discharge invoice in the main Billing module. Each contributing pharmacy bill ID is available in ",n.jsx("code",{children:"sale_ids"})," if needed."]})]})]})]}),n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(lC,{className:"w-4 h-4 text-slate-500"}),"Recent IPD Pharmacy Bills"]})}),n.jsx(it,{className:"pt-0",children:n.jsx("div",{className:"border border-slate-100 rounded-xl overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[420px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Bill"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Patient"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Status"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Amount"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Date"})]})}),n.jsxs("tbody",{children:[!oe.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"No IPD pharmacy bills found."})}),oe.map(je=>{var hs,Is;const ht=Number(je.total_amount??je.gross_total??je.net_amount??0),At=v5(je.status),ms=(je.bill_date||je.created_at||"").toString().slice(0,16).replace("T"," "),Zt=je.patient_name||`${((hs=je.patient)==null?void 0:hs.first_name)||""} ${((Is=je.patient)==null?void 0:Is.last_name)||""}`.trim()||"";return n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/60 cursor-pointer",onClick:()=>{const _s=je.id||je.invoice_id;_s&&y5(_s)},children:[n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsx("div",{className:"flex flex-col",children:n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:je.bill_number||je.invoice_number||`PB-${je.id}`})})}),n.jsx("td",{className:"px-3 py-2 align-top text-[11px] text-slate-700",children:Zt}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsx(j5,{status:At})}),n.jsx("td",{className:"px-3 py-2 align-top text-right text-[11px] text-slate-700",children:Oa(ht)}),n.jsx("td",{className:"px-3 py-2 align-top text-[11px] text-slate-700",children:ms||""})]},je.id)})]})]})})})})]})]})})]})]}),n.jsx(Wa,{open:E,onOpenChange:k,children:n.jsxs(va,{className:"max-w-md rounded-2xl",children:[n.jsxs(ii,{children:[n.jsxs(li,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(Qi,{className:"w-4 h-4 text-slate-600"}),"Collect Pharmacy Payment"]}),n.jsx(ch,{className:"text-xs text-slate-500",children:"Record payment for this pharmacy invoice. You can add multiple payments later (partial payments supported)."})]}),A&&n.jsxs("div",{className:"space-y-3 text-xs",children:[n.jsxs("div",{className:"border border-slate-100 rounded-xl p-3 bg-slate-50/60 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold text-slate-900",children:A.patient_name||`${((ze=A.patient)==null?void 0:ze.first_name)||""} ${((Te=A.patient)==null?void 0:Te.last_name)||""}`.trim()||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID:"," ",A.patient_uhid||((Nt=A.patient)==null?void 0:Nt.uhid)||""]})]}),n.jsxs("div",{className:"text-right text-[11px] text-slate-500",children:["Bill:"," ",A.bill_number||A.invoice_number||`PB-${A.id}`,n.jsx("br",{}),"Date:"," ",((ke=(Jt=A.bill_date||A.created_at||"")==null?void 0:Jt.toString())==null?void 0:ke.slice(0,10))||""]})]}),n.jsxs("div",{className:"flex items-center justify-between mt-1 pt-1 border-t border-dashed border-slate-500",children:[n.jsx("div",{className:"text-[11px] text-slate-600",children:"Total / Paid / Balance"}),n.jsxs("div",{className:"text-right text-[11px]",children:[n.jsx("div",{className:"text-slate-900",children:Oa(A.total_amount??A.gross_total??A.net_amount)}),n.jsx("div",{className:"text-emerald-700",children:Oa(A.paid_amount)}),n.jsx("div",{className:"text-rose-700",children:Oa(A.balance_amount??Number(A.total_amount??A.gross_total??A.net_amount??0)-Number(A.paid_amount??0))})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Payment mode"}),n.jsxs(Zs,{value:P,onValueChange:O,children:[n.jsx(Ws,{className:"w-full h-9 bg-white border-slate-500 rounded-full text-[11px]",children:n.jsx(Js,{placeholder:"Select mode"})}),n.jsx(qs,{children:gQe.map(je=>n.jsx(Ut,{value:je.value,children:je.label},je.value))})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx(xt,{className:"text-[11px] text-slate-600",children:"Amount"}),n.jsx(Ee,{type:"number",min:"0",value:D,onChange:je=>T(je.target.value),className:"h-9 text-xs bg-white border-slate-500 rounded-full"})]})]})]}),n.jsxs(Kc,{className:"mt-3",children:[n.jsx(ge,{variant:"outline",size:"sm",className:"h-8 px-3 rounded-full text-[11px]",onClick:()=>k(!1),children:"Cancel"}),n.jsx(ge,{size:"sm",className:"h-8 px-4 rounded-full text-[11px]",onClick:Ke,disabled:B,children:B?"Saving...":n.jsxs(n.Fragment,{children:[n.jsx(Xt,{className:"w-3 h-3 mr-1"}),"Save Payment"]})})]})]})})]})}function j5({status:t}){const s=(t||"").toUpperCase();let r=s||"",a="bg-slate-50 text-slate-700 border border-slate-500";return s==="UNPAID"||s==="PENDING"||s==="DRAFT"?(r="Unpaid",a="bg-amber-50 text-amber-700 border border-amber-200"):s==="PARTIAL"||s==="PARTIALLY_PAID"?(r="Partially paid",a="bg-blue-50 text-blue-700 border border-blue-200"):s==="PAID"?(r="Paid",a="bg-emerald-50 text-emerald-700 border border-emerald-200"):s==="CANCELLED"?(r="Cancelled",a="bg-rose-50 text-rose-700 border border-rose-200"):s==="FINALIZED"&&(r="Finalized",a="bg-slate-50 text-slate-700 border border-slate-300"),n.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-[10px] rounded-full ${a}`,children:r})}function yQe(t){if(!t)return"";const s=new Date(t);return`${s.toLocaleDateString()} ${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function vQe(){const[t,s]=p.useState(""),[r,a]=p.useState(""),[i,l]=p.useState(""),[o,c]=p.useState([]),[d,u]=p.useState(!1),m=async()=>{try{u(!0);const g={context_type:"pharmacy"};t&&(g.q=t),r&&(g.date_from=r),i&&(g.date_to=i);const y=await U_e(g);c(y.data||[])}catch{}finally{u(!1)}};p.useEffect(()=>{m()},[]);const x=o.reduce((g,y)=>g+(y.total_amount||0),0);return n.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-3 sm:space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(rb,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-base sm:text-lg font-semibold tracking-tight text-slate-900",children:"Pharmacy Counter Sales (OTC)"}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"View Pharmacy counter / OTC sales. (Future: add direct sale screen here.)"})]})]}),n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-2",children:n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),n.jsx(Ee,{placeholder:"UHID / Name / Phone",className:"pl-7 h-9 w-40 sm:w-52",value:t,onChange:g=>s(g.target.value)})]}),n.jsx(Ee,{type:"date",className:"h-9 w-32",value:r,onChange:g=>a(g.target.value)}),n.jsx(Ee,{type:"date",className:"h-9 w-32",value:i,onChange:g=>l(g.target.value)}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 text-xs",onClick:m,disabled:d,children:[d?n.jsx(Rt,{className:"mr-1 h-3.5 w-3.5 animate-spin"}):null,"Apply"]})]}),n.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Sales in view"," ",n.jsx(et,{variant:"secondary",className:"ml-1 h-5 px-2 text-[10px]",children:o.length})]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Net amount"," ",n.jsxs("span",{className:"font-semibold text-slate-900",children:["",x.toFixed(2)]})]})]})]})}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"border-t border-slate-100 mt-2 mb-2"}),n.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:n.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-100 text-[11px] uppercase tracking-wide text-slate-500",children:[n.jsx("th",{className:"py-2 pl-3 pr-2 text-left font-medium",children:"Sale"}),n.jsx("th",{className:"py-2 px-2 text-left font-medium",children:"Patient"}),n.jsx("th",{className:"py-2 px-2 text-right font-medium",children:"Amount"})]})}),n.jsxs("tbody",{children:[o.length===0&&!d&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"py-10 text-center text-xs text-slate-500",children:"No counter sales found."})}),d&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"py-8 text-center",children:n.jsx(Rt,{className:"mx-auto h-4 w-4 animate-spin text-slate-400"})})}),!d&&o.map(g=>n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/60",children:[n.jsx("td",{className:"py-2.5 pl-3 pr-2 align-top",children:n.jsxs("div",{className:"flex flex-col gap-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(rb,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsxs("span",{className:"font-medium text-[11px] text-slate-800",children:["Sale #",g.id]})]}),n.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[n.jsx(Na,{className:"h-3 w-3"}),n.jsx("span",{children:yQe(g.created_at)})]})]})}),n.jsxs("td",{className:"py-2.5 px-2 align-top",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(or,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:g.patient_name||""})]}),n.jsxs("div",{className:"mt-0.5 text-[10px] text-slate-500 flex flex-wrap gap-1",children:[g.patient_uhid&&n.jsx(et,{variant:"outline",className:"h-4 px-1.5 text-[9px]",children:g.patient_uhid}),g.payment_mode&&n.jsx("span",{className:"capitalize",children:g.payment_mode})]})]}),n.jsx("td",{className:"py-2.5 px-2 align-top text-right",children:n.jsxs("div",{className:"text-[11px] font-semibold text-slate-900",children:["",(g.total_amount||0).toFixed(2)]})})]},g.id))]})]})})]})]})]})}function jQe(t){if(!t)return"";const s=new Date(t);return`${s.toLocaleDateString()} ${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function NQe(){const[t,s]=p.useState(""),[r,a]=p.useState(""),[i,l]=p.useState(""),[o,c]=p.useState([]),[d,u]=p.useState(!1),m=async()=>{try{u(!0);const g={};t&&(g.q=t),r&&(g.date_from=r),i&&(g.date_to=i);const y=await V_e(g);c(y.data||[])}catch{}finally{u(!1)}};p.useEffect(()=>{m()},[]);const x=o.reduce((g,y)=>g+(y.total_amount||0),0);return n.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-3 sm:space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(cl,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-base sm:text-lg font-semibold tracking-tight text-slate-900",children:"Pharmacy Returns"}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"Shows Pharmacy bills treated as returns (negative amounts). Later you can connect this to a dedicated return workflow."})]})]}),n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-2",children:n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),n.jsx(Ee,{placeholder:"UHID / Name / Phone",className:"pl-7 h-9 w-40 sm:w-52",value:t,onChange:g=>s(g.target.value)})]}),n.jsx(Ee,{type:"date",className:"h-9 w-32",value:r,onChange:g=>a(g.target.value)}),n.jsx(Ee,{type:"date",className:"h-9 w-32",value:i,onChange:g=>l(g.target.value)}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 text-xs",onClick:m,disabled:d,children:[d?n.jsx(Rt,{className:"mr-1 h-3.5 w-3.5 animate-spin"}):null,"Apply"]})]}),n.jsxs("div",{className:"flex flex-col items-end gap-1 text-right",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Returns in view"," ",n.jsx(et,{variant:"secondary",className:"ml-1 h-5 px-2 text-[10px]",children:o.length})]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Total refund"," ",n.jsxs("span",{className:"font-semibold text-slate-900",children:["",x.toFixed(2)]})]})]})]})}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"border-t border-slate-100 mt-2 mb-2"}),n.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:n.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-100 text-[11px] uppercase tracking-wide text-slate-500",children:[n.jsx("th",{className:"py-2 pl-3 pr-2 text-left font-medium",children:"Return"}),n.jsx("th",{className:"py-2 px-2 text-left font-medium",children:"Patient"}),n.jsx("th",{className:"py-2 px-2 text-right font-medium",children:"Amount"})]})}),n.jsxs("tbody",{children:[o.length===0&&!d&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"py-10 text-center text-xs text-slate-500",children:"No Pharmacy returns detected (no negative Pharmacy bills)."})}),d&&n.jsx("tr",{children:n.jsx("td",{colSpan:3,className:"py-8 text-center",children:n.jsx(Rt,{className:"mx-auto h-4 w-4 animate-spin text-slate-400"})})}),!d&&o.map(g=>n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50/60",children:[n.jsx("td",{className:"py-2.5 pl-3 pr-2 align-top",children:n.jsxs("div",{className:"flex flex-col gap-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(cl,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsxs("span",{className:"font-medium text-[11px] text-slate-800",children:["Return #",g.id]})]}),n.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[n.jsx(Na,{className:"h-3 w-3"}),n.jsx("span",{children:jQe(g.created_at)})]})]})}),n.jsxs("td",{className:"py-2.5 px-2 align-top",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(or,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:g.patient_name||""})]}),n.jsx("div",{className:"mt-0.5 text-[10px] text-slate-500 flex flex-wrap gap-1",children:g.patient_uhid&&n.jsx(et,{variant:"outline",className:"h-4 px-1.5 text-[9px]",children:g.patient_uhid})})]}),n.jsx("td",{className:"py-2.5 px-2 align-top text-right",children:n.jsxs("div",{className:"text-[11px] font-semibold text-red-600",children:["",(g.total_amount||0).toFixed(2)]})})]},g.id))]})]})})]})]})]})}const wQe=[{value:"ALL",label:"All types"},{value:"OPD",label:"OPD"},{value:"IPD",label:"IPD"},{value:"OT",label:"OT"},{value:"COUNTER",label:"Counter"}],Gx="ALL_LOC",i$={BF:"Before food",AF:"After food",AC:"Before food",PC:"After food",HS:"Bedtime"};function YA(t){return String(t||"").toUpperCase()}function l$(t){if(!t)return"";const s=String(t);return s.includes("T")?s.slice(0,16).replace("T"," "):s.length>16?s.slice(0,16):s}function Zi(t,s=0){const r=Number(t);return Number.isFinite(r)?r:s}function Rv(t){if(!t)return null;const s=t==null?void 0:t.data;return s?(s==null?void 0:s.data)??s:null}function tp(t){var s,r;return console.log(t,"dkbksbdvk"),(t==null?void 0:t.patient_id)||(t==null?void 0:t.patientId)||((s=t==null?void 0:t.patient)==null?void 0:s.id)||((r=t==null?void 0:t.patient)==null?void 0:r.patient_id)||null}function Lv(t){const s=t==null?void 0:t.patient,r=(s==null?void 0:s.full_name)||(s==null?void 0:s.name)||[s==null?void 0:s.first_name,s==null?void 0:s.last_name].filter(Boolean).join(" ").trim(),a=(t==null?void 0:t.patient_name)||(t==null?void 0:t.patient_full_name)||(t==null?void 0:t.patient_display)||(t==null?void 0:t.patientName)||(t==null?void 0:t.patient_fullName)||r||[t==null?void 0:t.patient_first_name,t==null?void 0:t.patient_last_name].filter(Boolean).join(" ").trim();if(a)return a;const i=tp(t);return i?`Patient #${i}`:""}function N5(t){const s=t==null?void 0:t.patient;return(t==null?void 0:t.patient_uhid)||(t==null?void 0:t.uhid)||(t==null?void 0:t.patientUhid)||(s==null?void 0:s.uhid)||(s==null?void 0:s.patient_uid)||(s==null?void 0:s.mrn)||""}function w5(t){const s=t==null?void 0:t.doctor;return(t==null?void 0:t.doctor_name)||(t==null?void 0:t.doctor_display)||(t==null?void 0:t.doctorName)||(t==null?void 0:t.doctor)||(s==null?void 0:s.full_name)||(s==null?void 0:s.name)||""}function Fv(t){return(t==null?void 0:t.rx_number)||(t==null?void 0:t.prescription_number)||(t==null?void 0:t.prescriptionNumber)||`RX-${t==null?void 0:t.id}`}function G0(t){return(t==null?void 0:t.type)||(t==null?void 0:t.rx_type)||(t==null?void 0:t.rxType)||"OPD"}function Kx(t){return(t==null?void 0:t.id)??(t==null?void 0:t.line_id)??(t==null?void 0:t.rx_line_id)??(t==null?void 0:t.prescription_line_id)??null}function yne(t){var r,a,i,l;const s=(t==null?void 0:t.frequency_code)??(t==null?void 0:t.frequencyCode)??(t==null?void 0:t.frequency)??(t==null?void 0:t.freq)??((r=t==null?void 0:t.frequency_obj)==null?void 0:r.code)??((a=t==null?void 0:t.frequency_obj)==null?void 0:a.name)??((i=t==null?void 0:t.frequency)==null?void 0:i.code)??((l=t==null?void 0:t.frequency)==null?void 0:l.name)??"";return String(s||"").trim()}function _Qe(t){return(t==null?void 0:t.dose_text)??(t==null?void 0:t.doseText)??(t==null?void 0:t.dose)??""}function SQe(t){const s=Zi(t.requested_qty??t.total_qty??t.qty??t.quantity??0,0),r=Zi(t.dispensed_qty??0,0),a=Math.max(s-r,0);return{requested:s,dispensed:r,remaining:a}}function vne(t){const s=Zi((t==null?void 0:t.duration_days)||(t==null?void 0:t.durationDays)||0,0),r=yne(t),a=Zi((t==null?void 0:t.times_per_day)??(t==null?void 0:t.timesPerDay)??0,0);if(!s)return"";if(/^\d+\-\d+\-\d+$/.test(r)){const o=r.split("-").map(c=>Zi(c||0,0)).reduce((c,d)=>c+d,0);return o?o*s:""}const i=r.toUpperCase();return["OD","QD","DAILY"].includes(i)?1*s:["BD","BID","TWICE"].includes(i)?2*s:["TDS","TID","THRICE"].includes(i)?3*s:i==="HS"?1*s:["SOS","PRN"].includes(i)?"":i==="STAT"?1:a>0?a*s:""}function CQe(t,s){const r=String(t||"").trim().toUpperCase();if(/^\d+\-\d+\-\d+$/.test(r)){const[i,l,o]=r.split("-").map(c=>Zi(c,0));return{m:i,a:l,n:o,note:""}}if(["OD","QD","DAILY"].includes(r))return{m:1,a:0,n:0,note:""};if(["BD","BID","TWICE"].includes(r))return{m:1,a:0,n:1,note:""};if(["TDS","TID","THRICE"].includes(r))return{m:1,a:1,n:1,note:""};if(r==="HS")return{m:0,a:0,n:1,note:"HS"};if(["SOS","PRN"].includes(r))return{m:0,a:0,n:0,note:"PRN / SOS"};if(r==="STAT")return{m:1,a:0,n:0,note:"STAT"};const a=Zi(s,0);return a===1?{m:1,a:0,n:0,note:""}:a===2?{m:1,a:0,n:1,note:""}:a===3?{m:1,a:1,n:1,note:""}:a>3?{m:1,a:1,n:1,note:`${a} times/day`}:{m:0,a:0,n:0,note:""}}function jne(t){const s=String(t||"").trim().toUpperCase();return s?s.split(/[/,|\s-]+/).filter(Boolean):[]}function kQe(t,s,r,a){const i=jne(a),l={M:"",A:"",N:""};if(!i.length)return l;if(i.length===1)return{M:i[0],A:i[0],N:i[0]};const o=[];return t>0&&o.push("M"),s>0&&o.push("A"),r>0&&o.push("N"),o.forEach((c,d)=>{l[c]=i[d]||i[i.length-1]||""}),l}function AQe(t){const s=Zi((t==null?void 0:t.duration_days)??(t==null?void 0:t.durationDays),0);return s>0?`${s} day${s===1?"":"s"}`:t!=null&&t.duration?String(t.duration):""}function EQe({status:t}){const s=YA(t);let r=s||"",a="bg-slate-50 text-slate-700 border border-slate-500";return s==="PENDING"||s==="NEW"||s==="DRAFT"||s==="ISSUED"?(r=s==="DRAFT"?"Draft":"Pending",a="bg-amber-50 text-amber-700 border border-amber-200"):s==="PARTIAL"||s==="PARTIALLY_DISPENSED"?(r="Partial",a="bg-blue-50 text-blue-700 border border-blue-200"):s==="DISPENSED"||s==="COMPLETED"?(r="Dispensed",a="bg-emerald-50 text-emerald-700 border border-emerald-200"):s==="CANCELLED"&&(r="Cancelled",a="bg-rose-50 text-rose-700 border border-rose-200"),n.jsx("span",{className:`inline-flex items-center px-2 py-0.5 text-[10px] rounded-full ${a}`,children:r})}function Nne({line:t}){const s=_Qe(t),r=yne(t),a=(t==null?void 0:t.times_per_day)??(t==null?void 0:t.timesPerDay),{m:i,a:l,n:o,note:c}=CQe(r,a),d=kQe(i,l,o,t==null?void 0:t.timing),u=(i||l||o)>0,m=r?String(r):Number.isFinite(Number(a))&&Number(a)>0?`${a} times/day`:"",x=u?`M ${i}${d.M?` (${d.M})`:""}  A ${l}${d.A?` (${d.A})`:""}  N ${o}${d.N?` (${d.N})`:""}`:m,g=AQe(t),y=[];if(t!=null&&t.route&&y.push(t.route),t!=null&&t.timing){const j=jne(t.timing).map(w=>`${w}${i$[w]?`=${i$[w]}`:""}`).join(", ");y.push(j)}return c&&y.push(c),t!=null&&t.instructions&&y.push(t.instructions),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-slate-800",children:[s,x,g].filter(Boolean).join("  ")}),!!y.length&&n.jsx("span",{className:"text-[10px] text-slate-500",children:y.join("  ")})]})}function o$({line:t,idx:s,onChangeQty:r}){const a=(t==null?void 0:t.item_name)||(t==null?void 0:t.medicine_name)||"Unnamed medicine",i=(t==null?void 0:t.item_strength)||(t==null?void 0:t.strength)||"",l=(t==null?void 0:t.requested_qty)??(t==null?void 0:t.total_qty)??(t==null?void 0:t.qty)??(t==null?void 0:t.quantity)??vne(t)??"",o=Zi(t==null?void 0:t.remaining_calc,0);return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white p-3 space-y-2",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["#",s+1]}),n.jsx("div",{className:"font-medium text-slate-900 truncate",children:a}),!!i&&n.jsx("div",{className:"text-[10px] text-slate-500",children:i})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("div",{className:"text-[10px] text-slate-500",children:"Remaining"}),n.jsx("div",{className:"text-[11px] font-semibold text-slate-800",children:Number.isFinite(o)?o:""})]})]}),n.jsx("div",{className:"text-[11px] text-slate-700",children:n.jsx(Nne,{line:t})}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{className:"rounded-xl border border-slate-500 bg-slate-50 px-3 py-2",children:[n.jsx("div",{className:"text-[10px] text-slate-500",children:"Prescribed"}),n.jsx("div",{className:"text-[11px] font-semibold text-slate-800",children:String(l)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-500 bg-white px-3 py-2",children:[n.jsx("div",{className:"text-[10px] text-slate-500",children:"Dispense"}),n.jsx(Ee,{type:"number",min:"0",value:(t==null?void 0:t.dispense_qty)??"",onChange:c=>r(s,c.target.value),className:"mt-1 h-8 text-[11px] text-right bg-white border-slate-500 rounded-full"})]})]})]})}function TQe(){const[t,s]=p.useState("queue"),[r,a]=p.useState("ALL"),[i,l]=p.useState("PENDING"),[o,c]=p.useState(""),[d,u]=p.useState(!1),[m,x]=p.useState([]),[g,y]=p.useState(!1),[v,j]=p.useState(null),[w,S]=p.useState([]),[E,k]=p.useState(!1),[A,I]=p.useState([]),[P,O]=p.useState(Gx),[D,T]=p.useState(""),[B,U]=p.useState(!1),W=p.useRef({}),V=p.useCallback(async ne=>{const q=Number(ne||0);if(!q)return null;if(W.current[q])return W.current[q];try{const ee=await Gse(q),X=Rv(ee),Z=(X==null?void 0:X.patient)??X??null;return Z&&(W.current[q]=Z),Z}catch(ee){return console.error("loadPatient error",ee),null}},[]),R=p.useCallback(async ne=>{try{const q=Array.isArray(ne)?ne:[],ee=q.slice(0,25).filter(Z=>!(Z!=null&&Z.patient)&&tp(Z)).map(Z=>Number(tp(Z))).filter(Boolean),X=[...new Set(ee)].slice(0,15);if(!X.length)return q;for(const Z of X)await V(Z);return q.map(Z=>{if(Z!=null&&Z.patient)return Z;const Y=Number(tp(Z)||0);if(!Y)return Z;const Q=W.current[Y];return Q?{...Z,patient:Q,patient_id:Y}:Z})}catch(q){return console.error("hydrateQueuePatients error",q),ne}},[V]);p.useEffect(()=>{let ne=!0;return(async()=>{try{const q=await z2(),ee=Rv(q)||[];if(!ne)return;I(ee),P||O(Gx)}catch{}})(),()=>{ne=!1}},[]);const F=p.useCallback(ne=>{if(!(A!=null&&A.length))return"No locations";if(!ne||ne===Gx)return"All / Not linked";const q=Number(ne),ee=A.find(X=>X.id===q);return(ee==null?void 0:ee.name)||(ee==null?void 0:ee.code)||`Location #${q}`},[A]),G=p.useMemo(()=>F(P),[P,F]),H=p.useMemo(()=>D?F(D):"Not selected",[D,F]),$=p.useCallback(async()=>{try{u(!0);const ne={status:i==="ALL"?void 0:i,type:r==="ALL"?void 0:r,limit:100};o.trim()&&(ne.q=o.trim()),P&&P!==Gx&&(ne.location_id=Number(P));const q=await rQe(ne),ee=Rv(q)||[],X=await R(ee);x(X||[])}finally{u(!1)}},[i,r,o,P,R]);p.useEffect(()=>{$()},[$]);async function K(ne,{openPreview:q=!0}={}){try{y(!0);const ee=await fne(ne.id);let X=Rv(ee)||ne;const Z=tp(X)||tp(ne);if(!X.patient&&Z){const oe=await V(Z);oe&&(X={...X,patient:oe,patient_id:Z})}if(j(X),!D){const oe=X==null?void 0:X.location_id;T(oe?String(oe):"")}const Q=((X==null?void 0:X.lines)||(X==null?void 0:X.items)||[]).map(oe=>{const{requested:_e,remaining:xe}=SQe(oe),me=vne(oe),Re=xe>0?xe:_e>0?_e:me!==""?me:"";return{...oe,id:Kx(oe)??(oe==null?void 0:oe.id),requested_qty:_e,remaining_calc:xe,dispense_qty:Re!==""&&Number(Re)>0?String(Re):""}});S(Q),q&&U(!0)}catch(ee){console.error("Select Rx error",ee),ae.error("Failed to open prescription")}finally{y(!1)}}function le(ne,q){const ee=q===""?"":String(q);S(X=>X.map((Z,Y)=>Y===ne?{...Z,dispense_qty:ee}:Z))}function se(){S(ne=>(ne||[]).map(q=>{const ee=Zi(q==null?void 0:q.remaining_calc,0),X=Zi(q==null?void 0:q.requested_qty,0),Z=ee>0?ee:X;return{...q,dispense_qty:Z>0?String(Z):""}}))}function J(){S(ne=>(ne||[]).map(q=>({...q,dispense_qty:""})))}async function ie(){var Z,Y;if(!v)return;const ne=D?Number(D):null;if(!ne){ae.error("Select Dispense Location before confirming.");return}const q=(w||[]).filter(Q=>Zi((Q==null?void 0:Q.dispense_qty)||0,0)>0);if(!q.length){ae.error("Enter quantity to dispense for at least one line");return}const ee=q.find(Q=>!Kx(Q));if(ee){ae.error("Some lines are missing line_id (cannot dispense). Refresh Rx and try again."),console.error("Bad line (missing id):",ee);return}const X={lines:q.map(Q=>({line_id:Number(Kx(Q)),dispense_qty:Zi((Q==null?void 0:Q.dispense_qty)||0,0)})),location_id:ne,create_sale:!0,context_type:YA(G0(v))};console.log(v,"selectedRx"),console.log(X,"handleDispense payload");try{k(!0),await nQe(v.id,X),ae.success("Dispense recorded"),await $(),U(!1),j(null),S([]),s("queue")}catch(Q){console.error("Dispense error",Q);const oe=(Y=(Z=Q==null?void 0:Q.response)==null?void 0:Z.data)==null?void 0:Y.detail;typeof oe=="string"?ae.error(oe):oe!=null&&oe.message?ae.error(oe.message):ae.error("Dispense failed")}finally{k(!1)}}const te=p.useMemo(()=>w||[],[w]);return n.jsxs("div",{className:"p-4 md:p-6 space-y-4",children:[n.jsx("div",{className:"rounded-3xl border border-slate-500 bg-white shadow-sm p-4 md:p-5",children:n.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"inline-flex items-center gap-2",children:[n.jsx("div",{className:"h-9 w-9 rounded-2xl bg-white border border-slate-500 shadow-sm flex items-center justify-center",children:n.jsx(rr,{className:"h-4 w-4 text-slate-700"})}),n.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-slate-900",children:"Pharmacy Dispense"})]}),n.jsx("p",{className:"text-sm text-slate-500",children:"Queue  Preview  Dispense (Queue location filter and Dispense location are separate)."})]}),n.jsxs("div",{className:"grid gap-2 md:grid-cols-2 md:items-end",children:[n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white p-2.5",children:n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[n.jsx(sb,{className:"h-4 w-4 text-slate-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Queue location"}),n.jsx("div",{className:"text-[11px] font-medium text-slate-800",children:G})]})]}),n.jsxs(Zs,{value:P,onValueChange:ne=>O(ne||Gx),children:[n.jsx(Ws,{className:"w-[190px] bg-white border-slate-500 rounded-full h-8 text-[11px]",children:n.jsx(Js,{placeholder:"Queue location"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:Gx,children:"All / Not linked"}),A.map(ne=>n.jsx(Ut,{value:String(ne.id),children:ne.name||ne.code||`Location #${ne.id}`},ne.id))]})]})]})}),n.jsx("div",{className:"rounded-2xl border border-slate-500 bg-white p-2.5",children:n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[n.jsx(sb,{className:"h-4 w-4 text-slate-500"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Dispense location"}),n.jsx("div",{className:"text-[11px] font-medium text-slate-800",children:H})]})]}),n.jsxs(Zs,{value:D||"",onValueChange:ne=>T(ne||""),children:[n.jsx(Ws,{className:"w-[190px] bg-white border-slate-500 rounded-full h-8 text-[11px]",children:n.jsx(Js,{placeholder:"Select dispense location"})}),n.jsx(qs,{children:A.map(ne=>n.jsx(Ut,{value:String(ne.id),children:ne.name||ne.code||`Location #${ne.id}`},ne.id))})]})]})}),n.jsx("div",{className:"md:col-span-2 flex items-center justify-end gap-2",children:n.jsxs(ge,{variant:"outline",size:"sm",className:"h-9 rounded-full border-slate-500",onClick:$,children:[n.jsx(ps,{className:"h-4 w-4 mr-1"}),"Refresh"]})})]})]})}),n.jsxs(Do,{value:t,onValueChange:s,children:[n.jsxs(Wl,{className:"rounded-full bg-white border border-slate-500 p-1",children:[n.jsx(zs,{value:"queue",className:"rounded-full",children:"Dispense Queue"}),n.jsx(zs,{value:"dispense",disabled:!v,className:"rounded-full",children:"Dispense"})]}),n.jsxs(Ls,{value:"queue",className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1.25fr)_minmax(0,1.75fr)]",children:[n.jsxs(dt,{className:"border-slate-500 rounded-3xl shadow-sm overflow-hidden bg-white",children:[n.jsxs(gt,{className:"pb-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(Pr,{className:"w-4 h-4 text-slate-500"}),"Prescriptions",n.jsx(et,{variant:"outline",className:"rounded-full text-[10px] border-slate-500",children:d?"...":m.length})]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Filtered by: ",n.jsx("span",{className:"font-medium text-slate-700",children:G})]})]}),n.jsx(ge,{variant:"outline",size:"icon",className:"h-8 w-8 rounded-full border-slate-500",onClick:$,title:"Refresh",children:n.jsx(jr,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"mt-3 space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Yt,{className:"w-4 h-4 text-slate-400 absolute left-3 top-2.5"}),n.jsx(Ee,{value:o,onChange:ne=>c(ne.target.value),onKeyDown:ne=>{ne.key==="Enter"&&$()},placeholder:"Search UHID / patient / Rx no...",className:"pl-9 h-9 text-xs bg-white border-slate-500 rounded-full"})]}),n.jsx(ge,{variant:"outline",className:"h-9 rounded-full text-xs border-slate-500",onClick:$,children:"Search"})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[n.jsxs(Zs,{value:r,onValueChange:a,children:[n.jsx(Ws,{className:"w-[140px] bg-white border-slate-500 rounded-full h-8 text-[11px]",children:n.jsx(Js,{placeholder:"Type"})}),n.jsx(qs,{children:wQe.map(ne=>n.jsx(Ut,{value:ne.value,children:ne.label},ne.value))})]}),n.jsxs(Zs,{value:i,onValueChange:l,children:[n.jsx(Ws,{className:"w-[160px] bg-white border-slate-500 rounded-full h-8 text-[11px]",children:n.jsx(Js,{placeholder:"Status"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"PENDING",children:"Pending only"}),n.jsx(Ut,{value:"PARTIAL",children:"Partial"}),n.jsx(Ut,{value:"DISPENSED",children:"Dispensed"}),n.jsx(Ut,{value:"ALL",children:"All status"})]})]}),n.jsxs(et,{variant:"outline",className:"border-slate-500 text-[10px] px-2 py-1 rounded-full",children:["Dispense at: ",n.jsx("span",{className:"ml-1 text-slate-700 font-medium",children:H})]})]})]})]}),n.jsx(it,{className:"pt-0",children:n.jsx("div",{className:"border border-slate-500 rounded-2xl overflow-hidden bg-white",children:n.jsx(Fn,{className:"max-h-[520px]",children:n.jsxs("table",{className:"w-full text-xs",children:[n.jsx("thead",{className:"bg-slate-50/80 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-[11px] text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Rx"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Patient"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Type / Doctor"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Items"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Time"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Status"})]})}),n.jsxs("tbody",{children:[d&&n.jsxs(n.Fragment,{children:[n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-3",children:n.jsx(Qe,{className:"h-10 w-full rounded-xl"})})}),n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-3",children:n.jsx(Qe,{className:"h-10 w-full rounded-xl"})})})]}),!d&&!m.length&&n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-3 py-6 text-center text-[11px] text-slate-500",children:"No prescriptions found."})}),!d&&m.map(ne=>{var _e,xe;const q=YA(ne.status||"PENDING"),ee=ne.created_at||ne.rx_datetime||ne.bill_date||null,X=l$(ee),Z=Lv(ne),Y=N5(ne),Q=w5(ne),oe=((_e=ne.items)==null?void 0:_e.length)||((xe=ne.lines)==null?void 0:xe.length)||ne.item_count||"";return n.jsxs("tr",{className:"border-t border-slate-500 hover:bg-slate-50 cursor-pointer",onClick:()=>K(ne,{openPreview:!0}),children:[n.jsx("td",{className:"px-3 py-2 align-middle",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-[11px] font-medium text-slate-900",children:Fv(ne)}),!!Y&&n.jsxs("span",{className:"text-[10px] text-slate-500",children:["UHID: ",Y]})]})}),n.jsx("td",{className:"px-3 py-2 align-middle",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 rounded-2xl bg-white border border-slate-500 flex items-center justify-center",children:n.jsx(or,{className:"w-4 h-4 text-slate-600"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-[11px] text-slate-900 truncate",children:Z}),!!Y&&n.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:Y})]})]})}),n.jsx("td",{className:"px-3 py-2 align-middle",children:n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx(et,{variant:"outline",className:"border-slate-500 text-[10px] px-2 py-0.5 rounded-full w-max",children:G0(ne)}),!!Q&&n.jsxs("span",{className:"text-[10px] text-slate-500 flex items-center gap-1",children:[n.jsx(Hs,{className:"w-3 h-3"}),Q]})]})}),n.jsx("td",{className:"px-3 py-2 align-middle text-[11px] text-slate-700",children:oe}),n.jsx("td",{className:"px-3 py-2 align-middle text-[11px] text-slate-700",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Na,{className:"w-3 h-3 text-slate-400"}),n.jsx("span",{children:X})]})}),n.jsx("td",{className:"px-3 py-2 align-middle text-right",children:n.jsx(EQe,{status:q})})]},ne.id)})]})]})})})})]}),n.jsxs(dt,{className:"border-slate-500 rounded-3xl shadow-sm overflow-hidden bg-white",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(rr,{className:"w-4 h-4 text-slate-500"}),"Selected Prescription"]})}),n.jsx(it,{className:"space-y-3",children:v?g?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-16 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-28 w-full rounded-2xl"})]}):n.jsxs("div",{className:"space-y-3 text-xs",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white p-3",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:Lv(v)}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID: ",N5(v)||""]})]}),n.jsxs("div",{className:"text-right text-[11px] text-slate-500 shrink-0",children:[n.jsxs("div",{children:["Rx: ",Fv(v)]}),n.jsxs("div",{children:["Type: ",G0(v)]})]})]}),n.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Items:"," ",n.jsx("span",{className:"font-medium text-slate-700",children:(v.lines||v.items||[]).length||0})]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Doctor:"," ",n.jsx("span",{className:"font-medium text-slate-700",children:w5(v)||""})]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(ge,{size:"sm",className:"h-9 rounded-full gap-1",onClick:()=>U(!0),children:[n.jsx(Ki,{className:"h-4 w-4"}),"Preview"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 rounded-full gap-1 border-slate-500",onClick:()=>(v==null?void 0:v.id)&&u5(v.id),children:[n.jsx(Xn,{className:"h-4 w-4"}),"Rx PDF"]}),n.jsx(ge,{size:"sm",variant:"outline",className:"h-9 rounded-full border-slate-500",onClick:()=>{s("dispense"),U(!1)},children:"Open Dispense"}),n.jsx(ge,{size:"sm",variant:"ghost",className:"h-9 rounded-full",onClick:()=>{j(null),S([]),U(!1)},children:"Clear"})]})]}):n.jsx("div",{className:"py-10 text-center text-xs text-slate-500",children:"Select a prescription from the queue to preview."})})]})]}),n.jsx(Wa,{open:B,onOpenChange:U,children:n.jsxs(va,{className:"sm:max-w-4xl w-[calc(100vw-22px)] rounded-3xl bg-white border-slate-500 max-h-[85vh] overflow-y-auto",children:[n.jsx(ii,{children:n.jsxs(li,{className:"flex items-center justify-between gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-9 w-9 rounded-2xl bg-white border border-slate-500 shadow-sm flex items-center justify-center",children:n.jsx(rr,{className:"h-4 w-4 text-slate-700"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Prescription Preview"}),n.jsx("div",{className:"text-[11px] text-slate-500",children:v?`${Fv(v)}  ${G0(v)}`:""})]})]}),n.jsx(ge,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>U(!1),title:"Close",children:n.jsx(ts,{className:"h-4 w-4"})})]})}),v?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-2 md:grid-cols-3",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Patient"}),n.jsx("div",{className:"mt-1 font-semibold text-slate-900",children:Lv(v)}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["UHID: ",N5(v)||""]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Doctor"}),n.jsx("div",{className:"mt-1 font-semibold text-slate-900",children:w5(v)||""}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Created: ",l$(v.created_at||v.rx_datetime)]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Dispense location"}),n.jsx("div",{className:"mt-1 font-semibold text-slate-900",children:H})]})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white overflow-hidden",children:[n.jsxs("div",{className:"px-3 py-2 bg-slate-50 text-xs font-semibold text-slate-600 flex items-center justify-between",children:[n.jsx("span",{children:"Medicines"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-8 rounded-full border-slate-500 text-xs",onClick:se,children:[n.jsx(R3,{className:"h-4 w-4 mr-1"}),"Fill remaining"]}),n.jsx(ge,{size:"sm",variant:"outline",className:"h-8 rounded-full border-slate-500 text-xs",onClick:J,children:"Clear"})]})]}),n.jsx("div",{className:"p-3 space-y-2 md:hidden",children:te.length===0?n.jsx("div",{className:"py-6 text-center text-slate-500 text-sm",children:"No lines found."}):te.map((ne,q)=>n.jsx(o$,{line:ne,idx:q,onChangeQty:le},Kx(ne)||q))}),n.jsx("div",{className:"hidden md:block max-h-[420px] overflow-auto",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50 sticky top-0 z-10",children:n.jsxs("tr",{className:"text-slate-500",children:[n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"#"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Medicine"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Instructions"}),n.jsx("th",{className:"text-left px-3 py-2 font-medium",children:"Remaining"}),n.jsx("th",{className:"text-right px-3 py-2 font-medium",children:"Dispense"})]})}),n.jsx("tbody",{children:te.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"px-3 py-6 text-center text-slate-500",children:"No lines found."})}):te.map((ne,q)=>n.jsxs("tr",{className:"border-t border-slate-500",children:[n.jsx("td",{className:"px-3 py-2 align-top text-slate-500",children:q+1}),n.jsx("td",{className:"px-3 py-2 align-top",children:n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"font-medium text-slate-900",children:ne.item_name||ne.medicine_name||"Unnamed medicine"}),(ne.item_strength||ne.strength)&&n.jsx("span",{className:"text-[10px] text-slate-500",children:ne.item_strength||ne.strength})]})}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:n.jsx(Nne,{line:ne})}),n.jsx("td",{className:"px-3 py-2 align-top text-slate-700",children:Zi(ne.remaining_calc,0)}),n.jsx("td",{className:"px-3 py-2 align-top text-right",children:n.jsx(Ee,{type:"number",min:"0",value:ne.dispense_qty??"",onChange:ee=>le(q,ee.target.value),className:"h-8 w-24 ml-auto text-[11px] text-right bg-white border-slate-500 rounded-full"})})]},Kx(ne)||q))})]})})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsxs(ge,{variant:"outline",className:"h-9 rounded-full border-slate-500",onClick:()=>u5(v.id),children:[n.jsx(Xn,{className:"h-4 w-4 mr-1"}),"Rx PDF"]}),n.jsxs(ge,{className:"h-9 rounded-full",onClick:()=>{s("dispense"),U(!1)},children:[n.jsx(Ki,{className:"h-4 w-4 mr-1"}),"Go to Dispense"]})]})]}):n.jsx("div",{className:"py-10 text-center text-sm text-slate-500",children:"No prescription selected."})]})})]}),n.jsx(Ls,{value:"dispense",children:v?n.jsxs(dt,{className:"border-slate-500 rounded-3xl shadow-sm bg-white overflow-hidden",children:[n.jsxs(gt,{className:"pb-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs(jt,{className:"text-sm font-semibold flex items-center gap-2",children:[n.jsx(Xt,{className:"w-4 h-4 text-emerald-600"}),"Dispense Medicines"]}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Rx: ",n.jsx("span",{className:"font-medium text-slate-700",children:Fv(v)}),"  Type: ",n.jsx("span",{className:"font-medium text-slate-700",children:G0(v)}),"  Patient: ",n.jsx("span",{className:"font-medium text-slate-700",children:Lv(v)}),n.jsx("br",{}),"Queue filter: ",n.jsx("span",{className:"font-medium text-slate-700",children:G}),"  Dispense at: ",n.jsx("span",{className:"font-medium text-slate-700",children:H})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs(ge,{variant:"outline",size:"sm",className:"h-9 px-4 rounded-full border-slate-500",onClick:()=>u5(v.id),children:[n.jsx(Xn,{className:"w-4 h-4 mr-1"}),"Rx PDF"]}),n.jsxs(ge,{variant:"outline",size:"sm",className:"h-9 px-4 rounded-full border-slate-500",onClick:se,children:[n.jsx(R3,{className:"w-4 h-4 mr-1"}),"Fill remaining"]}),n.jsx(ge,{variant:"outline",size:"sm",className:"h-9 px-4 rounded-full border-slate-500",onClick:J,children:"Clear"}),n.jsx(ge,{variant:"ghost",size:"sm",className:"h-9 px-4 rounded-full",onClick:()=>s("queue"),children:"Back"})]})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsx("div",{className:"md:hidden space-y-2",children:te.length===0?n.jsx("div",{className:"py-6 text-center text-slate-500 text-sm",children:"No lines found."}):te.map((ne,q)=>n.jsx(o$,{line:ne,idx:q,onChangeQty:le},Kx(ne)||q))}),n.jsxs("div",{className:"sticky bottom-0 bg-white border border-slate-500 rounded-2xl p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Dispense at:"," ",n.jsx("span",{className:"font-medium text-slate-700",children:H}),D?null:n.jsx("span",{className:"ml-2 text-amber-700",children:" Select location to continue"})]}),n.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[n.jsx(ge,{size:"sm",variant:"outline",className:"h-9 rounded-full border-slate-500",onClick:()=>U(!0),children:"Preview"}),n.jsx(ge,{size:"sm",className:"h-9 rounded-full px-4",onClick:ie,disabled:E,children:E?"Dispensing...":n.jsxs(n.Fragment,{children:[n.jsx(Xt,{className:"w-4 h-4 mr-1"}),"Confirm Dispense"]})})]})]})]})]}):n.jsx(dt,{className:"border-slate-500 rounded-3xl shadow-sm bg-white",children:n.jsx(it,{className:"py-10 text-center text-sm text-slate-500",children:"Select a prescription from the queue first."})})})]})]})}function _5(t){if(!t)return"";const s=new Date(t);return`${s.toLocaleDateString()} ${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function PQe(t){switch(t){case"ISSUED":return{label:"Issued",className:"bg-amber-50 text-amber-700 border border-amber-100",icon:Vs};case"PARTIALLY_DISPENSED":return{label:"Partial",className:"bg-blue-50 text-blue-700 border border-blue-100",icon:Vs};case"DISPENSED":return{label:"Dispensed",className:"bg-emerald-50 text-emerald-700 border border-emerald-100",icon:Xt};case"CANCELLED":return{label:"Cancelled",className:"bg-red-50 text-red-700 border border-red-100",icon:ca};default:return{label:t||"Unknown",className:"bg-slate-50 text-slate-700 border border-slate-100",icon:Vs}}}function DQe(){const[t,s]=p.useState("ALL"),[r,a]=p.useState("ACTIVE"),[i,l]=p.useState("all"),[o,c]=p.useState(""),[d,u]=p.useState(""),[m,x]=p.useState(""),[g,y]=p.useState([]),[v,j]=p.useState([]),[w,S]=p.useState(!1),[E,k]=p.useState(null),[A,I]=p.useState(null),[P,O]=p.useState(null);p.useEffect(()=>{z2().then(R=>{const F=R.data||[];y(F)}).catch(()=>{y([])})},[]);const D=async()=>{try{S(!0);const R={};t!=="ALL"&&(R.type=t),(r==="ISSUED"||r==="PARTIALLY_DISPENSED"||r==="DISPENSED"||r==="CANCELLED")&&(R.status=r),o.trim()&&(R.patient_id=o.trim()),d&&(R.from_date=d),m&&(R.to_date=m);const F=await CK(R);j(F.data||[])}catch{}finally{S(!1)}};p.useEffect(()=>{D()},[t,r]);const T=p.useMemo(()=>{let R=v||[];return r==="ACTIVE"&&(R=R.filter(F=>F.status==="ISSUED"||F.status==="PARTIALLY_DISPENSED")),i!=="all"&&(R=R.filter(F=>String(F.location_id)===String(i))),R},[v,r,i]);p.useEffect(()=>{if(!T.length){k(null);return}(!E||!T.some(R=>R.id===E))&&k(T[0].id)},[T,E]);const B=p.useMemo(()=>T.find(R=>R.id===E)||null,[T,E]),U=p.useMemo(()=>{const R=T.length,F=T.filter(H=>H.status==="ISSUED"||H.status==="PARTIALLY_DISPENSED").length,G=T.filter(H=>H.status==="DISPENSED").length;return{total:R,active:F,completed:G}},[T]),W=async R=>{if(!R)return;const G=(R.lines||[]).filter(H=>H.status==="WAITING"||H.status==="PARTIAL"||H.status==="PARTIALLY_DISPENSED").map(H=>{const $=Number(H.requested_qty||0),K=Number(H.dispensed_qty||0),le=$-K;return{line_id:H.id,quantity:le}}).filter(H=>H.quantity>0);if(!G.length){ae.info("No pending quantity to dispense for this prescription");return}if(window.confirm(`Dispense all remaining quantities (${G.length} line(s)) for Rx #${R.prescription_number||R.id}?`))try{I(R.id),await $_e(R.id,{lines:G,remark:"Quick dispense all remaining from Rx Explorer"}),ae.success("Prescription dispensed (remaining quantities)"),await D()}catch{}finally{I(null)}},V=async R=>{if(R&&window.confirm(`Generate Pharmacy bill from dispensed lines for Rx #${R.prescription_number||R.id}?`))try{O(R.id);const G=(await z_e(R.id)).data;ae.success(`Pharmacy bill created: ${G.bill_number} (Net ${G.net_amount})`)}catch{}finally{O(null)}};return n.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-3 sm:space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(rr,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-base sm:text-lg font-semibold tracking-tight text-slate-900",children:"Pharmacy Rx Explorer (Inventory)"}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"View, filter, and dispense inventory-integrated prescriptions across OPD/IPD/Counter. Uses FEFO batches and auto-billing."})]})]}),n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-2",children:n.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),n.jsx(Ee,{placeholder:"Patient ID (optional)",className:"pl-7 h-9 w-36 sm:w-40",value:o,onChange:R=>c(R.target.value)})]}),n.jsx(Ee,{type:"date",className:"h-9 w-32",value:d,onChange:R=>u(R.target.value)}),n.jsx(Ee,{type:"date",className:"h-9 w-32",value:m,onChange:R=>x(R.target.value)}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 text-xs",onClick:D,disabled:w,children:[w?n.jsx(Rt,{className:"mr-1 h-3.5 w-3.5 animate-spin"}):n.jsx(ps,{className:"mr-1 h-3.5 w-3.5"}),"Apply"]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-end text-[11px] text-slate-500",children:[n.jsxs("div",{children:["Total"," ",n.jsx(et,{variant:"secondary",className:"h-5 px-2 text-[10px]",children:U.total})]}),n.jsxs("div",{children:["Active"," ",n.jsx(et,{variant:"outline",className:"h-5 px-2 text-[10px]",children:U.active})]}),n.jsxs("div",{children:["Dispensed"," ",n.jsx(et,{variant:"outline",className:"h-5 px-2 text-[10px]",children:U.completed})]})]})]}),n.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Do,{value:t,onValueChange:s,className:"hidden sm:block",children:n.jsxs(Wl,{className:"h-8",children:[n.jsx(zs,{value:"ALL",className:"text-[11px]",children:"All"}),n.jsx(zs,{value:"OPD",className:"text-[11px]",children:"OPD"}),n.jsx(zs,{value:"IPD",className:"text-[11px]",children:"IPD"}),n.jsx(zs,{value:"GENERAL",className:"text-[11px]",children:"General"})]})}),n.jsx("div",{className:"sm:hidden flex gap-1 text-[11px]",children:["ALL","OPD","IPD","GENERAL"].map(R=>n.jsx(et,{variant:t===R?"default":"outline",className:"cursor-pointer",onClick:()=>s(R),children:R},R))}),n.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-[11px]",children:[n.jsx(et,{variant:r==="ACTIVE"?"default":"outline",className:"cursor-pointer",onClick:()=>a("ACTIVE"),children:"Active"}),n.jsx(et,{variant:r==="ALL"?"default":"outline",className:"cursor-pointer",onClick:()=>a("ALL"),children:"All"}),n.jsx(et,{variant:r==="ISSUED"?"default":"outline",className:"cursor-pointer",onClick:()=>a("ISSUED"),children:"Issued"}),n.jsx(et,{variant:r==="PARTIALLY_DISPENSED"?"default":"outline",className:"cursor-pointer",onClick:()=>a("PARTIALLY_DISPENSED"),children:"Partial"}),n.jsx(et,{variant:r==="DISPENSED"?"default":"outline",className:"cursor-pointer",onClick:()=>a("DISPENSED"),children:"Dispensed"}),n.jsx(et,{variant:r==="CANCELLED"?"default":"outline",className:"cursor-pointer",onClick:()=>a("CANCELLED"),children:"Cancelled"})]})]}),n.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[n.jsxs("span",{className:"text-[11px] text-slate-500 flex items-center gap-1",children:[n.jsx(sb,{className:"h-3 w-3"}),"Location"]}),n.jsxs("select",{className:"h-8 rounded-xl border border-slate-500 bg-white px-2 text-[11px] text-slate-700",value:i,onChange:R=>l(R.target.value),children:[n.jsx("option",{value:"all",children:"All locations"}),g.map(R=>n.jsx("option",{value:R.id,children:R.name},R.id))]})]})]})]})}),n.jsxs(it,{className:"pt-0",children:[n.jsx("div",{className:"border-t border-slate-100 mt-2 mb-2"}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(0,1.3fr)_minmax(0,2fr)] gap-3 lg:gap-4",children:[n.jsxs("div",{className:"border border-slate-100 rounded-2xl bg-slate-50/60 overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-3 py-2 border-b border-slate-100 flex items-center justify-between",children:[n.jsxs("span",{className:"text-[11px] font-semibold text-slate-700 flex items-center gap-1",children:[n.jsx(rr,{className:"h-3.5 w-3.5 text-slate-500"}),"Prescriptions"]}),n.jsxs("span",{className:"text-[11px] text-slate-500",children:[T.length," in view"]})]}),w&&n.jsx("div",{className:"flex-1 flex items-center justify-center py-10",children:n.jsx(Rt,{className:"h-5 w-5 animate-spin text-slate-400"})}),!w&&T.length===0&&n.jsx("div",{className:"flex-1 flex items-center justify-center py-10",children:n.jsx("p",{className:"text-xs text-slate-500",children:"No prescriptions found for this filter."})}),!w&&T.length>0&&n.jsx("div",{className:"flex-1 overflow-y-auto max-h-[520px]",children:T.map(R=>{var $;const F=PQe(R.status),G=R.id===E,H=R.status==="ISSUED"||R.status==="PARTIALLY_DISPENSED";return n.jsxs("button",{type:"button",onClick:()=>k(R.id),className:["w-full text-left px-3 py-2.5 border-b border-slate-100","flex flex-col gap-1.5 hover:bg-slate-100/70",G?"bg-slate-100/80":""].filter(Boolean).join(" "),children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-900",children:R.prescription_number||`Rx #${R.id}`}),n.jsx(et,{variant:"outline",className:"h-4 px-1.5 text-[9px]",children:R.type||""}),H&&n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-emerald-500 animate-pulse"})]}),n.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[n.jsx(Na,{className:"h-3 w-3"}),n.jsx("span",{children:_5(R.created_at)})]})]}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[n.jsxs("div",{className:["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px]",F.className].join(" "),children:[n.jsx(F.icon,{className:"h-3 w-3"}),n.jsx("span",{children:F.label})]}),n.jsxs("div",{className:"text-[10px] text-slate-500 flex items-center gap-1",children:[n.jsx(Xa,{className:"h-3 w-3"}),n.jsx("span",{children:R.location_name||""})]})]})]}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[n.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-700",children:[n.jsx(or,{className:"h-3 w-3 text-slate-400"}),n.jsx("span",{children:R.patient_name||""})]}),R.doctor_name&&n.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[n.jsx(Hs,{className:"h-3 w-3 text-slate-400"}),n.jsx("span",{children:R.doctor_name})]})]}),n.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[10px] text-slate-500",children:[n.jsxs("span",{children:[(($=R.lines)==null?void 0:$.length)||0," item(s)"]}),R.status==="DISPENSED"&&n.jsx("span",{children:" Fully dispensed"})]})]},R.id)})})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-3 sm:p-4 flex flex-col min-h-[260px]",children:[!B&&n.jsx("div",{className:"flex-1 flex items-center justify-center",children:n.jsx("p",{className:"text-xs text-slate-500",children:"Select a prescription from the left to view details."})}),B&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-sm font-semibold text-slate-900",children:["Rx ",B.prescription_number||`#${B.id}`]}),n.jsx(et,{variant:"outline",className:"h-5 px-2 text-[10px]",children:B.type||""})]}),n.jsxs("div",{className:"text-[11px] text-slate-600 flex flex-wrap items-center gap-1",children:[n.jsx(or,{className:"h-3 w-3 text-slate-400"}),n.jsx("span",{children:B.patient_name||""}),n.jsx("span",{className:"mx-1",children:""}),n.jsx(Hs,{className:"h-3 w-3 text-slate-400"}),n.jsx("span",{children:B.doctor_name||""}),n.jsx("span",{className:"mx-1",children:""}),n.jsx(Xa,{className:"h-3 w-3 text-slate-400"}),n.jsx("span",{children:B.location_name||""})]}),n.jsxs("div",{className:"text-[10px] text-slate-500 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{children:["Created: ",_5(B.created_at)]}),n.jsx("span",{children:""}),n.jsxs("span",{children:["Updated: ",_5(B.updated_at)]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-8 text-[11px]",disabled:A===B.id||B.status==="DISPENSED"||B.status==="CANCELLED",onClick:()=>W(B),children:[A===B.id?n.jsx(Rt,{className:"mr-1 h-3.5 w-3.5 animate-spin"}):n.jsx(Xt,{className:"mr-1 h-3.5 w-3.5"}),"Quick dispense remaining"]}),n.jsxs(ge,{size:"sm",className:"h-8 text-[11px]",disabled:P===B.id,onClick:()=>V(B),children:[P===B.id?n.jsx(Rt,{className:"mr-1 h-3.5 w-3.5 animate-spin"}):n.jsx(MQe,{className:"mr-1 h-3.5 w-3.5"}),"Generate bill"]})]})]}),n.jsx("div",{className:"flex-1 rounded-2xl border border-slate-100 bg-slate-50/60 p-2 sm:p-3 overflow-y-auto max-h-[360px]",children:n.jsxs("table",{className:"w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-500 text-[10px] uppercase tracking-wide text-slate-500",children:[n.jsx("th",{className:"py-1.5 pr-2 text-left font-medium",children:"Item"}),n.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Req"}),n.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Disp"}),n.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Rem"}),n.jsx("th",{className:"py-1.5 pl-2 text-left font-medium",children:"Status"})]})}),n.jsxs("tbody",{children:[(B.lines||[]).map(R=>{const F=Number(R.requested_qty||0),G=Number(R.dispensed_qty||0),H=F-G;return n.jsxs("tr",{className:"border-b border-slate-100",children:[n.jsxs("td",{className:"py-1.5 pr-2 align-top",children:[n.jsx("div",{className:"font-medium text-[11px] text-slate-900",children:R.item_name||""}),n.jsxs("div",{className:"text-[10px] text-slate-500",children:[R.item_strength&&n.jsxs("span",{children:[R.item_strength,"  "]}),R.frequency_code||""," ",R.duration_days?` ${R.duration_days} day(s)`:""]})]}),n.jsx("td",{className:"py-1.5 px-2 align-top text-right text-[10px] text-slate-700",children:F}),n.jsx("td",{className:"py-1.5 px-2 align-top text-right text-[10px] text-slate-700",children:G}),n.jsx("td",{className:"py-1.5 px-2 align-top text-right text-[10px] text-slate-700",children:H}),n.jsx("td",{className:"py-1.5 pl-2 align-top text-[10px]",children:n.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-white px-2 py-0.5 border border-slate-500 text-slate-700",children:[n.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-slate-400"}),R.status]})})]},R.id)}),(!B.lines||B.lines.length===0)&&n.jsx("tr",{children:n.jsx("td",{colSpan:5,className:"py-4 text-center text-[11px] text-slate-500",children:"No items found in this prescription."})})]})]})}),B.notes&&n.jsxs("div",{className:"mt-2 text-[11px] text-slate-600",children:[n.jsx("span",{className:"font-semibold",children:"Notes:"})," ",B.notes]})]})]})]})]})]})]})}function MQe(t){return n.jsxs("svg",{viewBox:"0 0 24 24",...t,children:[n.jsx("path",{d:"M6 6h15l-1.5 9h-12z",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),n.jsx("circle",{cx:"9",cy:"19",r:"1",fill:"currentColor"}),n.jsx("circle",{cx:"17",cy:"19",r:"1",fill:"currentColor"})]})}const S5=()=>({_id:Math.random().toString(36).slice(2),item:null,requestedQty:"",doseText:"",frequency:"",timing:"",durationDays:"",instructions:"",searchQ:"",searchResults:[],searching:!1,showDropdown:!1});function C5(t){return t?t.name||t.item_name||t.brand_name||t.code||`#${t.id}`:""}function c$(t){if(!t)return"";const s=[];return t.code&&s.push(t.code),t.generic_name&&s.push(t.generic_name),t.form&&s.push(t.form),t.strength&&s.push(t.strength),t.pack_size&&s.push(`Pack: ${t.pack_size}`),t.manufacturer&&s.push(t.manufacturer),s.join("  ")}function mS({orderType:t,title:s,subtitle:r,variant:a="page",initialPatientId:i=null,initialPatient:l=null,lockPatient:o=!1,initialLocationId:c="",initialDoctorUserId:d="",initialVisitId:u="",initialIpdAdmissionId:m="",initialContextRef:x=""}){const g=p.useMemo(()=>{switch(t){case"OPD":return"OPD";case"IPD":return"IPD Ward";case"COUNTER":return"Counter / OTC";case"OT_CONSUMABLE":return"OT Consumables";default:return t||"Pharmacy"}},[t]),[y,v]=p.useState([]),[j,w]=p.useState(c||""),[S,E]=p.useState(i),[k,A]=p.useState(l),[I,P]=p.useState(d||""),[O,D]=p.useState(u||""),[T,B]=p.useState(m||""),[U,W]=p.useState(x||""),[V,R]=p.useState(""),[F,G]=p.useState([S5()]),[H,$]=p.useState(!1);p.useEffect(()=>{i&&!S&&E(i)},[i,S]),p.useEffect(()=>{l&&!k&&A(l)},[l,k]),p.useEffect(()=>{let Y=!0;return(async()=>{try{const Q=await z2();if(!Y)return;const oe=Q.data||[];v(oe),!j&&oe.length===1&&w(String(oe[0].id))}catch{if(!Y)return;v([])}})(),()=>{Y=!1}},[]);const K=(Y,Q)=>{G(oe=>oe.map(_e=>_e._id===Y?{..._e,...Q}:_e))},le=()=>G(Y=>[...Y,S5()]),se=Y=>{G(Q=>Q.length===1?Q:Q.filter(oe=>oe._id!==Y))},J=async(Y,Q)=>{var oe;if(K(Y,{searchQ:Q,item:null}),!Q||Q.length<2){K(Y,{searchResults:[],showDropdown:!1});return}K(Y,{searching:!0,showDropdown:!0});try{const _e=await Df({q:Q,page_size:10}),xe=((oe=_e.data)==null?void 0:oe.items)||_e.data||[];K(Y,{searchResults:xe})}catch{K(Y,{searchResults:[]})}finally{K(Y,{searching:!1})}},ie=(Y,Q)=>{K(Y,{item:Q,searchQ:"",showDropdown:!1,searchResults:[]})},te=Y=>{setTimeout(()=>{K(Y,{showDropdown:!1})},150)},ne=p.useMemo(()=>{const Y=Number(j),Q=y.find(oe=>oe.id===Y);return(Q==null?void 0:Q.name)||""},[y,j]),q=p.useMemo(()=>F.filter(Y=>Y.item&&Y.item.id&&Number(Y.requestedQty||0)>0).map(Y=>{const Q=Number(Y.requestedQty||0),oe=Y.durationDays?Number(Y.durationDays):null;return{item_id:Y.item.id,requested_qty:Q,dose_text:Y.doseText||null,frequency_code:Y.frequency||null,timing:Y.timing||null,duration_days:oe,instructions:Y.instructions||null}}),[F]),ee=q.length>0,X=async()=>{if(!S){ae.error("Please select a patient");return}if(!j){ae.error("Please select Pharmacy location");return}if(!ee){ae.error("Add at least one item with quantity");return}const Y=[];V.trim()&&Y.push(V.trim()),t==="COUNTER"&&U.trim()&&Y.push(`Counter ref: ${U.trim()}`),t==="OT_CONSUMABLE"&&U.trim()&&Y.push(`OT case: ${U.trim()}`);const Q={type:t,patient_id:S,location_id:Number(j),lines:q};if(I.trim()){const oe=Number(I.trim());Number.isNaN(oe)||(Q.doctor_user_id=oe)}if(Y.length>0&&(Q.notes=Y.join(" | ")),t==="OPD"&&O.trim()){const oe=Number(O.trim());Number.isNaN(oe)||(Q.visit_id=oe)}if((t==="IPD"||t==="OT_CONSUMABLE")&&T.trim()){const oe=Number(T.trim());Number.isNaN(oe)||(Q.ipd_admission_id=oe)}try{$(!0);const _e=(await SK(Q)).data||{},xe=_e.prescription_number||_e.id||"created";ae.success(`Pharmacy order created (Rx ${xe})`),G([S5()]),R(""),W(x||""),u||D(""),m||B("")}catch{}finally{$(!1)}},Z=n.jsxs(dt,{className:"border-slate-500 rounded-2xl shadow-sm",children:[n.jsx(gt,{className:"pb-3",children:n.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(et,{variant:"outline",className:"h-6 px-2 text-[10px] uppercase tracking-wide",children:g}),n.jsx("span",{className:"text-xs text-slate-500",children:"Creates a PharmacyPrescription visible in the Pharmacy Rx Explorer."})]}),n.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-slate-500",children:[n.jsx(Xa,{className:"h-3.5 w-3.5 text-slate-400"}),n.jsx("span",{children:"Location:"}),n.jsxs("select",{className:"h-7 rounded-xl border border-slate-500 bg-white px-2 text-[11px] text-slate-700",value:j,onChange:Y=>w(Y.target.value),children:[n.jsx("option",{value:"",children:"Select"}),y.map(Y=>n.jsx("option",{value:Y.id,children:Y.name},Y.id))]})]})]})}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("div",{className:"grid gap-3 lg:grid-cols-[minmax(0,1.6fr)_minmax(0,1.4fr)]",children:[n.jsx("div",{children:n.jsx(dt,{className:"border-slate-500 rounded-2xl bg-slate-50/70",children:n.jsxs(it,{className:"p-3 sm:p-4 space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(or,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"text-xs font-semibold text-slate-800",children:"Patient"})]}),!o&&n.jsx(W2,{value:S,onChange:(Y,Q)=>{E(Y),A(Q)},label:"Select patient"}),o&&k&&n.jsxs("div",{className:"rounded-xl border bg-white px-3 py-2 text-xs text-slate-700",children:[n.jsxs("div",{className:"font-semibold text-slate-900",children:[k.first_name," ",k.last_name]}),n.jsxs("div",{className:"mt-0.5 text-[11px] text-slate-500 flex flex-wrap gap-1",children:[k.uhid&&n.jsxs(et,{variant:"outline",className:"h-4 px-1.5 text-[9px]",children:["UHID ",k.uhid]}),k.phone&&n.jsxs("span",{children:[" ",k.phone]}),n.jsx("span",{children:" Patient fixed from context"})]})]}),!o&&k&&n.jsxs("div",{className:"rounded-xl border bg-slate-50 px-3 py-2 text-[11px] text-slate-700",children:["Selected:"," ",n.jsxs("span",{className:"font-semibold",children:[k.first_name," ",k.last_name]})," ",k.uhid&&n.jsxs(n.Fragment,{children:[" UHID ",k.uhid]}),k.phone&&n.jsxs(n.Fragment,{children:["  ",k.phone]})]})]})})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(dt,{className:"border-slate-500 rounded-2xl bg-slate-50/70",children:n.jsxs(it,{className:"p-3 sm:p-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Hs,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"text-xs font-semibold text-slate-800",children:"Clinical context"})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[t==="OPD"&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"OPD Visit ID (optional)"}),n.jsx(Ee,{placeholder:"e.g., 1234",className:"h-8 text-xs",value:O,onChange:Y=>D(Y.target.value)})]}),(t==="IPD"||t==="OT_CONSUMABLE")&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"IPD Admission ID (optional)"}),n.jsx(Ee,{placeholder:"e.g., 5678",className:"h-8 text-xs",value:T,onChange:Y=>B(Y.target.value)})]}),t==="COUNTER"&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Counter ref / token (optional)"}),n.jsx(Ee,{placeholder:"e.g., Token #15",className:"h-8 text-xs",value:U,onChange:Y=>W(Y.target.value)})]}),t==="OT_CONSUMABLE"&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"OT case ref (optional)"}),n.jsx(Ee,{placeholder:"e.g., OT-2025-001",className:"h-8 text-xs",value:U,onChange:Y=>W(Y.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Doctor user ID (optional)"}),n.jsx(Ee,{placeholder:"e.g., 10",className:"h-8 text-xs",value:I,onChange:Y=>P(Y.target.value)}),n.jsx("p",{className:"text-[10px] text-slate-500",children:"Later you can auto-fill from logged-in doctor / visit."})]})]})]})}),k&&n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-white px-3 py-2 text-[11px] text-slate-700 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{className:"font-semibold",children:[k.first_name," ",k.last_name]}),k.uhid&&n.jsxs(et,{variant:"outline",className:"h-4 px-1.5 text-[9px]",children:["UHID ",k.uhid]}),k.phone&&n.jsxs("span",{children:[" ",k.phone]})]})]})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50/70 p-2 sm:p-3 space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(rr,{className:"h-4 w-4 text-slate-500"}),n.jsx("span",{className:"text-xs font-semibold text-slate-800",children:"Order lines (medicines / consumables)"})]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-7 text-[11px]",onClick:le,children:[n.jsx(ds,{className:"mr-1 h-3.5 w-3.5"}),"Add line"]})]}),n.jsx("div",{className:"overflow-x-auto -mx-1 sm:mx-0",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-500 text-[10px] uppercase tracking-wide text-slate-500",children:[n.jsx("th",{className:"py-1.5 pr-2 text-left font-medium",children:"Item"}),n.jsx("th",{className:"py-1.5 px-2 text-left font-medium",children:"Dose / Frequency"}),n.jsx("th",{className:"py-1.5 px-2 text-left font-medium",children:"Duration"}),n.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Qty"}),n.jsx("th",{className:"py-1.5 pl-2 text-right font-medium w-10"})]})}),n.jsx("tbody",{children:F.map(Y=>n.jsxs("tr",{className:"border-b border-slate-100 align-top",children:[n.jsx("td",{className:"py-2 pr-2 min-w-[220px]",children:n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"absolute left-2 top-2 h-3.5 w-3.5 text-slate-400"}),n.jsx(Ee,{className:"pl-6 h-8 text-xs",placeholder:Y.item?C5(Y.item):"Search item (name / code / generic)",value:Y.item?C5(Y.item):Y.searchQ,onChange:Q=>J(Y._id,Q.target.value),onFocus:()=>{var Q;return((Q=Y.searchQ)==null?void 0:Q.length)>=2&&K(Y._id,{showDropdown:!0})},onBlur:()=>te(Y._id)}),Y.showDropdown&&(Y.searching||Y.searchResults.length>0)&&n.jsxs("div",{className:"absolute z-30 mt-1 max-h-60 w-full overflow-auto rounded-xl border border-slate-500 bg-white shadow-lg",children:[Y.searching&&n.jsxs("div",{className:"px-3 py-2 text-[11px] text-slate-500 flex items-center gap-2",children:[n.jsx(Rt,{className:"h-3.5 w-3.5 animate-spin text-slate-400"}),"Searching"]}),!Y.searching&&Y.searchResults.length===0&&n.jsx("div",{className:"px-3 py-2 text-[11px] text-slate-500",children:"No items found."}),!Y.searching&&Y.searchResults.map(Q=>n.jsxs("button",{type:"button",className:"w-full px-3 py-1.5 text-left hover:bg-slate-50",onMouseDown:oe=>oe.preventDefault(),onClick:()=>ie(Y._id,Q),children:[n.jsx("div",{className:"font-medium text-[11px] text-slate-900",children:C5(Q)}),n.jsx("div",{className:"text-[10px] text-slate-500",children:c$(Q)})]},Q.id))]})]}),Y.item&&n.jsx("div",{className:"rounded-xl bg-white border border-slate-500 px-2 py-1 text-[10px] text-slate-600",children:c$(Y.item)||"Selected from inventory"}),n.jsx(fs,{className:"h-14 text-[11px]",placeholder:"Special instructions (optional)",value:Y.instructions,onChange:Q=>K(Y._id,{instructions:Q.target.value})})]})}),n.jsx("td",{className:"py-2 px-2 min-w-[190px]",children:n.jsxs("div",{className:"space-y-1",children:[n.jsx(Ee,{className:"h-8 text-xs",placeholder:"Dose text (e.g., 1-0-1)",value:Y.doseText,onChange:Q=>K(Y._id,{doseText:Q.target.value})}),n.jsx(Ee,{className:"h-8 text-xs",placeholder:"Frequency (e.g., TDS, BD, HS)",value:Y.frequency,onChange:Q=>K(Y._id,{frequency:Q.target.value})}),n.jsx(Ee,{className:"h-8 text-xs",placeholder:"Timing (e.g., after food)",value:Y.timing,onChange:Q=>K(Y._id,{timing:Q.target.value})})]})}),n.jsxs("td",{className:"py-2 px-2 min-w-[120px]",children:[n.jsx(Ee,{className:"h-8 text-xs",type:"number",min:0,placeholder:"Days",value:Y.durationDays,onChange:Q=>K(Y._id,{durationDays:Q.target.value})}),n.jsx("p",{className:"mt-1 text-[10px] text-slate-500",children:"Later you can auto-calc qty from dose  days."})]}),n.jsx("td",{className:"py-2 px-2 text-right align-top min-w-[80px]",children:n.jsx(Ee,{className:"h-8 text-xs text-right",type:"number",min:0,placeholder:"Qty",value:Y.requestedQty,onChange:Q=>K(Y._id,{requestedQty:Q.target.value})})}),n.jsx("td",{className:"py-2 pl-2 pr-1 align-top text-right",children:n.jsx(ge,{size:"icon",variant:"ghost",className:"h-7 w-7 text-slate-400 hover:text-red-600",onClick:()=>se(Y._id),children:n.jsx(Ms,{className:"h-4 w-4"})})})]},Y._id))})]})}),n.jsxs("div",{className:"mt-1 text-[11px] text-slate-500 flex flex-wrap items-center gap-2",children:[n.jsxs("span",{children:["Valid lines:"," ",n.jsx("span",{className:"font-semibold",children:q.length})]}),n.jsx("span",{children:""}),n.jsxs("span",{children:["Location:"," ",n.jsx("span",{className:"font-semibold",children:ne})]})]})]}),n.jsxs("div",{className:"grid gap-3 sm:grid-cols-[minmax(0,1.7fr)_minmax(0,1fr)] items-start",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-[11px] font-medium text-slate-700",children:"Overall notes (optional)"}),n.jsx(fs,{className:"min-h-[60px] text-[11px]",placeholder:"Any clinical notes for Pharmacy",value:V,onChange:Y=>R(Y.target.value)})]}),n.jsxs("div",{className:"flex flex-col sm:items-end gap-2",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["This will create a"," ",n.jsx("span",{className:"font-semibold",children:"PharmacyPrescription"})," which appears in the Pharmacy Rx Explorer for dispensing & billing."]}),n.jsxs(ge,{className:"h-9 px-4 text-[11px]",disabled:H,onClick:X,children:[H?n.jsx(Rt,{className:"mr-1 h-4 w-4 animate-spin"}):n.jsx(rr,{className:"mr-1 h-4 w-4"}),"Save ",g," order"]})]})]})]})]});return a==="embedded"?Z:n.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-3 sm:space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[n.jsx("div",{className:"inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-slate-900 text-white",children:n.jsx(rr,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-base sm:text-lg font-semibold tracking-tight text-slate-900",children:s}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:r})]})]}),Z]})}function IQe(){return n.jsx(mS,{orderType:"IPD",title:"IPD Ward Medication Orders",subtitle:"Raise IPD ward medication orders linked to IPD admission. Orders flow to Pharmacy Rx Explorer with ward context."})}function OQe(){return n.jsx(mS,{orderType:"COUNTER",title:"Pharmacy Counter / OTC Orders",subtitle:"Create counter / OTC orders from Inventory medicines. Ideal for walk-in and quick sales via Rx  dispense  bill."})}function RQe(){return n.jsx(mS,{orderType:"OT_CONSUMABLE",title:"OT Consumables Orders",subtitle:"Order OT consumables (sutures, implants, disposables) against IPD admission / OT case. Orders go to Pharmacy / OT store via Rx queue."})}function LQe(){return n.jsx(mS,{orderType:"OPD",title:"OPD Medication Orders",subtitle:"Prescribe medicines for OPD visits from Inventory items. Orders appear in the Pharmacy Rx queue for dispensing and billing."})}function FQe(t={}){const s={};for(const[r,a]of Object.entries(t))a===""||a===null||a===void 0||(s[r]=a);return s}async function Rh(t){var d;const s=await t(),r=s==null?void 0:s.data,a=((d=s==null?void 0:s.headers)==null?void 0:d["content-disposition"])||"",i=/filename="([^"]+)"/.exec(a),l=(i==null?void 0:i[1])||"download.xlsx",o=URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download=l,document.body.appendChild(c),c.click(),c.remove(),setTimeout(()=>URL.revokeObjectURL(o),6e4)}const Pw=t=>he.get("/pharmacy/accounts/supplier-invoices",{params:FQe(t)}),BQe=t=>he.post("/pharmacy/accounts/supplier-payments",t),wne=t=>he.get("/pharmacy/accounts/supplier-payments",{params:t}),$Qe=t=>he.get("/pharmacy/accounts/supplier-ledger/monthly-summary",{params:{month:t}}),Ig=t=>he.get("/pharmacy/accounts/supplier-ledger/export.xlsx",{params:t,responseType:"blob"}),d$=t=>he.get("/pharmacy/accounts/supplier-ledger/monthly-summary/export.xlsx",{params:{month:t},responseType:"blob"});function Es({value:t}){const s=Number(t||0);return n.jsxs("span",{className:"font-medium",children:["",s.toLocaleString("en-IN",{minimumFractionDigits:2})]})}function Ar(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-IN")}catch{return String(t)}}function Lh({inv:t}){return t!=null&&t.is_overdue?n.jsx(et,{className:"bg-rose-100 text-rose-800 border border-rose-200",children:"Overdue"}):(t==null?void 0:t.status)==="PARTIAL"?n.jsx(et,{className:"bg-amber-100 text-amber-800 border border-amber-200",children:"Partial"}):(t==null?void 0:t.status)==="PAID"?n.jsx(et,{className:"bg-emerald-100 text-emerald-800 border border-emerald-200",children:"Paid"}):n.jsx(et,{className:"bg-slate-100 text-slate-800 border border-slate-500",children:"Unpaid"})}const Dw="__none__",u$=t=>t===""||t==null?Dw:String(t),m$=t=>t===Dw?"":t;function zQe(t,s=500){const[r,a]=p.useState(t);return p.useEffect(()=>{const i=setTimeout(()=>a(t),s);return()=>clearTimeout(i)},[t,s]),r}const Bv=t=>{if(t===""||t==null)return;const s=Number(t);return Number.isFinite(s)?s:void 0},h$=t=>typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t);function UQe(){var ne;const t=ct("pharmacy.accounts.supplier_ledger.view"),s=ct("pharmacy.accounts.supplier_ledger.export"),[r,a]=p.useState(!1),[i,l]=p.useState([]),[o,c]=p.useState([]),[d,u]=p.useState(""),[m,x]=p.useState(""),[g,y]=p.useState({supplier_id:"",status:"",from_date:"",to_date:"",overdue_only:!1,min_amount:"",max_amount:""}),[v,j]=p.useState(!1),[w,S]=p.useState(!0),[E,k]=p.useState(!1),[A,I]=p.useState(null),[P,O]=p.useState([]),[D,T]=p.useState(!1),[B,U]=p.useState(""),W=zQe(g,550),V=p.useRef(!1),R=p.useMemo(()=>{const q=[];g.from_date&&g.to_date&&h$(g.from_date)&&h$(g.to_date)&&g.from_date>g.to_date&&q.push("From date is after To date.");const ee=Bv(g.min_amount),X=Bv(g.max_amount);return ee!=null&&ee<0&&q.push("Min amount cannot be negative."),X!=null&&X<0&&q.push("Max amount cannot be negative."),ee!=null&&X!=null&&ee>X&&q.push("Min amount is greater than Max amount."),q},[g]),F=q=>({supplier_id:q.supplier_id?Number(q.supplier_id):void 0,status:q.status||void 0,from_date:q.from_date||void 0,to_date:q.to_date||void 0,overdue_only:!!q.overdue_only,min_amount:Bv(q.min_amount),max_amount:Bv(q.max_amount)}),G=()=>{y({supplier_id:"",status:"",from_date:"",to_date:"",overdue_only:!1,min_amount:"",max_amount:""}),x(""),j(!1)},H=async()=>{if(t)try{const q=await px();c(q.data||[])}catch{}},$=async(q=g)=>{var ee,X;if(t&&!(R.length>0)){a(!0),u("");try{const Z=await Pw(F(q));l(Z.data||[])}catch(Z){const Y=((X=(ee=Z==null?void 0:Z.response)==null?void 0:ee.data)==null?void 0:X.detail)||"Failed to load invoices.";l([]),u(Y),ae.error("Supplier Ledger load failed",{description:Y})}finally{a(!1)}}},K=async q=>{var ee,X;if(t){T(!0),U("");try{const Z=await wne({supplier_id:q});O(Z.data||[])}catch(Z){O([]),U(((X=(ee=Z==null?void 0:Z.response)==null?void 0:ee.data)==null?void 0:X.detail)||"Failed to load payments.")}finally{T(!1)}}};p.useEffect(()=>{t&&(H(),$(),V.current=!0)},[t]),p.useEffect(()=>{t&&V.current&&$(W)},[W,t]);const le=p.useMemo(()=>{const q=m.trim().toLowerCase();return q?(i||[]).filter(ee=>{var Z,Y;return[ee==null?void 0:ee.grn_number,ee==null?void 0:ee.invoice_number,(Z=ee==null?void 0:ee.supplier)==null?void 0:Z.name,(Y=ee==null?void 0:ee.location)==null?void 0:Y.name].filter(Boolean).join(" ").toLowerCase().includes(q)}):i},[i,m]),se=async q=>{t&&(I(q),k(!0),O([]),U(""),q!=null&&q.supplier_id&&await K(q.supplier_id))},J=p.useMemo(()=>(P||[]).reduce((q,ee)=>q+Number(ee.advance_amount||0),0),[P]),ie=p.useMemo(()=>{const q=le||[],ee=q.length,X=q.filter(xe=>String(xe.status||"").toUpperCase()==="UNPAID").length,Z=q.filter(xe=>String(xe.status||"").toUpperCase()==="PARTIAL").length,Y=q.filter(xe=>String(xe.status||"").toUpperCase()==="PAID").length,Q=new Date,oe=q.filter(xe=>{if((Number(xe.outstanding_amount||0)||0)<=0||!xe.due_date)return!1;const Re=new Date(xe.due_date);return Number.isFinite(Re.getTime())&&Re<Q}).length,_e=q.reduce((xe,me)=>xe+(Number(me.outstanding_amount||0)||0),0);return{total:ee,unpaid:X,partial:Z,paid:Y,overdue:oe,outstandingSum:_e}},[le]);if(!t)return n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm overflow-hidden",children:[n.jsxs(gt,{className:"space-y-1",children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Supplier Ledger"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Permission required."})]}),n.jsx(it,{children:n.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:["You do not have permission to view Supplier Ledger.",n.jsxs("div",{className:"mt-2 text-xs",children:["Ask Admin to enable:"," ",n.jsx("span",{className:"font-mono",children:"pharmacy.accounts.supplier_ledger.view"})]})]})})]});const te=n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur",onClick:()=>$(g),disabled:r||R.length>0,children:[n.jsx(ps,{className:"w-4 h-4"}),"Refresh"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur",onClick:()=>Rh(()=>Ig(F(g))),disabled:!s||R.length>0,title:s?void 0:"No permission: export",children:[n.jsx(nn,{className:"w-4 h-4"}),"Excel"]})]});return n.jsx("div",{className:"space-y-4",children:n.jsxs("div",{className:"rounded-[28px] border border-slate-500/70 bg-gradient-to-b from-white to-slate-50 shadow-[0_18px_50px_rgba(2,6,23,0.08)] overflow-hidden",children:[n.jsxs("div",{className:"px-4 sm:px-6 py-4 sm:py-5 bg-white/65 backdrop-blur-xl border-b border-slate-500/60",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[n.jsx("div",{className:"space-y-1",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-slate-900 text-white flex items-center justify-center shadow-sm",children:n.jsx(gr,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-base sm:text-lg font-semibold text-slate-900 leading-tight",children:"Supplier Ledger"}),n.jsx("div",{className:"text-xs text-slate-500",children:"GRN  Supplier invoice tracking  Outstanding  Overdue  Export"})]})]})}),n.jsx("div",{className:"hidden sm:flex",children:te})]}),n.jsxs("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2",children:[n.jsx(K0,{label:"Total",value:ie.total}),n.jsx(K0,{label:"Unpaid",value:ie.unpaid,tone:"amber"}),n.jsx(K0,{label:"Partial",value:ie.partial,tone:"blue"}),n.jsx(K0,{label:"Paid",value:ie.paid,tone:"emerald"}),n.jsx(K0,{label:"Overdue",value:ie.overdue,tone:"rose"}),n.jsx(VQe,{label:"Outstanding",value:ie.outstandingSum,tone:"slate"})]})]}),n.jsxs("div",{className:"p-4 sm:p-6 space-y-3",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/75 backdrop-blur p-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"mt-0.5 rounded-2xl border border-slate-500 bg-slate-50 p-2",children:n.jsx(gr,{className:"h-4 w-4 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"How this works"}),n.jsxs("div",{className:"text-xs text-slate-600 mt-0.5 leading-relaxed",children:["Supplier invoices are created automatically from ",n.jsx("b",{children:"GRN"}),". Use filters to find unpaid/overdue bills, open invoice details, and export the ledger."]})]})]}),n.jsx(ge,{size:"sm",variant:"ghost",className:"h-9 rounded-full",onClick:()=>S(q=>!q),children:w?"Hide":"Show"})]}),w&&n.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[n.jsx(k5,{title:"Purpose",text:"Invoice amount vs paid vs outstanding, per supplier."}),n.jsx(k5,{title:"Best filters",text:"Supplier + Status + Overdue only for quick calls."}),n.jsx(k5,{title:"Validation",text:"From date  To date, Min amount  Max amount."})]})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/75 backdrop-blur p-3",children:[n.jsxs("div",{className:"grid gap-2 lg:grid-cols-12 items-end",children:[n.jsxs("div",{className:"lg:col-span-4 min-w-0",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Search"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-3 text-slate-400"}),n.jsx(Ee,{className:"h-10 pl-9 bg-white rounded-full border-slate-500",placeholder:"GRN / invoice / supplier / location...",value:m,onChange:q=>x(q.target.value)})]})]}),n.jsxs("div",{className:"lg:col-span-3 min-w-0",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Supplier"}),n.jsxs(Zs,{value:u$(g.supplier_id),onValueChange:q=>y(ee=>({...ee,supplier_id:m$(q)})),children:[n.jsx(Ws,{className:"h-10 bg-white rounded-full border-slate-500",children:n.jsx(Js,{placeholder:"All suppliers"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:Dw,children:"All suppliers"}),o.map(q=>n.jsx(Ut,{value:String(q.id),children:q.name},q.id))]})]})]}),n.jsxs("div",{className:"lg:col-span-2 min-w-0",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Status"}),n.jsxs(Zs,{value:u$(g.status),onValueChange:q=>y(ee=>({...ee,status:m$(q)})),children:[n.jsx(Ws,{className:"h-10 bg-white rounded-full border-slate-500",children:n.jsx(Js,{placeholder:"All status"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:Dw,children:"All status"}),n.jsx(Ut,{value:"UNPAID",children:"Unpaid"}),n.jsx(Ut,{value:"PARTIAL",children:"Partial"}),n.jsx(Ut,{value:"PAID",children:"Paid"})]})]})]}),n.jsxs("div",{className:"lg:col-span-3 grid grid-cols-2 gap-2 min-w-0",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"From"}),n.jsx(Ee,{type:"date",className:"h-10 bg-white rounded-full border-slate-500",value:g.from_date,onChange:q=>y(ee=>({...ee,from_date:q.target.value}))})]}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"To"}),n.jsx(Ee,{type:"date",className:"h-10 bg-white rounded-full border-slate-500",value:g.to_date,onChange:q=>y(ee=>({...ee,to_date:q.target.value}))})]})]})]}),R.length>0&&n.jsxs("div",{className:"mt-3 rounded-2xl border border-amber-200 bg-amber-50 p-3 text-xs text-amber-900 flex items-start gap-2",children:[n.jsx(en,{className:"w-4 h-4 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold",children:"Fix filters to continue"}),n.jsx("ul",{className:"list-disc pl-4 mt-1 text-amber-800",children:R.map((q,ee)=>n.jsx("li",{children:q},ee))})]})]}),n.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsx("div",{className:"text-xs text-slate-500",children:r?"Loading":`${le.length} invoice(s)`}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx(ge,{size:"sm",variant:g.overdue_only?"default":"outline",className:"h-9 rounded-full",onClick:()=>y(q=>({...q,overdue_only:!q.overdue_only})),children:"Overdue only"}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 rounded-full gap-2",onClick:()=>j(q=>!q),children:[n.jsx(ZE,{className:"w-4 h-4"}),"More"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 rounded-full gap-2",onClick:G,children:[n.jsx(ts,{className:"w-4 h-4"}),"Clear"]}),n.jsx(ge,{size:"sm",className:"h-9 rounded-full",onClick:()=>$(g),disabled:r||R.length>0,children:"Apply"})]})]}),v&&n.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-2 lg:grid-cols-12",children:[n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Min amount"}),n.jsx(Ee,{className:"h-10 bg-white rounded-full border-slate-500",placeholder:"0",inputMode:"decimal",value:g.min_amount,onChange:q=>y(ee=>({...ee,min_amount:q.target.value}))})]}),n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Max amount"}),n.jsx(Ee,{className:"h-10 bg-white rounded-full border-slate-500",placeholder:"0",inputMode:"decimal",value:g.max_amount,onChange:q=>y(ee=>({...ee,max_amount:q.target.value}))})]}),n.jsxs("div",{className:"lg:col-span-8 text-[11px] text-slate-500 flex items-center",children:["Tip: Amount filters apply to ",n.jsx("span",{className:"font-medium ml-1",children:"Invoice Amount"}),"."]})]})]}),n.jsxs("div",{className:"hidden md:block rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur overflow-hidden",children:[n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,0.9fr,0.8fr,0.4fr] px-4 py-3 text-xs font-semibold text-slate-500 bg-slate-50/80",children:[n.jsx("span",{children:"GRN"}),n.jsx("span",{children:"Supplier"}),n.jsx("span",{children:"Invoice"}),n.jsx("span",{children:"Amount"}),n.jsx("span",{children:"Outstanding"}),n.jsx("span",{children:"Status"}),n.jsx("span",{className:"text-right",children:"View"})]}),r?n.jsxs("div",{className:"p-4 space-y-2",children:[n.jsx(Qe,{className:"h-9 w-full"}),n.jsx(Qe,{className:"h-9 w-full"}),n.jsx(Qe,{className:"h-9 w-full"})]}):d?n.jsx("div",{className:"p-4",children:n.jsxs("div",{className:"flex items-start gap-2 rounded-2xl border border-amber-200 bg-amber-50 p-4",children:[n.jsx(en,{className:"w-4 h-4 mt-0.5 text-amber-700"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold text-slate-900",children:"Couldnt load invoices"}),n.jsx("div",{className:"text-xs text-amber-800 mt-1",children:d}),n.jsx(ge,{size:"sm",variant:"outline",className:"mt-3 h-9 rounded-full",onClick:()=>$(g),children:"Retry"})]})]})}):le.length===0?n.jsx("div",{className:"p-5 text-sm text-slate-500",children:"No invoices found."}):n.jsx("div",{className:"max-h-[560px] overflow-auto divide-y divide-slate-100",children:le.map(q=>{var ee,X,Z;return n.jsxs("div",{className:"grid grid-cols-[1.1fr,1.2fr,1.2fr,0.9fr,0.9fr,0.8fr,0.4fr] gap-2 px-4 py-3 text-xs hover:bg-slate-50/70 transition-colors",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-semibold text-slate-900",children:q.grn_number||`GRN-${q.grn_id||q.id}`}),n.jsxs("div",{className:"text-slate-500 mt-0.5",children:["Date: ",Ar(q.invoice_date)]})]}),n.jsxs("div",{className:"text-slate-900",children:[n.jsx("div",{className:"font-medium",children:((ee=q==null?void 0:q.supplier)==null?void 0:ee.name)||`Supplier #${q.supplier_id}`}),n.jsx("div",{className:"text-[11px] text-slate-500 mt-0.5",children:((X=q==null?void 0:q.supplier)==null?void 0:X.phone)||((Z=q==null?void 0:q.supplier)==null?void 0:Z.email)||""})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-900 font-medium",children:q.invoice_number||""}),n.jsxs("div",{className:"text-[11px] text-slate-500 mt-0.5",children:["Due: ",Ar(q.due_date)]})]}),n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:q.invoice_amount})}),n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:q.outstanding_amount})}),n.jsx("div",{children:n.jsx(Lh,{inv:q})}),n.jsx("div",{className:"text-right",children:n.jsx(ge,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-full border-slate-500 bg-white",onClick:()=>se(q),title:"View details",children:n.jsx(Wr,{className:"w-4 h-4"})})})]},q.id)})})]}),n.jsx("div",{className:"md:hidden space-y-2",children:r?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-24 w-full rounded-3xl"}),n.jsx(Qe,{className:"h-24 w-full rounded-3xl"})]}):d?n.jsxs("div",{className:"rounded-3xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900 flex items-start gap-2",children:[n.jsx(en,{className:"w-4 h-4 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold",children:"Couldnt load invoices"}),n.jsx("div",{className:"text-xs text-amber-800 mt-1",children:d}),n.jsx(ge,{size:"sm",variant:"outline",className:"mt-3 h-9 rounded-full",onClick:()=>$(g),children:"Retry"})]})]}):le.length===0?n.jsx("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4 text-sm text-slate-500",children:"No invoices found."}):le.map(q=>{var ee,X;return n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4 shadow-[0_10px_30px_rgba(2,6,23,0.06)]",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:((ee=q==null?void 0:q.supplier)==null?void 0:ee.name)||`Supplier #${q.supplier_id}`}),n.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[q.grn_number||`GRN-${q.grn_id||q.id}`,"  ",Ar(q.invoice_date)]}),n.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:["Inv: ",q.invoice_number||"","  Due: ",Ar(q.due_date)]})]}),n.jsxs(ge,{variant:"outline",size:"sm",className:"h-9 rounded-full gap-2 shrink-0 border-slate-500 bg-white",onClick:()=>se(q),children:[n.jsx(Wr,{className:"w-4 h-4"}),"View"]})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs",children:[n.jsxs("div",{className:"rounded-2xl bg-slate-50 border border-slate-500 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Amount"}),n.jsx("div",{className:"font-semibold mt-1",children:n.jsx(Es,{value:q.invoice_amount})})]}),n.jsxs("div",{className:"rounded-2xl bg-slate-50 border border-slate-500 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Outstanding"}),n.jsx("div",{className:"font-semibold mt-1",children:n.jsx(Es,{value:q.outstanding_amount})})]}),n.jsxs("div",{className:"col-span-2 flex items-center justify-between pt-1",children:[n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Location: ",n.jsx("span",{className:"text-slate-700",children:((X=q==null?void 0:q.location)==null?void 0:X.name)||""})]}),n.jsx(Lh,{inv:q})]})]})]},q.id)})}),n.jsxs("div",{className:"sm:hidden sticky bottom-0 -mx-4 px-4 py-3 bg-white/70 backdrop-blur-xl border-t border-slate-500/70 flex items-center justify-between",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white",onClick:()=>$(g),disabled:r||R.length>0,children:[n.jsx(ps,{className:"w-4 h-4"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"h-10 rounded-full gap-2",onClick:()=>Rh(()=>Ig(F(g))),disabled:!s||R.length>0,title:s?void 0:"No permission: export",children:[n.jsx(nn,{className:"w-4 h-4"}),"Excel"]})]}),n.jsx(Wa,{open:E,onOpenChange:k,children:n.jsxs(va,{className:"sm:max-w-3xl w-[calc(100vw-24px)] sm:w-full rounded-3xl max-h-[85vh] overflow-y-auto",children:[n.jsx(ii,{children:n.jsxs(li,{className:"flex items-center justify-between",children:[n.jsx("span",{children:"Invoice Details"}),A?n.jsx("span",{className:"text-xs text-slate-500",children:A.invoice_number||""}):null]})}),A?n.jsxs("div",{className:"space-y-3 text-sm",children:[n.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[n.jsx(x$,{title:"Supplier",value:((ne=A==null?void 0:A.supplier)==null?void 0:ne.name)||`#${A.supplier_id}`}),n.jsx(x$,{title:"Invoice",value:A.invoice_number||"",sub:Ar(A.invoice_date)}),n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Status"}),n.jsx("div",{className:"mt-2",children:n.jsx(Lh,{inv:A})})]})]}),n.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[n.jsx(A5,{title:"Invoice Amount",value:A.invoice_amount}),n.jsx(A5,{title:"Paid",value:A.paid_amount}),n.jsx(A5,{title:"Outstanding",value:A.outstanding_amount})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"font-semibold",children:"Payment History"}),J>0&&n.jsxs("div",{className:"text-xs rounded-full bg-emerald-50 text-emerald-800 border border-emerald-200 px-3 py-1",children:["Advance: ",n.jsx(Es,{value:J})]})]}),D?n.jsxs("div",{className:"mt-3 space-y-2",children:[n.jsx(Qe,{className:"h-7 w-full"}),n.jsx(Qe,{className:"h-7 w-full"})]}):B?n.jsxs("div",{className:"mt-3 rounded-2xl border border-amber-200 bg-amber-50 p-3 text-xs text-amber-900 flex items-start gap-2",children:[n.jsx(en,{className:"w-4 h-4 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold",children:"Payments not loaded"}),n.jsx("div",{className:"text-amber-800 mt-1",children:B}),n.jsx(ge,{size:"sm",variant:"outline",className:"mt-3 h-9 rounded-full",onClick:()=>K(A.supplier_id),children:"Retry"})]})]}):P.length===0?n.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"No payments found for this supplier."}):n.jsx("div",{className:"mt-3 divide-y divide-slate-100",children:P.slice(0,12).map(q=>n.jsxs("div",{className:"py-3 text-xs flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"font-medium",children:[Ar(q.payment_date),"  ",q.payment_method]}),n.jsxs("div",{className:"text-slate-500 truncate mt-0.5",children:[q.reference_no||""," ",q.remarks?` ${q.remarks}`:""]})]}),n.jsxs("div",{className:"text-right shrink-0",children:[n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:q.amount})}),n.jsxs("div",{className:"text-[11px] text-slate-500 mt-0.5",children:["Alloc: ",n.jsx(Es,{value:q.allocated_amount}),"  Adv: ",n.jsx(Es,{value:q.advance_amount})]})]})]},q.id))})]}),n.jsxs("div",{className:"text-xs text-slate-500",children:["Tip: Use the ",n.jsx("span",{className:"font-medium",children:"Supplier Payments"})," screen to allocate payments to invoices."]})]}):null]})}),n.jsx("div",{className:"sm:hidden"})]}),n.jsx("div",{className:"sm:hidden px-4 pb-4",children:n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur w-full",onClick:()=>$(g),disabled:r||R.length>0,children:[n.jsx(ps,{className:"w-4 h-4"}),"Refresh"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur w-full",onClick:()=>Rh(()=>Ig(F(g))),disabled:!s||R.length>0,title:s?void 0:"No permission: export",children:[n.jsx(nn,{className:"w-4 h-4"}),"Excel"]})]})})]})})}function K0({label:t,value:s,tone:r="slate"}){const a=r==="amber"?"border-amber-200 bg-amber-50 text-amber-900":r==="blue"?"border-blue-200 bg-blue-50 text-blue-900":r==="emerald"?"border-emerald-200 bg-emerald-50 text-emerald-900":r==="rose"?"border-rose-200 bg-rose-50 text-rose-900":"border-slate-500 bg-slate-50 text-slate-900";return n.jsxs("div",{className:`rounded-3xl border ${a} p-3`,children:[n.jsx("div",{className:"text-[11px] opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-base font-semibold leading-none",children:s??0})]})}function VQe({label:t,value:s,tone:r="slate"}){return n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-slate-50 text-slate-900 p-3",children:[n.jsx("div",{className:"text-[11px] opacity-70",children:t}),n.jsx("div",{className:"mt-1 text-base font-semibold leading-none",children:n.jsx(Es,{value:s})})]})}function k5({title:t,text:s}){return n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:t}),n.jsx("div",{className:"text-xs text-slate-700 mt-1 leading-relaxed",children:s})]})}function x$({title:t,value:s,sub:r}){return n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4",children:[n.jsx("div",{className:"text-xs text-slate-500",children:t}),n.jsx("div",{className:"font-medium mt-1 text-slate-900",children:s}),r?n.jsx("div",{className:"text-xs text-slate-500 mt-1",children:r}):null]})}function A5({title:t,value:s}){return n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4",children:[n.jsx("div",{className:"text-xs text-slate-500",children:t}),n.jsx("div",{className:"text-lg font-semibold mt-1 text-slate-900",children:n.jsx(Es,{value:s})})]})}function HQe(){const t=new Date,s=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0");return`${s}-${r}`}function $v({label:t,children:s,tone:r="slate"}){const a=r==="amber"?"border-amber-200 bg-amber-50 text-amber-950":r==="emerald"?"border-emerald-200 bg-emerald-50 text-emerald-950":r==="blue"?"border-blue-200 bg-blue-50 text-blue-950":"border-slate-500 bg-slate-50 text-slate-950";return n.jsxs("div",{className:`rounded-3xl border ${a} p-3`,children:[n.jsx("div",{className:"text-[11px] text-slate-600",children:t}),n.jsx("div",{className:"mt-1 text-base font-semibold leading-none",children:s})]})}function WQe(){const t=ct("pharmacy.accounts.supplier_ledger.monthly_summary.view"),s=ct("pharmacy.accounts.supplier_ledger.monthly_summary.export"),[r,a]=p.useState(HQe()),[i,l]=p.useState([]),[o,c]=p.useState(!1),[d,u]=p.useState(""),[m,x]=p.useState([]),[g,y]=p.useState(""),[v,j]=p.useState(!0);p.useEffect(()=>{t&&(async()=>{try{const A=await px();x(A.data||[])}catch{}})()},[t]);const w=A=>{var I;return((I=m.find(P=>String(P.id)===String(A)))==null?void 0:I.name)||`Supplier #${A}`},S=async(A=r)=>{var I,P,O;if(t){if(!A){ae.warning("Select a month first");return}c(!0),u("");try{const D=await $Qe(A);l(((I=D.data)==null?void 0:I.rows)||[])}catch(D){const T=((O=(P=D==null?void 0:D.response)==null?void 0:P.data)==null?void 0:O.detail)||"Failed to load monthly summary.";l([]),u(T),ae.error("Monthly Summary load failed",{description:T})}finally{c(!1)}}};p.useEffect(()=>{t&&S(r)},[r,t]);const E=p.useMemo(()=>{const A=g.trim().toLowerCase();return A?(i||[]).filter(I=>w(I.supplier_id).toLowerCase().includes(A)):i},[i,g,m]),k=p.useMemo(()=>{const A=I=>(E||[]).reduce((P,O)=>P+Number((O==null?void 0:O[I])||0),0);return{purchase:A("total_purchase"),paid:A("total_paid"),pending:A("pending_amount"),overdue:(E||[]).reduce((I,P)=>I+Number((P==null?void 0:P.overdue_invoices)||0),0)}},[E]);return t?n.jsx("div",{className:"space-y-4",children:n.jsxs("div",{className:"rounded-[28px] border border-slate-500/70 bg-gradient-to-b from-white to-slate-50 shadow-[0_18px_50px_rgba(2,6,23,0.08)] overflow-hidden",children:[n.jsxs("div",{className:"px-4 sm:px-6 py-4 bg-white/70 backdrop-blur-xl border-b border-slate-500/60",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[n.jsx("div",{className:"space-y-1",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-slate-900 text-white flex items-center justify-center shadow-sm",children:n.jsx(gr,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-base sm:text-lg font-semibold text-slate-900 leading-tight",children:"Supplier Monthly Summary"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Supplier-wise purchase vs paid vs pending for the selected month."})]})]})}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[n.jsx(Ee,{type:"month",className:"h-10 bg-white rounded-full border-slate-500 w-full sm:w-44",value:r,onChange:A=>a(A.target.value)}),n.jsxs(ge,{size:"sm",className:"h-10 rounded-full",onClick:()=>S(r),disabled:o||!r||!t,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Load"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur",disabled:!r||!s,title:s?void 0:"No permission to export",onClick:()=>r&&Rh(()=>d$(r)),children:[n.jsx(nn,{className:"w-4 h-4"}),"Excel"]})]})]}),n.jsxs("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:[n.jsx($v,{label:"Total purchase",children:n.jsx(Es,{value:k.purchase})}),n.jsx($v,{label:"Total paid",tone:"emerald",children:n.jsx(Es,{value:k.paid})}),n.jsx($v,{label:"Pending",tone:"amber",children:n.jsx(Es,{value:k.pending})}),n.jsx($v,{label:"Overdue invoices",tone:"rose",children:k.overdue})]})]}),n.jsxs("div",{className:"p-4 sm:p-6 space-y-3",children:[n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/75 backdrop-blur p-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("div",{className:"mt-0.5 rounded-2xl border border-slate-500 bg-slate-50 p-2",children:n.jsx(gr,{className:"h-4 w-4 text-slate-700"})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"What is this screen?"}),n.jsxs("div",{className:"text-xs text-slate-600 mt-0.5 leading-relaxed",children:["One-month supplier summary: ",n.jsx("b",{children:"Total Purchase"}),", ",n.jsx("b",{children:"Paid"}),", ",n.jsx("b",{children:"Pending"}),", and ",n.jsx("b",{children:"Overdue count"}),"."]})]})]}),n.jsx(ge,{size:"sm",variant:"ghost",className:"h-9 rounded-full",onClick:()=>j(A=>!A),children:v?"Hide":"Show"})]}),v&&n.jsxs("div",{className:"mt-3 grid gap-2 sm:grid-cols-3",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"How to use"}),n.jsx("div",{className:"text-xs text-slate-700 mt-1",children:"Select month  Load  Export Excel."})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Validation"}),n.jsx("div",{className:"text-xs text-slate-700 mt-1",children:"Month required (YYYY-MM)."})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Tip"}),n.jsx("div",{className:"text-xs text-slate-700 mt-1",children:"Use search to jump to a supplier."})]})]})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/75 backdrop-blur p-3",children:[n.jsx("label",{className:"block text-[11px] text-slate-500 mb-1",children:"Search supplier"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-3 text-slate-400"}),n.jsx(Ee,{className:"h-10 pl-9 bg-white rounded-full border-slate-500",placeholder:"Type supplier name",value:g,onChange:A=>y(A.target.value)})]})]}),o?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-28 w-full rounded-3xl"}),n.jsx(Qe,{className:"h-28 w-full rounded-3xl"})]}):d?n.jsxs("div",{className:"rounded-3xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900 flex items-start gap-2",children:[n.jsx(en,{className:"w-4 h-4 mt-0.5"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"font-semibold",children:"Couldnt load monthly summary"}),n.jsx("div",{className:"text-xs text-amber-800 mt-1",children:d}),n.jsx(ge,{size:"sm",variant:"outline",className:"mt-3 h-9 rounded-full",onClick:()=>S(r),children:"Retry"})]})]}):E.length===0?n.jsx("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4 text-sm text-slate-500",children:"No data found for this month."}):n.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:E.map(A=>n.jsxs("div",{className:"rounded-3xl border border-slate-500/70 bg-white/80 backdrop-blur p-4 shadow-[0_10px_30px_rgba(2,6,23,0.06)]",children:[n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:w(A.supplier_id)}),n.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Month: ",A.month]})]}),n.jsxs("div",{className:"text-xs rounded-full border border-slate-500 bg-slate-50 px-3 py-1 shrink-0",children:["Overdue: ",n.jsx("span",{className:"font-semibold",children:A.overdue_invoices})]})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[n.jsxs("div",{className:"rounded-2xl bg-slate-50 p-3 border border-slate-500",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Total purchase"}),n.jsx("div",{className:"text-base font-semibold mt-1",children:n.jsx(Es,{value:A.total_purchase})})]}),n.jsxs("div",{className:"rounded-2xl bg-slate-50 p-3 border border-slate-500",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Total paid"}),n.jsx("div",{className:"text-base font-semibold mt-1",children:n.jsx(Es,{value:A.total_paid})})]}),n.jsxs("div",{className:"rounded-2xl bg-slate-50 p-3 border border-slate-500 col-span-2",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Pending"}),n.jsx("div",{className:"text-base font-semibold mt-1",children:n.jsx(Es,{value:A.pending_amount})}),n.jsxs("div",{className:"text-xs text-slate-500 mt-2",children:["Last payment: ",A.last_payment_date?Ar(A.last_payment_date):""]})]})]})]},A.supplier_id))})]}),n.jsxs("div",{className:"sm:hidden sticky bottom-0 px-4 py-3 bg-white/70 backdrop-blur-xl border-t border-slate-500/60 flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",className:"h-10 rounded-full w-full",onClick:()=>S(r),disabled:o||!r,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Load"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full w-full border-slate-500 bg-white",disabled:!r||!s,onClick:()=>r&&Rh(()=>d$(r)),children:[n.jsx(nn,{className:"w-4 h-4 mr-2"}),"Excel"]})]})]})}):n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm overflow-hidden",children:[n.jsxs(gt,{className:"space-y-1",children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Monthly Summary"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Permission required."})]}),n.jsx(it,{children:n.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:["You do not have permission to view Supplier Monthly Summary.",n.jsxs("div",{className:"mt-2 text-xs",children:["Ask Admin to enable:"," ",n.jsx("span",{className:"font-mono",children:"pharmacy.accounts.supplier_ledger.monthly_summary.view"})]})]})})]})}var hS="Checkbox",[qQe]=fc(hS),[GQe,lI]=qQe(hS);function KQe(t){const{__scopeCheckbox:s,checked:r,children:a,defaultChecked:i,disabled:l,form:o,name:c,onCheckedChange:d,required:u,value:m="on",internal_do_not_use_render:x}=t,[g,y]=pm({prop:r,defaultProp:i??!1,onChange:d,caller:hS}),[v,j]=p.useState(null),[w,S]=p.useState(null),E=p.useRef(!1),k=v?!!o||!!v.closest("form"):!0,A={checked:g,disabled:l,setChecked:y,control:v,setControl:j,name:c,form:o,value:m,hasConsumerStoppedPropagationRef:E,required:u,defaultChecked:dm(i)?!1:i,isFormControl:k,bubbleInput:w,setBubbleInput:S};return n.jsx(GQe,{scope:s,...A,children:YQe(x)?x(A):a})}var _ne="CheckboxTrigger",Sne=p.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:r,...a},i)=>{const{control:l,value:o,disabled:c,checked:d,required:u,setControl:m,setChecked:x,hasConsumerStoppedPropagationRef:g,isFormControl:y,bubbleInput:v}=lI(_ne,t),j=Fs(i,m),w=p.useRef(d);return p.useEffect(()=>{const S=l==null?void 0:l.form;if(S){const E=()=>x(w.current);return S.addEventListener("reset",E),()=>S.removeEventListener("reset",E)}},[l,x]),n.jsx(us.button,{type:"button",role:"checkbox","aria-checked":dm(d)?"mixed":d,"aria-required":u,"data-state":Tne(d),"data-disabled":c?"":void 0,disabled:c,value:o,...a,ref:j,onKeyDown:zt(s,S=>{S.key==="Enter"&&S.preventDefault()}),onClick:zt(r,S=>{x(E=>dm(E)?!0:!E),v&&y&&(g.current=S.isPropagationStopped(),g.current||S.stopPropagation())})})});Sne.displayName=_ne;var oI=p.forwardRef((t,s)=>{const{__scopeCheckbox:r,name:a,checked:i,defaultChecked:l,required:o,disabled:c,value:d,onCheckedChange:u,form:m,...x}=t;return n.jsx(KQe,{__scopeCheckbox:r,checked:i,defaultChecked:l,disabled:c,required:o,onCheckedChange:u,name:a,form:m,value:d,internal_do_not_use_render:({isFormControl:g})=>n.jsxs(n.Fragment,{children:[n.jsx(Sne,{...x,ref:s,__scopeCheckbox:r}),g&&n.jsx(Ene,{__scopeCheckbox:r})]})})});oI.displayName=hS;var Cne="CheckboxIndicator",kne=p.forwardRef((t,s)=>{const{__scopeCheckbox:r,forceMount:a,...i}=t,l=lI(Cne,r);return n.jsx(fl,{present:a||dm(l.checked)||l.checked===!0,children:n.jsx(us.span,{"data-state":Tne(l.checked),"data-disabled":l.disabled?"":void 0,...i,ref:s,style:{pointerEvents:"none",...t.style}})})});kne.displayName=Cne;var Ane="CheckboxBubbleInput",Ene=p.forwardRef(({__scopeCheckbox:t,...s},r)=>{const{control:a,hasConsumerStoppedPropagationRef:i,checked:l,defaultChecked:o,required:c,disabled:d,name:u,value:m,form:x,bubbleInput:g,setBubbleInput:y}=lI(Ane,t),v=Fs(r,y),j=gP(l),w=UT(a);p.useEffect(()=>{const E=g;if(!E)return;const k=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(k,"checked").set,P=!i.current;if(j!==l&&I){const O=new Event("click",{bubbles:P});E.indeterminate=dm(l),I.call(E,dm(l)?!1:l),E.dispatchEvent(O)}},[g,j,l,i]);const S=p.useRef(dm(l)?!1:l);return n.jsx(us.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??S.current,required:c,disabled:d,name:u,value:m,form:x,...s,tabIndex:-1,ref:v,style:{...s.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ene.displayName=Ane;function YQe(t){return typeof t=="function"}function dm(t){return t==="indeterminate"}function Tne(t){return dm(t)?"indeterminate":t?"checked":"unchecked"}const Og=p.forwardRef(({className:t,...s},r)=>n.jsx(oI,{ref:r,className:Bt("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:n.jsx(kne,{className:Bt("grid place-content-center text-current"),children:n.jsx(So,{className:"h-4 w-4"})})}));Og.displayName=oI.displayName;const cI="__none__",XQe=t=>t===""||t==null?cI:String(t),QQe=t=>t===cI?"":t;function ZQe({children:t}){return n.jsx("div",{className:"rounded-[28px] border border-slate-500/70 bg-gradient-to-b from-white to-slate-50 shadow-[0_18px_50px_rgba(2,6,23,0.08)] overflow-hidden",children:t})}function zv({label:t,children:s}){return n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white/80 backdrop-blur p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:t}),n.jsx("div",{className:"mt-1 text-base font-semibold text-slate-900 leading-none",children:s})]})}function JQe(){var R;const t=ct("pharmacy.accounts.supplier_payments.view"),s=ct("pharmacy.accounts.supplier_payments.manage"),[r,a]=p.useState([]),[i,l]=p.useState(""),[o,c]=p.useState(!1),[d,u]=p.useState([]),[m,x]=p.useState(!1),[g,y]=p.useState(!1),[v,j]=p.useState({payment_date:"",payment_method:"CASH",reference_no:"",amount:"",remarks:"",auto_allocate:!0}),[w,S]=p.useState({}),[E,k]=p.useState(""),A=async()=>{if(t)try{const F=await px();a(F.data||[])}catch{}},I=async()=>{var F,G;if(t&&i){c(!0);try{const H=await Pw({supplier_id:Number(i),status:"UNPAID"}),$=await Pw({supplier_id:Number(i),status:"PARTIAL"}),K=[...H.data||[],...$.data||[]];K.sort((le,se)=>new Date(le.invoice_date||0)-new Date(se.invoice_date||0)),u(K)}catch(H){const $=((G=(F=H==null?void 0:H.response)==null?void 0:F.data)==null?void 0:G.detail)||"Failed to load invoices.";u([]),ae.error("Failed to load pending invoices",{description:$})}finally{c(!1)}}};p.useEffect(()=>{A()},[t]),p.useEffect(()=>{u([]),S({}),i&&I()},[i,t]);const P=p.useMemo(()=>{const F=E.trim().toLowerCase();return F?(d||[]).filter(G=>[G.invoice_number,G.grn_number,Ar(G.invoice_date),Ar(G.due_date)].filter(Boolean).join(" ").toLowerCase().includes(F)):d},[d,E]),O=p.useMemo(()=>Object.values(w).reduce((F,G)=>F+Number(G||0),0),[w]),D=p.useMemo(()=>(P||[]).reduce((F,G)=>F+Number(G.outstanding_amount||0),0),[P]),T=F=>{s&&S(G=>{const H={...G};return H[F.id]?(delete H[F.id],H):(H[F.id]=Number(F.outstanding_amount||0),H)})},B=(F,G)=>{s&&S(H=>({...H,[F]:G}))},U=()=>{if(!s)return ae.error("You do not have permission to allocate payments.");const F=Number(v.amount||0);if(!(F>0))return ae.error("Enter payment amount first");let G=F;const H={};for(const $ of d){if(G<=0)break;const K=Number($.outstanding_amount||0);if(K<=0)continue;const le=Math.min(K,G);H[$.id]=le,G-=le}S(H),ae.success("Auto allocation prepared (oldest first)")},W=async()=>{var H,$;if(!s)return ae.error("You do not have permission to create supplier payments.");if(!i)return ae.error("Select supplier");const F=Number(v.amount||0);if(!(F>0))return ae.error("Enter payment amount");const G=Object.entries(w).map(([K,le])=>({invoice_id:Number(K),amount:Number(le||0)})).filter(K=>K.amount>0);if(!v.auto_allocate&&G.length===0)return ae.error("Select invoices or enable Auto allocate");if(!v.auto_allocate&&O-F>.009)return ae.error(`Allocated ${O.toFixed(2)} but payment is ${F.toFixed(2)}`);y(!0);try{await BQe({supplier_id:Number(i),amount:F,payment_date:v.payment_date||void 0,payment_method:v.payment_method,reference_no:v.reference_no||void 0,remarks:v.remarks||"",auto_allocate:!!v.auto_allocate,allocations:v.auto_allocate?void 0:G}),ae.success("Payment saved"),x(!1),j({payment_date:"",payment_method:"CASH",reference_no:"",amount:"",remarks:"",auto_allocate:!0}),S({}),I()}catch(K){const le=(($=(H=K==null?void 0:K.response)==null?void 0:H.data)==null?void 0:$.detail)||"Failed to save payment.";ae.error("Save failed",{description:le})}finally{y(!1)}};if(!t)return n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"space-y-1",children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Supplier Payments"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Permission required."})]}),n.jsx(it,{children:n.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:["You do not have permission to view Supplier Payments.",n.jsxs("div",{className:"mt-2 text-xs",children:["Ask Admin to enable:"," ",n.jsx("span",{className:"font-mono",children:"pharmacy.accounts.supplier_payments.view"})]})]})})]});const V=((R=r.find(F=>String(F.id)===String(i)))==null?void 0:R.name)||"";return n.jsxs(ZQe,{children:[n.jsxs("div",{className:"px-4 sm:px-6 py-4 bg-white/70 backdrop-blur-xl border-b border-slate-500/60",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-10 w-10 rounded-2xl bg-slate-900 text-white flex items-center justify-center shadow-sm",children:n.jsx(gr,{className:"h-5 w-5"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-base sm:text-lg font-semibold text-slate-900 leading-tight",children:"Supplier Payments"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Select supplier  view pending invoices  record payment (full/partial/advance)."})]})]}),!!i&&n.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Active supplier:"," ",n.jsx("span",{className:"font-medium text-slate-700",children:V})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur",onClick:I,disabled:!i,children:[n.jsx(ps,{className:"w-4 h-4"})," Refresh"]}),n.jsxs(ge,{size:"sm",className:"h-10 rounded-full gap-2",onClick:()=>x(!0),disabled:!i||!s,title:s?void 0:"No permission to add payments",children:[n.jsx(ds,{className:"w-4 h-4"})," Add Payment"]})]})]}),n.jsxs("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:[n.jsx(zv,{label:"Pending invoices",children:P.length}),n.jsx(zv,{label:"Outstanding total",children:n.jsx(Es,{value:D})}),n.jsx(zv,{label:"Selected allocation",children:n.jsx(Es,{value:O})}),n.jsx(zv,{label:"Mode",children:s?"Manage":"View only"})]})]}),n.jsxs("div",{className:"p-4 sm:p-6 space-y-3",children:[n.jsxs("div",{className:"grid gap-2 lg:grid-cols-12",children:[n.jsxs("div",{className:"lg:col-span-4",children:[n.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Supplier"}),n.jsxs(Zs,{value:XQe(i),onValueChange:F=>l(QQe(F)),children:[n.jsx(Ws,{className:"h-10 bg-white rounded-full border-slate-500",children:n.jsx(Js,{placeholder:"Select supplier"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:cI,children:"Select supplier"}),r.map(F=>n.jsx(Ut,{value:String(F.id),children:F.name},F.id))]})]})]}),n.jsxs("div",{className:"lg:col-span-8",children:[n.jsx("div",{className:"text-[11px] text-slate-500 mb-1",children:"Search"}),n.jsxs("div",{className:"relative",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-3 text-slate-400"}),n.jsx(Ee,{className:"h-10 pl-9 bg-white rounded-full border-slate-500",placeholder:"Search invoice / GRN / date",value:E,onChange:F=>k(F.target.value)})]})]})]}),n.jsxs("div",{className:"hidden md:block rounded-3xl border border-slate-500 bg-white/80 backdrop-blur overflow-hidden",children:[n.jsxs("div",{className:"grid grid-cols-[0.25fr,1.2fr,1.1fr,0.9fr,0.9fr,0.8fr] px-4 py-2 text-xs font-semibold text-slate-500 bg-slate-50",children:[n.jsx("span",{}),n.jsx("span",{children:"Invoice"}),n.jsx("span",{children:"Date / Due"}),n.jsx("span",{children:"Amount"}),n.jsx("span",{children:"Outstanding"}),n.jsx("span",{children:"Status"})]}),o?n.jsxs("div",{className:"p-4 space-y-2",children:[n.jsx(Qe,{className:"h-10 w-full rounded-2xl"}),n.jsx(Qe,{className:"h-10 w-full rounded-2xl"})]}):i?P.length===0?n.jsx("div",{className:"p-6 text-sm text-slate-500",children:"No unpaid/partial invoices."}):n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:P.map(F=>n.jsxs("div",{className:"grid grid-cols-[0.25fr,1.2fr,1.1fr,0.9fr,0.9fr,0.8fr] items-center px-4 py-3 text-xs hover:bg-slate-50/60 transition-colors",children:[n.jsx(Og,{checked:!!w[F.id],onCheckedChange:()=>T(F),disabled:!s}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-slate-900",children:F.invoice_number||F.grn_number||`#${F.id}`}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["GRN: ",F.grn_number||""]})]}),n.jsxs("div",{className:"text-slate-700",children:[n.jsx("div",{children:Ar(F.invoice_date)}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Due: ",Ar(F.due_date)]})]}),n.jsx(Es,{value:F.invoice_amount}),n.jsx(Es,{value:F.outstanding_amount}),n.jsx(Lh,{inv:F})]},F.id))}):n.jsx("div",{className:"p-6 text-sm text-slate-500",children:"Select a supplier to view pending invoices."})]}),n.jsx("div",{className:"md:hidden space-y-2",children:o?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Qe,{className:"h-24 w-full rounded-3xl"}),n.jsx(Qe,{className:"h-24 w-full rounded-3xl"})]}):i?P.length===0?n.jsx("div",{className:"rounded-3xl border border-slate-500 bg-white/80 backdrop-blur p-4 text-sm text-slate-500",children:"No unpaid/partial invoices."}):P.map(F=>n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white/85 backdrop-blur p-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-semibold text-slate-900 truncate",children:F.invoice_number||F.grn_number||`#${F.id}`}),n.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["GRN: ",F.grn_number||""]}),n.jsxs("div",{className:"text-xs text-slate-500",children:[Ar(F.invoice_date),"  Due ",Ar(F.due_date)]})]}),n.jsx("div",{className:"flex items-center gap-2 shrink-0",children:n.jsx(Og,{checked:!!w[F.id],onCheckedChange:()=>T(F),disabled:!s})})]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Amount"}),n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:F.invoice_amount})})]}),n.jsxs("div",{className:"rounded-2xl border border-slate-500 bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Outstanding"}),n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:F.outstanding_amount})})]}),n.jsxs("div",{className:"col-span-2 flex items-center justify-between",children:[n.jsx(Lh,{inv:F}),n.jsx("div",{className:"text-[11px] text-slate-500",children:"Select to allocate"})]})]})]},F.id)):n.jsx("div",{className:"rounded-3xl border border-slate-500 bg-white/80 backdrop-blur p-4 text-sm text-slate-500",children:"Select a supplier to view pending invoices."})}),n.jsxs("div",{className:"md:hidden sticky bottom-0 -mx-4 px-4 py-3 bg-white/70 backdrop-blur-xl border-t border-slate-500/60 flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-11 rounded-full w-full border-slate-500 bg-white",onClick:I,disabled:!i,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Refresh"]}),n.jsxs(ge,{size:"sm",className:"h-11 rounded-full w-full",onClick:()=>x(!0),disabled:!i||!s,children:[n.jsx(ds,{className:"w-4 h-4 mr-2"}),"Add"]})]}),n.jsx(Wa,{open:m,onOpenChange:F=>s?x(F):null,children:n.jsxs(va,{className:"sm:max-w-3xl w-[calc(100vw-20px)] sm:w-full rounded-[28px] bg-white/90 backdrop-blur-xl border-slate-500 max-h-[85vh] overflow-y-auto",children:[n.jsx(ii,{children:n.jsx(li,{className:"text-base",children:"Record Payment"})}),s?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid gap-3 sm:grid-cols-3 text-sm",children:[n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Payment date"}),n.jsx(Ee,{type:"date",className:"h-10 bg-white rounded-full border-slate-500",value:v.payment_date,onChange:F=>j(G=>({...G,payment_date:F.target.value}))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Method"}),n.jsxs(Zs,{value:v.payment_method,onValueChange:F=>j(G=>({...G,payment_method:F})),children:[n.jsx(Ws,{className:"h-10 bg-white rounded-full border-slate-500",children:n.jsx(Js,{})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:"CASH",children:"Cash"}),n.jsx(Ut,{value:"UPI",children:"UPI"}),n.jsx(Ut,{value:"BANK",children:"Bank"}),n.jsx(Ut,{value:"CHEQUE",children:"Cheque"})]})]})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Reference No"}),n.jsx(Ee,{className:"h-10 bg-white rounded-full border-slate-500",value:v.reference_no,onChange:F=>j(G=>({...G,reference_no:F.target.value}))})]}),n.jsxs("div",{className:"space-y-1.5 sm:col-span-2",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Remarks"}),n.jsx(Ee,{className:"h-10 bg-white rounded-full border-slate-500",value:v.remarks,onChange:F=>j(G=>({...G,remarks:F.target.value}))})]}),n.jsxs("div",{className:"space-y-1.5",children:[n.jsx("div",{className:"text-xs text-slate-500",children:"Amount"}),n.jsx(Ee,{type:"number",step:"0.01",className:"h-10 bg-white rounded-full border-slate-500",value:v.amount,onChange:F=>j(G=>({...G,amount:F.target.value}))})]})]}),n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-slate-50/70 p-4",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[n.jsx("div",{className:"font-semibold text-slate-900",children:"Allocation"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"text-xs text-slate-600 flex items-center gap-2",children:[n.jsx("input",{type:"checkbox",checked:v.auto_allocate,onChange:F=>j(G=>({...G,auto_allocate:F.target.checked}))}),"Auto allocate (oldest first)"]}),!v.auto_allocate&&n.jsxs(ge,{size:"sm",variant:"outline",className:"h-9 rounded-full gap-2",onClick:U,children:[n.jsx(R3,{className:"w-4 h-4"})," Auto preview"]})]})]}),n.jsxs("div",{className:"mt-2 text-xs text-slate-600",children:["Payment: ",n.jsx("span",{className:"font-semibold",children:n.jsx(Es,{value:v.amount})}),"  Selected: ",n.jsx("span",{className:"font-semibold",children:n.jsx(Es,{value:O})})]}),!v.auto_allocate&&n.jsxs("div",{className:"mt-3 max-h-[240px] overflow-auto rounded-2xl border border-slate-500 bg-white",children:[n.jsxs("div",{className:"grid grid-cols-[0.2fr,1.4fr,0.8fr,0.8fr] px-3 py-2 text-xs font-semibold text-slate-500 bg-slate-50 sticky top-0",children:[n.jsx("span",{}),n.jsx("span",{children:"Invoice"}),n.jsx("span",{children:"Outstanding"}),n.jsx("span",{children:"Pay now"})]}),n.jsx("div",{className:"divide-y",children:d.map(F=>{const G=!!w[F.id];return n.jsxs("div",{className:"grid grid-cols-[0.2fr,1.4fr,0.8fr,0.8fr] items-center px-3 py-2 text-xs",children:[n.jsx(Og,{checked:G,onCheckedChange:()=>T(F)}),n.jsx("div",{className:"text-slate-900 font-medium truncate",children:F.invoice_number||F.grn_number||`#${F.id}`}),n.jsx(Es,{value:F.outstanding_amount}),n.jsx(Ee,{disabled:!G,type:"number",step:"0.01",className:"h-9 bg-white rounded-full border-slate-500",value:G?String(w[F.id]??""):"",onChange:H=>{const $=Number(H.target.value||0),K=Number(F.outstanding_amount||0);B(F.id,Math.min(Math.max($,0),K))}})]},F.id)})})]}),n.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Any extra amount becomes ",n.jsx("span",{className:"font-medium",children:"Advance"}),"."]})]}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(ge,{variant:"outline",onClick:()=>x(!1),className:"h-10 rounded-full",children:"Cancel"}),n.jsxs(ge,{onClick:W,disabled:g,className:"h-10 rounded-full gap-2",children:[n.jsx(Xt,{className:"w-4 h-4"}),g?"Saving":"Save Payment"]})]})]}):n.jsxs("div",{className:"rounded-3xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:["You do not have permission to create supplier payments.",n.jsxs("div",{className:"mt-2 text-xs",children:["Ask Admin to enable:"," ",n.jsx("span",{className:"font-mono",children:"pharmacy.accounts.supplier_payments.manage"})]})]})]})})]})]})}const dI="__none__",eZe=t=>t===""||t==null?dI:String(t),tZe=t=>t===dI?"":t;function sZe({children:t}){return n.jsx("div",{className:"rounded-[28px] border border-slate-500/70 bg-gradient-to-b from-white to-slate-50 shadow-[0_18px_50px_rgba(2,6,23,0.08)] overflow-hidden",children:t})}function Y0({label:t,children:s,tone:r="default"}){const a="rounded-3xl border bg-white/80 backdrop-blur p-3",i=r==="emerald"?"border-emerald-200 bg-emerald-50/70":r==="amber"?"border-amber-200 bg-amber-50/70":"border-slate-500";return n.jsxs("div",{className:`${a} ${i}`,children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:t}),n.jsx("div",{className:"mt-1 text-base font-semibold text-slate-900 leading-none",children:s})]})}function nZe({value:t,onChange:s,items:r}){return n.jsx("div",{className:"inline-flex rounded-full border border-slate-500 bg-white/70 backdrop-blur p-1",children:r.map(a=>{const i=a.value===t;return n.jsx("button",{type:"button",onClick:()=>s(a.value),className:["px-3 py-1.5 text-xs rounded-full transition",i?"bg-slate-900 text-white shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-slate-50"].join(" "),children:a.label},a.value)})})}function rZe(){var D;const t=ct("pharmacy.accounts.supplier_ledger.view"),s=ct("pharmacy.accounts.supplier_ledger.export"),[r,a]=p.useState([]),[i,l]=p.useState(""),[o,c]=p.useState(!1),[d,u]=p.useState(!1),[m,x]=p.useState([]),[g,y]=p.useState([]),[v,j]=p.useState("both"),[w,S]=p.useState(""),E=o||d;p.useEffect(()=>{t&&(async()=>{try{const T=await px();a(T.data||[])}catch{}})()},[t]);const k=((D=r.find(T=>String(T.id)===String(i)))==null?void 0:D.name)||"",A=async()=>{var T,B;if(t&&i){c(!0),u(!0);try{const[U,W]=await Promise.all([Pw({supplier_id:Number(i)}),wne({supplier_id:Number(i)})]);x(U.data||[]),y(W.data||[])}catch(U){x([]),y([]);const W=((B=(T=U==null?void 0:U.response)==null?void 0:T.data)==null?void 0:B.detail)||"Failed to load supplier statement.";ae.error("Supplier Statement load failed",{description:W})}finally{c(!1),u(!1)}}};p.useEffect(()=>{x([]),y([]),i&&A()},[i,t]);const I=p.useMemo(()=>{const T=w.trim().toLowerCase();return T?(m||[]).filter(B=>[B.invoice_number,B.grn_number,Ar(B.invoice_date),Ar(B.due_date),B.status].filter(Boolean).join(" ").toLowerCase().includes(T)):m},[m,w]),P=p.useMemo(()=>{const T=w.trim().toLowerCase();return T?(g||[]).filter(B=>[Ar(B.payment_date),B.payment_method,B.reference_no,B.remarks].filter(Boolean).join(" ").toLowerCase().includes(T)):g},[g,w]),O=p.useMemo(()=>{const T=(m||[]).reduce((R,F)=>R+Number(F.invoice_amount||0),0),B=(m||[]).reduce((R,F)=>R+Number(F.paid_amount||0),0),U=(m||[]).reduce((R,F)=>R+Number(F.outstanding_amount||0),0),W=(g||[]).reduce((R,F)=>R+Number(F.advance_amount||0),0),V=Math.max(U-W,0);return{totalInv:T,totalPaid:B,totalOut:U,adv:W,netPayable:V}},[m,g]);return t?n.jsxs(sZe,{children:[n.jsxs("div",{className:"px-4 sm:px-6 py-4 bg-white/70 backdrop-blur-xl border-b border-slate-500/60",children:[n.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-base sm:text-lg font-semibold text-slate-900",children:"Supplier Statement"}),n.jsx("div",{className:"text-xs text-slate-500",children:"Invoices + Payments + Net balance  perfect for reconciliation."}),!!i&&n.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Supplier: ",n.jsx("span",{className:"font-medium text-slate-700",children:k})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[n.jsxs(Zs,{value:eZe(i),onValueChange:T=>l(tZe(T)),children:[n.jsx(Ws,{className:"h-10 bg-white rounded-full w-full sm:w-80 border-slate-500",children:n.jsx(Js,{placeholder:"Select supplier"})}),n.jsxs(qs,{children:[n.jsx(Ut,{value:dI,children:"Select supplier"}),r.map(T=>n.jsx(Ut,{value:String(T.id),children:T.name},T.id))]})]}),n.jsxs(ge,{size:"sm",className:"h-10 rounded-full gap-2",onClick:A,disabled:!i||E,children:[n.jsx(ps,{className:"w-4 h-4"}),"Load"]}),n.jsxs(ge,{size:"sm",variant:"outline",className:"h-10 rounded-full gap-2 border-slate-500 bg-white/70 backdrop-blur",disabled:!i||!s,title:s?void 0:"No permission to export",onClick:()=>Rh(()=>Ig({supplier_id:Number(i)})),children:[n.jsx(nn,{className:"w-4 h-4"}),"Excel"]})]})]}),n.jsxs("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-5 gap-2",children:[n.jsx(Y0,{label:"Total purchase",children:n.jsx(Es,{value:O.totalInv})}),n.jsx(Y0,{label:"Total paid",children:n.jsx(Es,{value:O.totalPaid})}),n.jsx(Y0,{label:"Outstanding",tone:"amber",children:n.jsx(Es,{value:O.totalOut})}),n.jsx(Y0,{label:"Advance",tone:"emerald",children:n.jsx(Es,{value:O.adv})}),n.jsx(Y0,{label:"Net payable",children:n.jsx(Es,{value:O.netPayable})})]}),n.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[n.jsxs("div",{className:"relative w-full sm:max-w-md",children:[n.jsx(Yt,{className:"w-4 h-4 absolute left-3 top-3 text-slate-400"}),n.jsx(Ee,{className:"h-10 pl-9 bg-white rounded-full border-slate-500",placeholder:"Search invoice / GRN / method / ref / remark",value:w,onChange:T=>S(T.target.value)})]}),n.jsx(nZe,{value:v,onChange:j,items:[{value:"both",label:"Both"},{value:"invoices",label:"Invoices"},{value:"payments",label:"Payments"}]})]})]}),n.jsxs("div",{className:"p-4 sm:p-6 space-y-3",children:[E&&n.jsxs("div",{className:"grid gap-2 lg:grid-cols-2",children:[n.jsx(Qe,{className:"h-48 w-full rounded-3xl"}),n.jsx(Qe,{className:"h-48 w-full rounded-3xl"})]}),!E&&!i&&n.jsx("div",{className:"rounded-3xl border border-slate-500 bg-white/80 backdrop-blur p-4 text-sm text-slate-500",children:"Select a supplier to load statement."}),!E&&i&&n.jsxs("div",{className:["grid gap-3",v==="both"?"lg:grid-cols-2":"grid-cols-1"].join(" "),children:[(v==="both"||v==="invoices")&&n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white/85 backdrop-blur overflow-hidden",children:[n.jsxs("div",{className:"px-4 py-3 bg-slate-50 border-b border-slate-500 flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Invoices"}),n.jsxs("div",{className:"text-xs text-slate-500",children:[I.length," item(s)"]})]}),I.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No invoices."}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"hidden md:block",children:[n.jsxs("div",{className:"grid grid-cols-[1.3fr,0.9fr,1fr,1fr,1fr,0.9fr] px-4 py-2 text-[11px] font-semibold text-slate-500",children:[n.jsx("span",{children:"Invoice / GRN"}),n.jsx("span",{children:"Date"}),n.jsx("span",{children:"Amount"}),n.jsx("span",{children:"Paid"}),n.jsx("span",{children:"Outstanding"}),n.jsx("span",{children:"Status"})]}),n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:I.slice(0,50).map(T=>n.jsxs("div",{className:"grid grid-cols-[1.3fr,0.9fr,1fr,1fr,1fr,0.9fr] px-4 py-3 text-xs hover:bg-slate-50/60 transition-colors",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-medium text-slate-900 truncate",children:T.invoice_number||T.grn_number||`#${T.id}`}),n.jsxs("div",{className:"text-[11px] text-slate-500 truncate",children:["Due: ",Ar(T.due_date)]})]}),n.jsx("div",{className:"text-slate-700",children:Ar(T.invoice_date)}),n.jsx(Es,{value:T.invoice_amount}),n.jsx(Es,{value:T.paid_amount}),n.jsx(Es,{value:T.outstanding_amount}),n.jsx(Lh,{inv:T})]},T.id))})]}),n.jsx("div",{className:"md:hidden max-h-[520px] overflow-auto p-3 space-y-2",children:I.slice(0,50).map(T=>n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white p-4",children:[n.jsx("div",{className:"font-semibold text-slate-900",children:T.invoice_number||T.grn_number||`#${T.id}`}),n.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[Ar(T.invoice_date),"  Due ",Ar(T.due_date)]}),n.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[n.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Amount"}),n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:T.invoice_amount})})]}),n.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[n.jsx("div",{className:"text-[11px] text-slate-500",children:"Outstanding"}),n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:T.outstanding_amount})})]}),n.jsxs("div",{className:"col-span-2 flex items-center justify-between",children:[n.jsxs("div",{className:"text-xs text-slate-500",children:["Paid: ",n.jsx(Es,{value:T.paid_amount})]}),n.jsx(Lh,{inv:T})]})]})]},T.id))})]})]}),(v==="both"||v==="payments")&&n.jsxs("div",{className:"rounded-3xl border border-slate-500 bg-white/85 backdrop-blur overflow-hidden",children:[n.jsxs("div",{className:"px-4 py-3 bg-slate-50 border-b border-slate-500 flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"Payments"}),n.jsxs("div",{className:"text-xs text-slate-500",children:[P.length," item(s)"]})]}),P.length===0?n.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No payments."}):n.jsx("div",{className:"max-h-[520px] overflow-auto divide-y divide-slate-100",children:P.slice(0,50).map(T=>n.jsxs("div",{className:"px-4 py-3 text-xs hover:bg-slate-50/60 transition-colors flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"font-medium text-slate-900",children:[Ar(T.payment_date),"  ",T.payment_method]}),n.jsxs("div",{className:"text-[11px] text-slate-500 truncate",children:[T.reference_no||""," ",T.remarks?` ${T.remarks}`:""]})]}),n.jsxs("div",{className:"text-right shrink-0",children:[n.jsx("div",{className:"font-semibold",children:n.jsx(Es,{value:T.amount})}),n.jsxs("div",{className:"text-[11px] text-slate-500",children:["Alloc ",n.jsx(Es,{value:T.allocated_amount}),"  Adv ",n.jsx(Es,{value:T.advance_amount})]})]})]},T.id))})]})]}),n.jsxs("div",{className:"sm:hidden sticky bottom-0 -mx-4 px-4 py-3 bg-white/70 backdrop-blur-xl border-t border-slate-500/60 flex items-center gap-2",children:[n.jsxs(ge,{size:"sm",variant:"outline",className:"h-11 rounded-full w-full border-slate-500 bg-white",onClick:A,disabled:!i||E,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Load"]}),n.jsxs(ge,{size:"sm",className:"h-11 rounded-full w-full",disabled:!i||!s,onClick:()=>Rh(()=>Ig({supplier_id:Number(i)})),children:[n.jsx(nn,{className:"w-4 h-4 mr-2"}),"Excel"]})]})]})]}):n.jsxs(dt,{className:"rounded-3xl border-slate-500 shadow-sm",children:[n.jsxs(gt,{className:"space-y-1",children:[n.jsx(jt,{className:"text-sm font-semibold text-slate-900",children:"Supplier Statement"}),n.jsx("p",{className:"text-xs text-slate-500",children:"Permission required."})]}),n.jsx(it,{children:n.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:["You do not have permission to view Supplier Statement.",n.jsxs("div",{className:"mt-2 text-xs",children:["Ask Admin to enable:"," ",n.jsx("span",{className:"font-mono",children:"pharmacy.accounts.supplier_ledger.view"})]})]})})]})}const bd={skipTenantHeader:!0},aZe=()=>he.get("master/migrations/tenants",{meta:bd}).then(t=>t.data),iZe=t=>he.get(`/master/migrations/tenants/${t}/storage`,{meta:bd}).then(s=>s.data),lZe=()=>he.get("/master/migrations/storage/volumes",{meta:bd}).then(t=>t.data),oZe=()=>he.get("/master/migrations/schema/types",{meta:bd}).then(t=>t.data),cZe=t=>he.post("/master/migrations/plan",t,{meta:{...bd,successToast:!1}}).then(s=>s.data),dZe=t=>he.post("/master/migrations/apply",t,{meta:{...bd,successToast:!0}}).then(s=>s.data),uZe=()=>he.get("/master/migrations/jobs",{meta:bd}).then(t=>t.data),mZe=t=>he.get(`/master/migrations/jobs/${t}`,{meta:bd}).then(s=>s.data),hZe=t=>he.post(`/master/migrations/jobs/${t}/cancel`,{},{meta:{...bd,successToast:!0}}).then(s=>s.data),xZe=(t,s)=>he.patch(`/master/migrations/tenants/${t}/volume`,{volume_tag:s},{meta:{...bd,successToast:"Volume updated"}}).then(r=>r.data),Pne="NUTRYAH";function pZe(t){try{if(!t)return null;const s=t.split(".");if(s.length<2)return null;const a=s[1].replace(/-/g,"+").replace(/_/g,"/"),i=a.length%4?"=".repeat(4-a.length%4):"";return JSON.parse(atob(a+i))}catch{return null}}function fZe(){const t=localStorage.getItem("access_token"),s=pZe(t),r=String((s==null?void 0:s.tcode)||"").trim().toUpperCase(),a=String(localStorage.getItem("tenant_code")||"").trim().toUpperCase(),i=String(Pne).trim().toUpperCase();return r&&r===i||a&&a===i}const Du=(t,s)=>{var r,a,i,l;return((a=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:a.detail)||((l=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:l.message)||(t==null?void 0:t.message)||s},E5=t=>{const s=(t||"").toUpperCase();return{RUNNING:"bg-amber-100 text-amber-800 border-amber-200",DONE:"bg-emerald-100 text-emerald-800 border-emerald-200",FAILED:"bg-rose-100 text-rose-800 border-rose-200",CANCELLED:"bg-slate-100 text-slate-700 border-slate-200",PLANNED:"bg-sky-100 text-sky-800 border-sky-200",PENDING:"bg-slate-100 text-slate-700 border-slate-200",SKIPPED:"bg-slate-100 text-slate-700 border-slate-200"}[s]||"bg-slate-100 text-slate-700 border-slate-200"},p$={add_column:()=>({op:"add_column",table:"",column:{name:"",type:"VARCHAR(255)",nullable:!0,default:null,comment:"",after:null}}),modify_column:()=>({op:"modify_column",table:"",column:{name:"",type:"VARCHAR(255)",nullable:!0,default:null,comment:"",after:null}}),drop_column:()=>({op:"drop_column",table:"",column_name:""}),create_table:()=>({op:"create_table",table:"",columns:[{name:"id",type:"BIGINT",nullable:!1,default:null,comment:""}]}),drop_table:()=>({op:"drop_table",table:""}),rename_column:()=>({op:"rename_column",table:"",old_column_name:"",new_column_name:""}),create_database:()=>({op:"create_database",db_name:""}),drop_database:()=>({op:"drop_database",db_name:""})};function gZe(){var He,pt;if(!fZe())return n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[n.jsx("div",{className:"font-semibold",children:"Provider Only"}),n.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:["You are not in provider tenant. Switch to provider tenant (",Pne,")."]})]})});const[t,s]=p.useState(!0),[r,a]=p.useState([]),[i,l]=p.useState([]),[o,c]=p.useState("builder"),[d,u]=p.useState(""),[m,x]=p.useState(!1),[g,y]=p.useState([]),[v,j]=p.useState("Schema Migration"),[w,S]=p.useState(""),[E,k]=p.useState(!0),[A,I]=p.useState(!1),[P,O]=p.useState(""),[D,T]=p.useState([p$.add_column()]),[B,U]=p.useState(!1),[W,V]=p.useState(null),[R,F]=p.useState(!1),[G,H]=p.useState([]),[$,K]=p.useState(null),[le,se]=p.useState(!1),[J,ie]=p.useState([]),[te,ne]=p.useState({}),q=p.useMemo(()=>{const Pe=d.trim().toLowerCase();return Pe?r.filter(bt=>[bt.name,bt.code,bt.db_name,bt.subscription_plan].filter(Boolean).join(" ").toLowerCase().includes(Pe)):r},[r,d]);p.useMemo(()=>{if(m)return q.filter(bt=>bt.is_active);const Pe=new Set(g);return q.filter(bt=>Pe.has(bt.id))},[m,g,q]);const ee=async()=>{s(!0);try{const[Pe,bt]=await Promise.all([aZe(),oZe()]);a(Pe.items||[]),l(bt.items||[])}catch(Pe){ae.error(Du(Pe,"Failed to load tenants"))}finally{s(!1)}};p.useEffect(()=>{ee()},[]);const X=Pe=>{y(bt=>{const It=new Set(bt);return It.has(Pe)?It.delete(Pe):It.add(Pe),Array.from(It)})},Z=Pe=>T(bt=>[...bt,p$[Pe]()]),Y=Pe=>T(bt=>bt.filter((It,De)=>De!==Pe)),Q=(Pe,bt)=>T(It=>It.map((De,tt)=>tt===Pe?{...De,...bt}:De)),oe=(Pe,bt)=>T(It=>It.map((De,tt)=>tt!==Pe?De:{...De,column:{...De.column||{},...bt}})),_e=(Pe,bt,It)=>T(De=>De.map((tt,ve)=>{if(ve!==Pe)return tt;const Ge=(tt.columns||[]).map((We,Ve)=>Ve===bt?{...We,...It}:We);return{...tt,columns:Ge}})),xe=Pe=>T(bt=>bt.map((It,De)=>De!==Pe?It:{...It,columns:[...It.columns||[],{name:"",type:"VARCHAR(255)",nullable:!0,default:null,comment:""}]})),me=(Pe,bt)=>T(It=>It.map((De,tt)=>tt!==Pe?De:{...De,columns:(De.columns||[]).filter((ve,Ge)=>Ge!==bt)})),Re=()=>({name:v,description:w||null,apply_all:m,tenant_ids:m?[]:g,dry_run:E,allow_destructive:A,confirm_phrase:P||null,client_request_id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,ops:D}),Ze=()=>{var Pe,bt,It,De;if(!(D!=null&&D.length))return ae.error("Add at least one operation"),!1;for(let tt=0;tt<D.length;tt++){const ve=D[tt],Ge=String((ve==null?void 0:ve.op)||"").trim();if(!Ge)return ae.error(`Operation #${tt+1}: missing op type`),!1;if(Ge==="create_database"||Ge==="drop_database"){if(!String((ve==null?void 0:ve.db_name)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Database name is required`),!1;continue}if(!String((ve==null?void 0:ve.table)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Table is required`),!1;if(Ge==="add_column"||Ge==="modify_column"){if(!String(((Pe=ve==null?void 0:ve.column)==null?void 0:Pe.name)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Column name is required`),!1;if(!String(((bt=ve==null?void 0:ve.column)==null?void 0:bt.type)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Column type is required`),!1}if(Ge==="drop_column"&&!String((ve==null?void 0:ve.column_name)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Column name is required`),!1;if(Ge==="rename_column"&&(!String((ve==null?void 0:ve.old_column_name)||"").trim()||!String((ve==null?void 0:ve.new_column_name)||"").trim()))return ae.error(`Operation #${tt+1} (${Ge}): Old + New column names are required`),!1;if(Ge==="create_table"){const We=(ve==null?void 0:ve.columns)||[];if(!Array.isArray(We)||We.length===0)return ae.error(`Operation #${tt+1} (${Ge}): Add at least one column`),!1;for(let Ve=0;Ve<We.length;Ve++){if(!String(((It=We[Ve])==null?void 0:It.name)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Column #${Ve+1} name required`),!1;if(!String(((De=We[Ve])==null?void 0:De.type)||"").trim())return ae.error(`Operation #${tt+1} (${Ge}): Column #${Ve+1} type required`),!1}}}return!0},$e=async()=>{if(!(!m&&g.length===0&&(ae.error("Select at least one tenant (or enable Apply All)."),!Ze()))){U(!0);try{const Pe=await cZe(Re());V(Pe),ae.success("Plan generated")}catch(Pe){ae.error(Du(Pe,"Plan failed"))}finally{U(!1)}}},fe=async()=>{if(!(!W&&(ae.error("Run PLAN first"),!Ze()))&&!(A&&(P||"").trim().toUpperCase()!=="I UNDERSTAND"&&(ae.error('Type "I UNDERSTAND" to allow destructive ops.'),!Ze()))){F(!0);try{const Pe=await dZe(Re());ae.success(`Applied. Job #${Pe.job_id}`),c("jobs"),await Me()}catch(Pe){ae.error(Du(Pe,"Apply failed"))}finally{F(!1)}}},Me=async()=>{try{const Pe=await uZe();H(Pe.items||[])}catch(Pe){ae.error(Du(Pe,"Failed to load jobs"))}},Ae=async Pe=>{se(!0);try{const bt=await mZe(Pe);K(bt)}catch(bt){ae.error(Du(bt,"Failed to load job"))}finally{se(!1)}},Ke=async Pe=>{try{await hZe(Pe),ae.success("Cancel requested"),await Ae(Pe),await Me()}catch(bt){ae.error(Du(bt,"Cancel failed"))}},Le=async()=>{try{const[Pe]=await Promise.all([lZe()]);ie(Pe.items||[]);const bt=r.filter(De=>De.is_active).slice(0,40),It={};for(const De of bt)try{const tt=await iZe(De.id);It[De.id]=tt.used_mb}catch{It[De.id]=null}ne(It)}catch(Pe){ae.error(Du(Pe,"Storage load failed"))}};return p.useEffect(()=>{o==="jobs"&&Me(),o==="storage"&&Le()},[o]),n.jsx(Wn,{perm:"master.migrations.view",children:n.jsx("div",{className:"p-4 md:p-6 space-y-4",children:n.jsxs(mt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"rounded-3xl border bg-gradient-to-b from-white to-slate-50 shadow-sm",children:[n.jsxs("div",{className:"p-5 md:p-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(sN,{className:"h-5 w-5"}),n.jsx("h1",{className:"text-xl md:text-2xl font-semibold tracking-tight",children:"Master Migration Console"}),n.jsx(et,{variant:"outline",className:"rounded-full",children:"Provider Only"})]}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Apply schema changes to all tenants or selected tenants with full audit + job tracking."})]}),n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:ee,disabled:t,children:[n.jsx(ps,{className:"h-4 w-4 mr-2"})," Refresh"]})})]}),n.jsx("div",{className:"px-5 md:px-6 pb-5 md:pb-6",children:n.jsxs(Do,{value:o,onValueChange:c,children:[n.jsxs(Wl,{className:"rounded-2xl",children:[n.jsx(zs,{value:"builder",className:"rounded-xl",children:"Builder"}),n.jsx(zs,{value:"jobs",className:"rounded-xl",children:"Jobs"}),n.jsx(zs,{value:"storage",className:"rounded-xl",children:"Storage"})]}),n.jsx(Ls,{value:"builder",className:"mt-4",children:n.jsxs("div",{className:"grid gap-4 xl:grid-cols-[420px,1fr]",children:[n.jsxs(dt,{className:"rounded-3xl shadow-sm",children:[n.jsxs(gt,{children:[n.jsxs(jt,{className:"flex items-center gap-2",children:[n.jsx(Co,{className:"h-4 w-4"})," Target Tenants"]}),n.jsx(gs,{children:"Select all tenants or only specific hospitals."})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsx("div",{className:"flex items-center justify-between gap-3",children:n.jsx(Ee,{value:d,onChange:Pe=>u(Pe.target.value),placeholder:"Search tenant (name / code / db)...",className:"rounded-2xl"})}),n.jsxs("div",{className:"flex items-center justify-between rounded-2xl border p-3 bg-slate-50",children:[n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-sm",children:"Apply to all active tenants"}),n.jsx("div",{className:"text-xs text-slate-600",children:"Overrides manual selection."})]}),n.jsx(Wc,{checked:m,onCheckedChange:x})]}),n.jsx(Fn,{className:"h-[360px] pr-2",children:n.jsxs("div",{className:"space-y-2",children:[q.map(Pe=>n.jsxs("div",{className:"rounded-2xl border p-3 flex items-center gap-3",children:[n.jsx(Og,{checked:m?Pe.is_active:g.includes(Pe.id),onCheckedChange:()=>X(Pe.id),disabled:m}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"font-medium truncate",children:Pe.name}),!Pe.is_active&&n.jsx(et,{variant:"outline",className:"rounded-full",children:"inactive"})]}),n.jsxs("div",{className:"text-xs text-slate-600 truncate",children:[Pe.code,"  ",Pe.db_name,"  ",Pe.subscription_plan||""]})]}),n.jsx(et,{variant:"outline",className:"rounded-full",children:Pe.volume_tag||"default"})]},Pe.id)),!q.length&&n.jsx("div",{className:"text-sm text-slate-600",children:"No tenants"})]})}),n.jsx(vr,{}),n.jsxs("div",{className:"text-xs text-slate-600",children:["Selected:"," ",n.jsx("span",{className:"font-medium text-slate-900",children:m?"ALL active":g.length})]})]})]}),n.jsxs(dt,{className:"rounded-3xl shadow-sm",children:[n.jsxs(gt,{children:[n.jsxs(jt,{className:"flex items-center gap-2",children:[n.jsx(cR,{className:"h-4 w-4"})," Migration Builder"]}),n.jsx(gs,{children:"Build operations  preview SQL  apply as job."})]}),n.jsxs(it,{className:"space-y-4",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Job name"}),n.jsx(Ee,{value:v,onChange:Pe=>j(Pe.target.value),className:"rounded-2xl"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Dry run"}),n.jsxs("div",{className:"rounded-2xl border p-3 flex items-center justify-between bg-slate-50",children:[n.jsx("div",{className:"text-sm font-medium",children:E?"ON (no DB change)":"OFF (execute DDL)"}),n.jsx(Wc,{checked:!E,onCheckedChange:Pe=>k(!Pe)})]})]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Description"}),n.jsx(fs,{value:w,onChange:Pe=>S(Pe.target.value),className:"rounded-2xl"})]}),n.jsxs("div",{className:"rounded-2xl border p-3 bg-gradient-to-b from-white to-slate-50",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"font-medium text-sm flex items-center gap-2",children:[n.jsx(nb,{className:"h-4 w-4"})," Destructive operations"]}),n.jsx("div",{className:"text-xs text-slate-600",children:"DROP database/table/column requires explicit confirmation."})]}),n.jsx(Wc,{checked:A,onCheckedChange:I})]}),A&&n.jsxs("div",{className:"mt-3",children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Type exactly: I UNDERSTAND"}),n.jsx(Ee,{value:P,onChange:Pe=>O(Pe.target.value),className:"rounded-2xl"})]})]}),n.jsx(vr,{}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("add_column"),children:[n.jsx(aR,{className:"h-4 w-4 mr-2"})," Add Column"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("modify_column"),children:[n.jsx(aR,{className:"h-4 w-4 mr-2"})," Modify Column"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("drop_column"),children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"})," Drop Column"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("create_table"),children:[n.jsx(cR,{className:"h-4 w-4 mr-2"})," Create Table"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("drop_table"),children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"})," Drop Table"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("rename_column"),children:[n.jsx(Ti,{className:"h-4 w-4 mr-2"})," Rename Column"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("create_database"),children:[n.jsx(sN,{className:"h-4 w-4 mr-2"})," Create DB"]}),n.jsxs(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Z("drop_database"),children:[n.jsx(Ms,{className:"h-4 w-4 mr-2"})," Drop DB"]})]}),n.jsx("div",{className:"space-y-3",children:n.jsx(on,{children:D.map((Pe,bt)=>{var It,De,tt,ve,Ge;return n.jsxs(mt.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},className:"rounded-3xl border bg-white shadow-sm",children:[n.jsxs("div",{className:"p-4 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(et,{variant:"outline",className:"rounded-full",children:Pe.op}),n.jsxs("div",{className:"text-sm font-medium text-slate-900",children:["Operation #",bt+1]})]}),n.jsx(ge,{variant:"ghost",className:"rounded-2xl",onClick:()=>Y(bt),children:n.jsx(ts,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[(Pe.op==="create_database"||Pe.op==="drop_database")&&n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Database name"}),n.jsx(Ee,{value:Pe.db_name||"",onChange:We=>Q(bt,{db_name:We.target.value}),placeholder:"nabh_hims_newtenant",className:"rounded-2xl"})]}),(Pe.op==="drop_table"||Pe.op==="create_table"||Pe.op==="add_column"||Pe.op==="modify_column"||Pe.op==="drop_column"||Pe.op==="rename_column")&&n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Table"}),n.jsx(Ee,{value:Pe.table||"",onChange:We=>Q(bt,{table:We.target.value}),placeholder:"example: patients",className:"rounded-2xl"})]}),(Pe.op==="add_column"||Pe.op==="modify_column")&&n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Column name"}),n.jsx(Ee,{value:((It=Pe.column)==null?void 0:It.name)||"",onChange:We=>oe(bt,{name:We.target.value}),className:"rounded-2xl"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Type"}),n.jsxs(Zs,{value:((De=Pe.column)==null?void 0:De.type)||"",onValueChange:We=>oe(bt,{type:We}),children:[n.jsx(Ws,{className:"rounded-2xl",children:n.jsx(Js,{placeholder:"Select type"})}),n.jsx(qs,{children:(i.length?i:["VARCHAR(255)","INT","DATETIME","JSON"]).map(We=>n.jsx(Ut,{value:We,children:We},We))})]})]}),n.jsxs("div",{className:"rounded-2xl border p-3 bg-slate-50 flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-medium",children:"Nullable"}),n.jsx(Wc,{checked:!!((tt=Pe.column)!=null&&tt.nullable),onCheckedChange:We=>oe(bt,{nullable:We})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Default (optional)"}),n.jsx(Ee,{value:((ve=Pe.column)==null?void 0:ve.default)??"",onChange:We=>oe(bt,{default:We.target.value?We.target.value:null}),placeholder:"NULL | CURRENT_TIMESTAMP | 0 | 'abc'",className:"rounded-2xl"})]}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Comment"}),n.jsx(Ee,{value:((Ge=Pe.column)==null?void 0:Ge.comment)||"",onChange:We=>oe(bt,{comment:We.target.value}),className:"rounded-2xl"})]})]}),Pe.op==="drop_column"&&n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Column name"}),n.jsx(Ee,{value:Pe.column_name||"",onChange:We=>Q(bt,{column_name:We.target.value}),className:"rounded-2xl"})]}),Pe.op==="rename_column"&&n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Old name"}),n.jsx(Ee,{value:Pe.old_column_name||"",onChange:We=>Q(bt,{old_column_name:We.target.value}),className:"rounded-2xl"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"New name"}),n.jsx(Ee,{value:Pe.new_column_name||"",onChange:We=>Q(bt,{new_column_name:We.target.value}),className:"rounded-2xl"})]})]}),Pe.op==="create_table"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Table name"}),n.jsx(Ee,{value:Pe.table||"",onChange:We=>Q(bt,{table:We.target.value}),className:"rounded-2xl"})]}),n.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-medium",children:"Columns"}),n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>xe(bt),children:"+ Add column"})]}),n.jsx("div",{className:"mt-3 space-y-2",children:(Pe.columns||[]).map((We,Ve)=>n.jsx("div",{className:"rounded-2xl border bg-white p-3",children:n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Name"}),n.jsx(Ee,{value:We.name||"",onChange:Fe=>_e(bt,Ve,{name:Fe.target.value}),className:"rounded-2xl"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Type"}),n.jsxs(Zs,{value:We.type||"",onValueChange:Fe=>_e(bt,Ve,{type:Fe}),children:[n.jsx(Ws,{className:"rounded-2xl",children:n.jsx(Js,{})}),n.jsx(qs,{children:(i.length?i:["VARCHAR(255)","INT","DATETIME","JSON"]).map(Fe=>n.jsx(Ut,{value:Fe,children:Fe},Fe))})]})]}),n.jsxs("div",{className:"rounded-2xl border p-3 bg-slate-50 flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-medium",children:"Nullable"}),n.jsx(Wc,{checked:!!We.nullable,onCheckedChange:Fe=>_e(bt,Ve,{nullable:Fe})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Default"}),n.jsx(Ee,{value:We.default??"",onChange:Fe=>_e(bt,Ve,{default:Fe.target.value?Fe.target.value:null}),placeholder:"NULL | CURRENT_TIMESTAMP | 0 | 'abc'",className:"rounded-2xl"})]}),n.jsxs("div",{className:"md:col-span-2 flex items-center gap-2",children:[n.jsx(Ee,{value:We.comment||"",onChange:Fe=>_e(bt,Ve,{comment:Fe.target.value}),placeholder:"comment (optional)",className:"rounded-2xl"}),n.jsx(ge,{variant:"ghost",className:"rounded-2xl",onClick:()=>me(bt,Ve),children:n.jsx(Ms,{className:"h-4 w-4"})})]})]})},Ve))})]})]})]})]},bt)})})}),n.jsx(vr,{}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs(ge,{onClick:$e,className:"rounded-2xl",disabled:B,children:[B?n.jsx(Rt,{className:"h-4 w-4 mr-2 animate-spin"}):n.jsx(Wr,{className:"h-4 w-4 mr-2"}),"Plan (Preview SQL)"]}),n.jsxs(ge,{onClick:fe,className:"rounded-2xl",variant:"default",disabled:R,children:[R?n.jsx(Rt,{className:"h-4 w-4 mr-2 animate-spin"}):n.jsx(Ome,{className:"h-4 w-4 mr-2"}),"Apply (Create Job)"]})]}),W&&n.jsxs("div",{className:"rounded-3xl border bg-slate-50 p-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium text-sm",children:"SQL Preview"}),n.jsx(et,{className:`rounded-full border ${W.destructive_detected?"bg-rose-100 text-rose-800 border-rose-200":"bg-emerald-100 text-emerald-800 border-emerald-200"}`,children:W.destructive_detected?"Destructive detected":"Safe"})]}),((He=W.global_sql)==null?void 0:He.length)>0&&n.jsxs("div",{className:"mt-3",children:[n.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Global SQL (runs once)"}),n.jsx("pre",{className:"text-xs bg-white border rounded-2xl p-3 overflow-auto",children:W.global_sql.join(`;
`)+";"})]}),n.jsxs("div",{className:"mt-3 space-y-3",children:[(W.targets||[]).slice(0,8).map(Pe=>n.jsxs("div",{className:"rounded-2xl border bg-white p-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-medium",children:Pe.db_name}),n.jsxs(et,{variant:"outline",className:"rounded-full",children:["#",Pe.tenant_id]})]}),n.jsx("pre",{className:"mt-2 text-xs bg-slate-50 border rounded-2xl p-3 overflow-auto",children:(Pe.sql||[]).join(`;
`)+((Pe.sql||[]).length?";":"")})]},Pe.tenant_id)),(W.targets||[]).length>8&&n.jsx("div",{className:"text-xs text-slate-600",children:"Showing 8 tenants preview. Apply will run on all selected targets."})]})]})]})]})]})}),n.jsx(Ls,{value:"jobs",className:"mt-4",children:n.jsxs("div",{className:"grid gap-4 xl:grid-cols-[420px,1fr]",children:[n.jsxs(dt,{className:"rounded-3xl shadow-sm",children:[n.jsxs(gt,{children:[n.jsx(jt,{children:"Jobs"}),n.jsx(gs,{children:"Track executions per tenant."})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs(ge,{variant:"outline",className:"rounded-2xl w-full",onClick:Me,children:[n.jsx(ps,{className:"h-4 w-4 mr-2"})," Refresh Jobs"]}),n.jsx(Fn,{className:"h-[520px] pr-2",children:n.jsxs("div",{className:"space-y-2",children:[G.map(Pe=>n.jsxs("button",{onClick:()=>Ae(Pe.id),className:"w-full text-left rounded-2xl border p-3 bg-white hover:bg-slate-50 transition",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"font-medium truncate",children:Pe.name}),n.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${E5(Pe.status)}`,children:Pe.status})]}),n.jsxs("div",{className:"text-xs text-slate-600 mt-1",children:["Job #",Pe.id]})]},Pe.id)),!G.length&&n.jsx("div",{className:"text-sm text-slate-600",children:"No jobs"})]})})]})]}),n.jsxs(dt,{className:"rounded-3xl shadow-sm",children:[n.jsxs(gt,{children:[n.jsxs(jt,{className:"flex items-center justify-between",children:[n.jsx("span",{children:"Job Details"}),((pt=$==null?void 0:$.job)==null?void 0:pt.status)==="RUNNING"&&n.jsx(ge,{variant:"outline",className:"rounded-2xl",onClick:()=>Ke($.job.id),children:"Cancel"})]}),n.jsx(gs,{children:$?`Job #${$.job.id}`:"Select a job to view details"})]}),n.jsxs(it,{children:[le&&n.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[n.jsx(Rt,{className:"h-4 w-4 animate-spin"})," Loading..."]}),!le&&$&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"rounded-2xl border p-3 bg-slate-50",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium",children:$.job.name}),n.jsx(et,{className:`rounded-full border ${E5($.job.status)}`,children:$.job.status})]}),$.job.description&&n.jsx("div",{className:"text-sm text-slate-700 mt-1",children:$.job.description})]}),n.jsxs("div",{className:"rounded-2xl border overflow-hidden",children:[n.jsx("div",{className:"px-3 py-2 bg-white border-b font-medium text-sm",children:"Targets"}),n.jsx("div",{className:"divide-y",children:$.targets.map(Pe=>n.jsxs("div",{className:"p-3 flex items-start justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"font-medium text-sm",children:["Tenant #",Pe.tenant_id]}),Pe.error&&n.jsx("div",{className:"text-xs text-rose-700 mt-1 break-words",children:Pe.error})]}),n.jsx("div",{className:"text-right",children:n.jsx(et,{className:`rounded-full border ${E5(Pe.status)}`,children:Pe.status})})]},Pe.tenant_id))})]})]}),!le&&!$&&n.jsx("div",{className:"text-sm text-slate-600",children:"Pick a job on the left."})]})]})]})}),n.jsx(Ls,{value:"storage",className:"mt-4",children:n.jsxs("div",{className:"grid gap-4 xl:grid-cols-[420px,1fr]",children:[n.jsxs(dt,{className:"rounded-3xl shadow-sm",children:[n.jsxs(gt,{children:[n.jsxs(jt,{className:"flex items-center gap-2",children:[n.jsx(Bue,{className:"h-4 w-4"})," Volume Usage"]}),n.jsx(gs,{children:"Grouped by tenant meta.volume_tag."})]}),n.jsxs(it,{className:"space-y-3",children:[n.jsxs(ge,{variant:"outline",className:"rounded-2xl w-full",onClick:Le,children:[n.jsx(ps,{className:"h-4 w-4 mr-2"})," Refresh"]}),n.jsxs("div",{className:"space-y-2",children:[J.map(Pe=>n.jsxs("div",{className:"rounded-2xl border p-3 bg-white flex items-center justify-between",children:[n.jsx("div",{className:"font-medium",children:Pe.volume_tag}),n.jsxs(et,{variant:"outline",className:"rounded-full",children:[Pe.used_mb," MB"]})]},Pe.volume_tag)),!J.length&&n.jsx("div",{className:"text-sm text-slate-600",children:"No data"})]})]})]}),n.jsxs(dt,{className:"rounded-3xl shadow-sm",children:[n.jsxs(gt,{children:[n.jsx(jt,{children:"Tenant Storage"}),n.jsx(gs,{children:"Shows usage for active tenants (limited for UI speed)."})]}),n.jsx(it,{children:n.jsx(Fn,{className:"h-[520px] pr-2",children:n.jsx("div",{className:"space-y-2",children:r.filter(Pe=>Pe.is_active).map(Pe=>n.jsxs("div",{className:"rounded-2xl border p-3 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"font-medium truncate",children:Pe.name}),n.jsxs("div",{className:"text-xs text-slate-600 truncate",children:[Pe.code,"  ",Pe.db_name]})]}),n.jsx(et,{variant:"outline",className:"rounded-full",children:te[Pe.id]==null?"":`${te[Pe.id]} MB`})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsx("div",{className:"text-xs text-slate-600",children:"Volume"}),n.jsx(Ee,{defaultValue:Pe.volume_tag||"default",className:"rounded-2xl h-9",onKeyDown:async bt=>{if(bt.key==="Enter"){const It=bt.currentTarget.value;try{await xZe(Pe.id,It),ae.success("Volume updated"),await ee()}catch(De){ae.error(Du(De,"Volume update failed"))}}}}),n.jsx("div",{className:"text-xs text-slate-500",children:"Enter to save"})]})]},Pe.id))})})})]})]})})]})})]})})})}function bZe(){return p.useEffect(()=>{const s=async()=>{if(localStorage.getItem("access_token"))try{await mV()}catch(i){console.error("Auto token refresh failed",i)}};s();const r=setInterval(s,174e4);return()=>clearInterval(r)},[]),n.jsxs(n.Fragment,{children:[n.jsxs(cle,{children:[n.jsx(Lt,{path:"/auth/login",element:n.jsx(Zhe,{})}),n.jsx(Lt,{path:"/auth/register-admin",element:n.jsx(Jhe,{})}),n.jsx(Lt,{path:"/auth/verify",element:n.jsx(exe,{})}),n.jsx(Lt,{element:n.jsx(_xe,{}),children:n.jsxs(Lt,{element:n.jsx(cxe,{children:n.jsx(wxe,{})}),children:[n.jsx(Lt,{path:"/admin",element:n.jsx(hB,{})}),n.jsx(Lt,{path:"/dashboard",element:n.jsx(hB,{})}),n.jsx(Lt,{path:"/admin/roles",element:n.jsx(Jbe,{})}),n.jsx(Lt,{path:"/admin/permissions",element:n.jsx(iye,{})}),n.jsx(Lt,{path:"/admin/users",element:n.jsx(sye,{})}),n.jsx(Lt,{path:"/admin/departments",element:n.jsx(xNe,{})}),n.jsx(Lt,{path:"/patients",element:n.jsx(qKe,{})}),n.jsx(Lt,{path:"/patients/masters",element:n.jsx(QKe,{})}),n.jsx(Lt,{path:"/opd/dashboard",element:n.jsx(KYe,{})}),n.jsx(Lt,{path:"/opd/schedules",element:n.jsx(lYe,{})}),n.jsx(Lt,{path:"/opd/appointments",element:n.jsx(gYe,{})}),n.jsx(Lt,{path:"/opd/queue",element:n.jsx(kYe,{})}),n.jsx(Lt,{path:"/opd/triage",element:n.jsx(RYe,{})}),n.jsx(Lt,{path:"/opd/visit/:id",element:n.jsx(zYe,{})}),n.jsx(Lt,{path:"/opd/followups",element:n.jsx(HYe,{})}),n.jsx(Lt,{path:"/opd/no-shows",element:n.jsx(GYe,{})}),n.jsx(Lt,{path:"/opd/doctor-fees",element:n.jsx(YYe,{})}),n.jsx(Lt,{path:"/ipd/admissions",element:n.jsx(h2e,{})}),n.jsx(Lt,{path:"/ipd/admission/:id",element:n.jsx(eke,{})}),n.jsx(Lt,{path:"/ipd/tracking",element:n.jsx(rke,{})}),n.jsx(Lt,{path:"/ipd/my",element:n.jsx(ake,{})}),n.jsx(Lt,{path:"/ipd/discharged",element:n.jsx(ike,{})}),n.jsx(Lt,{path:"/ipd/bedboard",element:n.jsx(lke,{})}),n.jsx(Lt,{path:"/ipd/masters",element:n.jsx(kwe,{})}),n.jsx(Lt,{path:"/lab/orders",element:n.jsx(Oke,{})}),n.jsx(Lt,{path:"/lab/orders/:id",element:n.jsx(uke,{})}),n.jsx(Lt,{path:"/lab/masters",element:n.jsx(gke,{})}),n.jsx(Lt,{path:"/lab/service/masters",element:n.jsx(qke,{})}),n.jsx(Lt,{path:"/lab/orders/:id/print",element:n.jsx(Kke,{})}),n.jsx(Lt,{path:"/lis/analyzer-staging",element:n.jsx(N3e,{})}),n.jsx(Lt,{path:"/lis/device-logs",element:n.jsx(T3e,{})}),n.jsx(Lt,{path:"/lis/device-mapping",element:n.jsx(A3e,{})}),n.jsx(Lt,{path:"/ris/orders",element:n.jsx(r5e,{})}),n.jsx(Lt,{path:"/ris/orders/:id",element:n.jsx(w5e,{})}),n.jsx(Lt,{path:"/ris/masters",element:n.jsx(b5e,{})}),n.jsx(Lt,{path:"/ot/schedule",element:n.jsx(I5e,{})}),n.jsx(Lt,{path:"/ot/masters",element:n.jsx(B5e,{})}),n.jsx(Lt,{path:"/ot/cases/:caseId",element:n.jsx(p3e,{})}),n.jsx(Lt,{path:"/ot/logs",element:n.jsx(f3e,{})}),n.jsx(Lt,{path:"/billing",element:n.jsx(o4e,{})}),n.jsx(Lt,{path:"/billing/invoices/:invoiceId",element:n.jsx(J3e,{})}),n.jsx(Lt,{path:"/billing/advance",element:n.jsx(d4e,{})}),n.jsx(Lt,{path:"/emr",element:n.jsx(y4e,{})}),n.jsx(Lt,{path:"/templates",element:n.jsx(E4e,{})}),n.jsx(Lt,{path:"/templates/new",element:n.jsx(N7,{mode:"create"})}),n.jsx(Lt,{path:"/templates/:id/edit",element:n.jsx(N7,{mode:"edit"})}),n.jsx(Lt,{path:"/templates/generate",element:n.jsx(bOe,{})}),n.jsx(Lt,{path:"/templates/consents",element:n.jsx(yOe,{})}),n.jsx(Lt,{path:"/settings/branding",element:n.jsx(iYe,{})}),n.jsx(Lt,{element:n.jsx(kxe,{reqAny:["master.migrations.view"]}),children:n.jsx(Lt,{path:"/master/migrations",element:n.jsx(gZe,{})})}),n.jsx(Lt,{path:"/mis",element:n.jsx(uKe,{})}),n.jsx(Lt,{path:"/pharmacy/inventory",element:n.jsx(hXe,{})}),n.jsx(Lt,{path:"/pharmacy/qr-lookup",element:n.jsx(ZXe,{})}),n.jsx(Lt,{path:"/pharmacy/inventory/barcode-lookup",element:n.jsx(eQe,{})}),n.jsx(Lt,{path:"/pharmacy/rx",element:n.jsx(dQe,{})}),n.jsx(Lt,{path:"/pharmacy/dispense",element:n.jsx(TQe,{})}),n.jsx(Lt,{path:"/pharmacy/billing",element:n.jsx(bQe,{})}),n.jsx(Lt,{path:"/pharmacy/sales",element:n.jsx(vQe,{})}),n.jsx(Lt,{path:"/pharmacy/returns",element:n.jsx(NQe,{})}),n.jsx(Lt,{path:"/pharmacy/rx-explorer",element:n.jsx(DQe,{})}),n.jsx(Lt,{path:"/opd/phramacy",element:n.jsx(LQe,{})}),n.jsx(Lt,{path:"/ipd/phramacy",element:n.jsx(IQe,{})}),n.jsx(Lt,{path:"/counter/phramacy",element:n.jsx(OQe,{})}),n.jsx(Lt,{path:"/ot/phramacy",element:n.jsx(RQe,{})}),n.jsx(Lt,{path:"/pharmacy/accounts/supplier-ledger",element:n.jsx(UQe,{})}),n.jsx(Lt,{path:"/pharmacy/accounts/supplier-monthly-summary",element:n.jsx(WQe,{})}),n.jsx(Lt,{path:"/pharmacy/accounts/supplier-payments",element:n.jsx(JQe,{})}),n.jsx(Lt,{path:"/pharmacy/accounts/supplier-statement",element:n.jsx(rZe,{})})]})}),n.jsx(Lt,{path:"*",element:n.jsx(Zj,{to:"/auth/login",replace:!0})})]}),n.jsx(Sce,{position:"top-right",richColors:!0,closeButton:!0})]})}const yZe=p.createContext(null);function vZe({children:t,duration:s=3500}){const[r,a]=p.useState([]),i=p.useCallback(c=>{a(d=>d.filter(u=>u.id!==c))},[]),l=p.useCallback((c,d,u={})=>{const m=crypto.randomUUID(),x=u.duration??s;return a(g=>[...g,{id:m,type:c,message:d,duration:x}]),m},[s]),o=p.useMemo(()=>({success:(c,d)=>l("success",c,d),error:(c,d)=>l("error",c,d),warn:(c,d)=>l("warn",c,d),info:(c,d)=>l("info",c,d)}),[l]);return n.jsxs(yZe.Provider,{value:o,children:[t,n.jsx("div",{className:"fixed right-4 top-4 z-[9999] flex w-[min(92vw,380px)] flex-col gap-2",children:r.map(c=>n.jsx(jZe,{toast:c,onClose:()=>i(c.id)},c.id))})]})}function jZe({toast:t,onClose:s}){p.useEffect(()=>{const i=setTimeout(s,t.duration);return()=>clearTimeout(i)},[t.duration,s]);const r={success:"border-emerald-200 bg-emerald-50 text-emerald-800",error:"border-rose-200 bg-rose-50 text-rose-800",warn:"border-amber-200 bg-amber-50 text-amber-800",info:"border-blue-200 bg-blue-50 text-blue-800"}[t.type]??"border-gray-200 bg-white text-gray-800",a={success:Xt,error:ca,warn:en,info:gr}[t.type]??gr;return n.jsxs("div",{className:`flex items-start gap-3 rounded-xl border p-3 shadow-sm ${r}`,role:"status","aria-live":"polite",children:[n.jsx(a,{className:"mt-0.5 h-5 w-5"}),n.jsx("div",{className:"flex-1 text-sm",children:t.message}),n.jsx("button",{onClick:s,className:"opacity-70 hover:opacity-100","aria-label":"Close",children:n.jsx(ts,{className:"h-4 w-4"})})]})}T5.createRoot(document.getElementById("root")).render(n.jsx(_t.StrictMode,{children:n.jsx(vZe,{children:n.jsx(ble,{children:n.jsx(bZe,{})})})}));
